{"/get_started/zh/tutorial/quick-start.html":{"title":"å¿«é€Ÿå¼€å§‹","content":"# å¿«é€Ÿå¼€å§‹ ## åˆ›å»ºå·¥ç¨‹ åˆ›å»ºä¸€ä¸ªåå« `hello` çš„ `c` æ§åˆ¶å°å·¥ç¨‹ï¼š ```bash $ xmake create language c project ./hello # æˆ– $ xmake create l c P ./hello ``` æ‰§è¡Œå®Œåï¼Œå°†ä¼šç”Ÿæˆä¸€ä¸ªç®€å•å·¥ç¨‹ç»“æ„ï¼š ``` ./hello/ â”œâ”€â”€ src â”‚ â””â”€â”€ main.c â””â”€â”€ xmake.lua ``` å…¶ä¸­ `xmake.lua` æ˜¯å·¥ç¨‹æè¿°æ–‡ä»¶ï¼Œå†…å®¹éå¸¸ç®€å•ï¼Œå‘Šè¯‰ xmake æ·»åŠ  `src` ç›®å½•ä¸‹çš„æ‰€æœ‰ `.c` æºæ–‡ä»¶ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"hello\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` ç›®å‰æ”¯æŒçš„è¯­è¨€å¦‚ä¸‹ï¼š * c/c++ * objc/c++ * cuda * asm * swift * dlang * golang * rust > å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå‚æ•°é€‰é¡¹ï¼Œè¯·è¿è¡Œ: `xmake create help`ã€‚ ## æ„å»ºå·¥ç¨‹ ```bash $ cd hello $ xmake ``` ## è¿è¡Œç¨‹åº ```bash $ xmake run hello ``` ## è°ƒè¯•ç¨‹åº é¦–å…ˆä½ éœ€è¦åˆ‡æ¢åˆ° debug æ¨¡å¼å»é‡æ–°ç¼–è¯‘ç¨‹åºã€‚ ```bash $ xmake config m debug $ xmake ``` ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å»å¼€å§‹è°ƒè¯•ï¼š ```bash $ xmake run d hello ``` xmake å°†ä¼šä½¿ç”¨è°ƒè¯•å™¨å»åŠ è½½ç¨‹åºè¿è¡Œï¼Œç›®å‰æ”¯æŒï¼šlldb, gdb, windbg, vsjitdebugger, ollydbg ç­‰å„ç§è°ƒè¯•å™¨ã€‚ ```bash (gdb) b main Breakpoint 1 at 0x115c: file src/main.c, line 4. (gdb) r Starting program: /tmp/test xmake/hello/build/linux/x86_64/debug/hello [Thread debugging using libthread_db enabled] Using host libthread_db library \"/lib/x86_64 linux gnu/libthread_db.so.1\". Breakpoint 1, main (argc 1, argv 0x7fffffffdac8) at src/main.c:4 4 printf(\"hello world!\\n\"); (gdb) ``` å¦‚æœæƒ³è¦ä½¿ç”¨æŒ‡å®šçš„è°ƒè¯•å™¨ï¼š ```bash $ xmake f debugger gdb $ xmake run d hello ``` > ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç®€å†™çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œä¾‹å¦‚: `xmake r` æˆ–è€… `xmake run`ã€‚"},"/get_started/zh/tutorial/build-policies.html":{"title":"æ„å»ºç­–ç•¥","content":"# æ„å»ºç­–ç•¥ xmake æœ‰å¾ˆå¤šçš„é»˜è®¤è¡Œä¸ºï¼Œæ¯”å¦‚ï¼šè‡ªåŠ¨æ£€æµ‹å’Œæ˜ å°„ flagsã€è·¨ target å¹¶è¡Œæ„å»ºç­‰ï¼Œè™½ç„¶æä¾›äº†ä¸€å®šçš„æ™ºèƒ½åŒ–å¤„ç†ï¼Œä½†ä¼—å£éš¾è°ƒï¼Œä¸ä¸€å®šæ»¡è¶³æ‰€æœ‰çš„ç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯å’Œéœ€æ±‚ã€‚ å› æ­¤ xmake æä¾›é»˜è®¤æ„å»ºç­–ç•¥çš„ä¿®æ”¹è®¾ç½®ï¼Œå¼€æ”¾ç»™ç”¨æˆ·ä¸€å®šç¨‹åº¦ä¸Šçš„å¯é…ç½®æ€§ã€‚ å®ƒä¸»è¦é€šè¿‡ [set_policy](https://xmake.io/#/zh cn/manual/project_target?id targetset_policy) æ¥å£æ¥é…ç½®ã€‚ æˆ‘ä»¬é€šå¸¸å¯ä»¥ç”¨å®ƒæ¥é…ç½®ä¿®æ”¹ targetï¼Œpackage ä»¥åŠå·¥ç¨‹æ•´ä½“çš„ä¸€äº›è¡Œä¸ºç­–ç•¥ã€‚ ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š ```lua set_policy(\"check.auto_ignore_flags\", false) ``` åªéœ€è¦åœ¨é¡¹ç›®æ ¹åŸŸè®¾ç½®è¿™ä¸ªé…ç½®ï¼Œå°±å¯ä»¥ç¦ç”¨ flags çš„è‡ªåŠ¨æ£€æµ‹å’Œå¿½ç•¥æœºåˆ¶ï¼Œå¦å¤– `set_policy` ä¹Ÿå¯ä»¥é’ˆå¯¹æŸä¸ªç‰¹å®šçš„ target å±€éƒ¨ç”Ÿæ•ˆã€‚ ```lua target(\"test\", function() set_policy(\"check.auto_ignore_flags\", false) end) ``` > å¦å¤–ï¼Œå¦‚æœè®¾ç½®çš„ç­–ç•¥åæ˜¯æ— æ•ˆçš„ï¼Œxmake ä¹Ÿä¼šæœ‰è­¦å‘Šæç¤ºã€‚ å¦‚æœè¦è·å–å½“å‰ xmake æ”¯æŒçš„æ‰€æœ‰ç­–ç•¥é…ç½®åˆ—è¡¨å’Œæè¿°ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š ```bash $ xmake l core.project.policy.policies { \"check.auto_map_flags\" { type \"boolean\", description \"Enable map gcc flags to the current compiler and linker automatically.\", default true }, \"build.across_targets_in_parallel\" { type \"boolean\", description \"Enable compile the source files for each target in parallel.\", default true }, \"check.auto_ignore_flags\" { type \"boolean\", description \"Enable check and ignore unsupported flags automatically.\", default true } } ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼å»è®¾ç½®ä¿®æ”¹å†…éƒ¨çš„ç­–ç•¥: ```bash $ xmake f policies package.fetch_only ``` é»˜è®¤è®¾ç½®ç­–ç•¥åï¼Œå°±æ˜¯å¯ç”¨çŠ¶æ€ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šè®¾ç½®å…¶ä»–å€¼ï¼Œç¦ç”¨å®ƒã€‚ ```bash $ xmake f policies package.precompiled:n ``` æˆ–è€…åŒæ—¶é…ç½®å¤šä¸ªç­–ç•¥å€¼ï¼Œç”¨é€—å·åˆ†å‰²ã€‚ ```bash $ xmake f policies package.precompiled:n,package.install_only ``` ### check.auto_ignore_flags xmake é»˜è®¤ä¼šå¯¹æ‰€æœ‰ `add_cxflags`, `add_ldflags` æ¥å£è®¾ç½®çš„åŸå§‹ flags è¿›è¡Œè‡ªåŠ¨æ£€æµ‹ï¼Œå¦‚æœæ£€æµ‹å½“å‰ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ä¸æ”¯æŒå®ƒä»¬ï¼Œå°±ä¼šè‡ªåŠ¨å¿½ç•¥ã€‚ è¿™é€šå¸¸æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œåƒä¸€äº›å¯é€‰çš„ç¼–è¯‘ flagsï¼Œå³ä½¿ä¸æ”¯æŒä¹Ÿèƒ½æ­£å¸¸ç¼–è¯‘ï¼Œä½†æ˜¯å¼ºè¡Œè®¾ç½®ä¸Šå»ï¼Œå…¶ä»–ç”¨æˆ·åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šå› ä¸ºç¼–è¯‘å™¨çš„æ”¯æŒåŠ›åº¦ä¸åŒï¼Œå‡ºç°ä¸€å®šç¨‹åº¦çš„ç¼–è¯‘å¤±è´¥ã€‚ ä½†ç”±äºè‡ªåŠ¨æ£€æµ‹å¹¶ä¸ä¿è¯100%å¯é ï¼Œæœ‰æ—¶å€™ä¼šæœ‰ä¸€å®šç¨‹åº¦çš„è¯¯åˆ¤ï¼Œæ‰€ä»¥æŸäº›ç”¨æˆ·å¹¶ä¸å–œæ¬¢è¿™ä¸ªè®¾å®šï¼ˆå°¤å…¶æ˜¯é’ˆå¯¹äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œæ›´å®¹æ˜“å‡ºç°å¤±è´¥ï¼‰ã€‚ ç›®å‰å¦‚æœæ£€æµ‹å¤±è´¥ï¼Œä¼šæœ‰è­¦å‘Šæç¤ºé¿å…ç”¨æˆ·è«åèººå‘ï¼Œä¾‹å¦‚ï¼š ```bash warning: add_ldflags(\" static\") is ignored, please pass `{force true}` or call `set_policy(\"check.auto_ignore_flags\", false)` if you want to set it. ``` æ ¹æ®æç¤ºï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ†æåˆ¤æ–­ï¼Œæ˜¯å¦éœ€è¦å¼ºåˆ¶è®¾ç½®è¿™ä¸ª flagsï¼Œä¸€ç§å°±æ˜¯é€šè¿‡ï¼š ```lua add_ldflags(\" static\", {force true}) ``` æ¥æ˜¾ç¤ºçš„å¼ºåˆ¶è®¾ç½®ä¸Šå®ƒï¼Œè·³è¿‡è‡ªåŠ¨æ£€æµ‹ï¼Œè¿™å¯¹äºå¶å°”çš„ flags å¤±è´¥ï¼Œæ˜¯å¾ˆæœ‰æ•ˆå¿«æ·çš„å¤„ç†æ–¹å¼ï¼Œä½†æ˜¯å¯¹äºäº¤å‰ç¼–è¯‘æ—¶å€™ï¼Œä¸€å †çš„ flags è®¾ç½®æ£€æµ‹ä¸è¿‡çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªéƒ½è®¾ç½® force å¤ªè¿‡äºç¹çã€‚ è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ `set_policy` æ¥å¯¹æŸä¸ª target æˆ–è€…æ•´ä¸ª project ç›´æ¥ç¦ç”¨é»˜è®¤çš„è‡ªåŠ¨æ£€æµ‹è¡Œä¸ºï¼š ```lua set_policy(\"check.auto_ignore_flags\", false) target(\"test\", function() add_ldflags(\" static\") end) ``` ç„¶åæˆ‘ä»¬å°±å¯ä»¥éšæ„è®¾ç½®å„ç§åŸå§‹ flagsï¼Œxmake ä¸ä¼šå»è‡ªåŠ¨æ£€æµ‹å’Œå¿½ç•¥ä»–ä»¬äº†ã€‚ ### check.auto_map_flags è¿™æ˜¯ xmake çš„å¦å¤–ä¸€ä¸ªå¯¹ flags çš„æ™ºèƒ½åˆ†æå¤„ç†ï¼Œé€šå¸¸åƒ `add_links`, `add_defines` è¿™ç§ xmake å†…ç½®çš„ api å»è®¾ç½®çš„é…ç½®ï¼Œæ˜¯å…·æœ‰è·¨å¹³å°ç‰¹æ€§çš„ï¼Œä¸åŒç¼–è¯‘å™¨å¹³å°ä¼šè‡ªåŠ¨å¤„ç†æˆå¯¹åº”çš„åŸå§‹ flagsã€‚ ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µï¼Œç”¨æˆ·è¿˜æ˜¯éœ€è¦è‡ªå·±é€šè¿‡ `add_cxflags`, `add_ldflags` è®¾ç½®åŸå§‹çš„ç¼–è¯‘é“¾æ¥ flagsï¼Œè¿™äº› flags å¹¶ä¸èƒ½å¾ˆå¥½çš„è·¨ç¼–è¯‘å™¨ã€‚ å°±æ‹¿ ` O0` çš„ç¼–è¯‘ä¼˜åŒ– flags æ¥è¯´ï¼Œè™½ç„¶æœ‰ `set_optimize` æ¥å®ç°è·¨ç¼–è¯‘å™¨é…ç½®ï¼Œä½†å¦‚æœç”¨æˆ·ç›´æ¥è®¾ç½® `add_cxflags(\" O0\")` å‘¢ï¼Ÿgcc/clang ä¸‹å¯ä»¥æ­£å¸¸å¤„ç†ï¼Œä½†æ˜¯ msvc ä¸‹å°±ä¸æ”¯æŒäº†ã€‚ ä¹Ÿè®¸æˆ‘ä»¬èƒ½é€šè¿‡ `if is_plat() then` æ¥åˆ†å¹³å°å¤„ç†ï¼Œä½†å¾ˆç¹çï¼Œå› æ­¤ xmake å†…ç½®äº† flags çš„è‡ªåŠ¨æ˜ å°„åŠŸèƒ½ã€‚ åŸºäº gcc flags çš„æ™®åŠæ€§ï¼Œxmake é‡‡ç”¨ gcc çš„ flags å‘½åè§„èŒƒï¼Œå¯¹å…¶æ ¹æ®ä¸åŒçš„ç¼–è¯‘å®ç°è‡ªåŠ¨æ˜ å°„ï¼Œä¾‹å¦‚ï¼š ```lua add_cxflags(\" O0\") ``` è¿™ä¸€è¡Œè®¾ç½®ï¼Œåœ¨ gcc/clang ä¸‹è¿˜æ˜¯ ` O0`ï¼Œä½†å¦‚æœå½“å‰æ˜¯ msvc ç¼–è¯‘å™¨ï¼Œé‚£è¾¹ä¼šè‡ªåŠ¨æ˜ å°„ä¸º msvc å¯¹åº” ` Od` ç¼–è¯‘é€‰é¡¹æ¥ç¦ç”¨ä¼˜åŒ–ã€‚ æ•´ä¸ªè¿‡ç¨‹ï¼Œç”¨æˆ·æ˜¯å®Œå…¨æ— æ„ŸçŸ¥çš„ï¼Œç›´æ¥æ‰§è¡Œ xmake å°±å¯ä»¥è·¨ç¼–è¯‘å™¨å®Œæˆç¼–è¯‘ã€‚ > å½“ç„¶ï¼Œç›®å‰çš„è‡ªåŠ¨æ˜ å°„å®ç°è¿˜ä¸æ˜¯å¾ˆæˆç†Ÿï¼Œæ²¡æœ‰ 100% è¦†ç›–æ‰€æœ‰ gcc çš„ flagsï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰ä¸å°‘ flags æ˜¯æ²¡å»æ˜ å°„çš„ã€‚ ä¹Ÿæœ‰éƒ¨åˆ†ç”¨æˆ·å¹¶ä¸å–œæ¬¢è¿™ç§è‡ªåŠ¨æ˜ å°„è¡Œä¸ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„è®¾ç½®å®Œå…¨ç¦ç”¨è¿™ä¸ªé»˜è®¤çš„è¡Œä¸ºï¼š ```bash set_policy(\"check.auto_map_flags\", false) ``` ### build.across_targets_in_parallel è¿™ä¸ªç­–ç•¥ä¹Ÿæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œä¸»è¦ç”¨äºè·¨ target é—´æ‰§è¡Œå¹¶è¡Œæ„å»ºï¼Œv2.3.3 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶è¡Œæ„å»ºåªèƒ½é’ˆå¯¹å•ä¸ª target å†…éƒ¨çš„æ‰€æœ‰æºæ–‡ä»¶ï¼Œ è·¨ target çš„ç¼–è¯‘ï¼Œå¿…é¡»è¦è¦ç­‰å…ˆå‰çš„ target å®Œå…¨ link æˆåŠŸï¼Œæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ª target çš„ç¼–è¯‘ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šå½±å“ç¼–è¯‘é€Ÿåº¦ã€‚ ç„¶è€Œæ¯ä¸ª target çš„æºæ–‡ä»¶æ˜¯å¯ä»¥å®Œå…¨å¹¶è¡ŒåŒ–å¤„ç†çš„ï¼Œæœ€ç»ˆåœ¨ä¸€èµ·æ‰§è¡Œ link è¿‡ç¨‹ï¼Œv2.3.3 ä¹‹åçš„ç‰ˆæœ¬é€šè¿‡è¿™ä¸ªä¼˜åŒ–ï¼Œæ„å»ºé€Ÿåº¦æå‡äº†30%ã€‚ å½“ç„¶ï¼Œå¦‚æœæœ‰äº›ç‰¹æ®Šçš„ target é‡Œé¢çš„æ„å»ºæºæ–‡ä»¶è¦ä¾èµ–å…ˆå‰çš„ targetï¼ˆå°¤å…¶æ˜¯ä¸€äº›è‡ªå®šä¹‰ rules çš„æƒ…å†µï¼Œè™½ç„¶å¾ˆå°‘é‡åˆ°ï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„è®¾ç½®ç¦ç”¨è¿™ä¸ªä¼˜åŒ–è¡Œä¸ºï¼š ```bash set_policy(\"build.across_targets_in_parallel\", false) ``` ### build.fence ç”±äºé…ç½® `set_policy(\"build.across_targets_in_parallel\", false)` å­˜åœ¨å±€é™æ€§ï¼Œå®ƒä¼šé™åˆ¶çˆ¶ target å’Œå®ƒçš„æ‰€æœ‰ä¾èµ–çš„å­ target ä¹‹é—´çš„å¹¶è¡Œåº¦ï¼Œå½±å“çš„èŒƒå›´æœ‰ç‚¹å¤§ã€‚ è€Œæˆ‘ä»¬åš codegen æ—¶å€™ï¼Œæœ‰æ—¶å€™ä»…ä»…åªæ˜¯æƒ³å¯¹å…¶ä¸­æŸä¸ªä¾èµ–çš„ target é™åˆ¶å¹¶è¡Œåº¦ï¼Œä½œä¸º codegen ç¨‹åºï¼Œæå‰è®©å®ƒå®Œæˆç¼–è¯‘ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œ`build.across_targets_in_parallel` å°±æ— æ³•ç²¾ç»†æ§åˆ¶äº†ï¼Œç¼–è¯‘é€Ÿåº¦ä¹Ÿæ— æ³•è¾¾åˆ°æœ€ä¼˜ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬æ–°å¢äº† `build.fence` ç­–ç•¥ï¼Œå®ƒå¯ä»¥ä»…ä»…åªé’ˆå¯¹ç‰¹å®šçš„å­ target é™åˆ¶å¹¶è¡Œç¼–è¯‘é“¾æ¥ã€‚ ç›¸å…³çš„èƒŒæ™¯ç»†èŠ‚ï¼Œå¯ä»¥çœ‹ä¸‹ï¼š[#5003](https://github.com/xmake io/xmake/issues/5003) ä¾‹å¦‚ï¼š ```lua target(\"autogen\", function() set_default(false) set_kind(\"binary\") set_plat(os.host()) set_arch(os.arch()) add_files(\"src/autogen.cpp\") set_languages(\"c++11\") set_policy(\"build.fence\", true) end) target(\"test\", function() set_kind(\"binary\") add_deps(\"autogen\") add_rules(\"autogen\") add_files(\"src/main.cpp\") add_files(\"src/*.in\") end) ``` å…¶ä¸­ autogen ç›®æ ‡ç¨‹åºéœ€è¦åœ¨ test ç¨‹åºçš„æºç è¢«ç¼–è¯‘å‰ï¼Œå°±è¦å®Œæˆç¼–è¯‘é“¾æ¥ï¼Œå› ä¸º test ç›®æ ‡éœ€è¦è¿è¡Œ autogen ç¨‹åºï¼Œå»åŠ¨æ€ç”Ÿæˆä¸€äº›æºç å‚ä¸ç¼–è¯‘ã€‚ è€Œé’ˆå¯¹ autogen é…ç½® `set_policy(\"build.fence\", true)` å°±å¯ä»¥å®ç°è¿™ä¸ªç›®çš„ã€‚ ### build.merge_archive å¦‚æœè®¾ç½®äº†è¿™ä¸ªç­–ç•¥ï¼Œé‚£ä¹ˆä½¿ç”¨ `add_deps()` ä¾èµ–çš„ç›®æ ‡åº“ä¸å†ä½œä¸ºé“¾æ¥å­˜åœ¨ï¼Œè€Œæ˜¯ç›´æ¥æŠŠå®ƒä»¬åˆå¹¶åˆ°çˆ¶ç›®æ ‡åº“ä¸­å»ã€‚ ä¾‹å¦‚ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"add\", function() set_kind(\"static\") add_files(\"src/add.c\") add_files(\"src/subdir/add.c\") end) target(\"sub\", function() set_kind(\"static\") add_files(\"src/sub.c\") add_files(\"src/subdir/sub.c\") end) target(\"mul\", function() set_kind(\"static\") add_deps(\"add\", \"sub\") add_files(\"src/mul.c\") set_policy(\"build.merge_archive\", true) end) target(\"test\", function() add_deps(\"mul\") add_files(\"src/main.c\") end) ``` libmul.a é™æ€åº“ä¼šè‡ªåŠ¨åˆå¹¶ libadd.a å’Œ libsub.a ä¸¤ä¸ªå­ä¾èµ–çš„é™æ€åº“ã€‚ ### build.ccache Xmake é»˜è®¤æ˜¯å¼€å¯å†…ç½®çš„ç¼–è¯‘ç¼“å­˜çš„ï¼Œé€šè¿‡è®¾ç½®è¿™ä¸ªç­–ç•¥ï¼Œå¯ä»¥æ˜¾å¼ç¦ç”¨ç¼“å­˜ã€‚ ```lua set_policy(\"build.ccache\", false) ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘½ä»¤è¡Œå»ç¦ç”¨å®ƒã€‚ ```bash $ xmake f ccache n ``` æˆ–è€… ```bash $ xmake f policies build.ccache:n ``` ### build.warning é»˜è®¤ç¼–è¯‘é€šå¸¸ä¸ä¼šå®æ—¶å›æ˜¾è­¦å‘Šè¾“å‡ºï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ä½¿ç”¨ `xmake w` å¼€å¯ï¼Œæˆ–è€…é€šè¿‡ `xmake g build_warning y` æ¥å…¨å±€å¼€å¯å®ƒã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ xmake.lua é…ç½®ä¸­å»é»˜è®¤å¯ç”¨è­¦å‘Šå›æ˜¾è¾“å‡ºã€‚ ```lua set_policy(\"build.warning\", true) set_warnings(\"all\", \"extra\") ``` è¿™ä¸ªæ—¶å€™ï¼Œå³ä½¿æˆ‘ä»¬æ‰§è¡Œ `xmake` å‘½ä»¤ï¼Œä¹Ÿèƒ½ç›´æ¥å›æ˜¾è­¦å‘Šè¾“å‡ºã€‚ ### build.optimization.lto xmake æ”¹è¿›äº†å¯¹ LTO é“¾æ¥æ—¶ä¼˜åŒ–çš„æ”¯æŒï¼Œå¯¹ gcc/clang/msvc ç­‰ä¸åŒå¹³å°ä¸‹éƒ½è¿›è¡Œäº†é€‚é…ï¼Œåªéœ€è¦å¯ç”¨è¿™ä¸ªç­–ç•¥ï¼Œå°±èƒ½å¯¹ç‰¹å®š target å¼€å¯ LTOã€‚ ```lua set_policy(\"build.optimization.lto\", true) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œé€‰é¡¹å¿«é€Ÿå¼€å¯ã€‚ ```bash $ xmake f policies build.optimization.lto ``` ### build.cuda.devlink å¯ä»¥é€šè¿‡è¿™ä¸ªé…ç½®ï¼Œæ˜¾ç¤ºå¼€å¯å¯¹ç‰¹å®šç›®æ ‡çš„è®¾å¤‡é“¾æ¥ã€‚ è¿™é€šå¸¸ç”¨äº Cuda é¡¹ç›®çš„æ„å»ºï¼Œä»¥åŠé Cuda binary/shared ä¾èµ– Cuda static ç›®æ ‡çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒCuda static ç›®æ ‡å°±éœ€è¦æ˜¾ç¤ºé…ç½®è¿™ä¸ªï¼Œå¼€å¯è®¾å¤‡é“¾æ¥ã€‚ ```lua target(\"test\", function() set_kind(\"static\") set_policy(\"build.cuda.devlink\", true) end) ``` è€Œé»˜è®¤ Cuda binary/shared æ˜¯å¼€å¯ devlink çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç­–ç•¥æ˜¾ç¤ºç¦ç”¨å®ƒã€‚ å…³äºè¿™ä¸ªçš„è¯¦ç»†èƒŒæ™¯è¯´æ˜ï¼Œè§ï¼š[#1976](https://github.com/xmake io/xmake/issues/1976) ### build.sanitizer.address Address Sanitizerï¼ˆASanï¼‰æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„å†…å­˜é”™è¯¯æ£€æµ‹å·¥å…·ï¼Œç”±ç¼–è¯‘å™¨å†…ç½®æ”¯æŒï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦åœ¨ç¼–è¯‘å’Œé“¾æ¥çš„ flags ä¸­åŒæ—¶é…ç½® ` fsanitize address` æ‰èƒ½æ­£ç¡®å¼€å¯ã€‚ è€Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼€å¯è¿™ä¸ªç­–ç•¥ï¼Œå°±å¯ä»¥å¿«é€Ÿå…¨å±€å¯ç”¨å®ƒï¼Œè¿™ä¼šä½¿å¾—ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºï¼Œç›´æ¥æ”¯æŒ ASan æ£€æµ‹ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼å»å¯ç”¨ï¼š ```bash $ xmake f policies build.sanitizer.address ``` ä¹Ÿå¯ä»¥é€šè¿‡æ¥å£é…ç½®å»å…¨å±€å¯ç”¨ï¼š ```lua set_policy(\"build.sanitizer.address\", true) ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å•ç‹¬å¯¹æŸä¸ªç‰¹å®šçš„ target å»é…ç½®å¼€å¯ã€‚ å¦å¤–ï¼Œå¦‚æœå…¨å±€é…ç½®å®ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åŒæ—¶å¯¹æ‰€æœ‰ä¾èµ–åŒ…ä¹Ÿç”Ÿæ•ˆã€‚ ```lua set_policy(\"build.sanitizer.address\", true) add_requires(\"zlib\") add_requires(\"libpng\") ``` å®ƒç­‰ä»·äºï¼Œå¯¹æ¯ä¸ªåŒ…ä¾æ¬¡è®¾ç½® asan é…ç½®ã€‚ ```lua add_requires(\"zlib\", {configs {asan true}}) add_requires(\"libpng\", {configs {asan true}}) ``` > `add_rules(\"mode.asan\", \"mode.tsan\", \"mode.ubsan\", \"mode.msan\")` å°†è¢«åºŸå¼ƒï¼Œå°½å¯èƒ½ä½¿ç”¨è¿™äº›æ–°çš„ç­–ç•¥ï¼Œå› ä¸ºè¿™äº›æ„å»ºæ¨¡å¼æ— æ³•åŒæ­¥å¯¹ä¾èµ–åŒ…ç”Ÿæ•ˆã€‚ å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶ç”Ÿæ•ˆå¤šä¸ª sanitizer æ£€æµ‹ï¼Œä¾‹å¦‚ï¼š ```lua set_policy(\"build.sanitizer.address\", true) set_policy(\"build.sanitizer.undefined\", true) ``` æˆ–è€… ``` $ xmake f policies build.sanitizer.address,build.sanitizer.undefined ``` ### build.sanitizer.thread ä¸ [build.sanitizer.address](https://xmake.io/#/zh cn/guide/build_policies?id buildsanitizeraddress) ç±»ä¼¼ï¼Œç”¨äºæ£€æµ‹çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ ### build.sanitizer.memory ä¸ [build.sanitizer.address](https://xmake.io/#/zh cn/guide/build_policies?id buildsanitizeraddress) ç±»ä¼¼ï¼Œç”¨äºæ£€æµ‹å†…å­˜é—®é¢˜ã€‚ ### build.sanitizer.leak ä¸ [build.sanitizer.address](https://xmake.io/#/zh cn/guide/build_policies?id buildsanitizeraddress) ç±»ä¼¼ï¼Œç”¨äºæ£€æµ‹å†…å­˜æ³„æ¼é—®é¢˜ã€‚ ### build.sanitizer.undefined ä¸ [build.sanitizer.address](https://xmake.io/#/zh cn/guide/build_policies?id buildsanitizeraddress) ç±»ä¼¼ï¼Œç”¨äºæ£€æµ‹ undefined é—®é¢˜ã€‚ ### build.always_update_configfiles è¿™ä¸ªç­–ç•¥ç”¨äºå¯¹ `add_configfiles` é…ç½®æ–‡ä»¶çš„è‡ªåŠ¨ç”Ÿæˆè¡Œä¸ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œxmake ä»…ä»…åªä¼šåœ¨é¦–æ¬¡ `xmake config` æ—¶å€™ï¼Œæˆ–è€… xmake.lua é…ç½®æœ‰æ”¹åŠ¨çš„æ˜¯å¦ï¼Œæ‰ä¼šè§¦å‘ configfiles çš„é‡æ–°ç”Ÿæˆã€‚ ä¹‹åçš„æ¯æ¬¡æ„å»ºï¼Œåªè¦é…ç½®æ²¡æœ‰å˜åŒ–ï¼Œå°±ä¸ä¼šé‡æ–°ç”Ÿæˆ configfilesã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„ configfiles ä¸­æœ‰ä½¿ç”¨ GIT_COMMIT ç­‰å˜é‡ï¼Œæƒ³è¦æ¯æ¬¡æ„å»ºæ—¶å€™ï¼Œæ€»æ˜¯é‡æ–°ç”Ÿæˆæœ€æ–°çš„é…ç½®ï¼Œé‚£ä¹ˆå¯ä»¥é…ç½®å®ƒã€‚ å…·ä½“ä½¿ç”¨èƒŒæ™¯ï¼Œå¯ä»¥çœ‹ä¸‹ï¼š[#4747](https://github.com/xmake io/xmake/issues/4747) ### build.intermediate_directory é…ç½®å¯ç”¨æˆ–ç¦ç”¨æ„å»ºçš„å†…éƒ¨å­ç›®å½•ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ `xmake` ç¼–è¯‘é¡¹ç›®ä¼šè‡ªåŠ¨åœ¨ build ç›®å½•ä¸‹æ ¹æ®å¹³å°ã€‚æ¶æ„ï¼Œç¼–è¯‘æ¨¡å¼ç”Ÿæˆå­ç›®å½•ï¼Œåˆ†åˆ«å­˜å‚¨å¯¹è±¡æ–‡ä»¶ï¼Œç›®æ ‡æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š ```bash build/ â””â”€â”€ macosx â””â”€â”€ x86_64 â””â”€â”€ release â””â”€test ``` å¦‚æœé…ç½®ç¦ç”¨æ­¤ç­–ç•¥ï¼Œé‚£ä¹ˆç”Ÿæˆçš„äº§ç‰©å°†ä¼šç›´æ¥ç”Ÿæˆåˆ° build æ ¹ç›®å½•ä¸‹ã€‚å˜æˆï¼š ```bash build/ â””â”€ test ``` ### build.rpath é…ç½®å¯ç”¨æˆ–è€…ç¦ç”¨æ„å»ºæ—¶çš„ target rpath è®¾ç½®ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœ `target(foo)` ä¾èµ–åŠ¨æ€åº“ barï¼Œé‚£ä¹ˆç”Ÿæˆçš„ foo å¯æ‰§è¡Œæ–‡ä»¶ä¼šè‡ªåŠ¨åŠ ä¸Š bar çš„ rpathï¼Œè¿™èƒ½ä¿è¯ç”¨æˆ·ç›´æ¥æ‰§è¡Œ foo ç¨‹åºï¼Œä¹Ÿèƒ½æ­£ç¡®æ‰¾åˆ° barã€‚ å¦‚æœä½ æƒ³ç¦ç”¨è¿™ä¸ªè¡Œä¸ºï¼Œå¯ä»¥æ˜¾å¼é…ç½®ç¦ç”¨å®ƒã€‚ ### install.rpath å°½ç®¡æ„å»ºåçš„ç¨‹åºï¼Œä¼šè¢«è®¾ç½® rpathï¼Œä½†æ˜¯å½“ `xmake install` å®‰è£…åï¼Œå®ƒæ„å»ºæ—¶å€™çš„ rpath å°±ä¸ä¸€å®šå®Œå…¨é€‚ç”¨äº†ï¼Œå› æ­¤ xmake ä¼šè‡ªåŠ¨ä¿®æ”¹è°ƒæ•´ rpathï¼Œä½¿å¾—å®‰è£…åçš„ç¨‹åºï¼ŒåŒæ ·å¯ä»¥æ‰¾åˆ°å®ƒçš„ä¾èµ–åº“ã€‚ ä¸è¿‡å‰ææ˜¯ï¼Œç”¨æˆ·è‡ªå·±å…ˆå¾—é€šè¿‡ `add_rpathdirs(\"/xxx\", {installonly true})` å»é…ç½®ç‹¬ç«‹çš„å®‰è£… rpathã€‚ è€Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ª policy å»ç¦ç”¨é»˜è®¤çš„å®‰è£…é˜¶æ®µ rpath è®¾ç½®è¡Œä¸ºã€‚ ### run.autobuild è¿™ä¸ªç­–ç•¥ç”¨äºè°ƒæ•´ `xmake run` çš„è¡Œä¸ºï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ `xmake run` å¹¶ä¸ä¼šè‡ªåŠ¨æ„å»ºç›®æ ‡ç¨‹åºï¼Œå¦‚æœç¨‹åºè¿˜æ²¡è¢«ç¼–è¯‘ï¼Œå°±æ˜¯æç¤ºç”¨æˆ·æ‰‹åŠ¨æ„å»ºä¸€ä¸‹ã€‚ è€Œå¼€å¯è¿™ä¸ªç­–ç•¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿è¡Œç¨‹åºå‰ï¼Œå…ˆè‡ªåŠ¨æ„å»ºå¯¹åº”çš„ç›®æ ‡ç¨‹åºã€‚ ```bash $ xmake f policies run.autobuild $ xmake run ``` å¦‚æœæƒ³è¦å…¨å±€ç”Ÿæ•ˆè¿™ä¸ªç­–ç•¥ï¼Œå¯ä»¥å…¨å±€å¼€å¯å®ƒã€‚ ```bash $ xmake g policies run.autobuild ``` ### preprocessor.linemarkers é€šå¸¸ç”¨æˆ·ç¼–è¯‘ç¼“å­˜ä¸­ï¼Œé¢„å¤„ç†å™¨çš„ç”Ÿæˆç­–ç•¥ï¼Œé»˜è®¤å¼€å¯ï¼Œå¦‚æœé…ç½®å…³é—­è¿™ä¸ªç­–ç•¥ï¼Œé‚£ä¹ˆç¼“å­˜ç”Ÿæˆçš„é¢„å¤„ç†æ–‡ä»¶å†…å®¹å°†ä¸åŒ…å« linemarkers ä¿¡æ¯ï¼Œè¿™ä¼šæå¤§å‡å°‘é¢„å¤„ç†æ–‡ä»¶å¤§å°ã€‚ ä¹Ÿä¼šæå‡ç¼“å­˜çš„å¤„ç†æ•ˆç‡ï¼Œä½†æ˜¯ç¼ºç‚¹å°±æ˜¯ä¼šä¸¢å¤±æºç è¡Œä¿¡æ¯ï¼Œå¦‚æœé‡åˆ°ç¼–è¯‘é”™è¯¯ï¼Œå°†æ— æ³•çœ‹åˆ°å‡†ç¡®çš„å‡ºé”™ä»£ç è¡Œã€‚ ### preprocessor.gcc.directives_only è¿™ä¹Ÿæ˜¯ç”¨äºé¢„å¤„ç†å™¨çš„ç­–ç•¥ï¼Œé»˜è®¤å¼€å¯ï¼Œè¿™ä¼šæå‡ gcc ä¸‹ç¼–è¯‘ç¼“å­˜é¢„å¤„ç†çš„æ•ˆç‡ï¼Œä½†æ˜¯å¦‚æœæºæ–‡ä»¶ä¸­åŒ…å« `__DATE__`, `__TIME__` ç­‰å®ï¼Œå°±ä¼šå¯¼è‡´ç¼“å­˜å‡ºç°ä¸ä¸€è‡´ã€‚ å› æ­¤ï¼Œå¯ä»¥æ ¹æ®è‡ªèº«å·¥ç¨‹ä»£ç ï¼ŒæŒ‰éœ€å…³é—­æ­¤ç­–ç•¥ï¼Œç¡®ä¿ç”Ÿæˆçš„ç»“æœä¸€è‡´ã€‚ ### package.requires_lock å¯ç”¨äºå¼€å¯ `add_requires()` å¼•å…¥çš„ä¾èµ–åŒ…çš„ç‰ˆæœ¬é”å®šã€‚ å…·ä½“çœ‹ä¸‹ï¼š[ä¾èµ–åŒ…çš„é”å®šå’Œå‡çº§](https://xmake.io/#/zh cn/package/remote_package?id %e4%be%9d%e8%b5%96%e5%8c%85%e7%9a%84%e9%94%81%e5%ae%9a%e5%92%8c%e5%8d%87%e7%ba%a7) ### package.fetch_only å¦‚æœå¼€å¯è¿™ä¸ªç­–ç•¥ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ä¾èµ–åŒ…ä»…ä»…åªä¼šä»ç³»ç»Ÿè·å–ï¼Œä¸ä¼šä»è¿œç¨‹ä¸‹è½½å®‰è£…ã€‚ ### package.install_only å¦‚æœå¼€å¯è¿™ä¸ªç­–ç•¥ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ä¾èµ–åŒ…ä»…ä»…åªä¼šèµ°è¿œç¨‹ä¸‹è½½å®‰è£…ï¼Œä¸ä¼šä»ç³»ç»ŸæŸ¥æ‰¾è·å–ã€‚ ### package.librarydeps.strict_compatibility é»˜è®¤ç¦ç”¨ï¼Œå¦‚æœå¯ç”¨å®ƒï¼Œé‚£ä¹ˆå½“å‰åŒ…å’Œå®ƒçš„æ‰€æœ‰åº“ä¾èµ–åŒ…ä¹‹é—´ä¼šä¿æŒä¸¥æ ¼çš„å…¼å®¹æ€§ï¼Œä»»ä½•ä¾èµ–åŒ…çš„ç‰ˆæœ¬æ›´æ–°ï¼Œéƒ½ä¼šå¼ºåˆ¶è§¦å‘å½“å‰åŒ…çš„é‡æ–°ç¼–è¯‘å®‰è£…ã€‚ ä»¥ç¡®ä¿æ‰€æœ‰çš„åŒ…éƒ½æ˜¯äºŒè¿›åˆ¶å…¼å®¹çš„ï¼Œä¸ä¼šå› ä¸ºæŸä¸ªä¾èµ–åŒ…æ¥å£æ”¹åŠ¨ï¼Œå¯¼è‡´å’Œå…¶ä»–å·²è¢«å®‰è£…çš„å…¶ä»–åŒ…ä¸€èµ·é“¾æ¥æ—¶å€™ï¼Œå‘ç”Ÿé“¾æ¥å’Œè¿è¡Œé”™è¯¯ã€‚ ```lua package(\"foo\") add_deps(\"bar\", \"zoo\") set_policy(\"package.librarydeps.strict_compatibility\", true) ``` ä¾‹å¦‚ï¼Œå¦‚æœ bar æˆ–è€… zoo çš„ç‰ˆæœ¬æœ‰æ›´æ–°ï¼Œé‚£ä¹ˆ foo ä¹Ÿä¼šé‡æ–°ç¼–è¯‘å®‰è£…ã€‚ ### package.strict_compatibility é»˜è®¤ç¦ç”¨ï¼Œå¦‚æœå¯ç”¨å®ƒï¼Œé‚£ä¹ˆå½“å‰åŒ…å’Œå…¶ä»–æ‰€æœ‰ä¾èµ–å®ƒçš„åŒ…ä¹‹é—´ä¼šä¿æŒä¸¥æ ¼çš„å…¼å®¹æ€§ï¼Œè¿™ä¸ªåŒ…çš„ç‰ˆæœ¬æ›´æ–°ï¼Œéƒ½ä¼šå¼ºåˆ¶è§¦å‘å…¶ä»–çˆ¶åŒ…çš„é‡æ–°ç¼–è¯‘å®‰è£…ã€‚ ä»¥ç¡®ä¿æ‰€æœ‰çš„åŒ…éƒ½æ˜¯äºŒè¿›åˆ¶å…¼å®¹çš„ï¼Œä¸ä¼šå› ä¸ºæŸä¸ªä¾èµ–åŒ…æ¥å£æ”¹åŠ¨ï¼Œå¯¼è‡´å’Œå…¶ä»–å·²è¢«å®‰è£…çš„å…¶ä»–åŒ…ä¸€èµ·é“¾æ¥æ—¶å€™ï¼Œå‘ç”Ÿé“¾æ¥å’Œè¿è¡Œé”™è¯¯ã€‚ ```lua package(\"foo\", function() set_policy(\"package.strict_compatibility\", true) end) package(\"bar\", function() add_deps(\"foo\") end) package(\"zoo\", function() add_deps(\"foo\") end) ``` ä¾‹å¦‚ï¼Œå¦‚æœ foo çš„ç‰ˆæœ¬æœ‰æ›´æ–°ï¼Œé‚£ä¹ˆ bar å’Œ zoo éƒ½ä¼šè¢«å¼ºåˆ¶é‡æ–°ç¼–è¯‘å®‰è£…ã€‚ ### package.install_always æ¯æ¬¡è¿è¡Œ `xmake f c` é‡æ–°é…ç½®çš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼šé‡æ–°å®‰è£…åŒ…ï¼Œè¿™å¯¹äºæœ¬åœ°ç¬¬ä¸‰æ–¹æºç åŒ…é›†æˆæ—¶å€™æ¯”è¾ƒæœ‰ç”¨ã€‚ å› ä¸ºï¼Œç”¨æˆ·å¯èƒ½éšæ—¶éœ€è¦ä¿®æ”¹ç¬¬ä¸‰æ–¹æºç ï¼Œç„¶åé‡æ–°ç¼–è¯‘é›†æˆå®ƒä»¬ã€‚ ä¹‹å‰åªèƒ½é€šè¿‡æ¯æ¬¡ä¿®æ”¹åŒ…ç‰ˆæœ¬å·ï¼Œæ¥è§¦å‘é‡æ–°ç¼–è¯‘ï¼Œä½†æ˜¯æœ‰äº†è¿™ä¸ªç­–ç•¥ï¼Œå°±èƒ½æ¯æ¬¡éƒ½ä¼šè§¦å‘é‡ç¼–ã€‚ ```lua add_rules(\"mode.debug\", \"mode.release\") package(\"foo\", function() add_deps(\"cmake\") set_sourcedir(path.join(os.scriptdir(), \"foo\")) set_policy(\"package.install_always\", true) on_install(function (package) local configs {} table.insert(configs, \" DCMAKE_BUILD_TYPE \" .. (package:debug() and \"Debug\" or \"Release\")) table.insert(configs, \" DBUILD_SHARED_LIBS \" .. (package:config(\"shared\") and \"ON\" or \"OFF\")) import(\"package.tools.cmake\").install(package, configs) end) on_test(function (package) assert(package:has_cfuncs(\"add\", {includes \"foo.h\"})) end) end) add_requires(\"foo\") target(\"demo\", function() set_kind(\"binary\") add_files(\"src/main.c\") add_packages(\"foo\") end) ``` ### package.download.http_headers è®¾ç½®åŒ…ä¸‹è½½çš„ http headers å¦‚æœæœ‰äº›åŒ…çš„ url ä¸‹è½½ï¼Œéœ€è¦è®¾ç½®ç‰¹å®š http headersï¼Œæ‰èƒ½é€šè¿‡ä¸‹è½½ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªç­–ç•¥æ¥æŒ‡å®šã€‚ ```lua package(\"xxx\") set_policy(\"package.download.http_headers\", \"TEST1: foo\", \"TEST2: bar\") ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®æŒ‡å®šçš„ urls çš„ http headersï¼š ```lua add_urls(\"https://github.com/madler/zlib/archive/$(version).tar.gz\", { http_headers {\"TEST1: foo\", \"TEST2: bar\"} }) ```"},"/get_started/zh/tutorial/project-examples.html":{"title":"å·¥ç¨‹ä¾‹å­","content":"# å·¥ç¨‹ä¾‹å­ ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„å·¥ç¨‹ä¾‹å­ï¼Œæ›´å¤šçš„ examples å¯ä»¥åˆ° [project examples](https://github.com/TOMO CAT/xmake/tree/master/tests/projects) ä¸­æŸ¥çœ‹ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `xmake create` å‘½ä»¤åˆ›å»ºå„ç§å¸¸ç”¨çš„ç©ºå·¥ç¨‹æ¥å¿«é€Ÿå¼€å§‹ï¼Œå…·ä½“å¯¹äºè¿™ä¸ªå‘½ä»¤çš„ä»‹ç»ä»¥åŠæ”¯æŒçš„å·¥ç¨‹æ¨¡æ¿å¯ä»¥æ•²ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š ```bash xmake create help ``` ## å¯æ‰§è¡Œç¨‹åº ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*c\") end) ``` å®Œæ•´ä¾‹å­è¯·æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºï¼š ```bash xmake create l c t console test ``` ## é™æ€åº“ç¨‹åº ```lua target(\"library\", function() set_kind(\"static\") add_files(\"src/library/*.c\") end) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*c\") add_deps(\"library\") end) ``` é€šè¿‡ `add_deps` å°†ä¸€ä¸ªé™æ€åº“è‡ªåŠ¨é“¾æ¥åˆ° test å¯æ‰§è¡Œç¨‹åºã€‚ å®Œæ•´ä¾‹å­è¯·æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºï¼š ```bash xmake create l c t static test ``` ## åŠ¨æ€åº“ç¨‹åº ```lua target(\"library\", function() set_kind(\"shared\") add_files(\"src/library/*.c\") end) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*c\") add_deps(\"library\") end) ``` é€šè¿‡ `add_deps` å°†ä¸€ä¸ªåŠ¨æ€åº“è‡ªåŠ¨é“¾æ¥åˆ° test å¯æ‰§è¡Œç¨‹åºã€‚ å®Œæ•´ä¾‹å­è¯·æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºï¼š ```bash xmake create l c t shared test ``` ## Wasm ç¨‹åº æ‰€æœ‰ c/c++ ç¨‹åºï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç¼–è¯‘æˆ Wasmï¼Œæ— éœ€ä»»ä½• xmake.lua é…ç½®æ”¹åŠ¨ï¼Œåªéœ€è¦åˆ‡æ¢åˆ° wasm ç¼–è¯‘å¹³å°è¿›è¡Œç¼–è¯‘ã€‚ ```bash $ xmake f p wasm $ xmake ``` è¯¦ç»†çš„ Wasm ç¼–è¯‘é…ç½®è§ï¼š[Wasm é…ç½®](/zh cn/guide/configuration?id wasm) å¦å¤–ï¼Œåœ¨ç¼–è¯‘å¸¦æœ‰ ` preload file assets/xxx.md` è®¾ç½®çš„æ–‡ä»¶æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®ï¼Œç®€åŒ–å¯¹å®ƒçš„è®¾ç½®ã€‚ ```lua target(\"test5\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") add_values(\"wasm.preloadfiles\", \"src/xxx.md\") add_values(\"wasm.preloadfiles\", \"src/xxx2.md\") end) ``` ## Qt ç¨‹åº åˆ›å»ºä¸€ä¸ªç©ºå·¥ç¨‹ï¼š ```bash $ xmake create t qt.console test $ xmake create t qt.static test $ xmake create t qt.shared test $ xmake create t qt.quickapp test $ xmake create t qt.widgetapp test ``` æ›´å¤šå·¥ç¨‹æ¨¡æ¿è§ï¼š`xmake create help`ã€‚ é»˜è®¤ä¼šè‡ªåŠ¨æ¢æµ‹ Qt ç¯å¢ƒï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®š Qt SDK ç¯å¢ƒç›®å½•ï¼š ```bash $ xmake f qt ~/Qt/Qt5.9.1 ``` ä¸Šè¿°æŒ‡å®šçš„ MingW SDK ç”¨çš„æ˜¯ Qt ä¸‹ Tools ç›®å½•è‡ªå¸¦çš„ç¯å¢ƒï¼Œå½“ç„¶å¦‚æœæœ‰å…¶ä»–ç¬¬ä¸‰æ–¹ MingW ç¼–è¯‘ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š, å…·ä½“å¯ä»¥å‚è€ƒï¼š[MingW ç¼–è¯‘é…ç½®](/zh cn/guide/configuration?id mingw)ã€‚ æ›´å¤šè¯¦æƒ…å¯ä»¥å‚è€ƒï¼š[#160](https://github.com/xmake io/xmake/issues/160) å¦å¤–ï¼Œå½“å‰ xmake ä¹Ÿæ”¯æŒ Qt/Wasmï¼Œè¯¦æƒ…è§ï¼š[Wasm é…ç½®](/zh cn/guide/configuration?id wasm) ```bash $ xmake f p wasm ``` ### é™æ€åº“ç¨‹åº ```lua target(\"qt_static_library\", function() add_rules(\"qt.static\") add_files(\"src/*.cpp\") add_frameworks(\"QtNetwork\", \"QtGui\") end) ``` ### åŠ¨æ€åº“ç¨‹åº ```lua target(\"qt_shared_library\", function() add_rules(\"qt.shared\") add_files(\"src/*.cpp\") add_frameworks(\"QtNetwork\", \"QtGui\") end) ``` ### æ§åˆ¶å°ç¨‹åº ```lua target(\"qt_console\", function() add_rules(\"qt.console\") add_files(\"src/*.cpp\") end) ``` ### Quick åº”ç”¨ç¨‹åº ```lua target(\"qt_quickapp\", function() add_rules(\"qt.quickapp\") add_files(\"src/*.cpp\") add_files(\"src/qml.qrc\") end) ``` > å¦‚æœä½¿ç”¨çš„è‡ªå·±ç¼–è¯‘çš„ static ç‰ˆæœ¬ QT SDKï¼Œé‚£ä¹ˆéœ€è¦åˆ‡æ¢åˆ° `add_rules(\"qt.quickapp_static\")` é™æ€è§„åˆ™æ‰è¡Œï¼Œå› ä¸ºé“¾æ¥çš„åº“æ˜¯ä¸åŒçš„ï¼Œéœ€è¦åšé™æ€é“¾æ¥ã€‚ ### Quick Plugin ç¨‹åº å®Œæ•´ä¾‹å­è§ï¼š[quickplugin example](https://github.com/xmake io/xmake/tree/master/tests/projects/qt/quickplugin) ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"demo\", function() add_rules(\"qt.qmlplugin\") add_headerfiles(\"src/*.h\") add_files(\"src/*.cpp\") set_values(\"qt.qmlplugin.import_name\", \"My.Plugin\") end) ``` ### Widgets åº”ç”¨ç¨‹åº ```lua target(\"qt_widgetapp\", function() add_rules(\"qt.widgetapp\") add_files(\"src/*.cpp\") add_files(\"src/mainwindow.ui\") add_files(\"src/mainwindow.h\") æ·»åŠ å¸¦æœ‰ Q_OBJECT çš„metaå¤´æ–‡ä»¶ end) ``` ### Android åº”ç”¨ç¨‹åº å¯ä»¥ç›´æ¥åˆ‡åˆ° android å¹³å°ç¼–è¯‘ Quick/Widgets åº”ç”¨ç¨‹åºï¼Œç”Ÿæˆ apk åŒ…ï¼Œå¹¶ä¸”å¯é€šè¿‡ `xmake install` å‘½ä»¤å®‰è£…åˆ°è®¾å¤‡ï¼š ```bash $ xmake create t quickapp_qt l c++ appdemo $ cd appdemo $ xmake f p android ndk ~/Downloads/android ndk r19c/ android_sdk ~/Library/Android/sdk/ c $ xmake [ 0%]: compiling.qt.qrc src/qml.qrc [ 50%]: cache compiling.release src/main.cpp [100%]: linking.release libappdemo.so [100%]: generating.qt.app appdemo.apk ``` ç„¶åå®‰è£…åˆ°è®¾å¤‡ï¼š ```bash $ xmake install installing appdemo ... installing build/android/release/appdemo.apk .. Success install ok!ğŸ‘Œ ``` ### ç›®å‰æ”¯æŒçš„ Qt SDK #### æ¥è‡ª Qt å®˜æ–¹æä¾›çš„ SDK å®‰è£…åŒ… åœ¨ macos ä¸Šé€šå¸¸èƒ½è‡ªåŠ¨æ¢æµ‹åˆ°ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š Qt SDK è·¯å¾„ã€‚ ```bash $ xmake f qt [qt sdk path] ``` #### æ¥è‡ª Ubuntu Apt å®‰è£…åŒ… ä½¿ç”¨ apt å®‰è£…å®Œ Qt SDKï¼Œxmake ä¹Ÿèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹åˆ°ã€‚ ```bash $ sudo apt install y qtcreator qtbase5 dev $ xmake ``` #### æ¥è‡ª msys2/pacman çš„ Qt Mingw å®‰è£…åŒ… xmake ä¹Ÿæ”¯æŒä» pacman å®‰è£…çš„ Qt Mingw SDK ```bash $ pacman S mingw w64 x86_64 qt5 mingw w64 x86_64 qt creator $ xmake ``` #### æ¥è‡ª aqtinstall è„šæœ¬çš„ Qt SDK åŒ… [aqtinstall](https://github.com/miurahr/aqtinstall) å®‰è£…çš„ Qt SDK æ˜¯å®Œå…¨åŸºäºå®˜æ–¹ SDK ç»“æ„çš„ï¼Œæ‰€ä»¥ xmake ä¹Ÿå®Œå…¨æ”¯æŒã€‚ ä½†æ˜¯ï¼Œé€šå¸¸éœ€è¦è‡ªå·±æŒ‡å®š SDK è·¯å¾„ã€‚ ```bash $ xmake f qt [Qt SDK] ``` #### è·¨å¹³å° Qt äº¤å‰ç¼–è¯‘ å¯¹äºè·¨å¹³å° Qt å¼€å‘ï¼Œxmake æ”¯æŒä¸ºä¸»æœºå·¥å…·å’Œç›®æ ‡å¹³å°ä½¿ç”¨å•ç‹¬çš„ SDKã€‚è¿™åœ¨ä¸ºä¸åŒäºå¼€å‘æœºå™¨çš„å¹³å°æ„å»º Qt åº”ç”¨ç¨‹åºæ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚ ` qt_host` é€‰é¡¹å…è®¸æ‚¨æŒ‡å®šä¸æ„å»ºæœºå™¨å…¼å®¹çš„ Qt å·¥å…·çš„ä½ç½®ï¼Œè€Œ ` qt` æŒ‡å‘ç›®æ ‡å¹³å°çš„ SDKï¼š ```bash $ xmake f qt [target Qt sdk] qt_host [host Qt sdk] ``` **é‡è¦æ³¨æ„äº‹é¡¹**ï¼š * ç¡®ä¿ä¸»æœºå’Œç›®æ ‡ Qt ç‰ˆæœ¬åŒ¹é…ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´æ„å»ºé—®é¢˜ã€‚ * æœ¬æœºéƒ¨ç½²å·¥å…·ï¼ˆå¦‚ `windeployqt` å’Œ `macdeployqt`ï¼‰å¿…é¡»åœ¨å„è‡ªçš„å¹³å°ä¸Šè¿è¡Œï¼Œå› æ­¤è·¨å¹³å°ä»»åŠ¡ï¼ˆå¦‚ `xmake install`ï¼‰å¯èƒ½ä¼šå¤±è´¥ã€‚ #### æ¥è‡ª xmake repo ä»“åº“çš„ Qt åŒ… xmake ç°åœ¨å®˜æ–¹æä¾›äº† Qt5 SDK çš„å„ç§æ¨¡å—åŒ…ï¼Œå¯ä»¥è‡ªåŠ¨é›†æˆä½¿ç”¨ï¼Œæ— éœ€ä»»ä½•æ‰‹åŠ¨å®‰è£…ã€‚ åªéœ€è¦é…ç½®é›†æˆåŒ…å°±è¡Œäº†ï¼Œxmake ä¼šè‡ªåŠ¨å¤„ç† Qt çš„å®‰è£…é›†æˆï¼Œå¹¶ä¸”è‡ªåŠ¨ç¼–è¯‘é¡¹ç›®ã€‚ ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"qt5widgets\") target(\"test\", function() add_rules(\"qt.widgetapp\") add_packages(\"qt5widgets\") add_headerfiles(\"src/*.h\") add_files(\"src/*.cpp\") add_files(\"src/mainwindow.ui\") add files with Q_OBJECT meta (only for qt.moc) add_files(\"src/mainwindow.h\") end) ``` é™¤äº† `qt5widgets` åŒ…ï¼Œä»“åº“è¿˜æä¾›äº† `qt5gui`, `qt5network` ç­‰åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ã€‚ é…ç½®å®Œï¼Œåªéœ€è¦æ‰§è¡Œï¼š ```bash $ xmake ``` #### æ¥è‡ª vcpkg/conan çš„ Qt åŒ… æš‚æ—¶è¿˜æ²¡æ—¶é—´æ”¯æŒï¼Œè¯·å°½é‡ä½¿ç”¨ä¸Šé¢çš„æ–¹å¼é›†æˆ Qt SDKã€‚ ## umdf é©±åŠ¨ç¨‹åº ```lua target(\"echo\", function() add_rules(\"wdk.driver\", \"wdk.env.umdf\") add_files(\"driver/*.c\") add_files(\"driver/*.inx\") add_includedirs(\"exe\") end) target(\"app\", function() add_rules(\"wdk.binary\", \"wdk.env.umdf\") add_files(\"exe/*.cpp\") end) ``` ### wdm é©±åŠ¨ç¨‹åº ```lua target(\"kcs\", function() add_rules(\"wdk.driver\", \"wdk.env.wdm\") add_values(\"wdk.man.flags\", \" prefix Kcs\") add_values(\"wdk.man.resource\", \"kcsCounters.rc\") add_values(\"wdk.man.header\", \"kcsCounters.h\") add_values(\"wdk.man.counter_header\", \"kcsCounters_counters.h\") add_files(\"*.c\", \"*.rc\", \"*.man\") end) ``` ```lua target(\"msdsm\", function() add_rules(\"wdk.driver\", \"wdk.env.wdm\") add_values(\"wdk.tracewpp.flags\", \" func:TracePrint((LEVEL,FLAGS,MSG,...))\") add_files(\"*.c\", {rule \"wdk.tracewpp\"}) add_files(\"*.rc\", \"*.inf\") add_files(\"*.mofmsdsm.mof\") add_files(\"msdsm.mof\", {values {wdk_mof_header \"msdsmwmi.h\"}}) end) ``` ### ç”Ÿæˆé©±åŠ¨åŒ… å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ .cab é©±åŠ¨åŒ…ï¼š ```bash $ xmake [ppackage] $ xmake [ppackage] o outputdir ``` è¾“å‡ºçš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š ``` drivers sampledsm debug/x86/sampledsm.cab release/x64/sampledsm.cab debug/x86/sampledsm.cab release/x64/sampledsm.cab ``` ### é©±åŠ¨ç­¾å é»˜è®¤ç¼–è¯‘ç¦ç”¨ç­¾åï¼Œå¯ä»¥é€šè¿‡ `set_values(\"wdk.sign.mode\", ...)` è®¾ç½®ç­¾åæ¨¡å¼æ¥å¯ç”¨ç­¾åã€‚ #### æµ‹è¯•ç­¾å æµ‹è¯•ç­¾åä¸€èˆ¬æœ¬æœºè°ƒè¯•æ—¶å€™ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ xmake è‡ªå¸¦çš„ test è¯ä¹¦æ¥è¿›è¡Œç­¾åï¼Œä¾‹å¦‚ï¼š ```lua target(\"msdsm\", function() add_rules(\"wdk.driver\", \"wdk.env.wdm\") set_values(\"wdk.sign.mode\", \"test\") end) ``` ä¸è¿‡è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œæ‰§è¡Œä¸€éï¼š`$xmake l utils.wdk.testcert install`ï¼Œæ¥ç”Ÿæˆå’Œæ³¨å†Œ test è¯ä¹¦åˆ°æœ¬æœºç¯å¢ƒã€‚ è¿™ä¸ªåªéœ€è¦æ‰§è¡Œä¸€æ¬¡å°±è¡Œäº†ï¼Œåç»­å°±å¯ä»¥æ­£å¸¸ç¼–è¯‘å’Œç­¾åäº†ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬æœºå·²æœ‰çš„æœ‰æ•ˆè¯ä¹¦å»ç­¾åã€‚ ä» sha1 æ¥é€‰æ‹©åˆé€‚çš„è¯ä¹¦è¿›è¡Œç­¾åï¼š ```lua target(\"msdsm\", function() add_rules(\"wdk.driver\", \"wdk.env.wdm\") set_values(\"wdk.sign.mode\", \"test\") set_values(\"wdk.sign.thumbprint\", \"032122545DCAA6167B1ADBE5F7FDF07AE2234AAA\") end) ``` ä» store/company æ¥é€‰æ‹©åˆé€‚çš„è¯ä¹¦è¿›è¡Œç­¾åï¼š ```lua target(\"msdsm\", function() add_rules(\"wdk.driver\", \"wdk.env.wdm\") set_values(\"wdk.sign.mode\", \"test\") set_values(\"wdk.sign.store\", \"PrivateCertStore\") set_values(\"wdk.sign.company\", \"tboox.org(test)\") end) ``` #### æ­£å¼ç­¾å é€šè¿‡æŒ‡å®šå¯¹åº”çš„æ­£å¼ç­¾åè¯ä¹¦æ–‡ä»¶è¿›è¡Œç­¾åï¼š ```lua target(\"msdsm\", function() add_rules(\"wdk.driver\", \"wdk.env.wdm\") set_values(\"wdk.sign.mode\", \"release\") set_values(\"wdk.sign.company\", \"xxxx\") set_values(\"wdk.sign.certfile\", path.join(os.projectdir(), \"xxxx.cer\")) end) ``` ### ç”Ÿæˆä½ç‰ˆæœ¬é©±åŠ¨ å¦‚æœæƒ³åœ¨ wdk10 ç¯å¢ƒç¼–è¯‘ç”Ÿæˆ win7, win8 ç­‰ä½ç‰ˆæœ¬ç³»ç»Ÿæ”¯æŒçš„é©±åŠ¨ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® `wdk.env.winver` æ¥åˆ‡æ¢ç³»ç»Ÿç‰ˆæœ¬ï¼š ```lua set_values(\"wdk.env.winver\", \"win10\") set_values(\"wdk.env.winver\", \"win10_rs3\") set_values(\"wdk.env.winver\", \"win81\") set_values(\"wdk.env.winver\", \"win8\") set_values(\"wdk.env.winver\", \"win7\") set_values(\"wdk.env.winver\", \"win7_sp1\") set_values(\"wdk.env.winver\", \"win7_sp2\") set_values(\"wdk.env.winver\", \"win7_sp3\") ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šç¼–è¯‘çš„ç›®æ ‡ç¨‹åºæ”¯æŒçš„ windows ç‰ˆæœ¬ï¼š ```bash $ xmake f wdk_winver [win10_rs3win8win7win7_sp1] $ xmake ``` ## iOS/MacOS ç¨‹åº ### App åº”ç”¨ç¨‹åº ç”¨äºç”Ÿæˆ `*.app/*.ipa` åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶æ”¯æŒ iOS/MacOSã€‚ ```lua target(\"test\", function() add_rules(\"xcode.application\") add_files(\"src/*.m\", \"src/**.storyboard\", \"src/*.xcassets\") add_files(\"src/Info.plist\") end) ``` > å¯ä»¥æ”¯æŒç›´æ¥æ·»åŠ  `*.metal` æ–‡ä»¶ï¼Œxmake ä¼šè‡ªåŠ¨ç”Ÿæˆ default.metallib æä¾›ç»™åº”ç”¨ç¨‹åºåŠ è½½ä½¿ç”¨ã€‚ #### åˆ›å»ºå·¥ç¨‹ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¨¡æ¿å·¥ç¨‹å¿«é€Ÿåˆ›å»ºï¼š ```bash $ xmake create t xcode.macapp l objc test $ xmake create t xcode.iosapp l objc test ``` #### ç¼–è¯‘ ```bash $ xmake f p [iphoneosmacosx] $ xmake [ 18%]: compiling.xcode.release src/Assets.xcassets [ 27%]: processing.xcode.release src/Info.plist [ 72%]: compiling.xcode.release src/Base.lproj/Main.storyboard [ 81%]: compiling.xcode.release src/Base.lproj/LaunchScreen.storyboard [ 45%]: cache compiling.release src/ViewController.m [ 63%]: cache compiling.release src/AppDelegate.m [ 54%]: cache compiling.release src/SceneDelegate.m [ 36%]: cache compiling.release src/main.m [ 90%]: linking.release test [100%]: generating.xcode.release test.app [100%]: build ok! ``` #### é…ç½®ç­¾å å¯¹äº iOS ç¨‹åºï¼Œé»˜è®¤ä¼šæ£€æµ‹ç³»ç»Ÿå…ˆç”¨å¯ç”¨ç­¾åæ¥ç­¾å appï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šå…¶ä»–ç­¾åè¯ä¹¦ï¼š ```bash $ xmake f p iphoneos xcode_codesign_identity 'Apple Development: xxx@gmail.com (T3NA4MRVPU)' xcode_mobile_provision 'iOS Team Provisioning Profile: org.tboox.test xcode_bundle_identifier org.tboox.test' $ xmake ``` å¦‚æœæ¯æ¬¡è¿™ä¹ˆé…ç½®ç­¾åè§‰å¾—ç¹ççš„è¯ï¼Œå¯ä»¥è®¾ç½®åˆ° `xmake global` å…¨å±€é…ç½®ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨ xmake.lua ä¸­å¯¹æ¯ä¸ª target å•ç‹¬è®¾ç½®ï¼š ```lua target(\"test\", function() add_rules(\"xcode.application\") add_files(\"src/*.m\", \"src/**.storyboard\", \"src/*.xcassets\") add_files(\"src/Info.plist\") add_values(\"xcode.bundle_identifier\", \"org.tboox.test\") add_values(\"xcode.codesign_identity\", \"Apple Development: xxx@gmail.com (T3NA4MRVPU)\") add_values(\"xcode.mobile_provision\", \"iOS Team Provisioning Profile: org.tboox.test\") end) ``` é‚£å¦‚ä½•çŸ¥é“æˆ‘ä»¬éœ€è¦çš„ç­¾åé…ç½®å‘¢ï¼Ÿä¸€ç§å°±æ˜¯åœ¨ xcode é‡Œé¢æŸ¥çœ‹ï¼Œå¦å¤– xmake ä¹Ÿæä¾›äº†ä¸€äº›è¾…åŠ©å·¥å…·å¯ä»¥ dump å‡ºå½“å‰å¯ç”¨çš„æ‰€æœ‰ç­¾åé…ç½®ï¼š ```bash $ xmake l private.tools.codesign.dump codesign identities { \"Apple Development: waruqi@gmail.com (T3NA4MRVPU)\" \"AF73C231A0C35335B72761BD3759694739D34EB1\" } mobile provisions { \"iOS Team Provisioning Profile: org.xmake.test\" \"<?xml version \"1.0\" encoding \"UTF 8\"?> <!DOCTYPE plist PUBLIC \" //Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList 1.0.dtd\"> <plist version \"1.0\"> <dict> \t<key>AppIDName</key> \t<string>XC org xmake test5</string> \t<key>ApplicationIdentifierPrefix</key> \t<array> \t<string>43AAQM58X3</string> ... ``` æˆ‘ä»¬ä¹Ÿæä¾›äº†å…¶ä»–è¾…åŠ©å·¥å…·æ¥å¯¹å·²æœ‰çš„ ipa/app ç¨‹åºè¿›è¡Œé‡ç­¾åï¼Œä¾‹å¦‚ï¼š ```bash $ xmake l utils.ipa.resign test.ipatest.app [codesign_identity] [mobile_provision] [bundle_identifier] ``` å…¶ä¸­ï¼Œåé¢çš„ç­¾åå‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæ²¡è®¾ç½®ï¼Œé‚£ä¹ˆé»˜è®¤ä¼šæ¢æµ‹ä½¿ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„ç­¾åï¼š ```bash $ xmake l utils.ipa.resign test.ipa $ xmake l utils.ipa.resign test.app \"Apple Development: cat@gmail.com (T3NA4MRVPU)\" $ xmake l utils.ipa.resign test.ipa \"Apple Development: cat@gmail.com (T3NA4MRVPU)\" iOS Team Provisioning Profile: org.xmake.test\" org.xmake.test ``` #### è¿è¡Œåº”ç”¨ç¨‹åº ç›®å‰ä»…æ”¯æŒè¿è¡Œmacosç¨‹åºï¼š ```bash $ xmake run ``` æ•ˆæœå¦‚ä¸‹ï¼š ![](/assets/img/guide/macapp.png) #### ç”Ÿæˆç¨‹åºåŒ… å¦‚æœæ˜¯ iOS ç¨‹åºä¼šç”Ÿæˆ ipa å®‰è£…åŒ…ï¼Œå¦‚æœæ˜¯ macos ä¼šç”Ÿæˆ dmg ï¼ˆdmg åŒ…ç”Ÿæˆæš‚æ—¶è¿˜åœ¨å¼€å‘ä¸­ï¼‰ã€‚ ```bash $ xmake package output: build/iphoneos/release/arm64/test.ipa package ok! ``` æˆ‘ä»¬ä¹Ÿæä¾›äº†è¾…åŠ©å·¥å…·ï¼Œæ¥å¯¹æŒ‡å®š app ç¨‹åºè¿›è¡Œæ‰“åŒ…ï¼š ```bash $ xmake l utils.ipa.package test.app output.ipa [iconfile.png] ``` #### å®‰è£… å¦‚æœæ˜¯ iOS ç¨‹åºä¼šå®‰è£… ipa åˆ°è®¾å¤‡ï¼Œå¦‚æœæ˜¯ macos ä¼šå®‰è£… app åˆ° /Applications ç›®å½•ã€‚ ```bash $ xmake install ``` æˆ‘ä»¬ä¹Ÿæä¾›äº†è¾…åŠ©å·¥å…·ï¼Œæ¥å¯¹æŒ‡å®šipa/appç¨‹åºå®‰è£…åˆ°è®¾å¤‡ï¼š ```bash $ xmake l utils.ipa.install test.app $ xmake l utils.ipa.install test.ipa ``` #### å¸è½½ > ç›®å‰ä»…æ”¯æŒ macos ç¨‹åºå¸è½½ ```bash $ xmake uninstall ``` ### Framework åº“ç¨‹åº ```lua target(\"test\", function() add_rules(\"xcode.framework\") add_files(\"src/*.m\") add_files(\"src/Info.plist\") end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¨¡æ¿å·¥ç¨‹å¿«é€Ÿåˆ›å»ºï¼š ```bash $ xmake create t xcode.framework l objc test ``` å¦å¤–ï¼Œxmake è¿˜æä¾›äº†å¸¦æœ‰ framework åº“ä½¿ç”¨çš„å®Œæ•´ iosapp/macapp ç©ºå·¥ç¨‹æ¨¡æ¿ï¼Œå¯ä»¥å®Œæ•´ä½“éªŒ framework çš„ç¼–è¯‘ï¼Œä¾èµ–ä½¿ç”¨ä»¥åŠé›†æˆåˆ° app åº”ç”¨ç¨‹åºä¸­ã€‚ åŒæ—¶ï¼Œå¦‚æœæˆ‘ä»¬å¼€å¯äº†æ¨¡æ‹Ÿå™¨ï¼Œxmake å¯ä»¥æ”¯æŒç›´æ¥ `xmake install` å’Œ `xmake run` å°† app å®‰è£…åˆ°æ¨¡æ‹Ÿå™¨å¹¶åŠ è½½è¿è¡Œã€‚ ```bash $ xmake create t xcode.iosapp_with_framework l objc testapp $ cd testapp $ xmake f p iphoneos a x86_64 $ xmake $ xmake install $ xmake run ``` ### Bundleç¨‹åº ```lua target(\"test\", function() add_rules(\"xcode.bundle\") add_files(\"src/*.m\") add_files(\"src/Info.plist\") end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¨¡æ¿å·¥ç¨‹å¿«é€Ÿåˆ›å»ºï¼š ```bash $ xmake create t xcode.bundle l objc test ``` ## Protobufç¨‹åº ### ä½¿ç”¨cåº“ ```lua add_requires(\"protobuf c\") target(\"console_c\", function() set_kind(\"binary\") add_packages(\"protobuf c\") add_rules(\"protobuf.c\") add_files(\"src/*.c\") add_files(\"src/*.proto\") end) ``` æˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½® `proto_public true` æ¥å¯¼å‡º proto çš„å¤´æ–‡ä»¶æœç´¢ç›®å½•ï¼Œå¼€æ”¾ç»™å…¶ä»–çˆ¶ target ç»§æ‰¿ä½¿ç”¨ã€‚ ```lua add_packages(\"protobuf c\", {public true}) add_files(\"src/**.proto\", {proto_public true}) ``` æ³¨ï¼šç”±äº protobuf ç”Ÿæˆçš„å¤´æ–‡ä»¶å¼•ç”¨äº† protobuf c åŒ…çš„å¤´æ–‡ä»¶ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†åŒ…çš„å¤´æ–‡ä»¶æ ‡è®°ä¸º `{public true}` å¯¹å¤–å¯¼å‡ºå®ƒã€‚ ### ä½¿ç”¨c++åº“ ```lua add_requires(\"protobuf cpp\") target(\"console_c++\", function() set_kind(\"binary\") set_languages(\"c++11\") add_packages(\"protobuf cpp\") add_rules(\"protobuf.cpp\") add_files(\"src/*.cpp\") add_files(\"src/*.proto\") end) ``` æˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½® `proto_public true` æ¥å¯¼å‡º proto çš„å¤´æ–‡ä»¶æœç´¢ç›®å½•ï¼Œå¼€æ”¾ç»™å…¶ä»–çˆ¶ target ç»§æ‰¿ä½¿ç”¨ã€‚ ```lua add_packages(\"protobuf cpp\", {public true}) add_files(\"src/**.proto\", {proto_public true}) ``` æ³¨ï¼šç”±äº protobuf ç”Ÿæˆçš„å¤´æ–‡ä»¶å¼•ç”¨äº† protobuf cpp åŒ…çš„å¤´æ–‡ä»¶ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†åŒ…çš„å¤´æ–‡ä»¶æ ‡è®°ä¸º `{public true}` å¯¹å¤–å¯¼å‡ºå®ƒã€‚ ## Cudaç¨‹åº åˆ›å»ºä¸€ä¸ªç©ºå·¥ç¨‹ï¼š ```bash $ xmake create P test l cuda $ cd test $ xmake ``` ```lua define target target(\"cuda_console\", function() set_kind(\"binary\") add_files(\"src/*.cu\") generate SASS code for SM architecture of current host add_cugencodes(\"native\") generate PTX code for the virtual architecture to guarantee compatibility add_cugencodes(\"compute_30\") end) ``` > é»˜è®¤æ„å»ºä¼šå¯ç”¨ device linkã€‚ï¼ˆå‚è§ [Separate Compilation and Linking of CUDA C++ Device Code](https://devblogs.nvidia.com/separate compilation linking cuda device code/)ï¼‰ å¦‚æœè¦æ˜¾å¼ç¦ç”¨ device linkï¼Œå¯ä»¥é€šè¿‡ `set_policy(\"build.cuda.devlink\", false)` æ¥è®¾ç½®ã€‚ > cuda æºæ–‡ä»¶ä¸­çš„ device å‡½æ•°éœ€è¦è¢« device link ä¸”åª device link ä¸€æ¬¡ã€‚åœ¨ `shared` æˆ– `binary` çš„ target ä¸Š xmake ä¼šè‡ªåŠ¨è¿›è¡Œ device link ï¼Œè¿™æ—¶å®ƒä»¬ä¾èµ–çš„ `static` target ä¹Ÿä¼šåŒæ—¶è¢« device link ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ `static` target ä¸ä¼šè¢« device linkã€‚ç„¶è€Œï¼Œå¦‚æœæœ€ç»ˆçš„ `shared` æˆ– `binary` çš„ target ä¸åŒ…å«ä»»ä½• cuda æºæ–‡ä»¶ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿ device link é˜¶æ®µï¼Œå¯¼è‡´å‡ºç° undefined reference é”™è¯¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦æ‰‹åŠ¨ä¸º `static` target æŒ‡å®š `add_values(\"cuda.build.devlink\", true)`. é»˜è®¤ä¼šè‡ªåŠ¨æ¢æµ‹ cuda ç¯å¢ƒï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®š Cuda SDK ç¯å¢ƒç›®å½•ï¼Œæˆ–è€…æŒ‡å®š cuda ç‰ˆæœ¬ï¼ˆæ­¤æ—¶å°†åœ¨é»˜è®¤å®‰è£…ç›®å½•è¿›è¡ŒæŸ¥æ‰¾ï¼‰ï¼š ```bash $ xmake f cuda /usr/local/cuda 9.1/ $ xmake f cuda 9.1 $ xmake ``` æ›´å¤šè¯¦æƒ…å¯ä»¥å‚è€ƒï¼š[#158](https://github.com/xmake io/xmake/issues/158) ## Lex & Yaccç¨‹åº ```lua target(\"calc\", function() set_kind(\"binary\") add_rules(\"lex\", \"yacc\") add_files(\"src/*.l\", \"src/*.y\") end) ``` ## OpenMP ç¨‹åº æˆ‘ä»¬ä¸éœ€è¦é¢å¤–é…ç½® rulesï¼Œä»…ä»…é€šè¿‡ä¸€ä¸ªé€šç”¨çš„ openmp åŒ…å°±å¯ä»¥å®ç°ç›¸åŒçš„æ•ˆæœã€‚ ```lua add_requires(\"openmp\") target(\"loop\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") add_packages(\"openmp\") end) ``` ## Fortran ç¨‹åº æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œå¿«é€Ÿåˆ›å»ºä¸€ä¸ªåŸºäº fortran çš„ç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l fortran t console test ``` å®ƒçš„xmake.luaå†…å®¹å¦‚ä¸‹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.f90\") end) ``` æ›´å¤šä»£ç ä¾‹å­å¯ä»¥åˆ°è¿™é‡ŒæŸ¥çœ‹ï¼š[Fortran Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/fortran) ## Go ç¨‹åº xmake ä¹Ÿæ”¯æŒ go ç¨‹åºçš„æ„å»ºï¼Œä¹Ÿæä¾›äº†ç©ºå·¥ç¨‹çš„åˆ›å»ºå‘½ä»¤æ”¯æŒ: ```bash $ xmake create l go t console test ``` xmake.lua å†…å®¹å¦‚ä¸‹: ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.go\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[Go Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/go) ## Dlang ç¨‹åº åˆ›å»ºç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l dlang t console test ``` xmake.lua å†…å®¹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.d\") end) ``` xmake ä¹Ÿæä¾›å¯¹ dub åŒ…ç®¡ç†çš„æ”¯æŒï¼Œå¯ä»¥å¿«é€Ÿé›†æˆ dlang çš„ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"dub::log 0.4.3\", {alias \"log\"}) add_requires(\"dub::dateparser\", {alias \"dateparser\"}) add_requires(\"dub::emsi_containers\", {alias \"emsi_containers\"}) add_requires(\"dub::stdx allocator\", {alias \"stdx allocator\"}) add_requires(\"dub::mir core\", {alias \"mir core\"}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.d\") add_packages(\"log\", \"dateparser\", \"emsi_containers\", \"stdx allocator\", \"mir core\") end) ``` ä¸è¿‡è¿˜æœ‰ä¸€äº›ä¸å®Œå–„çš„åœ°æ–¹ï¼Œæ¯”å¦‚ç›®å‰å¿…é¡»æ‰‹åŠ¨é…ç½®æ‰€æœ‰çº§è”ä¾èµ–åŒ…ï¼Œä¼šç¨å¾®ç¹çäº›ï¼Œåç»­æœ‰å¾…æ”¹è¿›ã€‚ æ›´å¤šä¾‹å­è§ï¼š[Dlang Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/dlang) ## Rustç¨‹åº åˆ›å»ºç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l rust t console test ``` xmake.lua å†…å®¹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/main.rs\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[Rust Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/rust) ### æ·»åŠ  Cargo åŒ…ä¾èµ– ä¾‹å­: https://github.com/xmake io/xmake/tree/dev/tests/projects/rust/cargo_deps ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"cargo::base64 0.13.0\") add_requires(\"cargo::flate2 1.0.17\", {configs {features \"zlib\"}}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/main.rs\") add_packages(\"cargo::base64\", \"cargo::flate2\") end) ``` ### é›†æˆ Cargo.toml çš„ä¾èµ–åŒ… ä¸Šé¢ç›´æ¥ä½¿ç”¨ `add_requires(\"cargo::base64 0.13.0\")` çš„æ–¹å¼é›†æˆä¾èµ–ï¼Œä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼š å¦‚æœä¾èµ–å¾ˆå¤šï¼Œå¹¶ä¸”æœ‰å‡ ä¸ªä¾èµ–éƒ½å…±åŒä¾èµ–äº†ç›¸åŒçš„å­ä¾èµ–ï¼Œé‚£ä¹ˆä¼šå‡ºç°é‡å®šä¹‰é—®é¢˜ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬ä½¿ç”¨å®Œæ•´çš„ Cargo.toml å»ç®¡ç†ä¾èµ–å°±ä¸ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚ ä¾‹å¦‚ï¼š ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"cargo::test\", {configs {cargo_toml path.join(os.projectdir(), \"Cargo.toml\")}}) target(\"test\") set_kind(\"binary\") add_files(\"src/main.rs\") add_packages(\"cargo::test\") ``` å®Œæ•´ä¾‹å­è§ï¼š[cargo_deps_with_toml](https://github.com/xmake io/xmake/blob/dev/tests/projects/rust/cargo_deps_with_toml/xmake.lua) ### ä½¿ç”¨ cxxbridge åœ¨ c++ ä¸­è°ƒç”¨ rust ä¾‹å­: <https://github.com/xmake io/xmake/tree/dev/tests/projects/rust/cxx_call_rust_library> ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"cargo::cxx 1.0\") target(\"foo\", function() set_kind(\"static\") add_files(\"src/foo.rs\") set_values(\"rust.cratetype\", \"staticlib\") add_packages(\"cargo::cxx\") end) target(\"test\", function() set_kind(\"binary\") add_rules(\"rust.cxxbridge\") add_deps(\"foo\") add_files(\"src/main.cc\") add_files(\"src/bridge.rsx\") end) ``` foo.rs ```rust #[cxx::bridge] mod foo { extern \"Rust\" { fn add(a: i32, b: i32) > i32; } } pub fn add(a: i32, b: i32) > i32 { return a + b; } ``` æˆ‘ä»¬è¿˜éœ€è¦åœ¨ c++ é¡¹ç›®ä¸­æ·»åŠ æ¡¥æ¥æ–‡ä»¶ bridge.rsx ```rust #[cxx::bridge] mod foo { extern \"Rust\" { fn add(a: i32, b: i32) > i32; } } ``` main.cc ```c++ #include <stdio.h> #include \"bridge.rs.h\" int main(int argc, char** argv) { printf(\"add(1, 2) %d\\n\", add(1, 2)); return 0; } ``` ### åœ¨ Rust ä¸­è°ƒç”¨ C++ ä¾‹å­: <https://github.com/xmake io/xmake/tree/dev/tests/projects/rust/rust_call_cxx_library> ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"foo\", function() set_kind(\"static\") add_files(\"src/foo.cc\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"foo\") add_files(\"src/main.rs\") end) ``` main.rs ```rust extern \"C\" { \tfn add(a: i32, b: i32) > i32; } fn main() { unsafe { \t println!(\"add(1, 2) {}\", add(1, 2)); } } ``` foo.cc ```c++ extern \"C\" int add(int a, int b) { return a + b; } ``` ## Swift ç¨‹åº åˆ›å»ºç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l swift t console test ``` xmake.luaå†…å®¹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.swift\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[Swift Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/swift) ## Objc ç¨‹åº åˆ›å»ºç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l objc t console test ``` xmake.lua å†…å®¹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.m\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[Objc Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/objc++) ## Objc ç¨‹åº åˆ›å»ºç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l objc t console test ``` xmake.lua å†…å®¹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.m\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[Objc Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/objc++) ## Zig ç¨‹åº åˆ›å»ºç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l zig t console test ``` xmake.lua å†…å®¹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.zig\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[Zig Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/zig) ## Linux Bpf ç¨‹åº xmake æ”¯æŒ bpf ç¨‹åºæ„å»ºï¼ŒåŒæ—¶æ”¯æŒ linux ä»¥åŠ android å¹³å°ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ‹‰å– llvm å’Œ android ndk å·¥å…·é“¾ã€‚ æ›´å¤šè¯¦æƒ…è§ï¼š[#1274](https://github.com/xmake io/xmake/issues/1274) ```lua add_rules(\"mode.release\", \"mode.debug\") add_rules(\"platform.linux.bpf\") add_requires(\"linux tools\", {configs {bpftool true}}) add_requires(\"libbpf\") if is_plat(\"android\") then add_requires(\"ndk > 22.x\") set_toolchains(\"@ndk\", {sdkver \"23\"}) else add_requires(\"llvm > 10.x\") set_toolchains(\"@llvm\") add_requires(\"linux headers\") end target(\"minimal\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"linux tools\", \"linux headers\", \"libbpf\") set_license(\"GPL 2.0\") end) ``` ## Vala ç¨‹åº xmake æ”¯æŒæ„å»º Vala ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦åº”ç”¨ `add_rules(\"vala\")` è§„åˆ™ï¼Œå¹¶ä¸” glib åŒ…æ˜¯å¿…é¡»çš„ã€‚ ç›¸å…³ issues: [#1618](https://github.com/xmake io/xmake/issues/1618) `add_values(\"vala.packages\")` ç”¨äºå‘Šè¯‰ valacï¼Œé¡¹ç›®éœ€è¦å“ªäº›åŒ…ï¼Œå®ƒä¼šå¼•å…¥ç›¸å…³åŒ…çš„ vala apiï¼Œä½†æ˜¯åŒ…çš„ä¾èµ–é›†æˆï¼Œè¿˜æ˜¯éœ€è¦é€šè¿‡ `add_requires(\"lua\")` ä¸‹è½½é›†æˆã€‚ ### æ§åˆ¶å°ç¨‹åº ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"lua\", \"glib\") target(\"test\", function() set_kind(\"binary\") add_rules(\"vala\") add_files(\"src/*.vala\") add_packages(\"lua\", \"glib\") add_values(\"vala.packages\", \"lua\") end) ``` ### é™æ€åº“ç¨‹åº æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ `add_values(\"vala.header\", \"mymath.h\")` è®¾ç½®å¯¼å‡ºçš„æ¥å£å¤´æ–‡ä»¶åï¼Œé€šè¿‡ `add_values(\"vala.vapi\", \"mymath 1.0.vapi\")` è®¾ç½®å¯¼å‡ºçš„ vapi æ–‡ä»¶åã€‚ ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"glib\") target(\"mymath\", function() set_kind(\"static\") add_rules(\"vala\") add_files(\"src/mymath.vala\") add_values(\"vala.header\", \"mymath.h\") add_values(\"vala.vapi\", \"mymath 1.0.vapi\") add_packages(\"glib\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"mymath\") add_rules(\"vala\") add_files(\"src/main.vala\") add_packages(\"glib\") end) ``` ### åŠ¨æ€åº“ç¨‹åº ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"glib\") target(\"mymath\", function() set_kind(\"shared\") add_rules(\"vala\") add_files(\"src/mymath.vala\") add_values(\"vala.header\", \"mymath.h\") add_values(\"vala.vapi\", \"mymath 1.0.vapi\") add_packages(\"glib\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"mymath\") add_rules(\"vala\") add_files(\"src/main.vala\") add_packages(\"glib\") end) ``` æ›´å¤šä¾‹å­ï¼š[Vala examples](https://github.com/xmake io/xmake/tree/master/tests/projects/vala) ## Pascal ç¨‹åº æˆ‘ä»¬èƒ½å¤Ÿæ”¯æŒæ„å»º Pascal ç¨‹åºï¼Œç›¸å…³ issues è§ï¼š[#388](https://github.com/xmake io/xmake/issues/388) ### æ§åˆ¶å°ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.pas\") end) ``` ### åŠ¨æ€åº“ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"foo\", function() set_kind(\"shared\") add_files(\"src/foo.pas\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"foo\") add_files(\"src/main.pas\") end) ``` æ›´å¤šä¾‹å­ï¼š[Pascal examples](https://github.com/xmake io/xmake/tree/master/tests/projects/pascal) ## Swig æ¨¡å— xmake æ”¯æŒæ„å»º Swig æ¨¡å—ï¼Œæˆ‘ä»¬æä¾›äº† `swig.c` å’Œ `swig.cpp` è§„åˆ™ï¼Œåˆ†åˆ«å¯¹åº”æ”¯æŒç”Ÿæˆ c/c++ æ¨¡å—æ¥å£ä»£ç ï¼Œé…åˆ xmake çš„åŒ…ç®¡ç†ç³»ç»Ÿå®ç°å®Œå…¨è‡ªåŠ¨åŒ–çš„æ¨¡å—å’Œä¾èµ–åŒ…æ•´åˆã€‚ ç›¸å…³ issues: [#1622](https://github.com/xmake io/xmake/issues/1622) ### Lua/C æ¨¡å— ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"lua\") target(\"example\", function() add_rules(\"swig.c\", {moduletype \"lua\"}) add_files(\"src/example.i\", {swigflags \" no old metatable bindings\"}) add_files(\"src/example.c\") add_packages(\"lua\") end) ``` ### Python/C æ¨¡å— ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"python 3.x\") target(\"example\", function() add_rules(\"swig.c\", {moduletype \"python\"}) add_files(\"src/example.i\", {scriptdir \"share\"}) add_files(\"src/example.c\") add_packages(\"python\") end) ``` ### Python/C++ æ¨¡å— ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"python 3.x\") target(\"example\", function() add_rules(\"swig.cpp\", {moduletype \"python\"}) add_files(\"src/example.i\", {scriptdir \"share\"}) add_files(\"src/example.cpp\") add_packages(\"python\") end) ``` ### Java/C æ¨¡å— [å®Œæ•´ä¾‹å­](https://github.com/xmake io/xmake/blob/dev/tests/projects/swig/java_c) ```lua make sure you config to an enviroment with jni.h for example: xmake f c p android target(\"example\", function() set_kind('shared') set moduletype to java add_rules(\"swig.c\", {moduletype \"java\"}) test jar build add_rules(\"swig.c\", {moduletype \"java\" , buildjar true}) use swigflags to provider package name and output path of java files add_files(\"src/example.i\", {swigflags { \" package\", \"com.example\", \" outdir\", \"build/java/com/example/\" }}) add_files(\"src/example.c\") add_includedirs(\"src\") before_build(function() ensure output path exists before running swig os.mkdir(\"build/java/com/example/\") end) end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½® ```lua add_rules(\"swig.c\", {moduletype \"java\", buildjar true}) ``` å»åŒæ—¶æ„å»º jar åŒ…ï¼Œæ–¹ä¾¿ç›´æ¥ä½¿ç”¨ã€‚ ## C++20 æ¨¡å— ### å¿«é€Ÿå¼€å§‹ xmake é‡‡ç”¨ `.mpp` ä½œä¸ºé»˜è®¤çš„æ¨¡å—æ‰©å±•åï¼Œä½†æ˜¯ä¹ŸåŒæ—¶æ”¯æŒ `.ixx`, `.cppm`, `.mxx` ç­‰æ‰©å±•åã€‚ ç›®å‰ xmake å·²ç»å®Œæ•´æ”¯æŒ gcc11/clang/msvc çš„ C++20 Modules æ„å»ºæ”¯æŒï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨åˆ†ææ¨¡å—é—´çš„ä¾èµ–å…³ç³»ï¼Œå®ç°æœ€å¤§åŒ–å¹¶è¡Œç¼–è¯‘ã€‚ ```lua set_languages(\"c++20\") target(\"class\", function() set_kind(\"binary\") add_files(\"src/*.cpp\", \"src/*.mpp\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[C++ Modules](https://github.com/xmake io/xmake/tree/master/tests/projects/c%2B%2B/modules) ### Cpp Only å·¥ç¨‹ xmake å¯¹ C++20 æ¨¡å—çš„å®ç°è¿›è¡Œäº†é‡æ„å’Œå‡çº§ï¼Œæ–°å¢äº†å¯¹ Headerunits çš„æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¨¡å—ä¸­å¼•å…¥ Stl å’Œ ç”¨æˆ·å¤´æ–‡ä»¶æ¨¡å—ã€‚ ç›¸å…³çš„è¡¥ä¸è§ï¼š[#2641](https://github.com/xmake io/xmake/pull/2641)ã€‚ æ³¨ï¼šé€šå¸¸æˆ‘ä»¬è‡³å°‘éœ€è¦æ·»åŠ ä¸€ä¸ª `.mpp` æ–‡ä»¶ï¼Œæ‰èƒ½å¼€å¯ C++20 modules ç¼–è¯‘ï¼Œå¦‚æœåªæœ‰ cpp æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ä¸ä¼šå¼€å¯æ¨¡å—ç¼–è¯‘çš„ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä»…ä»…åªæ˜¯æƒ³åœ¨ cpp æ–‡ä»¶ä¸­ä½¿ç”¨æ¨¡å—çš„ Headerunits ç‰¹æ€§ï¼Œæ¯”å¦‚å¼•å…¥ä¸€äº› stl Headerunits åœ¨ cpp ä¸­ä½¿ç”¨ï¼Œ é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½® `set_policy(\"build.c++.modules\", true)` æ¥å¼ºè¡Œå¼€å¯ C++ Modules ç¼–è¯‘ï¼Œä¾‹å¦‚ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") set_languages(\"c++20\") set_policy(\"build.c++.modules\", true) end) ``` ### æ¨¡å—çš„åˆ†å‘å’Œé›†æˆ #### åˆ†å‘ C++ Modules åŒ… æˆ‘ä»¬å…ˆä½¿ç”¨ xmake.lua ç»´æŠ¤æ¨¡å—çš„æ„å»ºï¼Œå¹¶é€šè¿‡æŒ‡å®š `{install true}`ï¼Œæ¥å‘Šè¯‰ xmake å“ªäº›æ¨¡å—æ–‡ä»¶éœ€è¦å®‰è£…å¯¹å¤–åˆ†å‘ã€‚ ```lua add_rules(\"mode.release\", \"mode.debug\") set_languages(\"c++20\") target(\"foo\", function() set_kind(\"static\") add_files(\"*.cpp\") add_files(\"*.mpp\", { install true }) end) ``` ç„¶åï¼Œæˆ‘ä»¬æŠŠå®ƒåšæˆåŒ…ï¼Œå¯ä»¥æäº¤åˆ° [xmake repo](https://github.com/xmake io/xmake repo) ä»“åº“ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åšæˆæœ¬åœ°åŒ…ï¼Œæˆ–è€…ç§æœ‰ä»“åº“åŒ…ã€‚ è¿™é‡Œï¼Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•éªŒè¯ï¼Œæˆ‘ä»¬ä»…ä»…é€šè¿‡ `set_sourcedir` å°†å®ƒåšæˆæœ¬åœ°åŒ…ã€‚ ```lua package(\"foo\", function() set_sourcedir(path.join(os.scriptdir(), \"src\")) on_install(function(package) import(\"package.tools.xmake\").install(package, {}) end) end) ``` #### é›†æˆ C++ Modules åŒ… ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ `add_requires(\"foo\")` çš„åŒ…é›†æˆæ¥å£ï¼Œå¯¹ C++ Modules åŒ…è¿›è¡Œå¿«é€Ÿé›†æˆä½¿ç”¨ã€‚ ç”±äº foo çš„æ¨¡å—åŒ…ï¼Œæˆ‘ä»¬æ”¾åœ¨ç§æœ‰ä»“åº“ä¸­å®šä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ `add_repositories(\"my repo my repo\")` å¼•å…¥è‡ªå·±çš„åŒ…ä»“åº“ã€‚ å¦‚æœï¼ŒåŒ…å·²ç»æäº¤åˆ° xmake repo å®˜æ–¹ä»“åº“ï¼Œå°±ä¸éœ€è¦é¢å¤–é…ç½®å®ƒã€‚ ```lua add_rules(\"mode.release\", \"mode.debug\") set_languages(\"c++20\") add_repositories(\"my repo my repo\") add_requires(\"foo\", \"bar\") target(\"packages\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") add_packages(\"foo\", \"bar\") set_policy(\"build.c++.modules\", true) end) ``` é›†æˆå¥½åŒ…åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œ `xmake` å‘½ä»¤ï¼Œä¸€é”®ä¸‹è½½ã€ç¼–è¯‘ã€é›†æˆ C++ Modules åŒ…æ¥ä½¿ç”¨ã€‚ ```bash $ xmake checking for platform ... linux checking for architecture ... x86_64 note: install or modify (m) these packages (pass y to skip confirm)? in my repo: > foo latest > bar latest please input: y (y/n/m) > install bar latest .. ok > install foo latest .. ok [ 0%]: generating.module.deps src/main.cpp [ 0%]: generating.module.deps /mnt/xmake/tests/projects/c++/modules/packages/build/.packages/b/bar/latest/4e0143c97b65425b855ad5fd03038b6a/modules/bar/bar.mpp [ 0%]: generating.module.deps /mnt/xmake/tests/projects/c++/modules/packages/build/.packages/f/foo/latest/4e0143c97b65425b855ad5fd03038b6a/modules/foo/foo.mpp [ 14%]: compiling.module.release bar [ 14%]: compiling.module.release foo [ 57%]: compiling.release src/main.cpp [ 71%]: linking.release packages [100%]: build ok! ``` æ³¨ï¼šæ¯ä¸ªåŒ…å®‰è£…åï¼Œä¼šåœ¨åŒ…è·¯å¾„ä¸‹ï¼Œå­˜å‚¨ç»´æŠ¤æ¨¡å—çš„ meta info æ–‡ä»¶ï¼Œè¿™æ˜¯ `p2473r1.pdf` ä¸­çº¦å®šçš„ä¸€ç§æ ¼å¼è§„èŒƒï¼Œä¹Ÿè®¸å®ƒä¸æ˜¯æœ€ç»ˆçš„æ ‡å‡†ï¼Œä½†è¿™å¹¶ä¸å½±å“æˆ‘ä»¬ç°åœ¨å»ä½¿ç”¨æ¨¡å—çš„åˆ†å‘ã€‚ ```bash $ cat ./build/.packages/f/foo/latest/4e0143c97b65425b855ad5fd03038b6a/modules/foo/foo.mpp.meta info {\"_VENDOR_extension\":{\"xmake\":{\"name\":\"foo\",\"file\":\"foo.mpp\"}},\"definitions\":{},\"include_paths\":{}} ``` å®Œæ•´çš„ä¾‹å­å·¥ç¨‹è§ï¼š[C++ Modules åŒ…åˆ†å‘ä¾‹å­å·¥ç¨‹](https://github.com/xmake io/xmake/tree/master/tests/projects/c%2B%2B/modules/packages) ### æ”¯æŒ C++23 Std Modules [Arthapz](https://github.com/Arthapz) ä¹Ÿå¸®å¿™æ”¹è¿›äº†å¯¹ C++23 Std Modules çš„æ”¯æŒã€‚ ç›®å‰ä¸‰ä¸ªç¼–è¯‘å™¨å¯¹å®ƒçš„æ”¯æŒè¿›å±•ï¼š #### Clang ç›®å‰æœ€æ–°çš„ clang ä¼¼ä¹ä¹Ÿè¿˜æ²¡å®Œå…¨æ”¯æŒ C++23 std modulesï¼Œå½“å‰è¿˜æ˜¯ draft patch çŠ¶æ€ï¼Œ[#D135507](https://reviews.llvm.org/D135507)ã€‚ ä½†æ˜¯ï¼ŒXmake ä¹Ÿå¯¹å®ƒè¿›è¡Œäº†æ”¯æŒï¼Œå¦‚æœå¤§å®¶æƒ³è¦å°é²œï¼Œå¯ä»¥è‡ªè¡Œåˆå…¥è¿™ä¸ª patchï¼Œç„¶åä½¿ç”¨ xmake æ¥æµ‹è¯•ã€‚ å¦å¤–ï¼Œä½ç‰ˆæœ¬çš„ clang ä¹Ÿæœ‰å¯¹éæ ‡å‡†çš„ std modules åšäº†å®éªŒæ€§æ”¯æŒã€‚ æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥åœ¨ä½ç‰ˆæœ¬ clang ä¸­å°è¯•æ€§ä½¿ç”¨ xmake æ¥æ„å»º std modulesï¼Œå°½ç®¡å®ƒå¯èƒ½è¿˜åªæ˜¯ä¸ªç©å…·ï¼ˆä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼‰ã€‚ ç›¸å…³è®¨è®ºè§ï¼š[#3255](https://github.com/xmake io/xmake/pull/3255) #### Gcc ç›®å‰è¿˜ä¸æ”¯æŒã€‚ ## åˆå¹¶é™æ€åº“ ### è‡ªåŠ¨åˆå¹¶ target åº“ æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® `build.merge_archive` ç­–ç•¥ï¼Œå¯ç”¨è‡ªåŠ¨åˆå¹¶ä¾èµ–çš„æ‰€æœ‰é™æ€åº“ï¼Œä¾‹å¦‚ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"add\", function() set_kind(\"static\") add_files(\"src/add.c\") add_files(\"src/subdir/add.c\") end) target(\"sub\", function() set_kind(\"static\") add_files(\"src/sub.c\") add_files(\"src/subdir/sub.c\") end) target(\"mul\", function() set_kind(\"static\") add_deps(\"add\", \"sub\") add_files(\"src/mul.c\") set_policy(\"build.merge_archive\", true) end) ``` mul é™æ€åº“è‡ªåŠ¨åˆå¹¶äº† add å’Œ sub é™æ€åº“ï¼Œç”Ÿæˆä¸€ä¸ªåŒ…å« add/sub ä»£ç çš„å®Œæ•´ libmul.a åº“ã€‚ è¿™ä¸ªåˆå¹¶ç›¸å¯¹æ¯”è¾ƒç¨³å®šå®Œå–„ï¼Œæ”¯æŒ ar å’Œ msvc/lib.exeï¼Œä¹Ÿæ”¯æŒäº¤å‰ç¼–è¯‘å·¥å…·é“¾ç”Ÿæˆçš„é™æ€åº“åˆå¹¶ï¼Œä¹Ÿæ”¯æŒå¸¦æœ‰é‡å obj æ–‡ä»¶çš„é™æ€åº“ã€‚ ### åˆå¹¶æŒ‡å®šçš„é™æ€åº“æ–‡ä»¶ å¦‚æœè‡ªåŠ¨åˆå¹¶ä¸æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸»åŠ¨è°ƒç”¨ `utils.archive.merge_archive` æ¨¡å—åœ¨ `after_link` é˜¶æ®µåˆå¹¶æŒ‡å®šçš„é™æ€åº“åˆ—è¡¨ã€‚ ```lua target(\"test\", function() after_link(function (target) import(\"utils.archive.merge_staticlib\") merge_staticlib(target, \"libout.a\", {\"libfoo.a\", \"libbar.a\"}) end) end) ``` ### ä½¿ç”¨ add_files åˆå¹¶é™æ€åº“ å…¶å®ï¼Œæˆ‘ä»¬ä¹‹å‰çš„ç‰ˆæœ¬å·²ç»æ”¯æŒé€šè¿‡ `add_files(\"*.a\")` æ¥åˆå¹¶é™æ€åº“ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"*.a\") add_files(\"*.c\") end) ``` ä½†æ˜¯å®ƒæœ‰ä¸€äº›ç¼ºé™·ï¼šå¦‚æœä½¿ç”¨ arï¼Œå¯èƒ½ä¼šå­˜åœ¨ .obj å¯¹è±¡æ–‡ä»¶åŒåå†²çªå¯¼è‡´åˆå¹¶å¤±è´¥ï¼Œå› æ­¤æ¨èä½¿ç”¨ä¸Šæ–‡ä»‹ç»çš„åˆå¹¶æ–¹å¼ï¼Œæ›´åŠ çš„ç¨³å®šå¯é ï¼Œä¹Ÿæ›´åŠ çš„ç®€å•ã€‚ ç›¸å…³ issues: [#1638](https://github.com/xmake io/xmake/issues/1638) ## Nim ç¨‹åº xmake æ”¯æŒ Nimlang é¡¹ç›®ï¼Œç›¸å…³ issues è§ï¼š[#1756](https://github.com/xmake io/xmake/issues/1756) ### åˆ›å»ºç©ºå·¥ç¨‹ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `xmake create` å‘½ä»¤åˆ›å»ºç©ºå·¥ç¨‹ã€‚ ```bash xmake create l nim t console test xmake create l nim t static test xmake create l nim t shared test ``` ### æ§åˆ¶å°ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/main.nim\") end) ``` ```bash $ xmake v [ 33%]: linking.release test /usr/local/bin/nim c opt:speed nimcache:build/.gens/test/macosx/x86_64/release/nimcache o:b uild/macosx/x86_64/release/test src/main.nim [100%]: build ok! ``` ### é™æ€åº“ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"foo\", function() set_kind(\"static\") add_files(\"src/foo.nim\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"foo\") add_files(\"src/main.nim\") end) ``` ```bash $ xmake v [ 33%]: linking.release libfoo.a /usr/local/bin/nim c opt:speed nimcache:build/.gens/foo/macosx/x86_64/release/nimcache app :staticlib noMain passC: DNimMain NimMain_B6D5BD02 passC: DNimMainInner NimMainInner_B6D5B D02 passC: DNimMainModule NimMainModule_B6D5BD02 passC: DPreMain PreMain_B6D5BD02 passC: D PreMainInner PreMainInner_B6D5BD02 o:build/macosx/x86_64/release/libfoo.a src/foo.nim [ 66%]: linking.release test /usr/local/bin/nim c opt:speed nimcache:build/.gens/test/macosx/x86_64/release/nimcache pa ssL: Lbuild/macosx/x86_64/release passL: lfoo o:build/macosx/x86_64/release/test src/main.nim [100%]: build ok! ``` ### åŠ¨æ€åº“ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"foo\", function() set_kind(\"shared\") add_files(\"src/foo.nim\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"foo\") add_files(\"src/main.nim\") end) ``` ```bash $ xmake rv [ 33%]: linking.release libfoo.dylib /usr/local/bin/nim c opt:speed nimcache:build/.gens/foo/macosx/x86_64/release/nimcache app :lib noMain o:build/macosx/x86_64/release/libfoo.dylib src/foo.nim [ 66%]: linking.release test /usr/local/bin/nim c opt:speed nimcache:build/.gens/test/macosx/x86_64/release/nimcache pa ssL: Lbuild/macosx/x86_64/release passL: lfoo o:build/macosx/x86_64/release/test src/main.nim [100%]: build ok! ``` ### C ä»£ç æ··åˆç¼–è¯‘ ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"foo\", function() set_kind(\"static\") add_files(\"src/*.c\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"foo\") add_files(\"src/main.nim\") end) ``` ### Nimble ä¾èµ–åŒ…é›†æˆ å®Œæ•´ä¾‹å­è§ï¼š[Nimble Package Example](https://github.com/xmake io/xmake/tree/dev/tests/projects/nim/nimble_package) ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"nimble::zip >0.3\") target(\"test, function() set_kind(\"binary\") add_files(\"src/main.nim\") add_packages(\"nimble::zip\") end) ``` main.nim ```nim import zip/zlib echo zlibVersion() ``` ### Native ä¾èµ–åŒ…é›†æˆ å®Œæ•´ä¾‹å­è§ï¼š[Native Package Example](https://github.com/xmake io/xmake/tree/dev/tests/projects/nim/native_package) ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"zlib\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/main.nim\") add_packages(\"zlib\") end) ``` main.nim ```nim proc zlibVersion(): cstring {.cdecl, importc} echo zlibVersion() ``` ## Keil/MDK åµŒå…¥å¼ç¨‹åº ç›¸å…³ä¾‹å­å·¥ç¨‹ï¼š[Example](https://github.com/xmake io/xmake/tree/dev/tests/projects/embed/mdk/hello) xmake ä¼šè‡ªåŠ¨æ¢æµ‹ Keil/MDK å®‰è£…çš„ç¼–è¯‘å™¨ï¼Œç›¸å…³ issues [#1753](https://github.com/xmake io/xmake/issues/1753)ã€‚ ä½¿ç”¨ armcc ç¼–è¯‘ ```bash $ xmake f p cross a cortex m3 toolchain armcc c $ xmake ``` ä½¿ç”¨ armclang ç¼–è¯‘ ```bash $ xmake f p cross a cortex m3 toolchain armclang c $ xmake ``` ### å¯æ‰§è¡Œç¨‹åº ```lua target(\"hello\", function() add_deps(\"foo\") add_rules(\"mdk.binary\") add_files(\"src/*.c\", \"src/*.s\") add_includedirs(\"src/lib/cmsis\") set_runtimes(\"microlib\") end) ``` éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›®å‰ä¸€äº› mdk ç¨‹åºéƒ½ä½¿ç”¨äº† microlib åº“è¿è¡Œæ—¶ï¼Œå®ƒéœ€è¦ç¼–è¯‘å™¨åŠ ä¸Š `__MICROLIB` å®å®šä¹‰ï¼Œé“¾æ¥å™¨åŠ ä¸Š ` library_type microlib` ç­‰å„ç§é…ç½®ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ `set_runtimes(\"microlib\")` ç›´æ¥è®¾ç½®åˆ° microlib è¿è¡Œæ—¶åº“ï¼Œå¯ä»¥è‡ªåŠ¨è®¾ç½®ä¸Šæ‰€æœ‰ç›¸å…³é€‰é¡¹ã€‚ ### é™æ€åº“ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"foo\", function() add_rules(\"mdk.static\") add_files(\"src/foo/*.c\") set_runtimes(\"microlib\") end) ``` ## Keil/C51 åµŒå…¥å¼ç¨‹åº ### å¯æ‰§è¡Œç¨‹åº ```lua target(\"hello\", function() add_rules(\"c51.binary\") set_toolchains(\"c51\") add_files(\"src/main.c\") end) ``` ## Lua æ¨¡å— å‚è€ƒ <https://github.com/xmake io/luarocks build xmake> å¦‚æœä½ çš„ lua æ¨¡å—å«æœ‰ C ä»£ç ï¼Œä½ å¯ä»¥ä½¿ç”¨ [LuaNativeObjects](https://github.com/Neopallium/LuaNativeObjects) å»ä» lua ä»£ç ç”Ÿæˆ C ä»£ç ã€‚ å‚è€ƒ[ä¾‹å­](https://github.com/Freed Wu/rime.nvim/blob/main/xmake.lua)ã€‚ ## Nodejs æ¨¡å— å‚è€ƒ[ä¾‹å­](https://github.com/tonyfettes/coc rime/blob/master/xmake.lua)ã€‚ ## Linux å†…æ ¸é©±åŠ¨æ¨¡å— xmake å®Œæ•´æ”¯æŒäº† Linux å†…æ ¸é©±åŠ¨æ¨¡å—çš„æ„å»ºï¼Œè¿™ä¹Ÿè®¸é¦–ä¸ªä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªæ”¯æŒç¼–è¯‘ Linux å†…æ ¸é©±åŠ¨çš„ç¬¬ä¸‰æ–¹æ„å»ºå·¥å…·äº†ã€‚ ### Hello world æ¨¡å— å®Œæ•´ä¾‹å­ï¼š[Linux Kernel Driver Modules](https://github.com/xmake io/xmake/tree/master/tests/projects/linux/driver/hello) å®ƒçš„é…ç½®éå¸¸ç®€å•ï¼Œåªéœ€è¦é…ç½®ä¸Šæ”¯æŒæ¨¡å—çš„ linux headers åŒ…ï¼Œç„¶ååº”ç”¨ `platform.linux.module` æ„å»ºè§„åˆ™å°±è¡Œäº†ã€‚ ```lua add_requires(\"linux headers\", {configs {driver_modules true}}) target(\"hello\", function() add_rules(\"platform.linux.module\") add_files(\"src/*.c\") add_packages(\"linux headers\") set_license(\"GPL 2.0\") end) ``` ç„¶åç›´æ¥æ‰§è¡Œ xmake å‘½ä»¤ï¼Œä¸€é”®ç¼–è¯‘ï¼Œç”Ÿæˆå†…æ ¸é©±åŠ¨æ¨¡å— hello.koã€‚ ```bash $ xmake [ 20%]: cache compiling.release src/add.c [ 20%]: cache compiling.release src/hello.c [ 60%]: linking.release build/linux/x86_64/release/hello.ko [100%]: build ok! ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å®Œæ•´æ„å»ºå‘½ä»¤å‚æ•°ã€‚ ```bash $ xmake v [ 20%]: cache compiling.release src/add.c /usr/bin/ccache /usr/bin/gcc c m64 O2 std gnu89 I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/generated I/usr/src/linux headers 5.11.0 41 generic/include I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/uapi I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/generated/uapi I/usr/src/linux headers 5.11.0 41 generic/include/uapi I/usr/src/linux headers 5.11.0 41 generic/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" DCONFIG_X86_X32_ABI isystem /usr/lib/gcc/x86_64 linux gnu/10/include include /usr/src/linux headers 5.11.0 41 generic/include/linux/kconfig.h include /usr/src/linux headers 5.11.0 41 generic/include/linux/compiler_types.h nostdinc mno sse mno mmx mno sse2 mno 3dnow mno avx mno 80387 mno fp ret in 387 mpreferred stack boundary 3 mskip rax setup mtune generic mno red zone mcmodel kernel mindirect branch thunk extern mindirect branch register mrecord mcount fmacro prefix map ./ fno strict aliasing fno common fshort wchar fno PIE fcf protection none falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno allow store data races fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack DKBUILD_BASENAME \\\"add\\\" o build/.objs/hello/linux/x86_64/release/src/add.c.o src/add.c [ 20%]: cache compiling.release src/hello.c /usr/bin/ccache /usr/bin/gcc c m64 O2 std gnu89 I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/generated I/usr/src/linux headers 5.11.0 41 generic/include I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/uapi I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/generated/uapi I/usr/src/linux headers 5.11.0 41 generic/include/uapi I/usr/src/linux headers 5.11.0 41 generic/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" DCONFIG_X86_X32_ABI isystem /usr/lib/gcc/x86_64 linux gnu/10/include include /usr/src/linux headers 5.11.0 41 generic/include/linux/kconfig.h include /usr/src/linux headers 5.11.0 41 generic/include/linux/compiler_types.h nostdinc mno sse mno mmx mno sse2 mno 3dnow mno avx mno 80387 mno fp ret in 387 mpreferred stack boundary 3 mskip rax setup mtune generic mno red zone mcmodel kernel mindirect branch thunk extern mindirect branch register mrecord mcount fmacro prefix map ./ fno strict aliasing fno common fshort wchar fno PIE fcf protection none falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno allow store data races fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack DKBUILD_BASENAME \\\"hello\\\" o build/.objs/hello/linux/x86_64/release/src/hello.c.o src/hello.c [ 60%]: linking.release build/linux/x86_64/release/hello.ko /usr/bin/ld m elf_x86_64 r o build/.objs/hello/linux/x86_64/release/build/linux/x86_64/release/hello.ko.o build/.objs/hello/linux/x86_64/release/src/add.c.o build/.objs/hello/linux/x86_64/release/src/hello.c.o /usr/src/linux headers 5.11.0 41 generic/scripts/mod/modpost m a o build/.objs/hello/linux/x86_64/release/build/linux/x86_64/release/Module.symvers e N T WARNING: modpost: Symbol info of vmlinux is missing. Unresolved symbol check will be entirely skipped. /usr/bin/ccache /usr/bin/gcc c m64 O2 std gnu89 I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/generated I/usr/src/linux headers 5.11.0 41 generic/include I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/uapi I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/generated/uapi I/usr/src/linux headers 5.11.0 41 generic/include/uapi I/usr/src/linux headers 5.11.0 41 generic/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" DCONFIG_X86_X32_ABI isystem /usr/lib/gcc/x86_64 linux gnu/10/include include /usr/src/linux headers 5.11.0 41 generic/include/linux/kconfig.h include /usr/src/linux headers 5.11.0 41 generic/include/linux/compiler_types.h nostdinc mno sse mno mmx mno sse2 mno 3dnow mno avx mno 80387 mno fp ret in 387 mpreferred stack boundary 3 mskip rax setup mtune generic mno red zone mcmodel kernel mindirect branch thunk extern mindirect branch register mrecord mcount fmacro prefix map ./ fno strict aliasing fno common fshort wchar fno PIE fcf protection none falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno allow store data races fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack o build/.objs/hello/linux/x86_64/release/build/linux/x86_64/release/hello.ko.mod.o build/.objs/hello/linux/x86_64/release/build/linux/x86_64/release/hello.ko.mod.c /usr/bin/ld m elf_x86_64 r build id sha1 T /usr/src/linux headers 5.11.0 41 generic/scripts/module.lds o build/linux/x86_64/release/hello.ko build/.objs/hello/linux/x86_64/release/build/linux/x86_64/release/hello.ko.o build/.objs/hello/linux/x86_64/release/build/linux/x86_64/release/hello.ko.mod.o ``` é€šè¿‡ `add_requires(\"linux headers\", {configs {driver_modules true}})` é…ç½®åŒ…ï¼Œxmake ä¼šè‡ªåŠ¨ä¼˜å…ˆä»ç³»ç»Ÿä¸­æŸ¥æ‰¾å¯¹åº”çš„ linux headers åŒ…ã€‚ å¦‚æœæ²¡æ‰¾åˆ°ï¼Œxmake ä¹Ÿä¼šè‡ªåŠ¨ä¸‹è½½å®ƒï¼Œç„¶åè‡ªåŠ¨é…ç½®æ„å»ºå¸¦æœ‰ driver modules çš„å†…æ ¸æºç åï¼Œä½¿ç”¨å®ƒç»§ç»­æ„å»ºå†…æ ¸æ¨¡å—ã€‚ ### è‡ªå®šä¹‰ linux headers è·¯å¾„ æœ‰å¾ˆå¤šç”¨æˆ·åé¦ˆï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œlinux å†…æ ¸é©±åŠ¨æ„å»ºéƒ½æ˜¯åŸºäºå®šåˆ¶ç‰ˆçš„ linux kernelï¼Œå› æ­¤éœ€è¦èƒ½å¤Ÿè‡ªå®šä¹‰é…ç½® linux headers è·¯å¾„ï¼Œè€Œä¸æ˜¯èµ°è¿œç¨‹ä¾èµ–åŒ…æ¨¡å¼ã€‚ å…¶å®ï¼Œæˆ‘ä»¬é€šè¿‡è‡ªå·±é‡å†™ linux headers åŒ…ï¼Œä¹Ÿæ˜¯å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹çš„ã€‚ ```lua package(\"linux headers\") on_fetch(function (package, opt) return {includedirs \"/usr/src/linux headers 5.0/include\"} end) package_end() add_requires(\"linux headers\") target(\"test\", function() add_rules(\"platform.linux.module\") add_files(\"src/*.c\") add_packages(\"linux headers\") end) ``` ä¸è¿‡è¿™æ ·ï¼Œä¹Ÿè®¸è¿˜æœ‰ç‚¹ç¹çï¼Œå› æ­¤æˆ‘ä»¬æ”¯æŒæ›´åŠ æ–¹ä¾¿çš„è®¾ç½® linux headers è·¯å¾„ã€‚ ```lua target(\"hello\", function() add_rules(\"platform.linux.module\") add_files(\"src/*.c\") set_values(\"linux.driver.linux headers\", \"/usr/src/linux headers 5.11.0 41 generic\") end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å®šä¹‰ option é€‰é¡¹ï¼Œå°† linux headers è·¯å¾„ä½œä¸º `xmake f linux headers /usr/src/linux headers` çš„æ–¹å¼ä¼ å…¥ã€‚ ```lua option(\"linux headers\", {showmenu true, description \"Set linux headers path.\"}) target(\"hello\", function() add_rules(\"platform.linux.module\") add_files(\"src/*.c\") set_values(\"linux.driver.linux headers\", \"$(linux headers)\") end) ``` æ›´å¤šè¯¦æƒ…è§ï¼š[#1923](https://github.com/xmake io/xmake/issues/1923) ### äº¤å‰ç¼–è¯‘ æˆ‘ä»¬ä¹Ÿæ”¯æŒå†…æ ¸é©±åŠ¨æ¨¡å—çš„äº¤å‰ç¼–è¯‘ï¼Œæ¯”å¦‚åœ¨ Linux x86_64 ä¸Šä½¿ç”¨äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ¥æ„å»º Linux Arm/Arm64 çš„é©±åŠ¨æ¨¡å—ã€‚ æˆ‘ä»¬åªéœ€è¦å‡†å¤‡å¥½è‡ªå·±çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œé€šè¿‡ ` sdk ` æŒ‡å®šå®ƒçš„æ ¹ç›®å½•ï¼Œç„¶åé…ç½®åˆ‡æ¢åˆ° ` p cross` å¹³å°ï¼Œ æœ€åæŒ‡å®šéœ€è¦æ„å»ºçš„æ¶æ„ arm/arm64 å³å¯ã€‚ è¿™é‡Œç”¨åˆ°çš„äº¤å‰å·¥å…·é“¾ï¼Œå¯ä»¥ä»è¿™é‡Œä¸‹è½½: [Download toolchains](https://releases.linaro.org/components/toolchain/binaries/latest 7/aarch64 linux gnu/) æ›´å¤šï¼Œäº¤å‰ç¼–è¯‘é…ç½®æ–‡æ¡£ï¼Œè§ï¼š[é…ç½®äº¤å‰ç¼–è¯‘](/zh cn/guide/configuration?id common cross compilation configuration) > ç›®å‰ä»…ä»…æ”¯æŒ arm/arm64 äº¤å‰ç¼–è¯‘æ¶æ„ï¼Œåç»­ä¼šæ”¯æŒæ›´å¤šçš„å¹³å°æ¶æ„ã€‚ #### æ„å»º Arm é©±åŠ¨æ¨¡å— ```bash $ xmake f p cross a arm sdk /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf c $ xmake v checking for arm linux gnueabihf g++ ... /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf g++ checking for the linker (ld) ... arm linux gnueabihf g++ checking for /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf g++ ... ok checking for flags ( fPIC) ... ok checking for /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf gcc ... ok checking for flags ( fPIC) ... ok checking for flags ( O2) ... ok checking for ccache ... /usr/bin/ccache [ 20%]: cache compiling.release src/add.c /usr/bin/ccache /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf gcc c O2 std gnu89 I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/generated I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/generated/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" D__LINUX_ARM_ARCH__ 6 isystem /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/../lib/gcc/arm linux gnueabihf/7.5.0/include include /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/linux/kconfig.h include /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/linux/compiler_types.h nostdinc fno strict aliasing fno common fshort wchar fno PIE falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack mbig endian mabi aapcs linux mfpu vfp marm march armv6k mtune arm1136j s msoft float Uarm DKBUILD_BASENAME \\\"add\\\" o build/.objs/hello/cross/arm/release/src/add.c.o src/add.c [ 20%]: cache compiling.release src/hello.c /usr/bin/ccache /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf gcc c O2 std gnu89 I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/generated I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/generated/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" D__LINUX_ARM_ARCH__ 6 isystem /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/../lib/gcc/arm linux gnueabihf/7.5.0/include include /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/linux/kconfig.h include /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/linux/compiler_types.h nostdinc fno strict aliasing fno common fshort wchar fno PIE falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack mbig endian mabi aapcs linux mfpu vfp marm march armv6k mtune arm1136j s msoft float Uarm DKBUILD_BASENAME \\\"hello\\\" o build/.objs/hello/cross/arm/release/src/hello.c.o src/hello.c checking for flags ( MMD MF) ... ok checking for flags ( fdiagnostics color always) ... ok [ 60%]: linking.release build/cross/arm/release/hello.ko /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf ld EB r o build/.objs/hello/cross/arm/release/build/cross/arm/release/hello.ko.o build/.objs/hello/cross/arm/release/src/add.c.o build/.objs/hello/cross/arm/release/src/hello.c.o /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/scripts/mod/modpost m a o build/.objs/hello/cross/arm/release/build/cross/arm/release/Module.symvers e N T WARNING: modpost: Symbol info of vmlinux is missing. Unresolved symbol check will be entirely skipped. /usr/bin/ccache /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf gcc c O2 std gnu89 I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/generated I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/generated/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" D__LINUX_ARM_ARCH__ 6 isystem /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/../lib/gcc/arm linux gnueabihf/7.5.0/include include /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/linux/kconfig.h include /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/linux/compiler_types.h nostdinc fno strict aliasing fno common fshort wchar fno PIE falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack mbig endian mabi aapcs linux mfpu vfp marm march armv6k mtune arm1136j s msoft float Uarm o build/.objs/hello/cross/arm/release/build/cross/arm/release/hello.ko.mod.o build/.objs/hello/cross/arm/release/build/cross/arm/release/hello.ko.mod.c /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf ld EB be8 r build id sha1 T /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/scripts/module.lds o build/cross/arm/release/hello.ko build/.objs/hello/cross/arm/release/build/cross/arm/release/hello.ko.o build/.objs/hello/cross/arm/release/build/cross/arm/release/hello.ko.mod.o [100%]: build ok! ``` #### æ„å»º Arm64 é©±åŠ¨æ¨¡å— ```bash $ xmake f p cross a arm64 sdk /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu c checking for aarch64 linux gnu g++ ... /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu g++ checking for the linker (ld) ... aarch64 linux gnu g++ checking for /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu g++ ... ok checking for flags ( fPIC) ... ok checking for /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu gcc ... ok checking for flags ( fPIC) ... ok checking for flags ( O2) ... ok checking for ccache ... /usr/bin/ccache [ 20%]: cache compiling.release src/add.c /usr/bin/ccache /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu gcc c O2 std gnu89 I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/generated I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/generated/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" isystem /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/../lib/gcc/aarch64 linux gnu/7.5.0/include include /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/linux/kconfig.h include /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/linux/compiler_types.h nostdinc fno strict aliasing fno common fshort wchar fno PIE falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack DKBUILD_BASENAME \\\"add\\\" o build/.objs/hello/cross/arm64/release/src/add.c.o src/add.c [ 20%]: cache compiling.release src/hello.c /usr/bin/ccache /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu gcc c O2 std gnu89 I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/generated I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/generated/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" isystem /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/../lib/gcc/aarch64 linux gnu/7.5.0/include include /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/linux/kconfig.h include /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/linux/compiler_types.h nostdinc fno strict aliasing fno common fshort wchar fno PIE falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack DKBUILD_BASENAME \\\"hello\\\" o build/.objs/hello/cross/arm64/release/src/hello.c.o src/hello.c checking for flags ( MMD MF) ... ok checking for flags ( fdiagnostics color always) ... ok [ 60%]: linking.release build/cross/arm64/release/hello.ko /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu ld EL maarch64elf r o build/.objs/hello/cross/arm64/release/build/cross/arm64/release/hello.ko.o build/.objs/hello/cross/arm64/release/src/add.c.o build/.objs/hello/cross/arm64/release/src/hello.c.o /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/scripts/mod/modpost m a o build/.objs/hello/cross/arm64/release/build/cross/arm64/release/Module.symvers e N T WARNING: modpost: Symbol info of vmlinux is missing. Unresolved symbol check will be entirely skipped. /usr/bin/ccache /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu gcc c O2 std gnu89 I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/generated I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/generated/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" isystem /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/../lib/gcc/aarch64 linux gnu/7.5.0/include include /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/linux/kconfig.h include /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/linux/compiler_types.h nostdinc fno strict aliasing fno common fshort wchar fno PIE falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack o build/.objs/hello/cross/arm64/release/build/cross/arm64/release/hello.ko.mod.o build/.objs/hello/cross/arm64/release/build/cross/arm64/release/hello.ko.mod.c /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu ld EL maarch64elf r build id sha1 T /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/scripts/module.lds o build/cross/arm64/release/hello.ko build/.objs/hello/cross/arm64/release/build/cross/arm64/release/hello.ko.o build/.objs/hello/cross/arm64/release/build/cross/arm64/release/hello.ko.mod.o [100%]: build ok! ``` ## ASN.1 ç¨‹åº ASN.1 ç¨‹åºï¼Œéœ€è¦å€ŸåŠ© [ASN.1 Compiler](https://github.com/vlm/asn1c) å»ç”Ÿæˆç›¸å…³çš„ .c æ–‡ä»¶å‚ä¸é¡¹ç›®ç¼–è¯‘ã€‚ è€Œ Xmake å†…ç½®æä¾›äº† `add_rules(\"asn1c\")` è§„åˆ™å»å¤„ç† `.c` æ–‡ä»¶ç”Ÿæˆï¼Œ`add_requires(\"asn1c\")` è‡ªåŠ¨æ‹‰å–é›†æˆ ASN.1 ç¼–è¯‘å™¨å·¥å…·ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºç¡€çš„é…ç½®ä¾‹å­ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"asn1c\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_files(\"src/*.asn1\") add_rules(\"asn1c\") add_packages(\"asn1c\") end) ``` å…·ä½“è§ [å®Œæ•´ä¾‹å­å·¥ç¨‹](https://github.com/xmake io/xmake/tree/master/tests/projects/c/asn1c)ã€‚ ## Verilog ä»¿çœŸç¨‹åº ### iVerilog ä»¿çœŸå™¨ é€šè¿‡ `add_requires(\"iverilog\")` é…ç½®ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè‡ªåŠ¨æ‹‰å– iverilog å·¥å…·é“¾åŒ…ï¼Œç„¶åä½¿ç”¨ `set_toolchains(\"@iverilog\")` è‡ªåŠ¨ç»‘å®šå·¥å…·é“¾æ¥ç¼–è¯‘å·¥ç¨‹ã€‚ ```lua add_requires(\"iverilog\") target(\"hello\", function() add_rules(\"iverilog.binary\") set_toolchains(\"@iverilog\") add_files(\"src/*.v\") end) ``` #### è®¾ç½®æŠ½è±¡é…ç½® ```lua add_requires(\"iverilog\") target(\"hello\", function() add_rules(\"iverilog.binary\") set_toolchains(\"@iverilog\") add_files(\"src/*.v\") add_defines(\"TEST\") add_includedirs(\"inc\") set_languages(\"v1800 2009\") end) ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ `set_languages(\"v1800 2009\")` æ¥è®¾ç½®åˆ‡æ¢ Verilog çš„è¯­è¨€æ ‡å‡†ã€‚ ç›®å‰æ”¯æŒçš„ä¸€äº›å–å€¼å’Œæ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š ```lua [\"v1364 1995\"] \" g1995\" [\"v1364 2001\"] \" g2001\" [\"v1364 2005\"] \" g2005\" [\"v1800 2005\"] \" g2005 sv\" [\"v1800 2009\"] \" g2009\" [\"v1800 2012\"] \" g2012\" ``` #### è®¾ç½®è‡ªå®šä¹‰ flags ```lua add_requires(\"iverilog\") target(\"hello\", function() add_rules(\"iverilog.binary\") set_toolchains(\"@iverilog\") add_files(\"src/*.v\") add_values(\"iverilogs.flags\", \" DTEST\") end) ``` #### æ„å»ºå·¥ç¨‹ ```bash $ xmake checking for iverilog ... iverilog checking for vvp ... vvp [ 50%]: linking.iverilog hello.vvp [100%]: build ok! ``` #### è¿è¡Œç¨‹åº ```bash $ xmake run hello world! LXT2 info: dumpfile hello.vcd opened for output. src/main.v:6: $finish called at 0 (1s) ``` æ›´å¤šå®Œæ•´ä¾‹å­ï¼š[iVerilog Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/embed/iverilog) ### Verilator ä»¿çœŸå™¨ é€šè¿‡ `add_requires(\"verilator\")` é…ç½®ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè‡ªåŠ¨æ‹‰å– verilator å·¥å…·é“¾åŒ…ï¼Œç„¶åä½¿ç”¨ `set_toolchains(\"@verilator\")` è‡ªåŠ¨ç»‘å®šåˆ°å·¥å…·é“¾æ¥ç¼–è¯‘å·¥ç¨‹ã€‚ ```lua add_requires(\"verilator\") target(\"hello\", function() add_rules(\"verilator.binary\") set_toolchains(\"@verilator\") add_files(\"src/*.v\") add_files(\"src/*.cpp\") end) ``` verilator å·¥ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé¢å¤–çš„ `sim_main.cpp` æ–‡ä»¶å‚ä¸ç¼–è¯‘ï¼Œä½œä¸ºç¨‹åºçš„å…¥å£ä»£ç ã€‚ ``` #include \"hello.h\" #include \"verilated.h\" int main(int argc, char** argv) { VerilatedContext* contextp new VerilatedContext; contextp >commandArgs(argc, argv); hello* top new hello{contextp}; while (!contextp >gotFinish()) { top >eval(); } delete top; delete contextp; return 0; } ``` #### è®¾ç½®æŠ½è±¡é…ç½® ```lua add_requires(\"verilator\") target(\"hello\", function() add_rules(\"verilator.binary\") set_toolchains(\"@verilator\") add_files(\"src/*.v\") add_defines(\"TEST\") add_includedirs(\"inc\") set_languages(\"v1800 2009\") end) ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ `set_languages(\"v1800 2009\")` æ¥è®¾ç½®åˆ‡æ¢ Verilog çš„è¯­è¨€æ ‡å‡†ã€‚ ç›®å‰æ”¯æŒçš„ä¸€äº›å–å€¼å’Œæ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š ```lua Verilog [\"v1364 1995\"] \"+1364 1995ext+v\", [\"v1364 2001\"] \"+1364 2001ext+v\", [\"v1364 2005\"] \"+1364 2005ext+v\", SystemVerilog [\"v1800 2005\"] \"+1800 2005ext+v\", [\"v1800 2009\"] \"+1800 2009ext+v\", [\"v1800 2012\"] \"+1800 2012ext+v\", [\"v1800 2017\"] \"+1800 2017ext+v\", ``` #### è®¾ç½®è‡ªå®šä¹‰ flags ```lua add_requires(\"verilator\") target(\"hello\", function() add_rules(\"verilator.binary\") set_toolchains(\"@verilator\") add_files(\"src/*.v\") add_files(\"src/*.cpp\") add_values(\"verilator.flags\", \" trace\", \" timing\") end) ``` #### æ„å»ºå·¥ç¨‹ ```bash $ xmake [ 0%]: compiling.verilog src/main.v [ 15%]: cache compiling.release /Users/ruki/.xmake/packages/v/verilator/2023.1.10/cd2268409c1d44799288c7759b3cbd56/share/verilator/include/verilated.cpp [ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello___024root__Slow.cpp [ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello___024root__DepSet_h9053a130__0__Slow.cpp [ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello.cpp [ 15%]: cache compiling.release /Users/ruki/.xmake/packages/v/verilator/2023.1.10/cd2268409c1d44799288c7759b3cbd56/share/verilator/include/verilated_threads.cpp [ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello__Syms.cpp [ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello___024root__DepSet_h07139e86__0.cpp [ 15%]: cache compiling.release src/sim_main.cpp [ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello___024root__DepSet_h9053a130__0.cpp [ 84%]: linking.release hello [100%]: build ok! ``` #### è¿è¡Œç¨‹åº ```bash $ xmake run ruki 2:hello ruki$ xmake run hello world! src/main.v:4: Verilog $finish ``` æ›´å¤šå®Œæ•´ä¾‹å­ï¼š[Verilator](https://github.com/xmake io/xmake/tree/master/tests/projects/embed/verilator) #### ç¼–è¯‘é™æ€åº“ æˆ‘ä»¬ä¹Ÿæä¾›äº† `verilator.static` è§„åˆ™æ¥ç¼–è¯‘ç”Ÿæˆ verilator é™æ€åº“ã€‚ ```lua add_requires(\"verilator\") target(\"hello\", function() add_rules(\"verilator.static\") set_toolchains(\"@verilator\") add_files(\"src/*.v\") end) target(\"test\", function() add_deps(\"hello\") add_files(\"src/*.cpp\") end) ``` ## Cppfront ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"cppfront\") target(\"test\", function() add_rules(\"cppfront\") set_kind(\"binary\") add_files(\"src/*.cpp2\") add_packages(\"cppfront\") end) ``` ## Cosmocc ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"cosmocc\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") set_toolchains(\"@cosmocc\") end) ```"},"/get_started/zh/tutorial/environment-variables.html":{"title":"ç¯å¢ƒå˜é‡","content":"# ç¯å¢ƒå˜é‡ æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œè·å–æ‰€æœ‰ xmake ç”¨åˆ°çš„ç¯å¢ƒå˜é‡ï¼Œä»¥åŠå½“å‰è¢«è®¾ç½®çš„å€¼ã€‚ ```bash $ xmake show l envs XMAKE_RAMDIR Set the ramdisk directory. <empty> XMAKE_GLOBALDIR Set the global config directory of xmake. /Users/ruki/.xmake XMAKE_ROOT Allow xmake to run under root. <empty> XMAKE_COLORTERM Set the color terminal environment. <empty> XMAKE_PKG_INSTALLDIR Set the install directory of packages. <empty> XMAKE_TMPDIR Set the temporary directory. /var/folders/vn/ppcrrcm911v8b4510klg9xw80000gn/T/.xmake501/211104 XMAKE_PKG_CACHEDIR Set the cache directory of packages. <empty> XMAKE_PROGRAM_DIR Set the program scripts directory of xmake. /Users/ruki/.local/share/xmake XMAKE_PROFILE Start profiler, e.g. perf, trace. <empty> XMAKE_RCFILES Set the runtime configuration files. XMAKE_CONFIGDIR Set the local config directory of project. /Users/ruki/projects/personal/xmake docs/.xmake/macosx/x86_64 XMAKE_LOGFILE Set the log output file path. <empty> ``` ## XMAKE_RAMDIR è®¾ç½® ramdisk ç›®å½•è·¯å¾„ ramdisk ç›®å½•æ˜¯å†…å­˜æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ä½ç½®ï¼Œé€šå¸¸ `os.tmpdir()` æ¥å£ä¼šç”¨åˆ°ï¼Œxmake å†…éƒ¨ä½¿ç”¨çš„ä¸´æ—¶æ–‡ä»¶ï¼Œå¦‚æœç”¨æˆ·è®¾ç½® ramdisk è·¯å¾„ï¼Œåˆ™ä¼šä¼˜å…ˆå­˜å‚¨åœ¨è¿™ä¸ªä¸Šé¢ï¼Œæå‡æ•´ä½“ç¼–è¯‘é€Ÿåº¦ã€‚ ## XMAKE_TMPDIR è®¾ç½®ç”¨æˆ·çš„ä¸´æ—¶ç›®å½• é»˜è®¤ xmake ä¼šä½¿ç”¨ `/tmp/.xmake`ï¼Œå½“ç„¶ç”¨æˆ·å¯ä»¥é€šè¿‡è¿™ä¸ªå˜é‡å»ä¿®æ”¹é»˜è®¤è·¯å¾„ã€‚ ## XMAKE_CONFIGDIR è®¾ç½®æœ¬åœ°å·¥ç¨‹é…ç½®ç›®å½• æ¯ä¸ªé¡¹ç›®çš„æœ¬åœ°ç¼–è¯‘é…ç½®ï¼Œé»˜è®¤ä¼šå­˜å‚¨åœ¨å½“å‰é¡¹ç›®æ ¹ç›®å½•çš„ `.xmake` è·¯å¾„ä¸‹ï¼Œç„¶åæ ¹æ®ä¸åŒçš„å¹³å°ï¼Œæ¶æ„åŒºåˆ†ï¼Œä¾‹å¦‚ï¼š ```bash .xmake/macosx/x86_64 ``` æˆ‘ä»¬å¦‚æœä¸æƒ³å­˜å‚¨åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œä¹Ÿå¯ä»¥è‡ªå·±è®¾ç½®åˆ°å…¶ä»–è·¯å¾„ï¼Œæ¯”å¦‚ build ç›®å½•ä¸‹ç­‰ç­‰ã€‚ ## XMAKE_GLOBALDIR è®¾ç½®å…¨å±€é…ç½®æ–‡ä»¶æ ¹ç›®å½• ä¹Ÿå°±æ˜¯ `xmake g/global` å…¨å±€é…ç½®çš„å­˜å‚¨ç›®å½•ï¼Œè¿˜æœ‰å®‰è£…åŒ…ï¼Œç¼“å­˜ç­‰å…¶ä»–å…¨å±€æ–‡ä»¶ï¼Œé»˜è®¤éƒ½ä¼šå­˜å‚¨åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚ é»˜è®¤è·¯å¾„ä¸ºï¼š`~/.xmake`ã€‚ ## XMAKE_ROOT å…è®¸ç”¨æˆ·åœ¨ root æ¨¡å¼ä¸‹è¿è¡Œ é€šå¸¸ xmake æ˜¯é»˜è®¤ç¦æ­¢åœ¨ root ä¸‹è¿è¡Œï¼Œè¿™éå¸¸ä¸å®‰å…¨ã€‚ä½†æ˜¯å¦‚æœç”¨æˆ·éè¦åœ¨ root ä¸‹è¿è¡Œï¼Œä¹Ÿå¯ä»¥è®¾ç½®è¿™ä¸ªå˜é‡ï¼Œå¼ºåˆ¶å¼€å¯ã€‚ ```bash export XMAKE_ROOT y ``` ## XMAKE_COLORTERM è®¾ç½® Terminal çš„è‰²å½©è¾“å‡º ç›®å‰å¯ä»¥è®¾ç½®è¿™å‡ ä¸ªå€¼ï¼š å€¼ æè¿° nocolor ç¦ç”¨å½©è‰²è¾“å‡º color8 8 è‰²è¾“å‡ºæ”¯æŒ color256 256 è‰²è¾“å‡ºæ”¯æŒ truecolor çœŸå½©è‰²è¾“å‡ºæ”¯æŒ é€šå¸¸ï¼Œç”¨æˆ·ä¸éœ€è¦è®¾ç½®å®ƒä»¬ï¼Œxmake ä¼šè‡ªåŠ¨æ¢æµ‹ç”¨æˆ·ç»ˆç«¯æ”¯æŒçš„è‰²å½©èŒƒå›´ï¼Œå¦‚æœç”¨æˆ·ä¸æƒ³è¾“å‡ºè‰²å½©ï¼Œå¯ä»¥è®¾ç½® nocolor æ¥å…¨å±€ç¦ç”¨ã€‚ æˆ–è€…ç”¨ `xmake g theme plain` ä¹Ÿå¯ä»¥å…¨å±€ç¦ç”¨ã€‚ ## XMAKE_PKG_INSTALLDIR è®¾ç½®ä¾èµ–åŒ…çš„å®‰è£…æ ¹ç›®å½• xmake çš„è¿œç¨‹åŒ…å®‰è£…çš„å…¨å±€ç›®å½•é»˜è®¤æ˜¯ `~/.xmake/packages`ï¼Œä½†æ˜¯ç”¨æˆ·ä¹Ÿå¯ä»¥è®¾ç½®è¿™ä¸ªå˜é‡ï¼Œå»å•ç‹¬ä¿®æ”¹å®ƒã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `xmake g pkg_installdir /xxx` å»è®¾ç½®å®ƒï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ ## XMAKE_PKG_CACHEDIR è®¾ç½®ä¾èµ–åŒ…çš„ç¼“å­˜ç›®å½• é»˜è®¤è·¯å¾„åœ¨ `~/.xmake/cache` ç›®å½•ï¼Œå­˜å‚¨åŒ…å®‰è£…è¿‡ç¨‹ä¸­çš„å„ç§ç¼“å­˜æ–‡ä»¶ï¼Œæ¯”è¾ƒå å­˜å‚¨ç©ºé—´ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥å•ç‹¬è®¾ç½®å®ƒã€‚ å½“ç„¶ï¼Œxmake åœ¨æ¯ä¸ªæœˆéƒ½ä¼šè‡ªåŠ¨æ¸…ç†ä¸Šä¸ªæœˆçš„æ‰€æœ‰ç¼“å­˜æ–‡ä»¶ã€‚ ## XMAKE_PROGRAM_DIR è®¾ç½® xmake çš„è„šæœ¬ç›®å½• xmake çš„æ‰€æœ‰ lua è„šæœ¬éšå®‰è£…ç¨‹åºä¸€èµ·å®‰è£…ï¼Œé»˜è®¤éƒ½åœ¨å®‰è£…ç›®å½•ä¸‹ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦åˆ‡åˆ°è‡ªå·±ä¸‹è½½çš„è„šæœ¬ç›®å½•ä¸‹ï¼Œæ–¹ä¾¿æœ¬åœ°ä¿®æ”¹è°ƒè¯•ï¼Œå¯ä»¥è®¾ç½®æ­¤å˜é‡ã€‚ å¦‚æœè¦æŸ¥çœ‹å½“å‰ xmake åœ¨ä½¿ç”¨çš„è„šæœ¬ç›®å½•ï¼Œå¯ä»¥æ‰§è¡Œï¼š ```bash $ xmake l os.programdir /Users/ruki/.local/share/xmake ``` ## XMAKE_PROFILE å¼€å¯æ€§èƒ½åˆ†æ è¿™ä»…ä»…å¯¹ xmake çš„å¼€å‘è€…å¼€æ”¾ï¼Œç”¨äºåˆ†æ xmake è¿è¡Œè¿‡ç¨‹ä¸­çš„è€—æ—¶æƒ…å†µï¼Œè¿½è¸ªè°ƒç”¨è¿‡ç¨‹ã€‚ ### åˆ†æå‡½æ•°è°ƒç”¨è€—æ—¶ ```bash $ XMAKE_PROFILE perf:call xmake [ 25%]: cache compiling.release src/main.cpp [ 50%]: linking.release test [100%]: build ok! 0.238, 97.93%, 1, runloop : @programdir/core/base/scheduler.lua: 805 0.180, 74.04%, 25, _resume : [C]: 1 0.015, 6.34%, 50, _co_groups_resume : @programdir/core/base/scheduler.lua: 299 0.011, 4.37%, 48, wait : @programdir/core/base/poller.lua: 111 0.004, 1.70%, 62, status : @programdir/core/base/scheduler.lua: 71 0.004, 1.53%, 38, is_dead : @programdir/core/base/scheduler.lua: 76 0.003, 1.44%, 50, next : @programdir/core/base/timer.lua: 74 0.003, 1.33%, 48, delay : @programdir/core/base/timer.lua: 60 0.002, 1.02%, 24, is_suspended : @programdir/core/base/scheduler.lua: 86 ``` ### åˆ†æè¿›ç¨‹è€—æ—¶ å¯ä»¥ç”¨äºåˆ†ææ¯ä¸ªæ–‡ä»¶çš„ç¼–è¯‘è€—æ—¶ï¼Œä»¥åŠä¸€äº›è¿è¡Œç“¶é¢ˆã€‚ ```bash $ XMAKE_PROFILE perf:process xmake r [ 7%]: compiling.release src/header.h [ 23%]: compiling.release src/test.cpp [ 30%]: compiling.release src/test8.cpp [ 38%]: compiling.release src/test4.cpp [ 46%]: compiling.release src/test5.cpp [ 53%]: compiling.release src/test7.cpp [ 61%]: compiling.release src/test6.cpp [ 69%]: compiling.release src/test2.cpp [ 76%]: compiling.release src/main.cpp [ 84%]: compiling.release test3.cpp [ 84%]: compiling.release src/test.c [ 92%]: linking.release main [100%]: build ok, spent 2.754s 1411.000, 22.19%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_37317EEDB62F4F3088AF6A2E2A649460 fdiagnostics color always x c++ header o build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch src/header.h 508.000, 7.99%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_1ABAE1FAD68D45008DC76A3A00697820 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/main.cpp.o src/main.cpp 473.000, 7.44%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_1C0BE5280C6F4E208F919577A48AAA40 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/test3.cpp.o test3.cpp 451.000, 7.09%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_877D3D9B6BBA4D308BFB5E4EBD751340 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test6.cpp.o src/test6.cpp 404.000, 6.35%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_C9968E2873B648208A8C3F2BA7573640 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test7.cpp.o src/test7.cpp 402.000, 6.32%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_7F6DFA37FF494D208EADF9737484EC40 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test2.cpp.o src/test2.cpp 383.000, 6.02%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_63C9E23AE7E047308F762C7C02A56B50 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test4.cpp.o src/test4.cpp 374.000, 5.88%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_C3A0EF96A7C14D00879BFAEFD26E9D20 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test8.cpp.o src/test8.cpp 368.000, 5.79%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_BADB46AF75CB4610857EF5083BD54D30 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test.cpp.o src/test.cpp 363.000, 5.71%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_0247BDB87DD14500816471184D4E8140 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test5.cpp.o src/test5.cpp 156.000, 2.45%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang fPIC Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk S o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F0FF8220B33B46208D39A98937D55E50 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.c 133.000, 2.09%, 3, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang version 107.000, 1.68%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang O3 Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk S o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_C8A96266E0034C20898C147FC52F3A40 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.c 105.000, 1.65%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang fdiagnostics color always Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk S o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_48A2FA7BE7AB44008B60558E412A9D30 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.c 105.000, 1.65%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang++ fPIC target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk lz target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk lz o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F510FB15C9A647108111A7010EFED240 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.cpp 91.000, 1.43%, 3, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang++ version 74.000, 1.16%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden O3 DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_BF6B4B6DACB843008E822CEFDC711230 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test.c.o src/test.c 73.000, 1.15%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang++ o build/macosx/x86_64/release/main build/.objs/main/macosx/x86_64/release/src/test.cpp.o build/.objs/main/macosx/x86_64/release/src/test8.cpp.o build/.objs/main/macosx/x86_64/release/src/test4.cpp.o build/.objs/main/macosx/x86_64/release/src/test5.cpp.o build/.objs/main/macosx/x86_64/release/src/test7.cpp.o build/.objs/main/macosx/x86_64/release/src/test6.cpp.o build/.objs/main/macosx/x86_64/release/src/test2.cpp.o build/.objs/main/macosx/x86_64/release/src/main.cpp.o build/.objs/main/macosx/x86_64/release/test3.cpp.o build/.objs/main/macosx/x86_64/release/src/test.c.o target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk lz Wl, x Wl, dead_strip 70.000, 1.10%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang fPIC Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk S o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_6D0B6327841A47208939EEF194F38B50 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.cpp 68.000, 1.07%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang O3 Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk S o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_8AB279F8450D4D108E92951CC9C1C650 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.cpp 65.000, 1.02%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang fdiagnostics color always Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk S o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_D25F0DB04D6D430084C098F1E1F76C00 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.cpp ``` ### è¿½è¸ª xmake çš„è¿è¡Œè¿‡ç¨‹ ```bash $ XMAKE_PROFILE trace xmake func : @programdir/core/base/scheduler.lua: 457 is_suspended : @programdir/core/base/scheduler.lua: 86 status : @programdir/core/base/scheduler.lua: 71 thread : @programdir/core/base/scheduler.lua: 66 thread : @programdir/core/base/scheduler.lua: 66 length : @programdir/core/base/heap.lua: 120 ``` ### åˆ†æè¿è¡Œå¡æ­»é—®é¢˜ å¯ä»¥ç”¨äºè·å– xmake è¿è¡Œå¡æ­»æ—¶çš„æ ˆã€‚å¯ç”¨æ­¤ç‰¹æ€§åï¼Œé€šè¿‡ Ctrl+C ä¸­æ–­åå°±èƒ½è·å–æ ˆã€‚ ```bash $ XMAKE_PROFILE stuck xmake l test.lua <Ctrl+C> stack traceback: [C]: in function 'base/io.file_read' @programdir/core/base/io.lua:177: in method '_read' @programdir/core/sandbox/modules/io.lua:90: in function <@programdir/core/sandbox/module s/io.lua:89> (...tail calls...) /Users/ruki/share/test.lua:2: in function </Users/ruki/share/test.lua:1> (...tail calls...) @programdir/plugins/lua/main.lua:123: in function <@programdir/plugins/lua/main.lua:79> (...tail calls...) [C]: in function 'xpcall' @programdir/core/base/utils.lua:280: in function 'sandbox/modules/utils.trycall' (...tail calls...) @programdir/core/base/task.lua:519: in function 'base/task.run' @programdir/core/main.lua:278: in upvalue 'cotask' @programdir/core/base/scheduler.lua:371: in function <@programdir/core/base/scheduler.lu a:368> ``` ## XMAKE_RCFILES è®¾ç½®å…¨å±€é…ç½®æ–‡ä»¶ æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€äº› xmakerc.lua å…¨å±€é…ç½®æ–‡ä»¶ï¼Œåœ¨ç”¨æˆ·ç¼–è¯‘é¡¹ç›®çš„æ—¶å€™ï¼Œå…¨å±€å¼•å…¥å®ƒä»¬ï¼Œæ¯”å¦‚å…¨å±€å¼•å…¥ä¸€äº›ç”¨æˆ·è‡ªå®šä¹‰çš„å¸®åŠ©è„šæœ¬ï¼Œå·¥å…·é“¾ä»€ä¹ˆçš„ã€‚ ```bash $ export XMAKE_RCFILES xmakerc.lua $ xmake ``` å¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤è·¯å¾„ä¸ºï¼š`~/.xmake/xmakerc.lua`ã€‚ ## XMAKE_LOGFILE è®¾ç½®æ—¥å¿—æ–‡ä»¶è·¯å¾„ é»˜è®¤ xmake ä¼šå›æ˜¾è¾“å‡ºåˆ°ç»ˆç«¯ï¼Œæˆ‘ä»¬åœ¨å¯ä»¥é€šè¿‡è®¾ç½®è¿™ä¸ªè·¯å¾„ï¼Œå¼€å¯æ—¥å¿—è‡ªåŠ¨å­˜å‚¨åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œä½†å®ƒä¸ä¼šå½±å“ç»ˆç«¯çš„æ­£å¸¸å›æ˜¾è¾“å‡ºã€‚ ## XMAKE_MAIN_REPO è®¾ç½®å®˜æ–¹åŒ…ä¸»ä»“åº“åœ°å€ xmake é»˜è®¤å†…ç½®äº†ä¸‰ä¸ªä¸»ä»“åº“åœ°å€ï¼Œå®ƒä»¬æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œxmake ä¼šæ ¹æ®å½“å‰ç½‘ç»œçŠ¶æ€é€‰æ‹©æœ€ä¼˜çš„åœ°å€æ¥ä½¿ç”¨ã€‚ ``` https://github.com/xmake io/xmake repo.git https://gitlab.com/tboox/xmake repo.git https://gitee.com/tboox/xmake repo.git ``` ä½†å¦‚æœ xmake é€‰æ‹©é”™è¯¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»“åº“ä¸‹è½½å¤±è´¥ï¼Œè€Œé€šè¿‡è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±è®¾ç½®å›ºå®šä½¿ç”¨æŒ‡å®šçš„ä»“åº“åœ°å€ï¼Œä¸å†è¿›è¡Œè‡ªåŠ¨é€‰æ‹©ã€‚ ```bash $ export XMAKE_MAIN_REPO https://github.com/xmake io/xmake repo.git ``` ## XMAKE_BINARY_REPO è®¾ç½®å®˜æ–¹åŒ…é¢„ç¼–è¯‘ä»“åº“åœ°å€ ç±»ä¼¼ `XMAKE_MAIN_REPO`ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œè¿™ä¸ªç”¨äºåˆ‡æ¢é¢„ç¼–è¯‘ä»“åº“çš„åœ°å€ã€‚ ```bash $ export XMAKE_BINARY_REPO https://github.com/xmake mirror/build artifacts.git ``` ## XMAKE_THEME è®¾ç½®ä¸»é¢˜ é€šå¸¸æˆ‘ä»¬å¯ä»¥é€šè¿‡ `xmake g theme plain` æ¥è®¾ç½®é¢œè‰²ä¸»é¢˜ï¼Œä½†æ˜¯å®ƒæ˜¯å…¨å±€çš„ï¼Œå¦‚æœæƒ³å•ç‹¬å¯¹å½“å‰ç»ˆç«¯ä¼šè¯è®¾ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç¯å¢ƒå˜é‡æ¥è®¾ç½®ã€‚ ```bash $ export XMAKE_THEME plain ``` ## XMAKE_STATS å¼€å¯æˆ–ç¦ç”¨ç”¨æˆ·é‡ç»Ÿè®¡ ç”±äºç›®å‰ xmake è¿˜åœ¨å‘å±•åˆæœŸï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å¤§æ¦‚çš„ç”¨æˆ·é‡å¢é•¿æƒ…å†µï¼Œä»¥ä¾¿äºæä¾›æˆ‘ä»¬æŒç»­æ›´æ–° xmake çš„åŠ¨åŠ›ã€‚ å› æ­¤ xmake é»˜è®¤æ¯å¤©çš„ç¬¬ä¸€æ¬¡é¡¹ç›®æ„å»ºï¼Œä¼šåœ¨åå°è¿›ç¨‹è‡ªåŠ¨ git clone ä¸€ä¸ªç©ºä»“åº“ï¼š<https://github.com/xmake io/xmake stats> ç„¶åå€Ÿç”¨ github è‡ªèº«æä¾›çš„ Traffic ç»Ÿè®¡å›¾è¡¨æ¥è·å–å¤§æ¦‚çš„ç”¨æˆ·é‡ã€‚ å¯¹äºæ¯ä¸ªé¡¹ç›®ï¼Œæ¯å¤©åªä¼šç»Ÿè®¡ä¸€æ¬¡ï¼Œå¹¶ä¸”ä¸ä¼šæ³„éœ²ä»»ä½•ç”¨æˆ·éšç§ï¼Œå› ä¸ºä»…ä»…åªæ˜¯å¤šäº†ä¸€æ¬¡é¢å¤–çš„ git clone æ“ä½œï¼Œå¦å¤–æˆ‘ä»¬ clone çš„æ˜¯ä¸€ä¸ªç©ºä»“åº“ï¼Œä¸ä¼šè€—è´¹ç”¨æˆ·å¤šå°‘æµé‡ã€‚ å½“ç„¶ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªç”¨æˆ·éƒ½å¸Œæœ›è¿™ä¹ˆåšï¼Œç”¨æˆ·å®Œå…¨æœ‰æƒåˆ©å»ç¦ç”¨è¿™ä¸ªè¡Œä¸ºï¼Œæˆ‘ä»¬åªéœ€è¦è®¾ç½®ï¼š ```bash export XMAKE_STATS n ``` å°±å¯ä»¥å®Œå…¨ç¦ç”¨å®ƒï¼Œå¦å¤–æˆ‘ä»¬ä¹Ÿä¼šåœ¨ ci ä¸Šè‡ªåŠ¨ç¦ç”¨è¿™ä¸ªè¡Œä¸ºã€‚ ä»€ä¹ˆæ—¶å€™ç§»é™¤å®ƒï¼Ÿ è¿™ä¸ªè¡Œä¸ºå¹¶ä¸ä¼šæ°¸ä¹…å­˜åœ¨ï¼Œç­‰åˆ° xmake æœ‰äº†è¶³å¤Ÿå¤šçš„ç”¨æˆ·é‡ï¼Œæˆ–è€…æœ‰äº†å…¶ä»–æ›´å¥½çš„ç»Ÿè®¡æ–¹å¼ï¼Œæˆ‘ä»¬ä¼šè€ƒè™‘ç§»é™¤ç›¸å…³ç»Ÿè®¡ä»£ç ã€‚ å½“ç„¶ï¼Œå¦‚æœæœ‰éå¸¸å¤šçš„ç”¨æˆ·åé¦ˆä¸æ„¿æ„æ¥å—å®ƒï¼Œæˆ‘ä»¬ä¹Ÿä¼šè€ƒè™‘ç§»é™¤å®ƒã€‚ å…³äºè¿™ä¸ªçš„ç›¸å…³ issues è§ï¼š[#1795](https://github.com/xmake io/xmake/issues/1795)"},"/get_started/zh/tutorial/install.html":{"title":"å®‰è£…","content":"# å®‰è£… ## æºç ç¼–è¯‘å®‰è£… ### å®‰è£… > åˆ‡è®°ï¼Œxmake ä¸å»ºè®®åœ¨ root ä¸‹å®‰è£…å’Œä½¿ç”¨ï¼Œæ‰€ä»¥å°½é‡ä¸è¦åœ¨ root ä¸‹æ‹‰å–æºç ç¼–è¯‘å®‰è£…ã€‚ ```bash git clone https://github.com/TOMO CAT/xmake.git cd ./xmake bash scripts/install.sh ``` å¦‚æœæ²¡æœ‰å¤–ç½‘ç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡ gitee é•œåƒæ‹‰å–ï¼ˆxmake repo ä¹Ÿä¼šè‡ªåŠ¨åˆ‡åˆ° gitee æºï¼‰ï¼š ```bash git clone https://gitee.com/tomocat/xmake.git ``` å®‰è£…å®Œåæ£€æŸ¥æ˜¯å¦å®‰è£…å®Œæˆï¼š ```bash xmake version ``` ### å¯ç”¨ Luajit å¯¹äºä¸€äº›å¤§å‹é¡¹ç›®ï¼ˆæ¯”å¦‚åŒ…å« 300+ targetsï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¯ç”¨ Luajit åŠ é€Ÿæ„å»ºï¼Œæå‡æ„å»ºé€Ÿåº¦ã€‚ ```bash bash scripts/install.sh runtime luajit ``` ### ä»…æ›´æ–° lua è„šæœ¬ è¿™ä¸ªå¼€å‘è€…æœ¬åœ°è°ƒè¯• xmake æºç æ‰éœ€è¦ï¼š ```bash ./scripts/get.sh __local__ __install_only__ ``` ### ç¼–è¯‘ xmake bundle åŒ… é»˜è®¤ç¼–è¯‘æ–¹å¼ä¼šå®‰è£… xmake äºŒè¿›åˆ¶å’Œ Lua è„šæœ¬ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯æ–¹ä¾¿æºç è°ƒè¯• Lua è„šæœ¬ï¼Œä½†æ˜¯ä¸æ–¹ä¾¿å‘å¸ƒå’Œè¿ç§»ï¼Œå¯ä»¥åªç¼–è¯‘ xmake äºŒè¿›åˆ¶ï¼š ```bash # TODO: ``` ### root ä¸‹å®‰è£… xmake ä¸æ¨è root ä¸‹å®‰è£…ä½¿ç”¨ï¼Œå› ä¸ºè¿™å¾ˆä¸å®‰å…¨ã€‚å› æ­¤ä»¥ root ç”¨æˆ·è¿è¡Œ xmake ä¼šæ‰“å°ä¸€æ¡ warning æ—¥å¿—ï¼Œç”¨æˆ·å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ `XMAKE_ROOT y` å±è”½ç›¸å…³çš„æŠ¥è­¦ï¼Œç”¨æˆ·éœ€è¦éšæ—¶æ³¨æ„rootä¸‹è¯¯æ“ä½œç³»ç»Ÿæ–‡ä»¶æ–‡ä»¶çš„é£é™©ã€‚ ### å¯ç”¨ ccache é»˜è®¤æƒ…å†µä¸‹ xmake ç”¨çš„æ˜¯å†…éƒ¨çš„ xcacheï¼Œä½†å¯èƒ½ä¼šå‡ºç°ä¸€äº›éé¢„æœŸçš„ bugã€‚å¦‚æœéœ€è¦å¯ç”¨ ccacheï¼Œå¯ä»¥æ‰‹åŠ¨å®‰è£… ccacheï¼Œxmakeä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨ã€‚ ## æ›´æ–°å‡çº§ æˆ‘ä»¬å¯ä»¥é€šè¿‡ `xmake update` å‘½ä»¤æ¥å¿«é€Ÿè¿›è¡Œè‡ªæˆ‘æ›´æ–°å’Œå‡çº§ï¼Œé»˜è®¤æ˜¯å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šå‡çº§æˆ–è€…å›é€€åˆ°æŸä¸ª tag ç‰ˆæœ¬ï¼š ```bash # å¦‚æœä¸æ˜¯ force çš„è¯, xmake ç‰ˆæœ¬ä¸€æ ·å°±ä¼šè·³è¿‡å®‰è£…, ä¸ä¼šç²¾ç¡®åˆ° git tag / branch # ä¾‹å¦‚ xmake v3.0.4+dev.39db22335 ç‰ˆæœ¬ä¹Ÿä¼šè·³è¿‡ xmake update force diagnosis verbose v3.0.4 ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šæ›´æ–°åˆ° master/dev åˆ†æ”¯ç‰ˆæœ¬ï¼š ```bash xmake update master xmake update dev ``` ä»æŒ‡å®š git æºæ›´æ–°ï¼š ```bash # æŒ‡å®š github æº xmake update github:TOMO CAT/xmake#master # æŒ‡å®š gitee æº xmake update gitee:tomocat/xmake#dev ``` å¦‚æœ xmake/core æ²¡åŠ¨è¿‡ï¼Œä»…ä»…æ›´æ–° xmake çš„ lua è„šæœ¬æ”¹åŠ¨ï¼Œå¯ä»¥åŠ  ` s/ scriptonly` å¿«é€Ÿæ›´æ–° lua è„šæœ¬ï¼š ```bash xmake update scriptonly force dev ``` ## å¸è½½ æœ€åï¼Œæˆ‘ä»¬å¦‚æœè¦å¸è½½ xmakeï¼Œä¹Ÿæ˜¯æ”¯æŒçš„ï¼š ```bash rm rf /usr/local/share/xmake rm /usr/local/bin/xrepo rm /usr/local/bin/xmake ```"},"/get_started/zh/tutorial/syntax-description.html":{"title":"è¯­æ³•æè¿°","content":"# è¯­æ³•æè¿° xmake çš„å·¥ç¨‹æè¿°æ–‡ä»¶ xmake.lua è™½ç„¶åŸºäº lua è¯­æ³•ï¼Œä½†æ˜¯ä¸ºäº†ä½¿å¾—æ›´åŠ æ–¹ä¾¿ç®€æ´å¾—ç¼–å†™é¡¹ç›®æ„å»ºé€»è¾‘ï¼Œxmake å¯¹å…¶è¿›è¡Œäº†ä¸€å±‚å°è£…ï¼Œä½¿å¾—ç¼–å†™ xmake.lua ä¸ä¼šåƒå†™ makefile é‚£æ ·ç¹ç åŸºæœ¬ä¸Šå†™ä¸ªç®€å•çš„å·¥ç¨‹æ„å»ºæè¿°ï¼Œåªéœ€å››è¡Œå°±èƒ½æå®šï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` ## åŸŸé…ç½®è¯­æ³• æˆ‘ä»¬é»˜è®¤çº¦å®šçš„åŸŸé…ç½®è¯­æ³•ï¼Œå°½ç®¡éå¸¸ç®€æ´ï¼Œä½†æ˜¯å¯¹è‡ªåŠ¨æ ¼å¼åŒ–ç¼©è¿›å’Œ IDE ä¸æ˜¯å¾ˆå‹å¥½ã€‚ ```lua target(\"foo\") set_kind(\"binary\") add_files(\"src/*.cpp\") target_end() ``` å¦å¤–ï¼Œå®ƒä¸èƒ½è‡ªåŠ¨ç»“æŸå½“å‰ target ä½œç”¨åŸŸï¼Œç”¨æˆ·éœ€è¦æ˜¾å¼è°ƒç”¨ `target_end()`ã€‚ è™½ç„¶ï¼Œä¸Šé¢æˆ‘ä»¬æåˆ°ï¼Œå¯ä»¥ä½¿ç”¨ `do end` æ¨¡å¼æ¥è§£å†³è‡ªåŠ¨ç¼©è¿›é—®é¢˜ï¼Œä½†æ˜¯éœ€è¦ `target_end()` çš„é—®é¢˜è¿˜æ˜¯å­˜åœ¨ã€‚ ```lua target(\"bar\") do set_kind(\"binary\") add_files(\"src/*.cpp\") end target_end() ``` æˆ‘ä»¬æä¾›äº†ä¸€ç§æ›´å¥½çš„å¯é€‰åŸŸé…ç½®è¯­æ³•ï¼Œæ¥è§£å†³è‡ªåŠ¨ç¼©è¿›ï¼Œtarget åŸŸéš”ç¦»é—®é¢˜ï¼Œä¾‹å¦‚ï¼š ```lua add_defines(\"ROOT\") target(\"foo\", function () set_kind(\"binary\") add_files(\"src/*.cpp\") add_defines(\"FOO\") end) target(\"bar\", function () set_kind(\"binary\") add_files(\"src/*.cpp\") add_defines(\"BAR\") end) ``` foo å’Œ bar ä¸¤ä¸ªåŸŸæ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œæˆ‘ä»¬å³ä½¿åœ¨å®ƒä»¬ä¸­é—´é…ç½®å…¶ä»–è®¾ç½®ï¼Œä¹Ÿä¸ä¼šå½±å“å®ƒä»¬ï¼Œå¦å¤–ï¼Œå®ƒè¿˜å¯¹ LSP éå¸¸å‹å¥½ã€‚ > å› æ­¤æˆ‘ä»¬çº¦å®šï¼Œxmake.lua çš„åŸŸé…ç½®è¯­æ³•ï¼Œé»˜è®¤é‡‡ç”¨å¯é€‰çš„ `function () end` æ¨¡å¼ï¼Œå…¶ä»–æ¨¡å¼åç»­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚ ## é…ç½®åˆ†ç¦» xmake.lua é‡‡ç”¨äºŒå…«åŸåˆ™å®ç°äº†æè¿°åŸŸã€è„šæœ¬åŸŸä¸¤å±‚åˆ†ç¦»å¼é…ç½®ã€‚ ä»€ä¹ˆæ˜¯äºŒå…«åŸåˆ™å‘¢ï¼Œç®€å•æ¥è¯´ï¼Œå¤§éƒ¨åˆ†é¡¹ç›®çš„é…ç½®ï¼Œ80% çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯äº›åŸºç¡€çš„å¸¸è§„é…ç½®ï¼Œæ¯”å¦‚ï¼š`add_cxflags`, `add_links`ç­‰ï¼Œ åªæœ‰å‰©ä¸‹ä¸åˆ° 20% çš„åœ°æ–¹æ‰éœ€è¦é¢å¤–åšäº›å¤æ‚æ¥æ»¡è¶³ä¸€äº›ç‰¹æ®Šçš„é…ç½®éœ€æ±‚ã€‚ è€Œè¿™å‰©ä½™çš„ 20% çš„é…ç½®é€šå¸¸æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœç›´æ¥å……æ–¥åœ¨æ•´ä¸ª xmake.lua é‡Œé¢ï¼Œä¼šæŠŠæ•´ä¸ªé¡¹ç›®çš„é…ç½®æ•´ä¸ªå¾ˆæ··ä¹±ï¼Œéå¸¸ä¸å¯è¯»ã€‚ å› æ­¤ï¼Œxmake é€šè¿‡æè¿°åŸŸã€è„šæœ¬åŸŸä¸¤ç§ä¸åŒçš„é…ç½®æ–¹å¼ï¼Œæ¥éš”ç¦» 80% çš„ç®€å•é…ç½®ä»¥åŠ 20% çš„å¤æ‚é…ç½®ï¼Œä½¿å¾—æ•´ä¸ª xmake.lua çœ‹èµ·æ¥éå¸¸çš„æ¸…æ™°ç›´è§‚ï¼Œå¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§éƒ½è¾¾åˆ°æœ€ä½³ã€‚ ### æè¿°åŸŸ å¯¹äºåˆšå…¥é—¨çš„æ–°æ‰‹ç”¨æˆ·ï¼Œæˆ–è€…ä»…ä»…æ˜¯ç»´æŠ¤ä¸€äº›ç®€å•çš„å°é¡¹ç›®ï¼Œé€šè¿‡å®Œå…¨åœ¨æè¿°é…ç½®å°±å·²ç»å®Œå…¨æ»¡è¶³éœ€æ±‚äº†ï¼Œé‚£ä»€ä¹ˆæ˜¯æè¿°åŸŸå‘¢ï¼Ÿå®ƒé•¿è¿™æ ·ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_defines(\"DEBUG\") add_syslinks(\"pthread\") end) ``` ä¸€çœ¼æœ›å»ï¼Œå…¶å®å°±æ˜¯ä¸ª `set_xxx`/`add_xxx` çš„é…ç½®é›†ï¼Œå¯¹äºæ–°æ‰‹ï¼Œå®Œå…¨å¯ä»¥ä¸æŠŠå®ƒå½“åš lua è„šæœ¬ï¼Œä»…ä»…ä½œä¸ºæ™®é€šçš„ï¼Œä½†æœ‰ä¸€äº›åŸºç¡€è§„åˆ™çš„é…ç½®æ–‡ä»¶å°±è¡Œäº†ã€‚ å¦‚æœå› ä¸ºï¼Œçœ‹ç€æœ‰æ‹¬å·ï¼Œè¿˜æ˜¯åƒè„šæœ¬è¯­è¨€çš„å‡½æ•°è°ƒç”¨ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼ˆæ˜¯å¦å¸¦æ‹¬å·çœ‹ä¸ªäººå–œå¥½ï¼‰ï¼š ```lua target \"test\" Â Â Â Â set_kind \"binary\" Â Â Â Â add_files \"src/*.c\" Â Â Â Â add_defines \"DEBUG\" Â Â Â Â add_syslinks \"pthread\" ``` è¿™æ˜¯ä¸æ˜¯çœ‹ç€æ›´åƒé…ç½®æ–‡ä»¶äº†ï¼Ÿå…¶å®æè¿°åŸŸå°±æ˜¯é…ç½®æ–‡ä»¶ï¼Œç±»ä¼¼åƒ json ç­‰ key/values çš„é…ç½®è€Œå·²ï¼Œæ‰€ä»¥å³ä½¿å®Œå…¨ä¸ä¼š lua çš„æ–°æ‰‹ï¼Œä¹Ÿæ˜¯èƒ½å¾ˆå¿«ä¸Šæ‰‹çš„ã€‚ è€Œä¸”ï¼Œå¯¹äºé€šå¸¸çš„é¡¹ç›®ï¼Œä»…é€šè¿‡ `set_xxx/add_xxx` å»é…ç½®å„ç§é¡¹ç›®è®¾ç½®ï¼Œå·²ç»å®Œå…¨æ»¡è¶³éœ€æ±‚äº†ã€‚ è¿™ä¹Ÿå°±æ˜¯å¼€å¤´è¯´çš„ï¼š80% çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨æœ€ç®€å•çš„é…ç½®è§„åˆ™å»ç®€åŒ–é¡¹ç›®çš„é…ç½®ï¼Œæé«˜å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œè¿™æ ·å¯¹ç”¨æˆ·å’Œå¼€å‘è€…éƒ½ä¼šéå¸¸çš„å‹å¥½ï¼Œä¹Ÿæ›´åŠ ç›´è§‚ã€‚ å¦‚æœæˆ‘ä»¬è¦é’ˆå¯¹ä¸åŒå¹³å°ï¼Œæ¶æ„åšä¸€äº›æ¡ä»¶åˆ¤æ–­æ€ä¹ˆåŠï¼Ÿæ²¡å…³ç³»ï¼Œæè¿°åŸŸé™¤äº†åŸºç¡€é…ç½®ï¼Œä¹Ÿæ˜¯æ”¯æŒæ¡ä»¶åˆ¤æ–­ï¼Œä»¥åŠ for å¾ªç¯çš„ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_defines(\"DEBUG\") if is_plat(\"linux\", \"macosx\") then add_links(\"pthread\", \"m\", \"dl\") end end) ``` ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_defines(\"DEBUG\") for _, name in ipairs({\"pthread\", \"m\", \"dl\"}) do add_links(name) end end) ``` è¿™æ˜¯ä¸æ˜¯çœ‹ç€æœ‰ç‚¹åƒ lua äº†ï¼Ÿè™½è¯´ï¼Œå¹³å¸¸å¯ä»¥æŠŠå®ƒå½“åšæ™®é€šé…ç½®é—®é¢˜ï¼Œä½†æ˜¯ xmake æ¯•ç«ŸåŸºäº luaï¼Œæ‰€ä»¥æè¿°åŸŸè¿˜æ˜¯æ”¯æŒ lua çš„åŸºç¡€è¯­è¨€ç‰¹æ€§çš„ã€‚ > ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæè¿°åŸŸè™½ç„¶æ”¯æŒ lua çš„è„šæœ¬è¯­æ³•ï¼Œä½†åœ¨æè¿°åŸŸå°½é‡ä¸è¦å†™å¤ªå¤æ‚çš„ lua è„šæœ¬ï¼Œæ¯”å¦‚ä¸€äº›è€—æ—¶çš„å‡½æ•°è°ƒç”¨å’Œ for å¾ªç¯ å¹¶ä¸”åœ¨æè¿°åŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è®¾ç½®é…ç½®é¡¹ï¼Œå› æ­¤ xmake å¹¶æ²¡æœ‰å®Œå…¨å¼€æ”¾æ‰€æœ‰çš„æ¨¡å—æ¥å£ï¼Œå¾ˆå¤šæ¥å£åœ¨æè¿°åŸŸæ˜¯è¢«ç¦æ­¢è°ƒç”¨çš„ï¼Œ å³ä½¿å¼€æ”¾å‡ºæ¥çš„ä¸€äº›å¯è°ƒç”¨æ¥å£ï¼Œä¹Ÿæ˜¯å®Œå…¨åªè¯»çš„ï¼Œä¸è€—æ—¶çš„å®‰å…¨æ¥å£ï¼Œæ¯”å¦‚ï¼š`os.getenv()` ç­‰è¯»å–ä¸€äº›å¸¸è§„çš„ç³»ç»Ÿä¿¡æ¯ï¼Œç”¨äºé…ç½®é€»è¾‘çš„æ§åˆ¶ã€‚ > å¦å¤–éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œxmake.lua æ˜¯ä¼šè¢«å¤šæ¬¡è§£æçš„ï¼Œç”¨äºåœ¨ä¸åŒé˜¶æ®µè§£æä¸åŒçš„é…ç½®åŸŸï¼šæ¯”å¦‚ï¼š`option()`, `target()` ç­‰åŸŸã€‚ å› æ­¤ï¼Œä¸è¦æƒ³ç€åœ¨ xmake.lua çš„æè¿°åŸŸï¼Œå†™å¤æ‚çš„ lua è„šæœ¬ï¼Œä¹Ÿ**ä¸è¦åœ¨æè¿°åŸŸè°ƒç”¨ print å»æ˜¾ç¤ºä¿¡æ¯ï¼Œå› ä¸ºä¼šè¢«æ‰§è¡Œå¤šé**ã€‚ ### è„šæœ¬åŸŸ é™åˆ¶æè¿°åŸŸå†™å¤æ‚çš„ luaï¼Œå„ç§ lua æ¨¡å—å’Œæ¥å£éƒ½ç”¨ä¸äº†ï¼Ÿæ€ä¹ˆåŠï¼Ÿè¿™ä¸ªæ—¶å€™å°±æ˜¯è„šæœ¬åŸŸå‡ºåœºçš„æ—¶å€™äº†ã€‚ å¦‚æœç”¨æˆ·å·²ç»å®Œå…¨ç†Ÿæ‚‰äº† xmake çš„æè¿°åŸŸé…ç½®ï¼Œå¹¶ä¸”æ„Ÿè§‰æœ‰äº›æ»¡è¶³ä¸äº†é¡¹ç›®ä¸Šçš„ä¸€äº›ç‰¹æ®Šé…ç½®ç»´æŠ¤äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨è„šæœ¬åŸŸåšæ›´åŠ å¤æ‚çš„é…ç½®é€»è¾‘ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") on_load(function (target) if is_plat(\"linux\", \"macosx\") then target:add(\"links\", \"pthread\", \"m\", \"dl\") end end) after_build(function (target) import(\"core.project.config\") local targetfile target:targetfile() os.cp(targetfile, path.join(config.buildir(), path.filename(targetfile))) print(\"build %s\", targetfile) end) end) ``` åªè¦æ˜¯ç±»ä¼¼ï¼š`on_xxx`, `after_xxx`, `before_xxx` ç­‰å­—æ ·çš„ function body å†…éƒ¨çš„è„šæœ¬ï¼Œéƒ½å±äºè„šæœ¬åŸŸã€‚ åœ¨è„šæœ¬åŸŸä¸­ï¼Œç”¨æˆ·å¯ä»¥å¹²ä»»ä½•äº‹ï¼Œxmake æä¾›äº† import æ¥å£å¯ä»¥å¯¼å…¥ xmake å†…ç½®çš„å„ç§ lua æ¨¡å—ï¼Œä¹Ÿå¯ä»¥å¯¼å…¥ç”¨æˆ·æä¾›çš„ lua è„šæœ¬ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨è„šæœ¬åŸŸå®ç°ä½ æƒ³å®ç°çš„ä»»æ„åŠŸèƒ½ï¼Œç”šè‡³å†™ä¸ªç‹¬ç«‹é¡¹ç›®å‡ºæ¥éƒ½æ˜¯å¯ä»¥çš„ã€‚ å¯¹äºä¸€äº›è„šæœ¬ç‰‡æ®µï¼Œä¸æ˜¯å¾ˆè‡ƒè‚¿çš„è¯ï¼Œåƒä¸Šé¢è¿™ä¹ˆå†…ç½®å†™å†™å°±è¶³å¤Ÿäº†ï¼Œå¦‚æœéœ€è¦å®ç°æ›´åŠ å¤æ‚çš„è„šæœ¬ï¼Œä¸æƒ³å……æ–¥åœ¨ä¸€ä¸ª xmake.lua é‡Œé¢ï¼Œå¯ä»¥æŠŠè„šæœ¬åˆ†ç¦»åˆ°ç‹¬ç«‹çš„ lua æ–‡ä»¶ä¸­å»ç»´æŠ¤ã€‚ ä¾‹å¦‚ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") on_load(\"modules.test.load\") on_install(\"modules.test.install\") end) ``` æˆ‘ä»¬å¯ä»¥æŠŠè‡ªå®šä¹‰çš„è„šæœ¬æ”¾ç½®åˆ° xmake.lua å¯¹åº”ç›®å½•ä¸‹ï¼Œ`modules/test/load.lua` å’Œ `modules/test/install.lua` ä¸­ç‹¬ç«‹ç»´æŠ¤ã€‚ è¿™äº›ç‹¬ç«‹çš„ lua è„šæœ¬é‡Œé¢ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡[import](/zh cn/manual/builtin_modules?id import)å¯¼å…¥å„ç§å†…ç½®æ¨¡å—å’Œè‡ªå®šä¹‰æ¨¡å—è¿›æ¥ä½¿ç”¨ï¼Œå°±è·Ÿå¹³å¸¸å†™lua, java æ²¡å•¥åŒºåˆ«ã€‚ è€Œå¯¹äºè„šæœ¬çš„åŸŸçš„ä¸åŒé˜¶æ®µï¼Œ`on_load` ä¸»è¦ç”¨äº target åŠ è½½æ—¶å€™ï¼Œåšä¸€äº›åŠ¨æ€åŒ–çš„é…ç½®ï¼ˆæ³¨æ„è¿™é‡Œä¸åƒæè¿°åŸŸï¼Œåªä¼šæ‰§è¡Œä¸€éï¼‰ã€‚ å…¶ä»–é˜¶æ®µï¼Œè¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š`on/after/before`_`build/install/package/run` ç­‰ï¼Œå…·ä½“çœ‹ä¸‹åé¢çš„ target api æ‰‹å†Œéƒ¨åˆ†å§ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†ã€‚ ## é…ç½®ç±»å‹ åœ¨æè¿°åŸŸé…ç½®ä¸­ï¼Œåˆ†é…ç½®åŸŸå’Œé…ç½®é¡¹ï¼Œé…ç½®åŸŸé‡Œé¢å¯ä»¥é€šè¿‡ `set_xxx`/`add_xxx` çš„æ¥å£ï¼Œé…ç½®å„ç§é…ç½®é¡¹ã€‚ ```lua target(\"test1\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) target(\"test2\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` åƒä¸Šè¿°é…ç½®ä¸­ï¼Œtarget å°±å±äºé…ç½®åŸŸï¼Œå®ƒä¸‹é¢çš„æ‰€æœ‰ `set_xx`/`add_xxx` æ¥å£é…ç½®éƒ½å±äºé…ç½®é¡¹ï¼Œå¯¹è¿™ä¸ª target å±€éƒ¨ç”Ÿæ•ˆã€‚ æˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£æˆå±€éƒ¨ä½œç”¨åŸŸï¼Œç±»ä¼¼ c é‡Œé¢çš„ block å—ï¼š ``` target(\"test1\") { set_kind(\"binary\") add_files(\"src/*.c\") } target(\"test2\") { set_kind(\"binary\") add_files(\"src/*.c\") } ``` ä¸è¿‡ï¼Œä¸ºäº†ç®€åŒ–å†™æ³•ï¼Œxmake çº¦å®šæ¯ä¸ªæ–°å®šä¹‰çš„ target åŸŸå¼€å§‹ï¼Œä¸Šä¸€ä¸ªé…ç½®åŸŸå°±è‡ªåŠ¨ç»“æŸäº†ï¼Œå½“ç„¶ï¼Œå¦‚æœè¿™æ ·ç”¨æˆ·è§‰å¾—æœ‰å›°æ‰°ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨é…ç½®ç¦»å¼€åŸŸï¼š ```lua target(\"test1\") set_kind(\"binary\") add_files(\"src/*.c\") target_end() target(\"test2\") set_kind(\"binary\") add_files(\"src/*.c\") target_end() ``` ### é…ç½®åŸŸ ç›®å‰æä¾›çš„é…ç½®åŸŸæœ‰ï¼š`target()`, `option()`, `task()`, `package()` æ¯ä¸ªåŸŸçš„è¯¦ç»†è¯´æ˜ï¼Œè§ï¼š[APIæ‰‹å†Œ](/zh cn/manual/project_target) ### é…ç½®é¡¹ åªè¦æ˜¯å¸¦æœ‰ `set_xxx` å’Œ `add_xxx` å­—æ ·çš„é…ç½®ï¼Œéƒ½å±äºé…ç½®é¡¹ï¼Œä¸€ä¸ªé…ç½®åŸŸé‡Œé¢å¯ä»¥è®¾ç½®å¤šä¸ªé…ç½®é¡¹ã€‚ å…³äºé…ç½®é¡¹çš„è§„èŒƒè¯´æ˜ï¼Œè§ï¼š[æ¥å£è§„èŒƒ](/zh cn/manual/specification) ## ä½œç”¨åŸŸ xmake çš„æè¿°è¯­æ³•æ˜¯æŒ‰ä½œç”¨åŸŸåˆ’åˆ†çš„ï¼Œä¸»è¦åˆ†ä¸ºï¼š å¤–éƒ¨ä½œç”¨åŸŸ å†…éƒ¨ä½œç”¨åŸŸ æ¥å£ä½œç”¨åŸŸ é‚£å“ªäº›å±äºå¤–éƒ¨ï¼Œå“ªäº›åˆå±äºå†…éƒ¨å‘¢ï¼Œçœ‹çœ‹ä¸‹é¢çš„æ³¨é‡Šï¼Œå°±çŸ¥é“ä¸ªå¤§æ¦‚äº†ï¼š ```lua å¤–éƒ¨ä½œç”¨åŸŸ target(\"test\", function() å¤–éƒ¨ä½œç”¨åŸŸ set_kind(\"binary\") add_files(\"src/*.c\") on_run(function () å†…éƒ¨ä½œç”¨åŸŸ end) after_package(function () å†…éƒ¨ä½œç”¨åŸŸ end) end) å¤–éƒ¨ä½œç”¨åŸŸ task(\"hello\", function() å¤–éƒ¨ä½œç”¨åŸŸ on_run(function () å†…éƒ¨ä½œç”¨åŸŸ end) end) ``` ç®€å•çš„è¯´ï¼Œå°±æ˜¯åœ¨è‡ªå®šä¹‰è„šæœ¬ `function () end` ä¹‹å†…çš„éƒ½å±äºå†…éƒ¨ä½œç”¨åŸŸï¼Œä¹Ÿå°±æ˜¯è„šæœ¬ä½œç”¨åŸŸï¼Œå…¶ä»–åœ°æ–¹éƒ½æ˜¯éƒ½å±äºäºå¤–éƒ¨ä½œç”¨åŸŸã€‚ã€‚ ### å¤–éƒ¨ä½œç”¨åŸŸ å¯¹äºå¤§éƒ¨åˆ†å·¥ç¨‹æ¥è¯´ï¼Œå¹¶ä¸éœ€è¦å¾ˆå¤æ‚çš„å·¥ç¨‹æè¿°ï¼Œä¹Ÿä¸éœ€è¦è‡ªå®šä¹‰è„šæœ¬æ”¯æŒï¼Œåªéœ€è¦ç®€å•çš„ `set_xxx` æˆ–è€… `add_xxx` å°±èƒ½æ»¡è¶³éœ€æ±‚äº† é‚£ä¹ˆæ ¹æ®äºŒå…«å®šå¾‹ï¼Œ80% çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦è¿™ä¹ˆå†™ï¼š ```lua target(\"test\", function() set_kind(\"static\") add_files(\"src/test/*.c\") end) target(\"demo\", function() add_deps(\"test\") set_kind(\"binary\") add_links(\"test\") add_files(\"src/demo/*.c\") end) ``` ä¸éœ€è¦å¤æ‚çš„ api è°ƒç”¨ï¼Œä¹Ÿä¸éœ€è¦å„ç§ç¹ççš„å˜é‡å®šä¹‰ï¼Œä»¥åŠ if åˆ¤æ–­ å’Œ for å¾ªç¯ï¼Œè¦çš„å°±æ˜¯ç®€æ´å¯è¯»ï¼Œä¸€çœ¼çœ‹è¿‡å»ï¼Œå°±ç®—ä¸æ‡‚ lua è¯­æ³•ä¹Ÿæ²¡å…³ç³» å°±å½“åšç®€å•çš„æè¿°è¯­æ³•ï¼Œçœ‹ä¸Šå»æœ‰ç‚¹åƒå‡½æ•°è°ƒç”¨è€Œå·²ï¼Œä¼šç‚¹ç¼–ç¨‹çš„åŸºæœ¬ä¸€çœ‹å°±çŸ¥é“æ€ä¹ˆé…ç½®ã€‚ ä¸ºäº†åšåˆ°ç®€æ´ã€å®‰å…¨ï¼Œåœ¨è¿™ä¸ªä½œç”¨åŸŸå†…ï¼Œå¾ˆå¤š lua å†…ç½® api æ˜¯ä¸å¼€æ”¾å‡ºæ¥çš„ï¼Œå°¤å…¶æ˜¯è·Ÿå†™æ–‡ä»¶ã€ä¿®æ”¹æ“ä½œç¯å¢ƒç›¸å…³çš„ï¼Œä»…ä»…æä¾›ä¸€äº›åŸºæœ¬çš„åªè¯»æ¥å£ï¼Œå’Œé€»è¾‘æ“ä½œ ç›®å‰å¤–éƒ¨ä½œç”¨åŸŸå¼€æ”¾çš„ lua å†…ç½® api æœ‰ï¼š table string pairs ipairs print os å½“ç„¶è™½ç„¶å†…ç½® lua api æä¾›ä¸å¤šï¼Œä½† xmake è¿˜æä¾›äº†å¾ˆå¤šæ‰©å±• apiï¼Œåƒæè¿° api å°±ä¸å¤šè¯´ï¼Œè¯¦ç»†å¯å‚è€ƒï¼š[APIæ‰‹å†Œ](/zh cn/manual/builtin_modules) è¿˜æœ‰äº›è¾…åŠ© apiï¼Œä¾‹å¦‚ï¼š dirsï¼šæ‰«æè·å–å½“å‰æŒ‡å®šè·¯å¾„ä¸­çš„æ‰€æœ‰ç›®å½• filesï¼šæ‰«æè·å–å½“å‰æŒ‡å®šè·¯å¾„ä¸­çš„æ‰€æœ‰æ–‡ä»¶ format: æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œstring.format çš„ç®€å†™ç‰ˆæœ¬ è¿˜æœ‰å˜é‡å®šä¹‰ã€é€»è¾‘æ“ä½œä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œæ¯•ç«Ÿæ˜¯åŸºäº lua çš„ï¼Œè¯¥æœ‰çš„åŸºç¡€è¯­æ³•ï¼Œè¿˜æ˜¯è¦æœ‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ if æ¥åˆ‡æ¢ç¼–è¯‘æ–‡ä»¶ï¼š ```lua target(\"test\", function() set_kind(\"static\") if is_plat(\"iphoneos\") then add_files(\"src/test/ios/*.c\") else add_files(\"src/test/*.c\") end end) ``` éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå˜é‡å®šä¹‰åˆ†å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡ï¼Œå±€éƒ¨å˜é‡åªå¯¹å½“å‰ xmake.lua æœ‰æ•ˆï¼Œä¸å½±å“å­ xmake.lua ```lua å±€éƒ¨å˜é‡ï¼Œåªå¯¹å½“å‰xmake.luaæœ‰æ•ˆ local var1 0 å…¨å±€å˜é‡ï¼Œå½±å“æ‰€æœ‰ä¹‹å includes() åŒ…å«çš„å­ xmake.lua var2 1 includes(\"src\") ``` ### å†…éƒ¨ä½œç”¨åŸŸ ä¹Ÿç§°æ’ä»¶ã€è„šæœ¬ä½œç”¨åŸŸï¼Œæä¾›æ›´åŠ å¤æ‚ã€çµæ´»çš„è„šæœ¬æ”¯æŒï¼Œä¸€èˆ¬ç”¨äºç¼–å†™ä¸€äº›è‡ªå®šä¹‰è„šæœ¬ã€æ’ä»¶å¼€å‘ã€è‡ªå®šä¹‰ task ä»»åŠ¡ã€è‡ªå®šä¹‰æ¨¡å—ç­‰ç­‰ ä¸€èˆ¬é€šè¿‡ `function () end` åŒ…å«ï¼Œå¹¶ä¸”è¢«ä¼ å…¥åˆ° `on_xxx`, `before_xxx` å’Œ `after_xxx` æ¥å£å†…çš„ï¼Œéƒ½å±äºè‡ªä½œç”¨åŸŸã€‚ ä¾‹å¦‚ï¼š ```lua è‡ªå®šä¹‰è„šæœ¬ target(\"hello\", function() after_build(function () å†…éƒ¨ä½œç”¨åŸŸ end) end) è‡ªå®šä¹‰ä»»åŠ¡ã€æ’ä»¶ task(\"hello\", function() on_run(function () å†…éƒ¨ä½œç”¨åŸŸ end) end) ``` åœ¨æ­¤ä½œç”¨åŸŸä¸­ï¼Œä¸ä»…å¯ä»¥ä½¿ç”¨å¤§éƒ¨åˆ† lua çš„ apiï¼Œè¿˜å¯ä»¥ä½¿ç”¨å¾ˆå¤š xmake æä¾›çš„æ‰©å±•æ¨¡å—ï¼Œæ‰€æœ‰æ‰©å±•æ¨¡å—ï¼Œé€šè¿‡ import æ¥å¯¼å…¥ å…·ä½“å¯å‚è€ƒï¼š[importæ¨¡å—å¯¼å…¥æ–‡æ¡£](/zh cn/manual/builtin_modules?id import) è¿™é‡Œæˆ‘ä»¬ç»™ä¸ªç®€å•çš„ä¾‹å­ï¼Œåœ¨ç¼–è¯‘å®Œæˆåï¼Œå¯¹ ios ç›®æ ‡ç¨‹åºè¿›è¡Œ ldid ç­¾åï¼š ```lua target(\"iosdemo\", function() set_kind(\"binary\") add_files(\"*.m\") after_build(function (target) æ‰§è¡Œç­¾åï¼Œå¦‚æœå¤±è´¥ï¼Œè‡ªåŠ¨ä¸­æ–­ï¼Œç»™å‡ºé«˜äº®é”™è¯¯ä¿¡æ¯ os.run(\"ldid S$(projectdir)/entitlements.plist %s\", target:targetfile()) end) end) ``` éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å†…éƒ¨ä½œç”¨åŸŸä¸­ï¼Œæ‰€æœ‰çš„è°ƒç”¨éƒ½æ˜¯å¯ç”¨å¼‚å¸¸æ•è·æœºåˆ¶çš„ï¼Œå¦‚æœè¿è¡Œå‡ºé”™ï¼Œä¼šè‡ªåŠ¨ä¸­æ–­ xmakeï¼Œå¹¶ç»™å‡ºé”™è¯¯æç¤ºä¿¡æ¯ å› æ­¤ï¼Œè„šæœ¬å†™èµ·æ¥ï¼Œä¸éœ€è¦ç¹ççš„ `if retval then` åˆ¤æ–­ï¼Œè„šæœ¬é€»è¾‘æ›´åŠ ä¸€ç›®äº†ç„¶ ### æ¥å£ä½œç”¨åŸŸ åœ¨å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„æ‰€æœ‰æè¿°apiè®¾ç½®ï¼Œæœ¬èº«ä¹Ÿæ˜¯æœ‰ä½œç”¨åŸŸä¹‹åˆ†çš„ï¼Œåœ¨ä¸åŒåœ°æ–¹è°ƒç”¨ï¼Œå½±å“èŒƒå›´ä¹Ÿä¸ç›¸åŒï¼Œä¾‹å¦‚ï¼š ```lua å…¨å±€æ ¹ä½œç”¨åŸŸï¼Œå½±å“æ‰€æœ‰ targetï¼ŒåŒ…æ‹¬ includes() ä¸­çš„å­å·¥ç¨‹ target è®¾ç½® add_defines(\"DEBUG\") å®šä¹‰æˆ–è€…è¿›å…¥ demo ç›®æ ‡ä½œç”¨åŸŸï¼ˆæ”¯æŒå¤šæ¬¡è¿›å…¥æ¥è¿½åŠ è®¾ç½®ï¼‰ target(\"demo\", function() set_kind(\"shared\") add_files(\"src/*.c\") å½“å‰ target ä½œç”¨åŸŸï¼Œä»…ä»…å½±å“å½“å‰ target add_defines(\"DEBUG2\") end) é€‰é¡¹è®¾ç½®ï¼Œä»…æ”¯æŒå±€éƒ¨è®¾ç½®ï¼Œä¸å—å…¨å±€ api è®¾ç½®æ‰€å½±å“ option(\"test\", function() å½“å‰é€‰é¡¹çš„å±€éƒ¨ä½œç”¨åŸŸ set_default(false) end) å…¶ä»–targetè®¾ç½®ï¼Œ DDEBUG ä¹Ÿä¼šè¢«è®¾ç½®ä¸Š target(\"demo2\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) é‡æ–°è¿›å…¥demoç›®æ ‡ä½œç”¨åŸŸ target(\"demo\", function() è¿½åŠ å®å®šä¹‰ï¼Œåªå¯¹å½“å‰demoç›®æ ‡æœ‰æ•ˆ add_defines(\"DEBUG3\") end) ``` é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿›å…¥å¦ä¸€ä¸ª target/option åŸŸè®¾ç½®ï¼Œä¼šè‡ªåŠ¨ç¦»å¼€ä¸Šä¸ª target/option åŸŸï¼Œä½†æ˜¯æœ‰æ—¶å€™ä¸ºäº†æ¯”è¾ƒä¸€äº›ä½œç”¨åŸŸæ±¡æŸ“æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºç¦»å¼€æŸä¸ªåŸŸï¼Œä¾‹å¦‚ï¼š ```lua option(\"test\") set_default(false) option_end() target(\"demo\") set_kind(\"binary\") add_files(\"src/*.c\") target_end() ``` è°ƒç”¨ `option_end()`, `target_end()` å³å¯æ˜¾å¼çš„ç¦»å¼€å½“å‰ target/option åŸŸè®¾ç½®ã€‚ ### ä»£ç æ ¼å¼åŒ– ç”±äºé»˜è®¤çš„æè¿°åŸŸé…ç½®è¯­æ³•çš„ç¼©è¿›å¹¶ä¸ç¬¦åˆ lua æ ¼å¼è§„èŒƒï¼Œå› æ­¤ lua language server æ˜¯ä¸æ”¯æŒå¯¹å®ƒè¿›è¡Œæ ¼å¼åŒ–å¤„ç†çš„ã€‚ å¦‚æœæƒ³è¦è®© IDEï¼Œç¼–è¾‘å™¨æ›´å¥½çš„å¯¹é…ç½®è¿›è¡Œæ ¼å¼åŒ–ç¼©è¿›æ”¯æŒï¼Œæˆ‘ä¹ˆå¯ä»¥é€šè¿‡ `do end` çš„å†™æ³•æ¥å¤„ç†ï¼š ```lua target(\"bar\") do set_kind(\"binary\") add_files(\"src/*.cpp\") end target(\"foo\") do set_kind(\"binary\") add_files(\"src/*.cpp\") end ``` è¿™æ ·ï¼ŒLua LSP å°±èƒ½æŠŠå®ƒä½œä¸ºæ ‡å‡†çš„ lua ä»£ç è¿›è¡Œæ­£ç¡®çš„æ ¼å¼åŒ–ï¼Œæ˜¯å¦éœ€è¦è¿™ä¹ˆåšï¼Œçœ‹ç”¨æˆ·è‡ªå·±çš„éœ€æ±‚ã€‚ å¦‚æœæ²¡æœ‰ä»£ç è‡ªåŠ¨æ ¼å¼åŒ–çš„ä½¿ç”¨ä¹ æƒ¯ï¼Œé‚£å°±ä¸éœ€è¦è¿™ä¹ˆåšã€‚ ## å¤šçº§é…ç½® åœ¨è„šæœ¬åŸŸæˆ‘ä»¬å¯ä»¥é€šè¿‡ import å¯¼å…¥å„ç§ä¸°å¯Œçš„æ‰©å±•æ¨¡å—æ¥ä½¿ç”¨ï¼Œè€Œåœ¨æè¿°åŸŸæˆ‘ä»¬å¯ä»¥é€šè¿‡[includes](/#/zh cn/manual/global_interfaces?id includes)æ¥å£ï¼Œæ¥å¼•å…¥é¡¹ç›®å­ç›®å½•ä¸‹çš„ xmake.lua é…ç½®ã€‚ è®°ä½ï¼šxmake çš„ includes æ˜¯æŒ‰ç…§ tree ç»“æ„æ¥å¤„ç†é…ç½®å…³ç³»çš„ï¼Œå­ç›®å½•ä¸‹çš„ xmake.lua é‡Œé¢çš„ target é…ç½®ä¼šç»§æ‰¿çˆ¶ xmake.lua ä¸­çš„æ ¹åŸŸé…ç½®ï¼Œä¾‹å¦‚ï¼š ç›®å‰æœ‰å¦‚ä¸‹é¡¹ç›®ç»“æ„ï¼š ``` projectdir xmake.lua src xmake.lua ``` `projectdir/xmake.lua` æ˜¯é¡¹ç›®çš„æ ¹ xmake.lua é…ç½®ï¼Œè€Œ `src/xmake.lua` æ˜¯é¡¹ç›®çš„å­é…ç½®ã€‚ `projectdir/xmake.lua` å†…å®¹ï¼š ```lua add_defines(\"ROOT\") target(\"test1\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_defines(\"TEST1\") end) target(\"test2\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_defines(\"TEST2\") end) includes(\"src\") ``` é‡Œé¢å…¨å±€æ ¹åŸŸé…ç½®äº† `add_defines(\"ROOT\")`ï¼Œä¼šå½±å“ä¸‹é¢çš„æ‰€æœ‰ target é…ç½®ï¼ŒåŒ…æ‹¬ includes é‡Œé¢å­ xmake.lua ä¸­çš„æ‰€æœ‰ target é…ç½®ï¼Œæ‰€ä»¥è¿™ä¸ªæ˜¯å…¨å±€æ€»é…ç½®ã€‚ è€Œåœ¨ test1/test2 é‡Œé¢çš„ `add_defines(\"TEST1\")` å’Œ `add_defines(\"TEST2\")` å±äºå±€éƒ¨é…ç½®ï¼Œåªå¯¹å½“å‰ target ç”Ÿæ•ˆã€‚ `src/xmake.lua` å†…å®¹ï¼š ```lua add_defines(\"ROOT2\") target(\"test3\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_defines(\"TEST3\") end) ``` åœ¨ `src/xmake.lua` å­é…ç½®ä¸­ï¼Œä¹Ÿæœ‰ä¸ªå…¨å±€æ ¹åŸŸï¼Œé…ç½®äº† `add_defines(\"ROOT2\")`ï¼Œè¿™ä¸ªå±äºå­é…ç½®æ ¹åŸŸï¼Œåªå¯¹å½“å‰å­ xmake.lua é‡Œé¢æ‰€æœ‰ target ç”Ÿæ•ˆï¼Œä¹Ÿä¼šå¯¹ä¸‹çº§ includes é‡Œé¢çš„å­ xmake.lua ä¸­ target ç”Ÿæ•ˆï¼Œå› ä¸ºä¹‹å‰è¯´äº†ï¼Œxmake æ˜¯ tree çŠ¶ç»“æ„çš„é…ç½®ç»§æ‰¿å…³ç³»ã€‚ æ‰€ä»¥ï¼Œè¿™å‡ ä¸ª target çš„æœ€ç»ˆé…ç½®ç»“æœä¾æ¬¡æ˜¯ï¼š ``` target(\"test1\"): DROOT DTEST1 target(\"test2\"): DROOT DTEST2 target(\"test3\"): DROOT DROOT2 DTEST3 ``` ## è¯­æ³•ç®€åŒ– xmake.lua çš„é…ç½®åŸŸè¯­æ³•ï¼Œéå¸¸çµæ´»ï¼Œå¯ä»¥åœ¨ç›¸å…³åŸŸåšå„ç§å¤æ‚çµæ´»çš„é…ç½®ï¼Œä½†æ˜¯å¯¹äºè®¸å¤šç²¾ç®€çš„å°å—é…ç½®ï¼Œè¿™ä¸ªæ—¶å€™å°±ç¨æ˜¾å†—ä½™äº†ï¼š ```lua option(\"test1\", function() set_default(true) set_showmenu(true) set_description(\"test1 option\") end) option(\"test2\", function() set_default(true) set_showmeu(true) end) option(\"test3\", function() set_default(\"hello\") end) ``` å¯¹äºä¸Šé¢çš„è¿™äº›å°å— option åŸŸè®¾ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–ä¸‹æˆå•è¡Œæè¿°ï¼š ```lua option(\"test1\", {default true, showmenu true, description \"test1 option\"}) option(\"test2\", {default true, showmenu true}) option(\"test3\", {default \"hello\"}) ``` é™¤äº† option åŸŸï¼Œå¯¹äºå…¶ä»–åŸŸä¹Ÿæ˜¯æ”¯æŒè¿™ç§ç®€åŒ–å†™æ³•çš„ï¼Œä¾‹å¦‚ï¼š ```lua target(\"demo\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` ç®€åŒ–ä¸ºï¼š ```lua target(\"demo\", {kind \"binary\", files \"src/*.c\"}) ``` æˆ–è€… ```lua target(\"demo\", { kind \"binary\", files \"src/*.c\" }) ``` å½“ç„¶ï¼Œå¦‚æœé…ç½®éœ€æ±‚æ¯”è¾ƒå¤æ‚çš„ï¼Œè¿˜æ˜¯åŸæœ‰çš„å¤šè¡Œè®¾ç½®æ–¹å¼æ›´åŠ æ–¹ä¾¿ï¼Œè¿™ä¸ªå°±çœ‹è‡ªå·±çš„éœ€æ±‚æ¥è¯„ä¼°åˆ°åº•ä½¿ç”¨å“ªç§æ–¹å¼äº†ã€‚"},"/get_started/zh/tutorial/FAQ.html":{"title":"FAQ","content":"# FAQ ## æ€æ ·è·å–æ›´å¤šå‚æ•°é€‰é¡¹ä¿¡æ¯ï¼Ÿ è·å–ä¸»èœå•çš„å¸®åŠ©ä¿¡æ¯ï¼Œé‡Œé¢æœ‰æ‰€æœ‰ action å’Œ plugin çš„åˆ—è¡¨æè¿°ã€‚ ```bash $ xmake [ h help] ``` è·å–é…ç½®èœå•çš„å¸®åŠ©ä¿¡æ¯ï¼Œé‡Œé¢æœ‰æ‰€æœ‰é…ç½®é€‰é¡¹çš„æè¿°ä¿¡æ¯ï¼Œä»¥åŠæ”¯æŒå¹³å°ã€æ¶æ„åˆ—è¡¨ã€‚ ```bash $ xmake f [ h help] ``` è·å– action å’Œ plugin å‘½ä»¤èœå•çš„å¸®åŠ©ä¿¡æ¯ï¼Œé‡Œé¢æœ‰æ‰€æœ‰å†…ç½®å‘½ä»¤å’Œæ’ä»¶ä»»åŠ¡çš„å‚æ•°ä½¿ç”¨ä¿¡æ¯ã€‚ ```bash $ xmake [actionplugin] [ h help] ``` ä¾‹å¦‚ï¼Œè·å– `run` å‘½ä»¤çš„å‚æ•°ä¿¡æ¯ : ```bash $ xmake run help ``` ## æ€æ ·å®ç°é™é»˜æ„å»ºï¼Œä¸è¾“å‡ºä»»ä½•ä¿¡æ¯ï¼Ÿ ```bash $ xmake [ q quiet] ``` ## å¦‚æœ xmake è¿è¡Œå¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ å¯ä»¥å…ˆå°è¯•æ¸…é™¤ä¸‹é…ç½®ï¼Œé‡æ–°æ„å»ºä¸‹ï¼š ```bash $ xmake f c $ xmake ``` å¦‚æœè¿˜æ˜¯å¤±è´¥äº†ï¼Œè¯·åŠ ä¸Š ` v` æˆ–è€… ` verbose` é€‰é¡¹é‡æ–°æ‰§è¡Œ xmake åï¼Œè·å–æ›´åŠ è¯¦ç»†çš„è¾“å‡ºä¿¡æ¯ ä¾‹å¦‚ï¼š ```hash $ xmake [ v verbose] ``` å¹¶ä¸”å¯ä»¥åŠ ä¸Š ` D` é€‰é¡¹è·å–å‡ºé”™æ—¶çš„ xmake çš„è°ƒè¯•æ ˆä¿¡æ¯å’Œå…¶ä»–æ›´è¯¦ç»†çš„è¯Šæ–­ä¿¡æ¯ , ç„¶åä½ å¯ä»¥æäº¤è¿™äº›ä¿¡æ¯åˆ° [issues](https://github.com/TOMO CAT/xmake/issues)ã€‚ ```bash $ xmake v D ``` ## æ€æ ·çœ‹å®æ—¶ç¼–è¯‘è­¦å‘Šä¿¡æ¯ ? ä¸ºäº†é¿å…åˆ·å±ï¼Œåœ¨æ„å»ºæ—¶å€™ï¼Œé»˜è®¤æ˜¯ä¸å®æ—¶è¾“å‡ºè­¦å‘Šä¿¡æ¯çš„ï¼Œå¦‚æœæƒ³è¦çœ‹çš„è¯å¯ä»¥åŠ ä¸Š ` w` é€‰é¡¹å¯ç”¨ç¼–è¯‘è­¦å‘Šè¾“å‡ºå°±è¡Œäº†ã€‚ ```bash $ xmake [ w warning] ``` ## æ€æ ·åŸºäºæºç è‡ªåŠ¨ç”Ÿæˆ xmake.luaï¼Ÿ å¦‚æœä½ æƒ³ä¸´æ—¶å†™ä¸€ä¸¤ä¸ªæµ‹è¯•ä»£ç ã€æˆ–è€…æ‰‹ä¸Šæœ‰ä¸€äº›ç§»æ¤è¿‡æ¥çš„é›¶æ•£æºç æƒ³è¦å¿«é€Ÿç¼–è¯‘è¿è¡Œï¼Œå¯ä»¥ä¸ç”¨ä¸“é—¨å†™ xmake.luaï¼Œç›´æ¥è¿è¡Œï¼š ```bash $ xmake ``` xmake ä¼šè‡ªåŠ¨æ‰«æåˆ†æå½“å‰çš„æºç ç›®å½•ï¼Œè¯†åˆ«ç¨‹åºç»“æ„å’Œç±»å‹ï¼Œç”Ÿæˆä¸€ä¸ª xmake.luaï¼Œå¹¶ä¸”ä¼šå°è¯•ç›´æ¥æ„å»ºå®ƒã€‚ å¦‚æœç¼–è¯‘æˆåŠŸï¼Œå¯ä»¥ç›´æ¥è¿è¡Œï¼š ```bash $ xmake run ``` å½“ç„¶ï¼Œå¦‚æœä»…ä»…åªæ˜¯æƒ³è¦ç”Ÿæˆ xmake.luaï¼Œé»˜è®¤ä¸å»æ„å»ºï¼Œå¯ä»¥æ‰§è¡Œï¼š ```bash $ xmake f y ``` æ›´å¤šç›¸å…³ä»‹ç»ï¼Œè¯·å‚è€ƒæ–‡ç« ï¼š[xmake æ–°å¢æ™ºèƒ½ä»£ç æ‰«æç¼–è¯‘æ¨¡å¼ï¼Œæ— éœ€æ‰‹å†™ä»»ä½• make æ–‡ä»¶](https://tboox.org/cn/2017/01/07/build without makefile/) ## ä¸ºä»€ä¹ˆ xmake.lua ä¼šè¢«æ‰§è¡Œå¤šéï¼Ÿ xmake.lua é‡Œé¢åˆ†æè¿°åŸŸå’Œè„šæœ¬åŸŸï¼Œåœ¨æè¿°åŸŸé‡Œé¢ä¼šå¯¹å„ç§é…ç½®åŸŸè¿›è¡Œåˆ†é˜¶æ®µå¤šæ¬¡è§£æï¼Œæœ‰å¯èƒ½ä¼šæ‰§è¡Œå¤šéï¼Œå› æ­¤ä¸è¦åœ¨æè¿°åŸŸå†™å¤æ‚çš„è„šæœ¬ã€‚ å¦‚æœè¦å†™å„ç§å¤æ‚è„šæœ¬ï¼Œè¯·åœ¨è„šæœ¬åŸŸå†…è¿›è¡Œé…ç½®ï¼Œ`target/on_load` çš„è„šæœ¬åŸŸé‡Œé¢åŒæ ·å¯ä»¥çµæ´»é…ç½®å„ç§ target ç›¸å…³è®¾ç½®ï¼Œå¹¶ä¸”æä¾›æ›´å¼ºå¤§çš„ lua è„šæœ¬æ¨¡å—æ”¯æŒã€‚ æ›´å¤šç»†èŠ‚è§ï¼š[æè¿°è¯­æ³•è¯´æ˜](/zh cn/guide/syntax_description) ## å¦‚ä½•è°ƒè¯• Xmake æºç ? ### ä¸‹è½½æºç  ç”±äº xmake ä½¿ç”¨äº† git submodules ç»´æŠ¤å­æ¨¡å—ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢å‡ ç§æ–¹å¼æ‹‰å–å®Œæ•´æºç ã€‚ #### ä½¿ç”¨ git æ‹‰å– ```bash $ git clone recursive https://github.com/TOMO CAT/xmake.git ``` æˆ–è€… ```bash $ git clone https://github.com/TOMO CAT/xmake.git $ git submodule update init ``` #### ä» Github Releases ä¸‹è½½æºç åŒ… ç”±äº github æœ¬èº«çš„ downloads é™„ä»¶ä¸‹è½½ä¸æ”¯æŒå½’æ¡£ submodulesï¼Œå› æ­¤ Xmake æ¯æ¬¡å‘ç‰ˆéƒ½ä¼šå®Œæ•´æ‰“åŒ…ä¸€ä»½é¢å¤–çš„ tar åŒ…æºç ä¸Šä¼ åˆ° Releases ä¸Šã€‚ å› æ­¤ï¼Œä¸è¦ä¸‹è½½é”™è¯¯çš„é“¾æ¥åœ°å€ ä¸å®Œæ•´æºç ï¼š<https://github.com/TOMO CAT/xmake/archive/refs/tags/v3.0.4.tar.gz> å®Œæ•´æºç åŒ…ï¼š<https://github.com/TOMO CAT/xmake/releases/download/v3.0.4/xmake v3.0.4.tar.gz> ```bash wget https://github.com/TOMO CAT/xmake/releases/download/v3.0.4/xmake v3.0.4.tar.gz tar xvf xmake v3.0.4.tar.gz C xmake cd xmake ``` > Xmake çš„ tar æºç åŒ…æ²¡æœ‰é¡¶å±‚ xmake æ ¹ç›®å½•ï¼Œå› æ­¤è§£å‹æ—¶å€™æœ€å¥½å¸¦ä¸Š ` C xmake` æŒ‡å®šä¸‹è¾“å‡ºç›®å½•ã€‚ ### ç¼–è¯‘æºç  ç±» unix å¹³å°ç¯å¢ƒç¼–è¯‘ Xmakeï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æºç æ ¹ç›®å½•æ‰§è¡Œ make å°±è¡Œäº†ã€‚ ```bash $ cd xmake $ ./configure $ make ``` ### åŠ è½½è°ƒè¯• å¦‚æœç¼–è¯‘å®Œæˆï¼Œæˆ‘ä»¬å°±å¯ä»¥åŠ è½½åˆšåˆšç¼–è¯‘å¥½çš„ Xmake äºŒè¿›åˆ¶ core ç¨‹åºï¼Œç„¶åè¿è¡Œæœ¬åœ°çš„ Lua è„šæœ¬äº†ã€‚ åœ¨ Linux/macOS/FreeBSD ä¸Šåªéœ€è¦è¿è¡Œï¼š ```bash $ cd xmake $ source scripts/srcenv.profile ``` å°±èƒ½è¿›å…¥æœ¬åœ°æºç è°ƒè¯•ç¯å¢ƒã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿è¡Œï¼š ```bash $ xmake l os.programdir ``` æ¥éªŒè¯æˆ‘ä»¬æ˜¯å¦çœŸçš„åŠ è½½äº†æœ¬åœ°çš„ Lua è„šæœ¬ç¯å¢ƒã€‚ ### è°ƒè¯• core äºŒè¿›åˆ¶ é€šå¸¸è°ƒè¯• Xmake çš„ Lua è„šæœ¬ï¼Œåªéœ€è¦ç›´æ¥ä¿®æ”¹å½“å‰æºç ç›®å½•çš„ Lua è„šæœ¬å°±è¡Œäº†ï¼Œå®æ—¶ç”Ÿæ•ˆçš„ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦é‡å¤ç¼–è¯‘ core äºŒè¿›åˆ¶ã€‚ ä½†æ˜¯å¦‚æœæ˜¯ Xmake çš„ C ç«¯ core ç¨‹åºæœ‰é—®é¢˜ï¼Œéœ€è¦è°ƒè¯•æˆ–è€…åŠ æ¨¡å—ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡å¤ç¼–è¯‘äº†ã€‚ ç¼–è¯‘å®Œæˆï¼Œä¹Ÿæ˜¯å®æ—¶ç”Ÿæ•ˆçš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ C ä»£ç é‡Œé€šè¿‡ï¼š ```c xu_trace_i(\"hello %s\", \"xmake\"); ``` æ¥æ ¼å¼åŒ–æ‰“å°å„ç§è¾“å‡ºã€‚ å¦‚æœæ˜¯ sv ç­‰ Xmake ä¾èµ–çš„å„ç§ submodules å­æ¨¡å—æœ‰é—®é¢˜ï¼Œéœ€è¦è°ƒè¯•ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è¿›å…¥å­æ¨¡å—æºç ï¼Œä¿®æ”¹åé‡æ–°ç¼–è¯‘æ‰§è¡Œã€‚ ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦è´¡çŒ®ä¿®å¤è¡¥ä¸ï¼Œæˆ‘ä»¬éœ€è¦æäº¤ pr ç»™å­æ¨¡å—çš„ä»“åº“æ‰è¡Œï¼Œè¡¥ä¸åˆå¹¶åï¼Œä½œè€…ä¼šåœ¨ç‰¹å®šæ—¶é—´åŒæ­¥åˆ°åˆ° xmake æºç ä»“åº“ã€‚ ### æ–­ç‚¹è°ƒè¯• xmake ä¹Ÿæ”¯æŒ Lua æ–­ç‚¹è°ƒè¯•æ”¯æŒï¼Œé…åˆ [VSCode EmmyLua](https://github.com/EmmyLua/VSCode EmmyLua) æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨ VSCode ä¸­æ–­ç‚¹è°ƒè¯• xmake è‡ªèº«æºç ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ VSCode çš„æ’ä»¶å¸‚åœºå®‰è£… VSCode EmmyLua æ’ä»¶ï¼Œç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ›´æ–°ä¸‹ xmake repo ä»“åº“ä¿æŒæœ€æ–°ã€‚ ```bash xrepo update repo ``` > Xmake ä¹Ÿéœ€è¦ä¿æŒæœ€æ–°ç‰ˆæœ¬ã€‚ ç„¶åï¼Œåœ¨è‡ªå·±çš„å·¥ç¨‹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š ```bash $ xrepo env b emmylua_debugger xmake build ``` å…¶ä¸­ `xrepo env b emmylua_debugger` ç”¨äºç»‘å®š EmmyLua è°ƒè¯•å™¨æ’ä»¶ç¯å¢ƒï¼Œè€Œ ` ` åé¢çš„å‚æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬å®é™…éœ€è¦è¢«è°ƒè¯•çš„ xmake å‘½ä»¤ã€‚ é€šå¸¸æˆ‘ä»¬ä»…ä»…è°ƒè¯• `xmake build` æ„å»ºï¼Œå¦‚æœæƒ³è¦è°ƒè¯•å…¶ä»–å‘½ä»¤ï¼Œå¯ä»¥è‡ªå·±è°ƒæ•´ï¼Œæ¯”å¦‚æƒ³è¦è°ƒè¯• `xmake install o /tmp` å®‰è£…å‘½ä»¤ï¼Œé‚£ä¹ˆå¯ä»¥æ”¹æˆï¼š ```bash $ xrepo env b emmylua_debugger xmake install o /tmp ``` æ‰§è¡Œå®Œä¸Šé¢çš„å‘½ä»¤åï¼Œå®ƒä¸ä¼šç«‹å³é€€å‡ºï¼Œä¼šä¸€ç›´å¤„äºç­‰å¾…è°ƒè¯•çŠ¶æ€ï¼Œæœ‰å¯èƒ½æ²¡æœ‰ä»»ä½•è¾“å‡ºã€‚ è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬ä¸è¦æ€¥ç€é€€å‡ºå®ƒï¼Œç»§ç»­æ‰“å¼€ VSCodeï¼Œå¹¶åœ¨ VSCode ä¸­æ‰“å¼€ Xmake çš„ Lua è„šæœ¬æºç ç›®å½•ã€‚ ä¹Ÿå°±æ˜¯è¿™ä¸ªç›®å½•ï¼š[Xmake Lua Scripts](https://github.com/xmake io/xmake/tree/master/xmake)ï¼Œæˆ‘ä»¬å¯ä»¥ä¸‹è½½çš„æœ¬åœ°ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰“å¼€ Xmake å®‰è£…ç›®å½•ä¸­çš„ lua è„šæœ¬ç›®å½•ã€‚ ç„¶ååˆ‡æ¢åˆ° VSCode çš„è°ƒè¯• Tab é¡µï¼Œç‚¹å‡» `RunDebug` > `Emmylua New Debug` å°±èƒ½è¿æ¥åˆ°æˆ‘ä»¬çš„ `xmake build` å‘½ä»¤è°ƒè¯•ç«¯ï¼Œå¼€å¯è°ƒè¯•ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé»˜è®¤çš„èµ·å§‹æ–­ç‚¹ä¼šè‡ªåŠ¨ä¸­æ–­åˆ° `debugger:_start_emmylua_debugger` å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹å‡»å•æ­¥è·³å‡ºå½“å‰å‡½æ•°ï¼Œå°±èƒ½è¿›å…¥ main å…¥å£ã€‚ ![](./image/xmake debug.png) ç„¶åè®¾ç½®è‡ªå·±çš„æ–­ç‚¹ï¼Œç‚¹å‡»ç»§ç»­è¿è¡Œï¼Œå°±èƒ½ä¸­æ–­åˆ°è‡ªå·±æƒ³è¦è°ƒè¯•çš„ä»£ç ä½ç½®ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®å·¥ç¨‹çš„é…ç½®è„šæœ¬ä¸­è®¾ç½®æ–­ç‚¹ï¼Œä¹Ÿå¯ä»¥å®ç°å¿«é€Ÿè°ƒè¯•è‡ªå·±çš„é…ç½®è„šæœ¬ï¼Œè€Œä¸ä»…ä»…æ˜¯ xmake è‡ªèº«æºç ã€‚ ![](./image/xmake debug2.png) ### è¿œç¨‹è°ƒè¯• xmake ä¹Ÿèƒ½æ”¯æŒè¿œç¨‹è°ƒè¯•ï¼Œåœ¨è™šæ‹Ÿæœºä¸­è°ƒè¯•å¾€å¾€ä½“éªŒä¸ä½³ï¼Œå› æ­¤é€šå¸¸ä¼šè¿œç¨‹è¿åˆ°å…¶ä»–ä¸»æœºä¸Šå»è°ƒè¯• xmake æºç ã€‚ æˆ‘ä»¬å…ˆåœ¨è¿œç¨‹æœºå™¨ä¸Šå¼€å¯è¿œç¨‹ç¼–è¯‘æœåŠ¡ï¼š ```bash $ xmake service ``` ç„¶åæœ¬æœºæ‰“å¼€éœ€è¦æ„å»ºçš„å·¥ç¨‹ç›®å½•ï¼Œæ‰§è¡Œè¿œç¨‹è¿æ¥ï¼Œç„¶åæ‰§è¡Œ `xmake service sync xmakesrc ` å»åŒæ­¥æœ¬åœ°æºç ï¼š ```bash $ xmake service connect $ xmake service sync xmakesrc ~/projects/personal/xmake/xmake/ $ xmake build $ xmake run ``` è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½æœ¬åœ°ä¿®æ”¹ xmake è„šæœ¬æºç ï¼Œç„¶ååŒæ­¥åˆ°è¿œç¨‹æœºå™¨ä¸Šï¼Œå†è¿œç¨‹æ‰§è¡Œ xmake æ„å»ºå‘½ä»¤è·å–å¯¹åº”çš„è°ƒè¯•è¾“å‡ºï¼Œä»¥åŠåˆ†ææ„å»ºè¡Œä¸ºã€‚ æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿé€šè¿‡ `xmake service pull ` å‘½ä»¤ï¼Œå›æ‹‰è¿œç¨‹çš„æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œè¿›è¡Œåˆ†æã€‚ > æ³¨ï¼šè¯¦ç»†çš„è¿œç¨‹ç¼–è¯‘ç‰¹æ€§è¯´æ˜ï¼Œè§ [è¿œç¨‹ç¼–è¯‘æ–‡æ¡£](http://xmake.io/#/zh cn/features/remote_build)ã€‚ ![](./image/xmake remote.png) ## å¦‚ä½•è°ƒè¯•ä»“åº“åŒ…? è°ƒè¯•çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œæˆ‘ä¸»è¦ä»‹ç»æœ€å¸¸ä½¿ç”¨çš„è°ƒè¯•æ–¹å¼ï¼Œé‚£å°±æ˜¯ç›´æ¥æ‹‰å– xmake repo ä»“åº“æ¥è°ƒè¯•ã€‚ ```bash $ git clone https://github.com/xmake io/xmake repo.git $ xmake l scripts/test.lua vD shallow zlib ``` ä½¿ç”¨ä¸Šé¢ test.lua è„šæœ¬å‘½ä»¤æ¥è°ƒè¯•åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥é‡å¤å®‰è£…æµ‹è¯•æŒ‡å®šçš„åŒ…ï¼Œ` shallow` å‘Šè¯‰ xmake æ¯æ¬¡æµ‹è¯•ä¸å»é‡å¤å®Œæ•´å®‰è£…å®ƒçš„æ‰€æœ‰ä¾èµ–åŒ…ï¼Œä»…ä»…æµ‹è¯•æŒ‰ç…§å½“å‰åŒ…ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥æµ‹è¯•æŒ‡å®šçš„å¹³å°ï¼Œæ¶æ„ï¼Œç¼–è¯‘æ¨¡å¼ï¼Œ vs_runtime å’ŒåŠ¨æ€åº“ï¼Œé™æ€åº“ç­‰ç­‰ã€‚ ```bash $ xmake l scripts/test.lua vD shallow p mingw mingw /xxx/sdk zlib $ xmake l scripts/test.lua vD shallow p iphoneos a arm64 zlib $ xmake l scripts/test.lua vD shallow k shared vs_runtime MD zlib $ xmake l scripts/test.lua vD shallow m debug zlib ``` ### è°ƒè¯•æœ¬åœ°åŒ…æºç  æœ‰æ—¶å€™ï¼Œç”±äºåŒ…çš„æºç å’Œæ„å»ºè„šæœ¬æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€äº›ä»£ç æ‰èƒ½ç»§ç»­æµ‹è¯•å®‰è£…ï¼Œå¦‚æœé€šè¿‡ add_patches/io.replace çš„æ–¹å¼åœ¨ on_install é‡Œé¢å»ä¿®æ”¹è°ƒè¯•ï¼Œéå¸¸ç¹çã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®š ` d package_sourcedir` æ–¹å¼ï¼Œç›´æ¥è®©æµ‹è¯•è„šæœ¬è¿›å…¥æˆ‘ä»¬é¢„å…ˆä¸‹è½½å¥½çš„åŒ…æºç ç›®å½•ï¼Œæµ‹è¯•ç¼–è¯‘å®‰è£…ï¼Œæˆ‘ä»¬æ¯æ¬¡çš„ä»£ç ä¿®æ”¹ä¸ä¼šè¢«é‡ç½®ã€‚ ```bash $ xmake l scripts/test.lua vD shallow d /tmp/zlib 1.2.11 zlib ``` ç­‰ä¿®æ”¹è°ƒè¯•é€šè¿‡åï¼Œæˆ‘ä»¬å†æ ¹æ®æ”¹åŠ¨ï¼Œé€šè¿‡ `git diff > fix.patch` ç”Ÿæˆè¡¥ä¸æ–‡ä»¶ï¼Œé€šè¿‡ `add_patches` é…ç½®åº”ç”¨è¡¥ä¸åŒ…ï¼Œæ¥ä¿®å¤åŒ…çš„å®‰è£…ã€‚ ### è¿œç¨‹è°ƒè¯•åŒ…æºç  æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿œç¨‹è°ƒè¯•åŒ…ï¼Œå…ˆå¼€å¯è¿œç¨‹æœåŠ¡ï¼š ```bash $ xmake service ``` ç„¶åä¼ å…¥ ` remote` å‚æ•°ï¼Œå³å¯å®ç°è¿œç¨‹åŒ…ç¼–è¯‘æµ‹è¯•ã€‚ ```bash $ xmake l scripts/test.lua vD shallow remote /tmp/zlib 1.2.11 zlib ``` ## ä¸‹è½½åŒ…æç¤ºè¯ä¹¦æ ¡éªŒå¤±è´¥æ€ä¹ˆåŠï¼Ÿ ```bash curl: (60) SSL certificate problem: unable to get local issuer certificate More details here: https://curl.se/docs/sslcerts.html curl failed to verify the legitimacy of the server and therefore could not establish a secure connection to it. To learn more about this situation and how to fix it, please visit the web page mentioned above. ``` å¦‚æœä½ åœ¨ä½¿ç”¨ Xmake å®‰è£…ä¾èµ–åŒ…æ—¶å€™ï¼Œé‡åˆ°ä¸Šé¢çš„è¯ä¹¦éªŒè¯é—®é¢˜ï¼Œä½ å¯ä»¥å°è¯•æ›´æ–° curl è¯ä¹¦å»ä¿®å¤å®ƒï¼Œæˆ–è€…ç›´æ¥å…¨å±€é…ç½®ç¦ç”¨è¯ä¹¦éªŒè¯æ¥ç»•è¿‡å®ƒã€‚ ```bash $ xmake g insecure ssl y ``` å½“ç„¶ï¼Œç¦ç”¨è¯ä¹¦éªŒè¯ä¼šå¸¦æ¥ä¸€å®šçš„å®‰å…¨æ€§é£é™©ï¼Œä¸è¿‡å¥½åœ¨ xmake repo ä»“åº“ä¸­çš„åŒ…ï¼Œæœ‰ä¸¥æ ¼çš„ sha256 æ ¡éªŒï¼Œå³ä½¿ä¸‹è½½è¢«åŠ«æŒï¼Œæœ€ç»ˆä¹Ÿä¼š xmake çš„ sha256 æ ¡éªŒæ£€æµ‹åˆ°ï¼Œä½œä¸ºæ— æ•ˆä¸‹è½½ã€‚"},"/get_started/zh/tutorial/configuration.html":{"title":"é…ç½®è¯´æ˜","content":"# é…ç½®è¯´æ˜ é€šè¿‡ `xmake fconfig` é…ç½®å‘½ä»¤ï¼Œè®¾ç½®æ„å»ºå‰çš„ç›¸å…³é…ç½®ä¿¡æ¯ï¼Œè¯¦ç»†å‚æ•°é€‰é¡¹ï¼Œè¯·è¿è¡Œ: `xmake f help`ã€‚ > **Tips**: > ä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œç¼©å†™æ¥ç®€åŒ–è¾“å…¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¨åï¼Œä¾‹å¦‚: > > * `xmake f` æˆ–è€… `xmake config` > * `xmake f p linux` æˆ–è€… `xmake config plat linux` ## ç›®æ ‡å¹³å° ### ä¸»æœºå¹³å° ```bash $ xmake ``` > xmakeå°†ä¼šè‡ªåŠ¨æ¢æµ‹å½“å‰ä¸»æœºå¹³å°ï¼Œé»˜è®¤è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ç›®æ ‡ç¨‹åºã€‚ ### Linux ```bash $ xmake f p linux [ a i386x86_64] $ xmake ``` ### Android ```bash $ xmake f p android ndk ~/files/android ndk r10e/ [ a armeabi v7aarm64 v8a] $ xmake ``` å¦‚æœè¦æ‰‹åŠ¨æŒ‡å®š ndk ä¸­å…·ä½“æŸä¸ªå·¥å…·é“¾ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤æ£€æµ‹çš„é…ç½®ï¼Œå¯ä»¥é€šè¿‡[ bin](# bin)æ¥è®¾ç½®ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p android ndk ~/files/android ndk r10e/ a arm64 v8a bin ~/files/android ndk r10e/toolchains/aarch64 linux android 4.9/prebuilt/darwin x86_64/bin ``` [ bin](# bin)ä¸»è¦ç”¨äºè®¾ç½®é€‰æ‹©ç¼–è¯‘å·¥å…·çš„å…·ä½“ bin ç›®å½•ï¼Œè¿™ä¸ªçš„ä½¿ç”¨è·Ÿ[äº¤å‰ç¼–è¯‘](#äº¤å‰ç¼–è¯‘é…ç½®)ä¸­çš„[ bin](# bin)çš„è¡Œä¸ºæ˜¯ä¸€è‡´çš„ã€‚ > å¦‚æœæ‰‹åŠ¨è®¾ç½®äº† bin ç›®å½•ï¼Œæ²¡æœ‰é€šè¿‡æ£€æµ‹ï¼Œå¯ä»¥çœ‹ä¸‹æ˜¯å¦ ` arch ` å‚æ•°æ²¡æœ‰åŒ¹é…å¯¹ã€‚ ### iPhoneOS ```bash $ xmake f p iphoneos [ a armv7armv7sarm64i386x86_64] $ xmake ``` ç”±äº m1 è®¾å¤‡ä¸Šæ¨¡æ‹Ÿå™¨ä¹Ÿæ”¯æŒ arm64 æ¶æ„ï¼Œå› æ­¤ä¹‹å‰å•çº¯ä» arch å»åŒºåˆ†æ˜¯å¦ä¸ºæ¨¡æ‹Ÿå™¨ï¼Œå·²æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚ å› æ­¤æˆ‘ä»¬æ–°å¢äº†ä¸€ä¸ªå‚æ•°é…ç½®å»åŒºåˆ†æ˜¯å¦ä¸ºæ¨¡æ‹Ÿå™¨ç›®æ ‡ã€‚ ```bash $ xmake f p iphoneos appledev simulator $ xmake f p watchos appledev simulator $ xmake f p appletvos appledev simulator ``` ### Mac Catalyst æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šæ„å»º Mac Catalyst ç¨‹åºã€‚ ```bash $ xmake f appledev catalyst ``` ### Apple WatchOS ```bash $ xmake f p watchos [ a i386armv7k] $ xmake ``` ### Wasm (WebAssembly) æ­¤å¹³å°ç”¨äºç¼–è¯‘ WebAssembly ç¨‹åºï¼ˆå†…éƒ¨ä¼šä½¿ç”¨ emcc å·¥å…·é“¾ï¼‰ï¼Œåœ¨åˆ‡æ¢æ­¤å¹³å°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¿›å…¥ Emscripten å·¥å…·é“¾ç¯å¢ƒï¼Œç¡®ä¿ emcc ç­‰ç¼–è¯‘å™¨å¯ç”¨ã€‚ ```bash $ xmake f p wasm $ xmake ``` xmake ä¹Ÿæ”¯æŒ Qt for wasm ç¼–è¯‘ï¼Œåªéœ€è¦ï¼š ```bash $ xmake f p wasm [ qt ~/Qt] $ xmake ``` å…¶ä¸­ ` qt` å‚æ•°è®¾ç½®æ˜¯å¯é€‰çš„ï¼Œé€šå¸¸ xmake éƒ½èƒ½æ£€æµ‹åˆ° qt çš„ sdk è·¯å¾„ã€‚ éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒEmscripten å’Œ Qt SDK çš„ç‰ˆæœ¬æ˜¯æœ‰å¯¹åº”å…³ç³»çš„ï¼Œä¸åŒ¹é…çš„ç‰ˆæœ¬ï¼Œå¯èƒ½ä¼šæœ‰ Qt/Wasm ä¹‹é—´çš„å…¼å®¹é—®é¢˜ã€‚ å…³äºç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼Œå¯ä»¥çœ‹ä¸‹ï¼š[https://wiki.qt.io/Qt_for_WebAssembly](https://wiki.qt.io/Qt_for_WebAssembly) æ›´å¤šè¯¦æƒ…è§ï¼š[https://github.com/xmake io/xmake/issues/956](https://github.com/xmake io/xmake/issues/956) é™¤äº† emscripten ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¸¸ç”¨çš„ wasm å·¥å…·é“¾ wasi sdkï¼Œç”¨äºæ„å»ºåŸºäº wasi çš„ç¨‹åºï¼Œæˆ‘ä»¬ä»…ä»…åªéœ€è¦åˆ‡æ¢å·¥å…·é“¾å³å¯ã€‚ ```bash $ xmake f p wasm toolchain wasi $ xmake ``` ### HarmonyOS (é¸¿è’™) xmake ä¹Ÿæä¾›äº†é¸¿è’™ OS å¹³å°çš„ native å·¥å…·é“¾ç¼–è¯‘æ”¯æŒï¼š ```bash $ xmake f p harmony ``` xmake ä¼šè‡ªåŠ¨æ¢æµ‹é»˜è®¤çš„ SDK è·¯å¾„ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®š Harmony SDK è·¯å¾„ã€‚ ```bash $ xmake f p Harmony sdk /Users/ruki/Library/Huawei/Sdk/openharmony/10/native ``` ## äº¤å‰ç¼–è¯‘é…ç½® é€šå¸¸ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨å½“å‰ pc ç¯å¢ƒç¼–è¯‘ç”Ÿæˆå…¶ä»–è®¾å¤‡ä¸Šæ‰èƒ½è¿è¡Œçš„ç›®æ ‡æ–‡ä»¶æ—¶å€™ï¼Œå°±éœ€è¦é€šè¿‡å¯¹åº”çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ¥ç¼–è¯‘ç”Ÿæˆå®ƒä»¬ï¼Œæ¯”å¦‚åœ¨ macos ä¸Šç¼–è¯‘ linux çš„ç¨‹åºï¼Œæˆ–è€…åœ¨ linux ä¸Šç¼–è¯‘å…¶ä»–åµŒå…¥å¼è®¾å¤‡çš„ç›®æ ‡æ–‡ä»¶ç­‰ã€‚ é€šå¸¸çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾éƒ½æ˜¯åŸºäº gcc/clang çš„ï¼Œå¤§éƒ½å…·æœ‰ç±»ä¼¼å¦‚ä¸‹çš„ç»“æ„ï¼š ``` /home/toolchains_sdkdir bin arm linux armeabi gcc arm linux armeabi ld ... lib libxxx.a include xxx.h ``` æ¯ä¸ªå·¥å…·é“¾éƒ½æœ‰å¯¹åº”çš„ include/lib ç›®å½•ï¼Œç”¨äºæ”¾ç½®ä¸€äº›ç³»ç»Ÿåº“å’Œå¤´æ–‡ä»¶ï¼Œä¾‹å¦‚ libc, stdc++ ç­‰ï¼Œè€Œ bin ç›®å½•ä¸‹æ”¾ç½®çš„å°±æ˜¯ç¼–è¯‘å·¥å…·é“¾ä¸€ç³»åˆ—å·¥å…·ã€‚ä¾‹å¦‚ï¼š ``` arm linux armeabi ar arm linux armeabi as arm linux armeabi c++ arm linux armeabi cpp arm linux armeabi g++ arm linux armeabi gcc arm linux armeabi ld arm linux armeabi nm arm linux armeabi strip ``` å…¶ä¸­ `arm linux armeabi ` å‰ç¼€å°±æ˜¯ crossï¼Œé€šè¿‡ç”¨æ¥æ ‡ç¤ºç›®æ ‡å¹³å°å’Œæ¶æ„ï¼Œä¸»è¦ç”¨äºè·Ÿä¸»æœºè‡ªèº«çš„ gcc/clang è¿›è¡ŒåŒºåˆ†ã€‚ é‡Œé¢çš„ gcc/g++ å°±æ˜¯ c/c++ çš„ç¼–è¯‘å™¨ï¼Œé€šå¸¸ä¹Ÿå¯ä»¥ä½œä¸ºé“¾æ¥å™¨ä½¿ç”¨ï¼Œé“¾æ¥çš„æ—¶å€™å†…éƒ¨ä¼šå»è°ƒç”¨ ld æ¥é“¾æ¥ï¼Œå¹¶ä¸”è‡ªåŠ¨è¿½åŠ ä¸€äº› c++ åº“ã€‚ cpp æ˜¯é¢„å¤„ç†å™¨ï¼Œas æ˜¯æ±‡ç¼–å™¨ï¼Œar ç”¨äºç”Ÿæˆé™æ€åº“ï¼Œstrip ç”¨äºè£å‰ªæ‰ä¸€äº›ç¬¦å·ä¿¡æ¯ï¼Œä½¿å¾—ç›®æ ‡ç¨‹åºä¼šæ›´åŠ çš„å°ã€‚nm ç”¨äºæŸ¥çœ‹å¯¼å‡ºç¬¦å·åˆ—è¡¨ã€‚ ### è‡ªåŠ¨æ¢æµ‹å’Œç¼–è¯‘ å¦‚æœæˆ‘ä»¬çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ˜¯ä¸Šæ–‡çš„ç»“æ„ï¼Œxmake ä¼šè‡ªåŠ¨æ£€æµ‹è¯†åˆ«è¿™ä¸ª sdk çš„ç»“æ„ï¼Œæå–é‡Œé¢çš„ crossï¼Œä»¥åŠ include/lib è·¯å¾„ä½ç½®ï¼Œç”¨æˆ·é€šå¸¸ä¸éœ€è¦åšé¢å¤–çš„å‚æ•°è®¾ç½®ï¼Œåªéœ€è¦é…ç½®å¥½ sdk æ ¹ç›®å½•å°±å¯ä»¥ç¼–è¯‘äº†ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p cross sdk /home/toolchains_sdkdir $ xmake ``` å…¶ä¸­ï¼Œ` p cross` ç”¨äºæŒ‡å®šå½“å‰çš„å¹³å°æ˜¯äº¤å‰ç¼–è¯‘å¹³å°ï¼Œ` sdk ` ç”¨äºæŒ‡å®šäº¤å‰å·¥å…·é“¾çš„æ ¹ç›®å½•ã€‚ > æ³¨ï¼šæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®š ` p linux` å¹³å°æ¥é…ç½®äº¤å‰ç¼–è¯‘ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯é¢å¤–æ ‡è¯†äº† linux å¹³å°åï¼Œæ–¹ä¾¿ xmake.lua é‡Œé¢é€šè¿‡ `is_plat(\"linux\")` æ¥åˆ¤æ–­å¹³å°ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œxmake ä¼šå»è‡ªåŠ¨æ¢æµ‹ gcc ç­‰ç¼–è¯‘å™¨çš„å‰ç¼€å crossï¼š`arm linux armeabi `ï¼Œå¹¶ä¸”ç¼–è¯‘çš„æ—¶å€™ï¼Œä¹Ÿä¼šè‡ªåŠ¨åŠ ä¸Š**é“¾æ¥åº“**å’Œ**å¤´æ–‡ä»¶**çš„æœç´¢é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ``` I/home/toolchains_sdkdir/include L/home/toolchains_sdkdir/lib ``` è¿™äº›éƒ½æ˜¯ xmake è‡ªåŠ¨å¤„ç†çš„ï¼Œä¸éœ€è¦æ‰‹åŠ¨é…ç½®ä»–ä»¬ã€‚ ### æ‰‹åŠ¨é…ç½®ç¼–è¯‘ å¦‚æœä¸Šé¢çš„è‡ªåŠ¨æ£€æµ‹å¯¹æŸäº›å·¥å…·é“¾ï¼Œè¿˜æ— æ³•å®Œå…¨é€šè¿‡ç¼–è¯‘ï¼Œå°±éœ€è¦ç”¨æˆ·è‡ªå·±æ‰‹åŠ¨è®¾ç½®ä¸€äº›äº¤å‰ç¼–è¯‘ç›¸å…³çš„é…ç½®å‚æ•°ï¼Œæ¥è°ƒæ•´é€‚åº”è¿™äº›ç‰¹æ®Šçš„å·¥å…·é“¾äº†ï¼Œä¸‹é¢æˆ‘ä¼šé€ä¸€è®²è§£å¦‚ä½•é…ç½®ã€‚ ### è®¾ç½®å·¥å…·é“¾ bin ç›®å½• å¯¹äºä¸è§„åˆ™å·¥å…·é“¾ç›®å½•ç»“æ„ï¼Œé å•çº¯åœ°[ sdk](# sdk)é€‰é¡¹è®¾ç½®ï¼Œæ²¡æ³•å®Œå…¨æ£€æµ‹é€šè¿‡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªé€‰é¡¹ç»§ç»­é™„åŠ è®¾ç½®å·¥å…·é“¾çš„ bin ç›®å½•ä½ç½®ã€‚ ä¾‹å¦‚ï¼šä¸€äº›ç‰¹æ®Šçš„äº¤å‰å·¥å…·é“¾çš„ï¼Œç¼–è¯‘å™¨binç›®å½•ï¼Œå¹¶ä¸åœ¨ `/home/toolchains_sdkdir/bin` è¿™ä¸ªä½ç½®ï¼Œè€Œæ˜¯ç‹¬ç«‹åˆ°äº† `/usr/opt/bin`ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è®¾ç½®äº† sdk å‚æ•°çš„åŸºç¡€ä¸Šè¿½åŠ  bin ç›®å½•çš„å‚æ•°è®¾ç½®ï¼Œæ¥è°ƒæ•´å·¥å…·é“¾çš„ bin ç›®å½•ã€‚ ```bash $ xmake f p cross sdk /home/toolchains_sdkdir bin /usr/opt/bin $ xmake ``` ### è®¾ç½®äº¤å‰å·¥å…·é“¾å·¥å…·å‰ç¼€ åƒ `aarch64 linux android ` è¿™ç§ï¼Œé€šå¸¸å¦‚æœä½ é…ç½®äº†` sdk` æˆ–è€… ` bin` çš„æƒ…å†µä¸‹ï¼Œxmake ä¼šå»è‡ªåŠ¨æ£€æµ‹çš„ï¼Œä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨è®¾ç½®ã€‚ ä½†æ˜¯å¯¹äºä¸€äº›æç‰¹æ®Šçš„å·¥å…·é“¾ï¼Œä¸€ä¸ªç›®å½•ä¸‹åŒæ—¶æœ‰å¤šä¸ª cross å‰ç¼€çš„å·¥å…· bin æ··åœ¨ä¸€èµ·çš„æƒ…å†µï¼Œä½ éœ€è¦æ‰‹åŠ¨è®¾ç½®è¿™ä¸ªé…ç½®ï¼Œæ¥åŒºåˆ†åˆ°åº•éœ€è¦é€‰ç”¨å“ªä¸ª binã€‚ ä¾‹å¦‚ï¼Œtoolchains çš„ bin ç›®å½•ä¸‹åŒæ—¶å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„ç¼–è¯‘å™¨ï¼š ``` /opt/bin armv7 linux gcc aarch64 linux gcc ``` æˆ‘ä»¬ç°åœ¨æƒ³è¦é€‰ç”¨ armv7 çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿½åŠ  ` cross ` é…ç½®ç¼–è¯‘å·¥å…·å‰ç¼€åï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p cross sdk /usr/toolsdk bin /opt/bin cross armv7 linux ``` ### è®¾ç½® c/c++ ç¼–è¯‘å™¨ å¦‚æœè¿˜è¦ç»§ç»­ç»†åˆ†é€‰æ‹©ç¼–è¯‘å™¨ï¼Œåˆ™ç»§ç»­è¿½åŠ ç›¸å…³ç¼–è¯‘å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p cross sdk /user/toolsdk cc armv7 linux clang cxx armv7 linux clang++ ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šç¼–è¯‘å™¨å…¨è·¯å¾„ã€‚ ` cc` ç”¨äºæŒ‡å®š c ç¼–è¯‘å™¨åï¼Œ` cxx` ç”¨äºæŒ‡å®š c++ ç¼–è¯‘å™¨åã€‚ > æ³¨ï¼šå¦‚æœå­˜åœ¨ CC/CXX ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ å¦‚æœæŒ‡å®šçš„ç¼–è¯‘å™¨åä¸æ˜¯é‚£äº› xmake å†…ç½®å¯è¯†åˆ«çš„åå­—ï¼ˆå¸¦æœ‰ gcc, clang ç­‰å­—æ ·ï¼‰ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å·¥å…·æ£€æµ‹å°±ä¼šå¤±è´¥ã€‚ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š ```bash xmake f cxx clang++@/home/xxx/c++mips.exe ``` è®¾ç½® c++mips.exe ç¼–è¯‘å™¨ä½œä¸ºç±» clang++ çš„ä½¿ç”¨æ–¹å¼æ¥ç¼–è¯‘ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŒ‡å®šç¼–è¯‘å™¨ä¸º `c++mips.exe` çš„åŒæ—¶ï¼Œå‘Šè¯‰ xmakeï¼Œå®ƒè·Ÿ clang++ ç”¨æ³•å’Œå‚æ•°é€‰é¡¹åŸºæœ¬ç›¸åŒã€‚ ### è®¾ç½® c/c++ é“¾æ¥å™¨ å¦‚æœè¿˜è¦ç»§ç»­ç»†åˆ†é€‰æ‹©é“¾æ¥å™¨ï¼Œåˆ™ç»§ç»­è¿½åŠ ç›¸å…³é“¾æ¥å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p cross sdk /user/toolsdk ld armv7 linux clang++ sh armv7 linux clang++ ar armv7 linux ar ``` ld æŒ‡å®šå¯æ‰§è¡Œç¨‹åºé“¾æ¥å™¨ï¼Œsh æŒ‡å®šå…±äº«åº“ç¨‹åºé“¾æ¥å™¨ï¼Œar æŒ‡å®šç”Ÿæˆé™æ€åº“çš„å½’æ¡£å™¨ã€‚ æ³¨ï¼šå¦‚æœå­˜åœ¨ LD/SH/AR ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ ### è®¾ç½®å¤´æ–‡ä»¶å’Œåº“æœç´¢ç›®å½• å¦‚æœ sdk é‡Œé¢è¿˜æœ‰é¢å¤–çš„å…¶ä»– include/lib ç›®å½•ä¸åœ¨æ ‡å‡†çš„ç»“æ„ä¸­ï¼Œå¯¼è‡´äº¤å‰ç¼–è¯‘æ‰¾ä¸åˆ°åº“å’Œå¤´æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ ` includedirs` å’Œ ` linkdirs` æ¥è¿½åŠ æœç´¢è·¯å¾„ï¼Œç„¶åé€šè¿‡ ` links` æ·»åŠ é¢å¤–çš„é“¾æ¥åº“ã€‚ ```bash $ xmake f p cross sdk /usr/toolsdk includedirs /usr/toolsdk/xxx/include linkdirs /usr/toolsdk/xxx/lib links pthread ``` > æ³¨ï¼šå¦‚æœè¦æŒ‡å®šå¤šä¸ªæœç´¢ç›®å½•ï¼Œå¯ä»¥é€šè¿‡ `:` æˆ–è€… `;` æ¥åˆ†å‰²ï¼Œä¹Ÿå°±æ˜¯ä¸åŒä¸»æœºå¹³å°çš„è·¯å¾„åˆ†éš”ç¬¦ï¼Œlinux/macosä¸‹ç”¨`:`ï¼Œwinä¸‹ç”¨`;`ã€‚ ### è®¾ç½®ç¼–è¯‘å’Œé“¾æ¥é€‰é¡¹ æˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€šè¿‡ ` cflags`, ` cxxflags`ï¼Œ` ldflags`ï¼Œ` shflags` å’Œ ` arflags` é¢å¤–é…ç½®ä¸€äº›ç¼–è¯‘å’Œé“¾æ¥é€‰é¡¹ã€‚ * cflags: æŒ‡å®šcç¼–è¯‘å‚æ•° * cxxflagsï¼šæŒ‡å®šc++ç¼–è¯‘å‚æ•° * cxflags: æŒ‡å®šc/c++ç¼–è¯‘å‚æ•° * asflags: æŒ‡å®šæ±‡ç¼–å™¨ç¼–è¯‘å‚æ•° * ldflags: æŒ‡å®šå¯æ‰§è¡Œç¨‹åºé“¾æ¥å‚æ•° * shflags: æŒ‡å®šåŠ¨æ€åº“ç¨‹åºé“¾æ¥å‚æ•° * arflags: æŒ‡å®šé™æ€åº“çš„ç”Ÿæˆå‚æ•° ä¾‹å¦‚ï¼š ```bash $ xmake f p cross sdk /usr/toolsdk cflags \" DTEST I/xxx/xxx\" ldflags \" lpthread\" ``` ### é¡¹ç›®æè¿°è®¾ç½® #### set_toolchains è¿™å¯¹æŸä¸ªç‰¹å®šçš„ target å•ç‹¬åˆ‡æ¢è®¾ç½®ä¸åŒçš„å·¥å…·é“¾ï¼Œå’Œ set_toolset ä¸åŒçš„æ˜¯ï¼Œæ­¤æ¥å£æ˜¯å¯¹å®Œæ•´å·¥å…·é“¾çš„æ•´ä½“åˆ‡æ¢ï¼Œæ¯”å¦‚ cc/ld/sh ç­‰ä¸€ç³»åˆ—å·¥å…·é›†ã€‚ è¿™ä¹Ÿæ˜¯æ¨èåšæ³•ï¼Œå› ä¸ºåƒ gcc/clang ç­‰å¤§éƒ¨åˆ†ç¼–è¯‘å·¥å…·é“¾ï¼Œç¼–è¯‘å™¨å’Œé“¾æ¥å™¨éƒ½æ˜¯é…å¥—ä½¿ç”¨çš„ï¼Œè¦åˆ‡å°±å¾—æ•´ä½“åˆ‡ï¼Œå•ç‹¬é›¶æ•£çš„åˆ‡æ¢è®¾ç½®ä¼šå¾ˆç¹çã€‚ æ¯”å¦‚æˆ‘ä»¬åˆ‡æ¢ test ç›®æ ‡åˆ° clang+yasm ä¸¤ä¸ªå·¥å…·é“¾ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") set_toolchains(\"clang\", \"yasm\") end) ``` #### set_toolset å¦‚æœè§‰å¾—æ¯æ¬¡é€šè¿‡å‘½ä»¤è¡Œé…ç½®æ¯”è¾ƒç¹çï¼Œæœ‰äº›é…ç½®å¯ä»¥é€šè¿‡åœ¨ xmake.lua é¢„å…ˆé…ç½®å¥½ï¼Œæ¥ç®€åŒ–å‘½ä»¤é…ç½®ï¼Œæ¯”å¦‚ç¼–è¯‘å™¨çš„æŒ‡å®šï¼Œå°±å¯ä»¥é€šè¿‡ `set_toolset` æ¥å¯¹æ¯ä¸ª target å•ç‹¬è®¾ç½®ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") set_toolset(\"cxx\", \"clang\") set_toolset(\"ld\", \"clang++\") end) ``` å¼ºåˆ¶ test ç›®æ ‡çš„ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ä½¿ç”¨ clang ç¼–è¯‘å™¨ï¼Œæˆ–è€…æŒ‡å®šäº¤å‰ç¼–è¯‘å·¥å…·é“¾ä¸­çš„ç¼–è¯‘å™¨åæˆ–è€…è·¯å¾„ã€‚ #### set_config æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `set_config` æ¥è®¾ç½®åœ¨ `xmake f/config` å‘½ä»¤ä¸­çš„æ¯ä¸ªé…ç½®å‚æ•°çš„é»˜è®¤å€¼ï¼Œè¿™æ˜¯ä¸ªå…¨å±€ apiï¼Œå¯¹æ¯ä¸ª target éƒ½ä¼šç”Ÿæ•ˆã€‚ ```lua set_config(\"cflags\", \" DTEST\") set_config(\"sdk\", \"/home/xxx/tooksdk\") set_config(\"cc\", \"gcc\") set_config(\"ld\", \"g++\") ``` ä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡ `xmake f name value` çš„æ–¹å¼ï¼Œå»ä¿®æ”¹ xmake.lua ä¸­çš„é»˜è®¤é…ç½®ã€‚ ### è‡ªå®šä¹‰ç¼–è¯‘å¹³å° å¦‚æœæŸä¸ªäº¤å‰å·¥å…·é“¾ç¼–è¯‘åç›®æ ‡ç¨‹åºæœ‰å¯¹åº”çš„å¹³å°éœ€è¦æŒ‡å®šï¼Œå¹¶ä¸”éœ€è¦åœ¨ xmake.lua é‡Œé¢æ ¹æ®ä¸åŒçš„äº¤å‰ç¼–è¯‘å¹³å°ï¼Œè¿˜éœ€è¦é…ç½®ä¸€äº›é¢å¤–çš„ç¼–è¯‘å‚æ•°ï¼Œé‚£ä¹ˆä¸Šæ–‡çš„ ` p cross` è®¾ç½®å°±ä¸èƒ½æ»¡è¶³éœ€æ±‚äº†ã€‚ å…¶å®ï¼Œ` p/ plat ` å‚æ•°ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºå…¶ä»–è‡ªå®šä¹‰çš„å€¼ï¼Œåªéœ€è¦è·Ÿ `is_plat` ä¿æŒå¯¹åº”å…³ç³»å°±å¯ä»¥ï¼Œæ‰€æœ‰éå†…ç½®å¹³å°åï¼Œéƒ½ä¼šé»˜è®¤é‡‡ç”¨äº¤å‰ç¼–è¯‘æ¨¡å¼ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p myplat sdk /usr/local/arm xxx gcc/ $ xmake ``` æˆ‘ä»¬ä¼ å…¥äº† myplat è‡ªå®šä¹‰å¹³å°åï¼Œä½œä¸ºå½“å‰äº¤å‰å·¥å…·é“¾çš„ç¼–è¯‘å¹³å°ï¼Œç„¶å xmake.lua é‡Œé¢æˆ‘ä»¬å¯¹è¿™ä¸ªå¹³å°ï¼Œé…ç½®ä¸‹å¯¹åº”çš„è®¾ç½®ï¼š ```lua if is_plat(\"myplat\") then add_defines(\"TEST\") end ``` é€šè¿‡è¿™ç§æ–¹å¼ï¼Œxmake å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰©å±•å¤„ç†å„ç§ç¼–è¯‘å¹³å°ï¼Œç”¨æˆ·å¯ä»¥è‡ªå·±æ‰©å±•æ”¯æŒ freebsd, netbsd, sunos ç­‰å…¶ä»–å„ç§å¹³å°çš„äº¤å‰ç¼–è¯‘ã€‚ æˆ‘æ‘˜å½•ä¸€æ®µä¹‹å‰ç§»æ¤ libuv å†™çš„äº¤å‰ç¼–è¯‘çš„é…ç½®ï¼Œç›´è§‚æ„Ÿå—ä¸‹ï¼š ```lua for dragonfly/freebsd/netbsd/openbsd platform if is_plat(\"dragonfly\", \"freebsd\", \"netbsd\", \"openbsd\") then add_files(\"src/unix/bsd ifaddrs.c\") add_files(\"src/unix/freebsd.c\") add_files(\"src/unix/kqueue.c\") add_files(\"src/unix/posix hrtime.c\") add_headerfiles(\"(include/uv bsd.h)\") end for sunos platform if is_plat(\"sunos\") then add_files(\"src/unix/no proctitle.c\") add_files(\"src/unix/sunos.c\") add_defines(\"__EXTENSIONS_\", \"_XOPEN_SOURCE 600\") add_headerfiles(\"(include/uv sunos.h)\") end ``` ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ‡æ¢è¿™äº›å¹³å°æ¥ç¼–è¯‘ï¼š ```bash $ xmake f p [dragonflyfreebsdnetbsdopenbsdsunos] sdk /home/arm xxx gcc/ $ xmake ``` å¦å¤–ï¼Œå†…ç½®çš„ linux å¹³å°ä¹Ÿæ˜¯æ”¯æŒäº¤å‰ç¼–è¯‘çš„ï¼Œå¦‚æœä¸æƒ³é…ç½®å…¶ä»–å¹³å°åï¼Œç»Ÿä¸€ä½œä¸º linux å¹³å°æ¥äº¤å‰ç¼–è¯‘ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ ```bash $ xmake f p linux sdk /usr/local/arm xxx gcc/ $ xmake ``` åªè¦è®¾ç½®äº† ` sdk ` ç­‰å‚æ•°ï¼Œå°±ä¼šå¯ç”¨linuxå¹³å°çš„äº¤å‰ç¼–è¯‘æ¨¡å¼ã€‚ ### å¸¸ç”¨å·¥å…·é“¾é…ç½® å®Œæ•´çš„å·¥å…·é“¾åˆ—è¡¨ï¼Œè¯·æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š ```bash $ xmake show l toolchains ``` ä¸Šæ–‡è®²è¿°çš„æ˜¯é€šç”¨çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾é…ç½®ï¼Œå¦‚æœä¸€äº›ç‰¹å®šçš„å·¥å…·é“¾éœ€è¦é¢å¤–ä¼ å…¥ ` ldflags/ includedirs` ç­‰åœºæ™¯å°±æ¯”è¾ƒç¹çäº†, å› æ­¤ xmake ä¹Ÿå†…ç½®äº†ä¸€äº›å¸¸ç”¨å·¥å…·é“¾ï¼Œå¯ä»¥çœå»äº¤å‰ç¼–è¯‘å·¥å…·é“¾å¤æ‚çš„é…ç½®è¿‡ç¨‹ï¼Œåªéœ€è¦æ‰§è¡Œï¼š ```bash $ xmake f toolchain gnu rm sdk /xxx/ $ xmake ``` å°±å¯ä»¥å¿«é€Ÿåˆ‡æ¢çš„æŒ‡å®šçš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œå¦‚æœè¿™ä¸ªå·¥å…·é“¾éœ€è¦è¿½åŠ ä¸€äº›ç‰¹å®šçš„ flags è®¾ç½®ï¼Œä¹Ÿä¼šè‡ªåŠ¨è®¾ç½®å¥½ï¼Œç®€åŒ–é…ç½®ã€‚ å…¶ä¸­ï¼Œgnu rm å°±æ˜¯å†…ç½®çš„ GNU Arm Embedded Toolchainã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¿«é€Ÿä» gcc å·¥å…·é“¾æ•´ä½“åˆ‡æ¢åˆ° clang æˆ–è€… llvm å·¥å…·é“¾ï¼Œä¸å†éœ€è¦ `xmake f cc clang cxx clang ld clang++` ç­‰æŒ¨ä¸ªé…ç½®äº†ã€‚ ```bash $ xmake f toolchain clang $ xmake ``` æˆ–è€… ```bash $ xmake f toolchain llvm sdk /xxx/llvm $ xmake ``` å…·ä½“ xmake æŒå“ªäº›å·¥å…·é“¾ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š ```bash $ xmake show l toolchains xcode Xcode IDE vs VisualStudio IDE yasm The Yasm Modular Assembler clang A C language family frontend for LLVM go Go Programming Language Compiler dlang D Programming Language Compiler sdcc Small Device C Compiler cuda CUDA Toolkit ndk Android NDK rust Rust Programming Language Compiler llvm A collection of modular and reusable compiler and toolchain technologies cross Common cross compilation toolchain nasm NASM Assembler gcc GNU Compiler Collection mingw Minimalist GNU for Windows gnu rm GNU Arm Embedded Toolchain envs Environment variables toolchain fasm Flat Assembler ``` #### è‡ªå®šä¹‰å·¥å…·é“¾ å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ xmake.lua ä¸­è‡ªå®šä¹‰ toolchainï¼Œç„¶åé€šè¿‡ `xmake f toolchain myclang` æŒ‡å®šåˆ‡æ¢ï¼Œä¾‹å¦‚ï¼š ```lua toolchain(\"myclang\", function() set_kind(\"standalone\") set_toolset(\"cc\", \"clang\") set_toolset(\"cxx\", \"clang\", \"clang++\") set_toolset(\"ld\", \"clang++\", \"clang\") set_toolset(\"sh\", \"clang++\", \"clang\") set_toolset(\"ar\", \"ar\") set_toolset(\"ex\", \"ar\") set_toolset(\"strip\", \"strip\") set_toolset(\"mm\", \"clang\") set_toolset(\"mxx\", \"clang\", \"clang++\") set_toolset(\"as\", \"clang\") ... end) ``` å…³äºè¿™å—çš„è¯¦æƒ…ä»‹ç»ï¼Œå¯ä»¥åˆ°[è‡ªå®šä¹‰å·¥å…·é“¾](/zh cn/manual/custom_toolchain)ç« èŠ‚æŸ¥çœ‹ æ›´å¤šè¯¦æƒ…è§ï¼š[#780](https://github.com/xmake io/xmake/issues/780) #### LLVM å·¥å…·é“¾ llvm å·¥å…·é“¾ä¸‹è½½åœ°å€ï¼š<https://releases.llvm.org/> ```bash $ xmake f p cross toolchain llvm sdk \"C:\\Program Files\\LLVM\" $ xmake ``` #### GNU RM å·¥å…·é“¾ å·¥å…·é“¾åœ°å€ï¼š<https://developer.arm.com/tools and software/open source software/developer tools/gnu toolchain/gnu rm/downloads#> ```bash $ xmake f p cross toolchain gnu rm sdk /xxx/cc arm none eabi 9 2019 q4 major $ xmake ``` #### TinyC å·¥å…·é“¾ ```bash $ xmake f toolchain tinyc $ xmake ``` > Releases ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬è¿˜æä¾›äº†ç‰¹æ®Šçš„ xmake tinyc vX.X.X.win32.exe å®‰è£…åŒ…ï¼Œå†…ç½® tinyc å·¥å…·é“¾ï¼Œæ— éœ€ä¾èµ– msvcï¼Œä¹Ÿå¯ä»¥ç¼–è¯‘ c ä»£ç ï¼Œå¼€ç®±å³ç”¨æ— ä¾èµ–ã€‚ #### Emcc å·¥å…·é“¾ é€šå¸¸åªéœ€è¦åˆ‡æ¢åˆ° Wasm å¹³å°ï¼Œé‡Œé¢å†…ç½®äº† emcc å·¥å…·é“¾ï¼Œè¿˜ä¼šé¢å¤–è°ƒæ•´ç›®æ ‡ç¨‹åºçš„æ‰©å±•åä¸º `*.html` ä»¥åŠè¾“å‡º `*.wasm`ã€‚ ```bash $ xmake f p wasm $ xmake ``` ä¸è¿‡æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿç›´æ¥åˆ‡æ¢åˆ° emcc å·¥å…·é“¾ï¼Œä½†æ˜¯åç¼€åä¸ä¼šè¢«ä¿®æ”¹ã€‚ ```bash $ xmake f toolchain emcc $ xmake ``` #### Intel C++ ç¼–è¯‘å·¥å…·é“¾ ```bash $ xmake f toolchain icc $ xmake ``` #### Intel Fortran ç¼–è¯‘å·¥å…·é“¾ ```bash $ xmake f toolchain ifort $ xmake ``` ### é€šç”¨äº¤å‰ç¼–è¯‘é…ç½® å‚æ•°å æè¿° [ sdk](# sdk) è®¾ç½®äº¤å‰å·¥å…·é“¾çš„sdkæ ¹ç›®å½• [ bin](# bin) è®¾ç½®å·¥å…·é“¾binç›®å½• [ cross](# cross) è®¾ç½®äº¤å‰å·¥å…·é“¾å·¥å…·å‰ç¼€ [ as](# as) è®¾ç½®`asm`æ±‡ç¼–å™¨ [ cc](# cc) è®¾ç½®`c`ç¼–è¯‘å™¨ [ cxx](# cxx) è®¾ç½®`c++`ç¼–è¯‘å™¨ [ mm](# mm) è®¾ç½®`objc`ç¼–è¯‘å™¨ [ mxx](# mxx) è®¾ç½®`objc++`ç¼–è¯‘å™¨ [ sc](# sc) è®¾ç½®`swift`ç¼–è¯‘å™¨ [ gc](# gc) è®¾ç½®`golang`ç¼–è¯‘å™¨ [ dc](# dc) è®¾ç½®`dlang`ç¼–è¯‘å™¨ [ rc](# rc) è®¾ç½®`rust`ç¼–è¯‘å™¨ [ cu](# cu) è®¾ç½®`cuda`ç¼–è¯‘å™¨ [ ld](# ld) è®¾ç½®`c/c++/objc/asm`é“¾æ¥å™¨ [ sh](# sh) è®¾ç½®`c/c++/objc/asm`å…±äº«åº“é“¾æ¥å™¨ [ ar](# ar) è®¾ç½®`c/c++/objc/asm`é™æ€åº“å½’æ¡£å™¨ [ scld](# scld) è®¾ç½®`swift`é“¾æ¥å™¨ [ scsh](# scsh) è®¾ç½®`swift`å…±äº«åº“é“¾æ¥å™¨ [ gcld](# gcld) è®¾ç½®`golang`é“¾æ¥å™¨ [ gcar](# gcar) è®¾ç½®`golang`é™æ€åº“å½’æ¡£å™¨ [ dcld](# dcld) è®¾ç½®`dlang`é“¾æ¥å™¨ [ dcsh](# dcsh) è®¾ç½®`dlang`å…±äº«åº“é“¾æ¥å™¨ [ dcar](# dcar) è®¾ç½®`dlang`é™æ€åº“å½’æ¡£å™¨ [ rcld](# rcld) è®¾ç½®`rust`é“¾æ¥å™¨ [ rcsh](# rcsh) è®¾ç½®`rust`å…±äº«åº“é“¾æ¥å™¨ [ rcar](# rcar) è®¾ç½®`rust`é™æ€åº“å½’æ¡£å™¨ [ cu ccbin](# cu ccbin) è®¾ç½®`cuda` hostç¼–è¯‘å™¨ [ culd](# culd) è®¾ç½®`cuda`é“¾æ¥å™¨ [ asflags](# asflags) è®¾ç½®`asm`æ±‡ç¼–ç¼–è¯‘é€‰é¡¹ [ cflags](# cflags) è®¾ç½®`c`ç¼–è¯‘é€‰é¡¹ [ cxflags](# cxflags) è®¾ç½®`c/c++`ç¼–è¯‘é€‰é¡¹ [ cxxflags](# cxxflags) è®¾ç½®`c++`ç¼–è¯‘é€‰é¡¹ [ mflags](# mflags) è®¾ç½®`objc`ç¼–è¯‘é€‰é¡¹ [ mxflags](# mxflags) è®¾ç½®`objc/c++`ç¼–è¯‘é€‰é¡¹ [ mxxflags](# mxxflags) è®¾ç½®`objc++`ç¼–è¯‘é€‰é¡¹ [ scflags](# scflags) è®¾ç½®`swift`ç¼–è¯‘é€‰é¡¹ [ gcflags](# gcflags) è®¾ç½®`golang`ç¼–è¯‘é€‰é¡¹ [ dcflags](# dcflags) è®¾ç½®`dlang`ç¼–è¯‘é€‰é¡¹ [ rcflags](# rcflags) è®¾ç½®`rust`ç¼–è¯‘é€‰é¡¹ [ cuflags](# cuflags) è®¾ç½®`cuda`ç¼–è¯‘é€‰é¡¹ [ ldflags](# ldflags) è®¾ç½®é“¾æ¥é€‰é¡¹ [ shflags](# shflags) è®¾ç½®å…±äº«åº“é“¾æ¥é€‰é¡¹ [ arflags](# arflags) è®¾ç½®é™æ€åº“å½’æ¡£é€‰é¡¹ > å¦‚æœä½ æƒ³è¦äº†è§£æ›´å¤šå‚æ•°é€‰é¡¹ï¼Œè¯·è¿è¡Œ: `xmake f help`ã€‚ #### sdk * è®¾ç½®äº¤å‰å·¥å…·é“¾çš„sdkæ ¹ç›®å½• å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½ä¸éœ€è¦é…ç½®å¾ˆå¤æ‚çš„ toolchains å‰ç¼€ï¼Œä¾‹å¦‚ï¼š`arm linux ` ä»€ä¹ˆçš„ åªè¦è¿™ä¸ªå·¥å…·é“¾çš„ sdk ç›®å½•æ»¡è¶³å¦‚ä¸‹ç»“æ„ï¼ˆå¤§éƒ¨åˆ†çš„äº¤å‰å·¥å…·é“¾éƒ½æ˜¯è¿™ä¸ªç»“æ„ï¼‰ï¼š ``` /home/toolchains_sdkdir bin arm linux gcc arm linux ld ... lib libxxx.a include xxx.h ``` é‚£ä¹ˆï¼Œä½¿ç”¨ xmake è¿›è¡Œäº¤å‰ç¼–è¯‘çš„æ—¶å€™ï¼Œåªéœ€è¦è¿›è¡Œå¦‚ä¸‹é…ç½®å’Œç¼–è¯‘ï¼š ```bash $ xmake f p linux sdk /home/toolchains_sdkdir $ xmake ``` è¿™ä¸ªæ—¶å€™ï¼Œxmake ä¼šå»è‡ªåŠ¨æ¢æµ‹ï¼Œgcc ç­‰ç¼–è¯‘å™¨çš„å‰ç¼€åï¼š`arm linux `ï¼Œå¹¶ä¸”ç¼–è¯‘çš„æ—¶å€™ï¼Œä¹Ÿä¼šè‡ªåŠ¨åŠ ä¸Š**é“¾æ¥åº“**å’Œ**å¤´æ–‡ä»¶**çš„æœç´¢é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ``` I/home/toolchains_sdkdir/include L/home/toolchains_sdkdir/lib ``` è¿™äº›éƒ½æ˜¯xmakeè‡ªåŠ¨å¤„ç†çš„ï¼Œä¸éœ€è¦æ‰‹åŠ¨é…ç½®ä»–ä»¬ã€‚ã€‚ #### bin * è®¾ç½®å·¥å…·é“¾binç›®å½• å¯¹äºä¸è§„åˆ™å·¥å…·é“¾ç›®å½•ç»“æ„ï¼Œé å•çº¯åœ°[ sdk]( sdk)é€‰é¡¹è®¾ç½®ï¼Œæ²¡æ³•å®Œå…¨æ£€æµ‹é€šè¿‡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªé€‰é¡¹ç»§ç»­é™„åŠ è®¾ç½®å·¥å…·é“¾çš„ bin ç›®å½•ä½ç½®ã€‚ ä¾‹å¦‚ï¼šä¸€äº›ç‰¹æ®Šçš„äº¤å‰å·¥å…·é“¾çš„ï¼Œç¼–è¯‘å™¨ bin ç›®å½•ï¼Œå¹¶ä¸åœ¨ `/home/toolchains_sdkdir/bin` è¿™ä¸ªä½ç½®ï¼Œè€Œæ˜¯ç‹¬ç«‹åˆ°äº† `/usr/opt/bin`ã€‚ ```bash $ xmake f p linux sdk /home/toolchains_sdkdir bin /usr/opt/bin $ xmake ``` #### cross * è®¾ç½®äº¤å‰å·¥å…·é“¾å·¥å…·å‰ç¼€ åƒ `aarch64 linux android ` è¿™ç§ï¼Œé€šå¸¸å¦‚æœä½ é…ç½®äº†[ sdk](# sdk)æˆ–è€…[ bin](# bin)çš„æƒ…å†µä¸‹ï¼Œxmake ä¼šå»è‡ªåŠ¨æ£€æµ‹çš„ï¼Œä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨è®¾ç½®ã€‚ ä½†æ˜¯å¯¹äºä¸€äº›æç‰¹æ®Šçš„å·¥å…·é“¾ï¼Œä¸€ä¸ªç›®å½•ä¸‹åŒæ—¶æœ‰å¤šä¸ª cross å‰ç¼€çš„å·¥å…· bin æ··åœ¨ä¸€èµ·çš„æƒ…å†µï¼Œä½ éœ€è¦æ‰‹åŠ¨è®¾ç½®è¿™ä¸ªé…ç½®ï¼Œæ¥åŒºåˆ†åˆ°åº•éœ€è¦é€‰ç”¨å“ªä¸ª binã€‚ ä¾‹å¦‚ï¼Œtoolchains çš„ bin ç›®å½•ä¸‹åŒæ—¶å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„ç¼–è¯‘å™¨ï¼š ``` /opt/bin armv7 linux gcc aarch64 linux gcc ``` æˆ‘ä»¬ç°åœ¨æƒ³è¦é€‰ç”¨ armv7 çš„ç‰ˆæœ¬ï¼Œåˆ™é…ç½®å¦‚ä¸‹ï¼š ```bash $ xmake f p linux sdk /usr/toolsdk bin /opt/bin cross armv7 linux ``` #### as * è®¾ç½® `asm` æ±‡ç¼–å™¨ å¦‚æœè¿˜è¦ç»§ç»­ç»†åˆ†é€‰æ‹©ç¼–è¯‘å™¨ï¼Œåˆ™ç»§ç»­è¿½åŠ ç›¸å…³ç¼–è¯‘å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p linux sdk /user/toolsdk as armv7 linux as ``` å¦‚æœå­˜åœ¨ `AS` ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ > å¦‚æœæŒ‡å®šçš„ç¼–è¯‘å™¨åä¸æ˜¯é‚£äº› xmake å†…ç½®å¯è¯†åˆ«çš„åå­—ï¼ˆå¸¦æœ‰ gcc, clang ç­‰å­—æ ·ï¼‰ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å·¥å…·æ£€æµ‹å°±ä¼šå¤±è´¥ã€‚ > è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f as gcc@/home/xxx/asmips.exe` è®¾ç½®ccmips.exeç¼–è¯‘å™¨ä½œä¸ºç±» gcc çš„ä½¿ç”¨æ–¹å¼æ¥ç¼–è¯‘ã€‚ > ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŒ‡å®šç¼–è¯‘å™¨ä¸º `asmips.exe` çš„åŒæ—¶ï¼Œå‘Šè¯‰ xmakeï¼Œå®ƒè·Ÿ gcc ç”¨æ³•å’Œå‚æ•°é€‰é¡¹åŸºæœ¬ç›¸åŒã€‚ #### cc * è®¾ç½®cç¼–è¯‘å™¨ å¦‚æœè¿˜è¦ç»§ç»­ç»†åˆ†é€‰æ‹©ç¼–è¯‘å™¨ï¼Œåˆ™ç»§ç»­è¿½åŠ ç›¸å…³ç¼–è¯‘å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p linux sdk /user/toolsdk cc armv7 linux clang ``` å¦‚æœå­˜åœ¨ `CC` ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ > å¦‚æœæŒ‡å®šçš„ç¼–è¯‘å™¨åä¸æ˜¯é‚£äº› xmake å†…ç½®å¯è¯†åˆ«çš„åå­—ï¼ˆå¸¦æœ‰ gcc, clang ç­‰å­—æ ·ï¼‰ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å·¥å…·æ£€æµ‹å°±ä¼šå¤±è´¥ã€‚ > è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f cc gcc@/home/xxx/ccmips.exe` è®¾ç½® ccmips.exe ç¼–è¯‘å™¨ä½œä¸ºç±» gcc çš„ä½¿ç”¨æ–¹å¼æ¥ç¼–è¯‘ã€‚ > ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŒ‡å®šç¼–è¯‘å™¨ä¸º `ccmips.exe` çš„åŒæ—¶ï¼Œå‘Šè¯‰ xmakeï¼Œå®ƒè·Ÿ gcc ç”¨æ³•å’Œå‚æ•°é€‰é¡¹åŸºæœ¬ç›¸åŒã€‚ #### cxx * è®¾ç½® `c++` ç¼–è¯‘å™¨ å¦‚æœè¿˜è¦ç»§ç»­ç»†åˆ†é€‰æ‹©ç¼–è¯‘å™¨ï¼Œåˆ™ç»§ç»­è¿½åŠ ç›¸å…³ç¼–è¯‘å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p linux sdk /user/toolsdk cxx armv7 linux clang++ ``` å¦‚æœå­˜åœ¨ `CXX` ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ > å¦‚æœæŒ‡å®šçš„ç¼–è¯‘å™¨åä¸æ˜¯é‚£äº› xmake å†…ç½®å¯è¯†åˆ«çš„åå­—ï¼ˆå¸¦æœ‰ gcc, clang ç­‰å­—æ ·ï¼‰ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å·¥å…·æ£€æµ‹å°±ä¼šå¤±è´¥ã€‚ > è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f cxx clang++@/home/xxx/c++mips.exe` è®¾ç½® c++mips.exe ç¼–è¯‘å™¨ä½œä¸ºç±» clang++ çš„ä½¿ç”¨æ–¹å¼æ¥ç¼–è¯‘ã€‚ > ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŒ‡å®šç¼–è¯‘å™¨ä¸º `c++mips.exe` çš„åŒæ—¶ï¼Œå‘Šè¯‰ xmakeï¼Œå®ƒè·Ÿ clang++ ç”¨æ³•å’Œå‚æ•°é€‰é¡¹åŸºæœ¬ç›¸åŒã€‚ #### ld * è®¾ç½® `c/c++/objc/asm` é“¾æ¥å™¨ å¦‚æœè¿˜è¦ç»§ç»­ç»†åˆ†é€‰æ‹©é“¾æ¥å™¨ï¼Œåˆ™ç»§ç»­è¿½åŠ ç›¸å…³ç¼–è¯‘å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p linux sdk /user/toolsdk ld armv7 linux clang++ ``` å¦‚æœå­˜åœ¨ `LD` ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ > å¦‚æœæŒ‡å®šçš„ç¼–è¯‘å™¨åä¸æ˜¯é‚£äº› xmake å†…ç½®å¯è¯†åˆ«çš„åå­—ï¼ˆå¸¦æœ‰ gcc, clang ç­‰å­—æ ·ï¼‰ï¼Œé‚£ä¹ˆé“¾æ¥å™¨å·¥å…·æ£€æµ‹å°±ä¼šå¤±è´¥ã€‚ > è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f ld g++@/home/xxx/c++mips.exe` è®¾ç½® c++mips.exe é“¾æ¥å™¨ä½œä¸ºç±» g++ çš„ä½¿ç”¨æ–¹å¼æ¥ç¼–è¯‘ã€‚ > ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŒ‡å®šé“¾æ¥å™¨ä¸º `c++mips.exe` çš„åŒæ—¶ï¼Œå‘Šè¯‰ xmakeï¼Œå®ƒè·Ÿ g++ ç”¨æ³•å’Œå‚æ•°é€‰é¡¹åŸºæœ¬ç›¸åŒã€‚ #### sh * è®¾ç½® `c/c++/objc/asm` å…±äº«åº“é“¾æ¥å™¨ ```bash $ xmake f p linux sdk /user/toolsdk sh armv7 linux clang++ ``` å¦‚æœå­˜åœ¨ `SH` ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ #### ar * è®¾ç½® `c/c++/objc/asm` é™æ€åº“å½’æ¡£å™¨ ```bash $ xmake f p linux sdk /user/toolsdk ar armv7 linux ar ``` å¦‚æœå­˜åœ¨`AR`ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ ## å…¨å±€é…ç½® æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ä¸€äº›å¸¸ç”¨é…ç½®ä¿å­˜åˆ°å…¨å±€é…ç½®ä¸­ï¼Œæ¥ç®€åŒ–é¢‘ç¹åœ°è¾“å…¥ï¼š ä¾‹å¦‚: ```bash $ xmake g ndk ~/files/android ndk r10e/ ``` ç°åœ¨ï¼Œæˆ‘ä»¬é‡æ–°é…ç½®å’Œç¼–è¯‘ `android` ç¨‹åºï¼š ```bash $ xmake f p android $ xmake ``` ä»¥åï¼Œå°±ä¸éœ€è¦æ¯æ¬¡é‡å¤é…ç½® ` ndk å‚æ•°äº†ã€‚ > æ¯ä¸ªå‘½ä»¤éƒ½æœ‰å…¶ç®€å†™ï¼Œä¾‹å¦‚: `xmake g` æˆ–è€… `xmake global`ã€‚ ## æ¸…é™¤é…ç½® æœ‰æ—¶å€™ï¼Œé…ç½®å‡ºäº†é—®é¢˜ç¼–è¯‘ä¸è¿‡ï¼Œæˆ–è€…éœ€è¦é‡æ–°æ£€æµ‹å„ç§ä¾èµ–åº“å’Œæ¥å£ï¼Œå¯ä»¥åŠ ä¸Š ` c` å‚æ•°ï¼Œæ¸…é™¤ç¼“å­˜çš„é…ç½®ï¼Œå¼ºåˆ¶é‡æ–°æ£€æµ‹å’Œé…ç½®ï¼š ```bash $ xmake f c $ xmake ``` æˆ–è€…ï¼š ```bash $ xmake f p iphoneos c $ xmake ``` ## å¯¼å…¥å¯¼å‡ºé…ç½® æˆ‘ä»¬è¿˜å¯ä»¥å¯¼å…¥å¯¼å‡ºå·²ç»é…ç½®å¥½çš„é…ç½®é›†ï¼Œæ–¹ä¾¿é…ç½®çš„å¿«é€Ÿè¿ç§»ã€‚ ### å¯¼å‡ºé…ç½® ```bash $ xmake f export /tmp/config.txt $ xmake f m debug xxx y export /tmp/config.txt ``` ### å¯¼å…¥é…ç½® ```bash $ xmake f import /tmp/config.txt $ xmake f m debug xxx y import /tmp/config.txt ``` ### å¯¼å‡ºé…ç½®ï¼ˆå¸¦èœå•ï¼‰ ```bash $ xmake f menu export /tmp/config.txt $ xmake f menu m debug xxx y export /tmp/config.txt ``` ### å¯¼å…¥é…ç½®ï¼ˆå¸¦èœå•ï¼‰ ```bash $ xmake f menu import /tmp/config.txt $ xmake f menu m debug xxx y import /tmp/config.txt ```"}}