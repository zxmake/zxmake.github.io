{"/get_started/zh/tutorial/quick-start.html":{"title":"","content":" class: heading_no_counter # å¿«é€Ÿå¼€å§‹ ## åˆ›å»ºå·¥ç¨‹ åˆ›å»ºä¸€ä¸ªåå« `hello` çš„ `c` æ§åˆ¶å°å·¥ç¨‹ï¼š ```bash $ xmake create language c project ./hello # æˆ– $ xmake create l c P ./hello ``` æ‰§è¡Œå®Œåï¼Œå°†ä¼šç”Ÿæˆä¸€ä¸ªç®€å•å·¥ç¨‹ç»“æ„ï¼š ``` ./hello/ â”œâ”€â”€ src â”‚ â””â”€â”€ main.c â””â”€â”€ xmake.lua ``` å…¶ä¸­ `xmake.lua` æ˜¯å·¥ç¨‹æè¿°æ–‡ä»¶ï¼Œå†…å®¹éå¸¸ç®€å•ï¼Œå‘Šè¯‰ xmake æ·»åŠ  `src` ç›®å½•ä¸‹çš„æ‰€æœ‰ `.c` æºæ–‡ä»¶ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"hello\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` ç›®å‰æ”¯æŒçš„è¯­è¨€å¦‚ä¸‹ï¼š * c/c++ * objc/c++ * cuda * asm * swift * dlang * golang * rust > å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå‚æ•°é€‰é¡¹ï¼Œè¯·è¿è¡Œ: `xmake create help`ã€‚ ## æ„å»ºå·¥ç¨‹ ```bash $ cd hello $ xmake ``` ## è¿è¡Œç¨‹åº ```bash $ xmake run hello ``` ## è°ƒè¯•ç¨‹åº é¦–å…ˆä½ éœ€è¦åˆ‡æ¢åˆ° debug æ¨¡å¼å»é‡æ–°ç¼–è¯‘ç¨‹åºã€‚ ```bash $ xmake config m debug $ xmake ``` ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å»å¼€å§‹è°ƒè¯•ï¼š ```bash $ xmake run d hello ``` xmake å°†ä¼šä½¿ç”¨è°ƒè¯•å™¨å»åŠ è½½ç¨‹åºè¿è¡Œï¼Œç›®å‰æ”¯æŒï¼šlldb, gdb, windbg, vsjitdebugger, ollydbg ç­‰å„ç§è°ƒè¯•å™¨ã€‚ ```bash (gdb) b main Breakpoint 1 at 0x115c: file src/main.c, line 4. (gdb) r Starting program: /tmp/test xmake/hello/build/linux/x86_64/debug/hello [Thread debugging using libthread_db enabled] Using host libthread_db library \"/lib/x86_64 linux gnu/libthread_db.so.1\". Breakpoint 1, main (argc 1, argv 0x7fffffffdac8) at src/main.c:4 4 printf(\"hello world!\\n\"); (gdb) ``` å¦‚æœæƒ³è¦ä½¿ç”¨æŒ‡å®šçš„è°ƒè¯•å™¨ï¼š ```bash $ xmake f debugger gdb $ xmake run d hello ``` > ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç®€å†™çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œä¾‹å¦‚: `xmake r` æˆ–è€… `xmake run`ã€‚"},"/get_started/zh/tutorial/project-examples.html":{"title":"","content":" class: heading_no_counter # å·¥ç¨‹ä¾‹å­ ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„å·¥ç¨‹ä¾‹å­ï¼Œæ›´å¤šçš„ examples å¯ä»¥åˆ° [project examples](https://github.com/TOMO CAT/xmake/tree/master/tests/projects) ä¸­æŸ¥çœ‹ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `xmake create` å‘½ä»¤åˆ›å»ºå„ç§å¸¸ç”¨çš„ç©ºå·¥ç¨‹æ¥å¿«é€Ÿå¼€å§‹ï¼Œå…·ä½“å¯¹äºè¿™ä¸ªå‘½ä»¤çš„ä»‹ç»ä»¥åŠæ”¯æŒçš„å·¥ç¨‹æ¨¡æ¿å¯ä»¥æ•²ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š ```bash xmake create help ``` ## å¯æ‰§è¡Œç¨‹åº ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*c\") end) ``` å®Œæ•´ä¾‹å­è¯·æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºï¼š ```bash xmake create l c t console test ``` ## é™æ€åº“ç¨‹åº ```lua target(\"library\", function() set_kind(\"static\") add_files(\"src/library/*.c\") end) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*c\") add_deps(\"library\") end) ``` é€šè¿‡ `add_deps` å°†ä¸€ä¸ªé™æ€åº“è‡ªåŠ¨é“¾æ¥åˆ° test å¯æ‰§è¡Œç¨‹åºã€‚ å®Œæ•´ä¾‹å­è¯·æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºï¼š ```bash xmake create l c t static test ``` ## åŠ¨æ€åº“ç¨‹åº ```lua target(\"library\", function() set_kind(\"shared\") add_files(\"src/library/*.c\") end) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*c\") add_deps(\"library\") end) ``` é€šè¿‡ `add_deps` å°†ä¸€ä¸ªåŠ¨æ€åº“è‡ªåŠ¨é“¾æ¥åˆ° test å¯æ‰§è¡Œç¨‹åºã€‚ å®Œæ•´ä¾‹å­è¯·æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºï¼š ```bash xmake create l c t shared test ``` ## Wasm ç¨‹åº æ‰€æœ‰ c/c++ ç¨‹åºï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç¼–è¯‘æˆ Wasmï¼Œæ— éœ€ä»»ä½• xmake.lua é…ç½®æ”¹åŠ¨ï¼Œåªéœ€è¦åˆ‡æ¢åˆ° wasm ç¼–è¯‘å¹³å°è¿›è¡Œç¼–è¯‘ã€‚ ```bash $ xmake f p wasm $ xmake ``` è¯¦ç»†çš„ Wasm ç¼–è¯‘é…ç½®è§ï¼š[Wasm é…ç½®](/zh cn/guide/configuration?id wasm) å¦å¤–ï¼Œåœ¨ç¼–è¯‘å¸¦æœ‰ ` preload file assets/xxx.md` è®¾ç½®çš„æ–‡ä»¶æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®ï¼Œç®€åŒ–å¯¹å®ƒçš„è®¾ç½®ã€‚ ```lua target(\"test5\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") add_values(\"wasm.preloadfiles\", \"src/xxx.md\") add_values(\"wasm.preloadfiles\", \"src/xxx2.md\") end) ``` ## Qt ç¨‹åº åˆ›å»ºä¸€ä¸ªç©ºå·¥ç¨‹ï¼š ```bash $ xmake create t qt.console test $ xmake create t qt.static test $ xmake create t qt.shared test $ xmake create t qt.quickapp test $ xmake create t qt.widgetapp test ``` æ›´å¤šå·¥ç¨‹æ¨¡æ¿è§ï¼š`xmake create help`ã€‚ é»˜è®¤ä¼šè‡ªåŠ¨æ¢æµ‹ Qt ç¯å¢ƒï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®š Qt SDK ç¯å¢ƒç›®å½•ï¼š ```bash $ xmake f qt ~/Qt/Qt5.9.1 ``` ä¸Šè¿°æŒ‡å®šçš„ MingW SDK ç”¨çš„æ˜¯ Qt ä¸‹ Tools ç›®å½•è‡ªå¸¦çš„ç¯å¢ƒï¼Œå½“ç„¶å¦‚æœæœ‰å…¶ä»–ç¬¬ä¸‰æ–¹ MingW ç¼–è¯‘ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š, å…·ä½“å¯ä»¥å‚è€ƒï¼š[MingW ç¼–è¯‘é…ç½®](/zh cn/guide/configuration?id mingw)ã€‚ æ›´å¤šè¯¦æƒ…å¯ä»¥å‚è€ƒï¼š[#160](https://github.com/xmake io/xmake/issues/160) å¦å¤–ï¼Œå½“å‰ xmake ä¹Ÿæ”¯æŒ Qt/Wasmï¼Œè¯¦æƒ…è§ï¼š[Wasm é…ç½®](/zh cn/guide/configuration?id wasm) ```bash $ xmake f p wasm ``` ### é™æ€åº“ç¨‹åº ```lua target(\"qt_static_library\", function() add_rules(\"qt.static\") add_files(\"src/*.cpp\") add_frameworks(\"QtNetwork\", \"QtGui\") end) ``` ### åŠ¨æ€åº“ç¨‹åº ```lua target(\"qt_shared_library\", function() add_rules(\"qt.shared\") add_files(\"src/*.cpp\") add_frameworks(\"QtNetwork\", \"QtGui\") end) ``` ### æ§åˆ¶å°ç¨‹åº ```lua target(\"qt_console\", function() add_rules(\"qt.console\") add_files(\"src/*.cpp\") end) ``` ### Quick åº”ç”¨ç¨‹åº ```lua target(\"qt_quickapp\", function() add_rules(\"qt.quickapp\") add_files(\"src/*.cpp\") add_files(\"src/qml.qrc\") end) ``` > å¦‚æœä½¿ç”¨çš„è‡ªå·±ç¼–è¯‘çš„ static ç‰ˆæœ¬ QT SDKï¼Œé‚£ä¹ˆéœ€è¦åˆ‡æ¢åˆ° `add_rules(\"qt.quickapp_static\")` é™æ€è§„åˆ™æ‰è¡Œï¼Œå› ä¸ºé“¾æ¥çš„åº“æ˜¯ä¸åŒçš„ï¼Œéœ€è¦åšé™æ€é“¾æ¥ã€‚ ### Quick Plugin ç¨‹åº å®Œæ•´ä¾‹å­è§ï¼š[quickplugin example](https://github.com/xmake io/xmake/tree/master/tests/projects/qt/quickplugin) ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"demo\", function() add_rules(\"qt.qmlplugin\") add_headerfiles(\"src/*.h\") add_files(\"src/*.cpp\") set_values(\"qt.qmlplugin.import_name\", \"My.Plugin\") end) ``` ### Widgets åº”ç”¨ç¨‹åº ```lua target(\"qt_widgetapp\", function() add_rules(\"qt.widgetapp\") add_files(\"src/*.cpp\") add_files(\"src/mainwindow.ui\") add_files(\"src/mainwindow.h\") æ·»åŠ å¸¦æœ‰ Q_OBJECT çš„metaå¤´æ–‡ä»¶ end) ``` ### Android åº”ç”¨ç¨‹åº å¯ä»¥ç›´æ¥åˆ‡åˆ° android å¹³å°ç¼–è¯‘ Quick/Widgets åº”ç”¨ç¨‹åºï¼Œç”Ÿæˆ apk åŒ…ï¼Œå¹¶ä¸”å¯é€šè¿‡ `xmake install` å‘½ä»¤å®‰è£…åˆ°è®¾å¤‡ï¼š ```bash $ xmake create t quickapp_qt l c++ appdemo $ cd appdemo $ xmake f p android ndk ~/Downloads/android ndk r19c/ android_sdk ~/Library/Android/sdk/ c $ xmake [ 0%]: compiling.qt.qrc src/qml.qrc [ 50%]: cache compiling.release src/main.cpp [100%]: linking.release libappdemo.so [100%]: generating.qt.app appdemo.apk ``` ç„¶åå®‰è£…åˆ°è®¾å¤‡ï¼š ```bash $ xmake install installing appdemo ... installing build/android/release/appdemo.apk .. Success install ok!ğŸ‘Œ ``` ### ç›®å‰æ”¯æŒçš„ Qt SDK #### æ¥è‡ª Qt å®˜æ–¹æä¾›çš„ SDK å®‰è£…åŒ… åœ¨ macos ä¸Šé€šå¸¸èƒ½è‡ªåŠ¨æ¢æµ‹åˆ°ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š Qt SDK è·¯å¾„ã€‚ ```bash $ xmake f qt [qt sdk path] ``` #### æ¥è‡ª Ubuntu Apt å®‰è£…åŒ… ä½¿ç”¨ apt å®‰è£…å®Œ Qt SDKï¼Œxmake ä¹Ÿèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹åˆ°ã€‚ ```bash $ sudo apt install y qtcreator qtbase5 dev $ xmake ``` #### æ¥è‡ª msys2/pacman çš„ Qt Mingw å®‰è£…åŒ… xmake ä¹Ÿæ”¯æŒä» pacman å®‰è£…çš„ Qt Mingw SDK ```bash $ pacman S mingw w64 x86_64 qt5 mingw w64 x86_64 qt creator $ xmake ``` #### æ¥è‡ª aqtinstall è„šæœ¬çš„ Qt SDK åŒ… [aqtinstall](https://github.com/miurahr/aqtinstall) å®‰è£…çš„ Qt SDK æ˜¯å®Œå…¨åŸºäºå®˜æ–¹ SDK ç»“æ„çš„ï¼Œæ‰€ä»¥ xmake ä¹Ÿå®Œå…¨æ”¯æŒã€‚ ä½†æ˜¯ï¼Œé€šå¸¸éœ€è¦è‡ªå·±æŒ‡å®š SDK è·¯å¾„ã€‚ ```bash $ xmake f qt [Qt SDK] ``` #### è·¨å¹³å° Qt äº¤å‰ç¼–è¯‘ å¯¹äºè·¨å¹³å° Qt å¼€å‘ï¼Œxmake æ”¯æŒä¸ºä¸»æœºå·¥å…·å’Œç›®æ ‡å¹³å°ä½¿ç”¨å•ç‹¬çš„ SDKã€‚è¿™åœ¨ä¸ºä¸åŒäºå¼€å‘æœºå™¨çš„å¹³å°æ„å»º Qt åº”ç”¨ç¨‹åºæ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚ ` qt_host` é€‰é¡¹å…è®¸æ‚¨æŒ‡å®šä¸æ„å»ºæœºå™¨å…¼å®¹çš„ Qt å·¥å…·çš„ä½ç½®ï¼Œè€Œ ` qt` æŒ‡å‘ç›®æ ‡å¹³å°çš„ SDKï¼š ```bash $ xmake f qt [target Qt sdk] qt_host [host Qt sdk] ``` **é‡è¦æ³¨æ„äº‹é¡¹**ï¼š * ç¡®ä¿ä¸»æœºå’Œç›®æ ‡ Qt ç‰ˆæœ¬åŒ¹é…ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´æ„å»ºé—®é¢˜ã€‚ * æœ¬æœºéƒ¨ç½²å·¥å…·ï¼ˆå¦‚ `windeployqt` å’Œ `macdeployqt`ï¼‰å¿…é¡»åœ¨å„è‡ªçš„å¹³å°ä¸Šè¿è¡Œï¼Œå› æ­¤è·¨å¹³å°ä»»åŠ¡ï¼ˆå¦‚ `xmake install`ï¼‰å¯èƒ½ä¼šå¤±è´¥ã€‚ #### æ¥è‡ª xmake repo ä»“åº“çš„ Qt åŒ… xmake ç°åœ¨å®˜æ–¹æä¾›äº† Qt5 SDK çš„å„ç§æ¨¡å—åŒ…ï¼Œå¯ä»¥è‡ªåŠ¨é›†æˆä½¿ç”¨ï¼Œæ— éœ€ä»»ä½•æ‰‹åŠ¨å®‰è£…ã€‚ åªéœ€è¦é…ç½®é›†æˆåŒ…å°±è¡Œäº†ï¼Œxmake ä¼šè‡ªåŠ¨å¤„ç† Qt çš„å®‰è£…é›†æˆï¼Œå¹¶ä¸”è‡ªåŠ¨ç¼–è¯‘é¡¹ç›®ã€‚ ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"qt5widgets\") target(\"test\", function() add_rules(\"qt.widgetapp\") add_packages(\"qt5widgets\") add_headerfiles(\"src/*.h\") add_files(\"src/*.cpp\") add_files(\"src/mainwindow.ui\") add files with Q_OBJECT meta (only for qt.moc) add_files(\"src/mainwindow.h\") end) ``` é™¤äº† `qt5widgets` åŒ…ï¼Œä»“åº“è¿˜æä¾›äº† `qt5gui`, `qt5network` ç­‰åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ã€‚ é…ç½®å®Œï¼Œåªéœ€è¦æ‰§è¡Œï¼š ```bash $ xmake ``` #### æ¥è‡ª vcpkg/conan çš„ Qt åŒ… æš‚æ—¶è¿˜æ²¡æ—¶é—´æ”¯æŒï¼Œè¯·å°½é‡ä½¿ç”¨ä¸Šé¢çš„æ–¹å¼é›†æˆ Qt SDKã€‚ ## umdf é©±åŠ¨ç¨‹åº ```lua target(\"echo\", function() add_rules(\"wdk.driver\", \"wdk.env.umdf\") add_files(\"driver/*.c\") add_files(\"driver/*.inx\") add_includedirs(\"exe\") end) target(\"app\", function() add_rules(\"wdk.binary\", \"wdk.env.umdf\") add_files(\"exe/*.cpp\") end) ``` ### wdm é©±åŠ¨ç¨‹åº ```lua target(\"kcs\", function() add_rules(\"wdk.driver\", \"wdk.env.wdm\") add_values(\"wdk.man.flags\", \" prefix Kcs\") add_values(\"wdk.man.resource\", \"kcsCounters.rc\") add_values(\"wdk.man.header\", \"kcsCounters.h\") add_values(\"wdk.man.counter_header\", \"kcsCounters_counters.h\") add_files(\"*.c\", \"*.rc\", \"*.man\") end) ``` ```lua target(\"msdsm\", function() add_rules(\"wdk.driver\", \"wdk.env.wdm\") add_values(\"wdk.tracewpp.flags\", \" func:TracePrint((LEVEL,FLAGS,MSG,...))\") add_files(\"*.c\", {rule \"wdk.tracewpp\"}) add_files(\"*.rc\", \"*.inf\") add_files(\"*.mofmsdsm.mof\") add_files(\"msdsm.mof\", {values {wdk_mof_header \"msdsmwmi.h\"}}) end) ``` ### ç”Ÿæˆé©±åŠ¨åŒ… å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ .cab é©±åŠ¨åŒ…ï¼š ```bash $ xmake [ppackage] $ xmake [ppackage] o outputdir ``` è¾“å‡ºçš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š ``` drivers sampledsm debug/x86/sampledsm.cab release/x64/sampledsm.cab debug/x86/sampledsm.cab release/x64/sampledsm.cab ``` ### é©±åŠ¨ç­¾å é»˜è®¤ç¼–è¯‘ç¦ç”¨ç­¾åï¼Œå¯ä»¥é€šè¿‡ `set_values(\"wdk.sign.mode\", ...)` è®¾ç½®ç­¾åæ¨¡å¼æ¥å¯ç”¨ç­¾åã€‚ #### æµ‹è¯•ç­¾å æµ‹è¯•ç­¾åä¸€èˆ¬æœ¬æœºè°ƒè¯•æ—¶å€™ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ xmake è‡ªå¸¦çš„ test è¯ä¹¦æ¥è¿›è¡Œç­¾åï¼Œä¾‹å¦‚ï¼š ```lua target(\"msdsm\", function() add_rules(\"wdk.driver\", \"wdk.env.wdm\") set_values(\"wdk.sign.mode\", \"test\") end) ``` ä¸è¿‡è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨åœ¨ç®¡ç†å‘˜æ¨¡å¼ä¸‹ï¼Œæ‰§è¡Œä¸€éï¼š`$xmake l utils.wdk.testcert install`ï¼Œæ¥ç”Ÿæˆå’Œæ³¨å†Œ test è¯ä¹¦åˆ°æœ¬æœºç¯å¢ƒã€‚ è¿™ä¸ªåªéœ€è¦æ‰§è¡Œä¸€æ¬¡å°±è¡Œäº†ï¼Œåç»­å°±å¯ä»¥æ­£å¸¸ç¼–è¯‘å’Œç­¾åäº†ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬æœºå·²æœ‰çš„æœ‰æ•ˆè¯ä¹¦å»ç­¾åã€‚ ä» sha1 æ¥é€‰æ‹©åˆé€‚çš„è¯ä¹¦è¿›è¡Œç­¾åï¼š ```lua target(\"msdsm\", function() add_rules(\"wdk.driver\", \"wdk.env.wdm\") set_values(\"wdk.sign.mode\", \"test\") set_values(\"wdk.sign.thumbprint\", \"032122545DCAA6167B1ADBE5F7FDF07AE2234AAA\") end) ``` ä» store/company æ¥é€‰æ‹©åˆé€‚çš„è¯ä¹¦è¿›è¡Œç­¾åï¼š ```lua target(\"msdsm\", function() add_rules(\"wdk.driver\", \"wdk.env.wdm\") set_values(\"wdk.sign.mode\", \"test\") set_values(\"wdk.sign.store\", \"PrivateCertStore\") set_values(\"wdk.sign.company\", \"tboox.org(test)\") end) ``` #### æ­£å¼ç­¾å é€šè¿‡æŒ‡å®šå¯¹åº”çš„æ­£å¼ç­¾åè¯ä¹¦æ–‡ä»¶è¿›è¡Œç­¾åï¼š ```lua target(\"msdsm\", function() add_rules(\"wdk.driver\", \"wdk.env.wdm\") set_values(\"wdk.sign.mode\", \"release\") set_values(\"wdk.sign.company\", \"xxxx\") set_values(\"wdk.sign.certfile\", path.join(os.projectdir(), \"xxxx.cer\")) end) ``` ### ç”Ÿæˆä½ç‰ˆæœ¬é©±åŠ¨ å¦‚æœæƒ³åœ¨ wdk10 ç¯å¢ƒç¼–è¯‘ç”Ÿæˆ win7, win8 ç­‰ä½ç‰ˆæœ¬ç³»ç»Ÿæ”¯æŒçš„é©±åŠ¨ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® `wdk.env.winver` æ¥åˆ‡æ¢ç³»ç»Ÿç‰ˆæœ¬ï¼š ```lua set_values(\"wdk.env.winver\", \"win10\") set_values(\"wdk.env.winver\", \"win10_rs3\") set_values(\"wdk.env.winver\", \"win81\") set_values(\"wdk.env.winver\", \"win8\") set_values(\"wdk.env.winver\", \"win7\") set_values(\"wdk.env.winver\", \"win7_sp1\") set_values(\"wdk.env.winver\", \"win7_sp2\") set_values(\"wdk.env.winver\", \"win7_sp3\") ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šç¼–è¯‘çš„ç›®æ ‡ç¨‹åºæ”¯æŒçš„ windows ç‰ˆæœ¬ï¼š ```bash $ xmake f wdk_winver [win10_rs3win8win7win7_sp1] $ xmake ``` ## iOS/MacOS ç¨‹åº ### App åº”ç”¨ç¨‹åº ç”¨äºç”Ÿæˆ `*.app/*.ipa` åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶æ”¯æŒ iOS/MacOSã€‚ ```lua target(\"test\", function() add_rules(\"xcode.application\") add_files(\"src/*.m\", \"src/**.storyboard\", \"src/*.xcassets\") add_files(\"src/Info.plist\") end) ``` > å¯ä»¥æ”¯æŒç›´æ¥æ·»åŠ  `*.metal` æ–‡ä»¶ï¼Œxmake ä¼šè‡ªåŠ¨ç”Ÿæˆ default.metallib æä¾›ç»™åº”ç”¨ç¨‹åºåŠ è½½ä½¿ç”¨ã€‚ #### åˆ›å»ºå·¥ç¨‹ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¨¡æ¿å·¥ç¨‹å¿«é€Ÿåˆ›å»ºï¼š ```bash $ xmake create t xcode.macapp l objc test $ xmake create t xcode.iosapp l objc test ``` #### ç¼–è¯‘ ```bash $ xmake f p [iphoneosmacosx] $ xmake [ 18%]: compiling.xcode.release src/Assets.xcassets [ 27%]: processing.xcode.release src/Info.plist [ 72%]: compiling.xcode.release src/Base.lproj/Main.storyboard [ 81%]: compiling.xcode.release src/Base.lproj/LaunchScreen.storyboard [ 45%]: cache compiling.release src/ViewController.m [ 63%]: cache compiling.release src/AppDelegate.m [ 54%]: cache compiling.release src/SceneDelegate.m [ 36%]: cache compiling.release src/main.m [ 90%]: linking.release test [100%]: generating.xcode.release test.app [100%]: build ok! ``` #### é…ç½®ç­¾å å¯¹äº iOS ç¨‹åºï¼Œé»˜è®¤ä¼šæ£€æµ‹ç³»ç»Ÿå…ˆç”¨å¯ç”¨ç­¾åæ¥ç­¾å appï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šå…¶ä»–ç­¾åè¯ä¹¦ï¼š ```bash $ xmake f p iphoneos xcode_codesign_identity 'Apple Development: xxx@gmail.com (T3NA4MRVPU)' xcode_mobile_provision 'iOS Team Provisioning Profile: org.tboox.test xcode_bundle_identifier org.tboox.test' $ xmake ``` å¦‚æœæ¯æ¬¡è¿™ä¹ˆé…ç½®ç­¾åè§‰å¾—ç¹ççš„è¯ï¼Œå¯ä»¥è®¾ç½®åˆ° `xmake global` å…¨å±€é…ç½®ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨ xmake.lua ä¸­å¯¹æ¯ä¸ª target å•ç‹¬è®¾ç½®ï¼š ```lua target(\"test\", function() add_rules(\"xcode.application\") add_files(\"src/*.m\", \"src/**.storyboard\", \"src/*.xcassets\") add_files(\"src/Info.plist\") add_values(\"xcode.bundle_identifier\", \"org.tboox.test\") add_values(\"xcode.codesign_identity\", \"Apple Development: xxx@gmail.com (T3NA4MRVPU)\") add_values(\"xcode.mobile_provision\", \"iOS Team Provisioning Profile: org.tboox.test\") end) ``` é‚£å¦‚ä½•çŸ¥é“æˆ‘ä»¬éœ€è¦çš„ç­¾åé…ç½®å‘¢ï¼Ÿä¸€ç§å°±æ˜¯åœ¨ xcode é‡Œé¢æŸ¥çœ‹ï¼Œå¦å¤– xmake ä¹Ÿæä¾›äº†ä¸€äº›è¾…åŠ©å·¥å…·å¯ä»¥ dump å‡ºå½“å‰å¯ç”¨çš„æ‰€æœ‰ç­¾åé…ç½®ï¼š ```bash $ xmake l private.tools.codesign.dump codesign identities { \"Apple Development: waruqi@gmail.com (T3NA4MRVPU)\" \"AF73C231A0C35335B72761BD3759694739D34EB1\" } mobile provisions { \"iOS Team Provisioning Profile: org.xmake.test\" \"<?xml version \"1.0\" encoding \"UTF 8\"?> <!DOCTYPE plist PUBLIC \" //Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList 1.0.dtd\"> <plist version \"1.0\"> <dict> \t<key>AppIDName</key> \t<string>XC org xmake test5</string> \t<key>ApplicationIdentifierPrefix</key> \t<array> \t<string>43AAQM58X3</string> ... ``` æˆ‘ä»¬ä¹Ÿæä¾›äº†å…¶ä»–è¾…åŠ©å·¥å…·æ¥å¯¹å·²æœ‰çš„ ipa/app ç¨‹åºè¿›è¡Œé‡ç­¾åï¼Œä¾‹å¦‚ï¼š ```bash $ xmake l utils.ipa.resign test.ipatest.app [codesign_identity] [mobile_provision] [bundle_identifier] ``` å…¶ä¸­ï¼Œåé¢çš„ç­¾åå‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæ²¡è®¾ç½®ï¼Œé‚£ä¹ˆé»˜è®¤ä¼šæ¢æµ‹ä½¿ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„ç­¾åï¼š ```bash $ xmake l utils.ipa.resign test.ipa $ xmake l utils.ipa.resign test.app \"Apple Development: cat@gmail.com (T3NA4MRVPU)\" $ xmake l utils.ipa.resign test.ipa \"Apple Development: cat@gmail.com (T3NA4MRVPU)\" iOS Team Provisioning Profile: org.xmake.test\" org.xmake.test ``` #### è¿è¡Œåº”ç”¨ç¨‹åº ç›®å‰ä»…æ”¯æŒè¿è¡Œmacosç¨‹åºï¼š ```bash $ xmake run ``` æ•ˆæœå¦‚ä¸‹ï¼š ![](/assets/img/guide/macapp.png) #### ç”Ÿæˆç¨‹åºåŒ… å¦‚æœæ˜¯ iOS ç¨‹åºä¼šç”Ÿæˆ ipa å®‰è£…åŒ…ï¼Œå¦‚æœæ˜¯ macos ä¼šç”Ÿæˆ dmg ï¼ˆdmg åŒ…ç”Ÿæˆæš‚æ—¶è¿˜åœ¨å¼€å‘ä¸­ï¼‰ã€‚ ```bash $ xmake package output: build/iphoneos/release/arm64/test.ipa package ok! ``` æˆ‘ä»¬ä¹Ÿæä¾›äº†è¾…åŠ©å·¥å…·ï¼Œæ¥å¯¹æŒ‡å®š app ç¨‹åºè¿›è¡Œæ‰“åŒ…ï¼š ```bash $ xmake l utils.ipa.package test.app output.ipa [iconfile.png] ``` #### å®‰è£… å¦‚æœæ˜¯ iOS ç¨‹åºä¼šå®‰è£… ipa åˆ°è®¾å¤‡ï¼Œå¦‚æœæ˜¯ macos ä¼šå®‰è£… app åˆ° /Applications ç›®å½•ã€‚ ```bash $ xmake install ``` æˆ‘ä»¬ä¹Ÿæä¾›äº†è¾…åŠ©å·¥å…·ï¼Œæ¥å¯¹æŒ‡å®šipa/appç¨‹åºå®‰è£…åˆ°è®¾å¤‡ï¼š ```bash $ xmake l utils.ipa.install test.app $ xmake l utils.ipa.install test.ipa ``` #### å¸è½½ > ç›®å‰ä»…æ”¯æŒ macos ç¨‹åºå¸è½½ ```bash $ xmake uninstall ``` ### Framework åº“ç¨‹åº ```lua target(\"test\", function() add_rules(\"xcode.framework\") add_files(\"src/*.m\") add_files(\"src/Info.plist\") end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¨¡æ¿å·¥ç¨‹å¿«é€Ÿåˆ›å»ºï¼š ```bash $ xmake create t xcode.framework l objc test ``` å¦å¤–ï¼Œxmake è¿˜æä¾›äº†å¸¦æœ‰ framework åº“ä½¿ç”¨çš„å®Œæ•´ iosapp/macapp ç©ºå·¥ç¨‹æ¨¡æ¿ï¼Œå¯ä»¥å®Œæ•´ä½“éªŒ framework çš„ç¼–è¯‘ï¼Œä¾èµ–ä½¿ç”¨ä»¥åŠé›†æˆåˆ° app åº”ç”¨ç¨‹åºä¸­ã€‚ åŒæ—¶ï¼Œå¦‚æœæˆ‘ä»¬å¼€å¯äº†æ¨¡æ‹Ÿå™¨ï¼Œxmake å¯ä»¥æ”¯æŒç›´æ¥ `xmake install` å’Œ `xmake run` å°† app å®‰è£…åˆ°æ¨¡æ‹Ÿå™¨å¹¶åŠ è½½è¿è¡Œã€‚ ```bash $ xmake create t xcode.iosapp_with_framework l objc testapp $ cd testapp $ xmake f p iphoneos a x86_64 $ xmake $ xmake install $ xmake run ``` ### Bundleç¨‹åº ```lua target(\"test\", function() add_rules(\"xcode.bundle\") add_files(\"src/*.m\") add_files(\"src/Info.plist\") end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¨¡æ¿å·¥ç¨‹å¿«é€Ÿåˆ›å»ºï¼š ```bash $ xmake create t xcode.bundle l objc test ``` ## Protobufç¨‹åº ### ä½¿ç”¨cåº“ ```lua add_requires(\"protobuf c\") target(\"console_c\", function() set_kind(\"binary\") add_packages(\"protobuf c\") add_rules(\"protobuf.c\") add_files(\"src/*.c\") add_files(\"src/*.proto\") end) ``` æˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½® `proto_public true` æ¥å¯¼å‡º proto çš„å¤´æ–‡ä»¶æœç´¢ç›®å½•ï¼Œå¼€æ”¾ç»™å…¶ä»–çˆ¶ target ç»§æ‰¿ä½¿ç”¨ã€‚ ```lua add_packages(\"protobuf c\", {public true}) add_files(\"src/**.proto\", {proto_public true}) ``` æ³¨ï¼šç”±äº protobuf ç”Ÿæˆçš„å¤´æ–‡ä»¶å¼•ç”¨äº† protobuf c åŒ…çš„å¤´æ–‡ä»¶ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†åŒ…çš„å¤´æ–‡ä»¶æ ‡è®°ä¸º `{public true}` å¯¹å¤–å¯¼å‡ºå®ƒã€‚ ### ä½¿ç”¨c++åº“ ```lua add_requires(\"protobuf cpp\") target(\"console_c++\", function() set_kind(\"binary\") set_languages(\"c++11\") add_packages(\"protobuf cpp\") add_rules(\"protobuf.cpp\") add_files(\"src/*.cpp\") add_files(\"src/*.proto\") end) ``` æˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½® `proto_public true` æ¥å¯¼å‡º proto çš„å¤´æ–‡ä»¶æœç´¢ç›®å½•ï¼Œå¼€æ”¾ç»™å…¶ä»–çˆ¶ target ç»§æ‰¿ä½¿ç”¨ã€‚ ```lua add_packages(\"protobuf cpp\", {public true}) add_files(\"src/**.proto\", {proto_public true}) ``` æ³¨ï¼šç”±äº protobuf ç”Ÿæˆçš„å¤´æ–‡ä»¶å¼•ç”¨äº† protobuf cpp åŒ…çš„å¤´æ–‡ä»¶ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†åŒ…çš„å¤´æ–‡ä»¶æ ‡è®°ä¸º `{public true}` å¯¹å¤–å¯¼å‡ºå®ƒã€‚ ## Cudaç¨‹åº åˆ›å»ºä¸€ä¸ªç©ºå·¥ç¨‹ï¼š ```bash $ xmake create P test l cuda $ cd test $ xmake ``` ```lua define target target(\"cuda_console\", function() set_kind(\"binary\") add_files(\"src/*.cu\") generate SASS code for SM architecture of current host add_cugencodes(\"native\") generate PTX code for the virtual architecture to guarantee compatibility add_cugencodes(\"compute_30\") end) ``` > é»˜è®¤æ„å»ºä¼šå¯ç”¨ device linkã€‚ï¼ˆå‚è§ [Separate Compilation and Linking of CUDA C++ Device Code](https://devblogs.nvidia.com/separate compilation linking cuda device code/)ï¼‰ > å¦‚æœè¦æ˜¾å¼ç¦ç”¨ device linkï¼Œå¯ä»¥é€šè¿‡ `set_policy(\"build.cuda.devlink\", false)` æ¥è®¾ç½®ã€‚ > cuda æºæ–‡ä»¶ä¸­çš„ device å‡½æ•°éœ€è¦è¢« device link ä¸”åª device link ä¸€æ¬¡ã€‚åœ¨ `shared` æˆ– `binary` çš„ target ä¸Š xmake ä¼šè‡ªåŠ¨è¿›è¡Œ device link ï¼Œè¿™æ—¶å®ƒä»¬ä¾èµ–çš„ `static` target ä¹Ÿä¼šåŒæ—¶è¢« device link ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ `static` target ä¸ä¼šè¢« device linkã€‚ç„¶è€Œï¼Œå¦‚æœæœ€ç»ˆçš„ `shared` æˆ– `binary` çš„ target ä¸åŒ…å«ä»»ä½• cuda æºæ–‡ä»¶ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿ device link é˜¶æ®µï¼Œå¯¼è‡´å‡ºç° undefined reference é”™è¯¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦æ‰‹åŠ¨ä¸º `static` target æŒ‡å®š `add_values(\"cuda.build.devlink\", true)`. é»˜è®¤ä¼šè‡ªåŠ¨æ¢æµ‹ cuda ç¯å¢ƒï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®š Cuda SDK ç¯å¢ƒç›®å½•ï¼Œæˆ–è€…æŒ‡å®š cuda ç‰ˆæœ¬ï¼ˆæ­¤æ—¶å°†åœ¨é»˜è®¤å®‰è£…ç›®å½•è¿›è¡ŒæŸ¥æ‰¾ï¼‰ï¼š ```bash $ xmake f cuda /usr/local/cuda 9.1/ $ xmake f cuda 9.1 $ xmake ``` æ›´å¤šè¯¦æƒ…å¯ä»¥å‚è€ƒï¼š[#158](https://github.com/xmake io/xmake/issues/158) ## Lex & Yaccç¨‹åº ```lua target(\"calc\", function() set_kind(\"binary\") add_rules(\"lex\", \"yacc\") add_files(\"src/*.l\", \"src/*.y\") end) ``` ## OpenMP ç¨‹åº æˆ‘ä»¬ä¸éœ€è¦é¢å¤–é…ç½® rulesï¼Œä»…ä»…é€šè¿‡ä¸€ä¸ªé€šç”¨çš„ openmp åŒ…å°±å¯ä»¥å®ç°ç›¸åŒçš„æ•ˆæœã€‚ ```lua add_requires(\"openmp\") target(\"loop\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") add_packages(\"openmp\") end) ``` ## Fortran ç¨‹åº æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œå¿«é€Ÿåˆ›å»ºä¸€ä¸ªåŸºäº fortran çš„ç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l fortran t console test ``` å®ƒçš„xmake.luaå†…å®¹å¦‚ä¸‹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.f90\") end) ``` æ›´å¤šä»£ç ä¾‹å­å¯ä»¥åˆ°è¿™é‡ŒæŸ¥çœ‹ï¼š[Fortran Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/fortran) ## Go ç¨‹åº xmake ä¹Ÿæ”¯æŒ go ç¨‹åºçš„æ„å»ºï¼Œä¹Ÿæä¾›äº†ç©ºå·¥ç¨‹çš„åˆ›å»ºå‘½ä»¤æ”¯æŒ: ```bash $ xmake create l go t console test ``` xmake.lua å†…å®¹å¦‚ä¸‹: ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.go\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[Go Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/go) ## Dlang ç¨‹åº åˆ›å»ºç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l dlang t console test ``` xmake.lua å†…å®¹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.d\") end) ``` xmake ä¹Ÿæä¾›å¯¹ dub åŒ…ç®¡ç†çš„æ”¯æŒï¼Œå¯ä»¥å¿«é€Ÿé›†æˆ dlang çš„ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"dub::log 0.4.3\", {alias \"log\"}) add_requires(\"dub::dateparser\", {alias \"dateparser\"}) add_requires(\"dub::emsi_containers\", {alias \"emsi_containers\"}) add_requires(\"dub::stdx allocator\", {alias \"stdx allocator\"}) add_requires(\"dub::mir core\", {alias \"mir core\"}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.d\") add_packages(\"log\", \"dateparser\", \"emsi_containers\", \"stdx allocator\", \"mir core\") end) ``` ä¸è¿‡è¿˜æœ‰ä¸€äº›ä¸å®Œå–„çš„åœ°æ–¹ï¼Œæ¯”å¦‚ç›®å‰å¿…é¡»æ‰‹åŠ¨é…ç½®æ‰€æœ‰çº§è”ä¾èµ–åŒ…ï¼Œä¼šç¨å¾®ç¹çäº›ï¼Œåç»­æœ‰å¾…æ”¹è¿›ã€‚ æ›´å¤šä¾‹å­è§ï¼š[Dlang Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/dlang) ## Rustç¨‹åº åˆ›å»ºç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l rust t console test ``` xmake.lua å†…å®¹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/main.rs\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[Rust Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/rust) ### æ·»åŠ  Cargo åŒ…ä¾èµ– ä¾‹å­: https://github.com/xmake io/xmake/tree/dev/tests/projects/rust/cargo_deps ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"cargo::base64 0.13.0\") add_requires(\"cargo::flate2 1.0.17\", {configs {features \"zlib\"}}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/main.rs\") add_packages(\"cargo::base64\", \"cargo::flate2\") end) ``` ### é›†æˆ Cargo.toml çš„ä¾èµ–åŒ… ä¸Šé¢ç›´æ¥ä½¿ç”¨ `add_requires(\"cargo::base64 0.13.0\")` çš„æ–¹å¼é›†æˆä¾èµ–ï¼Œä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼š å¦‚æœä¾èµ–å¾ˆå¤šï¼Œå¹¶ä¸”æœ‰å‡ ä¸ªä¾èµ–éƒ½å…±åŒä¾èµ–äº†ç›¸åŒçš„å­ä¾èµ–ï¼Œé‚£ä¹ˆä¼šå‡ºç°é‡å®šä¹‰é—®é¢˜ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬ä½¿ç”¨å®Œæ•´çš„ Cargo.toml å»ç®¡ç†ä¾èµ–å°±ä¸ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚ ä¾‹å¦‚ï¼š ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"cargo::test\", {configs {cargo_toml path.join(os.projectdir(), \"Cargo.toml\")}}) target(\"test\") set_kind(\"binary\") add_files(\"src/main.rs\") add_packages(\"cargo::test\") ``` å®Œæ•´ä¾‹å­è§ï¼š[cargo_deps_with_toml](https://github.com/xmake io/xmake/blob/dev/tests/projects/rust/cargo_deps_with_toml/xmake.lua) ### ä½¿ç”¨ cxxbridge åœ¨ c++ ä¸­è°ƒç”¨ rust ä¾‹å­: [https://github.com/xmake io/xmake/tree/dev/tests/projects/rust/cxx_call_rust_library](https://github.com/xmake io/xmake/tree/dev/tests/projects/rust/cxx_call_rust_library) ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"cargo::cxx 1.0\") target(\"foo\", function() set_kind(\"static\") add_files(\"src/foo.rs\") set_values(\"rust.cratetype\", \"staticlib\") add_packages(\"cargo::cxx\") end) target(\"test\", function() set_kind(\"binary\") add_rules(\"rust.cxxbridge\") add_deps(\"foo\") add_files(\"src/main.cc\") add_files(\"src/bridge.rsx\") end) ``` foo.rs ```rust #[cxx::bridge] mod foo { extern \"Rust\" { fn add(a: i32, b: i32) > i32; } } pub fn add(a: i32, b: i32) > i32 { return a + b; } ``` æˆ‘ä»¬è¿˜éœ€è¦åœ¨ c++ é¡¹ç›®ä¸­æ·»åŠ æ¡¥æ¥æ–‡ä»¶ bridge.rsx ```rust #[cxx::bridge] mod foo { extern \"Rust\" { fn add(a: i32, b: i32) > i32; } } ``` main.cc ```c++ #include <stdio.h> #include \"bridge.rs.h\" int main(int argc, char** argv) { printf(\"add(1, 2) %d\\n\", add(1, 2)); return 0; } ``` ### åœ¨ Rust ä¸­è°ƒç”¨ C++ ä¾‹å­: [https://github.com/xmake io/xmake/tree/dev/tests/projects/rust/rust_call_cxx_library](https://github.com/xmake io/xmake/tree/dev/tests/projects/rust/rust_call_cxx_library) ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"foo\", function() set_kind(\"static\") add_files(\"src/foo.cc\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"foo\") add_files(\"src/main.rs\") end) ``` main.rs ```rust extern \"C\" { \tfn add(a: i32, b: i32) > i32; } fn main() { unsafe { \t println!(\"add(1, 2) {}\", add(1, 2)); } } ``` foo.cc ```c++ extern \"C\" int add(int a, int b) { return a + b; } ``` ## Swift ç¨‹åº åˆ›å»ºç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l swift t console test ``` xmake.luaå†…å®¹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.swift\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[Swift Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/swift) ## Objc ç¨‹åº åˆ›å»ºç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l objc t console test ``` xmake.lua å†…å®¹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.m\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[Objc Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/objc++) ## Objc ç¨‹åº åˆ›å»ºç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l objc t console test ``` xmake.lua å†…å®¹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.m\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[Objc Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/objc++) ## Zig ç¨‹åº åˆ›å»ºç©ºå·¥ç¨‹ï¼š ```bash $ xmake create l zig t console test ``` xmake.lua å†…å®¹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.zig\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[Zig Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/zig) ## Linux Bpf ç¨‹åº xmake æ”¯æŒ bpf ç¨‹åºæ„å»ºï¼ŒåŒæ—¶æ”¯æŒ linux ä»¥åŠ android å¹³å°ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ‹‰å– llvm å’Œ android ndk å·¥å…·é“¾ã€‚ æ›´å¤šè¯¦æƒ…è§ï¼š[#1274](https://github.com/xmake io/xmake/issues/1274) ```lua add_rules(\"mode.release\", \"mode.debug\") add_rules(\"platform.linux.bpf\") add_requires(\"linux tools\", {configs {bpftool true}}) add_requires(\"libbpf\") if is_plat(\"android\") then add_requires(\"ndk > 22.x\") set_toolchains(\"@ndk\", {sdkver \"23\"}) else add_requires(\"llvm > 10.x\") set_toolchains(\"@llvm\") add_requires(\"linux headers\") end target(\"minimal\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"linux tools\", \"linux headers\", \"libbpf\") set_license(\"GPL 2.0\") end) ``` ## Vala ç¨‹åº xmake æ”¯æŒæ„å»º Vala ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦åº”ç”¨ `add_rules(\"vala\")` è§„åˆ™ï¼Œå¹¶ä¸” glib åŒ…æ˜¯å¿…é¡»çš„ã€‚ ç›¸å…³ issues: [#1618](https://github.com/xmake io/xmake/issues/1618) `add_values(\"vala.packages\")` ç”¨äºå‘Šè¯‰ valacï¼Œé¡¹ç›®éœ€è¦å“ªäº›åŒ…ï¼Œå®ƒä¼šå¼•å…¥ç›¸å…³åŒ…çš„ vala apiï¼Œä½†æ˜¯åŒ…çš„ä¾èµ–é›†æˆï¼Œè¿˜æ˜¯éœ€è¦é€šè¿‡ `add_requires(\"lua\")` ä¸‹è½½é›†æˆã€‚ ### æ§åˆ¶å°ç¨‹åº ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"lua\", \"glib\") target(\"test\", function() set_kind(\"binary\") add_rules(\"vala\") add_files(\"src/*.vala\") add_packages(\"lua\", \"glib\") add_values(\"vala.packages\", \"lua\") end) ``` ### é™æ€åº“ç¨‹åº æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ `add_values(\"vala.header\", \"mymath.h\")` è®¾ç½®å¯¼å‡ºçš„æ¥å£å¤´æ–‡ä»¶åï¼Œé€šè¿‡ `add_values(\"vala.vapi\", \"mymath 1.0.vapi\")` è®¾ç½®å¯¼å‡ºçš„ vapi æ–‡ä»¶åã€‚ ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"glib\") target(\"mymath\", function() set_kind(\"static\") add_rules(\"vala\") add_files(\"src/mymath.vala\") add_values(\"vala.header\", \"mymath.h\") add_values(\"vala.vapi\", \"mymath 1.0.vapi\") add_packages(\"glib\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"mymath\") add_rules(\"vala\") add_files(\"src/main.vala\") add_packages(\"glib\") end) ``` ### åŠ¨æ€åº“ç¨‹åº ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"glib\") target(\"mymath\", function() set_kind(\"shared\") add_rules(\"vala\") add_files(\"src/mymath.vala\") add_values(\"vala.header\", \"mymath.h\") add_values(\"vala.vapi\", \"mymath 1.0.vapi\") add_packages(\"glib\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"mymath\") add_rules(\"vala\") add_files(\"src/main.vala\") add_packages(\"glib\") end) ``` æ›´å¤šä¾‹å­ï¼š[Vala examples](https://github.com/xmake io/xmake/tree/master/tests/projects/vala) ## Pascal ç¨‹åº æˆ‘ä»¬èƒ½å¤Ÿæ”¯æŒæ„å»º Pascal ç¨‹åºï¼Œç›¸å…³ issues è§ï¼š[#388](https://github.com/xmake io/xmake/issues/388) ### æ§åˆ¶å°ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.pas\") end) ``` ### åŠ¨æ€åº“ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"foo\", function() set_kind(\"shared\") add_files(\"src/foo.pas\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"foo\") add_files(\"src/main.pas\") end) ``` æ›´å¤šä¾‹å­ï¼š[Pascal examples](https://github.com/xmake io/xmake/tree/master/tests/projects/pascal) ## Swig æ¨¡å— xmake æ”¯æŒæ„å»º Swig æ¨¡å—ï¼Œæˆ‘ä»¬æä¾›äº† `swig.c` å’Œ `swig.cpp` è§„åˆ™ï¼Œåˆ†åˆ«å¯¹åº”æ”¯æŒç”Ÿæˆ c/c++ æ¨¡å—æ¥å£ä»£ç ï¼Œé…åˆ xmake çš„åŒ…ç®¡ç†ç³»ç»Ÿå®ç°å®Œå…¨è‡ªåŠ¨åŒ–çš„æ¨¡å—å’Œä¾èµ–åŒ…æ•´åˆã€‚ ç›¸å…³ issues: [#1622](https://github.com/xmake io/xmake/issues/1622) ### Lua/C æ¨¡å— ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"lua\") target(\"example\", function() add_rules(\"swig.c\", {moduletype \"lua\"}) add_files(\"src/example.i\", {swigflags \" no old metatable bindings\"}) add_files(\"src/example.c\") add_packages(\"lua\") end) ``` ### Python/C æ¨¡å— ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"python 3.x\") target(\"example\", function() add_rules(\"swig.c\", {moduletype \"python\"}) add_files(\"src/example.i\", {scriptdir \"share\"}) add_files(\"src/example.c\") add_packages(\"python\") end) ``` ### Python/C++ æ¨¡å— ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"python 3.x\") target(\"example\", function() add_rules(\"swig.cpp\", {moduletype \"python\"}) add_files(\"src/example.i\", {scriptdir \"share\"}) add_files(\"src/example.cpp\") add_packages(\"python\") end) ``` ### Java/C æ¨¡å— [å®Œæ•´ä¾‹å­](https://github.com/xmake io/xmake/blob/dev/tests/projects/swig/java_c) ```lua make sure you config to an enviroment with jni.h for example: xmake f c p android target(\"example\", function() set_kind('shared') set moduletype to java add_rules(\"swig.c\", {moduletype \"java\"}) test jar build add_rules(\"swig.c\", {moduletype \"java\" , buildjar true}) use swigflags to provider package name and output path of java files add_files(\"src/example.i\", {swigflags { \" package\", \"com.example\", \" outdir\", \"build/java/com/example/\" }}) add_files(\"src/example.c\") add_includedirs(\"src\") before_build(function() ensure output path exists before running swig os.mkdir(\"build/java/com/example/\") end) end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½® ```lua add_rules(\"swig.c\", {moduletype \"java\", buildjar true}) ``` å»åŒæ—¶æ„å»º jar åŒ…ï¼Œæ–¹ä¾¿ç›´æ¥ä½¿ç”¨ã€‚ ## C++20 æ¨¡å— ### å¿«é€Ÿå¼€å§‹ xmake é‡‡ç”¨ `.mpp` ä½œä¸ºé»˜è®¤çš„æ¨¡å—æ‰©å±•åï¼Œä½†æ˜¯ä¹ŸåŒæ—¶æ”¯æŒ `.ixx`, `.cppm`, `.mxx` ç­‰æ‰©å±•åã€‚ ç›®å‰ xmake å·²ç»å®Œæ•´æ”¯æŒ gcc11/clang/msvc çš„ C++20 Modules æ„å»ºæ”¯æŒï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨åˆ†ææ¨¡å—é—´çš„ä¾èµ–å…³ç³»ï¼Œå®ç°æœ€å¤§åŒ–å¹¶è¡Œç¼–è¯‘ã€‚ ```lua set_languages(\"c++20\") target(\"class\", function() set_kind(\"binary\") add_files(\"src/*.cpp\", \"src/*.mpp\") end) ``` æ›´å¤šä¾‹å­è§ï¼š[C++ Modules](https://github.com/xmake io/xmake/tree/master/tests/projects/c%2B%2B/modules) ### Cpp Only å·¥ç¨‹ xmake å¯¹ C++20 æ¨¡å—çš„å®ç°è¿›è¡Œäº†é‡æ„å’Œå‡çº§ï¼Œæ–°å¢äº†å¯¹ Headerunits çš„æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¨¡å—ä¸­å¼•å…¥ Stl å’Œ ç”¨æˆ·å¤´æ–‡ä»¶æ¨¡å—ã€‚ ç›¸å…³çš„è¡¥ä¸è§ï¼š[#2641](https://github.com/xmake io/xmake/pull/2641)ã€‚ æ³¨ï¼šé€šå¸¸æˆ‘ä»¬è‡³å°‘éœ€è¦æ·»åŠ ä¸€ä¸ª `.mpp` æ–‡ä»¶ï¼Œæ‰èƒ½å¼€å¯ C++20 modules ç¼–è¯‘ï¼Œå¦‚æœåªæœ‰ cpp æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ä¸ä¼šå¼€å¯æ¨¡å—ç¼–è¯‘çš„ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä»…ä»…åªæ˜¯æƒ³åœ¨ cpp æ–‡ä»¶ä¸­ä½¿ç”¨æ¨¡å—çš„ Headerunits ç‰¹æ€§ï¼Œæ¯”å¦‚å¼•å…¥ä¸€äº› stl Headerunits åœ¨ cpp ä¸­ä½¿ç”¨ï¼Œ é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½® `set_policy(\"build.c++.modules\", true)` æ¥å¼ºè¡Œå¼€å¯ C++ Modules ç¼–è¯‘ï¼Œä¾‹å¦‚ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") set_languages(\"c++20\") set_policy(\"build.c++.modules\", true) end) ``` ### æ¨¡å—çš„åˆ†å‘å’Œé›†æˆ #### åˆ†å‘ C++ Modules åŒ… æˆ‘ä»¬å…ˆä½¿ç”¨ xmake.lua ç»´æŠ¤æ¨¡å—çš„æ„å»ºï¼Œå¹¶é€šè¿‡æŒ‡å®š `{install true}`ï¼Œæ¥å‘Šè¯‰ xmake å“ªäº›æ¨¡å—æ–‡ä»¶éœ€è¦å®‰è£…å¯¹å¤–åˆ†å‘ã€‚ ```lua add_rules(\"mode.release\", \"mode.debug\") set_languages(\"c++20\") target(\"foo\", function() set_kind(\"static\") add_files(\"*.cpp\") add_files(\"*.mpp\", { install true }) end) ``` ç„¶åï¼Œæˆ‘ä»¬æŠŠå®ƒåšæˆåŒ…ï¼Œå¯ä»¥æäº¤åˆ° [xmake repo](https://github.com/xmake io/xmake repo) ä»“åº“ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åšæˆæœ¬åœ°åŒ…ï¼Œæˆ–è€…ç§æœ‰ä»“åº“åŒ…ã€‚ è¿™é‡Œï¼Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•éªŒè¯ï¼Œæˆ‘ä»¬ä»…ä»…é€šè¿‡ `set_sourcedir` å°†å®ƒåšæˆæœ¬åœ°åŒ…ã€‚ ```lua package(\"foo\", function() set_sourcedir(path.join(os.scriptdir(), \"src\")) on_install(function(package) import(\"package.tools.xmake\").install(package, {}) end) end) ``` #### é›†æˆ C++ Modules åŒ… ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ `add_requires(\"foo\")` çš„åŒ…é›†æˆæ¥å£ï¼Œå¯¹ C++ Modules åŒ…è¿›è¡Œå¿«é€Ÿé›†æˆä½¿ç”¨ã€‚ ç”±äº foo çš„æ¨¡å—åŒ…ï¼Œæˆ‘ä»¬æ”¾åœ¨ç§æœ‰ä»“åº“ä¸­å®šä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ `add_repositories(\"my repo my repo\")` å¼•å…¥è‡ªå·±çš„åŒ…ä»“åº“ã€‚ å¦‚æœï¼ŒåŒ…å·²ç»æäº¤åˆ° xmake repo å®˜æ–¹ä»“åº“ï¼Œå°±ä¸éœ€è¦é¢å¤–é…ç½®å®ƒã€‚ ```lua add_rules(\"mode.release\", \"mode.debug\") set_languages(\"c++20\") add_repositories(\"my repo my repo\") add_requires(\"foo\", \"bar\") target(\"packages\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") add_packages(\"foo\", \"bar\") set_policy(\"build.c++.modules\", true) end) ``` é›†æˆå¥½åŒ…åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œ `xmake` å‘½ä»¤ï¼Œä¸€é”®ä¸‹è½½ã€ç¼–è¯‘ã€é›†æˆ C++ Modules åŒ…æ¥ä½¿ç”¨ã€‚ ```bash $ xmake checking for platform ... linux checking for architecture ... x86_64 note: install or modify (m) these packages (pass y to skip confirm)? in my repo: > foo latest > bar latest please input: y (y/n/m) > install bar latest .. ok > install foo latest .. ok [ 0%]: generating.module.deps src/main.cpp [ 0%]: generating.module.deps /mnt/xmake/tests/projects/c++/modules/packages/build/.packages/b/bar/latest/4e0143c97b65425b855ad5fd03038b6a/modules/bar/bar.mpp [ 0%]: generating.module.deps /mnt/xmake/tests/projects/c++/modules/packages/build/.packages/f/foo/latest/4e0143c97b65425b855ad5fd03038b6a/modules/foo/foo.mpp [ 14%]: compiling.module.release bar [ 14%]: compiling.module.release foo [ 57%]: compiling.release src/main.cpp [ 71%]: linking.release packages [100%]: build ok! ``` æ³¨ï¼šæ¯ä¸ªåŒ…å®‰è£…åï¼Œä¼šåœ¨åŒ…è·¯å¾„ä¸‹ï¼Œå­˜å‚¨ç»´æŠ¤æ¨¡å—çš„ meta info æ–‡ä»¶ï¼Œè¿™æ˜¯ `p2473r1.pdf` ä¸­çº¦å®šçš„ä¸€ç§æ ¼å¼è§„èŒƒï¼Œä¹Ÿè®¸å®ƒä¸æ˜¯æœ€ç»ˆçš„æ ‡å‡†ï¼Œä½†è¿™å¹¶ä¸å½±å“æˆ‘ä»¬ç°åœ¨å»ä½¿ç”¨æ¨¡å—çš„åˆ†å‘ã€‚ ```bash $ cat ./build/.packages/f/foo/latest/4e0143c97b65425b855ad5fd03038b6a/modules/foo/foo.mpp.meta info {\"_VENDOR_extension\":{\"xmake\":{\"name\":\"foo\",\"file\":\"foo.mpp\"}},\"definitions\":{},\"include_paths\":{}} ``` å®Œæ•´çš„ä¾‹å­å·¥ç¨‹è§ï¼š[C++ Modules åŒ…åˆ†å‘ä¾‹å­å·¥ç¨‹](https://github.com/xmake io/xmake/tree/master/tests/projects/c%2B%2B/modules/packages) ### æ”¯æŒ C++23 Std Modules [Arthapz](https://github.com/Arthapz) ä¹Ÿå¸®å¿™æ”¹è¿›äº†å¯¹ C++23 Std Modules çš„æ”¯æŒã€‚ ç›®å‰ä¸‰ä¸ªç¼–è¯‘å™¨å¯¹å®ƒçš„æ”¯æŒè¿›å±•ï¼š #### Clang ç›®å‰æœ€æ–°çš„ clang ä¼¼ä¹ä¹Ÿè¿˜æ²¡å®Œå…¨æ”¯æŒ C++23 std modulesï¼Œå½“å‰è¿˜æ˜¯ draft patch çŠ¶æ€ï¼Œ[#D135507](https://reviews.llvm.org/D135507)ã€‚ ä½†æ˜¯ï¼ŒXmake ä¹Ÿå¯¹å®ƒè¿›è¡Œäº†æ”¯æŒï¼Œå¦‚æœå¤§å®¶æƒ³è¦å°é²œï¼Œå¯ä»¥è‡ªè¡Œåˆå…¥è¿™ä¸ª patchï¼Œç„¶åä½¿ç”¨ xmake æ¥æµ‹è¯•ã€‚ å¦å¤–ï¼Œä½ç‰ˆæœ¬çš„ clang ä¹Ÿæœ‰å¯¹éæ ‡å‡†çš„ std modules åšäº†å®éªŒæ€§æ”¯æŒã€‚ æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥åœ¨ä½ç‰ˆæœ¬ clang ä¸­å°è¯•æ€§ä½¿ç”¨ xmake æ¥æ„å»º std modulesï¼Œå°½ç®¡å®ƒå¯èƒ½è¿˜åªæ˜¯ä¸ªç©å…·ï¼ˆä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼‰ã€‚ ç›¸å…³è®¨è®ºè§ï¼š[#3255](https://github.com/xmake io/xmake/pull/3255) #### Gcc ç›®å‰è¿˜ä¸æ”¯æŒã€‚ ## åˆå¹¶é™æ€åº“ ### è‡ªåŠ¨åˆå¹¶ target åº“ æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® `build.merge_archive` ç­–ç•¥ï¼Œå¯ç”¨è‡ªåŠ¨åˆå¹¶ä¾èµ–çš„æ‰€æœ‰é™æ€åº“ï¼Œä¾‹å¦‚ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"add\", function() set_kind(\"static\") add_files(\"src/add.c\") add_files(\"src/subdir/add.c\") end) target(\"sub\", function() set_kind(\"static\") add_files(\"src/sub.c\") add_files(\"src/subdir/sub.c\") end) target(\"mul\", function() set_kind(\"static\") add_deps(\"add\", \"sub\") add_files(\"src/mul.c\") set_policy(\"build.merge_archive\", true) end) ``` mul é™æ€åº“è‡ªåŠ¨åˆå¹¶äº† add å’Œ sub é™æ€åº“ï¼Œç”Ÿæˆä¸€ä¸ªåŒ…å« add/sub ä»£ç çš„å®Œæ•´ libmul.a åº“ã€‚ è¿™ä¸ªåˆå¹¶ç›¸å¯¹æ¯”è¾ƒç¨³å®šå®Œå–„ï¼Œæ”¯æŒ ar å’Œ msvc/lib.exeï¼Œä¹Ÿæ”¯æŒäº¤å‰ç¼–è¯‘å·¥å…·é“¾ç”Ÿæˆçš„é™æ€åº“åˆå¹¶ï¼Œä¹Ÿæ”¯æŒå¸¦æœ‰é‡å obj æ–‡ä»¶çš„é™æ€åº“ã€‚ ### åˆå¹¶æŒ‡å®šçš„é™æ€åº“æ–‡ä»¶ å¦‚æœè‡ªåŠ¨åˆå¹¶ä¸æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸»åŠ¨è°ƒç”¨ `utils.archive.merge_archive` æ¨¡å—åœ¨ `after_link` é˜¶æ®µåˆå¹¶æŒ‡å®šçš„é™æ€åº“åˆ—è¡¨ã€‚ ```lua target(\"test\", function() after_link(function (target) import(\"utils.archive.merge_staticlib\") merge_staticlib(target, \"libout.a\", {\"libfoo.a\", \"libbar.a\"}) end) end) ``` ### ä½¿ç”¨ add_files åˆå¹¶é™æ€åº“ å…¶å®ï¼Œæˆ‘ä»¬ä¹‹å‰çš„ç‰ˆæœ¬å·²ç»æ”¯æŒé€šè¿‡ `add_files(\"*.a\")` æ¥åˆå¹¶é™æ€åº“ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"*.a\") add_files(\"*.c\") end) ``` ä½†æ˜¯å®ƒæœ‰ä¸€äº›ç¼ºé™·ï¼šå¦‚æœä½¿ç”¨ arï¼Œå¯èƒ½ä¼šå­˜åœ¨ .obj å¯¹è±¡æ–‡ä»¶åŒåå†²çªå¯¼è‡´åˆå¹¶å¤±è´¥ï¼Œå› æ­¤æ¨èä½¿ç”¨ä¸Šæ–‡ä»‹ç»çš„åˆå¹¶æ–¹å¼ï¼Œæ›´åŠ çš„ç¨³å®šå¯é ï¼Œä¹Ÿæ›´åŠ çš„ç®€å•ã€‚ ç›¸å…³ issues: [#1638](https://github.com/xmake io/xmake/issues/1638) ### è‡ªå®šä¹‰è„šæœ¬åˆå¹¶é™æ€åº“ > åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬åœ¨ package å‡†å¤‡å®‰è£…æ—¶å°†æ‰€æœ‰çš„ lib é™æ€åº“åˆå¹¶æˆä¸€ä¸ªï¼Œæ–¹ä¾¿ç”¨æˆ·é›†æˆä½¿ç”¨ï¼š ```lua on_install(function(package) local archivefile \"libxcore.a\" local tmpfile os.tmpfile() local mrifile io.open(tmpfile, \"w\") mrifile:print(\"create %s\", archivefile) for _, libraryfile in ipairs(os.files(\"lib/*.a\")) do cprint(format(\"${bright blue}[info]${clear} merge static lib [%s] to [%s]\", libraryfile, archivefile)) mrifile:print(\"addlib %s\", libraryfile) end mrifile:print(\"save\") mrifile:print(\"end\") mrifile:close() os.vrunv(\"ar\", {\" M\"}, {stdin tmpfile}) os.rm(tmpfile) end) ``` ## Nim ç¨‹åº xmake æ”¯æŒ Nimlang é¡¹ç›®ï¼Œç›¸å…³ issues è§ï¼š[#1756](https://github.com/xmake io/xmake/issues/1756) ### åˆ›å»ºç©ºå·¥ç¨‹ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `xmake create` å‘½ä»¤åˆ›å»ºç©ºå·¥ç¨‹ã€‚ ```bash xmake create l nim t console test xmake create l nim t static test xmake create l nim t shared test ``` ### æ§åˆ¶å°ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/main.nim\") end) ``` ```bash $ xmake v [ 33%]: linking.release test /usr/local/bin/nim c opt:speed nimcache:build/.gens/test/macosx/x86_64/release/nimcache o:b uild/macosx/x86_64/release/test src/main.nim [100%]: build ok! ``` ### é™æ€åº“ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"foo\", function() set_kind(\"static\") add_files(\"src/foo.nim\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"foo\") add_files(\"src/main.nim\") end) ``` ```bash $ xmake v [ 33%]: linking.release libfoo.a /usr/local/bin/nim c opt:speed nimcache:build/.gens/foo/macosx/x86_64/release/nimcache app :staticlib noMain passC: DNimMain NimMain_B6D5BD02 passC: DNimMainInner NimMainInner_B6D5B D02 passC: DNimMainModule NimMainModule_B6D5BD02 passC: DPreMain PreMain_B6D5BD02 passC: D PreMainInner PreMainInner_B6D5BD02 o:build/macosx/x86_64/release/libfoo.a src/foo.nim [ 66%]: linking.release test /usr/local/bin/nim c opt:speed nimcache:build/.gens/test/macosx/x86_64/release/nimcache pa ssL: Lbuild/macosx/x86_64/release passL: lfoo o:build/macosx/x86_64/release/test src/main.nim [100%]: build ok! ``` ### åŠ¨æ€åº“ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"foo\", function() set_kind(\"shared\") add_files(\"src/foo.nim\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"foo\") add_files(\"src/main.nim\") end) ``` ```bash $ xmake rv [ 33%]: linking.release libfoo.dylib /usr/local/bin/nim c opt:speed nimcache:build/.gens/foo/macosx/x86_64/release/nimcache app :lib noMain o:build/macosx/x86_64/release/libfoo.dylib src/foo.nim [ 66%]: linking.release test /usr/local/bin/nim c opt:speed nimcache:build/.gens/test/macosx/x86_64/release/nimcache pa ssL: Lbuild/macosx/x86_64/release passL: lfoo o:build/macosx/x86_64/release/test src/main.nim [100%]: build ok! ``` ### C ä»£ç æ··åˆç¼–è¯‘ ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"foo\", function() set_kind(\"static\") add_files(\"src/*.c\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"foo\") add_files(\"src/main.nim\") end) ``` ### Nimble ä¾èµ–åŒ…é›†æˆ å®Œæ•´ä¾‹å­è§ï¼š[Nimble Package Example](https://github.com/xmake io/xmake/tree/dev/tests/projects/nim/nimble_package) ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"nimble::zip >0.3\") target(\"test, function() set_kind(\"binary\") add_files(\"src/main.nim\") add_packages(\"nimble::zip\") end) ``` main.nim ```nim import zip/zlib echo zlibVersion() ``` ### Native ä¾èµ–åŒ…é›†æˆ å®Œæ•´ä¾‹å­è§ï¼š[Native Package Example](https://github.com/xmake io/xmake/tree/dev/tests/projects/nim/native_package) ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"zlib\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/main.nim\") add_packages(\"zlib\") end) ``` main.nim ```nim proc zlibVersion(): cstring {.cdecl, importc} echo zlibVersion() ``` ## Keil/MDK åµŒå…¥å¼ç¨‹åº ç›¸å…³ä¾‹å­å·¥ç¨‹ï¼š[Example](https://github.com/xmake io/xmake/tree/dev/tests/projects/embed/mdk/hello) xmake ä¼šè‡ªåŠ¨æ¢æµ‹ Keil/MDK å®‰è£…çš„ç¼–è¯‘å™¨ï¼Œç›¸å…³ issues [#1753](https://github.com/xmake io/xmake/issues/1753)ã€‚ ä½¿ç”¨ armcc ç¼–è¯‘ ```bash $ xmake f p cross a cortex m3 toolchain armcc c $ xmake ``` ä½¿ç”¨ armclang ç¼–è¯‘ ```bash $ xmake f p cross a cortex m3 toolchain armclang c $ xmake ``` ### å¯æ‰§è¡Œç¨‹åº ```lua target(\"hello\", function() add_deps(\"foo\") add_rules(\"mdk.binary\") add_files(\"src/*.c\", \"src/*.s\") add_includedirs(\"src/lib/cmsis\") set_runtimes(\"microlib\") end) ``` éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›®å‰ä¸€äº› mdk ç¨‹åºéƒ½ä½¿ç”¨äº† microlib åº“è¿è¡Œæ—¶ï¼Œå®ƒéœ€è¦ç¼–è¯‘å™¨åŠ ä¸Š `__MICROLIB` å®å®šä¹‰ï¼Œé“¾æ¥å™¨åŠ ä¸Š ` library_type microlib` ç­‰å„ç§é…ç½®ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ `set_runtimes(\"microlib\")` ç›´æ¥è®¾ç½®åˆ° microlib è¿è¡Œæ—¶åº“ï¼Œå¯ä»¥è‡ªåŠ¨è®¾ç½®ä¸Šæ‰€æœ‰ç›¸å…³é€‰é¡¹ã€‚ ### é™æ€åº“ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"foo\", function() add_rules(\"mdk.static\") add_files(\"src/foo/*.c\") set_runtimes(\"microlib\") end) ``` ## Keil/C51 åµŒå…¥å¼ç¨‹åº ### å¯æ‰§è¡Œç¨‹åº ```lua target(\"hello\", function() add_rules(\"c51.binary\") set_toolchains(\"c51\") add_files(\"src/main.c\") end) ``` ## Lua æ¨¡å— å‚è€ƒ [https://github.com/xmake io/luarocks build xmake](https://github.com/xmake io/luarocks build xmake) å¦‚æœä½ çš„ lua æ¨¡å—å«æœ‰ C ä»£ç ï¼Œä½ å¯ä»¥ä½¿ç”¨ [LuaNativeObjects](https://github.com/Neopallium/LuaNativeObjects) å»ä» lua ä»£ç ç”Ÿæˆ C ä»£ç ã€‚ å‚è€ƒ[ä¾‹å­](https://github.com/Freed Wu/rime.nvim/blob/main/xmake.lua)ã€‚ ## Nodejs æ¨¡å— å‚è€ƒ[ä¾‹å­](https://github.com/tonyfettes/coc rime/blob/master/xmake.lua)ã€‚ ## Linux å†…æ ¸é©±åŠ¨æ¨¡å— xmake å®Œæ•´æ”¯æŒäº† Linux å†…æ ¸é©±åŠ¨æ¨¡å—çš„æ„å»ºï¼Œè¿™ä¹Ÿè®¸é¦–ä¸ªä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªæ”¯æŒç¼–è¯‘ Linux å†…æ ¸é©±åŠ¨çš„ç¬¬ä¸‰æ–¹æ„å»ºå·¥å…·äº†ã€‚ ### Hello world æ¨¡å— å®Œæ•´ä¾‹å­ï¼š[Linux Kernel Driver Modules](https://github.com/xmake io/xmake/tree/master/tests/projects/linux/driver/hello) å®ƒçš„é…ç½®éå¸¸ç®€å•ï¼Œåªéœ€è¦é…ç½®ä¸Šæ”¯æŒæ¨¡å—çš„ linux headers åŒ…ï¼Œç„¶ååº”ç”¨ `platform.linux.module` æ„å»ºè§„åˆ™å°±è¡Œäº†ã€‚ ```lua add_requires(\"linux headers\", {configs {driver_modules true}}) target(\"hello\", function() add_rules(\"platform.linux.module\") add_files(\"src/*.c\") add_packages(\"linux headers\") set_license(\"GPL 2.0\") end) ``` ç„¶åç›´æ¥æ‰§è¡Œ xmake å‘½ä»¤ï¼Œä¸€é”®ç¼–è¯‘ï¼Œç”Ÿæˆå†…æ ¸é©±åŠ¨æ¨¡å— hello.koã€‚ ```bash $ xmake [ 20%]: cache compiling.release src/add.c [ 20%]: cache compiling.release src/hello.c [ 60%]: linking.release build/linux/x86_64/release/hello.ko [100%]: build ok! ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å®Œæ•´æ„å»ºå‘½ä»¤å‚æ•°ã€‚ ```bash $ xmake v [ 20%]: cache compiling.release src/add.c /usr/bin/ccache /usr/bin/gcc c m64 O2 std gnu89 I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/generated I/usr/src/linux headers 5.11.0 41 generic/include I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/uapi I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/generated/uapi I/usr/src/linux headers 5.11.0 41 generic/include/uapi I/usr/src/linux headers 5.11.0 41 generic/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" DCONFIG_X86_X32_ABI isystem /usr/lib/gcc/x86_64 linux gnu/10/include include /usr/src/linux headers 5.11.0 41 generic/include/linux/kconfig.h include /usr/src/linux headers 5.11.0 41 generic/include/linux/compiler_types.h nostdinc mno sse mno mmx mno sse2 mno 3dnow mno avx mno 80387 mno fp ret in 387 mpreferred stack boundary 3 mskip rax setup mtune generic mno red zone mcmodel kernel mindirect branch thunk extern mindirect branch register mrecord mcount fmacro prefix map ./ fno strict aliasing fno common fshort wchar fno PIE fcf protection none falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno allow store data races fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack DKBUILD_BASENAME \\\"add\\\" o build/.objs/hello/linux/x86_64/release/src/add.c.o src/add.c [ 20%]: cache compiling.release src/hello.c /usr/bin/ccache /usr/bin/gcc c m64 O2 std gnu89 I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/generated I/usr/src/linux headers 5.11.0 41 generic/include I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/uapi I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/generated/uapi I/usr/src/linux headers 5.11.0 41 generic/include/uapi I/usr/src/linux headers 5.11.0 41 generic/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" DCONFIG_X86_X32_ABI isystem /usr/lib/gcc/x86_64 linux gnu/10/include include /usr/src/linux headers 5.11.0 41 generic/include/linux/kconfig.h include /usr/src/linux headers 5.11.0 41 generic/include/linux/compiler_types.h nostdinc mno sse mno mmx mno sse2 mno 3dnow mno avx mno 80387 mno fp ret in 387 mpreferred stack boundary 3 mskip rax setup mtune generic mno red zone mcmodel kernel mindirect branch thunk extern mindirect branch register mrecord mcount fmacro prefix map ./ fno strict aliasing fno common fshort wchar fno PIE fcf protection none falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno allow store data races fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack DKBUILD_BASENAME \\\"hello\\\" o build/.objs/hello/linux/x86_64/release/src/hello.c.o src/hello.c [ 60%]: linking.release build/linux/x86_64/release/hello.ko /usr/bin/ld m elf_x86_64 r o build/.objs/hello/linux/x86_64/release/build/linux/x86_64/release/hello.ko.o build/.objs/hello/linux/x86_64/release/src/add.c.o build/.objs/hello/linux/x86_64/release/src/hello.c.o /usr/src/linux headers 5.11.0 41 generic/scripts/mod/modpost m a o build/.objs/hello/linux/x86_64/release/build/linux/x86_64/release/Module.symvers e N T WARNING: modpost: Symbol info of vmlinux is missing. Unresolved symbol check will be entirely skipped. /usr/bin/ccache /usr/bin/gcc c m64 O2 std gnu89 I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/generated I/usr/src/linux headers 5.11.0 41 generic/include I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/uapi I/usr/src/linux headers 5.11.0 41 generic/arch/x86/include/generated/uapi I/usr/src/linux headers 5.11.0 41 generic/include/uapi I/usr/src/linux headers 5.11.0 41 generic/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" DCONFIG_X86_X32_ABI isystem /usr/lib/gcc/x86_64 linux gnu/10/include include /usr/src/linux headers 5.11.0 41 generic/include/linux/kconfig.h include /usr/src/linux headers 5.11.0 41 generic/include/linux/compiler_types.h nostdinc mno sse mno mmx mno sse2 mno 3dnow mno avx mno 80387 mno fp ret in 387 mpreferred stack boundary 3 mskip rax setup mtune generic mno red zone mcmodel kernel mindirect branch thunk extern mindirect branch register mrecord mcount fmacro prefix map ./ fno strict aliasing fno common fshort wchar fno PIE fcf protection none falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno allow store data races fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack o build/.objs/hello/linux/x86_64/release/build/linux/x86_64/release/hello.ko.mod.o build/.objs/hello/linux/x86_64/release/build/linux/x86_64/release/hello.ko.mod.c /usr/bin/ld m elf_x86_64 r build id sha1 T /usr/src/linux headers 5.11.0 41 generic/scripts/module.lds o build/linux/x86_64/release/hello.ko build/.objs/hello/linux/x86_64/release/build/linux/x86_64/release/hello.ko.o build/.objs/hello/linux/x86_64/release/build/linux/x86_64/release/hello.ko.mod.o ``` é€šè¿‡ `add_requires(\"linux headers\", {configs {driver_modules true}})` é…ç½®åŒ…ï¼Œxmake ä¼šè‡ªåŠ¨ä¼˜å…ˆä»ç³»ç»Ÿä¸­æŸ¥æ‰¾å¯¹åº”çš„ linux headers åŒ…ã€‚ å¦‚æœæ²¡æ‰¾åˆ°ï¼Œxmake ä¹Ÿä¼šè‡ªåŠ¨ä¸‹è½½å®ƒï¼Œç„¶åè‡ªåŠ¨é…ç½®æ„å»ºå¸¦æœ‰ driver modules çš„å†…æ ¸æºç åï¼Œä½¿ç”¨å®ƒç»§ç»­æ„å»ºå†…æ ¸æ¨¡å—ã€‚ ### è‡ªå®šä¹‰ linux headers è·¯å¾„ æœ‰å¾ˆå¤šç”¨æˆ·åé¦ˆï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œlinux å†…æ ¸é©±åŠ¨æ„å»ºéƒ½æ˜¯åŸºäºå®šåˆ¶ç‰ˆçš„ linux kernelï¼Œå› æ­¤éœ€è¦èƒ½å¤Ÿè‡ªå®šä¹‰é…ç½® linux headers è·¯å¾„ï¼Œè€Œä¸æ˜¯èµ°è¿œç¨‹ä¾èµ–åŒ…æ¨¡å¼ã€‚ å…¶å®ï¼Œæˆ‘ä»¬é€šè¿‡è‡ªå·±é‡å†™ linux headers åŒ…ï¼Œä¹Ÿæ˜¯å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹çš„ã€‚ ```lua package(\"linux headers\") on_fetch(function (package, opt) return {includedirs \"/usr/src/linux headers 5.0/include\"} end) package_end() add_requires(\"linux headers\") target(\"test\", function() add_rules(\"platform.linux.module\") add_files(\"src/*.c\") add_packages(\"linux headers\") end) ``` ä¸è¿‡è¿™æ ·ï¼Œä¹Ÿè®¸è¿˜æœ‰ç‚¹ç¹çï¼Œå› æ­¤æˆ‘ä»¬æ”¯æŒæ›´åŠ æ–¹ä¾¿çš„è®¾ç½® linux headers è·¯å¾„ã€‚ ```lua target(\"hello\", function() add_rules(\"platform.linux.module\") add_files(\"src/*.c\") set_values(\"linux.driver.linux headers\", \"/usr/src/linux headers 5.11.0 41 generic\") end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å®šä¹‰ option é€‰é¡¹ï¼Œå°† linux headers è·¯å¾„ä½œä¸º `xmake f linux headers /usr/src/linux headers` çš„æ–¹å¼ä¼ å…¥ã€‚ ```lua option(\"linux headers\", {showmenu true, description \"Set linux headers path.\"}) target(\"hello\", function() add_rules(\"platform.linux.module\") add_files(\"src/*.c\") set_values(\"linux.driver.linux headers\", \"$(linux headers)\") end) ``` æ›´å¤šè¯¦æƒ…è§ï¼š[#1923](https://github.com/xmake io/xmake/issues/1923) ### äº¤å‰ç¼–è¯‘ æˆ‘ä»¬ä¹Ÿæ”¯æŒå†…æ ¸é©±åŠ¨æ¨¡å—çš„äº¤å‰ç¼–è¯‘ï¼Œæ¯”å¦‚åœ¨ Linux x86_64 ä¸Šä½¿ç”¨äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ¥æ„å»º Linux Arm/Arm64 çš„é©±åŠ¨æ¨¡å—ã€‚ æˆ‘ä»¬åªéœ€è¦å‡†å¤‡å¥½è‡ªå·±çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œé€šè¿‡ ` sdk ` æŒ‡å®šå®ƒçš„æ ¹ç›®å½•ï¼Œç„¶åé…ç½®åˆ‡æ¢åˆ° ` p cross` å¹³å°ï¼Œ æœ€åæŒ‡å®šéœ€è¦æ„å»ºçš„æ¶æ„ arm/arm64 å³å¯ã€‚ è¿™é‡Œç”¨åˆ°çš„äº¤å‰å·¥å…·é“¾ï¼Œå¯ä»¥ä»è¿™é‡Œä¸‹è½½: [Download toolchains](https://releases.linaro.org/components/toolchain/binaries/latest 7/aarch64 linux gnu/) æ›´å¤šï¼Œäº¤å‰ç¼–è¯‘é…ç½®æ–‡æ¡£ï¼Œè§ï¼š[é…ç½®äº¤å‰ç¼–è¯‘](/zh cn/guide/configuration?id common cross compilation configuration) > ç›®å‰ä»…ä»…æ”¯æŒ arm/arm64 äº¤å‰ç¼–è¯‘æ¶æ„ï¼Œåç»­ä¼šæ”¯æŒæ›´å¤šçš„å¹³å°æ¶æ„ã€‚ #### æ„å»º Arm é©±åŠ¨æ¨¡å— ```bash $ xmake f p cross a arm sdk /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf c $ xmake v checking for arm linux gnueabihf g++ ... /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf g++ checking for the linker (ld) ... arm linux gnueabihf g++ checking for /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf g++ ... ok checking for flags ( fPIC) ... ok checking for /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf gcc ... ok checking for flags ( fPIC) ... ok checking for flags ( O2) ... ok checking for ccache ... /usr/bin/ccache [ 20%]: cache compiling.release src/add.c /usr/bin/ccache /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf gcc c O2 std gnu89 I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/generated I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/generated/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" D__LINUX_ARM_ARCH__ 6 isystem /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/../lib/gcc/arm linux gnueabihf/7.5.0/include include /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/linux/kconfig.h include /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/linux/compiler_types.h nostdinc fno strict aliasing fno common fshort wchar fno PIE falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack mbig endian mabi aapcs linux mfpu vfp marm march armv6k mtune arm1136j s msoft float Uarm DKBUILD_BASENAME \\\"add\\\" o build/.objs/hello/cross/arm/release/src/add.c.o src/add.c [ 20%]: cache compiling.release src/hello.c /usr/bin/ccache /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf gcc c O2 std gnu89 I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/generated I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/generated/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" D__LINUX_ARM_ARCH__ 6 isystem /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/../lib/gcc/arm linux gnueabihf/7.5.0/include include /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/linux/kconfig.h include /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/linux/compiler_types.h nostdinc fno strict aliasing fno common fshort wchar fno PIE falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack mbig endian mabi aapcs linux mfpu vfp marm march armv6k mtune arm1136j s msoft float Uarm DKBUILD_BASENAME \\\"hello\\\" o build/.objs/hello/cross/arm/release/src/hello.c.o src/hello.c checking for flags ( MMD MF) ... ok checking for flags ( fdiagnostics color always) ... ok [ 60%]: linking.release build/cross/arm/release/hello.ko /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf ld EB r o build/.objs/hello/cross/arm/release/build/cross/arm/release/hello.ko.o build/.objs/hello/cross/arm/release/src/add.c.o build/.objs/hello/cross/arm/release/src/hello.c.o /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/scripts/mod/modpost m a o build/.objs/hello/cross/arm/release/build/cross/arm/release/Module.symvers e N T WARNING: modpost: Symbol info of vmlinux is missing. Unresolved symbol check will be entirely skipped. /usr/bin/ccache /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf gcc c O2 std gnu89 I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/generated I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/arch/arm/include/generated/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" D__LINUX_ARM_ARCH__ 6 isystem /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/../lib/gcc/arm linux gnueabihf/7.5.0/include include /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/linux/kconfig.h include /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/include/linux/compiler_types.h nostdinc fno strict aliasing fno common fshort wchar fno PIE falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack mbig endian mabi aapcs linux mfpu vfp marm march armv6k mtune arm1136j s msoft float Uarm o build/.objs/hello/cross/arm/release/build/cross/arm/release/hello.ko.mod.o build/.objs/hello/cross/arm/release/build/cross/arm/release/hello.ko.mod.c /mnt/gcc linaro 7.5.0 2019.12 x86_64_arm linux gnueabihf/bin/arm linux gnueabihf ld EB be8 r build id sha1 T /home/ruki/.xmake/packages/l/linux headers/5.10.46/7695a30b7add4d3aa4685cbac6815805/scripts/module.lds o build/cross/arm/release/hello.ko build/.objs/hello/cross/arm/release/build/cross/arm/release/hello.ko.o build/.objs/hello/cross/arm/release/build/cross/arm/release/hello.ko.mod.o [100%]: build ok! ``` #### æ„å»º Arm64 é©±åŠ¨æ¨¡å— ```bash $ xmake f p cross a arm64 sdk /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu c checking for aarch64 linux gnu g++ ... /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu g++ checking for the linker (ld) ... aarch64 linux gnu g++ checking for /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu g++ ... ok checking for flags ( fPIC) ... ok checking for /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu gcc ... ok checking for flags ( fPIC) ... ok checking for flags ( O2) ... ok checking for ccache ... /usr/bin/ccache [ 20%]: cache compiling.release src/add.c /usr/bin/ccache /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu gcc c O2 std gnu89 I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/generated I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/generated/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" isystem /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/../lib/gcc/aarch64 linux gnu/7.5.0/include include /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/linux/kconfig.h include /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/linux/compiler_types.h nostdinc fno strict aliasing fno common fshort wchar fno PIE falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack DKBUILD_BASENAME \\\"add\\\" o build/.objs/hello/cross/arm64/release/src/add.c.o src/add.c [ 20%]: cache compiling.release src/hello.c /usr/bin/ccache /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu gcc c O2 std gnu89 I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/generated I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/generated/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" isystem /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/../lib/gcc/aarch64 linux gnu/7.5.0/include include /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/linux/kconfig.h include /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/linux/compiler_types.h nostdinc fno strict aliasing fno common fshort wchar fno PIE falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack DKBUILD_BASENAME \\\"hello\\\" o build/.objs/hello/cross/arm64/release/src/hello.c.o src/hello.c checking for flags ( MMD MF) ... ok checking for flags ( fdiagnostics color always) ... ok [ 60%]: linking.release build/cross/arm64/release/hello.ko /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu ld EL maarch64elf r o build/.objs/hello/cross/arm64/release/build/cross/arm64/release/hello.ko.o build/.objs/hello/cross/arm64/release/src/add.c.o build/.objs/hello/cross/arm64/release/src/hello.c.o /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/scripts/mod/modpost m a o build/.objs/hello/cross/arm64/release/build/cross/arm64/release/Module.symvers e N T WARNING: modpost: Symbol info of vmlinux is missing. Unresolved symbol check will be entirely skipped. /usr/bin/ccache /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu gcc c O2 std gnu89 I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/generated I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/arch/arm64/include/generated/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/uapi I/home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/generated/uapi D__KERNEL__ DMODULE DKBUILD_MODNAME \\\"hello\\\" isystem /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/../lib/gcc/aarch64 linux gnu/7.5.0/include include /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/linux/kconfig.h include /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/include/linux/compiler_types.h nostdinc fno strict aliasing fno common fshort wchar fno PIE falign jumps 1 falign loops 1 fno asynchronous unwind tables fno jump tables fno delete null pointer checks fno reorder blocks fno ipa cp clone fno partial inlining fstack protector strong fno inline functions called once falign functions 32 fno strict overflow fno stack check fconserve stack o build/.objs/hello/cross/arm64/release/build/cross/arm64/release/hello.ko.mod.o build/.objs/hello/cross/arm64/release/build/cross/arm64/release/hello.ko.mod.c /mnt/gcc linaro 7.5.0 2019.12 x86_64_aarch64 linux gnu/bin/aarch64 linux gnu ld EL maarch64elf r build id sha1 T /home/ruki/.xmake/packages/l/linux headers/5.10.46/8f80101835834bc2866f3a827836b5de/scripts/module.lds o build/cross/arm64/release/hello.ko build/.objs/hello/cross/arm64/release/build/cross/arm64/release/hello.ko.o build/.objs/hello/cross/arm64/release/build/cross/arm64/release/hello.ko.mod.o [100%]: build ok! ``` ## ASN.1 ç¨‹åº ASN.1 ç¨‹åºï¼Œéœ€è¦å€ŸåŠ© [ASN.1 Compiler](https://github.com/vlm/asn1c) å»ç”Ÿæˆç›¸å…³çš„ .c æ–‡ä»¶å‚ä¸é¡¹ç›®ç¼–è¯‘ã€‚ è€Œ Xmake å†…ç½®æä¾›äº† `add_rules(\"asn1c\")` è§„åˆ™å»å¤„ç† `.c` æ–‡ä»¶ç”Ÿæˆï¼Œ`add_requires(\"asn1c\")` è‡ªåŠ¨æ‹‰å–é›†æˆ ASN.1 ç¼–è¯‘å™¨å·¥å…·ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºç¡€çš„é…ç½®ä¾‹å­ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"asn1c\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_files(\"src/*.asn1\") add_rules(\"asn1c\") add_packages(\"asn1c\") end) ``` å…·ä½“è§ [å®Œæ•´ä¾‹å­å·¥ç¨‹](https://github.com/xmake io/xmake/tree/master/tests/projects/c/asn1c)ã€‚ ## Verilog ä»¿çœŸç¨‹åº ### iVerilog ä»¿çœŸå™¨ é€šè¿‡ `add_requires(\"iverilog\")` é…ç½®ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè‡ªåŠ¨æ‹‰å– iverilog å·¥å…·é“¾åŒ…ï¼Œç„¶åä½¿ç”¨ `set_toolchains(\"@iverilog\")` è‡ªåŠ¨ç»‘å®šå·¥å…·é“¾æ¥ç¼–è¯‘å·¥ç¨‹ã€‚ ```lua add_requires(\"iverilog\") target(\"hello\", function() add_rules(\"iverilog.binary\") set_toolchains(\"@iverilog\") add_files(\"src/*.v\") end) ``` #### è®¾ç½®æŠ½è±¡é…ç½® ```lua add_requires(\"iverilog\") target(\"hello\", function() add_rules(\"iverilog.binary\") set_toolchains(\"@iverilog\") add_files(\"src/*.v\") add_defines(\"TEST\") add_includedirs(\"inc\") set_languages(\"v1800 2009\") end) ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ `set_languages(\"v1800 2009\")` æ¥è®¾ç½®åˆ‡æ¢ Verilog çš„è¯­è¨€æ ‡å‡†ã€‚ ç›®å‰æ”¯æŒçš„ä¸€äº›å–å€¼å’Œæ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š ```lua [\"v1364 1995\"] \" g1995\" [\"v1364 2001\"] \" g2001\" [\"v1364 2005\"] \" g2005\" [\"v1800 2005\"] \" g2005 sv\" [\"v1800 2009\"] \" g2009\" [\"v1800 2012\"] \" g2012\" ``` #### è®¾ç½®è‡ªå®šä¹‰ flags ```lua add_requires(\"iverilog\") target(\"hello\", function() add_rules(\"iverilog.binary\") set_toolchains(\"@iverilog\") add_files(\"src/*.v\") add_values(\"iverilogs.flags\", \" DTEST\") end) ``` #### æ„å»ºå·¥ç¨‹ ```bash $ xmake checking for iverilog ... iverilog checking for vvp ... vvp [ 50%]: linking.iverilog hello.vvp [100%]: build ok! ``` #### è¿è¡Œç¨‹åº ```bash $ xmake run hello world! LXT2 info: dumpfile hello.vcd opened for output. src/main.v:6: $finish called at 0 (1s) ``` æ›´å¤šå®Œæ•´ä¾‹å­ï¼š[iVerilog Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/embed/iverilog) ### Verilator ä»¿çœŸå™¨ é€šè¿‡ `add_requires(\"verilator\")` é…ç½®ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè‡ªåŠ¨æ‹‰å– verilator å·¥å…·é“¾åŒ…ï¼Œç„¶åä½¿ç”¨ `set_toolchains(\"@verilator\")` è‡ªåŠ¨ç»‘å®šåˆ°å·¥å…·é“¾æ¥ç¼–è¯‘å·¥ç¨‹ã€‚ ```lua add_requires(\"verilator\") target(\"hello\", function() add_rules(\"verilator.binary\") set_toolchains(\"@verilator\") add_files(\"src/*.v\") add_files(\"src/*.cpp\") end) ``` verilator å·¥ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé¢å¤–çš„ `sim_main.cpp` æ–‡ä»¶å‚ä¸ç¼–è¯‘ï¼Œä½œä¸ºç¨‹åºçš„å…¥å£ä»£ç ã€‚ ``` #include \"hello.h\" #include \"verilated.h\" int main(int argc, char** argv) { VerilatedContext* contextp new VerilatedContext; contextp >commandArgs(argc, argv); hello* top new hello{contextp}; while (!contextp >gotFinish()) { top >eval(); } delete top; delete contextp; return 0; } ``` #### è®¾ç½®æŠ½è±¡é…ç½® ```lua add_requires(\"verilator\") target(\"hello\", function() add_rules(\"verilator.binary\") set_toolchains(\"@verilator\") add_files(\"src/*.v\") add_defines(\"TEST\") add_includedirs(\"inc\") set_languages(\"v1800 2009\") end) ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ `set_languages(\"v1800 2009\")` æ¥è®¾ç½®åˆ‡æ¢ Verilog çš„è¯­è¨€æ ‡å‡†ã€‚ ç›®å‰æ”¯æŒçš„ä¸€äº›å–å€¼å’Œæ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š ```lua Verilog [\"v1364 1995\"] \"+1364 1995ext+v\", [\"v1364 2001\"] \"+1364 2001ext+v\", [\"v1364 2005\"] \"+1364 2005ext+v\", SystemVerilog [\"v1800 2005\"] \"+1800 2005ext+v\", [\"v1800 2009\"] \"+1800 2009ext+v\", [\"v1800 2012\"] \"+1800 2012ext+v\", [\"v1800 2017\"] \"+1800 2017ext+v\", ``` #### è®¾ç½®è‡ªå®šä¹‰ flags ```lua add_requires(\"verilator\") target(\"hello\", function() add_rules(\"verilator.binary\") set_toolchains(\"@verilator\") add_files(\"src/*.v\") add_files(\"src/*.cpp\") add_values(\"verilator.flags\", \" trace\", \" timing\") end) ``` #### æ„å»ºå·¥ç¨‹ ```bash $ xmake [ 0%]: compiling.verilog src/main.v [ 15%]: cache compiling.release /Users/ruki/.xmake/packages/v/verilator/2023.1.10/cd2268409c1d44799288c7759b3cbd56/share/verilator/include/verilated.cpp [ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello___024root__Slow.cpp [ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello___024root__DepSet_h9053a130__0__Slow.cpp [ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello.cpp [ 15%]: cache compiling.release /Users/ruki/.xmake/packages/v/verilator/2023.1.10/cd2268409c1d44799288c7759b3cbd56/share/verilator/include/verilated_threads.cpp [ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello__Syms.cpp [ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello___024root__DepSet_h07139e86__0.cpp [ 15%]: cache compiling.release src/sim_main.cpp [ 15%]: cache compiling.release build/.gens/hello/macosx/x86_64/release/rules/verilator/hello___024root__DepSet_h9053a130__0.cpp [ 84%]: linking.release hello [100%]: build ok! ``` #### è¿è¡Œç¨‹åº ```bash $ xmake run ruki 2:hello ruki$ xmake run hello world! src/main.v:4: Verilog $finish ``` æ›´å¤šå®Œæ•´ä¾‹å­ï¼š[Verilator](https://github.com/xmake io/xmake/tree/master/tests/projects/embed/verilator) #### ç¼–è¯‘é™æ€åº“ æˆ‘ä»¬ä¹Ÿæä¾›äº† `verilator.static` è§„åˆ™æ¥ç¼–è¯‘ç”Ÿæˆ verilator é™æ€åº“ã€‚ ```lua add_requires(\"verilator\") target(\"hello\", function() add_rules(\"verilator.static\") set_toolchains(\"@verilator\") add_files(\"src/*.v\") end) target(\"test\", function() add_deps(\"hello\") add_files(\"src/*.cpp\") end) ``` ## Cppfront ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"cppfront\") target(\"test\", function() add_rules(\"cppfront\") set_kind(\"binary\") add_files(\"src/*.cpp2\") add_packages(\"cppfront\") end) ``` ## Cosmocc ç¨‹åº ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"cosmocc\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") set_toolchains(\"@cosmocc\") end) ```"},"/get_started/zh/tutorial/builtin-variables.html":{"title":"","content":" class: heading_no_counter # å†…ç½®å˜é‡ xmake æä¾›äº† `$(varname)` çš„è¯­æ³•ï¼Œæ¥æ”¯æŒå†…ç½®å˜é‡çš„è·å–ï¼Œä¾‹å¦‚ï¼š ```lua add_cxflags(\" I$(buildir)\") ``` å®ƒå°†ä¼šåœ¨åœ¨å®é™…ç¼–è¯‘çš„æ—¶å€™ï¼Œå°†å†…ç½®çš„ `buildir` å˜é‡è½¬æ¢ä¸ºå®é™…çš„æ„å»ºè¾“å‡ºç›®å½•ï¼š` I./build` ä¸€èˆ¬å†…ç½®å˜é‡å¯ç”¨äºåœ¨ä¼ å‚æ—¶å¿«é€Ÿè·å–å’Œæ‹¼æ¥å˜é‡å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() æ·»åŠ å·¥ç¨‹æºç ç›®å½•ä¸‹çš„æºæ–‡ä»¶ add_files(\"$(projectdir)/src/*.c\") æ·»åŠ æ„å»ºç›®å½•ä¸‹çš„å¤´æ–‡ä»¶æœç´¢è·¯å¾„ add_includedirs(\"$(buildir)/inc\") end) ``` ä¹Ÿå¯ä»¥åœ¨è‡ªå®šä¹‰è„šæœ¬çš„æ¨¡å—æ¥å£ä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() on_run(function (target) å¤åˆ¶å½“å‰è„šæœ¬ç›®å½•ä¸‹çš„å¤´æ–‡ä»¶åˆ°è¾“å‡ºç›®å½• os.cp(\"$(scriptdir)/xxx.h\", \"$(buildir)/inc\") end) end) ``` æ‰€æœ‰çš„å†…ç½®å˜é‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ [val](#val) æ¥å£ï¼Œæ¥è·å–ä»–ä»¬çš„å€¼ã€‚ è¿™ç§ä½¿ç”¨å†…ç½®å˜é‡çš„æ–¹å¼ï¼Œä½¿å¾—æè¿°ç¼–å†™æ›´åŠ çš„ç®€æ´æ˜“è¯»ï¼Œä¸‹é¢æ˜¯ä¸€äº› xmake å†…ç½®çš„å˜é‡ï¼Œå¯ä»¥ç›´æ¥è·å–ï¼š æ¥å£ æè¿° [$(os)](#varos) è·å–å½“å‰ç¼–è¯‘å¹³å°çš„æ“ä½œç³»ç»Ÿ [$(host)](#varhost) è·å–æœ¬æœºæ“ä½œç³»ç»Ÿ [$(tmpdir)](#vartmpdir) è·å–ä¸´æ—¶ç›®å½• [$(curdir)](#varcurdir) è·å–å½“å‰ç›®å½• [$(buildir)](#varbuildir) è·å–æ„å»ºè¾“å‡ºç›®å½• [$(scriptdir)](#varscriptdir) è·å–å·¥ç¨‹æè¿°è„šæœ¬ç›®å½• [$(globaldir)](#varglobaldir) è·å–å…¨å±€é…ç½®ç›®å½• [$(configdir)](#varconfigdir) è·å–æœ¬åœ°å·¥ç¨‹é…ç½®ç›®å½• [$(programdir)](#varprogramdir) xmake å®‰è£…è„šæœ¬ç›®å½• [$(projectdir)](#varprojectdir) è·å–å·¥ç¨‹æ ¹ç›®å½• [$(shell)](#varshell) æ‰§è¡Œå¤–éƒ¨ shell å‘½ä»¤ [$(env)](#varenv) è·å–å¤–éƒ¨ç¯å¢ƒå˜é‡ [$(reg)](#varreg) è·å– windows æ³¨å†Œè¡¨é…ç½®é¡¹çš„å€¼ å½“ç„¶è¿™ç§å˜é‡æ¨¡å¼ï¼Œä¹Ÿæ˜¯å¯ä»¥æ‰©å±•çš„ï¼Œé»˜è®¤é€šè¿‡ `xmake f var val` å‘½ä»¤ï¼Œé…ç½®çš„å‚æ•°éƒ½æ˜¯å¯ä»¥ç›´æ¥è·å–ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() add_defines(\" DTEST $(var)\") end) ``` > æ‰€æœ‰ `xmake f xxx ...` é…ç½®çš„å‚æ•°å€¼ï¼Œéƒ½æ˜¯å¯ä»¥é€šè¿‡å†…ç½®å˜é‡è·å–åˆ°ï¼Œä¾‹å¦‚ï¼š`xmake f arch x86` å¯¹åº” `$(arch)`ï¼Œå…¶ä»–çš„è¿˜æœ‰ `$(plat)`, `$(mode)` ç­‰ç­‰ã€‚ > å…·ä½“æœ‰å“ªäº›å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ï¼š`xmake f h` æŸ¥çœ‹ã€‚ æ—¢ç„¶æ”¯æŒç›´æ¥ä»é…ç½®é€‰é¡¹ä¸­è·å–ï¼Œé‚£ä¹ˆå½“ç„¶ä¹Ÿå°±èƒ½å¾ˆæ–¹ä¾¿çš„æ‰©å±•è‡ªå®šä¹‰çš„é€‰é¡¹ï¼Œæ¥è·å–è‡ªå®šä¹‰çš„å˜é‡äº†ï¼Œå…·ä½“å¦‚ä½•è‡ªå®šä¹‰é€‰é¡¹è§ï¼š[option](#option) ## var.$(os) è·å–å½“å‰ç¼–è¯‘å¹³å°çš„æ“ä½œç³»ç»Ÿã€‚ å¦‚æœå½“å‰ç¼–è¯‘çš„æ˜¯ iphoneosï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°±æ˜¯ï¼š`ios`ï¼Œä»¥æ­¤ç±»æ¨ã€‚ ## var.$(host) è·å–æœ¬æœºæ“ä½œç³»ç»Ÿã€‚ æŒ‡çš„æ˜¯å½“å‰æœ¬æœºç¯å¢ƒçš„ä¸»æœºç³»ç»Ÿï¼Œå¦‚æœä½ æ˜¯åœ¨ macOS ä¸Šç¼–è¯‘ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±æ˜¯ï¼š`macosx` ## var.$(tmpdir) è·å–ä¸´æ—¶ç›®å½•ã€‚ ä¸€èˆ¬ç”¨äºä¸´æ—¶å­˜æ”¾ä¸€äº›éæ°¸ä¹…æ€§æ–‡ä»¶ã€‚ ## var.$(curdir) è·å–å½“å‰ç›®å½•ã€‚ ä¸€èˆ¬é»˜è®¤æ˜¯æ‰§è¡Œ `xmake` å‘½ä»¤æ—¶çš„å·¥ç¨‹æ ¹ç›®å½•ï¼Œå½“ç„¶å¦‚æœé€šè¿‡ [os.cd](#os cd) æ”¹å˜äº†ç›®å½•çš„è¯ï¼Œè¿™ä¸ªå€¼ä¹Ÿä¼šä¸€èµ·æ”¹å˜ã€‚ ## var.$(buildir) è·å–å½“å‰çš„æ„å»ºè¾“å‡ºç›®å½•ã€‚ é»˜è®¤ä¸€èˆ¬ä¸ºå½“å‰å·¥ç¨‹æ ¹ç›®å½•ä¸‹çš„ï¼š`./build` ç›®å½•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ‰§è¡Œï¼š`xmake f o /tmp/build` å‘½ä»¤æ¥ä¿®æ”¹é»˜è®¤çš„è¾“å‡ºç›®å½•ã€‚ ## var.$(scriptdir) è·å–å½“å‰å·¥ç¨‹æè¿°è„šæœ¬çš„ç›®å½•ã€‚ ä¹Ÿå°±æ˜¯å¯¹åº” `xmake.lua` æ‰€åœ¨çš„ç›®å½•è·¯å¾„ã€‚ ## var.$(globaldir) å…¨å±€é…ç½®ç›®å½•ã€‚ xmake çš„ `xmake gglobal` å…¨å±€é…ç½®å‘½ä»¤ï¼Œæ•°æ®å­˜å‚¨çš„ç›®å½•è·¯å¾„ï¼Œåœ¨é‡Œé¢å¯ä»¥æ”¾ç½®ä¸€äº›è‡ªå·±çš„æ’ä»¶ã€å¹³å°è„šæœ¬ã€‚ é»˜è®¤ä¸ºï¼š`~/.config` ## var.$(configdir) å½“å‰å·¥ç¨‹é…ç½®ç›®å½•ã€‚ å½“å‰å·¥ç¨‹çš„é…ç½®å­˜å‚¨ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ `xmake fconfig` é…ç½®å‘½ä»¤çš„å­˜å‚¨ç›®å½•ï¼Œé»˜è®¤ä¸ºï¼š`projectdir/.config` ## var.$(programdir) xmake å®‰è£…è„šæœ¬ç›®å½•ã€‚ ä¹Ÿå°±æ˜¯ `XMAKE_PROGRAM_DIR` ç¯å¢ƒå˜é‡æ‰€åœ¨ç›®å½•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®è¿™ä¸ªç¯å¢ƒé‡ï¼Œæ¥ä¿®æ”¹ xmake çš„åŠ è½½è„šæœ¬ï¼Œå®ç°ç‰ˆæœ¬åˆ‡æ¢ã€‚ ### var.$(projectdir) å·¥ç¨‹æ ¹ç›®å½•ã€‚ ä¹Ÿå°±æ˜¯ `xmake P xxx` å‘½ä»¤ä¸­æŒ‡å®šçš„ç›®å½•è·¯å¾„ï¼Œé»˜è®¤ä¸æŒ‡å®šå°±æ˜¯ `xmake` å‘½ä»¤æ‰§è¡Œæ—¶çš„å½“å‰ç›®å½•ï¼Œä¸€èˆ¬ç”¨äºå®šä½å·¥ç¨‹æ–‡ä»¶ã€‚ ## var.$(shell) æ‰§è¡Œå¤–éƒ¨ shell å‘½ä»¤ã€‚ é™¤äº†å†…ç½®çš„å˜é‡å¤„ç†ï¼Œxmake è¿˜æ”¯æŒåŸç”Ÿ shell çš„è¿è¡Œï¼Œæ¥å¤„ç†ä¸€äº› xmake å†…ç½®ä¸æ”¯æŒçš„åŠŸèƒ½ ä¾‹å¦‚ï¼Œç°åœ¨æœ‰ä¸ªéœ€æ±‚ï¼Œæˆ‘æƒ³ç”¨åœ¨ç¼–è¯‘ linux ç¨‹åºæ—¶ï¼Œè°ƒç”¨ `pkg config` è·å–åˆ°å®é™…çš„ç¬¬ä¸‰æ–¹é“¾æ¥åº“åï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š ```lua target(\"test\", function() set_kind(\"binary\") if is_plat(\"linux\") then add_ldflags(\"$(shell pkg config libs sqlite3)\") end end) ``` å½“ç„¶ï¼Œxmake æœ‰è‡ªå·±çš„è‡ªåŠ¨åŒ–ç¬¬ä¸‰åº“æ£€æµ‹æœºåˆ¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦è¿™ä¹ˆéº»çƒ¦ï¼Œè€Œä¸” lua è‡ªèº«çš„è„šæœ¬åŒ–å·²ç»å¾ˆä¸é”™äº†ã€‚ ä½†æ˜¯è¿™ä¸ªä¾‹å­å¯ä»¥è¯´æ˜ï¼Œxmake æ˜¯å®Œå…¨å¯ä»¥é€šè¿‡åŸç”Ÿ shellï¼Œæ¥ä¸ä¸€äº›ç¬¬ä¸‰æ–¹çš„å·¥å…·è¿›è¡Œé…åˆä½¿ç”¨ã€‚ ## var.$(env) è·å–å¤–éƒ¨ç¯å¢ƒå˜é‡ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡è·å–ç¯å¢ƒå˜é‡ä¸­çš„è·¯å¾„ï¼š ```lua target(\"test\", function() add_includedirs(\"$(env PROGRAMFILES)/OpenSSL/inc\") end) ```"},"/get_started/zh/tutorial/FAQ.html":{"title":"","content":" class: heading_no_counter # FAQ ## æ€æ ·è·å–æ›´å¤šå‚æ•°é€‰é¡¹ä¿¡æ¯ï¼Ÿ è·å–ä¸»èœå•çš„å¸®åŠ©ä¿¡æ¯ï¼Œé‡Œé¢æœ‰æ‰€æœ‰ action å’Œ plugin çš„åˆ—è¡¨æè¿°ã€‚ ```bash $ xmake [ h help] ``` è·å–é…ç½®èœå•çš„å¸®åŠ©ä¿¡æ¯ï¼Œé‡Œé¢æœ‰æ‰€æœ‰é…ç½®é€‰é¡¹çš„æè¿°ä¿¡æ¯ï¼Œä»¥åŠæ”¯æŒå¹³å°ã€æ¶æ„åˆ—è¡¨ã€‚ ```bash $ xmake f [ h help] ``` è·å– action å’Œ plugin å‘½ä»¤èœå•çš„å¸®åŠ©ä¿¡æ¯ï¼Œé‡Œé¢æœ‰æ‰€æœ‰å†…ç½®å‘½ä»¤å’Œæ’ä»¶ä»»åŠ¡çš„å‚æ•°ä½¿ç”¨ä¿¡æ¯ã€‚ ```bash $ xmake [actionplugin] [ h help] ``` ä¾‹å¦‚ï¼Œè·å– `run` å‘½ä»¤çš„å‚æ•°ä¿¡æ¯ : ```bash $ xmake run help ``` ## æ€æ ·å®ç°é™é»˜æ„å»ºï¼Œä¸è¾“å‡ºä»»ä½•ä¿¡æ¯ï¼Ÿ ```bash $ xmake [ q quiet] ``` ## å¦‚æœ xmake è¿è¡Œå¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ å¯ä»¥å…ˆå°è¯•æ¸…é™¤ä¸‹é…ç½®ï¼Œé‡æ–°æ„å»ºä¸‹ï¼š ```bash $ xmake f c $ xmake ``` å¦‚æœè¿˜æ˜¯å¤±è´¥äº†ï¼Œè¯·åŠ ä¸Š ` v` æˆ–è€… ` verbose` é€‰é¡¹é‡æ–°æ‰§è¡Œ xmake åï¼Œè·å–æ›´åŠ è¯¦ç»†çš„è¾“å‡ºä¿¡æ¯ ä¾‹å¦‚ï¼š ```hash $ xmake [ v verbose] ``` å¹¶ä¸”å¯ä»¥åŠ ä¸Š ` D` é€‰é¡¹è·å–å‡ºé”™æ—¶çš„ xmake çš„è°ƒè¯•æ ˆä¿¡æ¯å’Œå…¶ä»–æ›´è¯¦ç»†çš„è¯Šæ–­ä¿¡æ¯ , ç„¶åä½ å¯ä»¥æäº¤è¿™äº›ä¿¡æ¯åˆ° [issues](https://github.com/TOMO CAT/xmake/issues)ã€‚ ```bash $ xmake v D ``` ## æ€æ ·çœ‹å®æ—¶ç¼–è¯‘è­¦å‘Šä¿¡æ¯ ? ä¸ºäº†é¿å…åˆ·å±ï¼Œåœ¨æ„å»ºæ—¶å€™ï¼Œé»˜è®¤æ˜¯ä¸å®æ—¶è¾“å‡ºè­¦å‘Šä¿¡æ¯çš„ï¼Œå¦‚æœæƒ³è¦çœ‹çš„è¯å¯ä»¥åŠ ä¸Š ` w` é€‰é¡¹å¯ç”¨ç¼–è¯‘è­¦å‘Šè¾“å‡ºå°±è¡Œäº†ã€‚ ```bash $ xmake [ w warning] ``` ## æ€æ ·åŸºäºæºç è‡ªåŠ¨ç”Ÿæˆ xmake.luaï¼Ÿ å¦‚æœä½ æƒ³ä¸´æ—¶å†™ä¸€ä¸¤ä¸ªæµ‹è¯•ä»£ç ã€æˆ–è€…æ‰‹ä¸Šæœ‰ä¸€äº›ç§»æ¤è¿‡æ¥çš„é›¶æ•£æºç æƒ³è¦å¿«é€Ÿç¼–è¯‘è¿è¡Œï¼Œå¯ä»¥ä¸ç”¨ä¸“é—¨å†™ xmake.luaï¼Œç›´æ¥è¿è¡Œï¼š ```bash $ xmake ``` xmake ä¼šè‡ªåŠ¨æ‰«æåˆ†æå½“å‰çš„æºç ç›®å½•ï¼Œè¯†åˆ«ç¨‹åºç»“æ„å’Œç±»å‹ï¼Œç”Ÿæˆä¸€ä¸ª xmake.luaï¼Œå¹¶ä¸”ä¼šå°è¯•ç›´æ¥æ„å»ºå®ƒã€‚ å¦‚æœç¼–è¯‘æˆåŠŸï¼Œå¯ä»¥ç›´æ¥è¿è¡Œï¼š ```bash $ xmake run ``` å½“ç„¶ï¼Œå¦‚æœä»…ä»…åªæ˜¯æƒ³è¦ç”Ÿæˆ xmake.luaï¼Œé»˜è®¤ä¸å»æ„å»ºï¼Œå¯ä»¥æ‰§è¡Œï¼š ```bash $ xmake f y ``` æ›´å¤šç›¸å…³ä»‹ç»ï¼Œè¯·å‚è€ƒæ–‡ç« ï¼š[xmake æ–°å¢æ™ºèƒ½ä»£ç æ‰«æç¼–è¯‘æ¨¡å¼ï¼Œæ— éœ€æ‰‹å†™ä»»ä½• make æ–‡ä»¶](https://tboox.org/cn/2017/01/07/build without makefile/) ## ä¸ºä»€ä¹ˆ xmake.lua ä¼šè¢«æ‰§è¡Œå¤šéï¼Ÿ xmake.lua é‡Œé¢åˆ†æè¿°åŸŸå’Œè„šæœ¬åŸŸï¼Œåœ¨æè¿°åŸŸé‡Œé¢ä¼šå¯¹å„ç§é…ç½®åŸŸè¿›è¡Œåˆ†é˜¶æ®µå¤šæ¬¡è§£æï¼Œæœ‰å¯èƒ½ä¼šæ‰§è¡Œå¤šéï¼Œå› æ­¤ä¸è¦åœ¨æè¿°åŸŸå†™å¤æ‚çš„è„šæœ¬ã€‚ å¦‚æœè¦å†™å„ç§å¤æ‚è„šæœ¬ï¼Œè¯·åœ¨è„šæœ¬åŸŸå†…è¿›è¡Œé…ç½®ï¼Œ`target/on_load` çš„è„šæœ¬åŸŸé‡Œé¢åŒæ ·å¯ä»¥çµæ´»é…ç½®å„ç§ target ç›¸å…³è®¾ç½®ï¼Œå¹¶ä¸”æä¾›æ›´å¼ºå¤§çš„ lua è„šæœ¬æ¨¡å—æ”¯æŒã€‚ æ›´å¤šç»†èŠ‚è§ï¼š[æè¿°è¯­æ³•è¯´æ˜](/zh cn/guide/syntax_description) ## å¦‚ä½•è°ƒè¯• Xmake æºç ? ### ä¸‹è½½æºç  ç”±äº xmake ä½¿ç”¨äº† git submodules ç»´æŠ¤å­æ¨¡å—ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢å‡ ç§æ–¹å¼æ‹‰å–å®Œæ•´æºç ã€‚ #### ä½¿ç”¨ git æ‹‰å– ```bash $ git clone recursive https://github.com/TOMO CAT/xmake.git ``` æˆ–è€… ```bash $ git clone https://github.com/TOMO CAT/xmake.git $ git submodule update init ``` #### ä» Github Releases ä¸‹è½½æºç åŒ… ç”±äº github æœ¬èº«çš„ downloads é™„ä»¶ä¸‹è½½ä¸æ”¯æŒå½’æ¡£ submodulesï¼Œå› æ­¤ Xmake æ¯æ¬¡å‘ç‰ˆéƒ½ä¼šå®Œæ•´æ‰“åŒ…ä¸€ä»½é¢å¤–çš„ tar åŒ…æºç ä¸Šä¼ åˆ° Releases ä¸Šã€‚ å› æ­¤ï¼Œä¸è¦ä¸‹è½½é”™è¯¯çš„é“¾æ¥åœ°å€ ä¸å®Œæ•´æºç ï¼š<https://github.com/TOMO CAT/xmake/archive/refs/tags/v3.0.4.tar.gz> å®Œæ•´æºç åŒ…ï¼š<https://github.com/TOMO CAT/xmake/releases/download/v3.0.4/xmake v3.0.4.tar.gz> ```bash wget https://github.com/TOMO CAT/xmake/releases/download/v3.0.4/xmake v3.0.4.tar.gz tar xvf xmake v3.0.4.tar.gz C xmake cd xmake ``` > Xmake çš„ tar æºç åŒ…æ²¡æœ‰é¡¶å±‚ xmake æ ¹ç›®å½•ï¼Œå› æ­¤è§£å‹æ—¶å€™æœ€å¥½å¸¦ä¸Š ` C xmake` æŒ‡å®šä¸‹è¾“å‡ºç›®å½•ã€‚ ### ç¼–è¯‘æºç  ç±» unix å¹³å°ç¯å¢ƒç¼–è¯‘ Xmakeï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æºç æ ¹ç›®å½•æ‰§è¡Œ make å°±è¡Œäº†ã€‚ ```bash $ cd xmake $ ./configure $ make ``` ### åŠ è½½è°ƒè¯• å¦‚æœç¼–è¯‘å®Œæˆï¼Œæˆ‘ä»¬å°±å¯ä»¥åŠ è½½åˆšåˆšç¼–è¯‘å¥½çš„ Xmake äºŒè¿›åˆ¶ core ç¨‹åºï¼Œç„¶åè¿è¡Œæœ¬åœ°çš„ Lua è„šæœ¬äº†ã€‚ åœ¨ Linux/macOS/FreeBSD ä¸Šåªéœ€è¦è¿è¡Œï¼š ```bash $ cd xmake $ source scripts/srcenv.profile ``` å°±èƒ½è¿›å…¥æœ¬åœ°æºç è°ƒè¯•ç¯å¢ƒã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿è¡Œï¼š ```bash $ xmake l os.programdir ``` æ¥éªŒè¯æˆ‘ä»¬æ˜¯å¦çœŸçš„åŠ è½½äº†æœ¬åœ°çš„ Lua è„šæœ¬ç¯å¢ƒã€‚ ### è°ƒè¯• core äºŒè¿›åˆ¶ é€šå¸¸è°ƒè¯• Xmake çš„ Lua è„šæœ¬ï¼Œåªéœ€è¦ç›´æ¥ä¿®æ”¹å½“å‰æºç ç›®å½•çš„ Lua è„šæœ¬å°±è¡Œäº†ï¼Œå®æ—¶ç”Ÿæ•ˆçš„ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦é‡å¤ç¼–è¯‘ core äºŒè¿›åˆ¶ã€‚ ä½†æ˜¯å¦‚æœæ˜¯ Xmake çš„ C ç«¯ core ç¨‹åºæœ‰é—®é¢˜ï¼Œéœ€è¦è°ƒè¯•æˆ–è€…åŠ æ¨¡å—ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡å¤ç¼–è¯‘äº†ã€‚ ç¼–è¯‘å®Œæˆï¼Œä¹Ÿæ˜¯å®æ—¶ç”Ÿæ•ˆçš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ C ä»£ç é‡Œé€šè¿‡ï¼š ```c xu_trace_i(\"hello %s\", \"xmake\"); ``` æ¥æ ¼å¼åŒ–æ‰“å°å„ç§è¾“å‡ºã€‚ å¦‚æœæ˜¯ sv ç­‰ Xmake ä¾èµ–çš„å„ç§ submodules å­æ¨¡å—æœ‰é—®é¢˜ï¼Œéœ€è¦è°ƒè¯•ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è¿›å…¥å­æ¨¡å—æºç ï¼Œä¿®æ”¹åé‡æ–°ç¼–è¯‘æ‰§è¡Œã€‚ ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦è´¡çŒ®ä¿®å¤è¡¥ä¸ï¼Œæˆ‘ä»¬éœ€è¦æäº¤ pr ç»™å­æ¨¡å—çš„ä»“åº“æ‰è¡Œï¼Œè¡¥ä¸åˆå¹¶åï¼Œä½œè€…ä¼šåœ¨ç‰¹å®šæ—¶é—´åŒæ­¥åˆ°åˆ° xmake æºç ä»“åº“ã€‚ ### æ–­ç‚¹è°ƒè¯• xmake ä¹Ÿæ”¯æŒ Lua æ–­ç‚¹è°ƒè¯•æ”¯æŒï¼Œé…åˆ [VSCode EmmyLua](https://github.com/EmmyLua/VSCode EmmyLua) æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨ VSCode ä¸­æ–­ç‚¹è°ƒè¯• xmake è‡ªèº«æºç ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ VSCode çš„æ’ä»¶å¸‚åœºå®‰è£… VSCode EmmyLua æ’ä»¶ï¼Œç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ›´æ–°ä¸‹ xmake repo ä»“åº“ä¿æŒæœ€æ–°ã€‚ ```bash xrepo update repo ``` > Xmake ä¹Ÿéœ€è¦ä¿æŒæœ€æ–°ç‰ˆæœ¬ã€‚ ç„¶åï¼Œåœ¨è‡ªå·±çš„å·¥ç¨‹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š ```bash $ xrepo env b emmylua_debugger xmake build ``` å…¶ä¸­ `xrepo env b emmylua_debugger` ç”¨äºç»‘å®š EmmyLua è°ƒè¯•å™¨æ’ä»¶ç¯å¢ƒï¼Œè€Œ ` ` åé¢çš„å‚æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬å®é™…éœ€è¦è¢«è°ƒè¯•çš„ xmake å‘½ä»¤ã€‚ é€šå¸¸æˆ‘ä»¬ä»…ä»…è°ƒè¯• `xmake build` æ„å»ºï¼Œå¦‚æœæƒ³è¦è°ƒè¯•å…¶ä»–å‘½ä»¤ï¼Œå¯ä»¥è‡ªå·±è°ƒæ•´ï¼Œæ¯”å¦‚æƒ³è¦è°ƒè¯• `xmake install o /tmp` å®‰è£…å‘½ä»¤ï¼Œé‚£ä¹ˆå¯ä»¥æ”¹æˆï¼š ```bash $ xrepo env b emmylua_debugger xmake install o /tmp ``` æ‰§è¡Œå®Œä¸Šé¢çš„å‘½ä»¤åï¼Œå®ƒä¸ä¼šç«‹å³é€€å‡ºï¼Œä¼šä¸€ç›´å¤„äºç­‰å¾…è°ƒè¯•çŠ¶æ€ï¼Œæœ‰å¯èƒ½æ²¡æœ‰ä»»ä½•è¾“å‡ºã€‚ è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬ä¸è¦æ€¥ç€é€€å‡ºå®ƒï¼Œç»§ç»­æ‰“å¼€ VSCodeï¼Œå¹¶åœ¨ VSCode ä¸­æ‰“å¼€ Xmake çš„ Lua è„šæœ¬æºç ç›®å½•ã€‚ ä¹Ÿå°±æ˜¯è¿™ä¸ªç›®å½•ï¼š[Xmake Lua Scripts](https://github.com/xmake io/xmake/tree/master/xmake)ï¼Œæˆ‘ä»¬å¯ä»¥ä¸‹è½½çš„æœ¬åœ°ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰“å¼€ Xmake å®‰è£…ç›®å½•ä¸­çš„ lua è„šæœ¬ç›®å½•ã€‚ ç„¶ååˆ‡æ¢åˆ° VSCode çš„è°ƒè¯• Tab é¡µï¼Œç‚¹å‡» `RunDebug` > `Emmylua New Debug` å°±èƒ½è¿æ¥åˆ°æˆ‘ä»¬çš„ `xmake build` å‘½ä»¤è°ƒè¯•ç«¯ï¼Œå¼€å¯è°ƒè¯•ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé»˜è®¤çš„èµ·å§‹æ–­ç‚¹ä¼šè‡ªåŠ¨ä¸­æ–­åˆ° `debugger:_start_emmylua_debugger` å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹å‡»å•æ­¥è·³å‡ºå½“å‰å‡½æ•°ï¼Œå°±èƒ½è¿›å…¥ main å…¥å£ã€‚ ![](./image/xmake debug.png) ç„¶åè®¾ç½®è‡ªå·±çš„æ–­ç‚¹ï¼Œç‚¹å‡»ç»§ç»­è¿è¡Œï¼Œå°±èƒ½ä¸­æ–­åˆ°è‡ªå·±æƒ³è¦è°ƒè¯•çš„ä»£ç ä½ç½®ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®å·¥ç¨‹çš„é…ç½®è„šæœ¬ä¸­è®¾ç½®æ–­ç‚¹ï¼Œä¹Ÿå¯ä»¥å®ç°å¿«é€Ÿè°ƒè¯•è‡ªå·±çš„é…ç½®è„šæœ¬ï¼Œè€Œä¸ä»…ä»…æ˜¯ xmake è‡ªèº«æºç ã€‚ ![](./image/xmake debug2.png) ### è¿œç¨‹è°ƒè¯• xmake ä¹Ÿèƒ½æ”¯æŒè¿œç¨‹è°ƒè¯•ï¼Œåœ¨è™šæ‹Ÿæœºä¸­è°ƒè¯•å¾€å¾€ä½“éªŒä¸ä½³ï¼Œå› æ­¤é€šå¸¸ä¼šè¿œç¨‹è¿åˆ°å…¶ä»–ä¸»æœºä¸Šå»è°ƒè¯• xmake æºç ã€‚ æˆ‘ä»¬å…ˆåœ¨è¿œç¨‹æœºå™¨ä¸Šå¼€å¯è¿œç¨‹ç¼–è¯‘æœåŠ¡ï¼š ```bash $ xmake service ``` ç„¶åæœ¬æœºæ‰“å¼€éœ€è¦æ„å»ºçš„å·¥ç¨‹ç›®å½•ï¼Œæ‰§è¡Œè¿œç¨‹è¿æ¥ï¼Œç„¶åæ‰§è¡Œ `xmake service sync xmakesrc ` å»åŒæ­¥æœ¬åœ°æºç ï¼š ```bash $ xmake service connect $ xmake service sync xmakesrc ~/projects/personal/xmake/xmake/ $ xmake build $ xmake run ``` è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½æœ¬åœ°ä¿®æ”¹ xmake è„šæœ¬æºç ï¼Œç„¶ååŒæ­¥åˆ°è¿œç¨‹æœºå™¨ä¸Šï¼Œå†è¿œç¨‹æ‰§è¡Œ xmake æ„å»ºå‘½ä»¤è·å–å¯¹åº”çš„è°ƒè¯•è¾“å‡ºï¼Œä»¥åŠåˆ†ææ„å»ºè¡Œä¸ºã€‚ æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿé€šè¿‡ `xmake service pull ` å‘½ä»¤ï¼Œå›æ‹‰è¿œç¨‹çš„æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œè¿›è¡Œåˆ†æã€‚ > æ³¨ï¼šè¯¦ç»†çš„è¿œç¨‹ç¼–è¯‘ç‰¹æ€§è¯´æ˜ï¼Œè§ [è¿œç¨‹ç¼–è¯‘æ–‡æ¡£](http://xmake.io/#/zh cn/features/remote_build)ã€‚ ![](./image/xmake remote.png) ## å¦‚ä½•è°ƒè¯•ä»“åº“åŒ…? è°ƒè¯•çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œæˆ‘ä¸»è¦ä»‹ç»æœ€å¸¸ä½¿ç”¨çš„è°ƒè¯•æ–¹å¼ï¼Œé‚£å°±æ˜¯ç›´æ¥æ‹‰å– xmake repo ä»“åº“æ¥è°ƒè¯•ã€‚ ```bash $ git clone https://github.com/xmake io/xmake repo.git $ xmake l scripts/test.lua vD shallow zlib ``` ä½¿ç”¨ä¸Šé¢ test.lua è„šæœ¬å‘½ä»¤æ¥è°ƒè¯•åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥é‡å¤å®‰è£…æµ‹è¯•æŒ‡å®šçš„åŒ…ï¼Œ` shallow` å‘Šè¯‰ xmake æ¯æ¬¡æµ‹è¯•ä¸å»é‡å¤å®Œæ•´å®‰è£…å®ƒçš„æ‰€æœ‰ä¾èµ–åŒ…ï¼Œä»…ä»…æµ‹è¯•æŒ‰ç…§å½“å‰åŒ…ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥æµ‹è¯•æŒ‡å®šçš„å¹³å°ï¼Œæ¶æ„ï¼Œç¼–è¯‘æ¨¡å¼ï¼Œ vs_runtime å’ŒåŠ¨æ€åº“ï¼Œé™æ€åº“ç­‰ç­‰ã€‚ ```bash $ xmake l scripts/test.lua vD shallow p mingw mingw /xxx/sdk zlib $ xmake l scripts/test.lua vD shallow p iphoneos a arm64 zlib $ xmake l scripts/test.lua vD shallow k shared vs_runtime MD zlib $ xmake l scripts/test.lua vD shallow m debug zlib ``` ### è°ƒè¯•æœ¬åœ°åŒ…æºç  æœ‰æ—¶å€™ï¼Œç”±äºåŒ…çš„æºç å’Œæ„å»ºè„šæœ¬æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€äº›ä»£ç æ‰èƒ½ç»§ç»­æµ‹è¯•å®‰è£…ï¼Œå¦‚æœé€šè¿‡ add_patches/io.replace çš„æ–¹å¼åœ¨ on_install é‡Œé¢å»ä¿®æ”¹è°ƒè¯•ï¼Œéå¸¸ç¹çã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®š ` d package_sourcedir` æ–¹å¼ï¼Œç›´æ¥è®©æµ‹è¯•è„šæœ¬è¿›å…¥æˆ‘ä»¬é¢„å…ˆä¸‹è½½å¥½çš„åŒ…æºç ç›®å½•ï¼Œæµ‹è¯•ç¼–è¯‘å®‰è£…ï¼Œæˆ‘ä»¬æ¯æ¬¡çš„ä»£ç ä¿®æ”¹ä¸ä¼šè¢«é‡ç½®ã€‚ ```bash $ xmake l scripts/test.lua vD shallow d /tmp/zlib 1.2.11 zlib ``` ç­‰ä¿®æ”¹è°ƒè¯•é€šè¿‡åï¼Œæˆ‘ä»¬å†æ ¹æ®æ”¹åŠ¨ï¼Œé€šè¿‡ `git diff > fix.patch` ç”Ÿæˆè¡¥ä¸æ–‡ä»¶ï¼Œé€šè¿‡ `add_patches` é…ç½®åº”ç”¨è¡¥ä¸åŒ…ï¼Œæ¥ä¿®å¤åŒ…çš„å®‰è£…ã€‚ ### è¿œç¨‹è°ƒè¯•åŒ…æºç  æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿œç¨‹è°ƒè¯•åŒ…ï¼Œå…ˆå¼€å¯è¿œç¨‹æœåŠ¡ï¼š ```bash $ xmake service ``` ç„¶åä¼ å…¥ ` remote` å‚æ•°ï¼Œå³å¯å®ç°è¿œç¨‹åŒ…ç¼–è¯‘æµ‹è¯•ã€‚ ```bash $ xmake l scripts/test.lua vD shallow remote /tmp/zlib 1.2.11 zlib ``` ## ä¸‹è½½åŒ…æç¤ºè¯ä¹¦æ ¡éªŒå¤±è´¥æ€ä¹ˆåŠï¼Ÿ ```bash curl: (60) SSL certificate problem: unable to get local issuer certificate More details here: https://curl.se/docs/sslcerts.html curl failed to verify the legitimacy of the server and therefore could not establish a secure connection to it. To learn more about this situation and how to fix it, please visit the web page mentioned above. ``` å¦‚æœä½ åœ¨ä½¿ç”¨ Xmake å®‰è£…ä¾èµ–åŒ…æ—¶å€™ï¼Œé‡åˆ°ä¸Šé¢çš„è¯ä¹¦éªŒè¯é—®é¢˜ï¼Œä½ å¯ä»¥å°è¯•æ›´æ–° curl è¯ä¹¦å»ä¿®å¤å®ƒï¼Œæˆ–è€…ç›´æ¥å…¨å±€é…ç½®ç¦ç”¨è¯ä¹¦éªŒè¯æ¥ç»•è¿‡å®ƒã€‚ ```bash $ xmake g insecure ssl y ``` å½“ç„¶ï¼Œç¦ç”¨è¯ä¹¦éªŒè¯ä¼šå¸¦æ¥ä¸€å®šçš„å®‰å…¨æ€§é£é™©ï¼Œä¸è¿‡å¥½åœ¨ xmake repo ä»“åº“ä¸­çš„åŒ…ï¼Œæœ‰ä¸¥æ ¼çš„ sha256 æ ¡éªŒï¼Œå³ä½¿ä¸‹è½½è¢«åŠ«æŒï¼Œæœ€ç»ˆä¹Ÿä¼š xmake çš„ sha256 æ ¡éªŒæ£€æµ‹åˆ°ï¼Œä½œä¸ºæ— æ•ˆä¸‹è½½ã€‚"},"/get_started/zh/tutorial/description-scope.html":{"title":"","content":" class: heading_no_counter # æè¿°åŸŸ ## å‘½åè§„èŒƒ æ¥å£çš„å‘½åï¼Œæ˜¯æœ‰æŒ‰ç…§é¢„å®šä¹‰çš„ä¸€äº›è§„èŒƒæ¥å‘½åçš„ï¼Œè¿™æ ·æ›´åŠ æ–¹ä¾¿ç†è§£å’Œæ˜“äºä½¿ç”¨ï¼Œç›®å‰å‘½åæŒ‰ç…§å¦‚ä¸‹ä¸€äº›è§„åˆ™ï¼š æ¥å£è§„åˆ™ æè¿° `is_`, `has_` å‰ç¼€çš„æ¥å£ è¡¨ç¤ºä¸ºæ¡ä»¶åˆ¤æ–­ `set_` å‰ç¼€çš„æ¥å£ è¡¨ç¤ºä¸ºè¦†ç›–è®¾ç½® `add_` å‰ç¼€çš„æ¥å£ è¡¨ç¤ºä¸ºè¿½åŠ è®¾ç½® `s` åç¼€çš„æ¥å£ è¡¨ç¤ºæ”¯æŒå¤šå€¼ä¼ å…¥ï¼Œä¾‹å¦‚ï¼š`add_files(\"*.c\", \"test.cpp\")` `on_` å‰ç¼€çš„æ¥å£ è¡¨ç¤ºä¸ºè¦†ç›–å†…ç½®è„šæœ¬ `before_` å‰ç¼€çš„æ¥å£ è¡¨ç¤ºä¸ºåœ¨å†…ç½®è„šæœ¬è¿è¡Œå‰ï¼Œæ‰§è¡Œæ­¤è„šæœ¬ `after_` å‰ç¼€çš„æ¥å£ è¡¨ç¤ºä¸ºåœ¨å†…ç½®è„šæœ¬è¿è¡Œåï¼Œæ‰§è¡Œæ­¤è„šæœ¬ `scope(\"name\")` çš„æ¥å£ è¡¨ç¤ºä¸ºå®šä¹‰ä¸€ä¸ªæè¿°åŸŸï¼Œä¾‹å¦‚ï¼š`target(\"xxx\")`, `option(\"xxx\")` æè¿°åŸŸ / æè¿°è®¾ç½® å»ºè®®ç¼©è¿›è¡¨ç¤º ## æ¡ä»¶åˆ¤æ–­ æ¡ä»¶åˆ¤æ–­çš„ apiï¼Œä¸€èˆ¬ç”¨äºå¿…é¡»è¦å¤„ç†ç‰¹å®šå¹³å°çš„ç¼–è¯‘é€»è¾‘çš„åœºåˆã€‚é€šå¸¸è·Ÿ lua çš„ if è¯­å¥é…åˆä½¿ç”¨ã€‚ ### is_os #### åˆ¤æ–­å½“å‰æ„å»ºç›®æ ‡çš„æ“ä½œç³»ç»Ÿ ```lua å¦‚æœå½“å‰æ“ä½œç³»ç»Ÿæ˜¯ ios if is_os(\"ios\") then add_files(\"src/xxx/*.m\") end ``` ç›®å‰æ”¯æŒçš„æ“ä½œç³»ç»Ÿæœ‰ï¼š * linux * android * macosx * ios ### is_arch #### åˆ¤æ–­å½“å‰ç¼–è¯‘æ¶æ„ ç”¨äºæ£€æµ‹ç¼–è¯‘é…ç½®ï¼š`xmake f a armv7` ```lua å¦‚æœå½“å‰æ¶æ„æ˜¯ x86_64 æˆ–è€… i386 if is_arch(\"x86_64\", \"i386\") then add_files(\"src/xxx/*.c\") end å¦‚æœå½“å‰å¹³å°æ˜¯ armv7, arm64, armv7s, armv7 a if is_arch(\"armv7\", \"arm64\", \"armv7s\", \"armv7 a\") then ... end ``` å¦‚æœåƒä¸Šé¢é‚£æ ·ä¸€ä¸ªä¸ªå»åˆ¤æ–­æ‰€æœ‰ arm æ¶æ„ï¼Œä¹Ÿè®¸ä¼šå¾ˆç¹çï¼Œæ¯•ç«Ÿæ¯ä¸ªå¹³å°çš„æ¶æ„ç±»å‹å¾ˆå¤šï¼Œxmake æä¾›äº†æ¯” [add_files](#targetadd_files) æ›´å¼ºçš„ lua æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ¨¡å¼ï¼Œæ¥æ›´åŠ ç®€æ´çš„è¿›è¡Œåˆ¤æ–­ï¼š ```lua å¦‚æœå½“å‰å¹³å°æ˜¯ arm å¹³å° if is_arch(\"arm.*\") then ... end ``` ç”¨ `.*` å°±å¯ä»¥åŒ¹é…æ‰€æœ‰äº†ã€‚ ### is_plat #### åˆ¤æ–­å½“å‰ç¼–è¯‘å¹³å° ç”¨äºæ£€æµ‹ç¼–è¯‘é…ç½®ï¼š`xmake f p iphoneos` ```lua å¦‚æœå½“å‰å¹³å°æ˜¯ android if is_plat(\"android\") then add_files(\"src/xxx/*.c\") end å¦‚æœå½“å‰å¹³å°æ˜¯ macosx æˆ–è€… iphoneos if is_plat(\"macosx\", \"iphoneos\") then add_frameworks(\"Foundation\") end ``` ç›®å‰æ”¯æŒçš„å¹³å°æœ‰ï¼š * cross * linux * macosx * android * iphoneos * watchos å½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªå·±æ‰©å±•æ·»åŠ è‡ªå·±çš„å¹³å°ï¼Œç”šè‡³ç›´æ¥æŒ‡å®šè‡ªå·±çš„å¹³å°åï¼š ```bash $ xmake f p other sdk ... ``` å¦‚æœæŒ‡å®šçš„å¹³å°åä¸å­˜åœ¨ï¼Œå°±ä¼šè‡ªåŠ¨åˆ‡åˆ° `cross` å¹³å°è¿›è¡Œäº¤å‰ç¼–è¯‘ï¼Œä½†æ˜¯å´å¯ä»¥é€šè¿‡ `is_plat(\"other\")` æ¥åˆ¤æ–­è‡ªå·±çš„å¹³å°é€»è¾‘ã€‚ ### is_host #### åˆ¤æ–­å½“å‰ä¸»æœºç¯å¢ƒçš„æ“ä½œç³»ç»Ÿ æœ‰äº›ç¼–è¯‘å¹³å°æ˜¯å¯ä»¥åœ¨å¤šä¸ªä¸åŒçš„æ“ä½œç³»ç»Ÿè¿›è¡Œæ„å»ºçš„ï¼Œä¾‹å¦‚ï¼šandroid çš„ ndk å°±æ”¯æŒ linux å’Œ macOS ç¯å¢ƒã€‚ è¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£ï¼ŒåŒºåˆ†å½“å‰æ˜¯åœ¨å“ªä¸ªç³»ç»Ÿç¯å¢ƒä¸‹è¿›è¡Œçš„æ„å»ºã€‚ ```lua å¦‚æœå½“å‰ä¸»æœºç¯å¢ƒæ˜¯ linux if is_host(\"linux\") then add_includedirs(\"/usr/includess\") else add_includedirs(\".\") end ``` ç›®å‰æ”¯æŒçš„ä¸»æœºç¯å¢ƒæœ‰ï¼š * linux * macosx ä½ ä¹Ÿå¯ä»¥é€šè¿‡ [$(host)](/zh cn/manual/builtin_variables?id varhost) å†…ç½®å˜é‡æˆ–è€… [os.host](/zh cn/manual/builtin_modules?id oshost) æ¥å£ï¼Œæ¥è¿›è¡Œè·å– ### is_cross #### åˆ¤æ–­å½“å‰å¹³å°æ˜¯å¦ä¸ºäº¤å‰ç¼–è¯‘ å¦‚æœå½“å‰çš„ç›®æ ‡æ¶æ„å’Œå¹³å°ï¼Œä¸æ˜¯å½“å‰çš„ä¸»æœºå¹³å°ï¼Œå±äºäº¤å‰ç¼–è¯‘ï¼Œè¿™ä¸ªæ¥å£å°±ä¼šè¿”å› trueã€‚ ### is_mode #### åˆ¤æ–­å½“å‰ç¼–è¯‘æ¨¡å¼ ç”¨äºæ£€æµ‹ç¼–è¯‘é…ç½®ï¼š`xmake f m debug` ç¼–è¯‘æ¨¡å¼çš„ç±»å‹å¹¶ä¸æ˜¯å†…ç½®çš„ï¼Œå¯ä»¥è‡ªç”±æŒ‡å®šï¼Œä¸€èˆ¬æŒ‡å®šï¼š`debug`, `release`, `profile` è¿™äº›å°±å¤Ÿç”¨äº†ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨ xmake.lua ä½¿ç”¨å…¶ä»–æ¨¡å¼åæ¥åˆ¤æ–­ã€‚ ```lua å¦‚æœå½“å‰ç¼–è¯‘æ¨¡å¼æ˜¯ debug if is_mode(\"debug\") then æ·»åŠ  DEBUG ç¼–è¯‘å® add_defines(\"DEBUG\") å¯ç”¨è°ƒè¯•ç¬¦å· set_symbols(\"debug\") ç¦ç”¨ä¼˜åŒ– set_optimize(\"none\") end å¦‚æœæ˜¯ release æˆ–è€… profile æ¨¡å¼ if is_mode(\"release\", \"profile\") then å¦‚æœæ˜¯ release æ¨¡å¼ if is_mode(\"release\") then éšè—ç¬¦å· set_symbols(\"hidden\") strip æ‰€æœ‰ç¬¦å· set_strip(\"all\") å¿½ç•¥å¸§æŒ‡é’ˆ add_cxflags(\" fomit frame pointer\") add_mxflags(\" fomit frame pointer\") å¦‚æœæ˜¯ profile æ¨¡å¼ else å¯ç”¨è°ƒè¯•ç¬¦å· set_symbols(\"debug\") end æ·»åŠ æ‰©å±•æŒ‡ä»¤é›† add_vectorexts(\"sse2\", \"sse3\", \"ssse3\", \"mmx\") end ``` ### is_kind #### åˆ¤æ–­å½“å‰ç¼–è¯‘ç±»å‹ åˆ¤æ–­å½“å‰æ˜¯å¦ç¼–è¯‘çš„æ˜¯åŠ¨æ€åº“è¿˜æ˜¯é™æ€åº“ï¼Œç”¨äºæ£€æµ‹ç¼–è¯‘é…ç½®ï¼š`xmake f k [staticshared]` ä¸€èˆ¬ç”¨äºå¦‚ä¸‹åœºæ™¯ï¼š ```lua target(\"test\") é€šè¿‡é…ç½®è®¾ç½®ç›®æ ‡çš„ kind set_kind(\"$(kind)\") add_files(\"src/*c\") å¦‚æœå½“å‰ç¼–è¯‘çš„æ˜¯é™æ€åº“ï¼Œé‚£ä¹ˆæ·»åŠ æŒ‡å®šæ–‡ä»¶ if is_kind(\"static\") then add_files(\"src/xxx.c\") end ``` ç¼–è¯‘é…ç½®çš„æ—¶å€™ï¼Œå¯æ‰‹åŠ¨åˆ‡æ¢ï¼Œç¼–è¯‘ç±»å‹ï¼š ```bash # ç¼–è¯‘é™æ€åº“ $ xmake f k static $ xmake ``` ```bash # ç¼–è¯‘åŠ¨æ€åº“ $ xmake f k shared $ xmake ``` ### is_config #### åˆ¤æ–­æŒ‡å®šé…ç½®æ˜¯å¦ä¸ºç»™å®šçš„å€¼ ç”¨äºåˆ¤æ–­æŒ‡å®šé…ç½®æ˜¯å¦ä¸ºç»™å®šçš„å€¼ï¼Œå¯ç”¨äºæè¿°åŸŸã€‚ ä¾‹å¦‚ï¼š ```console $ xmake f test hello1 ``` ```lua è‡ªå®šä¹‰ä¸€ä¸ªé…ç½®é€‰é¡¹åˆ°å‘½ä»¤è¡Œèœå• option(\"test\", function() set_showmenu(true) set_description(\"The test config option\") end) å¦‚æœè‡ªå®šä¹‰çš„ test é…ç½®å€¼æ˜¯ hello1 æˆ–è€… hello2 if is_config(\"test\", \"hello1\", \"hello2\") then add_defines(\"HELLO\") end ``` å¯ä»¥ç”¨æ¥æ ¹æ®é…ç½®å€¼å¢åŠ å¯¹åº”çš„ä¾èµ–åŒ…ï¼Œä¾‹å¦‚ï¼š ```lua æ ¹æ® lua_flavor çš„é…ç½®å€¼ï¼Œé€‰æ‹©ä¾èµ– lua è¿˜æ˜¯ luajit option(\"lua_flavor\", function() set_showmenu(true) set_values(\"luajit\", \"lua\") end) if is_config(\"lua_flavor\", \"luajit\") then add_requires(\"luajit\") elseif is_config(\"lua_flavor\", \"lua\") then add_requires(\"lua\") end ``` ä¸ä»…å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®æ¨¡å¼åŒ¹é…è§„åˆ™å»åˆ¤æ–­å€¼ï¼Œä¾‹å¦‚ï¼š ```lua å¦‚æœè‡ªå®šä¹‰çš„ test é…ç½®å€¼å¸¦æœ‰ hello å‰ç¼€ if is_config(\"test\", \"hello.*\") then add_defines(\"HELLO\") end ``` > æ­¤æ¥å£ä¸ä»…èƒ½å¤Ÿåˆ¤æ–­é€šè¿‡ [option](#option) å®šä¹‰çš„è‡ªå®šä¹‰é…ç½®é€‰é¡¹ï¼ŒåŒæ—¶è¿˜èƒ½åˆ¤æ–­å†…ç½®çš„å…¨å±€é…ç½®ã€æœ¬åœ°é…ç½® ### has_config #### åˆ¤æ–­é…ç½®æ˜¯å¦å¯ç”¨æˆ–è€…å­˜åœ¨ ç”¨äºæ£€æµ‹è‡ªå®šä¹‰æˆ–è€…å†…ç½®çš„ç¼–è¯‘é…ç½®æ˜¯å¦å­˜åœ¨æˆ–å¯ç”¨ï¼Œå¯ç”¨äºæè¿°åŸŸã€‚ ä¾‹å¦‚ä»¥ä¸‹é…ç½®æƒ…å†µï¼Œéƒ½ä¼šè¿”å› true: ```console # å¯ç”¨æŸä¸ªé…ç½®é€‰é¡¹ï¼ˆå¦‚æœæ˜¯ boolean ç±»å‹é…ç½®ï¼‰ $ xmake f test1 y $ xmake f test1 yes $ xmake f test1 true # è®¾ç½®æŸä¸ªé…ç½®é€‰é¡¹çš„å€¼ $ xmake f test2 value ``` ```lua å¦‚æœ test1 æˆ–è€… test2 è¢«è®¾ç½®æˆ–è€…å¯ç”¨ if has_config(\"test1\", \"test2\") then add_defines(\"TEST\") end ``` è€Œä¸‹é¢çš„æƒ…å†µåˆ™ä¼šç¦ç”¨é…ç½®ï¼Œè¿”å› falseï¼š ```console # ç¦ç”¨é…ç½®ï¼ˆå¦‚æœæ˜¯ boolean ç±»å‹é…ç½®ï¼‰ $ xmake f test1 n $ xmake f test1 no $ xmake f test1 false ``` > æ­¤æ¥å£ä¸ä»…èƒ½å¤Ÿåˆ¤æ–­å†…ç½®çš„å…¨å±€é…ç½®ã€æœ¬åœ°é…ç½®ï¼ŒåŒæ—¶è¿˜å¯ä»¥åˆ¤æ–­é€šè¿‡ [option](#option) å®šä¹‰çš„è‡ªå®šä¹‰é…ç½®é€‰é¡¹ã€‚ ### has_package #### åˆ¤æ–­ä¾èµ–åŒ…æ˜¯å¦å¯ç”¨æˆ–è€…å­˜åœ¨ æ­¤æ¥å£ç”¨äºæ£€æµ‹è¿œç¨‹ä¾èµ–åŒ…æ˜¯å¦å­˜åœ¨æˆ–å¯ç”¨ï¼Œå¯ç”¨äºæè¿°åŸŸã€‚ ä¸€èˆ¬é…åˆ [add_requires](/zh cn/manual/global_interfaces?id add_requires) ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š ```lua add_requires(\"tbox\", {optional true}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"tbox\") if has_package(\"tbox\") then add_defines(\"HAVE_TBOX\") end end) ``` å¦‚æœé€šè¿‡ `add_requires` æ·»åŠ çš„å¯é€‰ä¾èµ–åŒ…ï¼Œè¿œç¨‹ä¸‹è½½å®‰è£…å¤±è´¥ï¼Œæˆ–è€…å½“å‰å¹³å°ä¸æ”¯æŒå¯¼è‡´å®é™…ä¸Šæ²¡æœ‰è¢«æ­£å¸¸å®‰è£…ä¸Šï¼Œé‚£ä¹ˆ `has_package` å°±ä¼šè¿”å› falseï¼Œè¡¨ç¤ºä¸å­˜åœ¨ï¼Œç„¶åå¯¹å…¶ä»– flags å®šä¹‰ç”šè‡³æºæ–‡ä»¶ç¼–è¯‘æ§åˆ¶åšä¸€äº›ç‰¹æ®Šå¤„ç†ã€‚ > æ­¤æ¥å£è·Ÿ [has_config](#has_config) çš„åŒºåˆ«åœ¨äºï¼Œ[has_config](#has_config) ç”¨äº [option](#option)ï¼Œè€Œå®ƒç”¨äº [add_requires](#add_requires)ã€‚ ## å…¨å±€æ¥å£ å…¨å±€æ¥å£å½±å“æ•´ä¸ªå·¥ç¨‹æè¿°ï¼Œè¢«è°ƒç”¨åï¼Œåé¢è¢«åŒ…å«è¿›æ¥çš„æ‰€æœ‰å­ `xmake.lua` éƒ½ä¼šå—å½±å“ã€‚ ### includes #### æ·»åŠ å­å·¥ç¨‹æ–‡ä»¶å’Œç›®å½• æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨æ­¤æ¥å£æ·»åŠ å·¥ç¨‹å­æ–‡ä»¶ (xmake.lua) æˆ–è€…å¸¦æœ‰ xmake.lua çš„å·¥ç¨‹å­ç›®å½•ã€‚ ``` projectdir subdirs xmake.lua src ``` æ·»åŠ å­å·¥ç¨‹ç›®å½•ï¼š ```lua includes(\"subdirs\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` æˆ–è€…æ·»åŠ å­å·¥ç¨‹æ–‡ä»¶ï¼š ```lua includes(\"subdirs/xmake.lua\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¨¡å¼åŒ¹é…çš„æ–¹å¼ï¼Œé€’å½’æ·»åŠ å¤šä¸ªå·¥ç¨‹å­ç›®å½•æ–‡ä»¶ï¼š ```lua includes(\"**/xmake.lua\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` includes åŒ…å«å†…ç½®çš„ä¸€äº›è¾…åŠ©é…ç½®è„šæœ¬ï¼Œä¾‹å¦‚ï¼š ```lua includes(\"@builtin/check\") ``` ä¼šå¼•å…¥å†…ç½®æä¾›çš„ä¸€äº›æ£€æµ‹è¾…åŠ©æ¥å£ã€‚ è¿˜æœ‰ ```lua includes(\"@builtin/qt\") ``` ä¼šå¼•å…¥ä¸€äº›å†…ç½®çš„ Qt ç›¸å…³è¾…åŠ©æ¥å£ã€‚ å…¶ä¸­ `@builtin` æ˜¯å‘Šè¯‰ xmake ä»å†…ç½®çš„ includes ç›®å½•ä¸­å¼•å…¥é…ç½®è„šæœ¬ã€‚ ä¹Ÿå°±æ˜¯è¿™ä¸ªè·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶ï¼š[includes](https://github.com/xmake io/xmake/tree/master/xmake/includes) æˆ‘ä»¬å¯ä»¥å‘ä¸Šé¢é‚£æ ·ï¼ŒæŒ‰ç›®å½•æ•´ä¸ªå¼•å…¥ï¼Œä¹Ÿå¯ä»¥å¼•å…¥å•ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š ```lua includes(\"@builtin/check/check_cfuncs.lua\") ``` ä»…ä»…å¼•å…¥ check ç›®å½•ä¸‹ check_cfuncs ç›¸å…³çš„è¾…åŠ©è„šæœ¬ã€‚ è€Œé€šè¿‡ `@builtin` æˆ‘ä»¬å°±èƒ½å¾ˆå¥½çš„åŒºåˆ†æ˜¯å¼•å…¥å½“å‰ç”¨æˆ·å·¥ç¨‹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè¿˜æ˜¯ xmake å®‰è£…ç›®å½•ä¸‹çš„å†…ç½®æ–‡ä»¶ã€‚ ### set_project #### è®¾ç½®å·¥ç¨‹å è®¾ç½®å·¥ç¨‹åï¼Œåœ¨ doxygen è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆæ’ä»¶ã€å·¥ç¨‹æ–‡ä»¶ç”Ÿæˆæ’ä»¶ä¸­ä¼šç”¨åˆ°ï¼Œä¸€èˆ¬è®¾ç½®åœ¨ xmake.lua çš„æœ€å¼€å¤´ï¼Œå½“ç„¶æ”¾åœ¨å…¶ä»–åœ°æ–¹ä¹Ÿæ˜¯å¯ä»¥çš„ ```lua è®¾ç½®å·¥ç¨‹å set_project(\"xutil\") è®¾ç½®å·¥ç¨‹ç‰ˆæœ¬ set_version(\"1.5.1\") ``` ### set_version #### è®¾ç½®å·¥ç¨‹ç‰ˆæœ¬ è®¾ç½®é¡¹ç›®ç‰ˆæœ¬ï¼Œå¯ä»¥æ”¾åœ¨ xmake.lua ä»»ä½•åœ°æ–¹ï¼Œä¸€èˆ¬æ”¾åœ¨æœ€å¼€å¤´ï¼Œä¾‹å¦‚ï¼š ```lua set_version(\"1.5.1\") ``` æ”¯æŒ buildversion çš„é…ç½®ï¼š ```lua set_version(\"1.5.1\", {build \"%Y%m%d%H%M\"}) ``` æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿæ·»åŠ ç‰ˆæœ¬å®å®šä¹‰åˆ°å¤´æ–‡ä»¶ï¼Œè¯·å‚è€ƒï¼š[add_configfiles](/manual/project_target?id add template configuration files) > æˆ‘ä»¬å¯ä»¥å…¨å±€è®¾ç½®ç‰ˆæœ¬ï¼Œä½†ç°åœ¨æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ target åŸŸå»å•ç‹¬è®¾ç½®å®ƒã€‚ åŒæ—¶æ”¯æŒé…ç½® soname ç‰ˆæœ¬ï¼Œç”¨äºæ§åˆ¶ so/dylib åŠ¨æ€åº“çš„ç‰ˆæœ¬å…¼å®¹æ€§æ§åˆ¶ã€‚ æˆ‘ä»¬å¯ä»¥é…ç½® soname çš„ç‰ˆæœ¬åç¼€åç§°ï¼Œxmake ä¼šåœ¨ç¼–è¯‘ã€å®‰è£…åŠ¨æ€åº“çš„æ—¶å€™ï¼Œè‡ªåŠ¨ç”Ÿæˆç¬¦å·é“¾æ¥ï¼Œæ‰§è¡ŒæŒ‡å®šç‰ˆæœ¬çš„åŠ¨æ€åº“ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬é…ç½®ï¼š ```lua set_version(\"1.0.1\", {soname true}) ``` xmake ä¼šè‡ªåŠ¨è§£æç‰ˆæœ¬å·çš„ major ç‰ˆæœ¬ä½œä¸º soname ç‰ˆæœ¬ï¼Œç”Ÿæˆçš„ç»“æ„å¦‚ä¸‹ï¼š ``` â””â”€â”€ lib â”œâ”€â”€ libfoo.1.0.1.dylib â”œâ”€â”€ libfoo.1.dylib > libfoo.1.0.1.dylib â””â”€â”€ libfoo.dylib > libfoo.1.dylib ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®š soname åˆ°ç‰¹å®šçš„ç‰ˆæœ¬å‘½åï¼š ```lua set_version(\"1.0.1\", {soname \"1.0\"}) > libfoo.so.1.0, libfoo.1.0.dylib set_version(\"1.0.1\", {soname \"1\"}) > libfoo.so.1, libfoo.1.dylib set_version(\"1.0.1\", {soname \"A\"}) > libfoo.so.A, libfoo.A.dylib set_version(\"1.0.1\", {soname \"\"}) > libfoo.so, libfoo.dylib ``` è€Œå¦‚æœæ²¡è®¾ç½® sonameï¼Œé‚£ä¹ˆé»˜è®¤ä¸å¼€å¯ soname ç‰ˆæœ¬å…¼å®¹æ§åˆ¶ï¼š ```lua set_version(\"1.0.1\") > libfoo.so, libfoo.dylib ``` ### set_xmakever #### è®¾ç½®æœ€å° xmake ç‰ˆæœ¬ ç”¨äºå¤„ç† xmake ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ï¼Œå¦‚æœé¡¹ç›®çš„ `xmake.lua`ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£è®¾ç½®äº†æœ€å° xmake ç‰ˆæœ¬æ”¯æŒï¼Œé‚£ä¹ˆç”¨æˆ·ç¯å¢ƒè£…çš„ xmake ä½äºè¦æ±‚çš„ç‰ˆæœ¬ï¼Œå°±ä¼šæç¤ºé”™è¯¯ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå»ºè®®é»˜è®¤å¯¹å…¶è¿›è¡Œè®¾ç½®ï¼Œè¿™æ ·å¯¹ç”¨æˆ·æ¯”è¾ƒå‹å¥½ï¼Œå¦‚æœ `xmake.lua` ä¸­ç”¨åˆ°äº†é«˜ç‰ˆæœ¬çš„ api æ¥å£ï¼Œç”¨æˆ·é‚£è¾¹è‡³å°‘å¯ä»¥çŸ¥é“æ˜¯å¦å› ä¸ºç‰ˆæœ¬ä¸å¯¹å¯¼è‡´çš„æ„å»ºå¤±è´¥ã€‚ è®¾ç½®å¦‚ä¸‹ï¼š ```lua è®¾ç½®æœ€å°ç‰ˆæœ¬ä¸ºï¼š2.1.0ï¼Œä½äºæ­¤ç‰ˆæœ¬çš„ xmake ç¼–è¯‘æ­¤å·¥ç¨‹å°†ä¼šæç¤ºç‰ˆæœ¬é”™è¯¯ä¿¡æ¯ set_xmakever(\"2.1.0\") ``` ### add_moduledirs #### æ·»åŠ æ¨¡å—ç›®å½• xmake å†…ç½®çš„æ‰©å±•æ¨¡å—éƒ½åœ¨ `xmake/modules` ç›®å½•ä¸‹ï¼Œå¯é€šè¿‡ [import](#import) æ¥å¯¼å…¥ä»–ä»¬ï¼Œå¦‚æœè‡ªå·±åœ¨å·¥ç¨‹é‡Œé¢å®ç°äº†ä¸€äº›æ‰©å±•æ¨¡å—ï¼Œ å¯ä»¥æ”¾ç½®åœ¨è¿™ä¸ªæ¥å£æŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œimport ä¹Ÿå°±ä¼šèƒ½æ‰¾åˆ°ï¼Œå¹¶ä¸”ä¼˜å…ˆè¿›è¡Œå¯¼å…¥ã€‚ ### add_plugindirs #### æ·»åŠ æ’ä»¶ç›®å½• xmake å†…ç½®çš„æ’ä»¶éƒ½æ˜¯æ”¾åœ¨ `xmake/plugins` ç›®å½•ä¸‹ï¼Œä½†æ˜¯å¯¹äºç”¨æˆ·è‡ªå®šä¹‰çš„ä¸€äº›ç‰¹å®šå·¥ç¨‹çš„æ’ä»¶ï¼Œå¦‚æœä¸æƒ³æ”¾ç½®åœ¨ xmake å®‰è£…ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ `xmake.lua` ä¸­è¿›è¡Œé…ç½®æŒ‡å®šçš„å…¶ä»–æ’ä»¶è·¯å¾„ã€‚ ```lua å°†å½“å‰å·¥ç¨‹ä¸‹çš„ plugins ç›®å½•è®¾ç½®ä¸ºè‡ªå®šä¹‰æ’ä»¶ç›®å½• add_plugindirs(\"$(projectdir)/plugins\") ``` è¿™æ ·ï¼Œxmake åœ¨ç¼–è¯‘æ­¤å·¥ç¨‹çš„æ—¶å€™ï¼Œä¹Ÿå°±åŠ è½½è¿™äº›æ’ä»¶ã€‚ ### get_config #### è·å–ç»™å®šçš„é…ç½®å€¼ æ­¤æ¥å£ç”¨äºå¿«é€Ÿè·å–ç»™å®šçš„é…ç½®å€¼ï¼Œå¯ç”¨äºæè¿°åŸŸã€‚ ```lua if get_config(\"myconfig\") \"xxx\" then add_defines(\"HELLO\") end ``` ### set_config #### è®¾ç½®ç»™å®šçš„é»˜è®¤é…ç½®å€¼ æ­¤æ¥å£ä» 2.2.2 ç‰ˆæœ¬å¼€å§‹å¼•å…¥ï¼Œç”¨äºå¿«é€Ÿåœ¨ xmake.lua ä¸­è®¾ç½®ä¸€ä¸ªé»˜è®¤é…ç½®å€¼ï¼Œä»…ç”¨äºæè¿°åŸŸã€‚ ä¹‹å‰å¾ˆå¤šé…ç½®ï¼ŒåŒ…æ‹¬ç¼–è¯‘å·¥å…·é“¾ï¼Œæ„å»ºç›®å½•ç­‰åªèƒ½é€šè¿‡ `$ xmake f name value` çš„æ–¹å¼æ¥é…ç½®ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å†™æ­»åœ¨ xmake.lua æä¾›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå°±å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥é…ç½®ï¼š ```lua set_config(\"name\", \"value\") set_config(\"buildir\", \"other/buildir\") set_config(\"cc\", \"gcc\") set_config(\"ld\", \"g++\") ``` ä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡ `$ xmake f name value` çš„æ–¹å¼ï¼Œå»ä¿®æ”¹ xmake.lua ä¸­çš„é»˜è®¤é…ç½®ã€‚ ### add_requires #### æ·»åŠ éœ€è¦çš„ä¾èµ–åŒ… xmake çš„ä¾èµ–åŒ…ç®¡ç†æ˜¯å®Œå…¨æ”¯æŒè¯­ä¹‰ç‰ˆæœ¬é€‰æ‹©çš„ï¼Œä¾‹å¦‚ï¼š\"~1.6.1\"ï¼Œå¯¹äºè¯­ä¹‰ç‰ˆæœ¬çš„å…·ä½“æè¿°è§ï¼š[https://semver.org/](https://semver.org/) ##### è¯­ä¹‰ç‰ˆæœ¬ ```lua add_requires(\"tbox 1.6.*\", \"pcre 8.x\", \"libpng ^1.18\") add_requires(\"libpng ~1.16\", \"zlib 1.1.2 > 1.2.11 <1.3.0\") ``` ç›®å‰ xmake ä½¿ç”¨çš„è¯­ä¹‰ç‰ˆæœ¬è§£æå™¨æ˜¯ [uael](https://github.com/uael) è´¡çŒ®çš„ [sv](https://github.com/uael/sv) åº“ï¼Œé‡Œé¢ä¹Ÿæœ‰å¯¹ç‰ˆæœ¬æè¿°å†™æ³•çš„è¯¦ç»†è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒä¸‹ï¼š[ç‰ˆæœ¬æè¿°è¯´æ˜](https://github.com/uael/sv#versions) ##### æœ€è¿‘ç‰ˆæœ¬ å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬å¯¹å½“å‰çš„ä¾èµ–åŒ…çš„ç‰ˆæœ¬æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è¿™ä¹ˆå†™ï¼š ```lua add_requires(\"tbox\", \"libpng\", \"zlib\") ``` é»˜è®¤ï¼Œæ²¡è®¾ç½®ç‰ˆæœ¬å·ï¼Œxmake ä¼šé€‰å–æœ€è¿‘ç‰ˆæœ¬çš„åŒ…ï¼Œç­‰ä»·äº `add_requires(\"zlib latest\")` ##### åˆ†æ”¯é€‰æ‹© è¿™ä¼šä½¿ç”¨å·²çŸ¥çš„æœ€æ–°ç‰ˆæœ¬åŒ…ï¼Œæˆ–è€…æ˜¯ master åˆ†æ”¯çš„æºç ç¼–è¯‘çš„åŒ…ï¼Œå¦‚æœå½“å‰åŒ…æœ‰ git repo åœ°å€ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½æŒ‡å®šç‰¹å®šåˆ†æ”¯ç‰ˆæœ¬ï¼š ```lua add_requires(\"tbox master\") add_requires(\"tbox dev\") ``` å¦‚æœæŒ‡å®šçš„ä¾èµ–åŒ…å½“å‰å¹³å°ä¸æ”¯æŒï¼Œæˆ–è€…ç¼–è¯‘å®‰è£…å¤±è´¥äº†ï¼Œé‚£ä¹ˆ xmake ä¼šç¼–è¯‘æŠ¥é”™ï¼Œè¿™å¯¹äºæœ‰äº›å¿…é¡»è¦ä¾èµ–æŸäº›åŒ…æ‰èƒ½å·¥ä½œçš„é¡¹ç›®ï¼Œè¿™æ˜¯åˆç†çš„ã€‚ ä½†æ˜¯å¦‚æœæœ‰äº›åŒ…æ˜¯å¯é€‰çš„ä¾èµ–ï¼Œå³ä½¿æ²¡æœ‰ä¹Ÿå¯ä»¥æ­£å¸¸ç¼–è¯‘ä½¿ç”¨çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå¯é€‰åŒ…ï¼š ##### Git commit é€‰æ‹© æˆ‘ä»¬å¯ä»¥å¯¹ git ç»´æŠ¤çš„åŒ…ç›´æ¥æŒ‡å®š git commit æ¥é€‰æ‹©ç‰ˆæœ¬ã€‚ ```lua add_requires(\"tbox e807230557aac69e4d583c75626e3a7ebdb922f8\") ``` ##### å¯é€‰åŒ… ```lua add_requires(\"zlib\", {optional true}) ``` ##### ç¦ç”¨ç³»ç»ŸåŒ… é»˜è®¤çš„è®¾ç½®ï¼Œxmake ä¼šå»ä¼˜å…ˆæ£€æµ‹ç³»ç»Ÿåº“æ˜¯å¦å­˜åœ¨ï¼ˆå¦‚æœæ²¡è®¾ç½®ç‰ˆæœ¬è¦æ±‚ï¼‰ï¼Œå¦‚æœç”¨æˆ·å®Œå…¨ä¸æƒ³ä½¿ç”¨ç³»ç»Ÿåº“ä»¥åŠç¬¬ä¸‰æ–¹åŒ…ç®¡ç†æä¾›çš„åº“ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®ï¼š ```lua add_requires(\"zlib\", {system false}) ``` ##### ç¦ç”¨åŒ…æ ¡éªŒ é»˜è®¤åŒ…å®‰è£…ï¼Œå¯¹äºä¸‹è½½çš„åŒ…éƒ½æ˜¯ä¼šå»è‡ªåŠ¨æ ¡éªŒå®Œæ•´æ€§ï¼Œé¿å…è¢«ç¯¡æ”¹ï¼Œä½†æ˜¯å¦‚æœå®‰è£…ä¸€äº›æœªçŸ¥æ–°ç‰ˆæœ¬çš„åŒ…ï¼Œå°±ä¸è¡Œäº†ã€‚ ç”¨æˆ·å¯ä»¥é€šè¿‡ `{verify false}` å¼ºè¡Œç¦ç”¨åŒ…å®Œæ•´æ€§æ ¡éªŒæ¥ä¸´æ—¶å®‰è£…ä»–ä»¬ï¼ˆä½†é€šå¸¸ä¸æ¨èè¿™ä¹ˆåšï¼‰ã€‚ ```lua add_requires(\"zlib\", {verify false}) ``` ##### ä½¿ç”¨è°ƒè¯•åŒ… å¦‚æœæˆ‘ä»¬æƒ³åŒæ—¶æºç è°ƒè¯•ä¾èµ–åŒ…ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®ä¸ºä½¿ç”¨ debug ç‰ˆæœ¬çš„åŒ…ï¼ˆå½“ç„¶å‰ææ˜¯è¿™ä¸ªåŒ…æ”¯æŒ debug ç¼–è¯‘ï¼‰ï¼š ```lua add_requires(\"zlib\", {debug true}) ``` å¦‚æœå½“å‰åŒ…è¿˜ä¸æ”¯æŒ debug ç¼–è¯‘ï¼Œå¯åœ¨ä»“åº“ä¸­æäº¤ä¿®æ”¹ç¼–è¯‘è§„åˆ™ï¼Œå¯¹ debug è¿›è¡Œæ”¯æŒï¼Œä¾‹å¦‚ï¼š ```lua package(\"openssl\", function() on_install(\"linux\", \"macosx\", function (package) os.vrun(\"./config %s prefix \\\"%s\\\"\", package:debug() and\" debug\"or\"\", package:installdir()) os.vrun(\"make j4\") os.vrun(\"make install\") end) end) ``` ##### ä½œä¸ºç§æœ‰åŒ…ä½¿ç”¨ å¦‚æœè¿™ä¸ªåŒ…ï¼Œæˆ‘ä»¬ä»…ä»…ç”¨äºåŒ…å®šä¹‰ï¼Œä¸æƒ³å¯¹å¤–é»˜è®¤å¯¼å‡º links/linkdirs ä¿¡æ¯ï¼Œå¯ä»¥ä½œä¸ºç§æœ‰åŒ…æä¾›ã€‚ è¿™é€šå¸¸å¯¹äºåšåŒ…æ—¶å€™ï¼Œå¾ˆæœ‰ç”¨ã€‚ ```lua package(\"test\") add_deps(\"zlib\", {private true}) on_install(function (package) local zlib package:dep(\"zlib\"):fetch() TODO end) ``` å¦‚æœè‡ªå·±å®šä¹‰çš„ä¸€ä¸ª test åŒ…ï¼Œç§æœ‰ä¾èµ–ä¸€ä¸ª zlib åŒ…ï¼Œç­‰å¾… zlib å®‰è£…å®Œæˆåï¼Œè·å–é‡Œé¢çš„åŒ…æ–‡ä»¶ä¿¡æ¯åšè¿›ä¸€æ­¥å¤„ç†å®‰è£…ï¼Œä½†æ˜¯ zlib åŒ…æœ¬èº«ä¸ä¼šå†å¯¹å¤–å¯¼å‡º links/linkdirsã€‚ å°½ç®¡ï¼Œ`add_requires` ä¹Ÿæ”¯æŒè¿™ä¸ªé€‰é¡¹ï¼Œä½†æ˜¯ä¸å¯¹å¤–å¯¼å‡º links/linkdirsï¼Œæ‰€ä»¥é€šå¸¸ä¸ä¼šå»è¿™ä¹ˆç”¨ï¼Œä»…ä»…å¯¹äºåšåŒ…å¾ˆæœ‰å¸®åŠ©ã€‚ ##### ä½¿ç”¨åŠ¨æ€åº“ é»˜è®¤çš„åŒ…å®‰è£…çš„æ˜¯é™æ€åº“ï¼Œå¦‚æœè¦å¯ç”¨åŠ¨æ€åº“ï¼Œå¯ä»¥é…ç½®å¦‚ä¸‹ï¼š ```lua add_requires(\"zlib\", {configs {shared true}}) ``` > å½“ç„¶ï¼Œå‰ææ˜¯è¿™ä¸ªåŒ…çš„å®šä¹‰é‡Œé¢ï¼Œæœ‰å¯¹ `package:config(\"shared\")` åˆ¤æ–­å¤„ç†ï¼Œå®˜æ–¹ xmake repo ä»“åº“é‡Œé¢ï¼Œé€šå¸¸éƒ½æ˜¯ä¸¥æ ¼åŒºåˆ†æ”¯æŒçš„ã€‚ ##### ç¦ç”¨ pic æ”¯æŒ é»˜è®¤å®‰è£…çš„ linux åŒ…ï¼Œéƒ½æ˜¯å¼€å¯ pic ç¼–è¯‘çš„ï¼Œè¿™å¯¹äºåŠ¨æ€åº“ä¸­ä¾èµ–é™æ€åº“éå¸¸æœ‰ç”¨ï¼Œä½†å¦‚æœæƒ³ç¦ç”¨ picï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ ```lua add_requires(\"zlib\", {configs {pic false}}) ``` ##### ç‰¹å®šé…ç½®åŒ… æŸäº›åŒ…åœ¨ç¼–è¯‘æ—¶å€™æœ‰å„ç§ç¼–è¯‘é€‰é¡¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¼ é€’è¿›æ¥ï¼š ```lua add_requires(\"boost\", {configs {context true, coroutine true}}) ``` æ¯”å¦‚ä¸Šé¢ï¼Œå®‰è£…çš„ boost åŒ…ï¼Œæ˜¯å¯ç”¨äº†å®ƒå†…éƒ¨çš„ä¸€äº›å­æ¨¡å—ç‰¹æ€§ï¼ˆå¸¦æœ‰åç¨‹æ¨¡å—æ”¯æŒçš„åŒ…ï¼‰ã€‚ å½“ç„¶ï¼Œå…·ä½“æ”¯æŒå“ªäº›é…ç½®ï¼Œæ¯ä¸ªåŒ…éƒ½æ˜¯ä¸åŒçš„ï¼Œå¯ä»¥é€šè¿‡ `xmake require info boost` å‘½ä»¤æŸ¥çœ‹é‡Œé¢çš„ configs éƒ¨åˆ†åˆ—è¡¨ã€‚ å› ä¸ºï¼Œæ¯ä¸ªåŒ…å®šä¹‰é‡Œé¢ï¼Œéƒ½ä¼šæœ‰è‡ªå·±çš„é…ç½®é€‰é¡¹ï¼Œå¹¶ä¸”é€šè¿‡ `package:config(\"coroutine\")` åœ¨å®‰è£…æ—¶å€™å»åˆ¤æ–­å¯ç”¨å®ƒä»¬ã€‚ ##### å®‰è£…ç¬¬ä¸‰æ–¹ç®¡ç†å™¨çš„åŒ… ç›®å‰æ”¯æŒå®‰è£…ä¸‹é¢è¿™äº›ç¬¬ä¸‰æ–¹åŒ…ç®¡ç†å™¨ä¸­åŒ…ã€‚ * Conan (conan::openssl/1.1.1g) * Conda (conda::libpng 1.3.67) * Vcpkg (vcpkg::ffmpeg) * Homebrew/Linuxbrew (brew::pcre2/libpcre2 8) * Pacman on archlinux/msys2 (pacman::libcurl) * Apt on ubuntu/debian (apt::zlib1g dev) * Clib (clib::clibs/bytes@0.0.4) * Dub (dub::log 0.4.3) * Portage on Gentoo/Linux (portage::libhandy) ä¾‹å¦‚æ·»åŠ  conan çš„ä¾èµ–åŒ…ï¼š ```lua add_requires(\"conan::zlib/1.2.11\", {alias \"zlib\", debug true}) add_requires(\"conan::openssl/1.1.1g\", {alias \"openssl\", configs {options \"OpenSSL:shared True\"}}) target(\"test\") set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"openssl\", \"zlib\") ``` æ‰§è¡Œ xmake è¿›è¡Œç¼–è¯‘åï¼š ```console ruki:test_package ruki$ xmake checking for the architecture ... x86_64 checking for the Xcode directory ... /Applications/Xcode.app checking for the SDK version of Xcode ... 10.14 note: try installing these packages (pass y to skip confirm)? > conan::zlib/1.2.11 (debug) > conan::openssl/1.1.1g please input: y (y/n) > installing conan::zlib/1.2.11 .. ok > installing conan::openssl/1.1.1g .. ok [0%]: cache compiling.release src/main.c [100%]: linking.release test ``` å…³äºè¿™ä¸ªçš„å®Œæ•´ä»‹ç»å’Œæ‰€æœ‰ç¬¬ä¸‰æ–¹åŒ…çš„å®‰è£…ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒæ–‡æ¡£ï¼š[ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…å®‰è£…](https://xmake.io/#/zh cn/package/remote_package?id %e7%ac%ac%e4%b8%89%e6%96%b9%e4%be%9d%e8%b5%96%e5%8c%85%e5%ae%89%e8%a3%85) ##### å¦ä¸€ç§ç®€åŒ–çš„é…ç½®è¯­æ³• æˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„å¸¸ç”¨é…ç½®è¯­æ³•ï¼š ```lua add_requires(\"boost> 1.78.0\", {configs {iostreams true, system true, thread true}}) ``` å¯¹äºå¤§éƒ¨åˆ† boolean é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å†™æ³•ï¼Œå»ç®€åŒ–é…ç½®ã€‚ ```lua add_requires(\"boost[iostreams,system,thread] > 1.78.0\") ``` è¿™å¯¹äº `xrepo install` ç‹¬ç«‹ cli å‘½ä»¤ä¸‹å¸¦å¤æ‚é…ç½®çš„å®‰è£…ï¼Œä¼šçœäº‹ä¸å°‘ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½éœ€æ±‚ï¼Œé€‰æ‹©ä½¿ç”¨ã€‚ ```console xrepo install boost[iostreams,system,thread] ``` å¦å¤–ï¼Œé™¤äº† boolean é…ç½®ï¼Œè¿˜æ”¯æŒ string å’Œ array é…ç½®å€¼ã€‚boolean å€¼ï¼Œä¹Ÿå¯ä»¥è®¾ç½® ` n/y` å»ç¦ç”¨å’Œå¯ç”¨ã€‚ ```lua add_requires(\"boost[iostreams,system,thread,key value] > 1.78.0\") add_requires(\"boost[iostreams y,thread n] > 1.78.0\") add_requires(\"ffmpeg[shared,debug,codecs [foo,bar,zoo]]\") ``` ### add_requireconfs #### è®¾ç½®æŒ‡å®šä¾èµ–åŒ…çš„é…ç½® æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªæ¥å£æ¥å¯¹ `add_requires()` å®šä¹‰çš„åŒ…å’Œå®ƒçš„ä¾èµ–åŒ…çš„é…ç½®è¿›è¡Œæ‰©å……å’Œæ”¹å†™ï¼Œå®ƒæœ‰ä¸‹é¢å‡ ç§ç”¨æ³•ã€‚ ##### æ‰©å……æŒ‡å®šåŒ…çš„é…ç½® è¿™æ˜¯åŸºæœ¬ç”¨æ³•ï¼Œæ¯”å¦‚æˆ‘ä»¬å·²ç»é€šè¿‡ `add_requires(\"zlib\")` å£°æ˜äº†ä¸€ä¸ªåŒ…ï¼Œæƒ³è¦åœ¨åé¢å¯¹è¿™ä¸ª zlib çš„é…ç½®è¿›è¡Œæ‰©å±•ï¼Œæ”¹æˆåŠ¨æ€åº“ç¼–è¯‘ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼é…ç½®ã€‚ ```lua add_requires(\"zlib\") add_requireconfs(\"zlib\", {configs {shared true}}) ``` å®ƒç­‰ä»·äº ```lua add_requires(\"zlib\", {configs {shared true}}) ``` ##### è®¾ç½®é€šç”¨çš„é»˜è®¤é…ç½® ä¸Šé¢çš„ç”¨æ³•ï¼Œæˆ‘ä»¬è¿˜çœ‹ä¸å‡ºæœ‰ä»€ä¹ˆå®é™…ç”¨å¤„ï¼Œä½†å¦‚æœä¾èµ–å¤šäº†å°±èƒ½çœ‹å‡ºæ•ˆæœäº†ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š ```lua add_requires(\"zlib\", {configs {shared true}}) add_requires(\"pcre\", {configs {shared true}}) add_requires(\"libpng\", {configs {shared true}}) add_requires(\"libwebp\", {configs {shared true}}) add_requires(\"libcurl\", {configs {shared false}}) ``` æ˜¯ä¸æ˜¯éå¸¸ç¹çï¼Œå¦‚æœæˆ‘ä»¬ç”¨ä¸Š `add_requireconfs` æ¥è®¾ç½®é»˜è®¤é…ç½®ï¼Œå°±å¯ä»¥æå¤§çš„ç®€åŒ–æˆä¸‹é¢çš„é…ç½®ï¼š ```lua add_requireconfs(\"*\", {configs {shared true}}) add_requires(\"zlib\") add_requires(\"pcre\") add_requires(\"libpng\") add_requires(\"libwebp\") add_requires(\"libcurl\", {configs {shared false}}) ``` ä¸Šé¢çš„é…ç½®ï¼Œæˆ‘ä»¬é€šè¿‡ `add_requireconfs(\"*\", {configs {shared true}})` ä½¿ç”¨æ¨¡å¼åŒ¹é…çš„æ–¹å¼ï¼Œè®¾ç½®æ‰€æœ‰çš„ä¾èµ–åŒ…é»˜è®¤èµ°åŠ¨æ€åº“ç¼–è¯‘å®‰è£…ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬åˆé€šè¿‡ `add_requires(\"libcurl\", {configs {shared false}})` å°† libcurl è¿›è¡Œäº†ç‰¹æ®Šé…ç½®ï¼Œå¼ºåˆ¶èµ°é™æ€åº“ç¼–è¯‘å®‰è£…ã€‚ æœ€ç»ˆçš„é…ç½®ç»“æœä¸ºï¼šzlib/pcre/libpng/libwebp æ˜¯ shared åº“ï¼Œlibcurl æ˜¯é™æ€åº“ã€‚ æˆ‘ä»¬é€šè¿‡æ¨¡å¼åŒ¹é…çš„æ–¹å¼ï¼Œå¯ä»¥å°†ä¸€äº›æ¯ä¸ªåŒ…çš„å¸¸ç”¨é…ç½®éƒ½æ”¾ç½®åˆ°ç»Ÿä¸€çš„ `add_requireconfs` ä¸­å»é¢„å…ˆé…ç½®å¥½ï¼Œæå¤§ç®€åŒ–æ¯ä¸ª `add_requires` çš„å®šä¹‰ã€‚ > é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºç›¸åŒçš„é…ç½®ï¼Œxmake ä¼šä¼˜å…ˆä½¿ç”¨ add_requires ä¸­çš„é…ç½®ï¼Œè€Œä¸æ˜¯ add_requireconfsã€‚ å¦‚æœ `add_requires(\"zlib 1.2.11\")` ä¸­è®¾ç½®äº†ç‰ˆæœ¬ï¼Œå°±ä¼šä¼˜å…ˆä½¿ç”¨ add_requires çš„é…ç½®ï¼Œå®Œå…¨å¿½ç•¥ add_requireconfs é‡Œé¢çš„ç‰ˆæœ¬é…ç½®ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ override æ¥å®Œå…¨é‡å†™ `add_requires` ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ã€‚ ```lua add_requires(\"zlib 1.2.11\") add_requireconfs(\"zlib\", {override true, version \"1.2.10\"}) ``` ##### æ”¹å†™åŒ…ä¾èµ–é…ç½® å…¶å® `add_requireconfs` æœ€å¤§çš„ç”¨å¤„æ˜¯å¯ä»¥è®©ç”¨æˆ·æ”¹å†™å®‰è£…åŒ…çš„ç‰¹å®šä¾èµ–åŒ…çš„é…ç½®ã€‚ ä»€ä¹ˆæ„æ€å‘¢ï¼Œæ¯”å¦‚æˆ‘ä»¬é¡¹ç›®ä¸­é›†æˆä½¿ç”¨ libpng è¿™ä¸ªåŒ…ï¼Œå¹¶ä¸”ä½¿ç”¨äº†åŠ¨æ€åº“ç‰ˆæœ¬ï¼Œä½†æ˜¯ libpng å†…éƒ¨ä¾èµ–çš„ zlib åº“å…¶å®è¿˜æ˜¯é™æ€åº“ç‰ˆæœ¬ã€‚ ```lua add_requires(\"libpng\", {configs {shared true}}) ``` é‚£å¦‚æœæˆ‘ä»¬æƒ³è®© libpng ä¾èµ–çš„ zlib åŒ…ä¹Ÿæ”¹æˆåŠ¨æ€åº“ç¼–è¯‘ï¼Œåº”è¯¥æ€ä¹ˆé…ç½®å‘¢ï¼Ÿè¿™å°±éœ€è¦ `add_requireconfs` äº†ã€‚ ```lua add_requires(\"libpng\", {configs {shared true}}) add_requireconfs(\"libpng.zlib\", {configs {shared true}}) ``` é€šè¿‡ `libpng.zlib` ä¾èµ–è·¯å¾„çš„å†™æ³•ï¼ŒæŒ‡å®šå†…éƒ¨æŸä¸ªä¾èµ–ï¼Œæ”¹å†™å†…éƒ¨ä¾èµ–é…ç½®ã€‚ å¦‚æœä¾èµ–è·¯å¾„å¾ˆæ·±ï¼Œæ¯”å¦‚ `foo > bar > xyz` çš„ä¾èµ–é“¾ï¼Œæˆ‘ä»¬å¯ä»¥å†™æˆï¼š`foo.bar.xyz` æˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¹å†™ libpng ä¾èµ–çš„å†…éƒ¨ zlib åº“ç‰ˆæœ¬ï¼š ```lua add_requires(\"libpng\") add_requireconfs(\"libpng.zlib\", {override true, version \"1.2.10\"}) ``` ##### çº§è”ä¾èµ–çš„æ¨¡å¼åŒ¹é… å¦‚æœä¸€ä¸ªåŒ…çš„ä¾èµ–éå¸¸å¤šï¼Œä¸”ä¾èµ–å±‚æ¬¡ä¹Ÿå¾ˆæ·±ï¼Œæ€ä¹ˆåŠå‘¢ï¼Œæ¯”å¦‚ libwebp è¿™ä¸ªåŒ…ï¼Œå®ƒçš„ä¾èµ–æœ‰ï¼š ``` libwebp libpng zlib cmake libjpeg libtiff zlib giflib cmake ``` å¦‚æœæˆ‘æƒ³æ”¹å†™ libwebp é‡Œé¢çš„æ‰€æœ‰çš„ä¾èµ–åº“éƒ½åŠ ä¸Šç‰¹å®šé…ç½®ï¼Œé‚£ä¹ˆæŒ¨ä¸ªé…ç½®ï¼Œå°±ä¼šéå¸¸ç¹çï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ `add_requireconfs()` çš„é€’å½’ä¾èµ–æ¨¡å¼åŒ¹é…æ¥æ”¯æŒäº†ã€‚ ```lua add_requires(\"libwebp\") add_requireconfs(\"libwebp.**cmake\", {configs {cxflags \" DTEST\"}}) ``` ä¸Šé¢çš„é…ç½®ï¼Œæˆ‘ä»¬å°† libwebp ä¸­æ‰€ä»¥çš„åº“ä¾èµ–å°±é¢å¤–åŠ ä¸Šäº† ` DTEST` æ¥ç¼–è¯‘ï¼Œä½†æ˜¯ cmake ä¾èµ–å±äºæ„å»ºå·¥å…·ä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `xxx` çš„æ–¹å¼æ’é™¤å®ƒã€‚ è¿™é‡Œçš„æ¨¡å¼åŒ¹é…å†™æ³•ï¼Œä¸ `add_files()` éå¸¸ç±»ä¼¼ã€‚ æˆ‘ä»¬åœ¨ç»™å‡ ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è¿™å›æˆ‘ä»¬åªæ”¹å†™ libwebp ä¸‹å•çº§çš„ä¾èµ–é…ç½®ï¼Œå¯ç”¨è°ƒè¯•åº“ï¼š ```lua add_requires(\"libwebp\") add_requireconfs(\"libwebp.*cmake\", {debug true}) ``` ### add_repositories #### æ·»åŠ ä¾èµ–åŒ…ä»“åº“ å¦‚æœéœ€è¦çš„åŒ…ä¸åœ¨å®˜æ–¹ä»“åº“ [xmake repo](https://github.com/xmake io/xmake repo) ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æäº¤è´¡çŒ®ä»£ç åˆ°ä»“åº“è¿›è¡Œæ”¯æŒã€‚ ä½†å¦‚æœæœ‰äº›åŒ…ä»…ç”¨äºä¸ªäººæˆ–è€…ç§æœ‰é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªç§æœ‰ä»“åº“ repoï¼Œä»“åº“ç»„ç»‡ç»“æ„å¯å‚è€ƒï¼š[xmake repo](https://github.com/xmake io/xmake repo) æ¯”å¦‚ï¼Œç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸€ä¸ªç§æœ‰ä»“åº“ repoï¼š`git@github.com:myrepo/xmake repo.git` æˆ‘ä»¬å¯ä»¥é€šè¿‡æ­¤æ¥å£æ¥æ·»åŠ ï¼š ```lua add_repositories(\"my repo git@github.com:myrepo/xmake repo.git\") ``` å¦‚æœæˆ‘ä»¬åªæ˜¯æƒ³æ·»åŠ ä¸€ä¸¤ä¸ªç§æœ‰åŒ…ï¼Œè¿™ä¸ªæ—¶å€™ç‰¹å®šå»å»ºç«‹ä¸€ä¸ª git repo å¤ªå°é¢˜å¤§åšäº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠåŒ…ä»“åº“æ”¾ç½®é¡¹ç›®é‡Œé¢ï¼Œä¾‹å¦‚ï¼š ``` projectdir myrepo packages t/tbox/xmake.lua z/zlib/xmake.lua src main.c xmake.lua ``` ä¸Šé¢ myrepo ç›®å½•å°±æ˜¯è‡ªå·±çš„ç§æœ‰åŒ…ä»“åº“ï¼Œå†…ç½®åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé¢ï¼Œç„¶ååœ¨ xmake.lua é‡Œé¢æ·»åŠ ä¸€ä¸‹è¿™ä¸ªä»“åº“ä½ç½®ï¼š ```lua add_repositories(\"my repo myrepo\") ``` è¿™ä¸ªå¯ä»¥å‚è€ƒ [benchbox](https://github.com/tboox/benchbox) é¡¹ç›®ï¼Œé‡Œé¢å°±å†…ç½®äº†ä¸€ä¸ªç§æœ‰ä»“åº“ã€‚ æ³¨ï¼šå…¶ä¸­ myrepo æ˜¯ xmake å‘½ä»¤æ‰§è¡Œç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨æ ¹æ®é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•è‡ªåŠ¨è½¬æ¢ï¼Œå¦‚æœæƒ³è¦è®¾ç½®åˆ°ç›¸å¯¹äºå½“å‰ xmake.lua æ–‡ä»¶çš„è·¯å¾„ï¼Œå¯ä»¥é€šè¿‡ rootdir å‚æ•°æŒ‡å®šã€‚ ```lua add_repositories(\"my repo myrepo\", {rootdir os.scriptdir()}) ``` ä¸è¿‡è¿™ä¸ªå‚æ•°è®¾ç½®åªæœ‰ v2.5.7 ä»¥ä¸Šç‰ˆæœ¬æ‰æ”¯æŒã€‚ ### set_defaultplat #### è®¾ç½®é»˜è®¤çš„ç¼–è¯‘å¹³å° ç”¨äºè®¾ç½®å·¥ç¨‹é»˜è®¤çš„ç¼–è¯‘å¹³å°ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤å¹³å°è·Ÿéšå½“å‰ç³»ç»Ÿå¹³å°ï¼Œä¹Ÿå°±æ˜¯ os.host()ã€‚ æ¯”å¦‚ï¼Œåœ¨ macOS ä¸Šé»˜è®¤ç¼–è¯‘å¹³å°æ˜¯ macosxï¼Œå¦‚æœå½“å‰é¡¹ç›®æ˜¯ ios é¡¹ç›®ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®é»˜è®¤ç¼–è¯‘å¹³å°ä¸º iphoneosã€‚ ```lua set_defaultplat(\"iphoneos\") ``` å®ƒç­‰ä»·äºï¼Œ`xmake f p iphoneos`ã€‚ ### set_defaultarchs #### è®¾ç½®é»˜è®¤çš„ç¼–è¯‘æ¶æ„ ç”¨äºè®¾ç½®å·¥ç¨‹é»˜è®¤çš„ç¼–è¯‘æ¶æ„ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤å¹³å°è·Ÿéšå½“å‰ç³»ç»Ÿæ¶æ„ï¼Œä¹Ÿå°±æ˜¯ os.arch()ã€‚ ```lua set_defaultplat(\"iphoneos\") set_defaultarchs(\"arm64\") ``` å®ƒç­‰ä»·äºï¼Œ`xmake f p iphoneos a arm64`ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®å¤šä¸ªå¹³å°ä¸‹çš„é»˜è®¤æ¶æ„ã€‚ ```lua set_defaultarchs(\"iphoneosarm64\", \"windowsx64\") ``` åœ¨ iphoneos ä¸Šé»˜è®¤ç¼–è¯‘ arm64 æ¶æ„ï¼Œåœ¨ windows ä¸Šé»˜è®¤ç¼–è¯‘ x64 æ¶æ„ã€‚ ### set_defaultmode #### è®¾ç½®é»˜è®¤çš„ç¼–è¯‘æ¨¡å¼ ç”¨äºè®¾ç½®å·¥ç¨‹é»˜è®¤çš„ç¼–è¯‘æ¨¡å¼ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤æ˜¯ release æ¨¡å¼ç¼–è¯‘ã€‚ ```lua set_defaultmode(\"releasedbg\") ``` å®ƒç­‰ä»·äºï¼Œ`xmake f m releasedbg`ã€‚ ### set_allowedplats #### è®¾ç½®å…è®¸ç¼–è¯‘çš„å¹³å°åˆ—è¡¨ ç”¨äºè®¾ç½®å·¥ç¨‹æ”¯æŒçš„ç¼–è¯‘å¹³å°åˆ—è¡¨ï¼Œå¦‚æœç”¨æˆ·æŒ‡å®šäº†å…¶ä»–å¹³å°ï¼Œä¼šæç¤ºé”™è¯¯ï¼Œè¿™é€šå¸¸ç”¨äºé™åˆ¶ç”¨æˆ·æŒ‡å®šé”™è¯¯çš„æ— æ•ˆå¹³å°ã€‚ å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆæ²¡æœ‰ä»»ä½•å¹³å°é™åˆ¶ã€‚ ```lua set_allowedplats(\"windows\", \"mingw\") ``` è®¾ç½®å½“å‰é¡¹ç›®ä»…ä»…æ”¯æŒ windows å’Œ mingw å¹³å°ã€‚ ### set_allowedarchs #### è®¾ç½®å…è®¸ç¼–è¯‘çš„å¹³å°æ¶æ„ ç”¨äºè®¾ç½®å·¥ç¨‹æ”¯æŒçš„ç¼–è¯‘æ¶æ„åˆ—è¡¨ï¼Œå¦‚æœç”¨æˆ·æŒ‡å®šäº†å…¶ä»–æ¶æ„ï¼Œä¼šæç¤ºé”™è¯¯ï¼Œè¿™é€šå¸¸ç”¨äºé™åˆ¶ç”¨æˆ·æŒ‡å®šé”™è¯¯çš„æ— æ•ˆæ¶æ„ã€‚ å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆæ²¡æœ‰ä»»ä½•æ¶æ„é™åˆ¶ã€‚ ```lua set_allowedarchs(\"x64\", \"x86\") ``` å½“å‰é¡¹ç›®ï¼Œä»…ä»…æ”¯æŒ x64/x86 å¹³å°ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªå¹³å°ä¸‹å…è®¸çš„æ¶æ„åˆ—è¡¨ã€‚ ```lua set_allowedarchs(\"windowsx64\", \"iphoneosarm64\") ``` è®¾ç½®å½“å‰é¡¹ç›®åœ¨ windows ä¸Šä»…ä»…æ”¯æŒ x64 æ¶æ„ï¼Œå¹¶ä¸”åœ¨ iphoneos ä¸Šä»…ä»…æ”¯æŒ arm64 æ¶æ„ã€‚ ### set_allowedmodes #### è®¾ç½®å…è®¸çš„ç¼–è¯‘æ¨¡å¼åˆ—è¡¨ ç”¨äºè®¾ç½®å·¥ç¨‹æ”¯æŒçš„ç¼–è¯‘æ¨¡å¼åˆ—è¡¨ï¼Œå¦‚æœç”¨æˆ·æŒ‡å®šäº†å…¶ä»–æ¨¡å¼ï¼Œä¼šæç¤ºé”™è¯¯ï¼Œè¿™é€šå¸¸ç”¨äºé™åˆ¶ç”¨æˆ·æŒ‡å®šé”™è¯¯çš„æ— æ•ˆæ¨¡å¼ã€‚ å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆæ²¡æœ‰ä»»ä½•æ¨¡å¼é™åˆ¶ã€‚ ```lua set_allowedmodes(\"release\", \"releasedbg\") ``` è®¾ç½®å½“å‰é¡¹ç›®ä»…ä»…æ”¯æŒ release/releasedbg ä¸¤ä¸ªç¼–è¯‘æ¨¡å¼ã€‚ ## è¾…åŠ©æ¥å£ ### è‡ªåŠ¨æ£€æµ‹è¾…åŠ©æ¥å£ xmake æä¾›äº†ä¸€äº›å†…ç½®çš„è¾…åŠ©å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ includes å¯¼å…¥ï¼Œå…·ä½“æœ‰å“ªäº›å†…ç½®å‡½æ•°å¯ä»¥çœ‹ä¸‹ï¼š[Helper functions](https://github.com/xmake io/xmake/tree/master/xmake/includes) æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›æ¥å£ï¼Œæ£€æµ‹ links, c/c++ type, includes å’Œ ç¼–è¯‘å™¨ç‰¹æ€§ï¼Œå¹¶ä¸”å†™å…¥å®å®šä¹‰åˆ° config.h å…¶ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†ä¸¤ç±»æ¥å£ï¼Œ`check_xxx` å’Œ `configvar_check_xxx`ï¼Œå¸¦æœ‰ `configvar_` å‰ç¼€çš„æ¥å£ä¼šåœ¨æ£€æµ‹é€šè¿‡åï¼Œå†™å…¥ `add_configfiles` æŒ‡å®šçš„ config.h.in æ¨¡æ¿æ–‡ä»¶ã€‚ è€Œ `check_xxx` ä»…ä»…åªæ˜¯å®šä¹‰ç›¸å…³ macros å‚ä¸ç¼–è¯‘ï¼Œä½†ä¸ä¼šæŒä¹…åŒ–åˆ° `config.h.in` ä¸­å»ã€‚ ç›¸å…³ issues è§ï¼š * [#342](https://github.com/xmake io/xmake/issues/342) * [#1715](https://github.com/xmake io/xmake/issues/1715) æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§å¼•å…¥æ‰€æœ‰æ£€æµ‹æ¥å£ï¼š ```lua includes(\"@builtin/check\") ``` å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‰éœ€å¼•å…¥å•ä¸ªè„šæœ¬ï¼š ```lua includes(\"@builtin/check/check_links.lua\") ``` è€ŒåŸæœ‰çš„å¼•å…¥è·¯å¾„ï¼Œæ²¡æœ‰åŒºåˆ†æ˜¯å¦ä¸ºç”¨æˆ·è·¯å¾„ï¼Œä¸æ–¹ä¾¿ç®¡ç†ç»´æŠ¤ï¼Œä¸”å®¹æ˜“è¢«ç”¨æˆ·é…ç½®å¹²æ‰°ï¼Œåé¢ä¼šé€æ­¥åºŸå¼ƒã€‚ #### æ£€æµ‹ links æˆ‘ä»¬å¯ä»¥é€šè¿‡å°è¯•é“¾æ¥æ¥æ£€æµ‹æŒ‡å®šçš„ links æ˜¯å¦é€šè¿‡ã€‚ ```lua includes(\"check_links.lua\") target(\"test\", function() set_kind(\"binary\") add_files(\"*.c\") add_configfiles(\"config.h.in\") configvar_check_links(\"HAS_PTHREAD\", {\"pthread\", \"m\", \"dl\"}) end) ``` config.h.in ```c ${define HAS_PTHREAD} ``` config.h ```c #define HAS_PTHREAD 1 /* #undef HAS_PTHREAD */ ``` #### æ£€æµ‹ c/c++ ç±»å‹ æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿæ£€æµ‹ c/c++ ç±»å‹æ˜¯å¦å­˜åœ¨ã€‚ `configvar_check_ctypes` ç”¨äºæ£€æµ‹ c ä»£ç ç±»å‹ï¼Œ`configvar_check_cxxtypes` ç”¨äºæ£€æµ‹ c++ ä»£ç ç±»å‹ã€‚ ```lua includes(\"check_ctypes.lua\") target(\"test\", function() set_kind(\"binary\") add_files(\"*.c\") add_configfiles(\"config.h.in\") configvar_check_ctypes(\"HAS_WCHAR\", \"wchar_t\") configvar_check_ctypes(\"HAS_WCHAR_AND_FLOAT\", {\"wchar_t\", \"float\"}) end) ``` config.h.in ```c ${define HAS_WCHAR} ${define HAS_WCHAR_AND_FLOAT} ``` config.h ```c /* #undef HAS_WCHAR */ /* #undef HAS_WCHAR_AND_FLOAT */ ``` #### æ£€æµ‹ c/c++ å‡½æ•° `configvar_check_cfuncs` ç”¨äºæ£€æµ‹ c ä»£ç å‡½æ•°ï¼Œ`configvar_check_cxxfuncs` ç”¨äºæ£€æµ‹ c++ ä»£ç å‡½æ•°ã€‚ ```lua includes(\"check_cfuncs.lua\") target(\"test\", function() set_kind(\"binary\") add_files(\"*.c\") add_configfiles(\"config.h.in\") configvar_check_cfuncs(\"HAS_SETJMP\", \"setjmp\", {includes {\"signal.h\", \"setjmp.h\"}}) end) ``` config.h.in ```c ${define HAS_SETJMP} ``` config.h ```c #define HAS_SETJMP 1 /* #undef HAS_SETJMP */ ``` #### æ£€æµ‹ c/c++ å¤´æ–‡ä»¶ `configvar_check_cincludes` ç”¨äºæ£€æµ‹ c ä»£ç å¤´æ–‡ä»¶ï¼Œ`configvar_check_cxxincludes` ç”¨äºæ£€æµ‹ c++ ä»£ç å¤´æ–‡ä»¶ã€‚ ```lua includes(\"check_cincludes.lua\") target(\"test\", function() set_kind(\"binary\") add_files(\"*.c\") add_configfiles(\"config.h.in\") configvar_check_cincludes(\"HAS_STRING_H\", \"string.h\") configvar_check_cincludes(\"HAS_STRING_AND_STDIO_H\", {\"string.h\", \"stdio.h\"}) end) ``` config.h.in ```c ${define HAS_STRING_H} ${define HAS_STRING_AND_STDIO_H} ``` config.h ```c /* #undef HAS_STRING_H */ #define HAS_STRING_AND_STDIO_H 1 ``` #### æ£€æµ‹ c/c++ ä»£ç ç‰‡æ®µ `configvar_check_csnippets` ç”¨äºæ£€æµ‹ c ä»£ç ç‰‡æ®µï¼Œ`configvar_check_cxxsnippets` ç”¨äºæ£€æµ‹ c++ ä»£ç ç‰‡æ®µã€‚ ```lua includes(\"check_csnippets.lua\") target(\"test\", function() set_kind(\"binary\") add_files(\"*.c\") add_configfiles(\"config.h.in\") configvar_check_csnippets(\"HAS_STATIC_ASSERT\", \"_Static_assert(1, \\\"\\\");\") end) ``` config.h.in ```c ${define HAS_STATIC_ASSERT} ``` config.h ```c #define HAS_STATIC_ASSERT 1 ``` xmake å¯¹ check_csnippets åšäº†æ”¹è¿›ï¼Œæ–°å¢ `tryrun` å’Œ `output` å‚æ•°å»å°è¯•è¿è¡Œå’Œæ•è·è¾“å‡ºã€‚ ```lua includes(\"check_csnippets.lua\") target(\"test\") set_kind(\"binary\") add_files(\"*.c\") add_configfiles(\"config.h.in\") check_csnippets(\"HAS_INT_4\", \"return (sizeof(int) 4)? 0 : 1;\", {tryrun true}) check_csnippets(\"INT_SIZE\", 'printf(\"%d\", sizeof(int)); return 0;', {output true, number true}) configvar_check_csnippets(\"HAS_LONG_8\", \"return (sizeof(long) 8)? 0 : 1;\", {tryrun true}) configvar_check_csnippets(\"PTR_SIZE\", 'printf(\"%d\", sizeof(void*)); return 0;', {output true, number true}) ``` å¦‚æœå¯ç”¨æ•è·è¾“å‡ºï¼Œ`config.h.in` çš„ `${define PTR_SIZE}` ä¼šè‡ªåŠ¨ç”Ÿæˆ `#define PTR_SIZE 4`ã€‚ å…¶ä¸­ï¼Œ`number true` è®¾ç½®ï¼Œå¯ä»¥å¼ºåˆ¶ä½œä¸º number è€Œä¸æ˜¯å­—ç¬¦ä¸²å€¼ï¼Œå¦åˆ™é»˜è®¤ä¼šå®šä¹‰ä¸º `#define PTR_SIZE \"4\"` #### æ£€æµ‹ç¼–è¯‘å™¨ç‰¹æ€§ ```lua includes(\"check_features.lua\") target(\"test\", function() set_kind(\"binary\") add_files(\"*.c\") add_configfiles(\"config.h.in\") configvar_check_features(\"HAS_CONSTEXPR\", \"cxx_constexpr\") configvar_check_features(\"HAS_CONSEXPR_AND_STATIC_ASSERT\", {\"cxx_constexpr\", \"c_static_assert\"}, {languages \"c++11\"}) end) ``` config.h.in ```c ${define HAS_CONSTEXPR} ${define HAS_CONSEXPR_AND_STATIC_ASSERT} ``` config.h ```c /* #undef HAS_CONSTEXPR */ #define HAS_CONSEXPR_AND_STATIC_ASSERT 1 ``` æ‰€æœ‰ c ç¼–è¯‘å™¨ç‰¹æ€§åˆ—è¡¨ï¼š ç‰¹æ€§å c_static_assert c_restrict c_variadic_macros c_function_prototypes æ‰€æœ‰ c++ ç¼–è¯‘å™¨ç‰¹æ€§åˆ—è¡¨ï¼š ç‰¹æ€§å cxx_variable_templates cxx_relaxed_constexpr cxx_aggregate_default_initializers cxx_contextual_conversions cxx_attribute_deprecated cxx_decltype_auto cxx_digit_separators cxx_generic_lambdas cxx_lambda_init_captures cxx_binary_literals cxx_return_type_deduction cxx_decltype_incomplete_return_types cxx_reference_qualified_functions cxx_alignof cxx_attributes cxx_inheriting_constructors cxx_thread_local cxx_alias_templates cxx_delegating_constructors cxx_extended_friend_declarations cxx_final cxx_nonstatic_member_init cxx_override cxx_user_literals cxx_constexpr cxx_defaulted_move_initializers cxx_enum_forward_declarations cxx_noexcept cxx_nullptr cxx_range_for cxx_unrestricted_unions cxx_explicit_conversions cxx_lambdas cxx_local_type_template_args cxx_raw_string_literals cxx_auto_type cxx_defaulted_functions cxx_deleted_functions cxx_generalized_initializers cxx_inline_namespaces cxx_sizeof_member cxx_strong_enums cxx_trailing_return_types cxx_unicode_literals cxx_uniform_initialization cxx_variadic_templates cxx_decltype cxx_default_function_template_args cxx_long_long_type cxx_right_angle_brackets cxx_rvalue_references cxx_static_assert cxx_extern_templates cxx_func_identifier cxx_variadic_macros cxx_template_template_parameters c++17 ç‰¹æ€§æ£€æµ‹ï¼š ç‰¹æ€§å cxx_aggregate_bases cxx_aligned_new cxx_capture_star_this cxx_constexpr cxx_deduction_guides cxx_enumerator_attributes cxx_fold_expressions cxx_guaranteed_copy_elision cxx_hex_float cxx_if_constexpr cxx_inheriting_constructors cxx_inline_variables cxx_namespace_attributes cxx_noexcept_function_type cxx_nontype_template_args cxx_nontype_template_parameter_auto cxx_range_based_for cxx_static_assert cxx_structured_bindings cxx_template_template_args cxx_variadic_using c++20 ç‰¹æ€§æ£€æµ‹ï¼š ç‰¹æ€§å cxx_aggregate_paren_init cxx_char8_t cxx_concepts cxx_conditional_explicit cxx_consteval cxx_constexpr cxx_constexpr_dynamic_alloc cxx_constexpr_in_decltype cxx_constinit cxx_deduction_guides cxx_designated_initializers cxx_generic_lambdas cxx_impl_coroutine cxx_impl_destroying_delete cxx_impl_three_way_comparison cxx_init_captures cxx_modules cxx_nontype_template_args cxx_using_enum cstd å’Œ c++ std ç‰ˆæœ¬æ”¯æŒï¼Œç›¸å…³ issues: [#1715](https://github.com/xmake io/xmake/issues/1715) ```lua configvar_check_features(\"HAS_CXX_STD_98\", \"cxx_std_98\") configvar_check_features(\"HAS_CXX_STD_11\", \"cxx_std_11\", {languages \"c++11\"}) configvar_check_features(\"HAS_CXX_STD_14\", \"cxx_std_14\", {languages \"c++14\"}) configvar_check_features(\"HAS_CXX_STD_17\", \"cxx_std_17\", {languages \"c++17\"}) configvar_check_features(\"HAS_CXX_STD_20\", \"cxx_std_20\", {languages \"c++20\"}) configvar_check_features(\"HAS_C_STD_89\", \"c_std_89\") configvar_check_features(\"HAS_C_STD_99\", \"c_std_99\") configvar_check_features(\"HAS_C_STD_11\", \"c_std_11\", {languages \"c11\"}) configvar_check_features(\"HAS_C_STD_17\", \"c_std_17\", {languages \"c17\"}) ``` #### æ£€æµ‹å†…ç½®å®å®šä¹‰ ç¼–è¯‘å™¨å­˜åœ¨ä¸€äº›å†…ç½®çš„å®å®šä¹‰ï¼Œæ¯”å¦‚ï¼š`__GNUC__` ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `check_macros` å’Œ `configvar_check_macros` è¾…åŠ©è„šæœ¬æ¥æ£€æµ‹å®ƒä»¬æ˜¯å¦å­˜åœ¨ã€‚ ç›¸å…³ issues: [#1715](https://github.com/xmake io/xmake/issues/1715) ```lua æ£€æµ‹å®æ˜¯å¦å®šä¹‰ configvar_check_macros(\"HAS_GCC\", \"__GNUC__\") æ£€æµ‹å®æ²¡æœ‰è¢«å®šä¹‰ configvar_check_macros(\"NO_GCC\", \"__GNUC__\", {defined false}) æ£€æµ‹å®æ¡ä»¶ configvar_check_macros(\"HAS_CXX20\", \"__cplusplus> 202002L\", {languages \"c++20\"}) ``` #### æ£€æµ‹ç±»å‹å¤§å° åœ¨å…ˆå‰çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `check_csnippets` å’Œ `output true` çš„æ–¹å¼ï¼Œæ¥å®ç°ç±»å‹æ£€æµ‹ã€‚ ```lua check_csnippets(\"INT_SIZE\", 'printf(\"%d\", sizeof(int)); return 0;', {output true, number true}) ``` ä½†æ˜¯è¿™ç§æ–¹å¼ï¼Œæ˜¯é€šè¿‡å°è¯•è¿è¡Œæµ‹è¯•ä»£ç ï¼Œç„¶åè·å–è¿è¡Œè¾“å‡ºç»“æœï¼Œæå–ç±»å‹å¤§å°ä¿¡æ¯ã€‚ è¿™å¯¹äºäº¤å‰ç¼–è¯‘ï¼Œå°±ä¸é€‚ç”¨äº†ã€‚ xmake æ–°å¢äº† `check_sizeof` è¾…åŠ©æ¥å£ï¼Œå¯ä»¥é€šè¿‡ç›´æ¥è§£ææµ‹è¯•ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæå–ç±»å‹å¤§å°ä¿¡æ¯ã€‚ ç”±äºä¸éœ€è¦è¿è¡Œæµ‹è¯•ï¼Œè¿™ç§æ–¹å¼ä¸ä»…å¯ä»¥æ”¯æŒäº¤å‰ç¼–è¯‘ï¼Œè€Œä¸”å¯¹æ£€æµ‹æ•ˆç‡ä¹Ÿæœ‰æå¤§çš„æå‡ï¼Œä½¿ç”¨ä¹Ÿæ›´åŠ çš„ç®€å•ã€‚ ```lua includes(\"@builtin/check\") target(\"test\", function() set_kind(\"static\") add_files(\"*.cpp\") check_sizeof(\"LONG_SIZE\", \"long\") check_sizeof(\"STRING_SIZE\", \"std::string\", {includes \"string\"}) end) ``` ```bash $ xmake f c checking for LONG_SIZE ... 8 checking for STRING_SIZE ... 24 ``` å¦å¤–ï¼Œæˆ‘ä¹Ÿå¯ä»¥é€šè¿‡ `target:check_sizeof` åœ¨è„šæœ¬åŸŸè¿›è¡Œæ£€æµ‹ã€‚ #### æ£€æµ‹å¤§å°ç«¯ xmake æ–°å¢äº† `check_bigendian` æ¥å£ï¼Œæ¥åˆ¤æ–­å½“å‰ç¼–è¯‘ç›®æ ‡æ˜¯å¦ä¸ºå¤§ç«¯æ¨¡å¼ã€‚ ```lua includes(\"@builtin/check\") target(\"test\", function() set_kind(\"static\") add_files(\"*.cpp\") check_bigendian(\"IS_BIG_ENDIAN\") end) ``` å¦‚æœæ£€æµ‹é€šè¿‡ï¼Œå½“å‰æ˜¯å¤§ç«¯æ¨¡å¼ï¼Œé‚£ä¹ˆä¼šå®šä¹‰ `IS_BIG_ENDIAN 1`ã€‚"},"/get_started/zh/theme/switch-themes.html":{"title":"","content":" class: heading_no_counter # åˆ‡æ¢ä¸»é¢˜ å¦‚æœç”¨æˆ·ä¸å–œæ¬¢ xmake é»˜è®¤çš„æ˜¾ç¤ºé…è‰²å’Œé£æ ¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å…¨å±€é…ç½®å‘½ä»¤ï¼Œæ¥åˆ‡æ¢åˆ° xmake æä¾›çš„å…¶ä»–ä¸€äº›é…ç½®ä¸»é¢˜ä¸Šå»ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake g theme dark ``` é»˜è®¤çš„ä¸»é¢˜åä¸º defaultï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡åˆ‡æ¢åˆ° dark é£æ ¼ä¸»é¢˜ï¼Œæ¥é€‚é…ä¸€äº›ç»ˆç«¯èƒŒæ™¯å¾ˆæµ…çš„åœºæ™¯ï¼Œæä¾›æ›´åŠ æ·±è‰²çš„è‰²å½©è¾“å‡ºï¼Œé¿å…çœ‹ä¸æ¸…ã€‚ å¦‚æœæˆ‘ä»¬è¦åˆ‡å›é»˜è®¤ä¸»é¢˜ï¼Œå¯ä»¥ç›´æ¥æ•²ï¼š ```bash $ xmake g c ``` æˆ–è€… ```bash $ xmake g theme default ```"},"/get_started/zh/theme/builtin-themes.html":{"title":"","content":" class: heading_no_counter # å†…ç½®ä¸»é¢˜ ## é»˜è®¤ä¸»é¢˜ è¿™ä¸ªä¹Ÿå°±æ˜¯å’±ä»¬å®‰è£… xmake åé»˜è®¤çš„æ˜¾ç¤ºä¸»é¢˜ï¼Œä¸»é¢˜åï¼šdefaultï¼Œå®ƒé»˜è®¤ä¼šæä¾›è‰²å½©è¾“å‡ºï¼Œé€‚åˆä¸€äº›æ·±è‰²èƒŒæ™¯çš„ç»ˆç«¯ã€‚ <img src \"/assets/img/theme/default.png\" width \"60%\" /> æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤åˆ‡å›é»˜è®¤ä¸»é¢˜ï¼š ```bash $ xmake g theme default ``` ## Ninja ä¸»é¢˜ æ„å»ºè¿›åº¦é£æ ¼ç±»ä¼¼ ninjaï¼Œé‡‡ç”¨å•è¡Œè¿›åº¦æ¡ï¼Œä¸å†å›æ»šè¿›åº¦ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½è®¾ç½®ã€‚ é™¤äº†è¿›åº¦å±•ç¤ºä¸åŒå¤–ï¼Œå…¶ä»–éƒ½è·Ÿé»˜è®¤ä¸»é¢˜çš„é…ç½®ç›¸åŒã€‚ ```bash $ xmake g theme ninja ``` <img src \"/assets/img/theme/ninja.png\" width \"60%\" /> ## Emoji ä¸»é¢˜ è¿™ä¸ªä¸»é¢˜éƒ¨åˆ†è¾“å‡ºé€šè¿‡ emoji å­—ç¬¦ä»£æ›¿ä¹‹å‰çš„è‰²å½©è¾“å‡ºã€‚ ```bash $ xmake g theme emoji ``` <img src \"/assets/img/theme/emoji.png\" width \"60%\" /> ## Dark ä¸»é¢˜ è¿™ä¸ªä¸»é¢˜ä¸»è¦æ˜¯å¯¹ä¸€äº›ç»ˆç«¯èƒŒæ™¯æ˜¯æµ…è‰²ç³»ï¼ˆæ¯”å¦‚æ·¡é»„è‰²ç­‰ï¼‰ï¼Œå¯¼è‡´ä¸€äº›è­¦å‘Šè¾“å‡ºï¼ˆé»˜è®¤ä¹Ÿæ˜¯é»„è‰²ï¼‰é‡åˆä¸å¯è§ï¼Œæ‰€ä»¥æŠŠä¸»é¢˜é…è‰²å˜æˆæ·±è‰²ç³»ï¼Œæé«˜å¯è§æ€§ã€‚ ```bash $ xmake g theme dark ``` ## Light ä¸»é¢˜ è¿™ä¸ªä¸»é¢˜ä¸»è¦æ˜¯å¯¹ä¸€äº›ç»ˆç«¯èƒŒæ™¯æ˜¯æ·±è‰²ç³»ï¼Œå¯¼è‡´ä¸€äº›è¾“å‡ºé‡åˆä¸å¯è§ï¼Œæ‰€ä»¥æŠŠä¸»é¢˜é…è‰²å˜æˆæµ…è‰²ç³»ï¼Œæé«˜å¯è§æ€§ã€‚ ```bash $ xmake g theme light ``` ## Plain ä¸»é¢˜ è¿™ä¸ªä¸»é¢˜ï¼Œå…¶å®å°±æ˜¯å®Œå…¨ç¦ç”¨è‰²å½©ã€emoji è¾“å‡ºï¼Œä¸»è¦æ˜¯åº”å¯¹ä¸€äº›ä¸æ”¯æŒ colors code çš„ç»ˆç«¯å¯¼è‡´æ˜¾ç¤ºä¹±ç çš„é—®é¢˜ï¼Œä¹Ÿæ˜¯æœ€æœ´ç´ çš„ä¸»é¢˜é£æ ¼ã€‚ ```bash $ xmake g theme plain ```"},"/get_started/zh/toolchain/builtin-toolchains.html":{"title":"","content":" class: heading_no_counter # å†…ç½®å·¥å…·é“¾ ## Gcc å¦‚æœ linux ä¸Šå®‰è£…äº† gcc å·¥å…·é“¾ï¼Œé€šå¸¸ xmake éƒ½ä¼šä¼˜å…ˆæ¢æµ‹ä½¿ç”¨ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ‡æ¢åˆ° gcc æ¥æ„å»ºã€‚ ```console $ xmake f toolchain gcc c $ xmake ``` ### ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„ Gcc å¦‚æœç”¨æˆ·é¢å¤–å®‰è£…äº† gcc 11, gcc 10 ç­‰ç‰¹å®šç‰ˆæœ¬çš„ gcc å·¥å…·é“¾ï¼Œåœ¨æœ¬åœ°çš„ gcc ç¨‹åºå‘½åå¯èƒ½æ˜¯ `/usr/bin/gcc 11`ã€‚ ä¸€ç§åŠæ³•æ˜¯é€šè¿‡ `xmake f cc gcc 11 cxx gcc 11 ld g++ 11` æŒ¨ä¸ªæŒ‡å®šé…ç½®æ¥åˆ‡æ¢ï¼Œä½†éå¸¸ç¹çã€‚ æ‰€ä»¥ï¼Œxmake ä¹Ÿæä¾›äº†æ›´åŠ å¿«æ·çš„åˆ‡æ¢æ–¹å¼ï¼š ```console $ xmake f toolchain gcc 11 c $ xmake ``` åªéœ€è¦æŒ‡å®š `gcc 11` å¯¹åº”çš„ç‰ˆæœ¬åï¼Œå°±å¯ä»¥å¿«é€Ÿåˆ‡æ¢æ•´ä¸ª gcc å·¥å…·é“¾ã€‚ ## Clang åœ¨ macOS å’Œ linuxï¼Œé€šå¸¸ xmake ä¹Ÿä¼šä¼˜å…ˆå°è¯•å»è‡ªåŠ¨æ¢æµ‹å’Œä½¿ç”¨å®ƒï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ‡æ¢ã€‚ ```console $ xmake f toolchain clang c $ xmake ``` ## LLVM é™¤äº†ç‹¬ç«‹ clang ç¼–è¯‘å™¨ï¼Œå¦‚æœç”¨æˆ·å®‰è£…äº†å®Œæ•´ llvm å·¥å…·é“¾ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ•´ä¸ªåˆ‡æ¢è¿‡å»ï¼ŒåŒ…æ‹¬ `llvm ar` ç­‰å·¥å…·ã€‚ ```console $ xmake f toolchain llvm sdk /xxxx/llvm $ xmake ``` å¦‚æœæ˜¯æ‰‹åŠ¨ä¸‹è½½çš„ llvm sdkï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–æŒ‡å®š llvm sdk æ ¹ç›®å½•ï¼Œç¡®ä¿ xmake èƒ½æ‰¾åˆ°å®ƒï¼Œå½“ç„¶ï¼Œå¦‚æœç”¨æˆ·å·²ç»å®‰è£…åˆ° PATH ç›®å½•ä¸‹ï¼Œ` sdk` å‚æ•°çš„è®¾ç½®ä¹Ÿæ˜¯å¯é€‰çš„ã€‚ ## Circle xmake æ–°å¢äº† circle ç¼–è¯‘å™¨çš„æ”¯æŒï¼Œè¿™æ˜¯ä¸ªæ–°çš„ C++20 ç¼–è¯‘å™¨ï¼Œé¢å¤–é™„å¸¦äº†ä¸€äº›æœ‰è¶£çš„ç¼–è¯‘æœŸå…ƒç¼–ç¨‹ç‰¹æ€§ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥åˆ°å®˜ç½‘æŸ¥çœ‹ï¼š<https://www.circle lang.org/> ```console $ xmake f toolchain circle $ xmake ``` ## Tinyc [Tiny C ç¼–è¯‘å™¨](https://bellard.org/tcc/) éå¸¸çš„è½»é‡ï¼Œåœ¨ä¸€äº›ä¸æƒ³å®‰è£… msvc/llvm ç­‰é‡é‡å‹ç¼–è¯‘å™¨çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å®ƒå¯èƒ½å¿«é€Ÿç¼–è¯‘ä¸€äº› c ä»£ç ã€‚ ```console $ xmake f toolchain tinycc $ xmake ``` ä½¿ç”¨çš„æ—¶å€™ï¼Œè¯·å…ˆæŠŠ tinycc ç¼–è¯‘å™¨åŠ å…¥ PATH ç¯å¢ƒã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¿œç¨‹å·¥å…·é“¾è‡ªåŠ¨ä¸‹è½½é›†æˆå®ƒï¼ŒçœŸæ­£åšåˆ°å…¨å¹³å°ä¸€é”®ç¼–è¯‘ï¼Œæ— ä»»ä½•ç”¨æˆ·æ‰‹åŠ¨å®‰è£…æ“ä½œã€‚ ```lua add_requires(\"tinycc\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") set_toolchains(\"@tinycc\") end) ``` ## Armcc for Keil/MDK å¯¹ Keil/MDK ä¸‹ armcc çš„å·¥å…·é“¾æ”¯æŒï¼Œç›¸å…³ issue è§ï¼š[#1753](https://github.com/xmake io/xmake/issues/1753) ```console xmake f p cross a cortex m3 toolchain armcc c xmake ``` è¿™ä¸ªå·¥å…·é“¾ä¸»è¦ç”¨äºåµŒå…¥å¼äº¤å‰ç¼–è¯‘ï¼Œæ‰€ä»¥æŒ‡å®šäº† ` p cross` äº¤å‰ç¼–è¯‘å¹³å°ï¼Œ` a cortex m3` æŒ‡å®šä½¿ç”¨çš„ cpuï¼Œè¿™é‡Œå¤ç”¨äº† ` a/ arch` å‚æ•°ã€‚ ## Armclang for Keil/MDK å¯¹ Keil/MDK ä¸‹ armclang çš„å·¥å…·é“¾æ”¯æŒï¼Œç›¸å…³ issue è§ï¼š[#1753](https://github.com/xmake io/xmake/issues/1753) ```console xmake f p cross a cortex m3 toolchain armclang c xmake ``` è¿™ä¸ªå·¥å…·é“¾ä¸»è¦ç”¨äºåµŒå…¥å¼äº¤å‰ç¼–è¯‘ï¼Œæ‰€ä»¥æŒ‡å®šäº† ` p cross` äº¤å‰ç¼–è¯‘å¹³å°ï¼Œ` a cortex m3` æŒ‡å®šä½¿ç”¨çš„ cpuï¼Œè¿™é‡Œå¤ç”¨äº† ` a/ arch` å‚æ•°ã€‚ ## GNU RM å¦å¤–ä¸€ä¸ªåµŒå…¥å¼ arm çš„äº¤å‰å·¥å…·é“¾ï¼Œå®˜ç½‘ï¼š<https://developer.arm.com/tools and software/open source software/developer tools/gnu toolchain/gnu rm> ```console $ xmake f toolchain gnu rm c $ xmake ``` ## SDCC ä¹Ÿæ˜¯ä¸€ä¸ªåµŒå…¥å¼çš„ arm ç¼–è¯‘å·¥å…·é“¾ã€‚ ```console $ xmake f toolchain sdcc a stm8 $ xmake ``` æˆ‘ä»¬å¯ä»¥æŒ‡å®š ` a stm8` åˆ‡æ¢ cpu æ¶æ„ï¼Œç›®å‰æ”¯æŒçš„æœ‰ï¼š stm8 mcs51 z80 z180 r2k r3ka s08 hc08 ## Zig å¦‚æœè¦æ„å»º Zig ç¨‹åºï¼Œæˆ‘ä»¬é»˜è®¤æ‰§è¡Œ xmake å°±èƒ½è‡ªåŠ¨ä½¿ç”¨ zig å·¥å…·é“¾ï¼Œä½†å‰ææ˜¯ zig å·²ç»åœ¨ PATH ç¯å¢ƒä¸‹ã€‚ ```console $ xmake ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¾ç½®å®ƒã€‚ ```console $ xmake f toolchain zig c $ xmake ``` ä¹Ÿå¯ä»¥æŒ‡å®š zig ç¼–è¯‘å™¨çš„è·¯å¾„ã€‚ ```console $ xmake f toolchain zig zc /xxxx/zig c $ xmake ``` ### Zig CC æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ zig æä¾›çš„ `zig cc` ç¼–è¯‘å™¨å»ç¼–è¯‘ C/C++ ä»£ç ã€‚ ```console $ xmake f cc \"zig cc\" cxx \"zig cc\" ld \"zig c++\" c $ xmake ``` ### äº¤å‰ç¼–è¯‘ å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ zig å®ç°äº¤å‰ç¼–è¯‘ã€‚ ```console $ xmake f p cross cross riscv64 linux musl toolchain zig $ xmake ``` æˆ–è€…ç¼–è¯‘ arm64 æ¶æ„ï¼š ```console $ xmake f toolchain zig a arm64 c $ xmake ``` ## Emcc (WASM) å¦‚æœè¦ç¼–è¯‘ wasm ç¨‹åºï¼Œæˆ‘ä»¬åªéœ€è¦åˆ‡æ¢åˆ° wasm å¹³å°ï¼Œé»˜è®¤å°±ä¼šä½¿ç”¨ emcc å·¥å…·é“¾å»ç¼–è¯‘ã€‚ ```console $ xmake f p wasm $ xmake ``` ## Wasi (WASM) è¿™æ˜¯å¦å¤–ä¸€ä¸ªå¯ç”¨äº† WASI çš„ Wasm å·¥å…·é“¾ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ‡æ¢ä½¿ç”¨ã€‚ ```console $ xmake f p wasm toolchain wasi $ xmake ``` ## Icc (Intel C/C++ Compiler) æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ‡æ¢åˆ° Intel çš„ C/C++ ç¼–è¯‘å™¨å»ä½¿ç”¨ã€‚ ```console $ xmake f toolchain icc c $ xmake ``` ## Ifort (Intel Fortain Compiler) æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ‡æ¢åˆ° Intel çš„ Fortran ç¼–è¯‘å™¨å»ä½¿ç”¨ã€‚ ```console $ xmake f toolchain ifort c $ xmake ``` ## gfortran é™¤äº† Intel çš„ Fortran ç¼–è¯‘å™¨ï¼Œæˆ‘ä»¬è¿˜æœ‰ gnu fortran ç¼–è¯‘å™¨å¯ç”¨ã€‚ ```console $ xmake f toolchain gfortran c $ xmake ``` ## fpc (Free Pascal) å¯¹äº pascal ç¨‹åºï¼Œxmake é»˜è®¤å°±ä¼šä½¿ç”¨ fpc ç¼–è¯‘å™¨æ¥ç¼–è¯‘ã€‚ ```console $ xmake ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ‡æ¢ã€‚ ```console $ xmake f toolchain fpc c $ xmake ``` ## Dlang å¯¹äº dlang ç¨‹åºï¼Œxmake é»˜è®¤å°±ä¼šä½¿ç”¨ dmd ç¼–è¯‘å™¨æ¥ç¼–è¯‘ã€‚ ```console $ xmake ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ‡æ¢ã€‚ ```console $ xmake f toolchain dlang c $ xmake ``` éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤å¤„çš„ dlang å·¥å…·é“¾å…¶å®å†…éƒ¨åŒ…å«äº†å¯¹ `dmd`, `ldc2` å’Œ `gdc` çš„è‡ªåŠ¨æ¢æµ‹å’Œåˆ‡æ¢ã€‚ ## Cuda å¯¹äº Cuda ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ‡æ¢åˆ° cuda å·¥å…·é“¾ã€‚ ```console $ xmake f toolchain cuda c $ xmake ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ‡æ¢ nvcc å†…éƒ¨è°ƒç”¨çš„ C/C++ ç¼–è¯‘å™¨ã€‚ ```console $ xmake f toolchain cuda cu ccbin clang c $ xmake ``` ## æ±‡ç¼–å™¨ å…³äºç‹¬ç«‹çš„æ±‡ç¼–å™¨å·¥å…·é“¾ï¼Œxmake æ”¯æŒï¼šyasm, nasm, fasm ä¸‰ä¸ªï¼Œå¯ä»¥éšæ„åˆ‡æ¢ï¼Œå¦‚æœæ²¡è®¾ç½®ï¼Œé»˜è®¤ä½¿ç”¨ gcc/clang/msvc è‡ªå¸¦çš„æ±‡ç¼–å™¨ã€‚ ```console $ xmake f toolchain nasm c $ xmake ``` ä¹Ÿå¯ä»¥å•ç‹¬æŒ‡å®šæ±‡ç¼–å™¨è·¯å¾„ ```console $ xmake f toolchain nasm as /xxx/nasm c $ xmake ``` ## Go golang ç¼–è¯‘å·¥å…·é“¾ï¼Œé»˜è®¤ç¼–è¯‘ go ç¨‹åºä¼šè‡ªåŠ¨å¯ç”¨ã€‚ ```console $ xmake ``` ## Rust rust ç¼–è¯‘å·¥å…·é“¾ï¼Œé»˜è®¤ç¼–è¯‘ rust ç¨‹åºä¼šè‡ªåŠ¨å¯ç”¨ã€‚ ```console $ xmake ``` ç›®å‰ rust å·¥å…·é“¾è¿˜å¯ä»¥æ”¯æŒ android ç­‰äº¤å‰ç¼–è¯‘ç¯å¢ƒã€‚ ```console $ xmake f p android ndk ~/android ndk r20b c $ xmake ``` ## NDK Android çš„ NDK ç¼–è¯‘å·¥å…·é“¾ï¼Œåªè¦å¯ç”¨ android å¹³å°ï¼Œå°±ä¼šé»˜è®¤å¯ç”¨ã€‚ ```console $ xmake f p android ndk ~/android ndk r20b c $ xmake ``` å¦‚æœ ` ndk` å‚æ•°ä¸æŒ‡å®šï¼Œxmake ä¹Ÿä¼šé»˜è®¤ä» AndroidSDK/ndk bundle ç›®å½•ï¼Œä»¥åŠ `$ANDROID_NDK_HOME`, `ANDROID_NDK_ROOT` ç­‰ç¯å¢ƒå˜é‡ä¸­å»æ¢æµ‹å®ƒã€‚ å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®å¯¼å…¨å±€çš„ `xmake g ndk ` é…ç½®ä¸­ï¼Œé¿å…æ¯æ¬¡é‡å¤è®¾ç½®ã€‚"},"/get_started/zh/toolchain/custom-toolchains.html":{"title":"","content":" class: heading_no_counter # è‡ªå®šä¹‰å·¥å…·é“¾ xmake æ”¯æŒåœ¨ç”¨æˆ·çš„é¡¹ç›® xmake.lua ä¸­è‡ªå®šä¹‰å·¥å…·é“¾ï¼Œä¾‹å¦‚ï¼š ```lua define toolchain toolchain(\"myclang\", function() mark as standalone toolchain set_kind(\"standalone\") set toolset set_toolset(\"cc\", \"clang\") set_toolset(\"cxx\", \"clang\", \"clang++\") set_toolset(\"ld\", \"clang++\", \"clang\") set_toolset(\"sh\", \"clang++\", \"clang\") set_toolset(\"ar\", \"ar\") set_toolset(\"ex\", \"ar\") set_toolset(\"strip\", \"strip\") set_toolset(\"mm\", \"clang\") set_toolset(\"mxx\", \"clang\", \"clang++\") set_toolset(\"as\", \"clang\") add_defines(\"MYCLANG\") check toolchain on_check(function (toolchain) return import(\"lib.detect.find_tool\")(\"clang\") end) on load on_load(function (toolchain) get march local march is_arch(\"x86_64\", \"x64\") and \" m64\" or \" m32\" init flags for c/c++ toolchain:add(\"cxflags\", march) toolchain:add(\"ldflags\", march) toolchain:add(\"shflags\", march) if not is_plat(\"windows\") and os.isdir(\"/usr\") then for _, includedir in ipairs({\"/usr/local/include\", \"/usr/include\"}) do if os.isdir(includedir) then toolchain:add(\"includedirs\", includedir) end end for _, linkdir in ipairs({\"/usr/local/lib\", \"/usr/lib\"}) do if os.isdir(linkdir) then toolchain:add(\"linkdirs\", linkdir) end end end init flags for objc/c++ (with ldflags and shflags) toolchain:add(\"mxflags\", march) init flags for asm toolchain:add(\"asflags\", march) end) end) ``` ç„¶åé€šè¿‡ä¸‹é¢çš„å‘½ä»¤åˆ‡åˆ°è‡ªå·±å®šä¹‰çš„å·¥å…·é“¾å°±è¡Œäº†ï¼š ```bash $ xmake f toolchain myclang ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `set_toolchains` æ¥å£ç›´æ¥å¯¹æŒ‡å®š target åˆ‡æ¢è®¾ç½®åˆ°è‡ªå®šä¹‰å·¥å…·é“¾ã€‚ åœ¨è‡ªå®šä¹‰å·¥å…·å‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å…ˆè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹å®Œæ•´çš„å†…ç½®å·¥å…·é“¾åˆ—è¡¨ï¼Œç¡®ä¿ xmake æ²¡æœ‰æä¾›ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œç›´æ¥ä½¿ç”¨å°±è¡Œäº†ï¼Œæ²¡å¿…è¦è‡ªå·±å®šä¹‰ï¼š ```bash $ xmake show l toolchains ``` ä¸‹é¢æ˜¯è‡ªå®šä¹‰ toolchain ç›®å‰æ”¯æŒçš„æ¥å£åˆ—è¡¨ï¼š æ¥å£ æè¿° [toolchain](#toolchain) å®šä¹‰å·¥å…·é“¾ [set_kind](#toolchainset_kind) è®¾ç½®å·¥å…·é“¾ç±»å‹ [set_toolset](#toolchainset_toolset) è®¾ç½®å·¥å…·é›† [set_sdkdir](#toolchainset_sdkdir) è®¾ç½®å·¥å…·é“¾ sdk ç›®å½•è·¯å¾„ [set_bindir](#toolchainset_bindir) è®¾ç½®å·¥å…·é“¾ bin ç›®å½•è·¯å¾„ [on_check](#toolchainon_check) æ£€æµ‹å·¥å…·é“¾ [on_load](#toolchainonon_load) åŠ è½½å·¥å…·é“¾ [toolchain_end](#toolchain_end) ç»“æŸå®šä¹‰å·¥å…·é“¾ [add_includedirs](/zh cn/manual/project_target?id targetadd_includedirs) æ·»åŠ å¤´æ–‡ä»¶æœç´¢ç›®å½• [add_defines](/zh cn/manual/project_target?id targetadd_defines) æ·»åŠ å®å®šä¹‰ [add_undefines](/zh cn/manual/project_target?id targetadd_undefines) å–æ¶ˆå®å®šä¹‰ [add_cflags](/zh cn/manual/project_target?id targetadd_cflags) æ·»åŠ  c ç¼–è¯‘é€‰é¡¹ [add_cxflags](/zh cn/manual/project_target?id targetadd_cxflags) æ·»åŠ  c/c++ ç¼–è¯‘é€‰é¡¹ [add_cxxflags](/zh cn/manual/project_target?id targetadd_cxxflags) æ·»åŠ  c++ ç¼–è¯‘é€‰é¡¹ [add_mflags](/zh cn/manual/project_target?id targetadd_mflags) æ·»åŠ  objc ç¼–è¯‘é€‰é¡¹ [add_mxflags](/zh cn/manual/project_target?id targetadd_mxflags) æ·»åŠ  objc/objc++ ç¼–è¯‘é€‰é¡¹ [add_mxxflags](/zh cn/manual/project_target?id targetadd_mxxflags) æ·»åŠ  objc++ ç¼–è¯‘é€‰é¡¹ [add_scflags](/zh cn/manual/project_target?id targetadd_scflags) æ·»åŠ  swift ç¼–è¯‘é€‰é¡¹ [add_asflags](/zh cn/manual/project_target?id targetadd_asflags) æ·»åŠ æ±‡ç¼–ç¼–è¯‘é€‰é¡¹ [add_gcflags](/zh cn/manual/project_target?id targetadd_gcflags) æ·»åŠ  go ç¼–è¯‘é€‰é¡¹ [add_dcflags](/zh cn/manual/project_target?id targetadd_dcflags) æ·»åŠ  dlang ç¼–è¯‘é€‰é¡¹ [add_rcflags](/zh cn/manual/project_target?id targetadd_rcflags) æ·»åŠ  rust ç¼–è¯‘é€‰é¡¹ [add_cuflags](/zh cn/manual/project_target?id targetadd_cuflags) æ·»åŠ  cuda ç¼–è¯‘é€‰é¡¹ [add_culdflags](/zh cn/manual/project_target?id targetadd_culdflags) æ·»åŠ  cuda è®¾å¤‡é“¾æ¥é€‰é¡¹ [add_ldflags](/zh cn/manual/project_target?id targetadd_ldflags) æ·»åŠ é“¾æ¥é€‰é¡¹ [add_arflags](/zh cn/manual/project_target?id targetadd_arflags) æ·»åŠ é™æ€åº“å½’æ¡£é€‰é¡¹ [add_shflags](/zh cn/manual/project_target?id targetadd_shflags) æ·»åŠ åŠ¨æ€åº“é“¾æ¥é€‰é¡¹ [add_languages](/zh cn/manual/project_target?id targetadd_languages) æ·»åŠ è¯­è¨€æ ‡å‡† [add_frameworks](/zh cn/manual/project_target?id targetadd_frameworks) æ·»åŠ é“¾æ¥æ¡†æ¶ [add_frameworkdirs](/zh cn/manual/project_target?id targetadd_frameworkdirs) æ·»åŠ é“¾æ¥æ¡†æ¶ ## toolchain ### å®šä¹‰å·¥å…·é“¾ å¯ä»¥åœ¨ç”¨æˆ·é¡¹ç›® xmake.lua ä¸­å®šä¹‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ includes ç‹¬ç«‹åˆ°å•ç‹¬çš„ xmake.lua å»ä¸“é—¨å®šä¹‰å„ç§å·¥å…·é“¾ ```lua toolchain(\"myclang\", function() set_toolset(\"cc\", \"clang\") set_toolset(\"cxx\", \"clang\", \"clang++\") end) ``` ### å®šä¹‰äº¤å‰å·¥å…·é“¾ æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ xmake.lua ä¸­é’ˆå¯¹ä¸åŒçš„äº¤å‰å·¥å…·é“¾ sdk è¿›è¡Œè‡ªå®šä¹‰é…ç½®ï¼Œé€šå¸¸åªéœ€è¦æŒ‡å®š sdkdirï¼Œxmake å°±å¯ä»¥è‡ªåŠ¨æ£€æµ‹å…¶ä»–çš„é…ç½®ï¼Œæ¯”å¦‚ cross ç­‰ä¿¡æ¯ï¼Œä¾‹å¦‚: ```lua toolchain(\"my_toolchain\", function() set_kind(\"standalone\") set_sdkdir(\"/tmp/arm linux musleabi cross\") end) target(\"hello\", function() set_kind(\"binary\") add_files(\"apps/hello/*.c\") end) ``` è¿™æ˜¯ä¸€ä¸ªæœ€ç²¾ç®€çš„äº¤å‰å·¥å…·é“¾é…ç½®ï¼Œä»…ä»…è®¾ç½®äº†å¯¹åº”çš„ sdk è·¯å¾„ï¼Œç„¶åé€šè¿‡ `set_kind(\"standalone\")` å°†å…¶æ ‡è®°ä¸ºå®Œæ•´ç‹¬ç«‹çš„å·¥å…·é“¾ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œ ` toolchain my_toolchain` å»æ‰‹åŠ¨åˆ‡æ¢åˆ°æ­¤å·¥å…·é“¾æ¥ä½¿ç”¨ã€‚ ```console xmake f toolchain my_toolchain xmake ``` å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥åœ¨ xmake.lua ä¸­é€šè¿‡ `set_toolchains` å°†å…¶ç»‘å®šåˆ°å¯¹åº”çš„ target ä¸Šå»ï¼Œé‚£ä¹ˆä»…ä»…åªåœ¨ç¼–è¯‘æ­¤ target æ—¶å€™ï¼Œæ‰ä¼šåˆ‡æ¢åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„å·¥å…·é“¾ã€‚ ```lua toolchain(\"my_toolchain\", function() set_kind(\"standalone\") set_sdkdir(\"/tmp/arm linux musleabi cross\") end) target(\"hello\", function() set_kind(\"binary\") add_files(\"apps/hello/*.c\") set_toolchains(\"my_toolchain\") end) ``` è¿™æ ·ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦æ‰‹åŠ¨åˆ‡æ¢å·¥å…·é“¾äº†ï¼Œåªéœ€è¦æ‰§è¡Œ xmakeï¼Œå°±ä¼šé»˜è®¤è‡ªåŠ¨åˆ‡æ¢åˆ° my_toolchain å·¥å…·é“¾ã€‚ è¿™å¯¹äºåµŒå…¥å¼å¼€å‘æ¥è®²å°¤å…¶æœ‰ç”¨ï¼Œå› ä¸ºåµŒå…¥å¼å¹³å°çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾éå¸¸å¤šï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å„ç§åˆ‡æ¢æ¥å®Œæˆä¸åŒå¹³å°çš„ç¼–è¯‘ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰çš„å·¥å…·é“¾å®šä¹‰æ”¾ç½®åˆ°ç‹¬ç«‹çš„ lua æ–‡ä»¶ä¸­å»å®šä¹‰ï¼Œä¾‹å¦‚ï¼š ``` projectdir xmake.lua toolchains my_toolchain1.lua my_toolchain2.lua ... ``` ç„¶åï¼Œæˆ‘ä»¬åªéœ€è¦å† xmake.lua ä¸­é€šè¿‡ includes å»å¼•å…¥å®ƒä»¬ï¼Œå¹¶æ ¹æ®ä¸åŒçš„è‡ªå®šä¹‰å¹³å°ï¼Œç»‘å®šä¸åŒçš„å·¥å…·é“¾ï¼š ```lua includes(\"toolchains/*.lua\") target(\"hello\", function() set_kind(\"binary\") add_files(\"apps/hello/*.c\") if is_plat(\"myplat1\") then set_toolchains(\"my_toolchain1\") elseif is_plat(\"myplat2\") then set_toolchains(\"my_toolchain2\") end end) ``` è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–è¯‘çš„æ—¶å€™ï¼Œç›´æ¥å¿«é€Ÿåˆ‡æ¢æŒ‡å®šå¹³å°ï¼Œæ¥è‡ªåŠ¨åˆ‡æ¢å¯¹åº”çš„å·¥å…·é“¾äº†ã€‚ ```console xmake f p myplat1 xmake ``` å¦‚æœï¼Œæœ‰äº›äº¤å‰ç¼–è¯‘å·¥å…·é“¾ç»“æ„å¤æ‚ï¼Œè‡ªåŠ¨æ£€æµ‹è¿˜ä¸è¶³å¤Ÿï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ®å®é™…æƒ…å†µï¼Œä½¿ç”¨ `set_toolset`, `set_cross` å’Œ `set_bindir` ç­‰æ¥å£ï¼Œé’ˆå¯¹æ€§çš„é…ç½®ä¸Šå…¶ä»–çš„è®¾ç½®ã€‚ ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬è¿˜é¢å¤–æ·»åŠ äº†ä¸€äº› cxflags/ldflags ä»¥åŠå†…ç½®çš„ç³»ç»Ÿåº“ linksã€‚ ```lua toolchain(\"my_toolchain\", function() set_kind(\"standalone\") set_sdkdir(\"/tmp/arm linux musleabi cross\") on_load(function (toolchain) add flags for arch if toolchain:is_arch(\"arm\") then toolchain:add(\"cxflags\", \" march armv7 a\", \" msoft float\", {force true}) toolchain:add(\"ldflags\", \" march armv7 a\", \" msoft float\", {force true}) end toolchain:add(\"ldflags\", \" static\", {force true}) toolchain:add(\"syslinks\", \"gcc\", \"c\") end) end) ``` æ›´å¤šè‡ªå®šä¹‰å·¥å…·é“¾çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹é¢çš„æ¥å£æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥åˆ° xmake çš„æºç çš„ç›®å½•å‚è€ƒå†…ç½®çš„å·¥å…·é“¾å®šä¹‰ï¼š[å†…éƒ¨å·¥å…·é“¾åˆ—è¡¨](https://github.com/xmake io/xmake/blob/master/xmake/toolchains/) ## toolchain:set_kind ### è®¾ç½®å·¥å…·é“¾ç±»å‹ ç›®å‰ä»…æ”¯æŒè®¾ç½®ä¸º `standalone` ç±»å‹ï¼Œè¡¨ç¤ºå½“å‰å·¥å…·é“¾æ˜¯ç‹¬ç«‹å®Œæ•´çš„å·¥å…·é“¾ï¼ŒåŒ…æ‹¬ cc/cxx/ld/sh/ar ç­‰ç¼–è¯‘å™¨ã€å½’æ¡£å™¨ã€é“¾æ¥å™¨ç­‰ä¸€æ•´å¥—å·¥å…·é›†çš„é…ç½®ã€‚ é€šå¸¸ç”¨äºæŸä¸ª target è¢«åŒæ—¶è®¾ç½®äº†å¤šä¸ªå·¥å…·é“¾çš„æƒ…å†µï¼Œä½†åŒæ—¶åªèƒ½ç”Ÿæ•ˆä¸€ä¸ªç‹¬ç«‹å·¥å…·é“¾ï¼Œé€šè¿‡æ­¤é…ç½®å¯ä»¥ä¿è¯ç”Ÿæ•ˆçš„å·¥å…·é“¾å­˜åœ¨äº’æ–¥å…³ç³»ï¼Œæ¯”å¦‚ gcc/clang å·¥å…·é“¾ä¸ä¼šåŒæ—¶ç”Ÿæ•ˆã€‚ è€Œåƒ yasm/nasm è¿™ç§å±€éƒ¨å·¥å…·é“¾ï¼Œå±äºé™„åŠ çš„å±€éƒ¨å·¥å…·é“¾æ‰©å±•ï¼Œä¸ç”¨è®¾ç½® standaloneï¼Œå› ä¸º clang/yasm ä¸¤ä¸ªå·¥å…·é“¾æœ‰å¯èƒ½åŒæ—¶å­˜åœ¨ã€‚ > åªè¦è®°ä½ï¼Œå­˜åœ¨å®Œæ•´ç¼–è¯‘ç¯å¢ƒçš„å·¥å…·é“¾ï¼Œéƒ½è®¾ç½®ä¸º standalone å°±è¡Œã€‚ ## toolchain:set_toolset è®¾ç½®å·¥å…·é›†ã€‚ ç”¨äºè®¾ç½®æ¯ä¸ªå•ç‹¬å·¥å…·åå’Œè·¯å¾„ï¼Œä¾‹å¦‚ï¼š ```lua toolchain(\"myclang\", function() set_kind(\"standalone\") set_toolset(\"cc\", \"clang\") set_toolset(\"cxx\", \"clang\", \"clang++\") set_toolset(\"ld\", \"clang++\", \"clang\") set_toolset(\"sh\", \"clang++\", \"clang\") set_toolset(\"ar\", \"ar\") set_toolset(\"ex\", \"ar\") set_toolset(\"strip\", \"strip\") set_toolset(\"mm\", \"clang\") set_toolset(\"mxx\", \"clang\", \"clang++\") set_toolset(\"as\", \"clang\") end) ``` å…³äºè¿™ä¸ªæ¥å£çš„è¯¦æƒ…ï¼Œå¯ä»¥çœ‹ä¸‹ï¼š[target.set_toolset](/zh cn/manual/project_target?id targetset_toolset) ## toolchain:set_sdkdir è®¾ç½®å·¥å…·é“¾ sdk ç›®å½•è·¯å¾„ã€‚ é€šå¸¸æˆ‘ä»¬å¯ä»¥é€šè¿‡ `xmake f toolchain myclang sdk xxx` æ¥é…ç½® sdk ç›®å½•ï¼Œä½†æ˜¯æ¯æ¬¡é…ç½®æ¯”è¾ƒç¹çï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ­¤æ¥å£é¢„å…ˆé…ç½®åˆ° xmake.lua ä¸­å»ï¼Œæ–¹ä¾¿å¿«é€Ÿåˆ‡æ¢ä½¿ç”¨ã€‚ ```lua toolchain(\"myclang\", function() set_kind(\"standalone\") set_sdkdir(\"/tmp/sdkdir\") set_toolset(\"cc\", \"clang\") end) ``` ## toolchain:set_bindir è®¾ç½®å·¥å…·é“¾ bin ç›®å½•è·¯å¾„ã€‚ é€šå¸¸æˆ‘ä»¬å¯ä»¥é€šè¿‡ `xmake f toolchain myclang bin xxx` æ¥é…ç½® sdk ç›®å½•ï¼Œä½†æ˜¯æ¯æ¬¡é…ç½®æ¯”è¾ƒç¹çï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ­¤æ¥å£é¢„å…ˆé…ç½®åˆ° xmake.lua ä¸­å»ï¼Œæ–¹ä¾¿å¿«é€Ÿåˆ‡æ¢ä½¿ç”¨ã€‚ ```lua toolchain(\"myclang\", function() set_kind(\"standalone\") set_bindir(\"/tmp/sdkdir/bin\") set_toolset(\"cc\", \"clang\") end) ``` ## toolchain:on_check æ£€æµ‹å·¥å…·é“¾ã€‚ ç”¨äºæ£€æµ‹æŒ‡å®šå·¥å…·é“¾æ‰€åœ¨ sdk æˆ–è€…ç¨‹åºåœ¨å½“å‰ç³»ç»Ÿä¸Šæ˜¯å¦å­˜åœ¨ï¼Œé€šå¸¸ç”¨äºå¤šä¸ª standalone å·¥å…·é“¾çš„æƒ…å†µï¼Œè¿›è¡Œè‡ªåŠ¨æ¢æµ‹å’Œé€‰æ‹©æœ‰æ•ˆå·¥å…·é“¾ã€‚ è€Œå¯¹äº `xmake f toolchain myclang` æ‰‹åŠ¨æŒ‡å®šçš„åœºæ™¯ï¼Œæ­¤æ£€æµ‹é…ç½®ä¸æ˜¯å¿…é¡»çš„ï¼Œå¯ä»¥çœç•¥ã€‚ ```lua toolchain(\"myclang\", function() on_check(function (toolchain) return import(\"lib.detect.find_tool\")(\"clang\") end) end) ``` ## toolchain:on_load åŠ è½½å·¥å…·é“¾ã€‚ å¯¹äºä¸€äº›å¤æ‚çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ on_load ä¸­åŠ¨æ€çµæ´»çš„è®¾ç½®å„ç§å·¥å…·é“¾é…ç½®ï¼Œæ¯”åœ¨æè¿°åŸŸè®¾ç½®æ›´åŠ çµæ´»ï¼Œæ›´åŠ å¼ºå¤§ï¼š ```lua toolchain(\"myclang\", function() set_kind(\"standalone\") on_load(function (toolchain) set toolset toolchain:set(\"toolset\", \"cc\", \"clang\") toolchain:set(\"toolset\", \"ld\", \"clang++\") init flags local march toolchain:is_arch(\"x86_64\", \"x64\") and \" m64\" or \" m32\" toolchain:add(\"cxflags\", march) toolchain:add(\"ldflags\", march) toolchain:add(\"shflags\", march) end) end) ```"},"/get_started/zh/toolchain/remote-toolchains.html":{"title":"","content":" class: heading_no_counter # è¿œç¨‹å·¥å…·é“¾ æˆ‘ä»¬å¯ä»¥æ‹‰å–æŒ‡å®šçš„å·¥å…·é“¾æ¥é›†æˆç¼–è¯‘é¡¹ç›®ï¼Œxmake ä¹Ÿæ”¯æŒå°†ä¾èµ–åŒ…åˆ‡æ¢åˆ°å¯¹åº”çš„è¿œç¨‹å·¥å…·é“¾å‚ä¸ç¼–è¯‘åé›†æˆè¿›æ¥ã€‚ ç›¸å…³ä¾‹å­ä»£ç è§ï¼š[Toolchain/Packages Examples](https://github.com/xmake io/xmake/tree/master/tests/projects/package) ç›¸å…³çš„ issue [#1217](https://github.com/xmake io/xmake/issues/1217) ## æ‹‰å–æŒ‡å®šç‰ˆæœ¬çš„ llvm å·¥å…·é“¾ æˆ‘ä»¬ä½¿ç”¨ llvm 10 ä¸­çš„ clang æ¥ç¼–è¯‘é¡¹ç›®ã€‚ ```lua add_requires(\"llvm 10.x\", {alias \"llvm 10\"}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") set_toolchains(\"llvm@llvm 10\") end) ``` ## æ‹‰å–äº¤å‰ç¼–è¯‘å·¥å…·é“¾ æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‹‰å–æŒ‡å®šçš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ¥ç¼–è¯‘é¡¹ç›®ã€‚ ```lua add_requires(\"muslcc\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") set_toolchains(\"@muslcc\") end) ``` ## æ‹‰å–å·¥å…·é“¾å¹¶ä¸”é›†æˆå¯¹åº”å·¥å…·é“¾ç¼–è¯‘çš„ä¾èµ–åŒ… æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æŒ‡å®šçš„ muslcc äº¤å‰ç¼–è¯‘å·¥å…·é“¾å»ç¼–è¯‘å’Œé›†æˆæ‰€æœ‰çš„ä¾èµ–åŒ…ã€‚ ```lua add_requires(\"muslcc\") add_requires(\"zlib\", \"libogg\", {system false}) set_toolchains(\"@muslcc\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"zlib\", \"libogg\") end) ``` å®Œæ•´ä¾‹å­è§ï¼š[Examples (muslcc)](https://github.com/xmake io/xmake/blob/master/tests/projects/package/toolchain_muslcc/xmake.lua) ## æ‹‰å–é›†æˆ Zig å·¥å…·é“¾ ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"zig 0.7.x\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.zig\") set_toolchains(\"@zig\") end) ```"},"/get_started/zh/rule/index.html":{"title":"","content":" class: heading_no_counter # rule xmake ä¸ä»…åŸç”Ÿæ”¯æŒå¤šè¯­è¨€æ–‡ä»¶çš„æ„å»ºï¼Œè¿˜å…è®¸ç”¨æˆ·é€šè¿‡è‡ªå®šä¹‰æ„å»ºè§„åˆ™å®ç°å¤æ‚çš„æœªçŸ¥æ–‡ä»¶æ„å»ºã€‚ è‡ªå®šä¹‰æ„å»ºè§„åˆ™å¯ä»¥ä½¿ç”¨ `set_extensions` å°†ä¸€ç»„æ–‡ä»¶æ‰©å±•åå…³è”åˆ°å®ƒä»¬ã€‚ ä¸€æ—¦è¿™äº›æ‰©å±•ä¸è§„åˆ™ç›¸å…³è”ï¼Œç¨åå¯¹ `add_files` çš„è°ƒç”¨å°†è‡ªåŠ¨ä½¿ç”¨æ­¤è‡ªå®šä¹‰è§„åˆ™ã€‚ è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹è§„åˆ™ï¼Œå®ƒå°†ä½¿ç”¨ Pandoc å°†æ·»åŠ åˆ°æ„å»ºç›®æ ‡çš„ Markdown æ–‡ä»¶è½¬æ¢ä¸º HTML æ–‡ä»¶ï¼š ```lua define a build rule for a markdown file rule(\"markdown\", function() set_extensions(\".md\", \".markdown\") on_build_file(function (target, sourcefile, opt) import(\"core.project.depend\") import(\"utils.progress\") it only for v2.5.9, we need use print to show progress below v2.5.8 make sure build directory exists os.mkdir(target:targetdir()) replace .md with .html local targetfile path.join(target:targetdir(), path.basename(sourcefile) .. \".html\") only rebuild the file if its changed since last run depend.on_changed(function () call pandoc to make a standalone html file from a markdown file os.vrunv('pandoc', {\" s\", \" f\", \"markdown\", \" t\", \"html\", \" o\", targetfile, sourcefile}) progress.show(opt.progress, \"${color.build.object}markdown %s\", sourcefile) end, {files sourcefile}) end) end) target(\"test\", function() set_kind(\"object\") make the test target support the construction rules of the markdown file add_rules(\"markdown\") adding a markdown file to build add_files(\"src/*.md\") add_files(\"src/*.markdown\") end) ``` è¿˜æœ‰ä¸€ç§ä»¥ `on_build_files` å½¢å¼ä»£æ›¿ `on_build_file` çš„æ–¹æ³•ï¼Œå®ƒå…è®¸æ‚¨åœ¨ä¸€ä¸ªå‡½æ•°è°ƒç”¨ä¸­å¤„ç†æ•´ä¸ªæ–‡ä»¶é›†ã€‚ ç¬¬äºŒç§ç§°ä¸º `on_buildcmd_file` å’Œ `on_buildcmd_files` çš„å½¢å¼æ˜¯å£°æ˜æ€§çš„ï¼›å®ƒä¸æ˜¯è¿è¡Œä»»æ„ Lua æ¥æ„å»ºç›®æ ‡ï¼Œè€Œæ˜¯è¿è¡Œ Lua æ¥äº†è§£è¿™äº›ç›®æ ‡æ˜¯å¦‚ä½•æ„å»ºçš„ã€‚ > `buildcmd` çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å°†è¿™äº›è§„åˆ™å¯¼å‡ºåˆ°æ ¹æœ¬ä¸éœ€è¦ xmake å³å¯è¿è¡Œçš„ makefileã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ buildcmd è¿›ä¸€æ­¥ç®€åŒ–å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ```lua define a build rule for a markdown file rule(\"markdown\", function() set_extensions(\".md\", \".markdown\") on_buildcmd_file(function (target, batchcmds, sourcefile, opt) make sure build directory exists batchcmds:mkdir(target:targetdir()) replace .md with .html local targetfile path.join(target:targetdir(), path.basename(sourcefile) .. \".html\") call pandoc to make a standalone html file from a markdown file batchcmds:vrunv('pandoc', {\" s\", \" f\", \"markdown\", \" t\", \"html\", \" o\", targetfile, sourcefile}) batchcmds:show_progress(opt.progress, \"${color.build.object}markdown %s\", sourcefile) only rebuild the file if its changed since last run batchcmds:add_depfiles(sourcefile) end) end) target(\"test\", function() set_kind(\"object\") make the test target support the construction rules of the markdown file add_rules(\"markdown\") adding a markdown file to build add_files(\"src/*.md\") add_files(\"src/*.markdown\") end) ``` æ— è®ºæ–‡ä»¶æ‰©å±•åå¦‚ä½•ï¼Œæ–‡ä»¶éƒ½å¯ä»¥åˆ†é…ç»™ç‰¹å®šè§„åˆ™ã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨æ·»åŠ æ–‡ä»¶æ—¶è®¾ç½® `rule` è‡ªå®šä¹‰å±æ€§æ¥å®Œæˆæ­¤æ“ä½œï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š ```lua target(\"test\", function() ... add_files(\"src/test/*.md.in\", {rule \"markdown\"}) end) ``` ä¸€ä¸ª target å¯ä»¥å åŠ åº”ç”¨å¤šä¸ª rules å»æ›´åŠ å®šåˆ¶åŒ–å®ç°è‡ªå·±çš„æ„å»ºè¡Œä¸ºï¼Œç”šè‡³æ”¯æŒä¸åŒçš„æ„å»ºç¯å¢ƒã€‚ > é€šè¿‡ `add_files(\"*.md\", {rule \"markdown\"})` æ–¹å¼æŒ‡å®šçš„è§„åˆ™ï¼Œä¼˜å…ˆçº§é«˜äº `add_rules(\"markdown\")` è®¾ç½®çš„è§„åˆ™ã€‚"},"/get_started/zh/rule/description-scope.html":{"title":"","content":" class: heading_no_counter # æè¿°åŸŸ ## rule å®šä¹‰è§„åˆ™ï¼š ```lua rule(\"markdown\", function() set_extensions(\".md\", \".markdown\") on_build_file(function (target, sourcefile, opt) os.cp(sourcefile, path.join(target:targetdir(), path.basename(sourcefile) .. \".html\")) end) end) ``` ## rule:add_deps å…³è”ä¾èµ–å¯ä»¥ç»‘å®šä¸€æ‰¹è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯ä¸å¿…å¯¹ target æŒ¨ä¸ªå»ä½¿ç”¨ `add_rules()` æ·»åŠ è§„åˆ™ï¼Œåªéœ€è¦åº”ç”¨ä¸€ä¸ªè§„åˆ™ï¼Œå°±èƒ½ç”Ÿæ•ˆå®ƒå’Œå®ƒçš„æ‰€æœ‰ä¾èµ–è§„åˆ™ã€‚ ä¾‹å¦‚ï¼š ```lua rule(\"foo\", function() add_deps(\"bar\") end) rule(\"bar\", function() ... end) ``` æˆ‘ä»¬åªéœ€è¦ `add_rules(\"foo\")`ï¼Œå°±èƒ½åŒæ—¶åº”ç”¨ foo å’Œ bar ä¸¤ä¸ªè§„åˆ™ã€‚ ä½†æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¾èµ–ä¹‹é—´æ˜¯ä¸å­˜åœ¨æ‰§è¡Œçš„å…ˆåé¡ºåºçš„ï¼Œfoo å’Œ bar çš„ `on_build_file` ç­‰è„šæœ¬æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œé¡ºåºæœªå®šä¹‰ã€‚ å¦‚æœè¦ä¸¥æ ¼æ§åˆ¶æ‰§è¡Œé¡ºåºï¼Œå¯ä»¥é…ç½® `add_deps(\"bar\", {order true})`ï¼Œå‘Šè¯‰ xmakeï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ä¾èµ–é¡ºåºæ¥æ‰§è¡ŒåŒçº§åˆ«çš„è„šæœ¬ã€‚ ä¾‹å¦‚ï¼š ```lua rule(\"foo\", function() add_deps(\"bar\", {order true}) on_build_file(function (target, sourcefile) end) end) rule(\"bar\", function() on_build_file(function (target, sourcefile) end) end) ``` bar çš„ `on_build_file` å°†ä¼šè¢«å…ˆæ‰§è¡Œã€‚ ä¸è¿‡ï¼Œè¿™ç§æ§åˆ¶ä¾èµ–çš„æ–¹å¼ï¼Œåªé€‚åˆ foo å’Œ bar ä¸¤ä¸ªè§„åˆ™éƒ½æ˜¯è‡ªå®šä¹‰è§„åˆ™ï¼Œå¦‚æœæƒ³è¦å°†è‡ªå·±çš„è§„åˆ™æ’å…¥åˆ° xmake çš„å†…ç½®è§„åˆ™ä¹‹å‰æ‰§è¡Œï¼Œè¿™å°±ä¸é€‚ç”¨äº†ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ›´åŠ çµæ´»çš„åŠ¨æ€è§„åˆ™åˆ›å»ºå’Œæ³¨å…¥çš„æ–¹å¼ï¼Œå»ä¿®æ”¹å†…ç½®è§„åˆ™ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³åœ¨å†…ç½®çš„ `c++.build` è§„åˆ™ä¹‹å‰ï¼Œæ‰§è¡Œè‡ªå®šä¹‰ cppfront è§„åˆ™çš„ `on_build_file` è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥å®ç°ã€‚ ```lua rule(\"cppfront\", function() set_extensions(\".cpp2\") on_load(function (target) local rule target:rule(\"c++.build\"):clone() rule:add(\"deps\", \"cppfront\", {order true}) target:rule_add(rule) end) on_build_file(function (target, sourcefile, opt) print(\"build cppfront file\") end) end) target(\"test\", function() set_kind(\"binary\") add_rules(\"cppfront\") add_files(\"src/*.cpp\") add_files(\"src/*.cpp2\") end) ``` ## rule:add_imports ä¸ºæ‰€æœ‰è‡ªå®šä¹‰è„šæœ¬é¢„å…ˆå¯¼å…¥æ‰©å±•æ¨¡å—ã€‚ ä½¿ç”¨æ–¹å¼å’Œè¯´æ˜è¯·è§ï¼š[target:add_imports](#targetadd_imports)ï¼Œç”¨æ³•ç›¸åŒã€‚ ## rule:set_extensions è®¾ç½®è§„åˆ™æ”¯æŒçš„æ–‡ä»¶æ‰©å±•ç±»å‹ã€‚ é€šè¿‡è®¾ç½®æ”¯æŒçš„æ‰©å±•æ–‡ä»¶ç±»å‹ï¼Œå°†è§„åˆ™åº”ç”¨äºå¸¦è¿™äº›åç¼€çš„æ–‡ä»¶ä¸Šï¼Œä¾‹å¦‚ï¼š ```lua å®šä¹‰ä¸€ä¸ª markdown æ–‡ä»¶çš„æ„å»ºè§„åˆ™ rule(\"markdown\", function() set_extensions(\".md\", \".markdown\") on_build_file(function (target, sourcefile, opt) os.cp(sourcefile, path.join(target:targetdir(), path.basename(sourcefile) .. \".html\")) end) end) target(\"test\", function() set_kind(\"binary\") ä½¿ test ç›®æ ‡æ”¯æŒ markdown æ–‡ä»¶çš„æ„å»ºè§„åˆ™ add_rules(\"markdown\") æ·»åŠ  markdown æ–‡ä»¶çš„æ„å»º add_files(\"src/*.md\") add_files(\"src/*.markdown\") end) ``` ## rule:on_load è‡ªå®šä¹‰åŠ è½½è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šè§„åˆ™çš„åŠ è½½è„šæœ¬ï¼Œå½“åŠ è½½ target çš„æ—¶å€™ï¼Œä¼šè¢«æ‰§è¡Œï¼Œå¯åœ¨é‡Œé¢è‡ªå®šä¹‰è®¾ç½®ä¸€äº› target é…ç½®ï¼Œä¾‹å¦‚ï¼š ```lua rule(\"test\", function() on_load(function (target) target:add(\"defines\", \"TEST\") end) end) ``` ## rule:on_link è‡ªå®šä¹‰é“¾æ¥è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šè§„åˆ™çš„é“¾æ¥è„šæœ¬ï¼Œä¼šè¦†ç›–è¢«åº”ç”¨çš„ target çš„é»˜è®¤é“¾æ¥è¡Œä¸ºï¼Œä¾‹å¦‚ï¼š ```lua rule(\"test\", function() on_link(function (target) end) end) ``` ## rule:on_config è‡ªå®šä¹‰é…ç½®è„šæœ¬ã€‚ åœ¨ `xmake config` æ‰§è¡Œå®Œæˆåï¼ŒBuild ä¹‹å‰ä¼šæ‰§è¡Œæ­¤è„šæœ¬ï¼Œé€šå¸¸ç”¨äºç¼–è¯‘å‰çš„é…ç½®å·¥ä½œã€‚å®ƒä¸ on_load ä¸åŒçš„æ˜¯ï¼Œon_load åªè¦ target è¢«åŠ è½½å°±ä¼šæ‰§è¡Œï¼Œæ‰§è¡Œæ—¶æœºæ›´æ—©ã€‚ å¦‚æœä¸€äº›é…ç½®ï¼Œæ— æ³•åœ¨ on_load ä¸­è¿‡æ—©é…ç½®ï¼Œé‚£ä¹ˆéƒ½å¯ä»¥åœ¨ on_config ä¸­å»é…ç½®å®ƒã€‚ å¦å¤–ï¼Œå®ƒçš„æ‰§è¡Œæ—¶æœºæ¯” before_build è¿˜è¦æ—©ï¼Œå¤§æ¦‚çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š ``` on_load > after_load > on_config > before_build > on_build > after_build ``` ## rule:on_build è‡ªå®šä¹‰ç¼–è¯‘è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šè§„åˆ™çš„æ„å»ºè„šæœ¬ï¼Œä¼šè¦†ç›–è¢«åº”ç”¨çš„ target çš„é»˜è®¤æ„å»ºè¡Œä¸ºï¼Œä¾‹å¦‚ï¼š ```lua rule(\"markdown\", function() on_build(function (target) end) end) ``` ## rule:on_clean è‡ªå®šä¹‰æ¸…ç†è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šè§„åˆ™çš„æ¸…ç†è„šæœ¬ä¼šï¼Œè¦†ç›–è¢«åº”ç”¨çš„ target çš„é»˜è®¤æ¸…ç†è¡Œä¸ºï¼Œä¾‹å¦‚ï¼š ```lua rule(\"markdown\", function() on_clean(function (target) remove sourcefile.html end) end) ``` ## rule:on_package è‡ªå®šä¹‰æ‰“åŒ…è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šè§„åˆ™çš„æ‰“åŒ…è„šæœ¬ï¼Œè¦†ç›–è¢«åº”ç”¨çš„ target çš„é»˜è®¤æ‰“åŒ…è¡Œä¸º, ä¾‹å¦‚ï¼š ```lua rule(\"markdown\", function() on_package(function (target) package sourcefile.html end) end) ``` ## rule:on_install è‡ªå®šä¹‰å®‰è£…è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šè§„åˆ™çš„å®‰è£…è„šæœ¬ï¼Œè¦†ç›–è¢«åº”ç”¨çš„ target çš„é»˜è®¤å®‰è£…è¡Œä¸º, ä¾‹å¦‚ï¼š ```lua rule(\"markdown\", function() on_install(function (target) end) end) ``` ## rule:on_uninstall è‡ªå®šä¹‰å¸è½½è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šè§„åˆ™çš„å¸è½½è„šæœ¬ï¼Œè¦†ç›–è¢«åº”ç”¨çš„ target çš„é»˜è®¤å¸è½½è¡Œä¸º, ä¾‹å¦‚ï¼š ```lua rule(\"markdown\", function() on_uninstall(function (target) end) end) ``` ## rule:on_build_file è‡ªå®šä¹‰ç¼–è¯‘è„šæœ¬ï¼Œä¸€æ¬¡å¤„ç†ä¸€ä¸ªæºæ–‡ä»¶ã€‚ ```lua rule(\"markdown\", function() on_build_file(function (target, sourcefile, opt) print(\"%%%d: %s\", opt.progress, sourcefile) end) end) ``` å…¶ä¸­ç¬¬ä¸‰ä¸ªå‚æ•° opt æ˜¯å¯é€‰å‚æ•°ï¼Œç”¨äºè·å–ä¸€äº›ç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¿¡æ¯çŠ¶æ€ï¼Œä¾‹å¦‚ï¼šopt.progress ä¸ºå½“æœŸçš„ç¼–è¯‘è¿›åº¦ã€‚ ## rule:on_buildcmd_file è‡ªå®šä¹‰æ‰¹å¤„ç†ç¼–è¯‘è„šæœ¬ï¼Œä¸€æ¬¡å¤„ç†ä¸€ä¸ªæºæ–‡ä»¶ã€‚ è¿™ä¸ªæ¥å£é‡Œé¢çš„è„šæœ¬ä¸ä¼šç›´æ¥æ„å»ºæºæ–‡ä»¶ï¼Œä½†æ˜¯ä¼šé€šè¿‡ batchcmds å¯¹è±¡ï¼Œæ„é€ ä¸€ä¸ªæ‰¹å¤„ç†å‘½ä»¤è¡Œä»»åŠ¡ï¼Œ xmake åœ¨å®é™…æ‰§è¡Œæ„å»ºçš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚ è¿™å¯¹äº `xmake project` æ­¤ç±»å·¥ç¨‹ç”Ÿæˆå™¨æ’ä»¶éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºç”Ÿæˆå™¨ç”Ÿæˆçš„ç¬¬ä¸‰æ–¹å·¥ç¨‹æ–‡ä»¶å¹¶ä¸æ”¯æŒ `on_build_files` æ­¤ç±»å†…ç½®è„šæœ¬çš„æ‰§è¡Œæ”¯æŒã€‚ ä½†æ˜¯ `on_buildcmd_files` æ„é€ çš„æœ€ç»ˆç»“æœï¼Œå°±æ˜¯ä¸€æ‰¹åŸå§‹çš„ cmd å‘½ä»¤è¡Œï¼Œå¯ä»¥ç›´æ¥ç»™å…¶ä»–å·¥ç¨‹æ–‡ä»¶ä½œä¸º custom commands æ¥æ‰§è¡Œã€‚ å¦å¤–ï¼Œç›¸æ¯” `on_build_files`ï¼Œå®ƒä¹Ÿç®€åŒ–å¯¹æ‰©å±•æ–‡ä»¶çš„ç¼–è¯‘å®ç°ï¼Œæ›´åŠ çš„å¯è¯»æ˜“é…ç½®ï¼Œå¯¹ç”¨æˆ·ä¹Ÿæ›´åŠ å‹å¥½ã€‚ ```lua rule(\"foo\", function() set_extensions(\".xxx\") on_buildcmd_file(function (target, batchcmds, sourcefile, opt) batchcmds:vrunv(\"gcc\", {\" o\", objectfile, \" c\", sourcefile}) batchcmds:add_depfiles(\"/xxxxx/dependfile.h\", ...) batchcmds:add_depvalues(...) batchcmds:set_depmtime(os.mtime(...)) batchcmds:set_depcache(\"xxxx.d\") end) end) ``` é™¤äº† `batchcmds:vrunv`ï¼Œæˆ‘ä»¬è¿˜æ”¯æŒä¸€äº›å…¶ä»–çš„æ‰¹å¤„ç†å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š ```lua batchcmds:show(\"hello %s\", \"xmake\") batchcmds:vrunv(\"gcc\", {\" o\", objectfile, \" c\", sourcefile}, {envs {LD_LIBRARY_PATH \"/xxx\"}}) batchcmds:mkdir(\"/xxx\") and cp, mv, rm, ln .. batchcmds:compile(sourcefile_cx, objectfile, {configs {includedirs sourcefile_dir, languages (sourcekind \"cxx\" and \"c++11\")}}) batchcmds:link(objectfiles, targetfile, {configs {linkdirs \"\"}}) ``` åŒæ—¶ï¼Œæˆ‘ä»¬åœ¨é‡Œé¢ä¹Ÿç®€åŒ–å¯¹ä¾èµ–æ‰§è¡Œçš„é…ç½®ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´ä¾‹å­ï¼š ```lua rule(\"lex\", function() set_extensions(\".l\", \".ll\") on_buildcmd_file(function (target, batchcmds, sourcefile_lex, opt) imports import(\"lib.detect.find_tool\") get lex local lex assert(find_tool(\"flex\") or find_tool(\"lex\"), \"lex not found!\") get c/c++ source file for lex local extension path.extension(sourcefile_lex) local sourcefile_cx path.join(target:autogendir(), \"rules\", \"lex_yacc\", path.basename(sourcefile_lex) .. (extension \".ll\" and \".cpp\" or \".c\")) add objectfile local objectfile target:objectfile(sourcefile_cx) table.insert(target:objectfiles(), objectfile) add commands batchcmds:show_progress(opt.progress, \"${color.build.object}compiling.lex %s\", sourcefile_lex) batchcmds:mkdir(path.directory(sourcefile_cx)) batchcmds:vrunv(lex.program, {\" o\", sourcefile_cx, sourcefile_lex}) batchcmds:compile(sourcefile_cx, objectfile) add deps batchcmds:add_depfiles(sourcefile_lex) local dependfile target:dependfile(objectfile) batchcmds:set_depmtime(os.mtime(dependfile)) batchcmds:set_depcache(dependfile) end) end) ``` `add_depfiles` è®¾ç½®è¿™ä¸ªç›®æ ‡æ–‡ä»¶ä¾èµ–çš„æºæ–‡ä»¶ã€‚`set_depmtime` è®¾ç½®ç›®æ ‡æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ï¼Œå¦‚æœæœ‰ä»»æ„æºæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´å¤§äºå®ƒï¼Œåˆ™è®¤ä¸ºéœ€è¦é‡æ–°ç”Ÿæˆè¿™ä¸ªç›®æ ‡æ–‡ä»¶ã€‚è¿™é‡Œä½¿ç”¨ dependfile è€Œä¸æ˜¯ objectfile çš„åŸå› è§ [issues 748](https://github.com/xmake io/xmake/issues/748)ã€‚`set_depcache` è®¾ç½®å­˜å‚¨ä¾èµ–ä¿¡æ¯çš„æ–‡ä»¶ã€‚ å…³äºè¿™ä¸ªçš„è¯¦ç»†è¯´æ˜å’ŒèƒŒæ™¯ï¼Œè§ï¼š[issue 1246](https://github.com/xmake io/xmake/issues/1246) ## rule:on_build_files è‡ªå®šä¹‰ç¼–è¯‘è„šæœ¬ï¼Œä¸€æ¬¡å¤„ç†å¤šä¸ªæºæ–‡ä»¶ã€‚ å¤§éƒ¨åˆ†çš„è‡ªå®šä¹‰æ„å»ºè§„åˆ™ï¼Œæ¯æ¬¡éƒ½æ˜¯å¤„ç†å•ç‹¬ä¸€ä¸ªæ–‡ä»¶ï¼Œè¾“å‡ºä¸€ä¸ªç›®æ ‡æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼ša.c > a.o ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶è¾“å…¥å¤šä¸ªæºæ–‡ä»¶ä¸€èµ·æ„å»ºç”Ÿæˆä¸€ä¸ªç›®æ ‡æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼ša.c b.c d.c > x.o å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰è¿™ä¸ªè„šæœ¬æ¥å®ç°ï¼š ```lua rule(\"markdown\", function() on_build_files(function (target, sourcebatch, opt) build some source files for _, sourcefile in ipairs(sourcebatch.sourcefiles) do ... end end) end) ``` ## rule:on_buildcmd_files è‡ªå®šä¹‰æ‰¹å¤„ç†ç¼–è¯‘è„šæœ¬ï¼Œä¸€æ¬¡å¤„ç†å¤šä¸ªæºæ–‡ä»¶ã€‚ å…³äºè¿™ä¸ªçš„è¯¦ç»†è¯´æ˜ï¼Œè§ï¼š[rule:on_buildcmd_file](#ruleon_buildcmd_file) ```lua rule(\"foo\", function() set_extensions(\".xxx\") on_buildcmd_files(function (target, batchcmds, sourcebatch, opt) for _, sourcefile in ipairs(sourcebatch.sourcefiles) do batchcmds:vrunv(\"gcc\", {\" o\", objectfile, \" c\", sourcefile}) end end) end) ``` ## rule:before_config è‡ªå®šä¹‰é…ç½®å‰è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target é…ç½®å‰çš„æ‰§è¡Œè„šæœ¬ï¼Œä¾‹å¦‚ï¼š ```lua rule(\"test\", function() before_config(function (target) end) end) ``` å®ƒä¼šåœ¨ on_config ä¹‹å‰è¢«æ‰§è¡Œã€‚ ## rule:before_link è‡ªå®šä¹‰é“¾æ¥å‰è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target é“¾æ¥å‰çš„æ‰§è¡Œè„šæœ¬ï¼Œä¾‹å¦‚ï¼š ```lua rule(\"test\", function() before_link(function (target) end) end) ``` ## rule:before_build è‡ªå®šä¹‰ç¼–è¯‘å‰è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target æ„å»ºå‰çš„æ‰§è¡Œè„šæœ¬ï¼Œä¾‹å¦‚ï¼š ```lua rule(\"markdown\", function() before_build(function (target) end) end) ``` ## rule:before_clean è‡ªå®šä¹‰æ¸…ç†å‰è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target æ¸…ç†å‰çš„æ‰§è¡Œè„šæœ¬ï¼Œä¾‹å¦‚ï¼š ```lua rule(\"markdown\", function() before_clean(function (target) end) end) ``` ## rule:before_package è‡ªå®šä¹‰æ‰“åŒ…å‰è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target æ‰“åŒ…å‰çš„æ‰§è¡Œè„šæœ¬, ä¾‹å¦‚ï¼š ```lua rule(\"markdown\", function() before_package(function (target) end) end) ``` ## rule:before_install è‡ªå®šä¹‰å®‰è£…å‰è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target å®‰è£…å‰çš„æ‰§è¡Œè„šæœ¬ï¼Œä¾‹å¦‚ï¼š ```lua rule(\"markdown\", function() before_install(function (target) end) end) ``` ## rule:before_uninstall è‡ªå®šä¹‰å¸è½½å‰è„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target å¸è½½å‰çš„æ‰§è¡Œè„šæœ¬ï¼Œä¾‹å¦‚ï¼š ```lua rule(\"markdown\", function() before_uninstall(function (target) end) end) ``` ## rule:before_build_file è‡ªå®šä¹‰ç¼–è¯‘å‰è„šæœ¬ï¼Œä¸€æ¬¡å¤„ç†ä¸€ä¸ªæºæ–‡ä»¶ã€‚ è·Ÿ [rule:on_build_file](#ruleon_build_file) ç”¨æ³•ç±»ä¼¼ï¼Œä¸è¿‡è¿™ä¸ªæ¥å£è¢«è°ƒç”¨çš„æ—¶æœºæ˜¯åœ¨ç¼–è¯‘æŸä¸ªæºæ–‡ä»¶ä¹‹å‰ï¼Œ ä¸€èˆ¬ç”¨äºå¯¹æŸäº›æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘å‰çš„é¢„å¤„ç†ã€‚ ## rule:before_buildcmd_file è‡ªå®šä¹‰ç¼–è¯‘å‰æ‰¹å¤„ç†è„šæœ¬ï¼Œä¸€æ¬¡å¤„ç†ä¸€ä¸ªæºæ–‡ä»¶ã€‚ è·Ÿ [rule:on_buildcmd_file](#ruleon_buildcmd_file) ç”¨æ³•ç±»ä¼¼ï¼Œä¸è¿‡è¿™ä¸ªæ¥å£è¢«è°ƒç”¨çš„æ—¶æœºæ˜¯åœ¨ç¼–è¯‘æŸä¸ªæºæ–‡ä»¶ä¹‹å‰ï¼Œ ä¸€èˆ¬ç”¨äºå¯¹æŸäº›æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘å‰çš„é¢„å¤„ç†ã€‚ ## rule:before_build_files è‡ªå®šä¹‰ç¼–è¯‘å‰è„šæœ¬ï¼Œä¸€æ¬¡å¤„ç†å¤šä¸ªæºæ–‡ä»¶ã€‚ è·Ÿ [rule:on_build_files](#ruleon_build_files) ç”¨æ³•ç±»ä¼¼ï¼Œä¸è¿‡è¿™ä¸ªæ¥å£è¢«è°ƒç”¨çš„æ—¶æœºæ˜¯åœ¨ç¼–è¯‘æŸäº›æºæ–‡ä»¶ä¹‹å‰ï¼Œ ä¸€èˆ¬ç”¨äºå¯¹æŸäº›æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘å‰çš„é¢„å¤„ç†ã€‚ ## rule:before_buildcmd_files è‡ªå®šä¹‰ç¼–è¯‘å‰æ‰¹å¤„ç†è„šæœ¬ï¼Œä¸€æ¬¡å¤„ç†å¤šä¸ªæºæ–‡ä»¶ã€‚ è·Ÿ [rule:on_buildcmd_files](#ruleon_buildcmd_files) ç”¨æ³•ç±»ä¼¼ï¼Œä¸è¿‡è¿™ä¸ªæ¥å£è¢«è°ƒç”¨çš„æ—¶æœºæ˜¯åœ¨ç¼–è¯‘æŸäº›æºæ–‡ä»¶ä¹‹å‰ï¼Œ ä¸€èˆ¬ç”¨äºå¯¹æŸäº›æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘å‰çš„é¢„å¤„ç†ã€‚ ## rule:after_config è‡ªå®šä¹‰é…ç½®åè„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target é…ç½®åçš„æ‰§è¡Œè„šæœ¬ï¼Œä¾‹å¦‚ï¼š ```lua rule(\"test\", function() after_config(function (target) end) end) ``` å®ƒä¼šåœ¨ on_config ä¹‹åè¢«æ‰§è¡Œã€‚ ## rule:after_link è‡ªå®šä¹‰é“¾æ¥åè„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target é“¾æ¥åçš„æ‰§è¡Œè„šæœ¬ï¼Œç”¨æ³•è·Ÿ [rule:before_link](#rulebefore_link) ç±»ä¼¼ã€‚ ## rule:after_build è‡ªå®šä¹‰ç¼–è¯‘åè„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target æ„å»ºåçš„æ‰§è¡Œè„šæœ¬ï¼Œç”¨æ³•è·Ÿ [rule:before_build](#rulebefore_build) ç±»ä¼¼ã€‚ ## rule:after_clean è‡ªå®šä¹‰æ¸…ç†åè„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target æ¸…ç†åçš„æ‰§è¡Œè„šæœ¬ï¼Œç”¨æ³•è·Ÿ [rule:before_clean](#rulebefore_clean) ç±»ä¼¼ã€‚ ## rule:after_package è‡ªå®šä¹‰æ‰“åŒ…åè„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target æ‰“åŒ…åçš„æ‰§è¡Œè„šæœ¬, ç”¨æ³•è·Ÿ [rule:before_package](#rulebefore_package) ç±»ä¼¼ã€‚ ## rule:after_install è‡ªå®šä¹‰å®‰è£…åè„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target å®‰è£…åçš„æ‰§è¡Œè„šæœ¬ï¼Œç”¨æ³•è·Ÿ [rule:before_install](#rulebefore_install) ç±»ä¼¼ã€‚ ## rule:after_uninstall è‡ªå®šä¹‰å¸è½½åè„šæœ¬ã€‚ ç”¨äºå®ç°è‡ªå®šä¹‰ target å¸è½½åçš„æ‰§è¡Œè„šæœ¬ï¼Œç”¨æ³•è·Ÿ [rule:before_uninstall](#rulebefore_uninstall) ç±»ä¼¼ã€‚ ## rule:after_build_file è‡ªå®šä¹‰ç¼–è¯‘åè„šæœ¬ï¼Œä¸€æ¬¡å¤„ç†ä¸€ä¸ªæºæ–‡ä»¶ã€‚ è·Ÿ [rule:on_build_file](#ruleon_build_file) ç”¨æ³•ç±»ä¼¼ï¼Œä¸è¿‡è¿™ä¸ªæ¥å£è¢«è°ƒç”¨çš„æ—¶æœºæ˜¯åœ¨ç¼–è¯‘æŸä¸ªæºæ–‡ä»¶ä¹‹åï¼Œ ä¸€èˆ¬ç”¨äºå¯¹æŸäº›ç¼–è¯‘åå¯¹è±¡æ–‡ä»¶è¿›è¡ŒåæœŸå¤„ç†ã€‚ ## rule:after_buildcmd_file è‡ªå®šä¹‰ç¼–è¯‘åæ‰¹å¤„ç†è„šæœ¬ï¼Œä¸€æ¬¡å¤„ç†ä¸€ä¸ªæºæ–‡ä»¶ã€‚ è·Ÿ [rule:on_buildcmd_file](#ruleon_buildcmd_file) ç”¨æ³•ç±»ä¼¼ï¼Œä¸è¿‡è¿™ä¸ªæ¥å£è¢«è°ƒç”¨çš„æ—¶æœºæ˜¯åœ¨ç¼–è¯‘æŸä¸ªæºæ–‡ä»¶ä¹‹åï¼Œ ä¸€èˆ¬ç”¨äºå¯¹æŸäº›ç¼–è¯‘åå¯¹è±¡æ–‡ä»¶è¿›è¡ŒåæœŸå¤„ç†ã€‚ ## rule:after_build_files è‡ªå®šä¹‰ç¼–è¯‘åè„šæœ¬ï¼Œä¸€æ¬¡å¤„ç†å¤šä¸ªæºæ–‡ä»¶ã€‚ è·Ÿ [rule:on_build_files](#ruleon_build_files) ç”¨æ³•ç±»ä¼¼ï¼Œä¸è¿‡è¿™ä¸ªæ¥å£è¢«è°ƒç”¨çš„æ—¶æœºæ˜¯åœ¨ç¼–è¯‘æŸäº›æºæ–‡ä»¶ä¹‹åï¼Œ ä¸€èˆ¬ç”¨äºå¯¹æŸäº›ç¼–è¯‘åå¯¹è±¡æ–‡ä»¶è¿›è¡ŒåæœŸå¤„ç†ã€‚ ## rule:after_buildcmd_files è‡ªå®šä¹‰ç¼–è¯‘åæ‰¹å¤„ç†è„šæœ¬ï¼Œä¸€æ¬¡å¤„ç†å¤šä¸ªæºæ–‡ä»¶ã€‚ è·Ÿ [rule:on_buildcmd_files](#ruleon_buildcmd_files) ç”¨æ³•ç±»ä¼¼ï¼Œä¸è¿‡è¿™ä¸ªæ¥å£è¢«è°ƒç”¨çš„æ—¶æœºæ˜¯åœ¨ç¼–è¯‘æŸäº›æºæ–‡ä»¶ä¹‹åï¼Œ ä¸€èˆ¬ç”¨äºå¯¹æŸäº›ç¼–è¯‘åå¯¹è±¡æ–‡ä»¶è¿›è¡ŒåæœŸå¤„ç†ã€‚"},"/get_started/zh/rule/builtin-rules.html":{"title":"","content":" class: heading_no_counter # å†…å»ºè§„åˆ™ xmake æä¾›äº†ä¸€äº›å†…ç½®è§„åˆ™å»ç®€åŒ–æ—¥å¸¸ xmake.lua æè¿°ï¼Œä»¥åŠä¸€äº›å¸¸ç”¨æ„å»ºç¯å¢ƒçš„æ”¯æŒã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹å®Œæ•´çš„å†…ç½®è§„åˆ™åˆ—è¡¨ï¼š ```bash $ xmake show l rules ``` ## mode.debug ä¸ºå½“å‰å·¥ç¨‹ xmake.lua æ·»åŠ  debug ç¼–è¯‘æ¨¡å¼çš„é…ç½®è§„åˆ™ï¼Œä¾‹å¦‚ï¼š ```lua add_rules(\"mode.debug\") ``` ç›¸å½“äºï¼š ```lua if is_mode(\"debug\") then set_symbols(\"debug\") set_optimize(\"none\") end ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f m debug` æ¥åˆ‡æ¢åˆ°æ­¤ç¼–è¯‘æ¨¡å¼ã€‚ ## mode.release ä¸ºå½“å‰å·¥ç¨‹ xmake.lua æ·»åŠ  release ç¼–è¯‘æ¨¡å¼çš„é…ç½®è§„åˆ™ï¼Œä¾‹å¦‚ï¼š ```lua add_rules(\"mode.release\") ``` > æ­¤æ¨¡å¼é»˜è®¤ä¸ä¼šå¸¦è°ƒè¯•ç¬¦å·ã€‚ ç›¸å½“äºï¼š ```lua if is_mode(\"release\") then set_symbols(\"hidden\") set_optimize(\"fastest\") set_strip(\"all\") end ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f m release` æ¥åˆ‡æ¢åˆ°æ­¤ç¼–è¯‘æ¨¡å¼ã€‚ ## mode.releasedbg ä¸ºå½“å‰å·¥ç¨‹ xmake.lua æ·»åŠ  releasedbg ç¼–è¯‘æ¨¡å¼çš„é…ç½®è§„åˆ™ï¼Œä¾‹å¦‚ï¼š ```lua add_rules(\"mode.releasedbg\") ``` > ä¸ release æ¨¡å¼ç›¸æ¯”ï¼Œæ­¤æ¨¡å¼è¿˜ä¼šé¢å¤–å¼€å¯è°ƒè¯•ç¬¦å·ï¼Œè¿™é€šå¸¸æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ ç›¸å½“äºï¼š ```lua if is_mode(\"releasedbg\") then set_symbols(\"debug\") set_optimize(\"fastest\") set_strip(\"all\") end ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f m releasedbg` æ¥åˆ‡æ¢åˆ°æ­¤ç¼–è¯‘æ¨¡å¼ã€‚ ## mode.minsizerel ä¸ºå½“å‰å·¥ç¨‹ xmake.lua æ·»åŠ  minsizerel ç¼–è¯‘æ¨¡å¼çš„é…ç½®è§„åˆ™ï¼Œä¾‹å¦‚ï¼š ```lua add_rules(\"mode.minsizerel\") ``` > ä¸ release æ¨¡å¼ç›¸æ¯”ï¼Œæ­¤æ¨¡å¼æ›´åŠ å€¾å‘äºæœ€å°ä»£ç ç¼–è¯‘ä¼˜åŒ–ï¼Œè€Œä¸æ˜¯é€Ÿåº¦ä¼˜å…ˆã€‚ ç›¸å½“äºï¼š ```lua if is_mode(\"minsizerel\") then set_symbols(\"hidden\") set_optimize(\"smallest\") set_strip(\"all\") end ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f m minsizerel` æ¥åˆ‡æ¢åˆ°æ­¤ç¼–è¯‘æ¨¡å¼ã€‚ ## mode.check ä¸ºå½“å‰å·¥ç¨‹ xmake.lua æ·»åŠ  check ç¼–è¯‘æ¨¡å¼çš„é…ç½®è§„åˆ™ï¼Œä¸€èˆ¬ç”¨äºå†…å­˜æ£€æµ‹ï¼Œä¾‹å¦‚ï¼š ```lua add_rules(\"mode.check\") ``` ç›¸å½“äºï¼š ```lua if is_mode(\"check\") then set_symbols(\"debug\") set_optimize(\"none\") add_cxflags(\" fsanitize address\", \" ftrapv\") add_mxflags(\" fsanitize address\", \" ftrapv\") add_ldflags(\" fsanitize address\") end ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f m check` æ¥åˆ‡æ¢åˆ°æ­¤ç¼–è¯‘æ¨¡å¼ã€‚ ## mode.profile ä¸ºå½“å‰å·¥ç¨‹ xmake.lua æ·»åŠ  profile ç¼–è¯‘æ¨¡å¼çš„é…ç½®è§„åˆ™ï¼Œä¸€èˆ¬ç”¨äºæ€§èƒ½åˆ†æï¼Œä¾‹å¦‚ï¼š ```lua add_rules(\"mode.profile\") ``` ç›¸å½“äºï¼š ```lua if is_mode(\"profile\") then set_symbols(\"debug\") add_cxflags(\" pg\") add_ldflags(\" pg\") end ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f m profile` æ¥åˆ‡æ¢åˆ°æ­¤ç¼–è¯‘æ¨¡å¼ã€‚ ## mode.coverage ä¸ºå½“å‰å·¥ç¨‹ xmake.lua æ·»åŠ  coverage ç¼–è¯‘æ¨¡å¼çš„é…ç½®è§„åˆ™ï¼Œä¸€èˆ¬ç”¨äºè¦†ç›–åˆ†æï¼Œä¾‹å¦‚ï¼š ```lua add_rules(\"mode.coverage\") ``` ç›¸å½“äºï¼š ```lua if is_mode(\"coverage\") then add_cxflags(\" coverage\") add_mxflags(\" coverage\") add_ldflags(\" coverage\") end ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f m coverage` æ¥åˆ‡æ¢åˆ°æ­¤ç¼–è¯‘æ¨¡å¼ã€‚ ## mode.valgrind æ­¤æ¨¡å¼æä¾› valgrind å†…å­˜åˆ†ææ£€æµ‹æ”¯æŒã€‚ ```lua add_rules(\"mode.valgrind\") ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f m valgrind` æ¥åˆ‡æ¢åˆ°æ­¤ç¼–è¯‘æ¨¡å¼ã€‚ ## mode.asan æ­¤æ¨¡å¼æä¾› AddressSanitizer å†…å­˜åˆ†ææ£€æµ‹æ”¯æŒã€‚ ```lua add_rules(\"mode.asan\") ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f m asan` æ¥åˆ‡æ¢åˆ°æ­¤ç¼–è¯‘æ¨¡å¼ã€‚ ## mode.tsan æ­¤æ¨¡å¼æä¾› ThreadSanitizer å†…å­˜åˆ†ææ£€æµ‹æ”¯æŒã€‚ ```lua add_rules(\"mode.tsan\") ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f m tsan` æ¥åˆ‡æ¢åˆ°æ­¤ç¼–è¯‘æ¨¡å¼ã€‚ ## mode.lsan æ­¤æ¨¡å¼æä¾› LeakSanitizer å†…å­˜åˆ†ææ£€æµ‹æ”¯æŒã€‚ ```lua add_rules(\"mode.lsan\") ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f m lsan` æ¥åˆ‡æ¢åˆ°æ­¤ç¼–è¯‘æ¨¡å¼ã€‚ ## mode.ubsan æ­¤æ¨¡å¼æä¾› UndefinedBehaviorSanitizer å†…å­˜åˆ†ææ£€æµ‹æ”¯æŒã€‚ ```lua add_rules(\"mode.ubsan\") ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f m ubsan` æ¥åˆ‡æ¢åˆ°æ­¤ç¼–è¯‘æ¨¡å¼ã€‚ ## qt.static ç”¨äºç¼–è¯‘ç”Ÿæˆ Qt ç¯å¢ƒçš„é™æ€åº“ç¨‹åºï¼š ```lua target(\"test\", function() add_rules(\"qt.static\") add_files(\"src/*.cpp\") add_frameworks(\"QtNetwork\", \"QtGui\") end) ``` ## qt.shared ç”¨äºç¼–è¯‘ç”Ÿæˆ Qt ç¯å¢ƒçš„åŠ¨æ€åº“ç¨‹åºï¼š ```lua target(\"test\", function() add_rules(\"qt.shared\") add_files(\"src/*.cpp\") add_frameworks(\"QtNetwork\", \"QtGui\") end) ``` ## qt.console ç”¨äºç¼–è¯‘ç”Ÿæˆ Qt ç¯å¢ƒçš„æ§åˆ¶å°ç¨‹åºï¼š ```lua target(\"test\", function() add_rules(\"qt.console\") add_files(\"src/*.cpp\") end) ``` ## qt.quickapp ç”¨äºç¼–è¯‘ç”Ÿæˆ Qt ç¯å¢ƒçš„ Quick(qml) ui åº”ç”¨ç¨‹åºã€‚ ```lua target(\"test\", function() add_rules(\"qt.quickapp\") add_files(\"src/*.cpp\") add_files(\"src/qml.qrc\") end) ``` ## qt.quickapp_static ç”¨äºç¼–è¯‘ç”Ÿæˆ Qt ç¯å¢ƒçš„ Quick(qml) ui åº”ç”¨ç¨‹åºï¼ˆé™æ€é“¾æ¥ç‰ˆæœ¬ï¼‰ã€‚ > éœ€è¦åˆ‡æ¢åˆ°é™æ€åº“ç‰ˆæœ¬ Qt SDK ```lua target(\"test\", function() add_rules(\"qt.quickapp_static\") add_files(\"src/*.cpp\") add_files(\"src/qml.qrc\") end) ``` ## qt.widgetapp ç”¨äºç¼–è¯‘ Qt Widgets(ui/moc) åº”ç”¨ç¨‹åº ```lua target(\"test\", function() add_rules(\"qt.widgetapp\") add_files(\"src/*.cpp\") add_files(\"src/mainwindow.ui\") add_files(\"src/mainwindow.h\") æ·»åŠ å¸¦æœ‰ Q_OBJECT çš„ meta å¤´æ–‡ä»¶ end) ``` ## qt.widgetapp_static ç”¨äºç¼–è¯‘ Qt Widgets(ui/moc) åº”ç”¨ç¨‹åºï¼ˆé™æ€åº“ç‰ˆæœ¬ï¼‰ > éœ€è¦åˆ‡æ¢åˆ°é™æ€åº“ç‰ˆæœ¬ Qt SDK ```lua target(\"test\", function() add_rules(\"qt.widgetapp_static\") add_files(\"src/*.cpp\") add_files(\"src/mainwindow.ui\") add_files(\"src/mainwindow.h\") æ·»åŠ å¸¦æœ‰ Q_OBJECT çš„ meta å¤´æ–‡ä»¶ end) ``` æ›´å¤š Qt ç›¸å…³æè¿°è§ï¼š[#160](https://github.com/xmake io/xmake/issues/160) ## xcode.bundle ç”¨äºç¼–è¯‘ç”Ÿæˆ ios/macos bundle ç¨‹åº ```lua target(\"test\", function() add_rules(\"xcode.bundle\") add_files(\"src/*.m\") add_files(\"src/Info.plist\") end) ``` ## xcode.framework ç”¨äºç¼–è¯‘ç”Ÿæˆ ios/macos framework ç¨‹åº ```lua target(\"test\", function() add_rules(\"xcode.framework\") add_files(\"src/*.m\") add_files(\"src/Info.plist\") end) ``` ## xcode.application ç”¨äºç¼–è¯‘ç”Ÿæˆ ios/macos åº”ç”¨ç¨‹åº ```lua target(\"test\", function() add_rules(\"xcode.application\") add_files(\"src/*.m\", \"src/**.storyboard\", \"src/*.xcassets\") add_files(\"src/Info.plist\") end) ``` ## plugin.compile_commands.autoupdate æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªè§„åˆ™æ¥è‡ªåŠ¨æ›´æ–°ç”Ÿæˆ compile_commandss.json ```lua add_rules(\"plugin.compile_commands.autoupdate\", {outputdir \".vscode\"}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` ## utils.symbols.export_list æˆ‘ä»¬å¯ä»¥åœ¨ xmake.lua é‡Œé¢ç›´æ¥å®šä¹‰å¯¼å‡ºçš„ç¬¦å·åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼š ```lua target(\"foo\", function() set_kind(\"shared\") add_files(\"src/foo.c\") add_rules(\"utils.symbols.export_list\", {symbols { \"add\", \"sub\"}}) end) ``` æˆ–è€…ï¼Œåœ¨ `*.export.txt` æ–‡ä»¶ä¸­æ·»åŠ å¯¼å‡ºçš„ç¬¦å·åˆ—è¡¨ã€‚ ```lua target(\"foo2\", function() set_kind(\"shared\") add_files(\"src/foo.c\") add_files(\"src/foo.export.txt\") add_rules(\"utils.symbols.export_list\") end) ``` å®Œæ•´çš„å·¥ç¨‹ä¾‹å­è§ï¼š[å¯¼å‡ºç¬¦å·ä¾‹å­](https://github.com/xmake io/xmake/tree/dev/tests/projects/c/shared_library_export_list) ## utils.install.cmake_importfiles å¯ä»¥ä½¿ç”¨æ­¤è§„åˆ™åœ¨å®‰è£… target ç›®æ ‡åº“æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯¼å‡º .cmake æ–‡ä»¶ï¼Œç”¨äºå…¶ä»– cmake é¡¹ç›®çš„åº“å¯¼å…¥å’ŒæŸ¥æ‰¾ã€‚ ## utils.install.pkgconfig_importfiles å¯ä»¥ä½¿ç”¨æ­¤è§„åˆ™åœ¨å®‰è£… target ç›®æ ‡åº“æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯¼å‡º pkgconfig/.pc æ–‡ä»¶ï¼Œç”¨äºå…¶ä»–é¡¹ç›®çš„åº“å¯¼å…¥å’ŒæŸ¥æ‰¾ã€‚ ## utils.bin2c å¯ä»¥ä½¿ç”¨æ­¤è§„åˆ™ï¼Œåœ¨é¡¹ç›®ä¸­å¼•å…¥ä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶è§ä»–ä»¬ä½œä¸º c/c++ å¤´æ–‡ä»¶çš„æ–¹å¼æä¾›å¼€å‘è€…ä½¿ç”¨ï¼Œè·å–è¿™äº›æ–‡ä»¶çš„æ•°æ®ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®ä¸­ï¼Œå†…åµŒä¸€äº› png/jpg èµ„æºæ–‡ä»¶åˆ°ä»£ç ä¸­ã€‚ ```lua target(\"console\", function() set_kind(\"binary\") add_rules(\"utils.bin2c\", {extensions {\".png\", \".jpg\"}}) add_files(\"src/*.c\") add_files(\"res/*.png\", \"res/*.jpg\") end) ``` > extensions çš„è®¾ç½®æ˜¯å¯é€‰çš„ï¼Œé»˜è®¤åç¼€åæ˜¯ .bin ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ `#include \"filename.png.h\"` çš„æ–¹å¼å¼•å…¥è¿›æ¥ä½¿ç”¨ï¼Œxmake ä¼šè‡ªåŠ¨å¸®ä½ ç”Ÿæˆå¯¹åº”çš„å¤´æ–‡ä»¶ï¼Œå¹¶ä¸”æ·»åŠ å¯¹åº”çš„æœç´¢ç›®å½•ã€‚ ```c static unsigned char g_png_data[] { #include \"image.png.h\" }; int main(int argc, char** argv) { printf(\"image.png: %s, size: %d\\n\", g_png_data, sizeof(g_png_data)); return 0; } ``` ç”Ÿæˆå¤´æ–‡ä»¶å†…å®¹ç±»ä¼¼ï¼š ```console cat build/.gens/test/macosx/x86_64/release/rules/c++/bin2c/image.png.h 0x68, 0x65, 0x6C, 0x6C, 0x6F, 0x20, 0x78, 0x6D, 0x61, 0x6B, 0x65, 0x21, 0x0A, 0x00 ``` ## utils.glsl2spv å¯ä»¥ä½¿ç”¨æ­¤è§„åˆ™ï¼Œåœ¨é¡¹ç›®ä¸­å¼•å…¥ `*.vert/*.frag` ç­‰ glsl shader æ–‡ä»¶ï¼Œç„¶åå®ç°è‡ªåŠ¨ç¼–è¯‘ç”Ÿæˆ `*.spv` æ–‡ä»¶ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬è¿˜æ”¯æŒä»¥ C/C++ å¤´æ–‡ä»¶çš„æ–¹å¼ï¼ŒäºŒè¿›åˆ¶å†…åµŒ spv æ–‡ä»¶æ•°æ®ï¼Œæ–¹ä¾¿ç¨‹åºä½¿ç”¨ã€‚ ### ç¼–è¯‘ç”Ÿæˆ spv æ–‡ä»¶ xmake ä¼šè‡ªåŠ¨è°ƒç”¨ glslangValidator æˆ–è€… glslc å»ç¼–è¯‘ shaders ç”Ÿæˆ .spv æ–‡ä»¶ï¼Œç„¶åè¾“å‡ºåˆ°æŒ‡å®šçš„ `{outputdir \"build\"}` ç›®å½•ä¸‹ã€‚ ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"glslang\", {configs {binaryonly true}}) target(\"test\", function() set_kind(\"binary\") add_rules(\"utils.glsl2spv\", {outputdir \"build\"}) add_files(\"src/*.c\") add_files(\"src/*.vert\", \"src/*.frag\") add_packages(\"glslang\") end) ``` > æ³¨ï¼Œè¿™é‡Œçš„ `add_packages(\"glslang\")` ä¸»è¦ç”¨äºå¼•å…¥å’Œç»‘å®š glslang åŒ…ä¸­çš„ glslangValidatorï¼Œç¡®ä¿ xmake æ€»å½’èƒ½å¤Ÿä½¿ç”¨å®ƒã€‚ å½“ç„¶ï¼Œå¦‚æœç”¨æˆ·è‡ªå·±ç³»ç»Ÿä¸Šå·²ç»å®‰è£…äº†å®ƒï¼Œä¹Ÿå¯ä»¥ä¸ç”¨é¢å¤–ç»‘å®šè¿™ä¸ªåŒ…ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯å»ºè®®æ·»åŠ ä¸€ä¸‹ã€‚ ### ç¼–è¯‘ç”Ÿæˆ c/c++ å¤´æ–‡ä»¶ æˆ‘ä»¬ä¹Ÿå¯ä»¥å†…éƒ¨å€ŸåŠ© bin2c æ¨¡å—ï¼Œå°†ç¼–è¯‘åçš„ spv æ–‡ä»¶ç”Ÿæˆå¯¹åº”çš„äºŒè¿›åˆ¶å¤´æ–‡ä»¶ï¼Œæ–¹ä¾¿ç”¨æˆ·ä»£ç ä¸­ç›´æ¥å¼•å…¥ï¼Œæˆ‘ä»¬åªéœ€è¦å¯ç”¨ `{bin2c true}`ã€‚: ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"glslang\", {configs {binaryonly true}}) target(\"test\", function() set_kind(\"binary\") add_rules(\"utils.glsl2spv\", {bin2c true}) add_files(\"src/*.c\") add_files(\"src/*.vert\", \"src/*.frag\") add_packages(\"glslang\") end) ``` ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç è¿™ä¹ˆå¼•å…¥ï¼š ```c static unsigned char g_test_vert_spv_data[] { #include \"test.vert.spv.h\" }; static unsigned char g_test_frag_spv_data[] { #include \"test.frag.spv.h\" }; ``` è·Ÿ bin2c è§„åˆ™çš„ä½¿ç”¨æ–¹å¼ç±»ä¼¼ï¼Œå®Œæ•´ä¾‹å­è§ï¼š[glsl2spv example](https://github.com/xmake io/xmake/tree/master/tests/projects/other/glsl2spv) ## utils.hlsl2spv é™¤äº† `utils.glsl2spv` è§„åˆ™ï¼Œæˆ‘ä»¬ç°åœ¨è¿˜æ”¯æŒ `utils.hlsl2spv` è§„åˆ™ã€‚ ```bash add_rules(\"mode.debug\", \"mode.release\") add_requires(\"glslang\", {configs {binaryonly true}}) target(\"test\", function() set_kind(\"binary\") add_rules(\"utils.hlsl2spv\", {bin2c true}) add_files(\"src/*.c\") add_files(\"src/*.hlsl\", \"src/*.hlsl\") add_packages(\"directxshadercompiler\") end) ``` ## python.library æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªè§„åˆ™ï¼Œé…åˆ pybind11 ç”Ÿæˆ python åº“æ¨¡å—ï¼Œå®ƒä¼šè°ƒæ•´ python åº“çš„æ¨¡å—åã€‚ ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"pybind11\") target(\"example\", function() add_rules(\"python.library\") add_files(\"src/*.cpp\") add_packages(\"pybind11\") set_languages(\"c++11\") end) ``` å¸¦æœ‰ soabiï¼š ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"pybind11\") target(\"example\", function() add_rules(\"python.library\", {soabi true}) add_files(\"src/*.cpp\") add_packages(\"pybind11\") set_languages(\"c++11\") end) ``` ## nodejs.module æ„å»º nodejs æ¨¡å—ã€‚ ```lua add_requires(\"node addon api\") target(\"foo\", function() set_languages(\"cxx17\") add_rules(\"nodejs.module\") add_packages(\"node addon api\") add_files(\"*.cc\") end) ``` ## utils.ipsc ipsc ç¼–è¯‘å™¨è§„åˆ™æ”¯æŒï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_rules(\"utils.ispc\", {header_extension \"_ispc.h\"}) set_values(\"ispc.flags\", \" target host\") add_files(\"src/*.ispc\") add_files(\"src/*.cpp\") end) ```"},"/get_started/zh/tutorial/install.html":{"title":"","content":" class: heading_no_counter # å®‰è£… ## æºç ç¼–è¯‘å®‰è£… ### å®‰è£… > åˆ‡è®°ï¼Œxmake ä¸å»ºè®®åœ¨ root ä¸‹å®‰è£…å’Œä½¿ç”¨ï¼Œæ‰€ä»¥å°½é‡ä¸è¦åœ¨ root ä¸‹æ‹‰å–æºç ç¼–è¯‘å®‰è£…ã€‚ ```bash git clone https://github.com/TOMO CAT/xmake.git cd ./xmake bash scripts/install.sh ``` å¦‚æœæ²¡æœ‰å¤–ç½‘ç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡ gitee é•œåƒæ‹‰å–ï¼ˆxmake repo ä¹Ÿä¼šè‡ªåŠ¨åˆ‡åˆ° gitee æºï¼‰ï¼š ```bash git clone https://gitee.com/tomocat/xmake.git ``` å®‰è£…å®Œåæ£€æŸ¥æ˜¯å¦å®‰è£…å®Œæˆï¼š ```bash xmake version ``` ### å¯ç”¨ Luajit å¯¹äºä¸€äº›å¤§å‹é¡¹ç›®ï¼ˆæ¯”å¦‚åŒ…å« 300+ targetsï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¯ç”¨ Luajit åŠ é€Ÿæ„å»ºï¼Œæå‡æ„å»ºé€Ÿåº¦ã€‚ ```bash bash scripts/install.sh runtime luajit ``` ### ä»…æ›´æ–° lua è„šæœ¬ è¿™ä¸ªå¼€å‘è€…æœ¬åœ°è°ƒè¯• xmake æºç æ‰éœ€è¦ï¼š ```bash ./scripts/get.sh __local__ __install_only__ ``` ### ç¼–è¯‘ xmake bundle åŒ… é»˜è®¤ç¼–è¯‘æ–¹å¼ä¼šå®‰è£… xmake äºŒè¿›åˆ¶å’Œ Lua è„šæœ¬ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯æ–¹ä¾¿æºç è°ƒè¯• Lua è„šæœ¬ï¼Œä½†æ˜¯ä¸æ–¹ä¾¿å‘å¸ƒå’Œè¿ç§»ï¼Œå¯ä»¥åªç¼–è¯‘ xmake äºŒè¿›åˆ¶ï¼š ```bash # TODO: ``` ### root ä¸‹å®‰è£… xmake ä¸æ¨è root ä¸‹å®‰è£…ä½¿ç”¨ï¼Œå› ä¸ºè¿™å¾ˆä¸å®‰å…¨ã€‚å› æ­¤ä»¥ root ç”¨æˆ·è¿è¡Œ xmake ä¼šæ‰“å°ä¸€æ¡ warning æ—¥å¿—ï¼Œç”¨æˆ·å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ `XMAKE_ROOT y` å±è”½ç›¸å…³çš„æŠ¥è­¦ï¼Œç”¨æˆ·éœ€è¦éšæ—¶æ³¨æ„rootä¸‹è¯¯æ“ä½œç³»ç»Ÿæ–‡ä»¶æ–‡ä»¶çš„é£é™©ã€‚ ### å¯ç”¨ ccache é»˜è®¤æƒ…å†µä¸‹ xmake ç”¨çš„æ˜¯å†…éƒ¨çš„ xcacheï¼Œä½†å¯èƒ½ä¼šå‡ºç°ä¸€äº›éé¢„æœŸçš„ bugã€‚å¦‚æœéœ€è¦å¯ç”¨ ccacheï¼Œå¯ä»¥æ‰‹åŠ¨å®‰è£… ccacheï¼Œxmakeä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨ã€‚ ## æ›´æ–°å‡çº§ æˆ‘ä»¬å¯ä»¥é€šè¿‡ `xmake update` å‘½ä»¤æ¥å¿«é€Ÿè¿›è¡Œè‡ªæˆ‘æ›´æ–°å’Œå‡çº§ï¼Œé»˜è®¤æ˜¯å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šå‡çº§æˆ–è€…å›é€€åˆ°æŸä¸ª tag ç‰ˆæœ¬ï¼š ```bash # å¦‚æœä¸æ˜¯ force çš„è¯, xmake ç‰ˆæœ¬ä¸€æ ·å°±ä¼šè·³è¿‡å®‰è£…, ä¸ä¼šç²¾ç¡®åˆ° git tag / branch # ä¾‹å¦‚ xmake v3.0.4+dev.39db22335 ç‰ˆæœ¬ä¹Ÿä¼šè·³è¿‡ xmake update force diagnosis verbose v3.0.4 ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šæ›´æ–°åˆ° master/dev åˆ†æ”¯ç‰ˆæœ¬ï¼š ```bash xmake update master xmake update dev ``` ä»æŒ‡å®š git æºæ›´æ–°ï¼š ```bash # æŒ‡å®š github æº xmake update github:TOMO CAT/xmake#master # æŒ‡å®š gitee æº xmake update gitee:tomocat/xmake#dev ``` å¦‚æœ xmake/core æ²¡åŠ¨è¿‡ï¼Œä»…ä»…æ›´æ–° xmake çš„ lua è„šæœ¬æ”¹åŠ¨ï¼Œå¯ä»¥åŠ  ` s/ scriptonly` å¿«é€Ÿæ›´æ–° lua è„šæœ¬ï¼š ```bash xmake update scriptonly force dev ``` ## å¸è½½ æœ€åï¼Œæˆ‘ä»¬å¦‚æœè¦å¸è½½ xmakeï¼Œä¹Ÿæ˜¯æ”¯æŒçš„ï¼š ```bash rm rf /usr/local/share/xmake rm /usr/local/bin/xrepo rm /usr/local/bin/xmake ```"},"/get_started/zh/tutorial/build-policies.html":{"title":"","content":" class: heading_no_counter # æ„å»ºç­–ç•¥ xmake æœ‰å¾ˆå¤šçš„é»˜è®¤è¡Œä¸ºï¼Œæ¯”å¦‚ï¼šè‡ªåŠ¨æ£€æµ‹å’Œæ˜ å°„ flagsã€è·¨ target å¹¶è¡Œæ„å»ºç­‰ï¼Œè™½ç„¶æä¾›äº†ä¸€å®šçš„æ™ºèƒ½åŒ–å¤„ç†ï¼Œä½†ä¼—å£éš¾è°ƒï¼Œä¸ä¸€å®šæ»¡è¶³æ‰€æœ‰çš„ç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯å’Œéœ€æ±‚ã€‚ å› æ­¤ xmake æä¾›é»˜è®¤æ„å»ºç­–ç•¥çš„ä¿®æ”¹è®¾ç½®ï¼Œå¼€æ”¾ç»™ç”¨æˆ·ä¸€å®šç¨‹åº¦ä¸Šçš„å¯é…ç½®æ€§ã€‚ å®ƒä¸»è¦é€šè¿‡ [set_policy](https://xmake.io/#/zh cn/manual/project_target?id targetset_policy) æ¥å£æ¥é…ç½®ã€‚ æˆ‘ä»¬é€šå¸¸å¯ä»¥ç”¨å®ƒæ¥é…ç½®ä¿®æ”¹ targetï¼Œpackage ä»¥åŠå·¥ç¨‹æ•´ä½“çš„ä¸€äº›è¡Œä¸ºç­–ç•¥ã€‚ ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š ```lua set_policy(\"check.auto_ignore_flags\", false) ``` åªéœ€è¦åœ¨é¡¹ç›®æ ¹åŸŸè®¾ç½®è¿™ä¸ªé…ç½®ï¼Œå°±å¯ä»¥ç¦ç”¨ flags çš„è‡ªåŠ¨æ£€æµ‹å’Œå¿½ç•¥æœºåˆ¶ï¼Œå¦å¤– `set_policy` ä¹Ÿå¯ä»¥é’ˆå¯¹æŸä¸ªç‰¹å®šçš„ target å±€éƒ¨ç”Ÿæ•ˆã€‚ ```lua target(\"test\", function() set_policy(\"check.auto_ignore_flags\", false) end) ``` > å¦å¤–ï¼Œå¦‚æœè®¾ç½®çš„ç­–ç•¥åæ˜¯æ— æ•ˆçš„ï¼Œxmake ä¹Ÿä¼šæœ‰è­¦å‘Šæç¤ºã€‚ å¦‚æœè¦è·å–å½“å‰ xmake æ”¯æŒçš„æ‰€æœ‰ç­–ç•¥é…ç½®åˆ—è¡¨å’Œæè¿°ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š ```bash $ xmake l core.project.policy.policies { \"check.auto_map_flags\" { type \"boolean\", description \"Enable map gcc flags to the current compiler and linker automatically.\", default true }, \"build.across_targets_in_parallel\" { type \"boolean\", description \"Enable compile the source files for each target in parallel.\", default true }, \"check.auto_ignore_flags\" { type \"boolean\", description \"Enable check and ignore unsupported flags automatically.\", default true } } ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼å»è®¾ç½®ä¿®æ”¹å†…éƒ¨çš„ç­–ç•¥: ```bash $ xmake f policies package.fetch_only ``` é»˜è®¤è®¾ç½®ç­–ç•¥åï¼Œå°±æ˜¯å¯ç”¨çŠ¶æ€ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šè®¾ç½®å…¶ä»–å€¼ï¼Œç¦ç”¨å®ƒã€‚ ```bash $ xmake f policies package.precompiled:n ``` æˆ–è€…åŒæ—¶é…ç½®å¤šä¸ªç­–ç•¥å€¼ï¼Œç”¨é€—å·åˆ†å‰²ã€‚ ```bash $ xmake f policies package.precompiled:n,package.install_only ``` ### check.auto_ignore_flags xmake é»˜è®¤ä¼šå¯¹æ‰€æœ‰ `add_cxflags`, `add_ldflags` æ¥å£è®¾ç½®çš„åŸå§‹ flags è¿›è¡Œè‡ªåŠ¨æ£€æµ‹ï¼Œå¦‚æœæ£€æµ‹å½“å‰ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ä¸æ”¯æŒå®ƒä»¬ï¼Œå°±ä¼šè‡ªåŠ¨å¿½ç•¥ã€‚ è¿™é€šå¸¸æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œåƒä¸€äº›å¯é€‰çš„ç¼–è¯‘ flagsï¼Œå³ä½¿ä¸æ”¯æŒä¹Ÿèƒ½æ­£å¸¸ç¼–è¯‘ï¼Œä½†æ˜¯å¼ºè¡Œè®¾ç½®ä¸Šå»ï¼Œå…¶ä»–ç”¨æˆ·åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šå› ä¸ºç¼–è¯‘å™¨çš„æ”¯æŒåŠ›åº¦ä¸åŒï¼Œå‡ºç°ä¸€å®šç¨‹åº¦çš„ç¼–è¯‘å¤±è´¥ã€‚ ä½†ç”±äºè‡ªåŠ¨æ£€æµ‹å¹¶ä¸ä¿è¯100%å¯é ï¼Œæœ‰æ—¶å€™ä¼šæœ‰ä¸€å®šç¨‹åº¦çš„è¯¯åˆ¤ï¼Œæ‰€ä»¥æŸäº›ç”¨æˆ·å¹¶ä¸å–œæ¬¢è¿™ä¸ªè®¾å®šï¼ˆå°¤å…¶æ˜¯é’ˆå¯¹äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œæ›´å®¹æ˜“å‡ºç°å¤±è´¥ï¼‰ã€‚ ç›®å‰å¦‚æœæ£€æµ‹å¤±è´¥ï¼Œä¼šæœ‰è­¦å‘Šæç¤ºé¿å…ç”¨æˆ·è«åèººå‘ï¼Œä¾‹å¦‚ï¼š ```bash warning: add_ldflags(\" static\") is ignored, please pass `{force true}` or call `set_policy(\"check.auto_ignore_flags\", false)` if you want to set it. ``` æ ¹æ®æç¤ºï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ†æåˆ¤æ–­ï¼Œæ˜¯å¦éœ€è¦å¼ºåˆ¶è®¾ç½®è¿™ä¸ª flagsï¼Œä¸€ç§å°±æ˜¯é€šè¿‡ï¼š ```lua add_ldflags(\" static\", {force true}) ``` æ¥æ˜¾ç¤ºçš„å¼ºåˆ¶è®¾ç½®ä¸Šå®ƒï¼Œè·³è¿‡è‡ªåŠ¨æ£€æµ‹ï¼Œè¿™å¯¹äºå¶å°”çš„ flags å¤±è´¥ï¼Œæ˜¯å¾ˆæœ‰æ•ˆå¿«æ·çš„å¤„ç†æ–¹å¼ï¼Œä½†æ˜¯å¯¹äºäº¤å‰ç¼–è¯‘æ—¶å€™ï¼Œä¸€å †çš„ flags è®¾ç½®æ£€æµ‹ä¸è¿‡çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªéƒ½è®¾ç½® force å¤ªè¿‡äºç¹çã€‚ è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ `set_policy` æ¥å¯¹æŸä¸ª target æˆ–è€…æ•´ä¸ª project ç›´æ¥ç¦ç”¨é»˜è®¤çš„è‡ªåŠ¨æ£€æµ‹è¡Œä¸ºï¼š ```lua set_policy(\"check.auto_ignore_flags\", false) target(\"test\", function() add_ldflags(\" static\") end) ``` ç„¶åæˆ‘ä»¬å°±å¯ä»¥éšæ„è®¾ç½®å„ç§åŸå§‹ flagsï¼Œxmake ä¸ä¼šå»è‡ªåŠ¨æ£€æµ‹å’Œå¿½ç•¥ä»–ä»¬äº†ã€‚ ### check.auto_map_flags è¿™æ˜¯ xmake çš„å¦å¤–ä¸€ä¸ªå¯¹ flags çš„æ™ºèƒ½åˆ†æå¤„ç†ï¼Œé€šå¸¸åƒ `add_links`, `add_defines` è¿™ç§ xmake å†…ç½®çš„ api å»è®¾ç½®çš„é…ç½®ï¼Œæ˜¯å…·æœ‰è·¨å¹³å°ç‰¹æ€§çš„ï¼Œä¸åŒç¼–è¯‘å™¨å¹³å°ä¼šè‡ªåŠ¨å¤„ç†æˆå¯¹åº”çš„åŸå§‹ flagsã€‚ ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µï¼Œç”¨æˆ·è¿˜æ˜¯éœ€è¦è‡ªå·±é€šè¿‡ `add_cxflags`, `add_ldflags` è®¾ç½®åŸå§‹çš„ç¼–è¯‘é“¾æ¥ flagsï¼Œè¿™äº› flags å¹¶ä¸èƒ½å¾ˆå¥½çš„è·¨ç¼–è¯‘å™¨ã€‚ å°±æ‹¿ ` O0` çš„ç¼–è¯‘ä¼˜åŒ– flags æ¥è¯´ï¼Œè™½ç„¶æœ‰ `set_optimize` æ¥å®ç°è·¨ç¼–è¯‘å™¨é…ç½®ï¼Œä½†å¦‚æœç”¨æˆ·ç›´æ¥è®¾ç½® `add_cxflags(\" O0\")` å‘¢ï¼Ÿgcc/clang ä¸‹å¯ä»¥æ­£å¸¸å¤„ç†ï¼Œä½†æ˜¯ msvc ä¸‹å°±ä¸æ”¯æŒäº†ã€‚ ä¹Ÿè®¸æˆ‘ä»¬èƒ½é€šè¿‡ `if is_plat() then` æ¥åˆ†å¹³å°å¤„ç†ï¼Œä½†å¾ˆç¹çï¼Œå› æ­¤ xmake å†…ç½®äº† flags çš„è‡ªåŠ¨æ˜ å°„åŠŸèƒ½ã€‚ åŸºäº gcc flags çš„æ™®åŠæ€§ï¼Œxmake é‡‡ç”¨ gcc çš„ flags å‘½åè§„èŒƒï¼Œå¯¹å…¶æ ¹æ®ä¸åŒçš„ç¼–è¯‘å®ç°è‡ªåŠ¨æ˜ å°„ï¼Œä¾‹å¦‚ï¼š ```lua add_cxflags(\" O0\") ``` è¿™ä¸€è¡Œè®¾ç½®ï¼Œåœ¨ gcc/clang ä¸‹è¿˜æ˜¯ ` O0`ï¼Œä½†å¦‚æœå½“å‰æ˜¯ msvc ç¼–è¯‘å™¨ï¼Œé‚£è¾¹ä¼šè‡ªåŠ¨æ˜ å°„ä¸º msvc å¯¹åº” ` Od` ç¼–è¯‘é€‰é¡¹æ¥ç¦ç”¨ä¼˜åŒ–ã€‚ æ•´ä¸ªè¿‡ç¨‹ï¼Œç”¨æˆ·æ˜¯å®Œå…¨æ— æ„ŸçŸ¥çš„ï¼Œç›´æ¥æ‰§è¡Œ xmake å°±å¯ä»¥è·¨ç¼–è¯‘å™¨å®Œæˆç¼–è¯‘ã€‚ > å½“ç„¶ï¼Œç›®å‰çš„è‡ªåŠ¨æ˜ å°„å®ç°è¿˜ä¸æ˜¯å¾ˆæˆç†Ÿï¼Œæ²¡æœ‰ 100% è¦†ç›–æ‰€æœ‰ gcc çš„ flagsï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰ä¸å°‘ flags æ˜¯æ²¡å»æ˜ å°„çš„ã€‚ ä¹Ÿæœ‰éƒ¨åˆ†ç”¨æˆ·å¹¶ä¸å–œæ¬¢è¿™ç§è‡ªåŠ¨æ˜ å°„è¡Œä¸ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„è®¾ç½®å®Œå…¨ç¦ç”¨è¿™ä¸ªé»˜è®¤çš„è¡Œä¸ºï¼š ```bash set_policy(\"check.auto_map_flags\", false) ``` ### build.across_targets_in_parallel è¿™ä¸ªç­–ç•¥ä¹Ÿæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œä¸»è¦ç”¨äºè·¨ target é—´æ‰§è¡Œå¹¶è¡Œæ„å»ºï¼Œv2.3.3 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¹¶è¡Œæ„å»ºåªèƒ½é’ˆå¯¹å•ä¸ª target å†…éƒ¨çš„æ‰€æœ‰æºæ–‡ä»¶ï¼Œ è·¨ target çš„ç¼–è¯‘ï¼Œå¿…é¡»è¦è¦ç­‰å…ˆå‰çš„ target å®Œå…¨ link æˆåŠŸï¼Œæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ª target çš„ç¼–è¯‘ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šå½±å“ç¼–è¯‘é€Ÿåº¦ã€‚ ç„¶è€Œæ¯ä¸ª target çš„æºæ–‡ä»¶æ˜¯å¯ä»¥å®Œå…¨å¹¶è¡ŒåŒ–å¤„ç†çš„ï¼Œæœ€ç»ˆåœ¨ä¸€èµ·æ‰§è¡Œ link è¿‡ç¨‹ï¼Œv2.3.3 ä¹‹åçš„ç‰ˆæœ¬é€šè¿‡è¿™ä¸ªä¼˜åŒ–ï¼Œæ„å»ºé€Ÿåº¦æå‡äº†30%ã€‚ å½“ç„¶ï¼Œå¦‚æœæœ‰äº›ç‰¹æ®Šçš„ target é‡Œé¢çš„æ„å»ºæºæ–‡ä»¶è¦ä¾èµ–å…ˆå‰çš„ targetï¼ˆå°¤å…¶æ˜¯ä¸€äº›è‡ªå®šä¹‰ rules çš„æƒ…å†µï¼Œè™½ç„¶å¾ˆå°‘é‡åˆ°ï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„è®¾ç½®ç¦ç”¨è¿™ä¸ªä¼˜åŒ–è¡Œä¸ºï¼š ```bash set_policy(\"build.across_targets_in_parallel\", false) ``` ### build.fence ç”±äºé…ç½® `set_policy(\"build.across_targets_in_parallel\", false)` å­˜åœ¨å±€é™æ€§ï¼Œå®ƒä¼šé™åˆ¶çˆ¶ target å’Œå®ƒçš„æ‰€æœ‰ä¾èµ–çš„å­ target ä¹‹é—´çš„å¹¶è¡Œåº¦ï¼Œå½±å“çš„èŒƒå›´æœ‰ç‚¹å¤§ã€‚ è€Œæˆ‘ä»¬åš codegen æ—¶å€™ï¼Œæœ‰æ—¶å€™ä»…ä»…åªæ˜¯æƒ³å¯¹å…¶ä¸­æŸä¸ªä¾èµ–çš„ target é™åˆ¶å¹¶è¡Œåº¦ï¼Œä½œä¸º codegen ç¨‹åºï¼Œæå‰è®©å®ƒå®Œæˆç¼–è¯‘ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œ`build.across_targets_in_parallel` å°±æ— æ³•ç²¾ç»†æ§åˆ¶äº†ï¼Œç¼–è¯‘é€Ÿåº¦ä¹Ÿæ— æ³•è¾¾åˆ°æœ€ä¼˜ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬æ–°å¢äº† `build.fence` ç­–ç•¥ï¼Œå®ƒå¯ä»¥ä»…ä»…åªé’ˆå¯¹ç‰¹å®šçš„å­ target é™åˆ¶å¹¶è¡Œç¼–è¯‘é“¾æ¥ã€‚ ç›¸å…³çš„èƒŒæ™¯ç»†èŠ‚ï¼Œå¯ä»¥çœ‹ä¸‹ï¼š[#5003](https://github.com/xmake io/xmake/issues/5003) ä¾‹å¦‚ï¼š ```lua target(\"autogen\", function() set_default(false) set_kind(\"binary\") set_plat(os.host()) set_arch(os.arch()) add_files(\"src/autogen.cpp\") set_languages(\"c++11\") set_policy(\"build.fence\", true) end) target(\"test\", function() set_kind(\"binary\") add_deps(\"autogen\") add_rules(\"autogen\") add_files(\"src/main.cpp\") add_files(\"src/*.in\") end) ``` å…¶ä¸­ autogen ç›®æ ‡ç¨‹åºéœ€è¦åœ¨ test ç¨‹åºçš„æºç è¢«ç¼–è¯‘å‰ï¼Œå°±è¦å®Œæˆç¼–è¯‘é“¾æ¥ï¼Œå› ä¸º test ç›®æ ‡éœ€è¦è¿è¡Œ autogen ç¨‹åºï¼Œå»åŠ¨æ€ç”Ÿæˆä¸€äº›æºç å‚ä¸ç¼–è¯‘ã€‚ è€Œé’ˆå¯¹ autogen é…ç½® `set_policy(\"build.fence\", true)` å°±å¯ä»¥å®ç°è¿™ä¸ªç›®çš„ã€‚ ### build.merge_archive å¦‚æœè®¾ç½®äº†è¿™ä¸ªç­–ç•¥ï¼Œé‚£ä¹ˆä½¿ç”¨ `add_deps()` ä¾èµ–çš„ç›®æ ‡åº“ä¸å†ä½œä¸ºé“¾æ¥å­˜åœ¨ï¼Œè€Œæ˜¯ç›´æ¥æŠŠå®ƒä»¬åˆå¹¶åˆ°çˆ¶ç›®æ ‡åº“ä¸­å»ã€‚ ä¾‹å¦‚ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"add\", function() set_kind(\"static\") add_files(\"src/add.c\") add_files(\"src/subdir/add.c\") end) target(\"sub\", function() set_kind(\"static\") add_files(\"src/sub.c\") add_files(\"src/subdir/sub.c\") end) target(\"mul\", function() set_kind(\"static\") add_deps(\"add\", \"sub\") add_files(\"src/mul.c\") set_policy(\"build.merge_archive\", true) end) target(\"test\", function() add_deps(\"mul\") add_files(\"src/main.c\") end) ``` libmul.a é™æ€åº“ä¼šè‡ªåŠ¨åˆå¹¶ libadd.a å’Œ libsub.a ä¸¤ä¸ªå­ä¾èµ–çš„é™æ€åº“ã€‚ ### build.ccache Xmake é»˜è®¤æ˜¯å¼€å¯å†…ç½®çš„ç¼–è¯‘ç¼“å­˜çš„ï¼Œé€šè¿‡è®¾ç½®è¿™ä¸ªç­–ç•¥ï¼Œå¯ä»¥æ˜¾å¼ç¦ç”¨ç¼“å­˜ã€‚ ```lua set_policy(\"build.ccache\", false) ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘½ä»¤è¡Œå»ç¦ç”¨å®ƒã€‚ ```bash $ xmake f ccache n ``` æˆ–è€… ```bash $ xmake f policies build.ccache:n ``` ### build.warning é»˜è®¤ç¼–è¯‘é€šå¸¸ä¸ä¼šå®æ—¶å›æ˜¾è­¦å‘Šè¾“å‡ºï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ä½¿ç”¨ `xmake w` å¼€å¯ï¼Œæˆ–è€…é€šè¿‡ `xmake g build_warning y` æ¥å…¨å±€å¼€å¯å®ƒã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ xmake.lua é…ç½®ä¸­å»é»˜è®¤å¯ç”¨è­¦å‘Šå›æ˜¾è¾“å‡ºã€‚ ```lua set_policy(\"build.warning\", true) set_warnings(\"all\", \"extra\") ``` è¿™ä¸ªæ—¶å€™ï¼Œå³ä½¿æˆ‘ä»¬æ‰§è¡Œ `xmake` å‘½ä»¤ï¼Œä¹Ÿèƒ½ç›´æ¥å›æ˜¾è­¦å‘Šè¾“å‡ºã€‚ ### build.optimization.lto xmake æ”¹è¿›äº†å¯¹ LTO é“¾æ¥æ—¶ä¼˜åŒ–çš„æ”¯æŒï¼Œå¯¹ gcc/clang/msvc ç­‰ä¸åŒå¹³å°ä¸‹éƒ½è¿›è¡Œäº†é€‚é…ï¼Œåªéœ€è¦å¯ç”¨è¿™ä¸ªç­–ç•¥ï¼Œå°±èƒ½å¯¹ç‰¹å®š target å¼€å¯ LTOã€‚ ```lua set_policy(\"build.optimization.lto\", true) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œé€‰é¡¹å¿«é€Ÿå¼€å¯ã€‚ ```bash $ xmake f policies build.optimization.lto ``` ### build.cuda.devlink å¯ä»¥é€šè¿‡è¿™ä¸ªé…ç½®ï¼Œæ˜¾ç¤ºå¼€å¯å¯¹ç‰¹å®šç›®æ ‡çš„è®¾å¤‡é“¾æ¥ã€‚ è¿™é€šå¸¸ç”¨äº Cuda é¡¹ç›®çš„æ„å»ºï¼Œä»¥åŠé Cuda binary/shared ä¾èµ– Cuda static ç›®æ ‡çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒCuda static ç›®æ ‡å°±éœ€è¦æ˜¾ç¤ºé…ç½®è¿™ä¸ªï¼Œå¼€å¯è®¾å¤‡é“¾æ¥ã€‚ ```lua target(\"test\", function() set_kind(\"static\") set_policy(\"build.cuda.devlink\", true) end) ``` è€Œé»˜è®¤ Cuda binary/shared æ˜¯å¼€å¯ devlink çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç­–ç•¥æ˜¾ç¤ºç¦ç”¨å®ƒã€‚ å…³äºè¿™ä¸ªçš„è¯¦ç»†èƒŒæ™¯è¯´æ˜ï¼Œè§ï¼š[#1976](https://github.com/xmake io/xmake/issues/1976) ### build.sanitizer.address Address Sanitizerï¼ˆASanï¼‰æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„å†…å­˜é”™è¯¯æ£€æµ‹å·¥å…·ï¼Œç”±ç¼–è¯‘å™¨å†…ç½®æ”¯æŒï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦åœ¨ç¼–è¯‘å’Œé“¾æ¥çš„ flags ä¸­åŒæ—¶é…ç½® ` fsanitize address` æ‰èƒ½æ­£ç¡®å¼€å¯ã€‚ è€Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼€å¯è¿™ä¸ªç­–ç•¥ï¼Œå°±å¯ä»¥å¿«é€Ÿå…¨å±€å¯ç”¨å®ƒï¼Œè¿™ä¼šä½¿å¾—ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºï¼Œç›´æ¥æ”¯æŒ ASan æ£€æµ‹ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼å»å¯ç”¨ï¼š ```bash $ xmake f policies build.sanitizer.address ``` ä¹Ÿå¯ä»¥é€šè¿‡æ¥å£é…ç½®å»å…¨å±€å¯ç”¨ï¼š ```lua set_policy(\"build.sanitizer.address\", true) ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å•ç‹¬å¯¹æŸä¸ªç‰¹å®šçš„ target å»é…ç½®å¼€å¯ã€‚ å¦å¤–ï¼Œå¦‚æœå…¨å±€é…ç½®å®ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åŒæ—¶å¯¹æ‰€æœ‰ä¾èµ–åŒ…ä¹Ÿç”Ÿæ•ˆã€‚ ```lua set_policy(\"build.sanitizer.address\", true) add_requires(\"zlib\") add_requires(\"libpng\") ``` å®ƒç­‰ä»·äºï¼Œå¯¹æ¯ä¸ªåŒ…ä¾æ¬¡è®¾ç½® asan é…ç½®ã€‚ ```lua add_requires(\"zlib\", {configs {asan true}}) add_requires(\"libpng\", {configs {asan true}}) ``` > `add_rules(\"mode.asan\", \"mode.tsan\", \"mode.ubsan\", \"mode.msan\")` å°†è¢«åºŸå¼ƒï¼Œå°½å¯èƒ½ä½¿ç”¨è¿™äº›æ–°çš„ç­–ç•¥ï¼Œå› ä¸ºè¿™äº›æ„å»ºæ¨¡å¼æ— æ³•åŒæ­¥å¯¹ä¾èµ–åŒ…ç”Ÿæ•ˆã€‚ å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶ç”Ÿæ•ˆå¤šä¸ª sanitizer æ£€æµ‹ï¼Œä¾‹å¦‚ï¼š ```lua set_policy(\"build.sanitizer.address\", true) set_policy(\"build.sanitizer.undefined\", true) ``` æˆ–è€… ``` $ xmake f policies build.sanitizer.address,build.sanitizer.undefined ``` ### build.sanitizer.thread ä¸ [build.sanitizer.address](https://xmake.io/#/zh cn/guide/build_policies?id buildsanitizeraddress) ç±»ä¼¼ï¼Œç”¨äºæ£€æµ‹çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ ### build.sanitizer.memory ä¸ [build.sanitizer.address](https://xmake.io/#/zh cn/guide/build_policies?id buildsanitizeraddress) ç±»ä¼¼ï¼Œç”¨äºæ£€æµ‹å†…å­˜é—®é¢˜ã€‚ ### build.sanitizer.leak ä¸ [build.sanitizer.address](https://xmake.io/#/zh cn/guide/build_policies?id buildsanitizeraddress) ç±»ä¼¼ï¼Œç”¨äºæ£€æµ‹å†…å­˜æ³„æ¼é—®é¢˜ã€‚ ### build.sanitizer.undefined ä¸ [build.sanitizer.address](https://xmake.io/#/zh cn/guide/build_policies?id buildsanitizeraddress) ç±»ä¼¼ï¼Œç”¨äºæ£€æµ‹ undefined é—®é¢˜ã€‚ ### build.always_update_configfiles è¿™ä¸ªç­–ç•¥ç”¨äºå¯¹ `add_configfiles` é…ç½®æ–‡ä»¶çš„è‡ªåŠ¨ç”Ÿæˆè¡Œä¸ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œxmake ä»…ä»…åªä¼šåœ¨é¦–æ¬¡ `xmake config` æ—¶å€™ï¼Œæˆ–è€… xmake.lua é…ç½®æœ‰æ”¹åŠ¨çš„æ˜¯å¦ï¼Œæ‰ä¼šè§¦å‘ configfiles çš„é‡æ–°ç”Ÿæˆã€‚ ä¹‹åçš„æ¯æ¬¡æ„å»ºï¼Œåªè¦é…ç½®æ²¡æœ‰å˜åŒ–ï¼Œå°±ä¸ä¼šé‡æ–°ç”Ÿæˆ configfilesã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„ configfiles ä¸­æœ‰ä½¿ç”¨ GIT_COMMIT ç­‰å˜é‡ï¼Œæƒ³è¦æ¯æ¬¡æ„å»ºæ—¶å€™ï¼Œæ€»æ˜¯é‡æ–°ç”Ÿæˆæœ€æ–°çš„é…ç½®ï¼Œé‚£ä¹ˆå¯ä»¥é…ç½®å®ƒã€‚ å…·ä½“ä½¿ç”¨èƒŒæ™¯ï¼Œå¯ä»¥çœ‹ä¸‹ï¼š[#4747](https://github.com/xmake io/xmake/issues/4747) ### build.intermediate_directory é…ç½®å¯ç”¨æˆ–ç¦ç”¨æ„å»ºçš„å†…éƒ¨å­ç›®å½•ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ `xmake` ç¼–è¯‘é¡¹ç›®ä¼šè‡ªåŠ¨åœ¨ build ç›®å½•ä¸‹æ ¹æ®å¹³å°ã€‚æ¶æ„ï¼Œç¼–è¯‘æ¨¡å¼ç”Ÿæˆå­ç›®å½•ï¼Œåˆ†åˆ«å­˜å‚¨å¯¹è±¡æ–‡ä»¶ï¼Œç›®æ ‡æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š ```bash build/ â””â”€â”€ macosx â””â”€â”€ x86_64 â””â”€â”€ release â””â”€test ``` å¦‚æœé…ç½®ç¦ç”¨æ­¤ç­–ç•¥ï¼Œé‚£ä¹ˆç”Ÿæˆçš„äº§ç‰©å°†ä¼šç›´æ¥ç”Ÿæˆåˆ° build æ ¹ç›®å½•ä¸‹ã€‚å˜æˆï¼š ```bash build/ â””â”€ test ``` ### build.rpath é…ç½®å¯ç”¨æˆ–è€…ç¦ç”¨æ„å»ºæ—¶çš„ target rpath è®¾ç½®ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœ `target(foo)` ä¾èµ–åŠ¨æ€åº“ barï¼Œé‚£ä¹ˆç”Ÿæˆçš„ foo å¯æ‰§è¡Œæ–‡ä»¶ä¼šè‡ªåŠ¨åŠ ä¸Š bar çš„ rpathï¼Œè¿™èƒ½ä¿è¯ç”¨æˆ·ç›´æ¥æ‰§è¡Œ foo ç¨‹åºï¼Œä¹Ÿèƒ½æ­£ç¡®æ‰¾åˆ° barã€‚ å¦‚æœä½ æƒ³ç¦ç”¨è¿™ä¸ªè¡Œä¸ºï¼Œå¯ä»¥æ˜¾å¼é…ç½®ç¦ç”¨å®ƒã€‚ ### install.rpath å°½ç®¡æ„å»ºåçš„ç¨‹åºï¼Œä¼šè¢«è®¾ç½® rpathï¼Œä½†æ˜¯å½“ `xmake install` å®‰è£…åï¼Œå®ƒæ„å»ºæ—¶å€™çš„ rpath å°±ä¸ä¸€å®šå®Œå…¨é€‚ç”¨äº†ï¼Œå› æ­¤ xmake ä¼šè‡ªåŠ¨ä¿®æ”¹è°ƒæ•´ rpathï¼Œä½¿å¾—å®‰è£…åçš„ç¨‹åºï¼ŒåŒæ ·å¯ä»¥æ‰¾åˆ°å®ƒçš„ä¾èµ–åº“ã€‚ ä¸è¿‡å‰ææ˜¯ï¼Œç”¨æˆ·è‡ªå·±å…ˆå¾—é€šè¿‡ `add_rpathdirs(\"/xxx\", {installonly true})` å»é…ç½®ç‹¬ç«‹çš„å®‰è£… rpathã€‚ è€Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ª policy å»ç¦ç”¨é»˜è®¤çš„å®‰è£…é˜¶æ®µ rpath è®¾ç½®è¡Œä¸ºã€‚ ### run.autobuild è¿™ä¸ªç­–ç•¥ç”¨äºè°ƒæ•´ `xmake run` çš„è¡Œä¸ºï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ `xmake run` å¹¶ä¸ä¼šè‡ªåŠ¨æ„å»ºç›®æ ‡ç¨‹åºï¼Œå¦‚æœç¨‹åºè¿˜æ²¡è¢«ç¼–è¯‘ï¼Œå°±æ˜¯æç¤ºç”¨æˆ·æ‰‹åŠ¨æ„å»ºä¸€ä¸‹ã€‚ è€Œå¼€å¯è¿™ä¸ªç­–ç•¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿è¡Œç¨‹åºå‰ï¼Œå…ˆè‡ªåŠ¨æ„å»ºå¯¹åº”çš„ç›®æ ‡ç¨‹åºã€‚ ```bash $ xmake f policies run.autobuild $ xmake run ``` å¦‚æœæƒ³è¦å…¨å±€ç”Ÿæ•ˆè¿™ä¸ªç­–ç•¥ï¼Œå¯ä»¥å…¨å±€å¼€å¯å®ƒã€‚ ```bash $ xmake g policies run.autobuild ``` ### preprocessor.linemarkers é€šå¸¸ç”¨æˆ·ç¼–è¯‘ç¼“å­˜ä¸­ï¼Œé¢„å¤„ç†å™¨çš„ç”Ÿæˆç­–ç•¥ï¼Œé»˜è®¤å¼€å¯ï¼Œå¦‚æœé…ç½®å…³é—­è¿™ä¸ªç­–ç•¥ï¼Œé‚£ä¹ˆç¼“å­˜ç”Ÿæˆçš„é¢„å¤„ç†æ–‡ä»¶å†…å®¹å°†ä¸åŒ…å« linemarkers ä¿¡æ¯ï¼Œè¿™ä¼šæå¤§å‡å°‘é¢„å¤„ç†æ–‡ä»¶å¤§å°ã€‚ ä¹Ÿä¼šæå‡ç¼“å­˜çš„å¤„ç†æ•ˆç‡ï¼Œä½†æ˜¯ç¼ºç‚¹å°±æ˜¯ä¼šä¸¢å¤±æºç è¡Œä¿¡æ¯ï¼Œå¦‚æœé‡åˆ°ç¼–è¯‘é”™è¯¯ï¼Œå°†æ— æ³•çœ‹åˆ°å‡†ç¡®çš„å‡ºé”™ä»£ç è¡Œã€‚ ### preprocessor.gcc.directives_only è¿™ä¹Ÿæ˜¯ç”¨äºé¢„å¤„ç†å™¨çš„ç­–ç•¥ï¼Œé»˜è®¤å¼€å¯ï¼Œè¿™ä¼šæå‡ gcc ä¸‹ç¼–è¯‘ç¼“å­˜é¢„å¤„ç†çš„æ•ˆç‡ï¼Œä½†æ˜¯å¦‚æœæºæ–‡ä»¶ä¸­åŒ…å« `__DATE__`, `__TIME__` ç­‰å®ï¼Œå°±ä¼šå¯¼è‡´ç¼“å­˜å‡ºç°ä¸ä¸€è‡´ã€‚ å› æ­¤ï¼Œå¯ä»¥æ ¹æ®è‡ªèº«å·¥ç¨‹ä»£ç ï¼ŒæŒ‰éœ€å…³é—­æ­¤ç­–ç•¥ï¼Œç¡®ä¿ç”Ÿæˆçš„ç»“æœä¸€è‡´ã€‚ ### package.requires_lock å¯ç”¨äºå¼€å¯ `add_requires()` å¼•å…¥çš„ä¾èµ–åŒ…çš„ç‰ˆæœ¬é”å®šã€‚ å…·ä½“çœ‹ä¸‹ï¼š[ä¾èµ–åŒ…çš„é”å®šå’Œå‡çº§](https://xmake.io/#/zh cn/package/remote_package?id %e4%be%9d%e8%b5%96%e5%8c%85%e7%9a%84%e9%94%81%e5%ae%9a%e5%92%8c%e5%8d%87%e7%ba%a7) ### package.fetch_only å¦‚æœå¼€å¯è¿™ä¸ªç­–ç•¥ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ä¾èµ–åŒ…ä»…ä»…åªä¼šä»ç³»ç»Ÿè·å–ï¼Œä¸ä¼šä»è¿œç¨‹ä¸‹è½½å®‰è£…ã€‚ ### package.install_only å¦‚æœå¼€å¯è¿™ä¸ªç­–ç•¥ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ä¾èµ–åŒ…ä»…ä»…åªä¼šèµ°è¿œç¨‹ä¸‹è½½å®‰è£…ï¼Œä¸ä¼šä»ç³»ç»ŸæŸ¥æ‰¾è·å–ã€‚ ### package.librarydeps.strict_compatibility é»˜è®¤ç¦ç”¨ï¼Œå¦‚æœå¯ç”¨å®ƒï¼Œé‚£ä¹ˆå½“å‰åŒ…å’Œå®ƒçš„æ‰€æœ‰åº“ä¾èµ–åŒ…ä¹‹é—´ä¼šä¿æŒä¸¥æ ¼çš„å…¼å®¹æ€§ï¼Œä»»ä½•ä¾èµ–åŒ…çš„ç‰ˆæœ¬æ›´æ–°ï¼Œéƒ½ä¼šå¼ºåˆ¶è§¦å‘å½“å‰åŒ…çš„é‡æ–°ç¼–è¯‘å®‰è£…ã€‚ ä»¥ç¡®ä¿æ‰€æœ‰çš„åŒ…éƒ½æ˜¯äºŒè¿›åˆ¶å…¼å®¹çš„ï¼Œä¸ä¼šå› ä¸ºæŸä¸ªä¾èµ–åŒ…æ¥å£æ”¹åŠ¨ï¼Œå¯¼è‡´å’Œå…¶ä»–å·²è¢«å®‰è£…çš„å…¶ä»–åŒ…ä¸€èµ·é“¾æ¥æ—¶å€™ï¼Œå‘ç”Ÿé“¾æ¥å’Œè¿è¡Œé”™è¯¯ã€‚ ```lua package(\"foo\") add_deps(\"bar\", \"zoo\") set_policy(\"package.librarydeps.strict_compatibility\", true) ``` ä¾‹å¦‚ï¼Œå¦‚æœ bar æˆ–è€… zoo çš„ç‰ˆæœ¬æœ‰æ›´æ–°ï¼Œé‚£ä¹ˆ foo ä¹Ÿä¼šé‡æ–°ç¼–è¯‘å®‰è£…ã€‚ ### package.strict_compatibility é»˜è®¤ç¦ç”¨ï¼Œå¦‚æœå¯ç”¨å®ƒï¼Œé‚£ä¹ˆå½“å‰åŒ…å’Œå…¶ä»–æ‰€æœ‰ä¾èµ–å®ƒçš„åŒ…ä¹‹é—´ä¼šä¿æŒä¸¥æ ¼çš„å…¼å®¹æ€§ï¼Œè¿™ä¸ªåŒ…çš„ç‰ˆæœ¬æ›´æ–°ï¼Œéƒ½ä¼šå¼ºåˆ¶è§¦å‘å…¶ä»–çˆ¶åŒ…çš„é‡æ–°ç¼–è¯‘å®‰è£…ã€‚ ä»¥ç¡®ä¿æ‰€æœ‰çš„åŒ…éƒ½æ˜¯äºŒè¿›åˆ¶å…¼å®¹çš„ï¼Œä¸ä¼šå› ä¸ºæŸä¸ªä¾èµ–åŒ…æ¥å£æ”¹åŠ¨ï¼Œå¯¼è‡´å’Œå…¶ä»–å·²è¢«å®‰è£…çš„å…¶ä»–åŒ…ä¸€èµ·é“¾æ¥æ—¶å€™ï¼Œå‘ç”Ÿé“¾æ¥å’Œè¿è¡Œé”™è¯¯ã€‚ ```lua package(\"foo\", function() set_policy(\"package.strict_compatibility\", true) end) package(\"bar\", function() add_deps(\"foo\") end) package(\"zoo\", function() add_deps(\"foo\") end) ``` ä¾‹å¦‚ï¼Œå¦‚æœ foo çš„ç‰ˆæœ¬æœ‰æ›´æ–°ï¼Œé‚£ä¹ˆ bar å’Œ zoo éƒ½ä¼šè¢«å¼ºåˆ¶é‡æ–°ç¼–è¯‘å®‰è£…ã€‚ ### package.install_always æ¯æ¬¡è¿è¡Œ `xmake f c` é‡æ–°é…ç½®çš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼šé‡æ–°å®‰è£…åŒ…ï¼Œè¿™å¯¹äºæœ¬åœ°ç¬¬ä¸‰æ–¹æºç åŒ…é›†æˆæ—¶å€™æ¯”è¾ƒæœ‰ç”¨ã€‚ å› ä¸ºï¼Œç”¨æˆ·å¯èƒ½éšæ—¶éœ€è¦ä¿®æ”¹ç¬¬ä¸‰æ–¹æºç ï¼Œç„¶åé‡æ–°ç¼–è¯‘é›†æˆå®ƒä»¬ã€‚ ä¹‹å‰åªèƒ½é€šè¿‡æ¯æ¬¡ä¿®æ”¹åŒ…ç‰ˆæœ¬å·ï¼Œæ¥è§¦å‘é‡æ–°ç¼–è¯‘ï¼Œä½†æ˜¯æœ‰äº†è¿™ä¸ªç­–ç•¥ï¼Œå°±èƒ½æ¯æ¬¡éƒ½ä¼šè§¦å‘é‡ç¼–ã€‚ ```lua add_rules(\"mode.debug\", \"mode.release\") package(\"foo\", function() add_deps(\"cmake\") set_sourcedir(path.join(os.scriptdir(), \"foo\")) set_policy(\"package.install_always\", true) on_install(function (package) local configs {} table.insert(configs, \" DCMAKE_BUILD_TYPE \" .. (package:debug() and \"Debug\" or \"Release\")) table.insert(configs, \" DBUILD_SHARED_LIBS \" .. (package:config(\"shared\") and \"ON\" or \"OFF\")) import(\"package.tools.cmake\").install(package, configs) end) on_test(function (package) assert(package:has_cfuncs(\"add\", {includes \"foo.h\"})) end) end) add_requires(\"foo\") target(\"demo\", function() set_kind(\"binary\") add_files(\"src/main.c\") add_packages(\"foo\") end) ``` ### package.download.http_headers è®¾ç½®åŒ…ä¸‹è½½çš„ http headers å¦‚æœæœ‰äº›åŒ…çš„ url ä¸‹è½½ï¼Œéœ€è¦è®¾ç½®ç‰¹å®š http headersï¼Œæ‰èƒ½é€šè¿‡ä¸‹è½½ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªç­–ç•¥æ¥æŒ‡å®šã€‚ ```lua package(\"xxx\") set_policy(\"package.download.http_headers\", \"TEST1: foo\", \"TEST2: bar\") ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®æŒ‡å®šçš„ urls çš„ http headersï¼š ```lua add_urls(\"https://github.com/madler/zlib/archive/$(version).tar.gz\", { http_headers {\"TEST1: foo\", \"TEST2: bar\"} }) ```"},"/get_started/zh/tutorial/syntax-description.html":{"title":"","content":" class: heading_no_counter # è¯­æ³•æè¿° xmake çš„å·¥ç¨‹æè¿°æ–‡ä»¶ xmake.lua è™½ç„¶åŸºäº lua è¯­æ³•ï¼Œä½†æ˜¯ä¸ºäº†ä½¿å¾—æ›´åŠ æ–¹ä¾¿ç®€æ´å¾—ç¼–å†™é¡¹ç›®æ„å»ºé€»è¾‘ï¼Œxmake å¯¹å…¶è¿›è¡Œäº†ä¸€å±‚å°è£…ï¼Œä½¿å¾—ç¼–å†™ xmake.lua ä¸ä¼šåƒå†™ makefile é‚£æ ·ç¹ç åŸºæœ¬ä¸Šå†™ä¸ªç®€å•çš„å·¥ç¨‹æ„å»ºæè¿°ï¼Œåªéœ€å››è¡Œå°±èƒ½æå®šï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` ## åŸŸé…ç½®è¯­æ³• æˆ‘ä»¬é»˜è®¤çº¦å®šçš„åŸŸé…ç½®è¯­æ³•ï¼Œå°½ç®¡éå¸¸ç®€æ´ï¼Œä½†æ˜¯å¯¹è‡ªåŠ¨æ ¼å¼åŒ–ç¼©è¿›å’Œ IDE ä¸æ˜¯å¾ˆå‹å¥½ã€‚ ```lua target(\"foo\") set_kind(\"binary\") add_files(\"src/*.cpp\") target_end() ``` å¦å¤–ï¼Œå®ƒä¸èƒ½è‡ªåŠ¨ç»“æŸå½“å‰ target ä½œç”¨åŸŸï¼Œç”¨æˆ·éœ€è¦æ˜¾å¼è°ƒç”¨ `target_end()`ã€‚ è™½ç„¶ï¼Œä¸Šé¢æˆ‘ä»¬æåˆ°ï¼Œå¯ä»¥ä½¿ç”¨ `do end` æ¨¡å¼æ¥è§£å†³è‡ªåŠ¨ç¼©è¿›é—®é¢˜ï¼Œä½†æ˜¯éœ€è¦ `target_end()` çš„é—®é¢˜è¿˜æ˜¯å­˜åœ¨ã€‚ ```lua target(\"bar\") do set_kind(\"binary\") add_files(\"src/*.cpp\") end target_end() ``` æˆ‘ä»¬æä¾›äº†ä¸€ç§æ›´å¥½çš„å¯é€‰åŸŸé…ç½®è¯­æ³•ï¼Œæ¥è§£å†³è‡ªåŠ¨ç¼©è¿›ï¼Œtarget åŸŸéš”ç¦»é—®é¢˜ï¼Œä¾‹å¦‚ï¼š ```lua add_defines(\"ROOT\") target(\"foo\", function () set_kind(\"binary\") add_files(\"src/*.cpp\") add_defines(\"FOO\") end) target(\"bar\", function () set_kind(\"binary\") add_files(\"src/*.cpp\") add_defines(\"BAR\") end) ``` foo å’Œ bar ä¸¤ä¸ªåŸŸæ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œæˆ‘ä»¬å³ä½¿åœ¨å®ƒä»¬ä¸­é—´é…ç½®å…¶ä»–è®¾ç½®ï¼Œä¹Ÿä¸ä¼šå½±å“å®ƒä»¬ï¼Œå¦å¤–ï¼Œå®ƒè¿˜å¯¹ LSP éå¸¸å‹å¥½ã€‚ > å› æ­¤æˆ‘ä»¬çº¦å®šï¼Œxmake.lua çš„åŸŸé…ç½®è¯­æ³•ï¼Œé»˜è®¤é‡‡ç”¨å¯é€‰çš„ `function () end` æ¨¡å¼ï¼Œå…¶ä»–æ¨¡å¼åç»­å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚ ## é…ç½®åˆ†ç¦» xmake.lua é‡‡ç”¨äºŒå…«åŸåˆ™å®ç°äº†æè¿°åŸŸã€è„šæœ¬åŸŸä¸¤å±‚åˆ†ç¦»å¼é…ç½®ã€‚ ä»€ä¹ˆæ˜¯äºŒå…«åŸåˆ™å‘¢ï¼Œç®€å•æ¥è¯´ï¼Œå¤§éƒ¨åˆ†é¡¹ç›®çš„é…ç½®ï¼Œ80% çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯äº›åŸºç¡€çš„å¸¸è§„é…ç½®ï¼Œæ¯”å¦‚ï¼š`add_cxflags`, `add_links`ç­‰ï¼Œ åªæœ‰å‰©ä¸‹ä¸åˆ° 20% çš„åœ°æ–¹æ‰éœ€è¦é¢å¤–åšäº›å¤æ‚æ¥æ»¡è¶³ä¸€äº›ç‰¹æ®Šçš„é…ç½®éœ€æ±‚ã€‚ è€Œè¿™å‰©ä½™çš„ 20% çš„é…ç½®é€šå¸¸æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœç›´æ¥å……æ–¥åœ¨æ•´ä¸ª xmake.lua é‡Œé¢ï¼Œä¼šæŠŠæ•´ä¸ªé¡¹ç›®çš„é…ç½®æ•´ä¸ªå¾ˆæ··ä¹±ï¼Œéå¸¸ä¸å¯è¯»ã€‚ å› æ­¤ï¼Œxmake é€šè¿‡æè¿°åŸŸã€è„šæœ¬åŸŸä¸¤ç§ä¸åŒçš„é…ç½®æ–¹å¼ï¼Œæ¥éš”ç¦» 80% çš„ç®€å•é…ç½®ä»¥åŠ 20% çš„å¤æ‚é…ç½®ï¼Œä½¿å¾—æ•´ä¸ª xmake.lua çœ‹èµ·æ¥éå¸¸çš„æ¸…æ™°ç›´è§‚ï¼Œå¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§éƒ½è¾¾åˆ°æœ€ä½³ã€‚ ### æè¿°åŸŸ å¯¹äºåˆšå…¥é—¨çš„æ–°æ‰‹ç”¨æˆ·ï¼Œæˆ–è€…ä»…ä»…æ˜¯ç»´æŠ¤ä¸€äº›ç®€å•çš„å°é¡¹ç›®ï¼Œé€šè¿‡å®Œå…¨åœ¨æè¿°é…ç½®å°±å·²ç»å®Œå…¨æ»¡è¶³éœ€æ±‚äº†ï¼Œé‚£ä»€ä¹ˆæ˜¯æè¿°åŸŸå‘¢ï¼Ÿå®ƒé•¿è¿™æ ·ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_defines(\"DEBUG\") add_syslinks(\"pthread\") end) ``` ä¸€çœ¼æœ›å»ï¼Œå…¶å®å°±æ˜¯ä¸ª `set_xxx`/`add_xxx` çš„é…ç½®é›†ï¼Œå¯¹äºæ–°æ‰‹ï¼Œå®Œå…¨å¯ä»¥ä¸æŠŠå®ƒå½“åš lua è„šæœ¬ï¼Œä»…ä»…ä½œä¸ºæ™®é€šçš„ï¼Œä½†æœ‰ä¸€äº›åŸºç¡€è§„åˆ™çš„é…ç½®æ–‡ä»¶å°±è¡Œäº†ã€‚ å¦‚æœå› ä¸ºï¼Œçœ‹ç€æœ‰æ‹¬å·ï¼Œè¿˜æ˜¯åƒè„šæœ¬è¯­è¨€çš„å‡½æ•°è°ƒç”¨ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼ˆæ˜¯å¦å¸¦æ‹¬å·çœ‹ä¸ªäººå–œå¥½ï¼‰ï¼š ```lua target \"test\" Â Â Â Â set_kind \"binary\" Â Â Â Â add_files \"src/*.c\" Â Â Â Â add_defines \"DEBUG\" Â Â Â Â add_syslinks \"pthread\" ``` è¿™æ˜¯ä¸æ˜¯çœ‹ç€æ›´åƒé…ç½®æ–‡ä»¶äº†ï¼Ÿå…¶å®æè¿°åŸŸå°±æ˜¯é…ç½®æ–‡ä»¶ï¼Œç±»ä¼¼åƒ json ç­‰ key/values çš„é…ç½®è€Œå·²ï¼Œæ‰€ä»¥å³ä½¿å®Œå…¨ä¸ä¼š lua çš„æ–°æ‰‹ï¼Œä¹Ÿæ˜¯èƒ½å¾ˆå¿«ä¸Šæ‰‹çš„ã€‚ è€Œä¸”ï¼Œå¯¹äºé€šå¸¸çš„é¡¹ç›®ï¼Œä»…é€šè¿‡ `set_xxx/add_xxx` å»é…ç½®å„ç§é¡¹ç›®è®¾ç½®ï¼Œå·²ç»å®Œå…¨æ»¡è¶³éœ€æ±‚äº†ã€‚ è¿™ä¹Ÿå°±æ˜¯å¼€å¤´è¯´çš„ï¼š80% çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨æœ€ç®€å•çš„é…ç½®è§„åˆ™å»ç®€åŒ–é¡¹ç›®çš„é…ç½®ï¼Œæé«˜å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œè¿™æ ·å¯¹ç”¨æˆ·å’Œå¼€å‘è€…éƒ½ä¼šéå¸¸çš„å‹å¥½ï¼Œä¹Ÿæ›´åŠ ç›´è§‚ã€‚ å¦‚æœæˆ‘ä»¬è¦é’ˆå¯¹ä¸åŒå¹³å°ï¼Œæ¶æ„åšä¸€äº›æ¡ä»¶åˆ¤æ–­æ€ä¹ˆåŠï¼Ÿæ²¡å…³ç³»ï¼Œæè¿°åŸŸé™¤äº†åŸºç¡€é…ç½®ï¼Œä¹Ÿæ˜¯æ”¯æŒæ¡ä»¶åˆ¤æ–­ï¼Œä»¥åŠ for å¾ªç¯çš„ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_defines(\"DEBUG\") if is_plat(\"linux\", \"macosx\") then add_links(\"pthread\", \"m\", \"dl\") end end) ``` ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_defines(\"DEBUG\") for _, name in ipairs({\"pthread\", \"m\", \"dl\"}) do add_links(name) end end) ``` è¿™æ˜¯ä¸æ˜¯çœ‹ç€æœ‰ç‚¹åƒ lua äº†ï¼Ÿè™½è¯´ï¼Œå¹³å¸¸å¯ä»¥æŠŠå®ƒå½“åšæ™®é€šé…ç½®é—®é¢˜ï¼Œä½†æ˜¯ xmake æ¯•ç«ŸåŸºäº luaï¼Œæ‰€ä»¥æè¿°åŸŸè¿˜æ˜¯æ”¯æŒ lua çš„åŸºç¡€è¯­è¨€ç‰¹æ€§çš„ã€‚ > ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæè¿°åŸŸè™½ç„¶æ”¯æŒ lua çš„è„šæœ¬è¯­æ³•ï¼Œä½†åœ¨æè¿°åŸŸå°½é‡ä¸è¦å†™å¤ªå¤æ‚çš„ lua è„šæœ¬ï¼Œæ¯”å¦‚ä¸€äº›è€—æ—¶çš„å‡½æ•°è°ƒç”¨å’Œ for å¾ªç¯ å¹¶ä¸”åœ¨æè¿°åŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è®¾ç½®é…ç½®é¡¹ï¼Œå› æ­¤ xmake å¹¶æ²¡æœ‰å®Œå…¨å¼€æ”¾æ‰€æœ‰çš„æ¨¡å—æ¥å£ï¼Œå¾ˆå¤šæ¥å£åœ¨æè¿°åŸŸæ˜¯è¢«ç¦æ­¢è°ƒç”¨çš„ï¼Œ å³ä½¿å¼€æ”¾å‡ºæ¥çš„ä¸€äº›å¯è°ƒç”¨æ¥å£ï¼Œä¹Ÿæ˜¯å®Œå…¨åªè¯»çš„ï¼Œä¸è€—æ—¶çš„å®‰å…¨æ¥å£ï¼Œæ¯”å¦‚ï¼š`os.getenv()` ç­‰è¯»å–ä¸€äº›å¸¸è§„çš„ç³»ç»Ÿä¿¡æ¯ï¼Œç”¨äºé…ç½®é€»è¾‘çš„æ§åˆ¶ã€‚ > å¦å¤–éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œxmake.lua æ˜¯ä¼šè¢«å¤šæ¬¡è§£æçš„ï¼Œç”¨äºåœ¨ä¸åŒé˜¶æ®µè§£æä¸åŒçš„é…ç½®åŸŸï¼šæ¯”å¦‚ï¼š`option()`, `target()` ç­‰åŸŸã€‚ å› æ­¤ï¼Œä¸è¦æƒ³ç€åœ¨ xmake.lua çš„æè¿°åŸŸï¼Œå†™å¤æ‚çš„ lua è„šæœ¬ï¼Œä¹Ÿ**ä¸è¦åœ¨æè¿°åŸŸè°ƒç”¨ print å»æ˜¾ç¤ºä¿¡æ¯ï¼Œå› ä¸ºä¼šè¢«æ‰§è¡Œå¤šé**ã€‚ ### è„šæœ¬åŸŸ é™åˆ¶æè¿°åŸŸå†™å¤æ‚çš„ luaï¼Œå„ç§ lua æ¨¡å—å’Œæ¥å£éƒ½ç”¨ä¸äº†ï¼Ÿæ€ä¹ˆåŠï¼Ÿè¿™ä¸ªæ—¶å€™å°±æ˜¯è„šæœ¬åŸŸå‡ºåœºçš„æ—¶å€™äº†ã€‚ å¦‚æœç”¨æˆ·å·²ç»å®Œå…¨ç†Ÿæ‚‰äº† xmake çš„æè¿°åŸŸé…ç½®ï¼Œå¹¶ä¸”æ„Ÿè§‰æœ‰äº›æ»¡è¶³ä¸äº†é¡¹ç›®ä¸Šçš„ä¸€äº›ç‰¹æ®Šé…ç½®ç»´æŠ¤äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨è„šæœ¬åŸŸåšæ›´åŠ å¤æ‚çš„é…ç½®é€»è¾‘ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") on_load(function (target) if is_plat(\"linux\", \"macosx\") then target:add(\"links\", \"pthread\", \"m\", \"dl\") end end) after_build(function (target) import(\"core.project.config\") local targetfile target:targetfile() os.cp(targetfile, path.join(config.buildir(), path.filename(targetfile))) print(\"build %s\", targetfile) end) end) ``` åªè¦æ˜¯ç±»ä¼¼ï¼š`on_xxx`, `after_xxx`, `before_xxx` ç­‰å­—æ ·çš„ function body å†…éƒ¨çš„è„šæœ¬ï¼Œéƒ½å±äºè„šæœ¬åŸŸã€‚ åœ¨è„šæœ¬åŸŸä¸­ï¼Œç”¨æˆ·å¯ä»¥å¹²ä»»ä½•äº‹ï¼Œxmake æä¾›äº† import æ¥å£å¯ä»¥å¯¼å…¥ xmake å†…ç½®çš„å„ç§ lua æ¨¡å—ï¼Œä¹Ÿå¯ä»¥å¯¼å…¥ç”¨æˆ·æä¾›çš„ lua è„šæœ¬ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨è„šæœ¬åŸŸå®ç°ä½ æƒ³å®ç°çš„ä»»æ„åŠŸèƒ½ï¼Œç”šè‡³å†™ä¸ªç‹¬ç«‹é¡¹ç›®å‡ºæ¥éƒ½æ˜¯å¯ä»¥çš„ã€‚ å¯¹äºä¸€äº›è„šæœ¬ç‰‡æ®µï¼Œä¸æ˜¯å¾ˆè‡ƒè‚¿çš„è¯ï¼Œåƒä¸Šé¢è¿™ä¹ˆå†…ç½®å†™å†™å°±è¶³å¤Ÿäº†ï¼Œå¦‚æœéœ€è¦å®ç°æ›´åŠ å¤æ‚çš„è„šæœ¬ï¼Œä¸æƒ³å……æ–¥åœ¨ä¸€ä¸ª xmake.lua é‡Œé¢ï¼Œå¯ä»¥æŠŠè„šæœ¬åˆ†ç¦»åˆ°ç‹¬ç«‹çš„ lua æ–‡ä»¶ä¸­å»ç»´æŠ¤ã€‚ ä¾‹å¦‚ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") on_load(\"modules.test.load\") on_install(\"modules.test.install\") end) ``` æˆ‘ä»¬å¯ä»¥æŠŠè‡ªå®šä¹‰çš„è„šæœ¬æ”¾ç½®åˆ° xmake.lua å¯¹åº”ç›®å½•ä¸‹ï¼Œ`modules/test/load.lua` å’Œ `modules/test/install.lua` ä¸­ç‹¬ç«‹ç»´æŠ¤ã€‚ è¿™äº›ç‹¬ç«‹çš„ lua è„šæœ¬é‡Œé¢ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡[import](/zh cn/manual/builtin_modules?id import)å¯¼å…¥å„ç§å†…ç½®æ¨¡å—å’Œè‡ªå®šä¹‰æ¨¡å—è¿›æ¥ä½¿ç”¨ï¼Œå°±è·Ÿå¹³å¸¸å†™lua, java æ²¡å•¥åŒºåˆ«ã€‚ è€Œå¯¹äºè„šæœ¬çš„åŸŸçš„ä¸åŒé˜¶æ®µï¼Œ`on_load` ä¸»è¦ç”¨äº target åŠ è½½æ—¶å€™ï¼Œåšä¸€äº›åŠ¨æ€åŒ–çš„é…ç½®ï¼ˆæ³¨æ„è¿™é‡Œä¸åƒæè¿°åŸŸï¼Œåªä¼šæ‰§è¡Œä¸€éï¼‰ã€‚ å…¶ä»–é˜¶æ®µï¼Œè¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š`on/after/before`_`build/install/package/run` ç­‰ï¼Œå…·ä½“çœ‹ä¸‹åé¢çš„ target api æ‰‹å†Œéƒ¨åˆ†å§ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†ã€‚ ## é…ç½®ç±»å‹ åœ¨æè¿°åŸŸé…ç½®ä¸­ï¼Œåˆ†é…ç½®åŸŸå’Œé…ç½®é¡¹ï¼Œé…ç½®åŸŸé‡Œé¢å¯ä»¥é€šè¿‡ `set_xxx`/`add_xxx` çš„æ¥å£ï¼Œé…ç½®å„ç§é…ç½®é¡¹ã€‚ ```lua target(\"test1\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) target(\"test2\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` åƒä¸Šè¿°é…ç½®ä¸­ï¼Œtarget å°±å±äºé…ç½®åŸŸï¼Œå®ƒä¸‹é¢çš„æ‰€æœ‰ `set_xx`/`add_xxx` æ¥å£é…ç½®éƒ½å±äºé…ç½®é¡¹ï¼Œå¯¹è¿™ä¸ª target å±€éƒ¨ç”Ÿæ•ˆã€‚ æˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£æˆå±€éƒ¨ä½œç”¨åŸŸï¼Œç±»ä¼¼ c é‡Œé¢çš„ block å—ï¼š ``` target(\"test1\") { set_kind(\"binary\") add_files(\"src/*.c\") } target(\"test2\") { set_kind(\"binary\") add_files(\"src/*.c\") } ``` ä¸è¿‡ï¼Œä¸ºäº†ç®€åŒ–å†™æ³•ï¼Œxmake çº¦å®šæ¯ä¸ªæ–°å®šä¹‰çš„ target åŸŸå¼€å§‹ï¼Œä¸Šä¸€ä¸ªé…ç½®åŸŸå°±è‡ªåŠ¨ç»“æŸäº†ï¼Œå½“ç„¶ï¼Œå¦‚æœè¿™æ ·ç”¨æˆ·è§‰å¾—æœ‰å›°æ‰°ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨é…ç½®ç¦»å¼€åŸŸï¼š ```lua target(\"test1\") set_kind(\"binary\") add_files(\"src/*.c\") target_end() target(\"test2\") set_kind(\"binary\") add_files(\"src/*.c\") target_end() ``` ### é…ç½®åŸŸ ç›®å‰æä¾›çš„é…ç½®åŸŸæœ‰ï¼š`target()`, `option()`, `task()`, `package()` æ¯ä¸ªåŸŸçš„è¯¦ç»†è¯´æ˜ï¼Œè§ï¼š[APIæ‰‹å†Œ](/zh cn/manual/project_target) ### é…ç½®é¡¹ åªè¦æ˜¯å¸¦æœ‰ `set_xxx` å’Œ `add_xxx` å­—æ ·çš„é…ç½®ï¼Œéƒ½å±äºé…ç½®é¡¹ï¼Œä¸€ä¸ªé…ç½®åŸŸé‡Œé¢å¯ä»¥è®¾ç½®å¤šä¸ªé…ç½®é¡¹ã€‚ å…³äºé…ç½®é¡¹çš„è§„èŒƒè¯´æ˜ï¼Œè§ï¼š[æ¥å£è§„èŒƒ](/zh cn/manual/specification) ## ä½œç”¨åŸŸ xmake çš„æè¿°è¯­æ³•æ˜¯æŒ‰ä½œç”¨åŸŸåˆ’åˆ†çš„ï¼Œä¸»è¦åˆ†ä¸ºï¼š å¤–éƒ¨ä½œç”¨åŸŸ å†…éƒ¨ä½œç”¨åŸŸ æ¥å£ä½œç”¨åŸŸ é‚£å“ªäº›å±äºå¤–éƒ¨ï¼Œå“ªäº›åˆå±äºå†…éƒ¨å‘¢ï¼Œçœ‹çœ‹ä¸‹é¢çš„æ³¨é‡Šï¼Œå°±çŸ¥é“ä¸ªå¤§æ¦‚äº†ï¼š ```lua å¤–éƒ¨ä½œç”¨åŸŸ target(\"test\", function() å¤–éƒ¨ä½œç”¨åŸŸ set_kind(\"binary\") add_files(\"src/*.c\") on_run(function () å†…éƒ¨ä½œç”¨åŸŸ end) after_package(function () å†…éƒ¨ä½œç”¨åŸŸ end) end) å¤–éƒ¨ä½œç”¨åŸŸ task(\"hello\", function() å¤–éƒ¨ä½œç”¨åŸŸ on_run(function () å†…éƒ¨ä½œç”¨åŸŸ end) end) ``` ç®€å•çš„è¯´ï¼Œå°±æ˜¯åœ¨è‡ªå®šä¹‰è„šæœ¬ `function () end` ä¹‹å†…çš„éƒ½å±äºå†…éƒ¨ä½œç”¨åŸŸï¼Œä¹Ÿå°±æ˜¯è„šæœ¬ä½œç”¨åŸŸï¼Œå…¶ä»–åœ°æ–¹éƒ½æ˜¯éƒ½å±äºäºå¤–éƒ¨ä½œç”¨åŸŸã€‚ã€‚ ### å¤–éƒ¨ä½œç”¨åŸŸ å¯¹äºå¤§éƒ¨åˆ†å·¥ç¨‹æ¥è¯´ï¼Œå¹¶ä¸éœ€è¦å¾ˆå¤æ‚çš„å·¥ç¨‹æè¿°ï¼Œä¹Ÿä¸éœ€è¦è‡ªå®šä¹‰è„šæœ¬æ”¯æŒï¼Œåªéœ€è¦ç®€å•çš„ `set_xxx` æˆ–è€… `add_xxx` å°±èƒ½æ»¡è¶³éœ€æ±‚äº† é‚£ä¹ˆæ ¹æ®äºŒå…«å®šå¾‹ï¼Œ80% çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦è¿™ä¹ˆå†™ï¼š ```lua target(\"test\", function() set_kind(\"static\") add_files(\"src/test/*.c\") end) target(\"demo\", function() add_deps(\"test\") set_kind(\"binary\") add_links(\"test\") add_files(\"src/demo/*.c\") end) ``` ä¸éœ€è¦å¤æ‚çš„ api è°ƒç”¨ï¼Œä¹Ÿä¸éœ€è¦å„ç§ç¹ççš„å˜é‡å®šä¹‰ï¼Œä»¥åŠ if åˆ¤æ–­ å’Œ for å¾ªç¯ï¼Œè¦çš„å°±æ˜¯ç®€æ´å¯è¯»ï¼Œä¸€çœ¼çœ‹è¿‡å»ï¼Œå°±ç®—ä¸æ‡‚ lua è¯­æ³•ä¹Ÿæ²¡å…³ç³» å°±å½“åšç®€å•çš„æè¿°è¯­æ³•ï¼Œçœ‹ä¸Šå»æœ‰ç‚¹åƒå‡½æ•°è°ƒç”¨è€Œå·²ï¼Œä¼šç‚¹ç¼–ç¨‹çš„åŸºæœ¬ä¸€çœ‹å°±çŸ¥é“æ€ä¹ˆé…ç½®ã€‚ ä¸ºäº†åšåˆ°ç®€æ´ã€å®‰å…¨ï¼Œåœ¨è¿™ä¸ªä½œç”¨åŸŸå†…ï¼Œå¾ˆå¤š lua å†…ç½® api æ˜¯ä¸å¼€æ”¾å‡ºæ¥çš„ï¼Œå°¤å…¶æ˜¯è·Ÿå†™æ–‡ä»¶ã€ä¿®æ”¹æ“ä½œç¯å¢ƒç›¸å…³çš„ï¼Œä»…ä»…æä¾›ä¸€äº›åŸºæœ¬çš„åªè¯»æ¥å£ï¼Œå’Œé€»è¾‘æ“ä½œ ç›®å‰å¤–éƒ¨ä½œç”¨åŸŸå¼€æ”¾çš„ lua å†…ç½® api æœ‰ï¼š table string pairs ipairs print os å½“ç„¶è™½ç„¶å†…ç½® lua api æä¾›ä¸å¤šï¼Œä½† xmake è¿˜æä¾›äº†å¾ˆå¤šæ‰©å±• apiï¼Œåƒæè¿° api å°±ä¸å¤šè¯´ï¼Œè¯¦ç»†å¯å‚è€ƒï¼š[APIæ‰‹å†Œ](/zh cn/manual/builtin_modules) è¿˜æœ‰äº›è¾…åŠ© apiï¼Œä¾‹å¦‚ï¼š dirsï¼šæ‰«æè·å–å½“å‰æŒ‡å®šè·¯å¾„ä¸­çš„æ‰€æœ‰ç›®å½• filesï¼šæ‰«æè·å–å½“å‰æŒ‡å®šè·¯å¾„ä¸­çš„æ‰€æœ‰æ–‡ä»¶ format: æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œstring.format çš„ç®€å†™ç‰ˆæœ¬ è¿˜æœ‰å˜é‡å®šä¹‰ã€é€»è¾‘æ“ä½œä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œæ¯•ç«Ÿæ˜¯åŸºäº lua çš„ï¼Œè¯¥æœ‰çš„åŸºç¡€è¯­æ³•ï¼Œè¿˜æ˜¯è¦æœ‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ if æ¥åˆ‡æ¢ç¼–è¯‘æ–‡ä»¶ï¼š ```lua target(\"test\", function() set_kind(\"static\") if is_plat(\"iphoneos\") then add_files(\"src/test/ios/*.c\") else add_files(\"src/test/*.c\") end end) ``` éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå˜é‡å®šä¹‰åˆ†å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡ï¼Œå±€éƒ¨å˜é‡åªå¯¹å½“å‰ xmake.lua æœ‰æ•ˆï¼Œä¸å½±å“å­ xmake.lua ```lua å±€éƒ¨å˜é‡ï¼Œåªå¯¹å½“å‰xmake.luaæœ‰æ•ˆ local var1 0 å…¨å±€å˜é‡ï¼Œå½±å“æ‰€æœ‰ä¹‹å includes() åŒ…å«çš„å­ xmake.lua var2 1 includes(\"src\") ``` ### å†…éƒ¨ä½œç”¨åŸŸ ä¹Ÿç§°æ’ä»¶ã€è„šæœ¬ä½œç”¨åŸŸï¼Œæä¾›æ›´åŠ å¤æ‚ã€çµæ´»çš„è„šæœ¬æ”¯æŒï¼Œä¸€èˆ¬ç”¨äºç¼–å†™ä¸€äº›è‡ªå®šä¹‰è„šæœ¬ã€æ’ä»¶å¼€å‘ã€è‡ªå®šä¹‰ task ä»»åŠ¡ã€è‡ªå®šä¹‰æ¨¡å—ç­‰ç­‰ ä¸€èˆ¬é€šè¿‡ `function () end` åŒ…å«ï¼Œå¹¶ä¸”è¢«ä¼ å…¥åˆ° `on_xxx`, `before_xxx` å’Œ `after_xxx` æ¥å£å†…çš„ï¼Œéƒ½å±äºè‡ªä½œç”¨åŸŸã€‚ ä¾‹å¦‚ï¼š ```lua è‡ªå®šä¹‰è„šæœ¬ target(\"hello\", function() after_build(function () å†…éƒ¨ä½œç”¨åŸŸ end) end) è‡ªå®šä¹‰ä»»åŠ¡ã€æ’ä»¶ task(\"hello\", function() on_run(function () å†…éƒ¨ä½œç”¨åŸŸ end) end) ``` åœ¨æ­¤ä½œç”¨åŸŸä¸­ï¼Œä¸ä»…å¯ä»¥ä½¿ç”¨å¤§éƒ¨åˆ† lua çš„ apiï¼Œè¿˜å¯ä»¥ä½¿ç”¨å¾ˆå¤š xmake æä¾›çš„æ‰©å±•æ¨¡å—ï¼Œæ‰€æœ‰æ‰©å±•æ¨¡å—ï¼Œé€šè¿‡ import æ¥å¯¼å…¥ å…·ä½“å¯å‚è€ƒï¼š[importæ¨¡å—å¯¼å…¥æ–‡æ¡£](/zh cn/manual/builtin_modules?id import) è¿™é‡Œæˆ‘ä»¬ç»™ä¸ªç®€å•çš„ä¾‹å­ï¼Œåœ¨ç¼–è¯‘å®Œæˆåï¼Œå¯¹ ios ç›®æ ‡ç¨‹åºè¿›è¡Œ ldid ç­¾åï¼š ```lua target(\"iosdemo\", function() set_kind(\"binary\") add_files(\"*.m\") after_build(function (target) æ‰§è¡Œç­¾åï¼Œå¦‚æœå¤±è´¥ï¼Œè‡ªåŠ¨ä¸­æ–­ï¼Œç»™å‡ºé«˜äº®é”™è¯¯ä¿¡æ¯ os.run(\"ldid S$(projectdir)/entitlements.plist %s\", target:targetfile()) end) end) ``` éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å†…éƒ¨ä½œç”¨åŸŸä¸­ï¼Œæ‰€æœ‰çš„è°ƒç”¨éƒ½æ˜¯å¯ç”¨å¼‚å¸¸æ•è·æœºåˆ¶çš„ï¼Œå¦‚æœè¿è¡Œå‡ºé”™ï¼Œä¼šè‡ªåŠ¨ä¸­æ–­ xmakeï¼Œå¹¶ç»™å‡ºé”™è¯¯æç¤ºä¿¡æ¯ å› æ­¤ï¼Œè„šæœ¬å†™èµ·æ¥ï¼Œä¸éœ€è¦ç¹ççš„ `if retval then` åˆ¤æ–­ï¼Œè„šæœ¬é€»è¾‘æ›´åŠ ä¸€ç›®äº†ç„¶ ### æ¥å£ä½œç”¨åŸŸ åœ¨å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„æ‰€æœ‰æè¿°apiè®¾ç½®ï¼Œæœ¬èº«ä¹Ÿæ˜¯æœ‰ä½œç”¨åŸŸä¹‹åˆ†çš„ï¼Œåœ¨ä¸åŒåœ°æ–¹è°ƒç”¨ï¼Œå½±å“èŒƒå›´ä¹Ÿä¸ç›¸åŒï¼Œä¾‹å¦‚ï¼š ```lua å…¨å±€æ ¹ä½œç”¨åŸŸï¼Œå½±å“æ‰€æœ‰ targetï¼ŒåŒ…æ‹¬ includes() ä¸­çš„å­å·¥ç¨‹ target è®¾ç½® add_defines(\"DEBUG\") å®šä¹‰æˆ–è€…è¿›å…¥ demo ç›®æ ‡ä½œç”¨åŸŸï¼ˆæ”¯æŒå¤šæ¬¡è¿›å…¥æ¥è¿½åŠ è®¾ç½®ï¼‰ target(\"demo\", function() set_kind(\"shared\") add_files(\"src/*.c\") å½“å‰ target ä½œç”¨åŸŸï¼Œä»…ä»…å½±å“å½“å‰ target add_defines(\"DEBUG2\") end) é€‰é¡¹è®¾ç½®ï¼Œä»…æ”¯æŒå±€éƒ¨è®¾ç½®ï¼Œä¸å—å…¨å±€ api è®¾ç½®æ‰€å½±å“ option(\"test\", function() å½“å‰é€‰é¡¹çš„å±€éƒ¨ä½œç”¨åŸŸ set_default(false) end) å…¶ä»–targetè®¾ç½®ï¼Œ DDEBUG ä¹Ÿä¼šè¢«è®¾ç½®ä¸Š target(\"demo2\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) é‡æ–°è¿›å…¥demoç›®æ ‡ä½œç”¨åŸŸ target(\"demo\", function() è¿½åŠ å®å®šä¹‰ï¼Œåªå¯¹å½“å‰demoç›®æ ‡æœ‰æ•ˆ add_defines(\"DEBUG3\") end) ``` é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿›å…¥å¦ä¸€ä¸ª target/option åŸŸè®¾ç½®ï¼Œä¼šè‡ªåŠ¨ç¦»å¼€ä¸Šä¸ª target/option åŸŸï¼Œä½†æ˜¯æœ‰æ—¶å€™ä¸ºäº†æ¯”è¾ƒä¸€äº›ä½œç”¨åŸŸæ±¡æŸ“æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºç¦»å¼€æŸä¸ªåŸŸï¼Œä¾‹å¦‚ï¼š ```lua option(\"test\") set_default(false) option_end() target(\"demo\") set_kind(\"binary\") add_files(\"src/*.c\") target_end() ``` è°ƒç”¨ `option_end()`, `target_end()` å³å¯æ˜¾å¼çš„ç¦»å¼€å½“å‰ target/option åŸŸè®¾ç½®ã€‚ ### ä»£ç æ ¼å¼åŒ– ç”±äºé»˜è®¤çš„æè¿°åŸŸé…ç½®è¯­æ³•çš„ç¼©è¿›å¹¶ä¸ç¬¦åˆ lua æ ¼å¼è§„èŒƒï¼Œå› æ­¤ lua language server æ˜¯ä¸æ”¯æŒå¯¹å®ƒè¿›è¡Œæ ¼å¼åŒ–å¤„ç†çš„ã€‚ å¦‚æœæƒ³è¦è®© IDEï¼Œç¼–è¾‘å™¨æ›´å¥½çš„å¯¹é…ç½®è¿›è¡Œæ ¼å¼åŒ–ç¼©è¿›æ”¯æŒï¼Œæˆ‘ä¹ˆå¯ä»¥é€šè¿‡ `do end` çš„å†™æ³•æ¥å¤„ç†ï¼š ```lua target(\"bar\") do set_kind(\"binary\") add_files(\"src/*.cpp\") end target(\"foo\") do set_kind(\"binary\") add_files(\"src/*.cpp\") end ``` è¿™æ ·ï¼ŒLua LSP å°±èƒ½æŠŠå®ƒä½œä¸ºæ ‡å‡†çš„ lua ä»£ç è¿›è¡Œæ­£ç¡®çš„æ ¼å¼åŒ–ï¼Œæ˜¯å¦éœ€è¦è¿™ä¹ˆåšï¼Œçœ‹ç”¨æˆ·è‡ªå·±çš„éœ€æ±‚ã€‚ å¦‚æœæ²¡æœ‰ä»£ç è‡ªåŠ¨æ ¼å¼åŒ–çš„ä½¿ç”¨ä¹ æƒ¯ï¼Œé‚£å°±ä¸éœ€è¦è¿™ä¹ˆåšã€‚ ## å¤šçº§é…ç½® åœ¨è„šæœ¬åŸŸæˆ‘ä»¬å¯ä»¥é€šè¿‡ import å¯¼å…¥å„ç§ä¸°å¯Œçš„æ‰©å±•æ¨¡å—æ¥ä½¿ç”¨ï¼Œè€Œåœ¨æè¿°åŸŸæˆ‘ä»¬å¯ä»¥é€šè¿‡[includes](/#/zh cn/manual/global_interfaces?id includes)æ¥å£ï¼Œæ¥å¼•å…¥é¡¹ç›®å­ç›®å½•ä¸‹çš„ xmake.lua é…ç½®ã€‚ è®°ä½ï¼šxmake çš„ includes æ˜¯æŒ‰ç…§ tree ç»“æ„æ¥å¤„ç†é…ç½®å…³ç³»çš„ï¼Œå­ç›®å½•ä¸‹çš„ xmake.lua é‡Œé¢çš„ target é…ç½®ä¼šç»§æ‰¿çˆ¶ xmake.lua ä¸­çš„æ ¹åŸŸé…ç½®ï¼Œä¾‹å¦‚ï¼š ç›®å‰æœ‰å¦‚ä¸‹é¡¹ç›®ç»“æ„ï¼š ``` projectdir xmake.lua src xmake.lua ``` `projectdir/xmake.lua` æ˜¯é¡¹ç›®çš„æ ¹ xmake.lua é…ç½®ï¼Œè€Œ `src/xmake.lua` æ˜¯é¡¹ç›®çš„å­é…ç½®ã€‚ `projectdir/xmake.lua` å†…å®¹ï¼š ```lua add_defines(\"ROOT\") target(\"test1\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_defines(\"TEST1\") end) target(\"test2\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_defines(\"TEST2\") end) includes(\"src\") ``` é‡Œé¢å…¨å±€æ ¹åŸŸé…ç½®äº† `add_defines(\"ROOT\")`ï¼Œä¼šå½±å“ä¸‹é¢çš„æ‰€æœ‰ target é…ç½®ï¼ŒåŒ…æ‹¬ includes é‡Œé¢å­ xmake.lua ä¸­çš„æ‰€æœ‰ target é…ç½®ï¼Œæ‰€ä»¥è¿™ä¸ªæ˜¯å…¨å±€æ€»é…ç½®ã€‚ è€Œåœ¨ test1/test2 é‡Œé¢çš„ `add_defines(\"TEST1\")` å’Œ `add_defines(\"TEST2\")` å±äºå±€éƒ¨é…ç½®ï¼Œåªå¯¹å½“å‰ target ç”Ÿæ•ˆã€‚ `src/xmake.lua` å†…å®¹ï¼š ```lua add_defines(\"ROOT2\") target(\"test3\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_defines(\"TEST3\") end) ``` åœ¨ `src/xmake.lua` å­é…ç½®ä¸­ï¼Œä¹Ÿæœ‰ä¸ªå…¨å±€æ ¹åŸŸï¼Œé…ç½®äº† `add_defines(\"ROOT2\")`ï¼Œè¿™ä¸ªå±äºå­é…ç½®æ ¹åŸŸï¼Œåªå¯¹å½“å‰å­ xmake.lua é‡Œé¢æ‰€æœ‰ target ç”Ÿæ•ˆï¼Œä¹Ÿä¼šå¯¹ä¸‹çº§ includes é‡Œé¢çš„å­ xmake.lua ä¸­ target ç”Ÿæ•ˆï¼Œå› ä¸ºä¹‹å‰è¯´äº†ï¼Œxmake æ˜¯ tree çŠ¶ç»“æ„çš„é…ç½®ç»§æ‰¿å…³ç³»ã€‚ æ‰€ä»¥ï¼Œè¿™å‡ ä¸ª target çš„æœ€ç»ˆé…ç½®ç»“æœä¾æ¬¡æ˜¯ï¼š ``` target(\"test1\"): DROOT DTEST1 target(\"test2\"): DROOT DTEST2 target(\"test3\"): DROOT DROOT2 DTEST3 ``` ## è¯­æ³•ç®€åŒ– xmake.lua çš„é…ç½®åŸŸè¯­æ³•ï¼Œéå¸¸çµæ´»ï¼Œå¯ä»¥åœ¨ç›¸å…³åŸŸåšå„ç§å¤æ‚çµæ´»çš„é…ç½®ï¼Œä½†æ˜¯å¯¹äºè®¸å¤šç²¾ç®€çš„å°å—é…ç½®ï¼Œè¿™ä¸ªæ—¶å€™å°±ç¨æ˜¾å†—ä½™äº†ï¼š ```lua option(\"test1\", function() set_default(true) set_showmenu(true) set_description(\"test1 option\") end) option(\"test2\", function() set_default(true) set_showmeu(true) end) option(\"test3\", function() set_default(\"hello\") end) ``` å¯¹äºä¸Šé¢çš„è¿™äº›å°å— option åŸŸè®¾ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–ä¸‹æˆå•è¡Œæè¿°ï¼š ```lua option(\"test1\", {default true, showmenu true, description \"test1 option\"}) option(\"test2\", {default true, showmenu true}) option(\"test3\", {default \"hello\"}) ``` é™¤äº† option åŸŸï¼Œå¯¹äºå…¶ä»–åŸŸä¹Ÿæ˜¯æ”¯æŒè¿™ç§ç®€åŒ–å†™æ³•çš„ï¼Œä¾‹å¦‚ï¼š ```lua target(\"demo\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` ç®€åŒ–ä¸ºï¼š ```lua target(\"demo\", {kind \"binary\", files \"src/*.c\"}) ``` æˆ–è€… ```lua target(\"demo\", { kind \"binary\", files \"src/*.c\" }) ``` å½“ç„¶ï¼Œå¦‚æœé…ç½®éœ€æ±‚æ¯”è¾ƒå¤æ‚çš„ï¼Œè¿˜æ˜¯åŸæœ‰çš„å¤šè¡Œè®¾ç½®æ–¹å¼æ›´åŠ æ–¹ä¾¿ï¼Œè¿™ä¸ªå°±çœ‹è‡ªå·±çš„éœ€æ±‚æ¥è¯„ä¼°åˆ°åº•ä½¿ç”¨å“ªç§æ–¹å¼äº†ã€‚"},"/get_started/zh/tutorial/configuration.html":{"title":"","content":" class: heading_no_counter # é…ç½®è¯´æ˜ é€šè¿‡ `xmake fconfig` é…ç½®å‘½ä»¤ï¼Œè®¾ç½®æ„å»ºå‰çš„ç›¸å…³é…ç½®ä¿¡æ¯ï¼Œè¯¦ç»†å‚æ•°é€‰é¡¹ï¼Œè¯·è¿è¡Œ: `xmake f help`ã€‚ > **Tips**: > ä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œç¼©å†™æ¥ç®€åŒ–è¾“å…¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¨åï¼Œä¾‹å¦‚: > > * `xmake f` æˆ–è€… `xmake config` > * `xmake f p linux` æˆ–è€… `xmake config plat linux` ## ç›®æ ‡å¹³å° ### ä¸»æœºå¹³å° ```bash $ xmake ``` > xmakeå°†ä¼šè‡ªåŠ¨æ¢æµ‹å½“å‰ä¸»æœºå¹³å°ï¼Œé»˜è®¤è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ç›®æ ‡ç¨‹åºã€‚ ### Linux ```bash $ xmake f p linux [ a i386x86_64] $ xmake ``` ### Android ```bash $ xmake f p android ndk ~/files/android ndk r10e/ [ a armeabi v7aarm64 v8a] $ xmake ``` å¦‚æœè¦æ‰‹åŠ¨æŒ‡å®š ndk ä¸­å…·ä½“æŸä¸ªå·¥å…·é“¾ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤æ£€æµ‹çš„é…ç½®ï¼Œå¯ä»¥é€šè¿‡[ bin](# bin)æ¥è®¾ç½®ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p android ndk ~/files/android ndk r10e/ a arm64 v8a bin ~/files/android ndk r10e/toolchains/aarch64 linux android 4.9/prebuilt/darwin x86_64/bin ``` [ bin](# bin)ä¸»è¦ç”¨äºè®¾ç½®é€‰æ‹©ç¼–è¯‘å·¥å…·çš„å…·ä½“ bin ç›®å½•ï¼Œè¿™ä¸ªçš„ä½¿ç”¨è·Ÿ[äº¤å‰ç¼–è¯‘](#äº¤å‰ç¼–è¯‘é…ç½®)ä¸­çš„[ bin](# bin)çš„è¡Œä¸ºæ˜¯ä¸€è‡´çš„ã€‚ > å¦‚æœæ‰‹åŠ¨è®¾ç½®äº† bin ç›®å½•ï¼Œæ²¡æœ‰é€šè¿‡æ£€æµ‹ï¼Œå¯ä»¥çœ‹ä¸‹æ˜¯å¦ ` arch ` å‚æ•°æ²¡æœ‰åŒ¹é…å¯¹ã€‚ ### iPhoneOS ```bash $ xmake f p iphoneos [ a armv7armv7sarm64i386x86_64] $ xmake ``` ç”±äº m1 è®¾å¤‡ä¸Šæ¨¡æ‹Ÿå™¨ä¹Ÿæ”¯æŒ arm64 æ¶æ„ï¼Œå› æ­¤ä¹‹å‰å•çº¯ä» arch å»åŒºåˆ†æ˜¯å¦ä¸ºæ¨¡æ‹Ÿå™¨ï¼Œå·²æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚ å› æ­¤æˆ‘ä»¬æ–°å¢äº†ä¸€ä¸ªå‚æ•°é…ç½®å»åŒºåˆ†æ˜¯å¦ä¸ºæ¨¡æ‹Ÿå™¨ç›®æ ‡ã€‚ ```bash $ xmake f p iphoneos appledev simulator $ xmake f p watchos appledev simulator $ xmake f p appletvos appledev simulator ``` ### Mac Catalyst æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šæ„å»º Mac Catalyst ç¨‹åºã€‚ ```bash $ xmake f appledev catalyst ``` ### Apple WatchOS ```bash $ xmake f p watchos [ a i386armv7k] $ xmake ``` ### Wasm (WebAssembly) æ­¤å¹³å°ç”¨äºç¼–è¯‘ WebAssembly ç¨‹åºï¼ˆå†…éƒ¨ä¼šä½¿ç”¨ emcc å·¥å…·é“¾ï¼‰ï¼Œåœ¨åˆ‡æ¢æ­¤å¹³å°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¿›å…¥ Emscripten å·¥å…·é“¾ç¯å¢ƒï¼Œç¡®ä¿ emcc ç­‰ç¼–è¯‘å™¨å¯ç”¨ã€‚ ```bash $ xmake f p wasm $ xmake ``` xmake ä¹Ÿæ”¯æŒ Qt for wasm ç¼–è¯‘ï¼Œåªéœ€è¦ï¼š ```bash $ xmake f p wasm [ qt ~/Qt] $ xmake ``` å…¶ä¸­ ` qt` å‚æ•°è®¾ç½®æ˜¯å¯é€‰çš„ï¼Œé€šå¸¸ xmake éƒ½èƒ½æ£€æµ‹åˆ° qt çš„ sdk è·¯å¾„ã€‚ éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒEmscripten å’Œ Qt SDK çš„ç‰ˆæœ¬æ˜¯æœ‰å¯¹åº”å…³ç³»çš„ï¼Œä¸åŒ¹é…çš„ç‰ˆæœ¬ï¼Œå¯èƒ½ä¼šæœ‰ Qt/Wasm ä¹‹é—´çš„å…¼å®¹é—®é¢˜ã€‚ å…³äºç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼Œå¯ä»¥çœ‹ä¸‹ï¼š[https://wiki.qt.io/Qt_for_WebAssembly](https://wiki.qt.io/Qt_for_WebAssembly) æ›´å¤šè¯¦æƒ…è§ï¼š[https://github.com/xmake io/xmake/issues/956](https://github.com/xmake io/xmake/issues/956) é™¤äº† emscripten ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¸¸ç”¨çš„ wasm å·¥å…·é“¾ wasi sdkï¼Œç”¨äºæ„å»ºåŸºäº wasi çš„ç¨‹åºï¼Œæˆ‘ä»¬ä»…ä»…åªéœ€è¦åˆ‡æ¢å·¥å…·é“¾å³å¯ã€‚ ```bash $ xmake f p wasm toolchain wasi $ xmake ``` ### HarmonyOS (é¸¿è’™) xmake ä¹Ÿæä¾›äº†é¸¿è’™ OS å¹³å°çš„ native å·¥å…·é“¾ç¼–è¯‘æ”¯æŒï¼š ```bash $ xmake f p harmony ``` xmake ä¼šè‡ªåŠ¨æ¢æµ‹é»˜è®¤çš„ SDK è·¯å¾„ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®š Harmony SDK è·¯å¾„ã€‚ ```bash $ xmake f p Harmony sdk /Users/ruki/Library/Huawei/Sdk/openharmony/10/native ``` ## äº¤å‰ç¼–è¯‘é…ç½® é€šå¸¸ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨å½“å‰ pc ç¯å¢ƒç¼–è¯‘ç”Ÿæˆå…¶ä»–è®¾å¤‡ä¸Šæ‰èƒ½è¿è¡Œçš„ç›®æ ‡æ–‡ä»¶æ—¶å€™ï¼Œå°±éœ€è¦é€šè¿‡å¯¹åº”çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ¥ç¼–è¯‘ç”Ÿæˆå®ƒä»¬ï¼Œæ¯”å¦‚åœ¨ macos ä¸Šç¼–è¯‘ linux çš„ç¨‹åºï¼Œæˆ–è€…åœ¨ linux ä¸Šç¼–è¯‘å…¶ä»–åµŒå…¥å¼è®¾å¤‡çš„ç›®æ ‡æ–‡ä»¶ç­‰ã€‚ é€šå¸¸çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾éƒ½æ˜¯åŸºäº gcc/clang çš„ï¼Œå¤§éƒ½å…·æœ‰ç±»ä¼¼å¦‚ä¸‹çš„ç»“æ„ï¼š ``` /home/toolchains_sdkdir bin arm linux armeabi gcc arm linux armeabi ld ... lib libxxx.a include xxx.h ``` æ¯ä¸ªå·¥å…·é“¾éƒ½æœ‰å¯¹åº”çš„ include/lib ç›®å½•ï¼Œç”¨äºæ”¾ç½®ä¸€äº›ç³»ç»Ÿåº“å’Œå¤´æ–‡ä»¶ï¼Œä¾‹å¦‚ libc, stdc++ ç­‰ï¼Œè€Œ bin ç›®å½•ä¸‹æ”¾ç½®çš„å°±æ˜¯ç¼–è¯‘å·¥å…·é“¾ä¸€ç³»åˆ—å·¥å…·ã€‚ä¾‹å¦‚ï¼š ``` arm linux armeabi ar arm linux armeabi as arm linux armeabi c++ arm linux armeabi cpp arm linux armeabi g++ arm linux armeabi gcc arm linux armeabi ld arm linux armeabi nm arm linux armeabi strip ``` å…¶ä¸­ `arm linux armeabi ` å‰ç¼€å°±æ˜¯ crossï¼Œé€šè¿‡ç”¨æ¥æ ‡ç¤ºç›®æ ‡å¹³å°å’Œæ¶æ„ï¼Œä¸»è¦ç”¨äºè·Ÿä¸»æœºè‡ªèº«çš„ gcc/clang è¿›è¡ŒåŒºåˆ†ã€‚ é‡Œé¢çš„ gcc/g++ å°±æ˜¯ c/c++ çš„ç¼–è¯‘å™¨ï¼Œé€šå¸¸ä¹Ÿå¯ä»¥ä½œä¸ºé“¾æ¥å™¨ä½¿ç”¨ï¼Œé“¾æ¥çš„æ—¶å€™å†…éƒ¨ä¼šå»è°ƒç”¨ ld æ¥é“¾æ¥ï¼Œå¹¶ä¸”è‡ªåŠ¨è¿½åŠ ä¸€äº› c++ åº“ã€‚ cpp æ˜¯é¢„å¤„ç†å™¨ï¼Œas æ˜¯æ±‡ç¼–å™¨ï¼Œar ç”¨äºç”Ÿæˆé™æ€åº“ï¼Œstrip ç”¨äºè£å‰ªæ‰ä¸€äº›ç¬¦å·ä¿¡æ¯ï¼Œä½¿å¾—ç›®æ ‡ç¨‹åºä¼šæ›´åŠ çš„å°ã€‚nm ç”¨äºæŸ¥çœ‹å¯¼å‡ºç¬¦å·åˆ—è¡¨ã€‚ ### è‡ªåŠ¨æ¢æµ‹å’Œç¼–è¯‘ å¦‚æœæˆ‘ä»¬çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ˜¯ä¸Šæ–‡çš„ç»“æ„ï¼Œxmake ä¼šè‡ªåŠ¨æ£€æµ‹è¯†åˆ«è¿™ä¸ª sdk çš„ç»“æ„ï¼Œæå–é‡Œé¢çš„ crossï¼Œä»¥åŠ include/lib è·¯å¾„ä½ç½®ï¼Œç”¨æˆ·é€šå¸¸ä¸éœ€è¦åšé¢å¤–çš„å‚æ•°è®¾ç½®ï¼Œåªéœ€è¦é…ç½®å¥½ sdk æ ¹ç›®å½•å°±å¯ä»¥ç¼–è¯‘äº†ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p cross sdk /home/toolchains_sdkdir $ xmake ``` å…¶ä¸­ï¼Œ` p cross` ç”¨äºæŒ‡å®šå½“å‰çš„å¹³å°æ˜¯äº¤å‰ç¼–è¯‘å¹³å°ï¼Œ` sdk ` ç”¨äºæŒ‡å®šäº¤å‰å·¥å…·é“¾çš„æ ¹ç›®å½•ã€‚ > æ³¨ï¼šæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®š ` p linux` å¹³å°æ¥é…ç½®äº¤å‰ç¼–è¯‘ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯é¢å¤–æ ‡è¯†äº† linux å¹³å°åï¼Œæ–¹ä¾¿ xmake.lua é‡Œé¢é€šè¿‡ `is_plat(\"linux\")` æ¥åˆ¤æ–­å¹³å°ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œxmake ä¼šå»è‡ªåŠ¨æ¢æµ‹ gcc ç­‰ç¼–è¯‘å™¨çš„å‰ç¼€å crossï¼š`arm linux armeabi `ï¼Œå¹¶ä¸”ç¼–è¯‘çš„æ—¶å€™ï¼Œä¹Ÿä¼šè‡ªåŠ¨åŠ ä¸Š**é“¾æ¥åº“**å’Œ**å¤´æ–‡ä»¶**çš„æœç´¢é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ``` I/home/toolchains_sdkdir/include L/home/toolchains_sdkdir/lib ``` è¿™äº›éƒ½æ˜¯ xmake è‡ªåŠ¨å¤„ç†çš„ï¼Œä¸éœ€è¦æ‰‹åŠ¨é…ç½®ä»–ä»¬ã€‚ ### æ‰‹åŠ¨é…ç½®ç¼–è¯‘ å¦‚æœä¸Šé¢çš„è‡ªåŠ¨æ£€æµ‹å¯¹æŸäº›å·¥å…·é“¾ï¼Œè¿˜æ— æ³•å®Œå…¨é€šè¿‡ç¼–è¯‘ï¼Œå°±éœ€è¦ç”¨æˆ·è‡ªå·±æ‰‹åŠ¨è®¾ç½®ä¸€äº›äº¤å‰ç¼–è¯‘ç›¸å…³çš„é…ç½®å‚æ•°ï¼Œæ¥è°ƒæ•´é€‚åº”è¿™äº›ç‰¹æ®Šçš„å·¥å…·é“¾äº†ï¼Œä¸‹é¢æˆ‘ä¼šé€ä¸€è®²è§£å¦‚ä½•é…ç½®ã€‚ ### è®¾ç½®å·¥å…·é“¾ bin ç›®å½• å¯¹äºä¸è§„åˆ™å·¥å…·é“¾ç›®å½•ç»“æ„ï¼Œé å•çº¯åœ°[ sdk](# sdk)é€‰é¡¹è®¾ç½®ï¼Œæ²¡æ³•å®Œå…¨æ£€æµ‹é€šè¿‡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªé€‰é¡¹ç»§ç»­é™„åŠ è®¾ç½®å·¥å…·é“¾çš„ bin ç›®å½•ä½ç½®ã€‚ ä¾‹å¦‚ï¼šä¸€äº›ç‰¹æ®Šçš„äº¤å‰å·¥å…·é“¾çš„ï¼Œç¼–è¯‘å™¨binç›®å½•ï¼Œå¹¶ä¸åœ¨ `/home/toolchains_sdkdir/bin` è¿™ä¸ªä½ç½®ï¼Œè€Œæ˜¯ç‹¬ç«‹åˆ°äº† `/usr/opt/bin`ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è®¾ç½®äº† sdk å‚æ•°çš„åŸºç¡€ä¸Šè¿½åŠ  bin ç›®å½•çš„å‚æ•°è®¾ç½®ï¼Œæ¥è°ƒæ•´å·¥å…·é“¾çš„ bin ç›®å½•ã€‚ ```bash $ xmake f p cross sdk /home/toolchains_sdkdir bin /usr/opt/bin $ xmake ``` ### è®¾ç½®äº¤å‰å·¥å…·é“¾å·¥å…·å‰ç¼€ åƒ `aarch64 linux android ` è¿™ç§ï¼Œé€šå¸¸å¦‚æœä½ é…ç½®äº†` sdk` æˆ–è€… ` bin` çš„æƒ…å†µä¸‹ï¼Œxmake ä¼šå»è‡ªåŠ¨æ£€æµ‹çš„ï¼Œä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨è®¾ç½®ã€‚ ä½†æ˜¯å¯¹äºä¸€äº›æç‰¹æ®Šçš„å·¥å…·é“¾ï¼Œä¸€ä¸ªç›®å½•ä¸‹åŒæ—¶æœ‰å¤šä¸ª cross å‰ç¼€çš„å·¥å…· bin æ··åœ¨ä¸€èµ·çš„æƒ…å†µï¼Œä½ éœ€è¦æ‰‹åŠ¨è®¾ç½®è¿™ä¸ªé…ç½®ï¼Œæ¥åŒºåˆ†åˆ°åº•éœ€è¦é€‰ç”¨å“ªä¸ª binã€‚ ä¾‹å¦‚ï¼Œtoolchains çš„ bin ç›®å½•ä¸‹åŒæ—¶å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„ç¼–è¯‘å™¨ï¼š ``` /opt/bin armv7 linux gcc aarch64 linux gcc ``` æˆ‘ä»¬ç°åœ¨æƒ³è¦é€‰ç”¨ armv7 çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿½åŠ  ` cross ` é…ç½®ç¼–è¯‘å·¥å…·å‰ç¼€åï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p cross sdk /usr/toolsdk bin /opt/bin cross armv7 linux ``` ### è®¾ç½® c/c++ ç¼–è¯‘å™¨ å¦‚æœè¿˜è¦ç»§ç»­ç»†åˆ†é€‰æ‹©ç¼–è¯‘å™¨ï¼Œåˆ™ç»§ç»­è¿½åŠ ç›¸å…³ç¼–è¯‘å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p cross sdk /user/toolsdk cc armv7 linux clang cxx armv7 linux clang++ ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šç¼–è¯‘å™¨å…¨è·¯å¾„ã€‚ ` cc` ç”¨äºæŒ‡å®š c ç¼–è¯‘å™¨åï¼Œ` cxx` ç”¨äºæŒ‡å®š c++ ç¼–è¯‘å™¨åã€‚ > æ³¨ï¼šå¦‚æœå­˜åœ¨ CC/CXX ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ å¦‚æœæŒ‡å®šçš„ç¼–è¯‘å™¨åä¸æ˜¯é‚£äº› xmake å†…ç½®å¯è¯†åˆ«çš„åå­—ï¼ˆå¸¦æœ‰ gcc, clang ç­‰å­—æ ·ï¼‰ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å·¥å…·æ£€æµ‹å°±ä¼šå¤±è´¥ã€‚ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š ```bash xmake f cxx clang++@/home/xxx/c++mips.exe ``` è®¾ç½® c++mips.exe ç¼–è¯‘å™¨ä½œä¸ºç±» clang++ çš„ä½¿ç”¨æ–¹å¼æ¥ç¼–è¯‘ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŒ‡å®šç¼–è¯‘å™¨ä¸º `c++mips.exe` çš„åŒæ—¶ï¼Œå‘Šè¯‰ xmakeï¼Œå®ƒè·Ÿ clang++ ç”¨æ³•å’Œå‚æ•°é€‰é¡¹åŸºæœ¬ç›¸åŒã€‚ ### è®¾ç½® c/c++ é“¾æ¥å™¨ å¦‚æœè¿˜è¦ç»§ç»­ç»†åˆ†é€‰æ‹©é“¾æ¥å™¨ï¼Œåˆ™ç»§ç»­è¿½åŠ ç›¸å…³é“¾æ¥å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p cross sdk /user/toolsdk ld armv7 linux clang++ sh armv7 linux clang++ ar armv7 linux ar ``` ld æŒ‡å®šå¯æ‰§è¡Œç¨‹åºé“¾æ¥å™¨ï¼Œsh æŒ‡å®šå…±äº«åº“ç¨‹åºé“¾æ¥å™¨ï¼Œar æŒ‡å®šç”Ÿæˆé™æ€åº“çš„å½’æ¡£å™¨ã€‚ æ³¨ï¼šå¦‚æœå­˜åœ¨ LD/SH/AR ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ ### è®¾ç½®å¤´æ–‡ä»¶å’Œåº“æœç´¢ç›®å½• å¦‚æœ sdk é‡Œé¢è¿˜æœ‰é¢å¤–çš„å…¶ä»– include/lib ç›®å½•ä¸åœ¨æ ‡å‡†çš„ç»“æ„ä¸­ï¼Œå¯¼è‡´äº¤å‰ç¼–è¯‘æ‰¾ä¸åˆ°åº“å’Œå¤´æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ ` includedirs` å’Œ ` linkdirs` æ¥è¿½åŠ æœç´¢è·¯å¾„ï¼Œç„¶åé€šè¿‡ ` links` æ·»åŠ é¢å¤–çš„é“¾æ¥åº“ã€‚ ```bash $ xmake f p cross sdk /usr/toolsdk includedirs /usr/toolsdk/xxx/include linkdirs /usr/toolsdk/xxx/lib links pthread ``` > æ³¨ï¼šå¦‚æœè¦æŒ‡å®šå¤šä¸ªæœç´¢ç›®å½•ï¼Œå¯ä»¥é€šè¿‡ `:` æˆ–è€… `;` æ¥åˆ†å‰²ï¼Œä¹Ÿå°±æ˜¯ä¸åŒä¸»æœºå¹³å°çš„è·¯å¾„åˆ†éš”ç¬¦ï¼Œlinux/macosä¸‹ç”¨`:`ï¼Œwinä¸‹ç”¨`;`ã€‚ ### è®¾ç½®ç¼–è¯‘å’Œé“¾æ¥é€‰é¡¹ æˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€šè¿‡ ` cflags`, ` cxxflags`ï¼Œ` ldflags`ï¼Œ` shflags` å’Œ ` arflags` é¢å¤–é…ç½®ä¸€äº›ç¼–è¯‘å’Œé“¾æ¥é€‰é¡¹ã€‚ * cflags: æŒ‡å®šcç¼–è¯‘å‚æ•° * cxxflagsï¼šæŒ‡å®šc++ç¼–è¯‘å‚æ•° * cxflags: æŒ‡å®šc/c++ç¼–è¯‘å‚æ•° * asflags: æŒ‡å®šæ±‡ç¼–å™¨ç¼–è¯‘å‚æ•° * ldflags: æŒ‡å®šå¯æ‰§è¡Œç¨‹åºé“¾æ¥å‚æ•° * shflags: æŒ‡å®šåŠ¨æ€åº“ç¨‹åºé“¾æ¥å‚æ•° * arflags: æŒ‡å®šé™æ€åº“çš„ç”Ÿæˆå‚æ•° ä¾‹å¦‚ï¼š ```bash $ xmake f p cross sdk /usr/toolsdk cflags \" DTEST I/xxx/xxx\" ldflags \" lpthread\" ``` ### é¡¹ç›®æè¿°è®¾ç½® #### set_toolchains è¿™å¯¹æŸä¸ªç‰¹å®šçš„ target å•ç‹¬åˆ‡æ¢è®¾ç½®ä¸åŒçš„å·¥å…·é“¾ï¼Œå’Œ set_toolset ä¸åŒçš„æ˜¯ï¼Œæ­¤æ¥å£æ˜¯å¯¹å®Œæ•´å·¥å…·é“¾çš„æ•´ä½“åˆ‡æ¢ï¼Œæ¯”å¦‚ cc/ld/sh ç­‰ä¸€ç³»åˆ—å·¥å…·é›†ã€‚ è¿™ä¹Ÿæ˜¯æ¨èåšæ³•ï¼Œå› ä¸ºåƒ gcc/clang ç­‰å¤§éƒ¨åˆ†ç¼–è¯‘å·¥å…·é“¾ï¼Œç¼–è¯‘å™¨å’Œé“¾æ¥å™¨éƒ½æ˜¯é…å¥—ä½¿ç”¨çš„ï¼Œè¦åˆ‡å°±å¾—æ•´ä½“åˆ‡ï¼Œå•ç‹¬é›¶æ•£çš„åˆ‡æ¢è®¾ç½®ä¼šå¾ˆç¹çã€‚ æ¯”å¦‚æˆ‘ä»¬åˆ‡æ¢ test ç›®æ ‡åˆ° clang+yasm ä¸¤ä¸ªå·¥å…·é“¾ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") set_toolchains(\"clang\", \"yasm\") end) ``` #### set_toolset å¦‚æœè§‰å¾—æ¯æ¬¡é€šè¿‡å‘½ä»¤è¡Œé…ç½®æ¯”è¾ƒç¹çï¼Œæœ‰äº›é…ç½®å¯ä»¥é€šè¿‡åœ¨ xmake.lua é¢„å…ˆé…ç½®å¥½ï¼Œæ¥ç®€åŒ–å‘½ä»¤é…ç½®ï¼Œæ¯”å¦‚ç¼–è¯‘å™¨çš„æŒ‡å®šï¼Œå°±å¯ä»¥é€šè¿‡ `set_toolset` æ¥å¯¹æ¯ä¸ª target å•ç‹¬è®¾ç½®ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") set_toolset(\"cxx\", \"clang\") set_toolset(\"ld\", \"clang++\") end) ``` å¼ºåˆ¶ test ç›®æ ‡çš„ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ä½¿ç”¨ clang ç¼–è¯‘å™¨ï¼Œæˆ–è€…æŒ‡å®šäº¤å‰ç¼–è¯‘å·¥å…·é“¾ä¸­çš„ç¼–è¯‘å™¨åæˆ–è€…è·¯å¾„ã€‚ #### set_config æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `set_config` æ¥è®¾ç½®åœ¨ `xmake f/config` å‘½ä»¤ä¸­çš„æ¯ä¸ªé…ç½®å‚æ•°çš„é»˜è®¤å€¼ï¼Œè¿™æ˜¯ä¸ªå…¨å±€ apiï¼Œå¯¹æ¯ä¸ª target éƒ½ä¼šç”Ÿæ•ˆã€‚ ```lua set_config(\"cflags\", \" DTEST\") set_config(\"sdk\", \"/home/xxx/tooksdk\") set_config(\"cc\", \"gcc\") set_config(\"ld\", \"g++\") ``` ä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡ `xmake f name value` çš„æ–¹å¼ï¼Œå»ä¿®æ”¹ xmake.lua ä¸­çš„é»˜è®¤é…ç½®ã€‚ ### è‡ªå®šä¹‰ç¼–è¯‘å¹³å° å¦‚æœæŸä¸ªäº¤å‰å·¥å…·é“¾ç¼–è¯‘åç›®æ ‡ç¨‹åºæœ‰å¯¹åº”çš„å¹³å°éœ€è¦æŒ‡å®šï¼Œå¹¶ä¸”éœ€è¦åœ¨ xmake.lua é‡Œé¢æ ¹æ®ä¸åŒçš„äº¤å‰ç¼–è¯‘å¹³å°ï¼Œè¿˜éœ€è¦é…ç½®ä¸€äº›é¢å¤–çš„ç¼–è¯‘å‚æ•°ï¼Œé‚£ä¹ˆä¸Šæ–‡çš„ ` p cross` è®¾ç½®å°±ä¸èƒ½æ»¡è¶³éœ€æ±‚äº†ã€‚ å…¶å®ï¼Œ` p/ plat ` å‚æ•°ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºå…¶ä»–è‡ªå®šä¹‰çš„å€¼ï¼Œåªéœ€è¦è·Ÿ `is_plat` ä¿æŒå¯¹åº”å…³ç³»å°±å¯ä»¥ï¼Œæ‰€æœ‰éå†…ç½®å¹³å°åï¼Œéƒ½ä¼šé»˜è®¤é‡‡ç”¨äº¤å‰ç¼–è¯‘æ¨¡å¼ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p myplat sdk /usr/local/arm xxx gcc/ $ xmake ``` æˆ‘ä»¬ä¼ å…¥äº† myplat è‡ªå®šä¹‰å¹³å°åï¼Œä½œä¸ºå½“å‰äº¤å‰å·¥å…·é“¾çš„ç¼–è¯‘å¹³å°ï¼Œç„¶å xmake.lua é‡Œé¢æˆ‘ä»¬å¯¹è¿™ä¸ªå¹³å°ï¼Œé…ç½®ä¸‹å¯¹åº”çš„è®¾ç½®ï¼š ```lua if is_plat(\"myplat\") then add_defines(\"TEST\") end ``` é€šè¿‡è¿™ç§æ–¹å¼ï¼Œxmake å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰©å±•å¤„ç†å„ç§ç¼–è¯‘å¹³å°ï¼Œç”¨æˆ·å¯ä»¥è‡ªå·±æ‰©å±•æ”¯æŒ freebsd, netbsd, sunos ç­‰å…¶ä»–å„ç§å¹³å°çš„äº¤å‰ç¼–è¯‘ã€‚ æˆ‘æ‘˜å½•ä¸€æ®µä¹‹å‰ç§»æ¤ libuv å†™çš„äº¤å‰ç¼–è¯‘çš„é…ç½®ï¼Œç›´è§‚æ„Ÿå—ä¸‹ï¼š ```lua for dragonfly/freebsd/netbsd/openbsd platform if is_plat(\"dragonfly\", \"freebsd\", \"netbsd\", \"openbsd\") then add_files(\"src/unix/bsd ifaddrs.c\") add_files(\"src/unix/freebsd.c\") add_files(\"src/unix/kqueue.c\") add_files(\"src/unix/posix hrtime.c\") add_headerfiles(\"(include/uv bsd.h)\") end for sunos platform if is_plat(\"sunos\") then add_files(\"src/unix/no proctitle.c\") add_files(\"src/unix/sunos.c\") add_defines(\"__EXTENSIONS_\", \"_XOPEN_SOURCE 600\") add_headerfiles(\"(include/uv sunos.h)\") end ``` ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ‡æ¢è¿™äº›å¹³å°æ¥ç¼–è¯‘ï¼š ```bash $ xmake f p [dragonflyfreebsdnetbsdopenbsdsunos] sdk /home/arm xxx gcc/ $ xmake ``` å¦å¤–ï¼Œå†…ç½®çš„ linux å¹³å°ä¹Ÿæ˜¯æ”¯æŒäº¤å‰ç¼–è¯‘çš„ï¼Œå¦‚æœä¸æƒ³é…ç½®å…¶ä»–å¹³å°åï¼Œç»Ÿä¸€ä½œä¸º linux å¹³å°æ¥äº¤å‰ç¼–è¯‘ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ ```bash $ xmake f p linux sdk /usr/local/arm xxx gcc/ $ xmake ``` åªè¦è®¾ç½®äº† ` sdk ` ç­‰å‚æ•°ï¼Œå°±ä¼šå¯ç”¨linuxå¹³å°çš„äº¤å‰ç¼–è¯‘æ¨¡å¼ã€‚ ### å¸¸ç”¨å·¥å…·é“¾é…ç½® å®Œæ•´çš„å·¥å…·é“¾åˆ—è¡¨ï¼Œè¯·æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š ```bash $ xmake show l toolchains ``` ä¸Šæ–‡è®²è¿°çš„æ˜¯é€šç”¨çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾é…ç½®ï¼Œå¦‚æœä¸€äº›ç‰¹å®šçš„å·¥å…·é“¾éœ€è¦é¢å¤–ä¼ å…¥ ` ldflags/ includedirs` ç­‰åœºæ™¯å°±æ¯”è¾ƒç¹çäº†, å› æ­¤ xmake ä¹Ÿå†…ç½®äº†ä¸€äº›å¸¸ç”¨å·¥å…·é“¾ï¼Œå¯ä»¥çœå»äº¤å‰ç¼–è¯‘å·¥å…·é“¾å¤æ‚çš„é…ç½®è¿‡ç¨‹ï¼Œåªéœ€è¦æ‰§è¡Œï¼š ```bash $ xmake f toolchain gnu rm sdk /xxx/ $ xmake ``` å°±å¯ä»¥å¿«é€Ÿåˆ‡æ¢çš„æŒ‡å®šçš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œå¦‚æœè¿™ä¸ªå·¥å…·é“¾éœ€è¦è¿½åŠ ä¸€äº›ç‰¹å®šçš„ flags è®¾ç½®ï¼Œä¹Ÿä¼šè‡ªåŠ¨è®¾ç½®å¥½ï¼Œç®€åŒ–é…ç½®ã€‚ å…¶ä¸­ï¼Œgnu rm å°±æ˜¯å†…ç½®çš„ GNU Arm Embedded Toolchainã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¿«é€Ÿä» gcc å·¥å…·é“¾æ•´ä½“åˆ‡æ¢åˆ° clang æˆ–è€… llvm å·¥å…·é“¾ï¼Œä¸å†éœ€è¦ `xmake f cc clang cxx clang ld clang++` ç­‰æŒ¨ä¸ªé…ç½®äº†ã€‚ ```bash $ xmake f toolchain clang $ xmake ``` æˆ–è€… ```bash $ xmake f toolchain llvm sdk /xxx/llvm $ xmake ``` å…·ä½“ xmake æŒå“ªäº›å·¥å…·é“¾ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š ```bash $ xmake show l toolchains xcode Xcode IDE vs VisualStudio IDE yasm The Yasm Modular Assembler clang A C language family frontend for LLVM go Go Programming Language Compiler dlang D Programming Language Compiler sdcc Small Device C Compiler cuda CUDA Toolkit ndk Android NDK rust Rust Programming Language Compiler llvm A collection of modular and reusable compiler and toolchain technologies cross Common cross compilation toolchain nasm NASM Assembler gcc GNU Compiler Collection mingw Minimalist GNU for Windows gnu rm GNU Arm Embedded Toolchain envs Environment variables toolchain fasm Flat Assembler ``` #### è‡ªå®šä¹‰å·¥å…·é“¾ å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ xmake.lua ä¸­è‡ªå®šä¹‰ toolchainï¼Œç„¶åé€šè¿‡ `xmake f toolchain myclang` æŒ‡å®šåˆ‡æ¢ï¼Œä¾‹å¦‚ï¼š ```lua toolchain(\"myclang\", function() set_kind(\"standalone\") set_toolset(\"cc\", \"clang\") set_toolset(\"cxx\", \"clang\", \"clang++\") set_toolset(\"ld\", \"clang++\", \"clang\") set_toolset(\"sh\", \"clang++\", \"clang\") set_toolset(\"ar\", \"ar\") set_toolset(\"ex\", \"ar\") set_toolset(\"strip\", \"strip\") set_toolset(\"mm\", \"clang\") set_toolset(\"mxx\", \"clang\", \"clang++\") set_toolset(\"as\", \"clang\") ... end) ``` å…³äºè¿™å—çš„è¯¦æƒ…ä»‹ç»ï¼Œå¯ä»¥åˆ°[è‡ªå®šä¹‰å·¥å…·é“¾](/zh cn/manual/custom_toolchain)ç« èŠ‚æŸ¥çœ‹ æ›´å¤šè¯¦æƒ…è§ï¼š[#780](https://github.com/xmake io/xmake/issues/780) #### LLVM å·¥å…·é“¾ llvm å·¥å…·é“¾ä¸‹è½½åœ°å€ï¼š<https://releases.llvm.org/> ```bash $ xmake f p cross toolchain llvm sdk \"C:\\Program Files\\LLVM\" $ xmake ``` #### GNU RM å·¥å…·é“¾ å·¥å…·é“¾åœ°å€ï¼š<https://developer.arm.com/tools and software/open source software/developer tools/gnu toolchain/gnu rm/downloads#> ```bash $ xmake f p cross toolchain gnu rm sdk /xxx/cc arm none eabi 9 2019 q4 major $ xmake ``` #### TinyC å·¥å…·é“¾ ```bash $ xmake f toolchain tinyc $ xmake ``` > Releases ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬è¿˜æä¾›äº†ç‰¹æ®Šçš„ xmake tinyc vX.X.X.win32.exe å®‰è£…åŒ…ï¼Œå†…ç½® tinyc å·¥å…·é“¾ï¼Œæ— éœ€ä¾èµ– msvcï¼Œä¹Ÿå¯ä»¥ç¼–è¯‘ c ä»£ç ï¼Œå¼€ç®±å³ç”¨æ— ä¾èµ–ã€‚ #### Emcc å·¥å…·é“¾ é€šå¸¸åªéœ€è¦åˆ‡æ¢åˆ° Wasm å¹³å°ï¼Œé‡Œé¢å†…ç½®äº† emcc å·¥å…·é“¾ï¼Œè¿˜ä¼šé¢å¤–è°ƒæ•´ç›®æ ‡ç¨‹åºçš„æ‰©å±•åä¸º `*.html` ä»¥åŠè¾“å‡º `*.wasm`ã€‚ ```bash $ xmake f p wasm $ xmake ``` ä¸è¿‡æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿç›´æ¥åˆ‡æ¢åˆ° emcc å·¥å…·é“¾ï¼Œä½†æ˜¯åç¼€åä¸ä¼šè¢«ä¿®æ”¹ã€‚ ```bash $ xmake f toolchain emcc $ xmake ``` #### Intel C++ ç¼–è¯‘å·¥å…·é“¾ ```bash $ xmake f toolchain icc $ xmake ``` #### Intel Fortran ç¼–è¯‘å·¥å…·é“¾ ```bash $ xmake f toolchain ifort $ xmake ``` ### é€šç”¨äº¤å‰ç¼–è¯‘é…ç½® å‚æ•°å æè¿° [ sdk](# sdk) è®¾ç½®äº¤å‰å·¥å…·é“¾çš„sdkæ ¹ç›®å½• [ bin](# bin) è®¾ç½®å·¥å…·é“¾binç›®å½• [ cross](# cross) è®¾ç½®äº¤å‰å·¥å…·é“¾å·¥å…·å‰ç¼€ [ as](# as) è®¾ç½®`asm`æ±‡ç¼–å™¨ [ cc](# cc) è®¾ç½®`c`ç¼–è¯‘å™¨ [ cxx](# cxx) è®¾ç½®`c++`ç¼–è¯‘å™¨ [ mm](# mm) è®¾ç½®`objc`ç¼–è¯‘å™¨ [ mxx](# mxx) è®¾ç½®`objc++`ç¼–è¯‘å™¨ [ sc](# sc) è®¾ç½®`swift`ç¼–è¯‘å™¨ [ gc](# gc) è®¾ç½®`golang`ç¼–è¯‘å™¨ [ dc](# dc) è®¾ç½®`dlang`ç¼–è¯‘å™¨ [ rc](# rc) è®¾ç½®`rust`ç¼–è¯‘å™¨ [ cu](# cu) è®¾ç½®`cuda`ç¼–è¯‘å™¨ [ ld](# ld) è®¾ç½®`c/c++/objc/asm`é“¾æ¥å™¨ [ sh](# sh) è®¾ç½®`c/c++/objc/asm`å…±äº«åº“é“¾æ¥å™¨ [ ar](# ar) è®¾ç½®`c/c++/objc/asm`é™æ€åº“å½’æ¡£å™¨ [ scld](# scld) è®¾ç½®`swift`é“¾æ¥å™¨ [ scsh](# scsh) è®¾ç½®`swift`å…±äº«åº“é“¾æ¥å™¨ [ gcld](# gcld) è®¾ç½®`golang`é“¾æ¥å™¨ [ gcar](# gcar) è®¾ç½®`golang`é™æ€åº“å½’æ¡£å™¨ [ dcld](# dcld) è®¾ç½®`dlang`é“¾æ¥å™¨ [ dcsh](# dcsh) è®¾ç½®`dlang`å…±äº«åº“é“¾æ¥å™¨ [ dcar](# dcar) è®¾ç½®`dlang`é™æ€åº“å½’æ¡£å™¨ [ rcld](# rcld) è®¾ç½®`rust`é“¾æ¥å™¨ [ rcsh](# rcsh) è®¾ç½®`rust`å…±äº«åº“é“¾æ¥å™¨ [ rcar](# rcar) è®¾ç½®`rust`é™æ€åº“å½’æ¡£å™¨ [ cu ccbin](# cu ccbin) è®¾ç½®`cuda` hostç¼–è¯‘å™¨ [ culd](# culd) è®¾ç½®`cuda`é“¾æ¥å™¨ [ asflags](# asflags) è®¾ç½®`asm`æ±‡ç¼–ç¼–è¯‘é€‰é¡¹ [ cflags](# cflags) è®¾ç½®`c`ç¼–è¯‘é€‰é¡¹ [ cxflags](# cxflags) è®¾ç½®`c/c++`ç¼–è¯‘é€‰é¡¹ [ cxxflags](# cxxflags) è®¾ç½®`c++`ç¼–è¯‘é€‰é¡¹ [ mflags](# mflags) è®¾ç½®`objc`ç¼–è¯‘é€‰é¡¹ [ mxflags](# mxflags) è®¾ç½®`objc/c++`ç¼–è¯‘é€‰é¡¹ [ mxxflags](# mxxflags) è®¾ç½®`objc++`ç¼–è¯‘é€‰é¡¹ [ scflags](# scflags) è®¾ç½®`swift`ç¼–è¯‘é€‰é¡¹ [ gcflags](# gcflags) è®¾ç½®`golang`ç¼–è¯‘é€‰é¡¹ [ dcflags](# dcflags) è®¾ç½®`dlang`ç¼–è¯‘é€‰é¡¹ [ rcflags](# rcflags) è®¾ç½®`rust`ç¼–è¯‘é€‰é¡¹ [ cuflags](# cuflags) è®¾ç½®`cuda`ç¼–è¯‘é€‰é¡¹ [ ldflags](# ldflags) è®¾ç½®é“¾æ¥é€‰é¡¹ [ shflags](# shflags) è®¾ç½®å…±äº«åº“é“¾æ¥é€‰é¡¹ [ arflags](# arflags) è®¾ç½®é™æ€åº“å½’æ¡£é€‰é¡¹ > å¦‚æœä½ æƒ³è¦äº†è§£æ›´å¤šå‚æ•°é€‰é¡¹ï¼Œè¯·è¿è¡Œ: `xmake f help`ã€‚ #### sdk * è®¾ç½®äº¤å‰å·¥å…·é“¾çš„sdkæ ¹ç›®å½• å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½ä¸éœ€è¦é…ç½®å¾ˆå¤æ‚çš„ toolchains å‰ç¼€ï¼Œä¾‹å¦‚ï¼š`arm linux ` ä»€ä¹ˆçš„ åªè¦è¿™ä¸ªå·¥å…·é“¾çš„ sdk ç›®å½•æ»¡è¶³å¦‚ä¸‹ç»“æ„ï¼ˆå¤§éƒ¨åˆ†çš„äº¤å‰å·¥å…·é“¾éƒ½æ˜¯è¿™ä¸ªç»“æ„ï¼‰ï¼š ``` /home/toolchains_sdkdir bin arm linux gcc arm linux ld ... lib libxxx.a include xxx.h ``` é‚£ä¹ˆï¼Œä½¿ç”¨ xmake è¿›è¡Œäº¤å‰ç¼–è¯‘çš„æ—¶å€™ï¼Œåªéœ€è¦è¿›è¡Œå¦‚ä¸‹é…ç½®å’Œç¼–è¯‘ï¼š ```bash $ xmake f p linux sdk /home/toolchains_sdkdir $ xmake ``` è¿™ä¸ªæ—¶å€™ï¼Œxmake ä¼šå»è‡ªåŠ¨æ¢æµ‹ï¼Œgcc ç­‰ç¼–è¯‘å™¨çš„å‰ç¼€åï¼š`arm linux `ï¼Œå¹¶ä¸”ç¼–è¯‘çš„æ—¶å€™ï¼Œä¹Ÿä¼šè‡ªåŠ¨åŠ ä¸Š**é“¾æ¥åº“**å’Œ**å¤´æ–‡ä»¶**çš„æœç´¢é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ``` I/home/toolchains_sdkdir/include L/home/toolchains_sdkdir/lib ``` è¿™äº›éƒ½æ˜¯xmakeè‡ªåŠ¨å¤„ç†çš„ï¼Œä¸éœ€è¦æ‰‹åŠ¨é…ç½®ä»–ä»¬ã€‚ã€‚ #### bin * è®¾ç½®å·¥å…·é“¾binç›®å½• å¯¹äºä¸è§„åˆ™å·¥å…·é“¾ç›®å½•ç»“æ„ï¼Œé å•çº¯åœ°[ sdk]( sdk)é€‰é¡¹è®¾ç½®ï¼Œæ²¡æ³•å®Œå…¨æ£€æµ‹é€šè¿‡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªé€‰é¡¹ç»§ç»­é™„åŠ è®¾ç½®å·¥å…·é“¾çš„ bin ç›®å½•ä½ç½®ã€‚ ä¾‹å¦‚ï¼šä¸€äº›ç‰¹æ®Šçš„äº¤å‰å·¥å…·é“¾çš„ï¼Œç¼–è¯‘å™¨ bin ç›®å½•ï¼Œå¹¶ä¸åœ¨ `/home/toolchains_sdkdir/bin` è¿™ä¸ªä½ç½®ï¼Œè€Œæ˜¯ç‹¬ç«‹åˆ°äº† `/usr/opt/bin`ã€‚ ```bash $ xmake f p linux sdk /home/toolchains_sdkdir bin /usr/opt/bin $ xmake ``` #### cross * è®¾ç½®äº¤å‰å·¥å…·é“¾å·¥å…·å‰ç¼€ åƒ `aarch64 linux android ` è¿™ç§ï¼Œé€šå¸¸å¦‚æœä½ é…ç½®äº†[ sdk](# sdk)æˆ–è€…[ bin](# bin)çš„æƒ…å†µä¸‹ï¼Œxmake ä¼šå»è‡ªåŠ¨æ£€æµ‹çš„ï¼Œä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨è®¾ç½®ã€‚ ä½†æ˜¯å¯¹äºä¸€äº›æç‰¹æ®Šçš„å·¥å…·é“¾ï¼Œä¸€ä¸ªç›®å½•ä¸‹åŒæ—¶æœ‰å¤šä¸ª cross å‰ç¼€çš„å·¥å…· bin æ··åœ¨ä¸€èµ·çš„æƒ…å†µï¼Œä½ éœ€è¦æ‰‹åŠ¨è®¾ç½®è¿™ä¸ªé…ç½®ï¼Œæ¥åŒºåˆ†åˆ°åº•éœ€è¦é€‰ç”¨å“ªä¸ª binã€‚ ä¾‹å¦‚ï¼Œtoolchains çš„ bin ç›®å½•ä¸‹åŒæ—¶å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„ç¼–è¯‘å™¨ï¼š ``` /opt/bin armv7 linux gcc aarch64 linux gcc ``` æˆ‘ä»¬ç°åœ¨æƒ³è¦é€‰ç”¨ armv7 çš„ç‰ˆæœ¬ï¼Œåˆ™é…ç½®å¦‚ä¸‹ï¼š ```bash $ xmake f p linux sdk /usr/toolsdk bin /opt/bin cross armv7 linux ``` #### as * è®¾ç½® `asm` æ±‡ç¼–å™¨ å¦‚æœè¿˜è¦ç»§ç»­ç»†åˆ†é€‰æ‹©ç¼–è¯‘å™¨ï¼Œåˆ™ç»§ç»­è¿½åŠ ç›¸å…³ç¼–è¯‘å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p linux sdk /user/toolsdk as armv7 linux as ``` å¦‚æœå­˜åœ¨ `AS` ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ > å¦‚æœæŒ‡å®šçš„ç¼–è¯‘å™¨åä¸æ˜¯é‚£äº› xmake å†…ç½®å¯è¯†åˆ«çš„åå­—ï¼ˆå¸¦æœ‰ gcc, clang ç­‰å­—æ ·ï¼‰ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å·¥å…·æ£€æµ‹å°±ä¼šå¤±è´¥ã€‚ > è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f as gcc@/home/xxx/asmips.exe` è®¾ç½®ccmips.exeç¼–è¯‘å™¨ä½œä¸ºç±» gcc çš„ä½¿ç”¨æ–¹å¼æ¥ç¼–è¯‘ã€‚ > ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŒ‡å®šç¼–è¯‘å™¨ä¸º `asmips.exe` çš„åŒæ—¶ï¼Œå‘Šè¯‰ xmakeï¼Œå®ƒè·Ÿ gcc ç”¨æ³•å’Œå‚æ•°é€‰é¡¹åŸºæœ¬ç›¸åŒã€‚ #### cc * è®¾ç½®cç¼–è¯‘å™¨ å¦‚æœè¿˜è¦ç»§ç»­ç»†åˆ†é€‰æ‹©ç¼–è¯‘å™¨ï¼Œåˆ™ç»§ç»­è¿½åŠ ç›¸å…³ç¼–è¯‘å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p linux sdk /user/toolsdk cc armv7 linux clang ``` å¦‚æœå­˜åœ¨ `CC` ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ > å¦‚æœæŒ‡å®šçš„ç¼–è¯‘å™¨åä¸æ˜¯é‚£äº› xmake å†…ç½®å¯è¯†åˆ«çš„åå­—ï¼ˆå¸¦æœ‰ gcc, clang ç­‰å­—æ ·ï¼‰ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å·¥å…·æ£€æµ‹å°±ä¼šå¤±è´¥ã€‚ > è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f cc gcc@/home/xxx/ccmips.exe` è®¾ç½® ccmips.exe ç¼–è¯‘å™¨ä½œä¸ºç±» gcc çš„ä½¿ç”¨æ–¹å¼æ¥ç¼–è¯‘ã€‚ > ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŒ‡å®šç¼–è¯‘å™¨ä¸º `ccmips.exe` çš„åŒæ—¶ï¼Œå‘Šè¯‰ xmakeï¼Œå®ƒè·Ÿ gcc ç”¨æ³•å’Œå‚æ•°é€‰é¡¹åŸºæœ¬ç›¸åŒã€‚ #### cxx * è®¾ç½® `c++` ç¼–è¯‘å™¨ å¦‚æœè¿˜è¦ç»§ç»­ç»†åˆ†é€‰æ‹©ç¼–è¯‘å™¨ï¼Œåˆ™ç»§ç»­è¿½åŠ ç›¸å…³ç¼–è¯‘å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p linux sdk /user/toolsdk cxx armv7 linux clang++ ``` å¦‚æœå­˜åœ¨ `CXX` ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ > å¦‚æœæŒ‡å®šçš„ç¼–è¯‘å™¨åä¸æ˜¯é‚£äº› xmake å†…ç½®å¯è¯†åˆ«çš„åå­—ï¼ˆå¸¦æœ‰ gcc, clang ç­‰å­—æ ·ï¼‰ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å·¥å…·æ£€æµ‹å°±ä¼šå¤±è´¥ã€‚ > è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f cxx clang++@/home/xxx/c++mips.exe` è®¾ç½® c++mips.exe ç¼–è¯‘å™¨ä½œä¸ºç±» clang++ çš„ä½¿ç”¨æ–¹å¼æ¥ç¼–è¯‘ã€‚ > ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŒ‡å®šç¼–è¯‘å™¨ä¸º `c++mips.exe` çš„åŒæ—¶ï¼Œå‘Šè¯‰ xmakeï¼Œå®ƒè·Ÿ clang++ ç”¨æ³•å’Œå‚æ•°é€‰é¡¹åŸºæœ¬ç›¸åŒã€‚ #### ld * è®¾ç½® `c/c++/objc/asm` é“¾æ¥å™¨ å¦‚æœè¿˜è¦ç»§ç»­ç»†åˆ†é€‰æ‹©é“¾æ¥å™¨ï¼Œåˆ™ç»§ç»­è¿½åŠ ç›¸å…³ç¼–è¯‘å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f p linux sdk /user/toolsdk ld armv7 linux clang++ ``` å¦‚æœå­˜åœ¨ `LD` ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ > å¦‚æœæŒ‡å®šçš„ç¼–è¯‘å™¨åä¸æ˜¯é‚£äº› xmake å†…ç½®å¯è¯†åˆ«çš„åå­—ï¼ˆå¸¦æœ‰ gcc, clang ç­‰å­—æ ·ï¼‰ï¼Œé‚£ä¹ˆé“¾æ¥å™¨å·¥å…·æ£€æµ‹å°±ä¼šå¤±è´¥ã€‚ > è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š`xmake f ld g++@/home/xxx/c++mips.exe` è®¾ç½® c++mips.exe é“¾æ¥å™¨ä½œä¸ºç±» g++ çš„ä½¿ç”¨æ–¹å¼æ¥ç¼–è¯‘ã€‚ > ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŒ‡å®šé“¾æ¥å™¨ä¸º `c++mips.exe` çš„åŒæ—¶ï¼Œå‘Šè¯‰ xmakeï¼Œå®ƒè·Ÿ g++ ç”¨æ³•å’Œå‚æ•°é€‰é¡¹åŸºæœ¬ç›¸åŒã€‚ #### sh * è®¾ç½® `c/c++/objc/asm` å…±äº«åº“é“¾æ¥å™¨ ```bash $ xmake f p linux sdk /user/toolsdk sh armv7 linux clang++ ``` å¦‚æœå­˜åœ¨ `SH` ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ #### ar * è®¾ç½® `c/c++/objc/asm` é™æ€åº“å½’æ¡£å™¨ ```bash $ xmake f p linux sdk /user/toolsdk ar armv7 linux ar ``` å¦‚æœå­˜åœ¨`AR`ç¯å¢ƒå˜é‡çš„è¯ï¼Œä¼šä¼˜å…ˆä½¿ç”¨å½“å‰ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„å€¼ã€‚ ## å…¨å±€é…ç½® æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ä¸€äº›å¸¸ç”¨é…ç½®ä¿å­˜åˆ°å…¨å±€é…ç½®ä¸­ï¼Œæ¥ç®€åŒ–é¢‘ç¹åœ°è¾“å…¥ï¼š ä¾‹å¦‚: ```bash $ xmake g ndk ~/files/android ndk r10e/ ``` ç°åœ¨ï¼Œæˆ‘ä»¬é‡æ–°é…ç½®å’Œç¼–è¯‘ `android` ç¨‹åºï¼š ```bash $ xmake f p android $ xmake ``` ä»¥åï¼Œå°±ä¸éœ€è¦æ¯æ¬¡é‡å¤é…ç½® ` ndk å‚æ•°äº†ã€‚ > æ¯ä¸ªå‘½ä»¤éƒ½æœ‰å…¶ç®€å†™ï¼Œä¾‹å¦‚: `xmake g` æˆ–è€… `xmake global`ã€‚ ## æ¸…é™¤é…ç½® æœ‰æ—¶å€™ï¼Œé…ç½®å‡ºäº†é—®é¢˜ç¼–è¯‘ä¸è¿‡ï¼Œæˆ–è€…éœ€è¦é‡æ–°æ£€æµ‹å„ç§ä¾èµ–åº“å’Œæ¥å£ï¼Œå¯ä»¥åŠ ä¸Š ` c` å‚æ•°ï¼Œæ¸…é™¤ç¼“å­˜çš„é…ç½®ï¼Œå¼ºåˆ¶é‡æ–°æ£€æµ‹å’Œé…ç½®ï¼š ```bash $ xmake f c $ xmake ``` æˆ–è€…ï¼š ```bash $ xmake f p iphoneos c $ xmake ``` ## å¯¼å…¥å¯¼å‡ºé…ç½® æˆ‘ä»¬è¿˜å¯ä»¥å¯¼å…¥å¯¼å‡ºå·²ç»é…ç½®å¥½çš„é…ç½®é›†ï¼Œæ–¹ä¾¿é…ç½®çš„å¿«é€Ÿè¿ç§»ã€‚ ### å¯¼å‡ºé…ç½® ```bash $ xmake f export /tmp/config.txt $ xmake f m debug xxx y export /tmp/config.txt ``` ### å¯¼å…¥é…ç½® ```bash $ xmake f import /tmp/config.txt $ xmake f m debug xxx y import /tmp/config.txt ``` ### å¯¼å‡ºé…ç½®ï¼ˆå¸¦èœå•ï¼‰ ```bash $ xmake f menu export /tmp/config.txt $ xmake f menu m debug xxx y export /tmp/config.txt ``` ### å¯¼å…¥é…ç½®ï¼ˆå¸¦èœå•ï¼‰ ```bash $ xmake f menu import /tmp/config.txt $ xmake f menu m debug xxx y import /tmp/config.txt ```"},"/get_started/zh/tutorial/environment-variables.html":{"title":"","content":" class: heading_no_counter # ç¯å¢ƒå˜é‡ æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œè·å–æ‰€æœ‰ xmake ç”¨åˆ°çš„ç¯å¢ƒå˜é‡ï¼Œä»¥åŠå½“å‰è¢«è®¾ç½®çš„å€¼ã€‚ ```bash $ xmake show l envs XMAKE_RAMDIR Set the ramdisk directory. <empty> XMAKE_GLOBALDIR Set the global config directory of xmake. /Users/ruki/.xmake XMAKE_ROOT Allow xmake to run under root. <empty> XMAKE_COLORTERM Set the color terminal environment. <empty> XMAKE_PKG_INSTALLDIR Set the install directory of packages. <empty> XMAKE_TMPDIR Set the temporary directory. /var/folders/vn/ppcrrcm911v8b4510klg9xw80000gn/T/.xmake501/211104 XMAKE_PKG_CACHEDIR Set the cache directory of packages. <empty> XMAKE_PROGRAM_DIR Set the program scripts directory of xmake. /Users/ruki/.local/share/xmake XMAKE_PROFILE Start profiler, e.g. perf, trace. <empty> XMAKE_RCFILES Set the runtime configuration files. XMAKE_CONFIGDIR Set the local config directory of project. /Users/ruki/projects/personal/xmake docs/.xmake/macosx/x86_64 XMAKE_LOGFILE Set the log output file path. <empty> ``` ## XMAKE_RAMDIR è®¾ç½® ramdisk ç›®å½•è·¯å¾„ ramdisk ç›®å½•æ˜¯å†…å­˜æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ä½ç½®ï¼Œé€šå¸¸ `os.tmpdir()` æ¥å£ä¼šç”¨åˆ°ï¼Œxmake å†…éƒ¨ä½¿ç”¨çš„ä¸´æ—¶æ–‡ä»¶ï¼Œå¦‚æœç”¨æˆ·è®¾ç½® ramdisk è·¯å¾„ï¼Œåˆ™ä¼šä¼˜å…ˆå­˜å‚¨åœ¨è¿™ä¸ªä¸Šé¢ï¼Œæå‡æ•´ä½“ç¼–è¯‘é€Ÿåº¦ã€‚ ## XMAKE_TMPDIR è®¾ç½®ç”¨æˆ·çš„ä¸´æ—¶ç›®å½• é»˜è®¤ xmake ä¼šä½¿ç”¨ `/tmp/.xmake`ï¼Œå½“ç„¶ç”¨æˆ·å¯ä»¥é€šè¿‡è¿™ä¸ªå˜é‡å»ä¿®æ”¹é»˜è®¤è·¯å¾„ã€‚ ## XMAKE_CONFIGDIR è®¾ç½®æœ¬åœ°å·¥ç¨‹é…ç½®ç›®å½• æ¯ä¸ªé¡¹ç›®çš„æœ¬åœ°ç¼–è¯‘é…ç½®ï¼Œé»˜è®¤ä¼šå­˜å‚¨åœ¨å½“å‰é¡¹ç›®æ ¹ç›®å½•çš„ `.xmake` è·¯å¾„ä¸‹ï¼Œç„¶åæ ¹æ®ä¸åŒçš„å¹³å°ï¼Œæ¶æ„åŒºåˆ†ï¼Œä¾‹å¦‚ï¼š ```bash .xmake/macosx/x86_64 ``` æˆ‘ä»¬å¦‚æœä¸æƒ³å­˜å‚¨åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œä¹Ÿå¯ä»¥è‡ªå·±è®¾ç½®åˆ°å…¶ä»–è·¯å¾„ï¼Œæ¯”å¦‚ build ç›®å½•ä¸‹ç­‰ç­‰ã€‚ ## XMAKE_GLOBALDIR è®¾ç½®å…¨å±€é…ç½®æ–‡ä»¶æ ¹ç›®å½• ä¹Ÿå°±æ˜¯ `xmake g/global` å…¨å±€é…ç½®çš„å­˜å‚¨ç›®å½•ï¼Œè¿˜æœ‰å®‰è£…åŒ…ï¼Œç¼“å­˜ç­‰å…¶ä»–å…¨å±€æ–‡ä»¶ï¼Œé»˜è®¤éƒ½ä¼šå­˜å‚¨åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚ é»˜è®¤è·¯å¾„ä¸ºï¼š`~/.xmake`ã€‚ ## XMAKE_ROOT å…è®¸ç”¨æˆ·åœ¨ root æ¨¡å¼ä¸‹è¿è¡Œ é€šå¸¸ xmake æ˜¯é»˜è®¤ç¦æ­¢åœ¨ root ä¸‹è¿è¡Œï¼Œè¿™éå¸¸ä¸å®‰å…¨ã€‚ä½†æ˜¯å¦‚æœç”¨æˆ·éè¦åœ¨ root ä¸‹è¿è¡Œï¼Œä¹Ÿå¯ä»¥è®¾ç½®è¿™ä¸ªå˜é‡ï¼Œå¼ºåˆ¶å¼€å¯ã€‚ ```bash export XMAKE_ROOT y ``` ## XMAKE_COLORTERM è®¾ç½® Terminal çš„è‰²å½©è¾“å‡º ç›®å‰å¯ä»¥è®¾ç½®è¿™å‡ ä¸ªå€¼ï¼š å€¼ æè¿° nocolor ç¦ç”¨å½©è‰²è¾“å‡º color8 8 è‰²è¾“å‡ºæ”¯æŒ color256 256 è‰²è¾“å‡ºæ”¯æŒ truecolor çœŸå½©è‰²è¾“å‡ºæ”¯æŒ é€šå¸¸ï¼Œç”¨æˆ·ä¸éœ€è¦è®¾ç½®å®ƒä»¬ï¼Œxmake ä¼šè‡ªåŠ¨æ¢æµ‹ç”¨æˆ·ç»ˆç«¯æ”¯æŒçš„è‰²å½©èŒƒå›´ï¼Œå¦‚æœç”¨æˆ·ä¸æƒ³è¾“å‡ºè‰²å½©ï¼Œå¯ä»¥è®¾ç½® nocolor æ¥å…¨å±€ç¦ç”¨ã€‚ æˆ–è€…ç”¨ `xmake g theme plain` ä¹Ÿå¯ä»¥å…¨å±€ç¦ç”¨ã€‚ ## XMAKE_PKG_INSTALLDIR è®¾ç½®ä¾èµ–åŒ…çš„å®‰è£…æ ¹ç›®å½• xmake çš„è¿œç¨‹åŒ…å®‰è£…çš„å…¨å±€ç›®å½•é»˜è®¤æ˜¯ `~/.xmake/packages`ï¼Œä½†æ˜¯ç”¨æˆ·ä¹Ÿå¯ä»¥è®¾ç½®è¿™ä¸ªå˜é‡ï¼Œå»å•ç‹¬ä¿®æ”¹å®ƒã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `xmake g pkg_installdir /xxx` å»è®¾ç½®å®ƒï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ ## XMAKE_PKG_CACHEDIR è®¾ç½®ä¾èµ–åŒ…çš„ç¼“å­˜ç›®å½• é»˜è®¤è·¯å¾„åœ¨ `~/.xmake/cache` ç›®å½•ï¼Œå­˜å‚¨åŒ…å®‰è£…è¿‡ç¨‹ä¸­çš„å„ç§ç¼“å­˜æ–‡ä»¶ï¼Œæ¯”è¾ƒå å­˜å‚¨ç©ºé—´ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥å•ç‹¬è®¾ç½®å®ƒã€‚ å½“ç„¶ï¼Œxmake åœ¨æ¯ä¸ªæœˆéƒ½ä¼šè‡ªåŠ¨æ¸…ç†ä¸Šä¸ªæœˆçš„æ‰€æœ‰ç¼“å­˜æ–‡ä»¶ã€‚ ## XMAKE_PROGRAM_DIR è®¾ç½® xmake çš„è„šæœ¬ç›®å½• xmake çš„æ‰€æœ‰ lua è„šæœ¬éšå®‰è£…ç¨‹åºä¸€èµ·å®‰è£…ï¼Œé»˜è®¤éƒ½åœ¨å®‰è£…ç›®å½•ä¸‹ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦åˆ‡åˆ°è‡ªå·±ä¸‹è½½çš„è„šæœ¬ç›®å½•ä¸‹ï¼Œæ–¹ä¾¿æœ¬åœ°ä¿®æ”¹è°ƒè¯•ï¼Œå¯ä»¥è®¾ç½®æ­¤å˜é‡ã€‚ å¦‚æœè¦æŸ¥çœ‹å½“å‰ xmake åœ¨ä½¿ç”¨çš„è„šæœ¬ç›®å½•ï¼Œå¯ä»¥æ‰§è¡Œï¼š ```bash $ xmake l os.programdir /Users/ruki/.local/share/xmake ``` ## XMAKE_PROFILE å¼€å¯æ€§èƒ½åˆ†æ è¿™ä»…ä»…å¯¹ xmake çš„å¼€å‘è€…å¼€æ”¾ï¼Œç”¨äºåˆ†æ xmake è¿è¡Œè¿‡ç¨‹ä¸­çš„è€—æ—¶æƒ…å†µï¼Œè¿½è¸ªè°ƒç”¨è¿‡ç¨‹ã€‚ ### åˆ†æå‡½æ•°è°ƒç”¨è€—æ—¶ ```bash $ XMAKE_PROFILE perf:call xmake [ 25%]: cache compiling.release src/main.cpp [ 50%]: linking.release test [100%]: build ok! 0.238, 97.93%, 1, runloop : @programdir/core/base/scheduler.lua: 805 0.180, 74.04%, 25, _resume : [C]: 1 0.015, 6.34%, 50, _co_groups_resume : @programdir/core/base/scheduler.lua: 299 0.011, 4.37%, 48, wait : @programdir/core/base/poller.lua: 111 0.004, 1.70%, 62, status : @programdir/core/base/scheduler.lua: 71 0.004, 1.53%, 38, is_dead : @programdir/core/base/scheduler.lua: 76 0.003, 1.44%, 50, next : @programdir/core/base/timer.lua: 74 0.003, 1.33%, 48, delay : @programdir/core/base/timer.lua: 60 0.002, 1.02%, 24, is_suspended : @programdir/core/base/scheduler.lua: 86 ``` ### åˆ†æè¿›ç¨‹è€—æ—¶ å¯ä»¥ç”¨äºåˆ†ææ¯ä¸ªæ–‡ä»¶çš„ç¼–è¯‘è€—æ—¶ï¼Œä»¥åŠä¸€äº›è¿è¡Œç“¶é¢ˆã€‚ ```bash $ XMAKE_PROFILE perf:process xmake r [ 7%]: compiling.release src/header.h [ 23%]: compiling.release src/test.cpp [ 30%]: compiling.release src/test8.cpp [ 38%]: compiling.release src/test4.cpp [ 46%]: compiling.release src/test5.cpp [ 53%]: compiling.release src/test7.cpp [ 61%]: compiling.release src/test6.cpp [ 69%]: compiling.release src/test2.cpp [ 76%]: compiling.release src/main.cpp [ 84%]: compiling.release test3.cpp [ 84%]: compiling.release src/test.c [ 92%]: linking.release main [100%]: build ok, spent 2.754s 1411.000, 22.19%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_37317EEDB62F4F3088AF6A2E2A649460 fdiagnostics color always x c++ header o build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch src/header.h 508.000, 7.99%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_1ABAE1FAD68D45008DC76A3A00697820 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/main.cpp.o src/main.cpp 473.000, 7.44%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_1C0BE5280C6F4E208F919577A48AAA40 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/test3.cpp.o test3.cpp 451.000, 7.09%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_877D3D9B6BBA4D308BFB5E4EBD751340 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test6.cpp.o src/test6.cpp 404.000, 6.35%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_C9968E2873B648208A8C3F2BA7573640 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test7.cpp.o src/test7.cpp 402.000, 6.32%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_7F6DFA37FF494D208EADF9737484EC40 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test2.cpp.o src/test2.cpp 383.000, 6.02%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_63C9E23AE7E047308F762C7C02A56B50 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test4.cpp.o src/test4.cpp 374.000, 5.88%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_C3A0EF96A7C14D00879BFAEFD26E9D20 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test8.cpp.o src/test8.cpp 368.000, 5.79%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_BADB46AF75CB4610857EF5083BD54D30 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test.cpp.o src/test.cpp 363.000, 5.71%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden fvisibility inlines hidden O3 std c++11 include src/header.h include pch build/.objs/main/macosx/x86_64/release/src/cxx/header.h.pch DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_0247BDB87DD14500816471184D4E8140 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test5.cpp.o src/test5.cpp 156.000, 2.45%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang fPIC Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk S o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F0FF8220B33B46208D39A98937D55E50 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.c 133.000, 2.09%, 3, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang version 107.000, 1.68%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang O3 Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk S o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_C8A96266E0034C20898C147FC52F3A40 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.c 105.000, 1.65%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang fdiagnostics color always Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk S o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_48A2FA7BE7AB44008B60558E412A9D30 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.c 105.000, 1.65%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang++ fPIC target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk lz target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk lz o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F510FB15C9A647108111A7010EFED240 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.cpp 91.000, 1.43%, 3, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang++ version 74.000, 1.16%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang c Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk fvisibility hidden O3 DNDEBUG MMD MF /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_BF6B4B6DACB843008E822CEFDC711230 fdiagnostics color always o build/.objs/main/macosx/x86_64/release/src/test.c.o src/test.c 73.000, 1.15%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang++ o build/macosx/x86_64/release/main build/.objs/main/macosx/x86_64/release/src/test.cpp.o build/.objs/main/macosx/x86_64/release/src/test8.cpp.o build/.objs/main/macosx/x86_64/release/src/test4.cpp.o build/.objs/main/macosx/x86_64/release/src/test5.cpp.o build/.objs/main/macosx/x86_64/release/src/test7.cpp.o build/.objs/main/macosx/x86_64/release/src/test6.cpp.o build/.objs/main/macosx/x86_64/release/src/test2.cpp.o build/.objs/main/macosx/x86_64/release/src/main.cpp.o build/.objs/main/macosx/x86_64/release/test3.cpp.o build/.objs/main/macosx/x86_64/release/src/test.c.o target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk lz Wl, x Wl, dead_strip 70.000, 1.10%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang fPIC Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk S o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_6D0B6327841A47208939EEF194F38B50 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.cpp 68.000, 1.07%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang O3 Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk S o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_8AB279F8450D4D108E92951CC9C1C650 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.cpp 65.000, 1.02%, 1, /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang fdiagnostics color always Qunused arguments target x86_64 apple macos15.1 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX15.1.sdk S o /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_D25F0DB04D6D430084C098F1E1F76C00 /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/241220/_F3443E45635A466AA3BEAE9DE99B4339.cpp ``` ### è¿½è¸ª xmake çš„è¿è¡Œè¿‡ç¨‹ ```bash $ XMAKE_PROFILE trace xmake func : @programdir/core/base/scheduler.lua: 457 is_suspended : @programdir/core/base/scheduler.lua: 86 status : @programdir/core/base/scheduler.lua: 71 thread : @programdir/core/base/scheduler.lua: 66 thread : @programdir/core/base/scheduler.lua: 66 length : @programdir/core/base/heap.lua: 120 ``` ### åˆ†æè¿è¡Œå¡æ­»é—®é¢˜ å¯ä»¥ç”¨äºè·å– xmake è¿è¡Œå¡æ­»æ—¶çš„æ ˆã€‚å¯ç”¨æ­¤ç‰¹æ€§åï¼Œé€šè¿‡ Ctrl+C ä¸­æ–­åå°±èƒ½è·å–æ ˆã€‚ ```bash $ XMAKE_PROFILE stuck xmake l test.lua <Ctrl+C> stack traceback: [C]: in function 'base/io.file_read' @programdir/core/base/io.lua:177: in method '_read' @programdir/core/sandbox/modules/io.lua:90: in function <@programdir/core/sandbox/module s/io.lua:89> (...tail calls...) /Users/ruki/share/test.lua:2: in function </Users/ruki/share/test.lua:1> (...tail calls...) @programdir/plugins/lua/main.lua:123: in function <@programdir/plugins/lua/main.lua:79> (...tail calls...) [C]: in function 'xpcall' @programdir/core/base/utils.lua:280: in function 'sandbox/modules/utils.trycall' (...tail calls...) @programdir/core/base/task.lua:519: in function 'base/task.run' @programdir/core/main.lua:278: in upvalue 'cotask' @programdir/core/base/scheduler.lua:371: in function <@programdir/core/base/scheduler.lu a:368> ``` ## XMAKE_RCFILES è®¾ç½®å…¨å±€é…ç½®æ–‡ä»¶ æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€äº› xmakerc.lua å…¨å±€é…ç½®æ–‡ä»¶ï¼Œåœ¨ç”¨æˆ·ç¼–è¯‘é¡¹ç›®çš„æ—¶å€™ï¼Œå…¨å±€å¼•å…¥å®ƒä»¬ï¼Œæ¯”å¦‚å…¨å±€å¼•å…¥ä¸€äº›ç”¨æˆ·è‡ªå®šä¹‰çš„å¸®åŠ©è„šæœ¬ï¼Œå·¥å…·é“¾ä»€ä¹ˆçš„ã€‚ ```bash $ export XMAKE_RCFILES xmakerc.lua $ xmake ``` å¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤è·¯å¾„ä¸ºï¼š`~/.xmake/xmakerc.lua`ã€‚ ## XMAKE_LOGFILE è®¾ç½®æ—¥å¿—æ–‡ä»¶è·¯å¾„ é»˜è®¤ xmake ä¼šå›æ˜¾è¾“å‡ºåˆ°ç»ˆç«¯ï¼Œæˆ‘ä»¬åœ¨å¯ä»¥é€šè¿‡è®¾ç½®è¿™ä¸ªè·¯å¾„ï¼Œå¼€å¯æ—¥å¿—è‡ªåŠ¨å­˜å‚¨åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œä½†å®ƒä¸ä¼šå½±å“ç»ˆç«¯çš„æ­£å¸¸å›æ˜¾è¾“å‡ºã€‚ ## XMAKE_MAIN_REPO è®¾ç½®å®˜æ–¹åŒ…ä¸»ä»“åº“åœ°å€ xmake é»˜è®¤å†…ç½®äº†ä¸‰ä¸ªä¸»ä»“åº“åœ°å€ï¼Œå®ƒä»¬æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œxmake ä¼šæ ¹æ®å½“å‰ç½‘ç»œçŠ¶æ€é€‰æ‹©æœ€ä¼˜çš„åœ°å€æ¥ä½¿ç”¨ã€‚ ``` https://github.com/xmake io/xmake repo.git https://gitlab.com/tboox/xmake repo.git https://gitee.com/tboox/xmake repo.git ``` ä½†å¦‚æœ xmake é€‰æ‹©é”™è¯¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»“åº“ä¸‹è½½å¤±è´¥ï¼Œè€Œé€šè¿‡è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±è®¾ç½®å›ºå®šä½¿ç”¨æŒ‡å®šçš„ä»“åº“åœ°å€ï¼Œä¸å†è¿›è¡Œè‡ªåŠ¨é€‰æ‹©ã€‚ ```bash $ export XMAKE_MAIN_REPO https://github.com/xmake io/xmake repo.git ``` ## XMAKE_BINARY_REPO è®¾ç½®å®˜æ–¹åŒ…é¢„ç¼–è¯‘ä»“åº“åœ°å€ ç±»ä¼¼ `XMAKE_MAIN_REPO`ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œè¿™ä¸ªç”¨äºåˆ‡æ¢é¢„ç¼–è¯‘ä»“åº“çš„åœ°å€ã€‚ ```bash $ export XMAKE_BINARY_REPO https://github.com/xmake mirror/build artifacts.git ``` ## XMAKE_THEME è®¾ç½®ä¸»é¢˜ é€šå¸¸æˆ‘ä»¬å¯ä»¥é€šè¿‡ `xmake g theme plain` æ¥è®¾ç½®é¢œè‰²ä¸»é¢˜ï¼Œä½†æ˜¯å®ƒæ˜¯å…¨å±€çš„ï¼Œå¦‚æœæƒ³å•ç‹¬å¯¹å½“å‰ç»ˆç«¯ä¼šè¯è®¾ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç¯å¢ƒå˜é‡æ¥è®¾ç½®ã€‚ ```bash $ export XMAKE_THEME plain ``` ## XMAKE_STATS å¼€å¯æˆ–ç¦ç”¨ç”¨æˆ·é‡ç»Ÿè®¡ ç”±äºç›®å‰ xmake è¿˜åœ¨å‘å±•åˆæœŸï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å¤§æ¦‚çš„ç”¨æˆ·é‡å¢é•¿æƒ…å†µï¼Œä»¥ä¾¿äºæä¾›æˆ‘ä»¬æŒç»­æ›´æ–° xmake çš„åŠ¨åŠ›ã€‚ å› æ­¤ xmake é»˜è®¤æ¯å¤©çš„ç¬¬ä¸€æ¬¡é¡¹ç›®æ„å»ºï¼Œä¼šåœ¨åå°è¿›ç¨‹è‡ªåŠ¨ git clone ä¸€ä¸ªç©ºä»“åº“ï¼š<https://github.com/xmake io/xmake stats> ç„¶åå€Ÿç”¨ github è‡ªèº«æä¾›çš„ Traffic ç»Ÿè®¡å›¾è¡¨æ¥è·å–å¤§æ¦‚çš„ç”¨æˆ·é‡ã€‚ å¯¹äºæ¯ä¸ªé¡¹ç›®ï¼Œæ¯å¤©åªä¼šç»Ÿè®¡ä¸€æ¬¡ï¼Œå¹¶ä¸”ä¸ä¼šæ³„éœ²ä»»ä½•ç”¨æˆ·éšç§ï¼Œå› ä¸ºä»…ä»…åªæ˜¯å¤šäº†ä¸€æ¬¡é¢å¤–çš„ git clone æ“ä½œï¼Œå¦å¤–æˆ‘ä»¬ clone çš„æ˜¯ä¸€ä¸ªç©ºä»“åº“ï¼Œä¸ä¼šè€—è´¹ç”¨æˆ·å¤šå°‘æµé‡ã€‚ å½“ç„¶ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªç”¨æˆ·éƒ½å¸Œæœ›è¿™ä¹ˆåšï¼Œç”¨æˆ·å®Œå…¨æœ‰æƒåˆ©å»ç¦ç”¨è¿™ä¸ªè¡Œä¸ºï¼Œæˆ‘ä»¬åªéœ€è¦è®¾ç½®ï¼š ```bash export XMAKE_STATS n ``` å°±å¯ä»¥å®Œå…¨ç¦ç”¨å®ƒï¼Œå¦å¤–æˆ‘ä»¬ä¹Ÿä¼šåœ¨ ci ä¸Šè‡ªåŠ¨ç¦ç”¨è¿™ä¸ªè¡Œä¸ºã€‚ ä»€ä¹ˆæ—¶å€™ç§»é™¤å®ƒï¼Ÿ è¿™ä¸ªè¡Œä¸ºå¹¶ä¸ä¼šæ°¸ä¹…å­˜åœ¨ï¼Œç­‰åˆ° xmake æœ‰äº†è¶³å¤Ÿå¤šçš„ç”¨æˆ·é‡ï¼Œæˆ–è€…æœ‰äº†å…¶ä»–æ›´å¥½çš„ç»Ÿè®¡æ–¹å¼ï¼Œæˆ‘ä»¬ä¼šè€ƒè™‘ç§»é™¤ç›¸å…³ç»Ÿè®¡ä»£ç ã€‚ å½“ç„¶ï¼Œå¦‚æœæœ‰éå¸¸å¤šçš„ç”¨æˆ·åé¦ˆä¸æ„¿æ„æ¥å—å®ƒï¼Œæˆ‘ä»¬ä¹Ÿä¼šè€ƒè™‘ç§»é™¤å®ƒã€‚ å…³äºè¿™ä¸ªçš„ç›¸å…³ issues è§ï¼š[#1795](https://github.com/xmake io/xmake/issues/1795)"},"/get_started/zh/features/autogen.html":{"title":"","content":" class: heading_no_counter # è‡ªåŠ¨æ‰«ææºç ç”Ÿæˆå·¥ç¨‹ å¯¹äºä¸€ä»½å·¥ç¨‹æºç ï¼Œå¯ä»¥ä¸ç”¨ç¼–å†™ makefileï¼Œä¹Ÿä¸ç”¨ç¼–å†™å„ç§ make ç›¸å…³çš„å·¥ç¨‹æè¿°æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼šxmake.luaï¼Œmakefile.am, cmakelist.txt ç­‰ï¼‰ xmake å°±å¯ä»¥ç›´æ¥ç¼–è¯‘ä»–ä»¬ï¼Œè¿™æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Œç®€å•æ¥è¯´ä¸‹å®ç°åŸç†ï¼š 1. é¦–å…ˆæ‰«æå½“å‰ç›®å½•ä¸‹ï¼Œxmake å¯ä»¥æ”¯æŒçš„æ‰€æœ‰æºä»£ç æ–‡ä»¶ 2. åˆ†æä»£ç ï¼Œæ£€æµ‹å“ªäº›ä»£ç æ‹¥æœ‰ main å…¥å£å‡½æ•° 3. æ‰€æœ‰æ²¡æœ‰ main å…¥å£çš„ä»£ç ç¼–è¯‘æˆé™æ€åº“ 4. å¸¦æœ‰ main å…¥å£çš„ä»£ç ï¼Œç¼–è¯‘æˆå¯æ‰§è¡Œç¨‹åºï¼ŒåŒæ—¶é“¾æ¥å…¶ä»–é™æ€åº“ç¨‹åº è¿™ç§ä»£ç æ‰«æå’Œæ™ºèƒ½ç¼–è¯‘ï¼Œéå¸¸ç®€å•ï¼Œç›®å‰ xmake è¿˜ä¸æ”¯æŒå¤šçº§ç›®å½•æ‰«æï¼Œåªå¯¹å•çº§ç›®å½•çš„ä»£ç è¿›è¡Œæ‰«æç¼–è¯‘ã€‚ ## ä½¿ç”¨åœºæ™¯ 1. ä¸´æ—¶å¿«é€Ÿç¼–è¯‘å’Œè¿è¡Œä¸€äº›é›¶æ•£çš„æµ‹è¯•ä»£ç  2. å°è¯•å¯¹å…¶ä»–å¼€æºåº“åšç§»æ¤ç¼–è¯‘ 3. å¿«é€ŸåŸºäºç°æœ‰ä»£ç åˆ›å»ºæ–° xmake å·¥ç¨‹ ## å¦‚ä½•ä½¿ç”¨ ç›´æ¥åœ¨å¸¦æœ‰æºç çš„ç›®å½•ï¼ˆæ²¡æœ‰ xmake.luaï¼‰ä¸‹æ‰§è¡Œ xmakeï¼Œç„¶åæ ¹æ®æç¤ºæ“ä½œï¼š ```bash $ xmake note: xmake.lua not found, try generating it (pass y or confirm y/n/d to skip confirm)? please input: n (y/n) y ``` å¦å¤–, å½“å­˜åœ¨å…¶ä»–æ„å»ºç³»ç»Ÿæ ‡è¯†æ€§æ–‡ä»¶çš„æ—¶å€™ (æ¯”å¦‚ CMakeLists.txt), ä¸ä¼šè§¦å‘è‡ªåŠ¨ç”Ÿæˆ xmake.lua çš„æµç¨‹, è€Œæ˜¯é¦–å…ˆè§¦å‘ [è‡ªåŠ¨æ¢æµ‹æ„å»ºç³»ç»Ÿå¹¶ç¼–è¯‘](# è‡ªåŠ¨æ¢æµ‹æ„å»ºç³»ç»Ÿå¹¶ç¼–è¯‘), å¦‚æœè¦å¼ºåˆ¶è§¦å‘è‡ªåŠ¨æ‰«æç”Ÿæˆ xmake.lua çš„æµç¨‹, å¯è¿è¡Œ: ```bash $ xmake f y ``` ## å¼€æºä»£ç çš„ç§»æ¤å’Œç¼–è¯‘ è™½ç„¶è¿™ç§æ–¹å¼ï¼Œå¹¶ä¸æ˜¯éå¸¸æ™ºèƒ½ï¼Œé™åˆ¶ä¹Ÿä¸å°‘ï¼Œä½†æ˜¯å¯¹äºæƒ³ä¸´æ—¶å†™äº›ä»£ç è¿›è¡Œç¼–è¯‘è¿è¡Œï¼Œæˆ–è€…ä¸´æ—¶æƒ³äº¤å‰ç¼–è¯‘ä¸€äº›ç®€å•çš„å¼€æºåº“ä»£ç  è¿™ç§æ–¹å¼å·²ç»è¶³å¤Ÿä½¿ç”¨äº†ï¼Œä¸‹é¢çœ‹ä¸‹ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼š æˆ‘ä¸‹è½½äº†ä¸€ä»½ zlib 1.2.10 çš„æºç ï¼Œæƒ³è¦ç¼–è¯‘å®ƒï¼Œåªéœ€è¦è¿›å…¥ zlib çš„æºç ç›®å½•æ‰§è¡Œï¼š ```bash $ cd zlib 1.2.10 $ xmake note: xmake.lua not found, try generating it (pass y or confirm y/n/d to skip confirm)? please input: n (y/n) y ``` å°±è¡Œäº†ï¼Œè¾“å…¥ y ç¡®è®¤åï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š ``` target(zlib 1.2): static [+]: ./adler32.c [+]: ./compress.c [+]: ./crc32.c [+]: ./deflate.c [+]: ./gzclose.c [+]: ./gzlib.c [+]: ./gzread.c [+]: ./gzwrite.c [+]: ./infback.c [+]: ./inffast.c [+]: ./inflate.c [+]: ./inftrees.c [+]: ./trees.c [+]: ./uncompr.c [+]: ./zutil.c xmake.lua generated, scan ok!ğŸ‘Œ checking for the architecture ... x86_64 checking for the Xcode SDK version for macosx ... 10.12 checking for the target minimal version ... 10.12 checking for the c compiler (cc) ... xcrun sdk macosx clang checking for the c++ compiler (cxx) ... xcrun sdk macosx clang checking for the objc compiler (mm) ... xcrun sdk macosx clang checking for the objc++ compiler (mxx) ... xcrun sdk macosx clang++ checking for the swift compiler (sc) ... xcrun sdk macosx swiftc checking for the assember (as) ... xcrun sdk macosx clang checking for the linker (ld) ... xcrun sdk macosx clang++ checking for the static library archiver (ar) ... xcrun sdk macosx ar checking for the static library extractor (ex) ... xcrun sdk macosx ar checking for the shared library linker (sh) ... xcrun sdk macosx clang++ checking for the debugger (dd) ... xcrun sdk macosx lldb checking for the golang compiler (go) ... go configure { ex \"xcrun sdk macosx ar\" , sh \"xcrun sdk macosx clang++\" , host \"macosx\" , ar \"xcrun sdk macosx ar\" , buildir \"build\" , as \"xcrun sdk macosx clang\" , plat \"macosx\" , xcode_dir \"/Applications/Xcode.app\" , arch \"x86_64\" , mxx \"xcrun sdk macosx clang++\" , go \"go\" , target_minver \"10.12\" , ccache \"ccache\" , mode \"release\" , clean true , cxx \"xcrun sdk macosx clang\" , cc \"xcrun sdk macosx clang\" , dd \"xcrun sdk macosx lldb\" , kind \"static\" , ld \"xcrun sdk macosx clang++\" , xcode_sdkver \"10.12\" , sc \"xcrun sdk macosx swiftc\" , mm \"xcrun sdk macosx clang\" } configure ok! clean ok! [00%]: cache compiling.release ./adler32.c [06%]: cache compiling.release ./compress.c [13%]: cache compiling.release ./crc32.c [20%]: cache compiling.release ./deflate.c [26%]: cache compiling.release ./gzclose.c [33%]: cache compiling.release ./gzlib.c [40%]: cache compiling.release ./gzread.c [46%]: cache compiling.release ./gzwrite.c [53%]: cache compiling.release ./infback.c [60%]: cache compiling.release ./inffast.c [66%]: cache compiling.release ./inflate.c [73%]: cache compiling.release ./inftrees.c [80%]: cache compiling.release ./trees.c [86%]: cache compiling.release ./uncompr.c [93%]: cache compiling.release ./zutil.c [100%]: archiving.release libzlib 1.2.a build ok!ğŸ‘Œ ``` é€šè¿‡è¾“å‡ºç»“æœï¼Œå¯ä»¥çœ‹åˆ°ï¼Œxmake ä¼šå»æ£€æµ‹æ‰«æå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰. c ä»£ç ï¼Œå‘ç°æ²¡æœ‰ main å…¥å£ï¼Œåº”è¯¥æ˜¯é™æ€åº“ç¨‹åºï¼Œå› æ­¤æ‰§è¡Œ xmake åï¼Œå°±ç›´æ¥ç¼–è¯‘æˆé™æ€åº“ libzlib 1.2.a äº† è¿ xmake.lua éƒ½æ²¡æœ‰ç¼–å†™ï¼Œå…¶å® xmake åœ¨æ‰«æå®Œæˆåï¼Œä¼šå»è‡ªåŠ¨åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä»½ xmake.luaï¼Œä¸‹æ¬¡ç¼–è¯‘å°±ä¸éœ€è¦é‡æ–°æ‰«ææ£€æµ‹äº†ã€‚ è‡ªåŠ¨ç”Ÿæˆçš„ xmake.lua å†…å®¹å¦‚ä¸‹ï¼š ```lua define target target(\"zlib 1.2\"ï¼Œ function() set kind set_kind(\"static\") add files add_files(\"./adler32.c\") add_files(\"./compress.c\") add_files(\"./crc32.c\") add_files(\"./deflate.c\") add_files(\"./gzclose.c\") add_files(\"./gzlib.c\") add_files(\"./gzread.c\") add_files(\"./gzwrite.c\") add_files(\"./infback.c\") add_files(\"./inffast.c\") add_files(\"./inflate.c\") add_files(\"./inftrees.c\") add_files(\"./trees.c\") add_files(\"./uncompr.c\") add_files(\"./zutil.c\") end) ``` ä¹Ÿè®¸ä½ ä¼šè¯´ï¼Œåƒè¿™ç§å¼€æºåº“ï¼Œç›´æ¥ `configure; make` ä¸å°±å¥½äº†å—ï¼Œä»–ä»¬è‡ªå·±ä¹Ÿæœ‰æä¾› makefile æ¥ç›´æ¥ç¼–è¯‘çš„ï¼Œçš„ç¡®æ˜¯è¿™æ ·ï¼Œæˆ‘è¿™é‡Œåªæ˜¯ä¸¾ä¸ªä¾‹å­è€Œå·²ã€‚ å½“ç„¶ï¼Œå¾ˆå¤šå¼€æºåº“åœ¨äº¤å‰ç¼–è¯‘çš„æ—¶å€™ï¼Œé€šè¿‡è‡ªå¸¦çš„ `configure`ï¼Œå¤„ç†èµ·æ¥è¿˜æ˜¯å¾ˆç¹ççš„ï¼Œç”¨ xmake è¿›è¡Œäº¤å‰ç¼–è¯‘ä¼šæ›´æ–¹ä¾¿äº›ã€‚ã€‚ ## å³æ—¶åœ°ä»£ç ç¼–å†™å’Œç¼–è¯‘è¿è¡Œ xmake çš„è¿™ä¸ªæ‰«æä»£ç ç¼–è¯‘ç‰¹æ€§ï¼Œä¸»è¦çš„ç›®çš„ï¼šè¿˜æ˜¯ä¸ºäº†è®©æˆ‘ä»¬åœ¨ä¸´æ—¶æƒ³å†™äº›æµ‹è¯•ä»£ç çš„æ—¶å€™ï¼Œä¸ç”¨è€ƒè™‘å¤ªå¤šä¸œè¥¿ï¼Œç›´æ¥ä¸Šæ‰‹æ•²ä»£ç ï¼Œç„¶åå¿«é€Ÿæ‰§è¡Œ `xmake run` æ¥è°ƒè¯•éªŒè¯ç»“æœã€‚ ä¾‹å¦‚ï¼š æˆ‘æƒ³å†™äº†ä¸ªç®€å•çš„ main.c çš„æµ‹è¯•ç¨‹åºï¼Œæ‰“å° `hello world!`ï¼Œå¦‚æœè¦å†™ makefile æˆ–è€…ç›´æ¥é€šè¿‡ gcc å‘½ä»¤æ¥ï¼Œå°±å¾ˆç¹çäº†ï¼Œä½ éœ€è¦ï¼š ```bash gcc ./main.c o demo ./demo ``` æœ€å¿«é€Ÿçš„æ–¹å¼ï¼Œä¹Ÿéœ€è¦æ‰§è¡Œä¸¤è¡Œå‘½ä»¤ï¼Œè€Œå¦‚æœç”¨ xmakeï¼Œåªéœ€è¦æ‰§è¡Œï¼š ```bash xmake run ``` å°±è¡Œäº†ï¼Œå®ƒä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»£ç åï¼Œè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ xmake.luaï¼Œè‡ªåŠ¨ç¼–è¯‘ï¼Œè‡ªåŠ¨è¿è¡Œï¼Œç„¶åè¾“å‡ºï¼š ```bash hello world! ``` å¦‚æœä½ æœ‰åå‡ ä¸ªä»£ç æ–‡ä»¶ï¼Œç”¨æ‰‹æ•² gcc çš„æ–¹å¼ï¼Œæˆ–è€…å†™ makefile çš„æ–¹å¼ï¼Œè¿™ä¸ªå·®è·å°±æ›´æ˜æ˜¾äº†ï¼Œç”¨ xmake è¿˜æ˜¯åªéœ€è¦ä¸€è¡Œå‘½ä»¤ï¼š ```bash xmake run ``` ## å¤šè¯­è¨€æ”¯æŒ è¿™ç§ä»£ç æ£€æµ‹å’Œå³æ—¶ç¼–è¯‘ï¼Œæ˜¯æ”¯æŒå¤šè¯­è¨€çš„ï¼Œä¸ä»…æ”¯æŒ c/c++ï¼Œè¿˜æ”¯æŒ objc/swiftã€‚ ä¾‹å¦‚æˆ‘ä¸‹è½½äº†ä¸€ä»½ fmdb çš„ ios å¼€æºæ¡†æ¶ä»£ç ï¼š ``` . â”œâ”€â”€ FMDB.h â”œâ”€â”€ FMDatabase.h â”œâ”€â”€ FMDatabase.m â”œâ”€â”€ FMDatabaseAdditions.h â”œâ”€â”€ FMDatabaseAdditions.m â”œâ”€â”€ FMDatabasePool.h â”œâ”€â”€ FMDatabasePool.m â”œâ”€â”€ FMDatabaseQueue.h â”œâ”€â”€ FMDatabaseQueue.m â”œâ”€â”€ FMResultSet.h â””â”€â”€ FMResultSet.m ``` æƒ³è¦æŠŠå®ƒç¼–è¯‘æˆ ios çš„é™æ€åº“ï¼Œä½†æ˜¯åˆä¸æƒ³å†™ xmake.luaï¼Œæˆ–è€… makefileï¼Œé‚£ä¹ˆåªéœ€è¦ä½¿ç”¨ xmake çš„è¿™ä¸ªæ–°ç‰¹æ€§ï¼Œç›´æ¥æ‰§è¡Œï¼š ```bash $ xmake f p iphoneos; xmake ``` å°±è¡Œäº†ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š ``` xmake.lua not found, scanning files .. target(FMDB): static [+]: ./FMDatabase.m [+]: ./FMDatabaseAdditions.m [+]: ./FMDatabasePool.m [+]: ./FMDatabaseQueue.m [+]: ./FMResultSet.m xmake.lua generated, scan ok!ğŸ‘Œ checking for the architecture ... armv7 checking for the Xcode SDK version for iphoneos ... 10.1 checking for the target minimal version ... 10.1 checking for the c compiler (cc) ... xcrun sdk iphoneos clang checking for the c++ compiler (cxx) ... xcrun sdk iphoneos clang checking for the objc compiler (mm) ... xcrun sdk iphoneos clang checking for the objc++ compiler (mxx) ... xcrun sdk iphoneos clang++ checking for the assember (as) ... gas preprocessor.pl xcrun sdk iphoneos clang checking for the linker (ld) ... xcrun sdk iphoneos clang++ checking for the static library archiver (ar) ... xcrun sdk iphoneos ar checking for the static library extractor (ex) ... xcrun sdk iphoneos ar checking for the shared library linker (sh) ... xcrun sdk iphoneos clang++ checking for the swift compiler (sc) ... xcrun sdk iphoneos swiftc configure { ex \"xcrun sdk iphoneos ar\" , ccache \"ccache\" , host \"macosx\" , ar \"xcrun sdk iphoneos ar\" , buildir \"build\" , as \"/usr/local/share/xmake/tools/utils/gas preprocessor.pl xcrun sdk iphoneos clang\" , arch \"armv7\" , mxx \"xcrun sdk iphoneos clang++\" , cxx \"xcrun sdk iphoneos clang\" , target_minver \"10.1\" , xcode_dir \"/Applications/Xcode.app\" , clean true , sh \"xcrun sdk iphoneos clang++\" , cc \"xcrun sdk iphoneos clang\" , ld \"xcrun sdk iphoneos clang++\" , mode \"release\" , kind \"static\" , plat \"iphoneos\" , xcode_sdkver \"10.1\" , sc \"xcrun sdk iphoneos swiftc\" , mm \"xcrun sdk iphoneos clang\" } configure ok! clean ok! [00%]: cache compiling.release ./FMDatabase.m [20%]: cache compiling.release ./FMDatabaseAdditions.m [40%]: cache compiling.release ./FMDatabasePool.m [60%]: cache compiling.release ./FMDatabaseQueue.m [80%]: cache compiling.release ./FMResultSet.m [100%]: archiving.release libFMDB.a build ok!ğŸ‘Œ ``` ## åŒæ—¶ç¼–è¯‘å¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶ è¾“å‡ºç»“æœçš„å¼€å¤´éƒ¨åˆ†ï¼Œå°±æ˜¯å¯¹ä»£ç çš„åˆ†æç»“æœï¼Œè™½ç„¶ç›®å‰åªæ”¯æŒå•çº§ç›®å½•ç»“æ„çš„ä»£ç æ‰«æï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥åŒæ—¶æ”¯æŒæ£€æµ‹å’Œç¼–è¯‘å¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„ æˆ‘ä»¬ä»¥ libjpeg çš„å¼€æºåº“ä¸ºä¾‹ï¼š æˆ‘ä»¬è¿›å…¥ jpeg 6b ç›®å½•åï¼Œæ‰§è¡Œï¼š ```bash $ xmake ``` è¾“å‡ºå¦‚ä¸‹ï¼š ``` xmake.lua not found, scanning files .. target(jpeg 6b): static [+]: ./cdjpeg.c [+]: ./example.c [+]: ./jcapimin.c [+]: ./jcapistd.c [+]: ./jccoefct.c [+]: ./jccolor.c [+]: ./jcdctmgr.c [+]: ./jchuff.c [+]: ./jcinit.c [+]: ./jcmainct.c [+]: ./jcmarker.c [+]: ./jcmaster.c [+]: ./jcomapi.c [+]: ./jcparam.c [+]: ./jcphuff.c [+]: ./jcprepct.c [+]: ./jcsample.c [+]: ./jctrans.c [+]: ./jdapimin.c [+]: ./jdapistd.c [+]: ./jdatadst.c [+]: ./jdatasrc.c [+]: ./jdcoefct.c [+]: ./jdcolor.c [+]: ./jddctmgr.c [+]: ./jdhuff.c [+]: ./jdinput.c [+]: ./jdmainct.c [+]: ./jdmarker.c [+]: ./jdmaster.c [+]: ./jdmerge.c [+]: ./jdphuff.c [+]: ./jdpostct.c [+]: ./jdsample.c [+]: ./jdtrans.c [+]: ./jerror.c [+]: ./jfdctflt.c [+]: ./jfdctfst.c [+]: ./jfdctint.c [+]: ./jidctflt.c [+]: ./jidctfst.c [+]: ./jidctint.c [+]: ./jidctred.c [+]: ./jmemansi.c [+]: ./jmemmgr.c [+]: ./jmemname.c [+]: ./jmemnobs.c [+]: ./jquant1.c [+]: ./jquant2.c [+]: ./jutils.c [+]: ./rdbmp.c [+]: ./rdcolmap.c [+]: ./rdgif.c [+]: ./rdppm.c [+]: ./rdrle.c [+]: ./rdswitch.c [+]: ./rdtarga.c [+]: ./transupp.c [+]: ./wrbmp.c [+]: ./wrgif.c [+]: ./wrppm.c [+]: ./wrrle.c [+]: ./wrtarga.c target(ansi2knr): binary [+]: ./ansi2knr.c target(cjpeg): binary [+]: ./cjpeg.c target(ckconfig): binary [+]: ./ckconfig.c target(djpeg): binary [+]: ./djpeg.c target(jpegtran): binary [+]: ./jpegtran.c target(rdjpgcom): binary [+]: ./rdjpgcom.c target(wrjpgcom): binary [+]: ./wrjpgcom.c xmake.lua generated, scan ok!ğŸ‘Œ checking for the architecture ... x86_64 checking for the Xcode SDK version for macosx ... 10.12 checking for the target minimal version ... 10.12 checking for the c compiler (cc) ... xcrun sdk macosx clang checking for the c++ compiler (cxx) ... xcrun sdk macosx clang checking for the objc compiler (mm) ... xcrun sdk macosx clang checking for the objc++ compiler (mxx) ... xcrun sdk macosx clang++ checking for the swift compiler (sc) ... xcrun sdk macosx swiftc checking for the assember (as) ... xcrun sdk macosx clang checking for the linker (ld) ... xcrun sdk macosx clang++ checking for the static library archiver (ar) ... xcrun sdk macosx ar checking for the static library extractor (ex) ... xcrun sdk macosx ar checking for the shared library linker (sh) ... xcrun sdk macosx clang++ checking for the debugger (dd) ... xcrun sdk macosx lldb checking for the golang compiler (go) ... go configure { ex \"xcrun sdk macosx ar\" , sh \"xcrun sdk macosx clang++\" , host \"macosx\" , ar \"xcrun sdk macosx ar\" , buildir \"build\" , as \"xcrun sdk macosx clang\" , plat \"macosx\" , xcode_dir \"/Applications/Xcode.app\" , arch \"x86_64\" , mxx \"xcrun sdk macosx clang++\" , go \"go\" , target_minver \"10.12\" , ccache \"ccache\" , mode \"release\" , clean true , cxx \"xcrun sdk macosx clang\" , cc \"xcrun sdk macosx clang\" , dd \"xcrun sdk macosx lldb\" , kind \"static\" , ld \"xcrun sdk macosx clang++\" , xcode_sdkver \"10.12\" , sc \"xcrun sdk macosx swiftc\" , mm \"xcrun sdk macosx clang\" } configure ok! clean ok! [00%]: cache compiling.release ./cdjpeg.c [00%]: cache compiling.release ./example.c [00%]: cache compiling.release ./jcapimin.c [00%]: cache compiling.release ./jcapistd.c [00%]: cache compiling.release ./jccoefct.c [00%]: cache compiling.release ./jccolor.c [01%]: cache compiling.release ./jcdctmgr.c [01%]: cache compiling.release ./jchuff.c [01%]: cache compiling.release ./jcinit.c [01%]: cache compiling.release ./jcmainct.c [01%]: cache compiling.release ./jcmarker.c [02%]: cache compiling.release ./jcmaster.c [02%]: cache compiling.release ./jcomapi.c [02%]: cache compiling.release ./jcparam.c [02%]: cache compiling.release ./jcphuff.c [02%]: cache compiling.release ./jcprepct.c [03%]: cache compiling.release ./jcsample.c [03%]: cache compiling.release ./jctrans.c [03%]: cache compiling.release ./jdapimin.c [03%]: cache compiling.release ./jdapistd.c [03%]: cache compiling.release ./jdatadst.c [04%]: cache compiling.release ./jdatasrc.c [04%]: cache compiling.release ./jdcoefct.c [04%]: cache compiling.release ./jdcolor.c [04%]: cache compiling.release ./jddctmgr.c [04%]: cache compiling.release ./jdhuff.c [05%]: cache compiling.release ./jdinput.c [05%]: cache compiling.release ./jdmainct.c [05%]: cache compiling.release ./jdmarker.c [05%]: cache compiling.release ./jdmaster.c [05%]: cache compiling.release ./jdmerge.c [06%]: cache compiling.release ./jdphuff.c [06%]: cache compiling.release ./jdpostct.c [06%]: cache compiling.release ./jdsample.c [06%]: cache compiling.release ./jdtrans.c [06%]: cache compiling.release ./jerror.c [07%]: cache compiling.release ./jfdctflt.c [07%]: cache compiling.release ./jfdctfst.c [07%]: cache compiling.release ./jfdctint.c [07%]: cache compiling.release ./jidctflt.c [07%]: cache compiling.release ./jidctfst.c [08%]: cache compiling.release ./jidctint.c [08%]: cache compiling.release ./jidctred.c [08%]: cache compiling.release ./jmemansi.c [08%]: cache compiling.release ./jmemmgr.c [08%]: cache compiling.release ./jmemname.c [09%]: cache compiling.release ./jmemnobs.c [09%]: cache compiling.release ./jquant1.c [09%]: cache compiling.release ./jquant2.c [09%]: cache compiling.release ./jutils.c [09%]: cache compiling.release ./rdbmp.c [10%]: cache compiling.release ./rdcolmap.c [10%]: cache compiling.release ./rdgif.c [10%]: cache compiling.release ./rdppm.c [10%]: cache compiling.release ./rdrle.c [10%]: cache compiling.release ./rdswitch.c [11%]: cache compiling.release ./rdtarga.c [11%]: cache compiling.release ./transupp.c [11%]: cache compiling.release ./wrbmp.c [11%]: cache compiling.release ./wrgif.c [11%]: cache compiling.release ./wrppm.c [12%]: cache compiling.release ./wrrle.c [12%]: cache compiling.release ./wrtarga.c [12%]: archiving.release libjpeg 6b.a [12%]: cache compiling.release ./wrjpgcom.c [25%]: linking.release wrjpgcom [25%]: cache compiling.release ./ansi2knr.c [37%]: linking.release ansi2knr [37%]: cache compiling.release ./jpegtran.c [50%]: linking.release jpegtran [50%]: cache compiling.release ./djpeg.c [62%]: linking.release djpeg [62%]: cache compiling.release ./ckconfig.c [75%]: linking.release ckconfig [75%]: cache compiling.release ./rdjpgcom.c [87%]: linking.release rdjpgcom [87%]: cache compiling.release ./cjpeg.c [100%]: linking.release cjpeg build ok!ğŸ‘Œ ``` å¯ä»¥çœ‹åˆ°ï¼Œå¤„ç†é™æ€åº“ï¼Œxmake è¿˜åˆ†æå‡ºäº†å¾ˆå¤šå¯æ‰§è¡Œçš„æµ‹è¯•ç¨‹åºï¼Œå‰©ä¸‹çš„ä»£ç ç»Ÿä¸€ç¼–è¯‘æˆä¸€ä¸ª libjpeg.a çš„é™æ€åº“ï¼Œä¾›å“ªäº›æµ‹è¯•ç¨‹åºé“¾æ¥ä½¿ç”¨ã€‚ã€‚ ``` target(ansi2knr): binary [+]: ./ansi2knr.c target(cjpeg): binary [+]: ./cjpeg.c target(ckconfig): binary [+]: ./ckconfig.c target(djpeg): binary [+]: ./djpeg.c target(jpegtran): binary [+]: ./jpegtran.c target(rdjpgcom): binary [+]: ./rdjpgcom.c target(wrjpgcom): binary [+]: ./wrjpgcom.c ``` ## é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œé™åˆ¶ å½“å‰ xmake çš„è¿™ç§è‡ªåŠ¨åˆ†ææ£€æµ‹è¿˜ä¸æ˜¯éå¸¸æ™ºèƒ½ï¼Œå¯¹äºï¼š 1. éœ€è¦ç‰¹æ®Šçš„ç¼–è¯‘é€‰é¡¹ 2. éœ€è¦ä¾èµ–å…¶ä»–ç›®å½•çš„å¤´æ–‡ä»¶æœç´¢ 3. éœ€è¦åˆ†æ¡ä»¶ç¼–è¯‘ä¸åŒæºæ–‡ä»¶ 4. åŒç›®å½•éœ€è¦ç”Ÿæˆå¤šä¸ªé™æ€åº“ 5. éœ€è¦å¤šçº§ç›®å½•æ”¯æŒçš„æºç åº“ ä»¥ä¸Šè¿™äº›æƒ…å†µï¼Œxmake æš‚æ—¶è¿˜æ²¡å‘è‡ªåŠ¨åŒ–çš„æ™ºèƒ½å¤„ç†ï¼Œå…¶ä¸­é™åˆ¶ 1ï¼Œ2 è¿˜æ˜¯å¯ä»¥è§£å†³çš„ï¼Œé€šè¿‡åŠæ‰‹åŠ¨çš„æ–¹å¼ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake f cxflags \"\" ldflags \"\" includedirs \"\" linkdirs \"\"; xmake ``` åœ¨è‡ªåŠ¨æ£€æµ‹ç¼–è¯‘çš„æ—¶å€™ï¼Œæ‰‹åŠ¨é…ç½®è¿™ä¸ªæºç å·¥ç¨‹éœ€è¦çš„ç‰¹æ®Šç¼–è¯‘é€‰é¡¹ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡ç¼–è¯‘äº† è€Œé™åˆ¶ 3ï¼Œæš‚æ—¶åªèƒ½é€šè¿‡åˆ æºä»£ç æ¥è§£å†³äº†ï¼Œå°±åƒåˆšæ‰ç¼–è¯‘ jpeg çš„ä»£ç ï¼Œå…¶å®å®ƒçš„ç›®å½•ä¸‹é¢åŒæ—¶å­˜åœ¨äº†ï¼š ``` jmemdos.c jmemmac.c jmemansi.c ``` å…¶ä¸­ä¸¤ä¸ªæ˜¯æ²¡æ³•ç¼–è¯‘è¿‡çš„ï¼Œéœ€è¦åˆ æ‰åæ‰è¡Œã€‚"},"/get_started/zh/features/unity-build.html":{"title":"","content":" class: heading_no_counter # Unity ç¼–è¯‘åŠ é€Ÿ æˆ‘ä»¬çŸ¥é“ï¼ŒC++ ä»£ç ç¼–è¯‘é€Ÿåº¦é€šå¸¸å¾ˆæ…¢ï¼Œå› ä¸ºæ¯ä¸ªä»£ç æ–‡ä»¶éƒ½éœ€è¦è§£æå¼•å…¥çš„å¤´æ–‡ä»¶ã€‚ è€Œé€šè¿‡ Unity Buildï¼Œæˆ‘ä»¬é€šè¿‡å°†å¤šä¸ª cpp æ–‡ä»¶ç»„åˆæˆä¸€ä¸ªæ¥åŠ é€Ÿé¡¹ç›®çš„ç¼–è¯‘ï¼Œå…¶ä¸»è¦å¥½å¤„æ˜¯å‡å°‘äº†è§£æå’Œç¼–è¯‘åŒ…å«åœ¨å¤šä¸ªæºæ–‡ä»¶ä¸­çš„å¤´æ–‡ä»¶å†…å®¹çš„é‡å¤å·¥ä½œï¼Œå¤´æ–‡ä»¶çš„å†…å®¹é€šå¸¸å é¢„å¤„ç†åæºæ–‡ä»¶ä¸­çš„å¤§éƒ¨åˆ†ä»£ç ã€‚ Unity æ„å»ºè¿˜é€šè¿‡å‡å°‘ç¼–è¯‘é“¾åˆ›å»ºå’Œå¤„ç†çš„ç›®æ ‡æ–‡ä»¶çš„æ•°é‡æ¥å‡è½»ç”±äºæ‹¥æœ‰å¤§é‡å°æºæ–‡ä»¶è€Œå¯¼è‡´çš„å¼€é”€ï¼Œå¹¶å…è®¸è·¨å½¢æˆç»Ÿä¸€æ„å»ºä»»åŠ¡çš„æ–‡ä»¶è¿›è¡Œè¿‡ç¨‹é—´åˆ†æå’Œä¼˜åŒ–ï¼ˆç±»ä¼¼äºæ•ˆæœé“¾æ¥æ—¶ä¼˜åŒ–ï¼‰ã€‚ å®ƒå¯ä»¥æå¤§æå‡ C/C++ ä»£ç çš„ç¼–è¯‘é€Ÿåº¦ï¼Œé€šå¸¸ä¼šæœ‰ 30% çš„é€Ÿåº¦æå‡ï¼Œä¸è¿‡æ ¹æ®é¡¹ç›®çš„å¤æ‚ç¨‹åº¦ä¸åŒï¼Œå…¶å¸¦æ¥çš„æ•ˆç›Šè¿˜æ˜¯è¦æ ¹æ®è‡ªèº«é¡¹ç›®æƒ…å†µè€Œå®šã€‚ ç›¸å…³ issues è§ [#1019](https://github.com/xmake io/xmake/issues/1019)ã€‚ ## å¦‚ä½•å¯ç”¨ï¼Ÿ æˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªå†…ç½®è§„åˆ™ï¼Œåˆ†åˆ«å¤„ç†å¯¹ C å’Œ C++ ä»£ç çš„ Unity Buildã€‚ ```lua add_rules(\"c.unity_build\") add_rules(\"c++.unity_build\") ``` ## Batch æ¨¡å¼ é»˜è®¤æƒ…å†µä¸‹ï¼Œåªè¦è®¾ç½®ä¸Šè¿°è§„åˆ™ï¼Œå°±ä¼šå¯ç”¨ Batch æ¨¡å¼çš„ Unity Buildï¼Œä¹Ÿå°±æ˜¯ xmake è‡ªåŠ¨æ ¹æ®é¡¹ç›®ä»£ç æ–‡ä»¶ï¼Œè‡ªåŠ¨ç»„ç»‡åˆå¹¶ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_includedirs(\"src\") add_rules(\"c++.unity_build\", {batchsize 2}) add_files(\"src/*.c\", \"src/*.cpp\") end) ``` æˆ‘ä»¬å¯ä»¥é¢å¤–é€šè¿‡è®¾ç½® `{batchsize 2}` å‚æ•°åˆ°è§„åˆ™ï¼Œæ¥æŒ‡å®šæ¯ä¸ªåˆå¹¶ Batch çš„å¤§å°æ•°é‡ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯æ¯ä¸¤ä¸ª C++ æ–‡ä»¶è‡ªåŠ¨åˆå¹¶ç¼–è¯‘ã€‚ ç¼–è¯‘æ•ˆæœå¤§æ¦‚å¦‚ä¸‹ï¼š ```console $ xmake r [ 11%]: cache compiling.release build/.gens/test/unity_build/unity_642A245F.cpp [ 11%]: cache compiling.release build/.gens/test/unity_build/unity_bar.cpp [ 11%]: cache compiling.release build/.gens/test/unity_build/unity_73161A20.cpp [ 11%]: cache compiling.release build/.gens/test/unity_build/unity_F905F036.cpp [ 11%]: cache compiling.release build/.gens/test/unity_build/unity_foo.cpp [ 11%]: cache compiling.release build/.gens/test/unity_build/main.c [ 77%]: linking.release test [100%]: build ok ``` ç”±äºæˆ‘ä»¬ä»…ä»…å¯ç”¨äº† C++ çš„ Unity Buildï¼Œæ‰€ä»¥ C ä»£ç è¿˜æ˜¯æ­£å¸¸æŒ¨ä¸ªç¼–è¯‘ã€‚å¦å¤–åœ¨ Unity Build æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥åšåˆ°å°½å¯èƒ½çš„å¹¶è¡Œç¼–è¯‘åŠ é€Ÿï¼Œäº’ä¸å†²çªã€‚ å¦‚æœæ²¡æœ‰è®¾ç½® `batchsize` å‚æ•°ï¼Œé‚£ä¹ˆé»˜è®¤ä¼šæŠŠæ‰€æœ‰æ–‡ä»¶åˆå¹¶åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­è¿›è¡Œç¼–è¯‘ã€‚ ## Group æ¨¡å¼ å¦‚æœä¸Šé¢çš„ Batch æ¨¡å¼è‡ªåŠ¨åˆå¹¶æ•ˆæœä¸ç†æƒ³ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰åˆ†ç»„ï¼Œæ¥æ‰‹åŠ¨é…ç½®å“ªäº›æ–‡ä»¶åˆå¹¶åˆ°ä¸€èµ·å‚ä¸ç¼–è¯‘ï¼Œè¿™ä½¿å¾—ç”¨æˆ·æ›´åŠ åœ°çµæ´»å¯æ§ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_rules(\"c++.unity_build\", {batchsize 0}) disable batch mode add_files(\"src/*.c\", \"src/*.cpp\") add_files(\"src/foo/*.c\", {unity_group \"foo\"}) add_files(\"src/bar/*.c\", {unity_group \"bar\"}) end) ``` æˆ‘ä»¬ä½¿ç”¨ `{unity_group \"foo\"}` æ¥æŒ‡å®šæ¯ä¸ªåˆ†ç»„çš„åå­—ï¼Œä»¥åŠåŒ…å«äº†å“ªäº›æ–‡ä»¶ï¼Œæ¯ä¸ªåˆ†ç»„çš„æ–‡ä»¶éƒ½ä¼šå•ç‹¬è¢«åˆå¹¶åˆ°ä¸€ä¸ªä»£ç æ–‡ä»¶ä¸­å»ã€‚ å¦å¤–ï¼Œ`batchsize 0` ä¹Ÿå¼ºè¡Œç¦ç”¨äº† Batch æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰è®¾ç½® unity_group åˆ†ç»„çš„ä»£ç æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¼šå•ç‹¬ç¼–è¯‘å®ƒä»¬ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨å¼€å¯è‡ªåŠ¨åˆå¹¶ã€‚ ## Batch å’Œ Group æ··åˆæ¨¡å¼ æˆ‘ä»¬åªè¦æŠŠä¸Šé¢çš„ `batchsize 0` æ”¹æˆé 0 å€¼ï¼Œå°±å¯ä»¥è®©åˆ†ç»„æ¨¡å¼ä¸‹ï¼Œå‰©ä½™çš„ä»£ç æ–‡ä»¶ç»§ç»­å¼€å¯ Batch æ¨¡å¼è‡ªåŠ¨åˆå¹¶ç¼–è¯‘ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_includedirs(\"src\") add_rules(\"c++.unity_build\", {batchsize 2}) add_files(\"src/*.c\", \"src/*.cpp\") add_files(\"src/foo/*.c\", {unity_group \"foo\"}) add_files(\"src/bar/*.c\", {unity_group \"bar\"}) end) ``` ## å¿½ç•¥æŒ‡å®šæ–‡ä»¶ å¦‚æœæ˜¯ Batch æ¨¡å¼ä¸‹ï¼Œç”±äºæ˜¯è‡ªåŠ¨åˆå¹¶æ“ä½œï¼Œæ‰€ä»¥é»˜è®¤ä¼šå¯¹æ‰€æœ‰æ–‡ä»¶æ‰§è¡Œåˆå¹¶ï¼Œä½†å¦‚æœæœ‰äº›ä»£ç æ–‡ä»¶æˆ‘ä»¬ä¸æƒ³è®©å®ƒå‚ä¸åˆå¹¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `{unity_ignored true}` å»å¿½ç•¥å®ƒä»¬ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_includedirs(\"src\") add_rules(\"c++.unity_build\", {batchsize 2}) add_files(\"src/*.c\", \"src/*.cpp\") add_files(\"src/test/*.c\", {unity_ignored true}) ignore these files end) ``` ## Unique ID å°½ç®¡ Unity Build å¸¦æ¥çš„æ”¶ç›Šä¸é”™ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯ä¼šé‡åˆ°ä¸€äº›æ„å¤–çš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ä¸¤ä¸ªä»£ç æ–‡ä»¶é‡Œé¢ï¼Œå…¨å±€å‘½åç©ºé—´ä¸‹ï¼Œéƒ½å­˜åœ¨ç›¸åŒåå­—çš„å…¨å±€å˜é‡å’Œå‡½æ•°ã€‚ é‚£ä¹ˆï¼Œåˆå¹¶ç¼–è¯‘å°±ä¼šå¸¦æ¥ç¼–è¯‘å†²çªé—®é¢˜ï¼Œç¼–è¯‘å™¨é€šå¸¸ä¼šæŠ¥å…¨å±€å˜é‡é‡å®šä¹‰é”™è¯¯ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç”¨æˆ·ä»£ç ä¸Šåšä¸€äº›ä¿®æ”¹ï¼Œç„¶åé…åˆæ„å»ºå·¥å…·æ¥è§£å†³ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬çš„ foo.cpp å’Œ bar.cpp éƒ½æœ‰å…¨å±€å˜é‡ iã€‚ foo.cpp ```c namespace { int i 42; } int foo() { return i; } ``` bar.cpp ```c namespace { int i 42; } int bar() { return i; } ``` é‚£ä¹ˆï¼Œæˆ‘ä»¬åˆå¹¶ç¼–è¯‘å°±ä¼šå†²çªï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥ä¸€ä¸ª Unique ID æ¥éš”ç¦»å…¨å±€çš„åŒ¿åç©ºé—´ã€‚ foo.cpp ```c namespace MY_UNITY_ID { int i 42; } int foo() { return MY_UNITY_ID::i; } ``` bar.cpp ```c namespace MY_UNITY_ID { int i 42; } int bar() { return MY_UNITY_ID::i; } ``` æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¿è¯ä»£ç åˆå¹¶åï¼Œ `MY_UNITY_ID` åœ¨ foo å’Œ bar ä¸­çš„å®šä¹‰å®Œå…¨ä¸åŒï¼Œå¯ä»¥æŒ‰æ–‡ä»¶åç®—ä¸€ä¸ªå”¯ä¸€ ID å€¼å‡ºæ¥ï¼Œäº’ä¸å†²çªï¼Œä¹Ÿå°±æ˜¯å®ç°ä¸‹é¢çš„åˆå¹¶æ•ˆæœï¼š ```c #define MY_UNITY_ID <hash(foo.cpp)> #include \"foo.c\" #undef MY_UNITY_ID #define MY_UNITY_ID <hash(bar.cpp)> #include \"bar.c\" #undef MY_UNITY_ID ``` è¿™çœ‹ä¸Šå»ä¼¼ä¹å¾ˆéº»çƒ¦ï¼Œä½†æ˜¯ç”¨æˆ·ä¸éœ€è¦å…³å¿ƒè¿™äº›ï¼Œxmake ä¼šåœ¨åˆå¹¶æ—¶å€™è‡ªåŠ¨å¤„ç†å®ƒä»¬ï¼Œç”¨æˆ·åªéœ€è¦æŒ‡å®šè¿™ä¸ª Unique ID çš„åå­—å°±è¡Œäº†ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_includedirs(\"src\") add_rules(\"c++.unity_build\", {batchsize 2, uniqueid \"MY_UNITY_ID\"}) add_files(\"src/*.c\", \"src/*.cpp\") end) ``` å¤„ç†å…¨å±€å˜é‡ï¼Œè¿˜æœ‰å…¨å±€çš„é‡åå®å®šä¹‰ï¼Œå‡½æ•°ä»€ä¹ˆçš„ï¼Œéƒ½å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼æ¥é¿å…å†²çªã€‚"},"/get_started/zh/features/distcc-build.html":{"title":"","content":" class: heading_no_counter # åˆ†å¸ƒå¼ç¼–è¯‘ xmake æä¾›äº†å†…ç½®çš„åˆ†å¸ƒå¼ç¼–è¯‘æœåŠ¡ï¼Œé€šå¸¸å®ƒå¯ä»¥è·Ÿ æœ¬åœ°ç¼–è¯‘ç¼“å­˜ï¼Œè¿œç¨‹ç¼–è¯‘ç¼“å­˜ ç›¸äº’é…åˆï¼Œå®ç°æœ€ä¼˜çš„ç¼–è¯‘çš„åŠ é€Ÿã€‚ å¦å¤–ï¼Œå®ƒæ˜¯å®Œå…¨è·¨å¹³å°æ”¯æŒï¼Œæˆ‘ä»¬ä¸ä»…æ”¯æŒ gcc/clangï¼Œä¹Ÿèƒ½å¤Ÿå¾ˆå¥½åœ°æ”¯æŒ Windows å’Œ msvcã€‚ å¯¹äºäº¤å‰ç¼–è¯‘ï¼Œåªè¦äº¤å‰å·¥å…·é“¾æ”¯æŒï¼Œæˆ‘ä»¬ä¸è¦æ±‚æœåŠ¡å™¨çš„ç³»ç»Ÿç¯å¢ƒï¼Œå³ä½¿æ··ç”¨ linux, macOS å’Œ Windows çš„æœåŠ¡å™¨èµ„æºï¼Œä¹Ÿå¯ä»¥å¾ˆå¥½çš„å®ç°åˆ†å¸ƒå¼ç¼–è¯‘ã€‚ ## å¼€å¯æœåŠ¡ æˆ‘ä»¬å¯ä»¥æŒ‡å®š ` distcc` å‚æ•°æ¥å¼€å¯åˆ†å¸ƒå¼ç¼–è¯‘æœåŠ¡ï¼Œå½“ç„¶å¦‚æœä¸æŒ‡å®šè¿™ä¸ªå‚æ•°ï¼Œxmake ä¼šé»˜è®¤å¼€å¯æ‰€æœ‰æœåŠ¡ç«¯é…ç½®çš„æœåŠ¡ã€‚ è¿™é‡Œæˆ‘ä»¬å‡è®¾æœ‰ 2 å°æœºå™¨ä½œä¸ºåˆ†å¸ƒå¼çš„ç¼–è¯‘æœåŠ¡å™¨é›†ç¾¤,ip åœ°å€åˆ†åˆ«æ˜¯ 192.168.22.168,192.168.22.169,ä¸¤å°æœåŠ¡å™¨åˆ†åˆ«æ‰§è¡Œä¸‹é¢çš„è„šæœ¬ ```console $ xmake service distcc <distcc_build_server>: listening 0.0.0.0:9093 .. ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼€å¯æœåŠ¡çš„åŒæ—¶ï¼Œå›æ˜¾è¯¦ç»†æ—¥å¿—ä¿¡æ¯ã€‚ ```console $ xmake service distcc vD <distcc_build_server>: listening 0.0.0.0:9093 .. ``` ## ä»¥ Daemon æ¨¡å¼å¼€å¯æœåŠ¡ ```console $ xmake service distcc start $ xmake service distcc restart $ xmake service distcc stop ``` ## é…ç½®æœåŠ¡ç«¯ æˆ‘ä»¬é¦–å…ˆï¼Œè¿è¡Œ `xmake service` å‘½ä»¤ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ `server.conf` é…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨åˆ° `~/.xmake/service/server.conf`ã€‚ ```bash $ xmake service generating the config file to /Users/ruki/.xmake/service/server.conf .. an token(590234653af52e91b9e438ed860f1a2b) is generated, we can use this token to connect service. generating the config file to /Users/ruki/.xmake/service/client.conf .. <distcc_build_server>: listening 0.0.0.0:9693 .. ``` ç„¶åï¼Œæˆ‘ä»¬ç¼–è¾‘å®ƒï¼Œä¿®å¤æ¯å°æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ï¼ˆå¯é€‰ï¼‰ã€‚ ```bash $ cat ~/.xmake/service/server.conf { distcc_build { listen \"0.0.0.0:9693\", workdir \"/Users/ruki/.xmake/service/server/distcc_build\" }, known_hosts { }, logfile \"/Users/ruki/.xmake/service/server/logs.txt\", tokens { \"590234653af52e91b9e438ed860f1a2b\" } } ``` ## é…ç½®å®¢æˆ·ç«¯ å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶åœ¨ `~/.xmake/service/client.conf`ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢é…ç½®å®¢æˆ·ç«¯éœ€è¦è¿æ¥çš„æœåŠ¡å™¨åœ°å€ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨ hosts åˆ—è¡¨é‡Œé¢é…ç½®å¤šä¸ªæœåŠ¡å™¨åœ°å€ï¼Œä»¥åŠå¯¹åº”çš„ tokenã€‚ > åˆ†å¸ƒå¼ç¼–è¯‘ï¼Œæ¨èä½¿ç”¨ token è®¤è¯æ¨¡å¼ï¼Œå› ä¸ºå¯†ç æ¨¡å¼ï¼Œæ¯å°æœåŠ¡å™¨è¿æ¥æ—¶å€™éƒ½è¦è¾“å…¥ä¸€æ¬¡å¯†ç ï¼Œå¾ˆç¹çã€‚ ```console $cat ~/.xmake/service/client.conf { distcc_build { hosts { { connect \"192.168.22.168:9693\", token \"590234653af52e91b9e438ed860f1a2b\" }, { connect \"192.168.22.169:9693\", token \"590234653af52e91b9e438ed860f1a2b\" } } } } ``` ### é…ç½®è¶…æ—¶ é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯è¿æ¥ï¼Œæ”¶å‘æ•°æ®éƒ½æ˜¯æ— é™ç­‰å¾…ä¸è¶…æ—¶çš„ï¼Œä½†æ˜¯å¦‚æœè®¿é—®æœåŠ¡ç«¯çš„ç½‘ç»œä¸ç¨³å®šï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¼šå¯¼è‡´è®¿é—®å¡æ­»ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥é…ç½®è¶…æ—¶æ¥è§£å†³ã€‚ å¦‚æœå‘ç”Ÿè¶…æ—¶å¼‚å¸¸ï¼Œå°±ä¼šè‡ªåŠ¨é€€åŒ–åˆ°æœ¬åœ°ç¼–è¯‘ï¼Œä¸ä¼šæ°¸è¿œå¡æ­»ã€‚ æˆ‘ä»¬å¯ä»¥é…ç½®ï¼Œ`send_timeout`, `recv_timeout` å’Œ `connect_timeout` ä¸‰ç§è¶…æ—¶ï¼Œå¦‚æœåœ¨æ ¹èŠ‚ç‚¹è®¾ç½®ï¼Œé‚£ä¹ˆæ‰€æœ‰å®¢æˆ·ç«¯æœåŠ¡éƒ½ä¼šç”Ÿæ•ˆã€‚ ```console $ cat ~/.xmake/service/client.conf { send_timeout 5000, recv_timeout 5000, connect_timeout 5000 } ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»…ä»…é’ˆå¯¹å½“å‰åˆ†å¸ƒå¼æ„å»ºæœåŠ¡é…ç½®è¶…æ—¶ï¼Œå…¶ä»–æœåŠ¡è¿˜æ˜¯é»˜è®¤è¶…æ—¶ã€‚ ```console $ cat ~/.xmake/service/client.conf { distcc_build { send_timeout 5000, recv_timeout 5000, connect_timeout 5000, } } ``` > æœåŠ¡ç«¯é…ç½®åŒæ ·æ”¯æŒè¶…æ—¶é…ç½®ã€‚ ## ç”¨æˆ·è®¤è¯å’Œæˆæƒ å…³äºç”¨æˆ·è®¤è¯å’Œæˆæƒï¼Œå¯ä»¥å‚è€ƒ [è¿œç¨‹ç¼–è¯‘/ç”¨æˆ·è®¤è¯å’Œæˆæƒ](/#/zh cn/guide/other_features?id %e7%94%a8%e6%88%b7%e8%ae%a4%e8%af%81%e5%92%8c%e6%8e%88%e6%9d%83) é‡Œé¢çš„è¯¦ç»†è¯´æ˜ï¼Œç”¨æ³•æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ ## è¿æ¥æœåŠ¡å™¨ é…ç½®å®Œè®¤è¯å’ŒæœåŠ¡å™¨åœ°å€åï¼Œå°±å¯ä»¥è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œå°†å½“å‰å·¥ç¨‹è¿æ¥åˆ°é…ç½®çš„æœåŠ¡å™¨ä¸Šäº†ã€‚ æˆ‘ä»¬éœ€è¦åœ¨è¿æ¥æ—¶å€™ï¼Œè¾“å…¥ ` distcc`ï¼ŒæŒ‡å®šä»…ä»…è¿æ¥åˆ†å¸ƒå¼æœåŠ¡ã€‚ ```bash $ cd projectdir $ xmake service connect distcc <client>: connect 127.0.0.1:9693 .. <client>: 127.0.0.1:9693 connected! ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶è¿æ¥å¤šä¸ªæœåŠ¡ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼ç¼–è¯‘å’Œè¿œç¨‹ç¼–è¯‘ç¼“å­˜æœåŠ¡ã€‚ ```hash $ xmake service connect distcc ccache ``` > å¦‚æœä¸å¸¦ä»»ä½•å‚æ•°ï¼Œé»˜è®¤è¿æ¥çš„æ˜¯è¿œç¨‹ç¼–è¯‘æœåŠ¡ã€‚ ## åˆ†å¸ƒå¼ç¼–è¯‘é¡¹ç›® è¿æ¥ä¸ŠæœåŠ¡å™¨åï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒæ­£å¸¸æœ¬åœ°ç¼–è¯‘é‚£æ ·ï¼Œè¿›è¡Œåˆ†å¸ƒå¼ç¼–è¯‘äº†ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake ... [ 93%]: cache compiling.release src/demo/network/unix_echo_client.c > local job [ 93%]: cache compiling.release src/demo/network/ipv6.c [ 93%]: cache compiling.release src/demo/network/ping.c [ 93%]: distcc compiling.release src/demo/network/unix_echo_server.c. > distcc job [ 93%]: distcc compiling.release src/demo/network/http.c [ 93%]: distcc compiling.release src/demo/network/unixaddr.c [ 93%]: distcc compiling.release src/demo/network/ipv4.c [ 94%]: distcc compiling.release src/demo/network/ipaddr.c [ 94%]: distcc compiling.release src/demo/math/fixed.c [ 94%]: distcc compiling.release src/demo/libm/float.c [ 95%]: cache compiling.release src/demo/libm/double.c [ 95%]: cache compiling.release src/demo/other/test.cpp [ 98%]: archiving.release libtbox.a [ 99%]: linking.release demo [100%]: build ok! ``` å…¶ä¸­ï¼Œå¸¦æœ‰ distcc å­—æ ·çš„æ˜¯è¿œç¨‹ç¼–è¯‘ä»»åŠ¡ï¼Œå…¶ä»–çš„éƒ½æ˜¯æœ¬åœ°ç¼–è¯‘ä»»åŠ¡ï¼Œé»˜è®¤ xmake è¿˜å¼€å¯äº†æœ¬åœ°ç¼–è¯‘ç¼“å­˜ï¼Œå¯¹åˆ†å¸ƒå¼ç¼–è¯‘ç»“æœè¿›è¡Œç¼“å­˜ï¼Œé¿å…é¢‘ç¹è¯·æ±‚æœåŠ¡å™¨ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¼€å¯è¿œç¨‹ç¼–è¯‘ç¼“å­˜ï¼Œè·Ÿå…¶ä»–äººå…±äº«ç¼–è¯‘ç¼“å­˜ï¼Œè¿›ä¸€æ­¥åŠ é€Ÿå¤šäººååŒå¼€å‘çš„ç¼–è¯‘ã€‚ ## æ–­å¼€è¿æ¥ ```bash $ xmake service disconnect distcc ``` ## æŒ‡å®šå¹¶è¡Œç¼–è¯‘ä»»åŠ¡æ•° æˆ‘ä»¬å…ˆç®€å•ä»‹ç»ä¸‹ï¼Œç›®å‰æ ¹æ®ä¸»æœº cpu core æ•°é‡é»˜è®¤è®¡ç®—çš„å¹¶è¡Œä»»åŠ¡æ•°ï¼š ```lua local default_njob math.ceil(ncpu * 3 / 2) ``` å› æ­¤ï¼Œå¦‚æœä¸å¼€å¯åˆ†å¸ƒå¼ç¼–è¯‘ï¼Œé»˜è®¤çš„æœ€å¤§å¹¶è¡Œç¼–è¯‘ä»»åŠ¡æ•°å°±æ˜¯è¿™ä¸ª default_njobã€‚ å¦‚æœå¼€å¯åˆ†å¸ƒå¼ç¼–è¯‘åï¼Œé»˜è®¤çš„å¹¶è¡Œç¼–è¯‘ä»»åŠ¡æ•°å°±æ˜¯ï¼š ```lua local maxjobs default_njob + server_count * server_default_njob ``` ### ä¿®æ”¹æœ¬åœ°å¹¶è¡Œä»»åŠ¡æ•° æˆ‘ä»¬åªéœ€è¦é€šè¿‡ ` jN` å°±èƒ½æŒ‡å®šæœ¬åœ°å¹¶è¡Œä»»åŠ¡æ•°ï¼Œä½†æ˜¯å®ƒä¸ä¼šå½±å“æœåŠ¡ç«¯çš„å¹¶è¡Œä»»åŠ¡æ•°ã€‚ ```bash $ xmake jN ``` ### ä¿®æ”¹æœåŠ¡ç«¯å¹¶è¡Œä»»åŠ¡æ•° å¦‚æœè¦ä¿®æ”¹æœåŠ¡ç«¯çš„å¹¶è¡Œä»»åŠ¡æ•°ï¼Œéœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ã€‚ ```bash $cat ~/.xmake/service/client.conf { distcc_build { hosts { { connect \"127.0.0.1:9693\", token \"590234653af52e91b9e438ed860f1a2b\", njob 8 < modify here }, { connect \"192.168.01:9693\", token \"590234653af52e91b9e438ed860f1a2b\", njob 4 } } } } ``` å¯ä»¥å¯¹æ¯ä¸ªæœåŠ¡å™¨ä¸»æœºï¼Œæ·»åŠ  `njob N` å‚æ•°é…ç½®ï¼ŒæŒ‡å®šè¿™å°æœåŠ¡å™¨å¯ä»¥æä¾›çš„å¹¶è¡Œä»»åŠ¡æ•°ã€‚ ## åˆ†å¸ƒå¼ç¼–è¯‘ Android é¡¹ç›® xmake æä¾›çš„åˆ†å¸ƒå¼ç¼–è¯‘æœåŠ¡æ˜¯å®Œå…¨è·¨å¹³å°çš„ï¼Œå¹¶ä¸”æ”¯æŒ Windows, Linux, macOS, Android, iOS ç”šè‡³äº¤å‰ç¼–è¯‘ã€‚ å¦‚æœè¦è¿›è¡Œ Android é¡¹ç›®ç¼–è¯‘ï¼Œåªéœ€è¦åœ¨æœåŠ¡ç«¯é…ç½®ä¸­ï¼Œå¢åŠ  `toolchains` å·¥å…·é“¾é…ç½®ï¼Œæä¾› NDK çš„è·Ÿè·¯å¾„å³å¯ã€‚ ```bash $ cat ~/.xmake/service/server.conf { distcc_build { listen \"0.0.0.0:9693\", toolchains { ndk { ndk \"~/files/android ndk r21e\" < here } }, workdir \"/Users/ruki/.xmake/service/server/distcc_build\" }, known_hosts { }, logfile \"/Users/ruki/.xmake/service/server/logs.txt\", tokens { \"590234653af52e91b9e438ed860f1a2b\" } } ``` ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒæ­£å¸¸æœ¬åœ°ç¼–è¯‘é‚£æ ·ï¼Œåˆ†å¸ƒå¼ç¼–è¯‘ Android é¡¹ç›®ï¼Œç”šè‡³å¯ä»¥é…ç½®å¤šå° Windows, macOS, Linux ç­‰ä¸åŒçš„æœåŠ¡å™¨ä¸»æœºï¼Œåšä¸ºåˆ†å¸ƒå¼ç¼–è¯‘æœåŠ¡çš„èµ„æºï¼Œæ¥ç¼–è¯‘å®ƒã€‚ åªéœ€è¦ä¸‹è½½å¯¹åº”å¹³å°çš„ NDK å°±è¡Œäº†ã€‚ ```bash $ xmake f p android ndk ~/files/xxxx $ xmake ``` ## åˆ†å¸ƒå¼ç¼–è¯‘ iOS é¡¹ç›® ç¼–è¯‘ iOS é¡¹ç›®æ›´åŠ ç®€å•ï¼Œå› ä¸º Xmake é€šå¸¸èƒ½è‡ªåŠ¨æ£€æµ‹åˆ° Xcodeï¼Œæ‰€ä»¥åªéœ€è¦åƒæ­£å¸¸æœ¬åœ°ä¸€æ ·ï¼Œåˆ‡ä¸€ä¸‹å¹³å°åˆ° ios å³å¯ã€‚ ```bash $ xmake f p iphoneos $ xmake ``` ## åˆ†å¸ƒå¼äº¤å‰ç¼–è¯‘é…ç½® å¦‚æœè¦åˆ†å¸ƒå¼äº¤å‰ç¼–è¯‘ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡ç«¯é…ç½®å·¥å…·é“¾ sdk è·¯å¾„ï¼Œä¾‹å¦‚ï¼š ```bash $ cat ~/.xmake/service/server.conf { distcc_build { listen \"0.0.0.0:9693\", toolchains { cross { sdkdir \"~/files/arm linux xxx\" < here } }, workdir \"/Users/ruki/.xmake/service/server/distcc_build\" }, known_hosts { }, logfile \"/Users/ruki/.xmake/service/server/logs.txt\", tokens { \"590234653af52e91b9e438ed860f1a2b\" } } ``` å…¶ä¸­ï¼Œtoolchains ä¸‹ï¼Œæ¯ä¸€é¡¹å¯¹åº”ä¸€ä¸ªå·¥å…·é“¾ï¼Œè¿™é‡Œé…ç½®ä¸º `cross {}` äº¤å‰å·¥å…·é“¾ï¼Œå¯¹åº” `toolchain(\"cross\")`ã€‚ å·¥å…·é“¾é‡Œé¢æˆ‘ä»¬å¯ä»¥é…ç½® `sdkdir`, `bindir`, `cross` ç­‰ç­‰ï¼Œå¯¹åº” `toolchain(\"cross\")` é‡Œé¢çš„ `set_sdkdir`, `set_bindir` å’Œ `set_cross` ç­‰æ¥å£é…ç½®ã€‚ å¦‚æœäº¤å‰å·¥å…·é“¾æ¯”è¾ƒè§„èŒƒï¼Œæˆ‘ä»¬é€šå¸¸åªéœ€è¦é…ç½® `sdkdir`ï¼Œxmake å°±èƒ½è‡ªåŠ¨æ£€æµ‹åˆ°ã€‚ è€Œå®¢æˆ·ç«¯ç¼–è¯‘ä¹Ÿåªéœ€è¦æŒ‡å®š sdk ç›®å½•ã€‚ ```bash $ xmake f p cross sdk /xxx/arm linux xxx $ xmake ``` ## æ¸…ç†æœåŠ¡å™¨ç¼“å­˜ æ¯ä¸ªé¡¹ç›®åœ¨æœåŠ¡ç«¯çš„ç¼–è¯‘ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€äº›ç¼“å­˜æ–‡ä»¶ï¼Œä»–ä»¬éƒ½æ˜¯æŒ‰å·¥ç¨‹ç²’åº¦åˆ†åˆ«å­˜å‚¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œå¯¹å½“å‰å·¥ç¨‹æ¸…ç†æ¯ä¸ªæœåŠ¡å™¨å¯¹åº”çš„ç¼“å­˜ã€‚ ```bash $ xmake service clean distcc ``` ## ä¸€äº›å†…éƒ¨ä¼˜åŒ– 1. ç¼“å­˜æœåŠ¡å™¨ç«¯ç¼–è¯‘ç»“æœï¼Œé¿å…é‡å¤ç¼–è¯‘ 2. æœ¬åœ°ç¼“å­˜ï¼Œè¿œç¨‹ç¼“å­˜ä¼˜åŒ–ï¼Œé¿å…ä¸å¿…è¦çš„æœåŠ¡ç«¯é€šä¿¡ 3. æœåŠ¡å™¨è´Ÿè½½å‡è¡¡è°ƒåº¦ï¼Œåˆç†åˆ†é…æœåŠ¡å™¨èµ„æº 4. é¢„å¤„ç†åå°æ–‡ä»¶ç›´æ¥æœ¬åœ°ç¼–è¯‘ï¼Œé€šå¸¸ä¼šæ›´å¿« 5. å¤§æ–‡ä»¶å®æ—¶å‹ç¼©ä¼ è¾“ï¼ŒåŸºäº lz4 å¿«é€Ÿå‹ç¼© 6. å†…éƒ¨çŠ¶æ€ç»´æŠ¤ï¼Œç›¸æ¯” distcc ç­‰ç‹¬ç«‹å·¥å…·ï¼Œé¿å…äº†é¢‘ç¹çš„ç‹¬ç«‹è¿›ç¨‹åŠ è½½è€—æ—¶ï¼Œä¹Ÿé¿å…äº†ä¸å®ˆæŠ¤è¿›ç¨‹é¢å¤–çš„é€šä¿¡"},"/get_started/zh/features/remote-build.html":{"title":"","content":" class: heading_no_counter # è¿œç¨‹ç¼–è¯‘ ## å‰è¨€ xmake æä¾›äº†è¿œç¨‹ç¼–è¯‘æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒå¯ä»¥è¿œç¨‹æœåŠ¡å™¨ä¸Šç¼–è¯‘ä»£ç ï¼Œè¿œç¨‹è¿è¡Œå’Œè°ƒè¯•ã€‚ æœåŠ¡å™¨å¯ä»¥éƒ¨ç½²åœ¨ Linux/MacOS/Windows ä¸Šï¼Œå®ç°è·¨å¹³å°ç¼–è¯‘ï¼Œä¾‹å¦‚ï¼šåœ¨ Linux ä¸Šç¼–è¯‘è¿è¡Œ Windows ç¨‹åºï¼Œåœ¨ Windows ä¸Šç¼–è¯‘è¿è¡Œ macOS/Linux ç¨‹åºã€‚ ç›¸æ¯” ssh è¿œç¨‹ç™»å…¥ç¼–è¯‘ï¼Œå®ƒæ›´åŠ çš„ç¨³å®šï¼Œä½¿ç”¨æ›´åŠ æµç•…ï¼Œä¸ä¼šå› ä¸ºç½‘ç»œä¸ç¨³å®šå¯¼è‡´ ssh ç»ˆç«¯è¾“å…¥å¡é¡¿ï¼Œä¹Ÿå¯ä»¥å®ç°æœ¬åœ°å¿«é€Ÿç¼–è¾‘ä»£ç æ–‡ä»¶ã€‚ ç”šè‡³æˆ‘ä»¬å¯ä»¥åœ¨ vs/sublime/vscode/idea ç­‰ç¼–è¾‘å™¨å’ŒIDE ä¸­æ— ç¼å®ç°è¿œç¨‹ç¼–è¯‘ï¼Œè€Œä¸éœ€è¦ä¾èµ– IDE æœ¬èº«å¯¹è¿œç¨‹ç¼–è¯‘çš„æ”¯æŒåŠ›åº¦ã€‚ ## å¼€å¯æœåŠ¡ ```console $ xmake service <remote_build_server>: listening 0.0.0.0:9091 .. ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼€å¯æœåŠ¡çš„åŒæ—¶ï¼Œå›æ˜¾è¯¦ç»†æ—¥å¿—ä¿¡æ¯ã€‚ ```console $ xmake service vD <remote_build_server>: listening 0.0.0.0:9091 .. ``` ## ä»¥ Daemon æ¨¡å¼å¼€å¯æœåŠ¡ ```console $ xmake service start $ xmake service restart $ xmake service stop ``` ## é…ç½®æœåŠ¡ç«¯ æˆ‘ä»¬é¦–å…ˆï¼Œè¿è¡Œ `xmake service` å‘½ä»¤ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ `server.conf` é…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨åˆ° `~/.xmake/service/server.conf`ã€‚ ç„¶åï¼Œæˆ‘ä»¬ç¼–è¾‘å®ƒï¼Œä¿®å¤æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ï¼ˆå¯é€‰ï¼‰ã€‚ ```bash $ cat ~/.xmake/service/server.conf { known_hosts { }, logfile \"/Users/ruki/.xmake/service/server/logs.txt\", remote_build { listen \"0.0.0.0:9691\", workdir \"/Users/ruki/.xmake/service/server/remote_build\" }, tokens { \"e438d816c95958667747c318f1532c0f\" } } ``` ## é…ç½®å®¢æˆ·ç«¯ å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶åœ¨ `~/.xmake/service/client.conf`ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢é…ç½®å®¢æˆ·ç«¯éœ€è¦è¿æ¥çš„æœåŠ¡å™¨åœ°å€ã€‚ ```console $ cat ~/.xmake/service/client.conf { remote_build { connect \"127.0.0.1:9691\", token \"e438d816c95958667747c318f1532c0f\" } } ``` ## ç”¨æˆ·è®¤è¯å’Œæˆæƒ åœ¨å®é™…è¿æ¥ä¹‹å‰ï¼Œæˆ‘ä»¬ç®€å•ä»‹ç»ä¸‹ xmake æä¾›çš„æœåŠ¡ç›®å‰æä¾›çš„å‡ ç§è®¤è¯æœºåˆ¶ã€‚ 1. Token è®¤è¯ 2. å¯†ç è®¤è¯ 3. å¯ä¿¡ä¸»æœºéªŒè¯ ### Token è®¤è¯ è¿™ä¹Ÿæ˜¯æˆ‘ä»¬é»˜è®¤æ¨èçš„æ–¹å¼ï¼Œæ›´åŠ å®‰å…¨ï¼Œé…ç½®å’Œè¿æ¥ä¹Ÿæ›´åŠ æ–¹ä¾¿ï¼Œæ¯æ¬¡è¿æ¥ä¹Ÿä¸ç”¨è¾“å…¥å¯†ç ã€‚ æˆ‘ä»¬åœ¨æ‰§è¡Œ `xmake service` å‘½ä»¤æ—¶å€™ï¼Œé»˜è®¤å°±ä¼šç”Ÿæˆä¸€ä¸ªæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ tokenï¼Œå› æ­¤æœ¬åœ°ç›´è¿æ˜¯ä¸éœ€è¦ä»»ä½•é…ç½®çš„ã€‚ #### æœåŠ¡ç«¯è®¤è¯é…ç½® æœåŠ¡ç«¯å¯ä»¥é…ç½®å¤šä¸ª token ç”¨äºå¯¹ä¸åŒç”¨æˆ·ä¸»æœºè¿›è¡Œæˆæƒè¿æ¥ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å…±ç”¨ä¸€ä¸ª tokenã€‚ ```bash $ cat ~/.xmake/service/server.conf { known_hosts { }, logfile \"/Users/ruki/.xmake/service/server/logs.txt\", remote_build { listen \"0.0.0.0:9691\", workdir \"/Users/ruki/.xmake/service/server/remote_build\" }, tokens { \"e438d816c95958667747c318f1532c0f\" } } ``` #### å®¢æˆ·ç«¯è®¤è¯é…ç½® å®¢æˆ·ç«¯åªéœ€è¦æ·»åŠ æœåŠ¡å™¨ä¸Šçš„ token åˆ°å¯¹åº”çš„å®¢æˆ·ç«¯é…ç½®ä¸­å³å¯ã€‚ ```bash $ cat ~/.xmake/service/client.conf { remote_build { connect \"127.0.0.1:9691\", token \"e438d816c95958667747c318f1532c0f\" } } ``` #### æ‰‹åŠ¨ç”Ÿæˆæ–° token æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ‰‹åŠ¨ç”Ÿæˆä¸€ä¸ªæ–°çš„ tokenï¼Œè‡ªå·±æ·»åŠ åˆ°æœåŠ¡å™¨é…ç½®ä¸­ã€‚ ```bash $ xmake service gen token New token a7b9fc2d3bfca1472aabc38bb5f5d612 is generated! ``` ### å¯†ç è®¤è¯ æˆ‘ä»¬ä¹Ÿæä¾›å¯†ç è®¤è¯çš„æˆæƒæ¨¡å¼ï¼Œç›¸æ¯” token è®¤è¯ï¼Œå®ƒéœ€è¦ç”¨æˆ·æ¯æ¬¡è¿æ¥çš„æ—¶å€™ï¼Œè¾“å…¥å¯†ç ï¼ŒéªŒè¯é€šè¿‡åï¼Œæ‰èƒ½è¿æ¥ä¸Šã€‚ #### æœåŠ¡ç«¯è®¤è¯é…ç½® å¯†ç è®¤è¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨é…ç½® tokenï¼Œåªéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ·»åŠ ç”¨æˆ·å°±è¡Œäº†ï¼Œæ·»åŠ è¿‡ç¨‹ä¸­ï¼Œä¼šæç¤ºç”¨æˆ·è¾“å…¥å¯†ç ã€‚ ```bash $ xmake service add user ruki Please input user ruki password: 123456 Add user ruki ok! ``` ç„¶åï¼Œxmake å°±ä¼šé€šè¿‡ç”¨æˆ·åï¼Œå¯†ç ç”Ÿæˆä¸€ä¸ªæ–°çš„ token æ·»åŠ åˆ°æœåŠ¡å™¨é…ç½®çš„ token åˆ—è¡¨ä¸­å»ã€‚ ```bash $ cat ~/.xmake/service/server.conf { known_hosts { }, logfile \"/Users/ruki/.xmake/service/server/logs.txt\", remote_build { listen \"0.0.0.0:9691\", workdir \"/Users/ruki/.xmake/service/server/remote_build\" }, tokens { \"e438d816c95958667747c318f1532c0f\", \"7889e25402413e93fd37395a636bf942\" } } ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ é™¤æŒ‡å®šçš„ç”¨æˆ·å’Œå¯†ç ã€‚ ```bash $xmake service rm user ruki Please input user ruki password: 123456 Remove user ruki ok! ``` #### å®¢æˆ·ç«¯è®¤è¯é…ç½® å¯¹äºå®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è®¾ç½®æœåŠ¡å™¨çš„ token äº†ï¼Œåªéœ€è¦åœ¨è¿æ¥é…ç½®ä¸­ï¼Œè¿½åŠ éœ€è¦è¿æ¥çš„ç”¨æˆ·åå³å¯å¼€å¯å¯†ç è®¤è¯ï¼Œæ ¼å¼ï¼š`user@address:port` ```bash $ cat ~/.xmake/service/client.conf { remote_build { connect \"root@127.0.0.1:9691\" } } ``` !> å¦‚æœå»æ‰ç”¨æˆ·åï¼Œä¹Ÿæ²¡é…ç½® tokenï¼Œé‚£å°±æ˜¯åŒ¿åæ¨¡å¼ï¼Œå¦‚æœæœåŠ¡å™¨ä¹Ÿæ²¡é…ç½® tokenï¼Œå°±æ˜¯å®Œå…¨ç¦ç”¨è®¤è¯ï¼Œç›´æ¥è¿æ¥ã€‚ ### å¯ä¿¡ä¸»æœºéªŒè¯ å¦å¤–ï¼Œä¸ºäº†æ›´è¿›ä¸€æ­¥æé«˜å®‰å…¨æ€§ï¼Œæˆ‘ä»¬è¿˜æä¾›äº†æœåŠ¡ç«¯å¯ä¿¡ä¸»æœºéªŒè¯ï¼Œå¦‚æœåœ¨æœåŠ¡å™¨é…ç½®çš„ known_hosts åˆ—è¡¨ä¸­ï¼Œé…ç½®äº†å¯ä»¥è¿æ¥çš„å®¢æˆ·ç«¯ä¸»æœº ip åœ°å€ï¼Œ é‚£ä¹ˆåªæœ‰è¿™äº›ä¸»æœºå¯ä»¥æˆåŠŸè¿æ¥ä¸Šè¿™å°æœåŠ¡å™¨ï¼Œå…¶ä»–ä¸»æœºå¯¹å®ƒçš„è¿æ¥éƒ½ä¼šè¢«æç¤ºä¸ºä¸å¯ä¿¡è€Œæ‹’ç»è¿æ¥ï¼Œå³ä½¿ token å’Œå¯†ç è®¤è¯éƒ½æ²¡é—®é¢˜ä¹Ÿä¸è¡Œã€‚ ```bash $ cat ~/.xmake/service/server.conf { logfile \"/Users/ruki/.xmake/service/logs.txt\", server { tokens { \"4b928c7563a0cba10ff4c3f5ca0c8e24\" }, known_hosts { \"127.0.0.1\", \"xx.xx.xx.xx\"} } } ``` ## è¿æ¥è¿œç¨‹çš„æœåŠ¡å™¨ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›å…¥éœ€è¦è¿œç¨‹ç¼–è¯‘çš„å·¥ç¨‹æ ¹ç›®å½•ï¼Œæ‰§è¡Œ `xmake service connect` å‘½ä»¤ï¼Œè¿›è¡Œè¿æ¥ã€‚ å¦‚æœæ˜¯ token è®¤è¯æ¨¡å¼ï¼Œé‚£ä¹ˆä¸éœ€è¦çš„é¢å¤–çš„å¯†ç è¾“å…¥ï¼Œç›´æ¥è¿æ¥ã€‚ ```console $ xmake create test $ cd test $ xmake service connect <remote_build_client>: connect 192.168.56.110:9091 .. <remote_build_client>: connected! <remote_build_client>: sync files in 192.168.56.110:9091 .. Scanning files .. Comparing 3 files .. [+]: src/main.cpp [+]: .gitignore [+]: xmake.lua 3 files has been changed! Archiving files .. Uploading files with 1372 bytes .. <remote_build_client>: sync files ok! ``` å¦‚æœæ˜¯å¯†ç è®¤è¯ï¼Œé‚£ä¹ˆä¼šæç¤ºç”¨æˆ·è¾“å…¥å¯†ç ï¼Œæ‰èƒ½ç»§ç»­è¿æ¥ã€‚ ```bash $ xmake service connect Please input user root password: 000000 <remote_build_client>: connect 127.0.0.1:9691 .. <remote_build_client>: connected! <remote_build_client>: sync files in 127.0.0.1:9691 .. Scanning files .. Comparing 3 files .. [+]: xmake.lua [+]: .gitignore [+]: src/main.cpp 3 files has been changed! Archiving files .. Uploading files with 1591 bytes .. <remote_build_client>: sync files ok! ``` å¦‚æœå¯†ç ä¸å¯¹ï¼Œå°±ä¼šæç¤ºé”™è¯¯ã€‚ ```bash $ xmake service connect Please input user root password: 123 <remote_build_client>: connect 127.0.0.1:9691 .. <remote_build_client>: connect 127.0.0.1:9691 failed, user and password are incorrect! ``` ## è¿œç¨‹æ„å»ºå·¥ç¨‹ è¿æ¥æˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒæ­£å¸¸æœ¬åœ°ç¼–è¯‘ä¸€æ ·ï¼Œè¿›è¡Œè¿œç¨‹ç¼–è¯‘ã€‚ ```console $ xmake <remote_build_client>: run xmake in 192.168.56.110:9091 .. checking for platform ... macosx checking for architecture ... x86_64 checking for Xcode directory ... /Applications/Xcode.app checking for Codesign Identity of Xcode ... Apple Development: waruqi@gmail.com (T3NA4MRVPU) checking for SDK version of Xcode for macosx (x86_64) ... 11.3 checking for Minimal target version of Xcode for macosx (x86_64) ... 11.4 [ 25%]: cache compiling.release src/main.cpp [ 50%]: linking.release test [100%]: build ok! <remote_build_client>: run command ok! ``` ## è¿œç¨‹è¿è¡Œç›®æ ‡ç¨‹åº æˆ‘ä»¬ä¹Ÿå¯ä»¥åƒæœ¬åœ°è¿è¡Œè°ƒè¯•é‚£æ ·ï¼Œè¿œç¨‹è¿è¡Œè°ƒè¯•ç¼–è¯‘çš„ç›®æ ‡ç¨‹åºã€‚ ```console $ xmake run <remote_build_client>: run xmake run in 192.168.56.110:9091 .. hello world! <remote_build_client>: run command ok! ``` ## è¿œç¨‹é‡å»ºå·¥ç¨‹ ```console $ xmake rv <remote_build_client>: run xmake rv in 192.168.56.110:9091 .. [ 25%]: cache compiling.release src/main.cpp /usr/local/bin/ccache /usr/bin/xcrun sdk macosx clang c Qunused arguments arch x86_64 mmacosx version min 11.4 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.3.sdk fvisibility hidden fvisibility inlines hidden O3 DNDEBUG o build/.objs/test/macosx/x86_64/release/src/main.cpp.o src/main.cpp [ 50%]: linking.release test \"/usr/bin/xcrun sdk macosx clang++\" o build/macosx/x86_64/release/test build/.objs/test/macosx/x86_64/release/src/main.cpp.o arch x86_64 mmacosx version min 11.4 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.3.sdk stdlib libc++ Wl, x lz [100%]: build ok! <remote_build_client>: run command ok! ``` ## è¿œç¨‹é…ç½®ç¼–è¯‘å‚æ•° ```console $ xmake f xxx yy ``` ## æ‰‹åŠ¨åŒæ­¥å·¥ç¨‹æ–‡ä»¶ è¿æ¥çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åŒæ­¥ä¸€æ¬¡ä»£ç ï¼ŒåæœŸä»£ç æ”¹åŠ¨ï¼Œå¯ä»¥æ‰§è¡Œæ­¤å‘½ä»¤æ¥æ‰‹åŠ¨åŒæ­¥æ”¹åŠ¨çš„æ–‡ä»¶ã€‚ ```console $ xmake service sync <remote_build_client>: sync files in 192.168.56.110:9091 .. Scanning files .. Comparing 3 files .. [+]: src/main.cpp [+]: .gitignore [+]: xmake.lua 3 files has been changed! Archiving files .. Uploading files with 1372 bytes .. <remote_build_client>: sync files ok! ``` ## æ‹‰å–è¿œç¨‹æ–‡ä»¶ v2.7.1 ç‰ˆæœ¬æˆ‘ä»¬æ–°å¢äº†ä¸€ä¸ªå‚æ•°ç”¨äºæ‹‰å–è¿œç¨‹æŒ‡å®šçš„æ–‡ä»¶ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥ç”¨æ¥å®Œæˆæ„å»ºåç›®æ ‡æ–‡ä»¶çš„æ‹‰å–ï¼Œå°†ç¼–è¯‘åçš„åº“æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚ ä¾‹å¦‚ï¼š ```bash xmake service pull 'build/**' outputdir ``` æˆ‘ä»¬å¯ä»¥æŒ‡å®šè¿œç¨‹è·¯å¾„ `build/**` ï¼Œå°†æ‰€æœ‰åŒ¹é…çš„æ–‡ä»¶å…¨éƒ¨æ‹‰å–åˆ°æœ¬åœ° outputdir ç›®å½•ä¸‹ã€‚ ## æ–­å¼€è¿œç¨‹è¿æ¥ é’ˆå¯¹å½“å‰å·¥ç¨‹ï¼Œæ–­å¼€è¿æ¥ï¼Œè¿™ä»…ä»…å½±å“å½“å‰å·¥ç¨‹ï¼Œå…¶ä»–é¡¹ç›®è¿˜æ˜¯å¯ä»¥åŒæ—¶è¿æ¥å’Œç¼–è¯‘ã€‚ ```console $ xmake service disconnect <remote_build_client>: disconnect 192.168.56.110:9091 .. <remote_build_client>: disconnected! ``` ## æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿— ```console $ xmake service logs ``` ## æ¸…ç†è¿œç¨‹æœåŠ¡ç¼“å­˜å’Œæ„å»ºæ–‡ä»¶ æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ¸…ç†è¿œç¨‹çš„ä»»ä½•ç¼“å­˜å’Œæ„å»ºç”Ÿæˆçš„æ–‡ä»¶ã€‚ ```console $ cd projectdir $ xmake service clean ```"},"/get_started/zh/features/try-build.html":{"title":"","content":" class: heading_no_counter # å°è¯•ä½¿ç”¨å…¶ä»–æ„å»ºç³»ç»Ÿ xmake ç›´æ¥å¯¹æ¥äº†å…¶ä»–ç¬¬ä¸‰æ–¹æ„å»ºç³»ç»Ÿï¼Œå³ä½¿å…¶ä»–é¡¹ç›®ä¸­æ²¡æœ‰ä½¿ç”¨ xmake.lua æ¥ç»´æŠ¤ï¼Œxmake ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨å…¶ä»–æ„å»ºå·¥å…·æ¥å®Œæˆç¼–è¯‘ã€‚ é‚£ç”¨æˆ·ç›´æ¥è°ƒç”¨ä½¿ç”¨ç¬¬ä¸‰æ–¹æ„å»ºå·¥å…·æ¥ç¼–è¯‘ä¸å°±è¡Œäº†ï¼Œä¸ºå•¥è¿˜è¦ç”¨ xmake å»è°ƒç”¨å‘¢ï¼Ÿä¸»è¦æœ‰ä»¥ä¸‹å¥½å¤„ï¼š 1. å®Œå…¨çš„è¡Œä¸ºä¸€è‡´ï¼Œç®€åŒ–ç¼–è¯‘æµç¨‹ï¼Œä¸ç®¡ç”¨äº†å“ªä¸ªå…¶ä»–æ„å»ºç³»ç»Ÿï¼Œéƒ½åªéœ€è¦æ‰§è¡Œ xmake è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥ç¼–è¯‘ï¼Œç”¨æˆ·ä¸å†éœ€è¦å»ç ”ç©¶å…¶ä»–å·¥å…·çš„ä¸åŒçš„ç¼–è¯‘æµç¨‹ 2. å®Œå…¨å¯¹æ¥ `xmake config` çš„é…ç½®ç¯å¢ƒï¼Œå¤ç”¨ xmake çš„å¹³å°æ¢æµ‹å’Œ sdk ç¯å¢ƒæ£€æµ‹ï¼Œç®€åŒ–å¹³å°é…ç½® 3. å¯¹æ¥äº¤å‰ç¼–è¯‘ç¯å¢ƒï¼Œå³ä½¿æ˜¯ç”¨ autotools ç»´æŠ¤çš„é¡¹ç›®ï¼Œä¹Ÿèƒ½é€šè¿‡ xmake å¿«é€Ÿå®ç°äº¤å‰ç¼–è¯‘ ç›®å‰å·²æ”¯æŒçš„æ„å»ºç³»ç»Ÿï¼š * autotoolsï¼ˆå·²å®Œå…¨å¯¹æ¥ xmake çš„äº¤å‰ç¼–è¯‘ç¯å¢ƒï¼‰ * xcodebuild * cmakeï¼ˆå·²å®Œå…¨å¯¹æ¥ xmake çš„äº¤å‰ç¼–è¯‘ç¯å¢ƒï¼‰ * make * msbuild * scons * meson * bazel * ndkbuild * ninja ## è‡ªåŠ¨æ¢æµ‹æ„å»ºç³»ç»Ÿå¹¶ç¼–è¯‘ ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªä½¿ç”¨ cmake ç»´æŠ¤çš„é¡¹ç›®ï¼Œç›´æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ xmakeï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘æ¢æµ‹æœºåˆ¶ï¼Œæ£€æµ‹åˆ° CMakeLists.txtï¼Œç„¶åæç¤ºç”¨æˆ·æ˜¯å¦éœ€è¦ä½¿ç”¨ cmake æ¥ç»§ç»­å®Œæˆç¼–è¯‘ã€‚ ```bash $ xmake note: CMakeLists.txt found, try building it (pass y or confirm y/n/d to skip confirm)? please input: y (y/n) Symbol prefix: Configuring done Generating done Build files have been written to: /Users/ruki/Downloads/libpng 1.6.35/build [7%] Built target png fix itxt [21%] Built target genfiles [81%] Built target png [83%] Built target png_static ... output to /Users/ruki/Downloads/libpng 1.6.35/build/artifacts build ok! ``` ## æ— ç¼å¯¹æ¥ xmake å‘½ä»¤ ç›®å‰æ”¯æŒ `xmake clean`, `xmake rebuild` å’Œ `xmake config` ç­‰å¸¸ç”¨å‘½ä»¤ä¸ç¬¬ä¸‰æ–¹ç³»ç»Ÿçš„æ— ç¼å¯¹æ¥ã€‚ æˆ‘ä»¬å¯ä»¥ç›´æ¥æ¸…ç† cmake ç»´æŠ¤é¡¹ç›®çš„ç¼–è¯‘è¾“å‡ºæ–‡ä»¶ ```bash $ xmake clean $ xmake clean all ``` å¦‚æœå¸¦ä¸Š ` all` æ‰§è¡Œæ¸…ç†ï¼Œä¼šæ¸…é™¤ autotools/cmake ç”Ÿæˆçš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸ä»…ä»…åªæ¸…ç†å¯¹è±¡æ–‡ä»¶ã€‚ é»˜è®¤ `xmake` å¯¹æ¥çš„æ˜¯å¢é‡æ„å»ºè¡Œä¸ºï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼ºåˆ¶å¿«é€Ÿé‡å»ºï¼š ```bash $ xmake rebuild ``` ## æ‰‹åŠ¨åˆ‡æ¢æŒ‡å®šæ„å»ºç³»ç»Ÿ å¦‚æœä¸€ä¸ªé¡¹ç›®ä¸‹æœ‰å¤šä¸ªæ„å»ºç³»ç»ŸåŒæ—¶åœ¨ç»´æŠ¤ï¼Œæ¯”å¦‚ libpng é¡¹ç›®ï¼Œè‡ªå¸¦ autotools/cmake/makefile ç­‰æ„å»ºç³»ç»Ÿç»´æŠ¤ï¼Œxmake é»˜è®¤ä¼˜å…ˆæ¢æµ‹ä½¿ç”¨äº† autotoolsï¼Œå¦‚æœæƒ³è¦å¼ºåˆ¶åˆ‡æ¢å…¶ä»–æ„å»ºç³»ç»Ÿï¼Œå¯ä»¥æ‰§è¡Œï¼š ```bash $ xmake f trybuild [autotoolscmakemakemsbuild ..] $ xmake ``` å¦å¤–ï¼Œé…ç½®äº† ` trybuild ` å‚æ•°æ‰‹åŠ¨æŒ‡å®šäº†é»˜è®¤çš„æ„å»ºç³»ç»Ÿï¼Œåç»­çš„ build è¿‡ç¨‹å°±ä¸ä¼šé¢å¤–æç¤ºç”¨æˆ·é€‰æ‹©äº†ã€‚ ## å®ç°å¿«é€Ÿäº¤å‰ç¼–è¯‘ ä¼—æ‰€å‘¨çŸ¥ï¼Œcmake/autotools ç»´æŠ¤çš„é¡¹ç›®è™½ç„¶å¾ˆå¤šéƒ½æ”¯æŒäº¤å‰ç¼–è¯‘ï¼Œä½†æ˜¯äº¤å‰ç¼–è¯‘çš„é…ç½®è¿‡ç¨‹å¾ˆå¤æ‚ï¼Œä¸åŒçš„å·¥å…·é“¾å¤„ç†æ–¹å¼è¿˜æœ‰å¾ˆå¤šçš„å·®å¼‚ï¼Œä¸­é€”ä¼šè¸©åˆ°å¾ˆå¤šçš„å‘ã€‚ å³ä½¿è·‘é€šäº†ä¸€ä¸ªå·¥å…·é“¾çš„äº¤å‰ç¼–è¯‘ï¼Œå¦‚æœåˆ‡åˆ°å¦å¤–ä¸€ä¸ªå·¥å…·é“¾ç¯å¢ƒï¼Œå¯èƒ½åˆè¦æŠ˜è…¾å¥½ä¹…ï¼Œè€Œå¦‚æœä½¿ç”¨ xmakeï¼Œé€šå¸¸åªéœ€è¦ä¸¤æ¡ç®€å•çš„å‘½ä»¤å³å¯ï¼š > ç›®å‰ cmake/autotools éƒ½å·²å¯¹æ¥æ”¯æŒäº† xmake çš„äº¤å‰ç¼–è¯‘ã€‚ ### äº¤å‰ç¼–è¯‘ android å¹³å° ```bash $ xmake f p android trybuild autotools [ ndk xxx] $ xmake ``` > å…¶ä¸­ï¼Œ ndk å‚æ•°é…ç½®æ˜¯å¯é€‰çš„ï¼Œå¦‚æœç”¨æˆ·è®¾ç½®äº† ANDROID_NDK_HOME ç¯å¢ƒå˜é‡ï¼Œæˆ–è€… ndk æ”¾ç½®åœ¨ `~/Library/Android/sdk/ndk bundle`ï¼Œxmake éƒ½èƒ½è‡ªåŠ¨æ£€æµ‹åˆ°ã€‚ æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿå¦‚æœä½ è§‰å¾—è¿™æ²¡å•¥ï¼Œé‚£ä¹ˆå¯ä»¥å¯¹æ¯”ä¸‹ç›´æ¥æ“ä½œ `./configure` å»é…ç½®äº¤å‰ç¼–è¯‘ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡æ¡£å¯¹æ¯”ä¸‹ï¼š[å°† NDK ä¸å…¶ä»–ç¼–è¯‘ç³»ç»Ÿé…åˆä½¿ç”¨](https://developer.android.com/ndk/guides/other_build_systems#autoconf) è¯´ç™½äº†ï¼Œä½ å¤§æ¦‚å¾—è¿™æ ·ï¼Œè¿˜ä¸ä¸€å®šä¸€æ¬¡å°±èƒ½æå®šï¼š ```bash $ export TOOLCHAIN $NDK/toolchains/llvm/prebuilt/$HOST_TAG $ export AR $TOOLCHAIN/bin/aarch64 linux android ar $ export AS $TOOLCHAIN/bin/aarch64 linux android as $ export CC $TOOLCHAIN/bin/aarch64 linux android21 clang $ export CXX $TOOLCHAIN/bin/aarch64 linux android21 clang++ $ export LD $TOOLCHAIN/bin/aarch64 linux android ld $ export RANLIB $TOOLCHAIN/bin/aarch64 linux android ranlib $ export STRIP $TOOLCHAIN/bin/aarch64 linux android strip $ ./configure host aarch64 linux android $ make ``` å¦‚æœæ˜¯ cmake å‘¢ï¼Œäº¤å‰ç¼–è¯‘ä¹Ÿä¸çœäº‹ï¼Œå¯¹äº android å¹³å°ï¼Œå¾—è¿™ä¹ˆé…ç½®ã€‚ ```bash $ cmake \\ DCMAKE_TOOLCHAIN_FILE $NDK/build/cmake/android.toolchain.cmake \\ DANDROID_ABI $ABI \\ DANDROID_NATIVE_API_LEVEL $MINSDKVERSION \\ $OTHER_ARGS ``` è€Œå¯¹äº ios å¹³å°ï¼Œæ²¡æ‰¾åˆ°ç®€å•çš„é…ç½®æ–¹å¼ï¼Œå°±æ‰¾åˆ°ä¸ªç¬¬ä¸‰æ–¹çš„ ios å·¥å…·é“¾é…ç½®ï¼Œå¾ˆå¤æ‚ï¼š<https://github.com/leetal/ios cmake/blob/master/ios.toolchain.cmake> è€Œå¯¹æ¥äº† xmake åï¼Œä¸ç®¡æ˜¯ cmake è¿˜æ˜¯ autotoolsï¼Œäº¤å‰ç¼–è¯‘éƒ½æ˜¯éå¸¸ç®€å•çš„ï¼Œè€Œä¸”é…ç½®æ–¹å¼ä¹Ÿå®Œå…¨ä¸€æ ·ï¼Œç²¾ç®€ä¸€è‡´ã€‚ ### äº¤å‰ç¼–è¯‘ iphoneos å¹³å° ```bash $ xmake f p iphoneos trybuild [cmakeautotools] $ xmake ``` ### ä½¿ç”¨å…¶ä»–äº¤å‰ç¼–è¯‘å·¥å…·é“¾ ```bash $ xmake f p cross trybuild [cmakeautotools] sdk /xxxx $ xmake ``` å…³äºæ›´å¤šäº¤å‰ç¼–è¯‘çš„é…ç½®ç»†èŠ‚ï¼Œè¯·å‚è€ƒæ–‡æ¡£ï¼š[äº¤å‰ç¼–è¯‘](https://xmake.io/#/zh cn/guide/configuration?id %e4%ba%a4%e5%8f%89%e7%bc%96%e8%af%91)ï¼Œé™¤äº†å¤šäº†ä¸€ä¸ª ` trybuild ` å‚æ•°ï¼Œå…¶ä»–äº¤å‰ç¼–è¯‘é…ç½®å‚æ•°éƒ½æ˜¯å®Œå…¨é€šç”¨çš„ã€‚ ## ä¼ é€’ç”¨æˆ·é…ç½®å‚æ•° æˆ‘ä»¬å¯ä»¥é€šè¿‡ ` tryconfigs ` æ¥ä¼ é€’ç”¨æˆ·é¢å¤–çš„é…ç½®å‚æ•°åˆ°å¯¹åº”çš„ç¬¬ä¸‰æ–¹æ„å»ºç³»ç»Ÿï¼Œæ¯”å¦‚ï¼šautotools ä¼šä¼ é€’ç»™ `./configure`ï¼Œcmake ä¼šä¼ é€’ç»™ `cmake` å‘½ä»¤ã€‚ ```bash $ xmake f trybuild autotools tryconfigs \" enable shared no\" $ xmake ``` æ¯”å¦‚ä¸Šè¿°å‘½ä»¤ï¼Œä¼ é€’ ` enable shared no` ç»™ `./configure`ï¼Œæ¥ç¦ç”¨åŠ¨æ€åº“ç¼–è¯‘ã€‚ å¦å¤–ï¼Œå¯¹äº ` cflags`, ` includedirs` å’Œ ` ldflags` ç­‰å‚æ•°ï¼Œä¸éœ€è¦é€šè¿‡ ` tryconfigs`ï¼Œé€šè¿‡ `xmake config cflags ` ç­‰å†…ç½®å‚æ•°å°±å¯é€ä¼ è¿‡å»ã€‚ ## ç¼–è¯‘å…¶ä»–æ„å»ºç³»ç»Ÿè¿‡ç¨‹ç¤ºä¾‹ ### é€šç”¨ç¼–è¯‘æ–¹å¼ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ„å»ºç³»ç»Ÿå¯¹æ¥åçš„ç¼–è¯‘æ–¹å¼éƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤äº† ` trybuild ` é…ç½®å‚æ•°é™¤å¤–ã€‚ ```bash $ xmake f trybuild [autotoolscmakemesonninjabazelmakemsbuildxcodebuild] $ xmake ``` !> æˆ‘ä»¬è¿˜éœ€è¦ç¡®ä¿ trybuild æŒ‡å®šçš„æ„å»ºå·¥å…·å·²ç»å®‰è£…èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ã€‚ ### æ„å»º Android jni ç¨‹åº å¦‚æœå½“å‰é¡¹ç›®ä¸‹å­˜åœ¨ `jni/Android.mk`ï¼Œé‚£ä¹ˆ xmake å¯ä»¥ç›´æ¥è°ƒç”¨ ndk build æ¥æ„å»º jni åº“ã€‚ ```bash $ xmake f p android trybuild ndkbuild [ ndk ] $ xmake ``` å¦‚æœè§‰å¾—å‘½ä»¤è¡Œç¼–è¯‘ jni æ¯”è¾ƒéº»çƒ¦ï¼Œxmake ä¹Ÿæä¾›äº†ç›¸å…³çš„ gradle é›†æˆæ’ä»¶ [xmake gradle](https://github.com/xmake io/xmake gradle)ï¼Œå¯ä»¥æ— ç¼é›†æˆ xmake è¿›è¡Œ jni åº“çš„ç¼–è¯‘é›†æˆï¼Œå…·ä½“è¯¦æƒ…è§ï¼š[ä½¿ç”¨ xmake gradle æ’ä»¶æ„å»º JNI ç¨‹åº](https://xmake.io/#/zh cn/plugin/more_plugins?id gradle%e6%8f%92%e4%bb%b6%ef%bc%88jni%ef%bc%89)"},"/get_started/zh/features/build-cache.html":{"title":"","content":" class: heading_no_counter # ç¼–è¯‘ç¼“å­˜ ## æœ¬åœ°ç¼–è¯‘ç¼“å­˜ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä½ æœ¬æœºå®‰è£…äº† ccacheï¼Œxmake å°±ä¼šä½¿ç”¨å¤–ç½®çš„ ccacheã€‚å¦‚æœæœ¬æœºæ²¡æœ‰å®‰è£… ccacheï¼Œå°±ä¼šé™çº§åˆ° xmake å†…ç½®çš„ xcache è·¨å¹³å°æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆã€‚ ç›¸æ¯” ccache ç­‰ç¬¬ä¸‰æ–¹ç‹¬ç«‹è¿›ç¨‹ï¼Œxmake å†…éƒ¨çŠ¶æ€ç»´æŠ¤ï¼Œæ›´åŠ ä¾¿äºä¼˜åŒ–ï¼Œä¹Ÿé¿å…äº†é¢‘ç¹çš„ç‹¬ç«‹è¿›ç¨‹åŠ è½½è€—æ—¶ï¼Œä¹Ÿé¿å…äº†ä¸å®ˆæŠ¤è¿›ç¨‹é¢å¤–çš„é€šä¿¡ã€‚ å¦å¤–ï¼Œå†…ç½®çš„ç¼“å­˜èƒ½å¤Ÿæ›´å¥½çš„æ”¯æŒè·¨å¹³å°ï¼ŒWindows ä¸Š msvc ä¹Ÿèƒ½å¤Ÿå¾ˆå¥½çš„æ”¯æŒï¼Œè€Œ ccache ä»…ä»…æ”¯æŒ gcc/clangã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ç¦ç”¨ç¼“å­˜ã€‚ ```bash $ xmake f ccache n ``` æ³¨ï¼šä¸ç®¡æ˜¯å¦ä½¿ç”¨å†…ç½®æœ¬åœ°ç¼“å­˜ï¼Œé…ç½®åéƒ½æ˜¯ ` ccache `ï¼Œæ„æ€æ˜¯ c/c++ æ„å»ºç¼“å­˜ï¼Œè€Œä¸ä»…ä»…æ˜¯æŒ‡ ccache å·¥å…·çš„åå­—ã€‚ æˆ‘ä»¬å¦‚æœæƒ³ç»§ç»­ä½¿ç”¨å¤–ç½®çš„å…¶ä»–ç¼“å­˜å·¥å…·ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥é…ç½®ã€‚ ```bash $ xmake f ccache n cxx \"ccache gcc\" cc \"ccache gcc\" $ xmake ``` ## è¿œç¨‹ç¼–è¯‘ç¼“å­˜ é™¤äº†æœ¬åœ°ç¼“å­˜ï¼Œæˆ‘ä»¬ä¹Ÿæä¾›äº†è¿œç¨‹ç¼“å­˜æœåŠ¡ï¼Œç±»ä¼¼ mozilla çš„ sscacheï¼Œå¦‚æœåªæ˜¯ä¸ªäººå¼€å‘ï¼Œå¹³å¸¸ä¸ä¼šç”¨åˆ°å®ƒã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ˜¯å…¬å¸å†…éƒ¨å¤šäººååŒå¼€å‘ä¸€ä¸ªå¤§å‹é¡¹ç›®ï¼Œä»…ä»…é åˆ†å¸ƒå¼ç¼–è¯‘å’Œæœ¬åœ°ç¼“å­˜ï¼Œæ˜¯ä¸å¤Ÿçš„ã€‚æˆ‘ä»¬è¿˜éœ€è¦å¯¹ç¼–è¯‘çš„å¯¹è±¡æ–‡ä»¶ç¼“å­˜åˆ°ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œå…±äº«ã€‚ è¿™æ ·ï¼Œå…¶ä»–äººå³ä½¿é¦–æ¬¡ç¼–è¯‘ï¼Œä¹Ÿä¸éœ€è¦æ¯æ¬¡éƒ½å»åˆ†å¸ƒå¼ç¼–è¯‘å®ƒï¼Œç›´æ¥ä»è¿œç¨‹æ‹‰å–ç¼“å­˜æ¥åŠ é€Ÿç¼–è¯‘ã€‚ å¦å¤–ï¼ŒXmake æä¾›çš„è¿œç¨‹ç¼“å­˜æœåŠ¡ï¼Œä¹Ÿæ˜¯å…¨å¹³å°æ”¯æŒçš„ï¼Œä¸ä»…æ”¯æŒ gcc/clang è¿˜æ”¯æŒ msvcã€‚ ### å¼€å¯æœåŠ¡ æˆ‘ä»¬å¯ä»¥æŒ‡å®š ` ccache` å‚æ•°æ¥å¼€å¯è¿œç¨‹ç¼–è¯‘ç¼“å­˜æœåŠ¡ï¼Œå½“ç„¶å¦‚æœä¸æŒ‡å®šè¿™ä¸ªå‚æ•°ï¼Œxmake ä¼šé»˜è®¤å¼€å¯æ‰€æœ‰æœåŠ¡ç«¯é…ç½®çš„æœåŠ¡ã€‚ ```console $ xmake service ccache <remote_cache_server>: listening 0.0.0.0:9092 .. ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼€å¯æœåŠ¡çš„åŒæ—¶ï¼Œå›æ˜¾è¯¦ç»†æ—¥å¿—ä¿¡æ¯ã€‚ ```console $ xmake service ccache vD <remote_cache_server>: listening 0.0.0.0:9092 .. ``` ### ä»¥ Daemon æ¨¡å¼å¼€å¯æœåŠ¡ ```console $ xmake service ccache start $ xmake service ccache restart $ xmake service ccache stop ``` ### é…ç½®æœåŠ¡ç«¯ æˆ‘ä»¬é¦–å…ˆï¼Œè¿è¡Œ `xmake service` å‘½ä»¤ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ `server.conf` é…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨åˆ° `~/.xmake/service/server.conf`ã€‚ ```bash $ xmake service generating the config file to /Users/ruki/.xmake/service/server.conf .. an token(590234653af52e91b9e438ed860f1a2b) is generated, we can use this token to connect service. generating the config file to /Users/ruki/.xmake/service/client.conf .. <remote_cache_server>: listening 0.0.0.0:9692 .. ``` ç„¶åï¼Œæˆ‘ä»¬ç¼–è¾‘å®ƒï¼Œä¿®å¤æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ï¼ˆå¯é€‰ï¼‰ã€‚ ```bash $ cat ~/.xmake/service/server.conf { distcc_build { listen \"0.0.0.0:9692\", workdir \"/Users/ruki/.xmake/service/server/remote_cache\" }, known_hosts { }, logfile \"/Users/ruki/.xmake/service/server/logs.txt\", tokens { \"590234653af52e91b9e438ed860f1a2b\" } } ``` ### é…ç½®å®¢æˆ·ç«¯ å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶åœ¨ `~/.xmake/service/client.conf`ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢é…ç½®å®¢æˆ·ç«¯éœ€è¦è¿æ¥çš„æœåŠ¡å™¨åœ°å€ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨ hosts åˆ—è¡¨é‡Œé¢é…ç½®å¤šä¸ªæœåŠ¡å™¨åœ°å€ï¼Œä»¥åŠå¯¹åº”çš„ tokenã€‚ ```console $cat ~/.xmake/service/client.conf { remote_cache { connect \"127.0.0.1:9692, token \"590234653af52e91b9e438ed860f1a2b\" } } } ``` #### é…ç½®è¶…æ—¶ é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯è¿æ¥ï¼Œæ”¶å‘æ•°æ®éƒ½æ˜¯æ— é™ç­‰å¾…ä¸è¶…æ—¶çš„ï¼Œä½†æ˜¯å¦‚æœè®¿é—®æœåŠ¡ç«¯çš„ç½‘ç»œä¸ç¨³å®šï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¼šå¯¼è‡´è®¿é—®å¡æ­»ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥é…ç½®è¶…æ—¶æ¥è§£å†³ã€‚ å¦‚æœå‘ç”Ÿè¶…æ—¶å¼‚å¸¸ï¼Œå°±ä¼šè‡ªåŠ¨é€€åŒ–åˆ°æœ¬åœ°ç¼“å­˜ï¼Œä¸ä¼šæ°¸è¿œå¡æ­»ã€‚ æˆ‘ä»¬å¯ä»¥é…ç½®ï¼Œ`send_timeout`, `recv_timeout` å’Œ `connect_timeout` ä¸‰ç§è¶…æ—¶ï¼Œå¦‚æœåœ¨æ ¹èŠ‚ç‚¹è®¾ç½®ï¼Œé‚£ä¹ˆæ‰€æœ‰å®¢æˆ·ç«¯æœåŠ¡éƒ½ä¼šç”Ÿæ•ˆã€‚ ```console $ cat ~/.xmake/service/client.conf { send_timeout 5000, recv_timeout 5000, connect_timeout 5000 } ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»…ä»…é’ˆå¯¹å½“å‰è¿œç¨‹ç¼“å­˜æœåŠ¡é…ç½®è¶…æ—¶ï¼Œå…¶ä»–æœåŠ¡è¿˜æ˜¯é»˜è®¤è¶…æ—¶ã€‚ ```console $ cat ~/.xmake/service/client.conf { distcc_build { send_timeout 5000, recv_timeout 5000, connect_timeout 5000, } } ``` > æœåŠ¡ç«¯é…ç½®åŒæ ·æ”¯æŒè¶…æ—¶é…ç½®ã€‚ ### ç”¨æˆ·è®¤è¯å’Œæˆæƒ å…³äºç”¨æˆ·è®¤è¯å’Œæˆæƒï¼Œå¯ä»¥å‚è€ƒ [è¿œç¨‹ç¼–è¯‘ / ç”¨æˆ·è®¤è¯å’Œæˆæƒ](/#/zh cn/guide/other_features?id %e7%94%a8%e6%88%b7%e8%ae%a4%e8%af%81%e5%92%8c%e6%8e%88%e6%9d%83) é‡Œé¢çš„è¯¦ç»†è¯´æ˜ï¼Œç”¨æ³•æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚ ### è¿æ¥æœåŠ¡å™¨ é…ç½®å®Œè®¤è¯å’ŒæœåŠ¡å™¨åœ°å€åï¼Œå°±å¯ä»¥è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œå°†å½“å‰å·¥ç¨‹è¿æ¥åˆ°é…ç½®çš„æœåŠ¡å™¨ä¸Šäº†ã€‚ æˆ‘ä»¬éœ€è¦åœ¨è¿æ¥æ—¶å€™ï¼Œè¾“å…¥ ` ccache`ï¼ŒæŒ‡å®šä»…ä»…è¿æ¥è¿œç¨‹ç¼–è¯‘ç¼“å­˜æœåŠ¡ã€‚ ```bash $ cd projectdir $ xmake service connect ccache <client>: connect 127.0.0.1:9692 .. <client>: 127.0.0.1:9692 connected! ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶è¿æ¥å¤šä¸ªæœåŠ¡ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼ç¼–è¯‘å’Œè¿œç¨‹ç¼–è¯‘ç¼“å­˜æœåŠ¡ã€‚ ```hash $ xmake service connect distcc ccache ``` > å¦‚æœä¸å¸¦ä»»ä½•å‚æ•°ï¼Œé»˜è®¤è¿æ¥çš„æ˜¯è¿œç¨‹ç¼–è¯‘æœåŠ¡ã€‚ ### æ–­å¼€è¿æ¥ ```bash $ xmake service disconnect ccache ``` ### æ¸…ç†æœåŠ¡å™¨ç¼“å­˜ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œæ¸…ç†å½“å‰å·¥ç¨‹å¯¹åº”çš„è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ç¼“å­˜ã€‚ ```bash $ xmake service clean ccache ``` è€Œå¦‚æœæˆ‘ä»¬æ‰§è¡Œ `xmake clean all`ï¼Œåœ¨è¿æ¥äº†è¿œç¨‹æœåŠ¡çš„çŠ¶æ€ä¸‹ï¼Œä¹Ÿä¼šå»è‡ªåŠ¨æ¸…ç†æ‰€æœ‰çš„ç¼“å­˜ã€‚ ### ä¸€äº›å†…éƒ¨ä¼˜åŒ– 1. æ‹‰å–è¿œç¨‹ç¼“å­˜çš„å¿«ç…§ï¼Œé€šè¿‡ bloom filter + lz4 å›ä¼ æœ¬åœ°åï¼Œç”¨äºå¿«é€Ÿåˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œé¿å…é¢‘ç¹çš„æŸ¥è¯¢æœåŠ¡ç«¯ç¼“å­˜ä¿¡æ¯ 2. é…åˆæœ¬åœ°ç¼“å­˜ï¼Œå¯ä»¥é¿å…é¢‘ç¹åœ°è¯·æ±‚è¿œç¨‹æœåŠ¡å™¨ï¼Œæ‹‰å–ç¼“å­˜ã€‚ 3. å†…éƒ¨çŠ¶æ€ç»´æŠ¤ï¼Œç›¸æ¯” sscache ç­‰ç‹¬ç«‹å·¥å…·ï¼Œé¿å…äº†é¢‘ç¹çš„ç‹¬ç«‹è¿›ç¨‹åŠ è½½è€—æ—¶ï¼Œä¹Ÿé¿å…äº†ä¸å®ˆæŠ¤è¿›ç¨‹é¢å¤–çš„é€šä¿¡"},"/get_started/zh/xrepo/usage.html":{"title":"","content":" class: heading_no_counter # xrepo xrepo æ˜¯ä¸€ä¸ªåŸºäº [Xmake](https://github.com/xmake io/xmake) çš„è·¨å¹³å° C/C++ åŒ…ç®¡ç†å™¨ã€‚ å®ƒåŸºäº xmake æä¾›çš„è¿è¡Œæ—¶ï¼Œä½†å´æ˜¯ä¸€ä¸ªå®Œæ•´ç‹¬ç«‹çš„åŒ…ç®¡ç†ç¨‹åºï¼Œç›¸æ¯” vcpkg/homebrew æ­¤ç±»åŒ…ç®¡ç†å™¨ï¼Œxrepo èƒ½å¤ŸåŒæ—¶æä¾›æ›´å¤šå¹³å°å’Œæ¶æ„çš„ C/C++ åŒ…ã€‚ å¹¶ä¸”è¿˜æ”¯æŒå¤šç‰ˆæœ¬è¯­ä¹‰é€‰æ‹©ï¼Œå¦å¤–å®ƒè¿˜æ˜¯ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„åˆ†å¸ƒå¼ä»“åº“ï¼Œä¸ä»…ä»…æä¾›äº†å®˜æ–¹çš„ [xmake repo](https://github.com/xmake io/xmake repo) ä»“åº“ï¼Œè¿˜æ”¯æŒç”¨æˆ·è‡ªå»ºå¤šä¸ªç§æœ‰ä»“åº“ã€‚ åŒæ—¶ï¼Œxrepo ä¹Ÿæ”¯æŒä» vcpkg/homebrew/conan ç­‰ç¬¬ä¸‰æ–¹åŒ…ç®¡ç†å™¨ä¸­å®‰è£…åŒ…ï¼Œå¹¶æä¾›ç»Ÿä¸€ä¸€è‡´çš„åº“é“¾æ¥ä¿¡æ¯ï¼Œæ–¹ä¾¿ä¸ç¬¬ä¸‰æ–¹é¡¹ç›®çš„é›†æˆå¯¹æ¥ã€‚ ## å®‰è£… æˆ‘ä»¬åªéœ€è¦å®‰è£…ä¸Š xmake å°±å¯ä»¥ä½¿ç”¨ xrepo å‘½ä»¤ã€‚ ## æ”¯æŒå¹³å° * macOS (i386, x86_64, arm64) * Linux (i386, x86_64, cross toolchains ..) * BSD (i386, x86_64) * Android (x86, x86_64, armeabi, armeabi v7a, arm64 v8a) * iOS (armv7, armv7s, arm64, i386, x86_64) * Cross Toolchains ## åˆ†å¸ƒå¼ä»“åº“æ”¯æŒ é™¤äº†å¯ä»¥ç›´æ¥ä»å®˜æ–¹ä»“åº“ï¼š[xmake repo](https://github.com/xmake io/xmake repo) æ£€ç´¢å®‰è£…åŒ…ä¹‹å¤–ï¼Œ æˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ ä»»æ„å¤šä¸ªè‡ªå»ºçš„ä»“åº“ï¼Œç”šè‡³å¯ä»¥å®Œå…¨éš”ç¦»å¤–ç½‘ï¼Œä»…ä»…åœ¨å…¬å¸å†…éƒ¨ç½‘ç»œç»´æŠ¤ç§æœ‰åŒ…çš„å®‰è£…é›†æˆã€‚ åªéœ€è¦é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œæ·»åŠ ä¸Šè‡ªå·±çš„ä»“åº“åœ°å€ï¼š ```console $ xrepo add repo myrepo https://github.com/mygroup/myrepo ``` ## ä¸ xmake çš„å·¥ç¨‹æ— ç¼é›†æˆ ```lua add_requires(\"tbox>1.6.1\", \"libuv master\", \"vcpkg::ffmpeg\", \"brew::pcre2/libpcre2 8\") add_requires(\"conan::openssl/1.1.1g\", {alias \"openssl\", optional true, debug true}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"tbox\", \"libuv\", \"vcpkg::ffmpeg\", \"brew::pcre2/libpcre2 8\", \"openssl\") end) ``` ä¸‹é¢æ˜¯ä¸ xmake é›†æˆçš„æ•´ä½“æ¶æ„å’Œç¼–è¯‘æµç¨‹ã€‚ <img src \"https://xmake.io/assets/img/index/package_arch.png\" width \"650px\" /> ## å¿«é€Ÿä¸Šæ‰‹ ### å®‰è£…åŒ… #### åŸºæœ¬ä½¿ç”¨ ```bash $ xrepo install zlib tbox ``` #### å®‰è£…æŒ‡å®šç‰ˆæœ¬åŒ… å®Œæ•´æ”¯æŒ Semantic Versioning (è¯­ä¹‰ç‰ˆæœ¬)ã€‚ ```bash $ xrepo install \"zlib 1.2.x\" $ xrepo install \"zlib > 1.2.0\" ``` #### å®‰è£…æŒ‡å®šå¹³å°åŒ… ```bash $ xrepo install p iphoneos a arm64 zlib $ xrepo install p android [ ndk /xxx] zlib $ xrepo install p mingw [ mingw /xxx] zlib $ xrepo install p cross sdk /xxx/arm linux musleabi cross zlib ``` #### å®‰è£…è°ƒè¯•ç‰ˆæœ¬åŒ… ```bash $ xrepo install m debug zlib ``` #### å®‰è£…åŠ¨æ€åº“ç‰ˆæœ¬åŒ… ```bash $ xrepo install k shared zlib ``` #### å®‰è£…æŒ‡å®šé…ç½®åŒ… ```bash $ xrepo install f \"vs_runtime 'MD'\" zlib $ xrepo install f \"regex true,thread true\" boost ``` #### å®‰è£…ç¬¬ä¸‰æ–¹åŒ…ç®¡ç†å™¨çš„åŒ… ```bash $ xrepo install brew::zlib $ xrepo install vcpkg::zlib $ xrepo install conan::zlib/1.2.11 ``` ### æŸ¥æ‰¾åŒ…çš„åº“ä½¿ç”¨ä¿¡æ¯ ```bash $ xrepo fetch pcre2 { { linkdirs { \"/usr/local/Cellar/pcre2/10.33/lib\" }, links { \"pcre2 8\" }, defines { \"PCRE2_CODE_UNIT_WIDTH 8\" }, includedirs \"/usr/local/Cellar/pcre2/10.33/include\" } } ``` ```bash $ xrepo fetch ldflags openssl L/Users/ruki/.xmake/packages/o/openssl/1.1.1/d639b7d6e3244216b403b39df5101abf/lib lcrypto lssl ``` ```bash $ xrepo fetch cflags openssl I/Users/ruki/.xmake/packages/o/openssl/1.1.1/d639b7d6e3244216b403b39df5101abf/include ``` ```bash $ xrepo fetch p [iphoneosandroid] cflags \"zlib 1.2.x\" I/Users/ruki/.xmake/packages/z/zlib/1.2.11/df72d410e7e14391b1a4375d868a240c/include ``` ```bash $ xrepo fetch cflags ldflags conan::zlib/1.2.11 I/Users/ruki/.conan/data/zlib/1.2.11/_/_/package/f74366f76f700cc6e991285892ad7a23c30e6d47/include L/Users/ruki/.conan/data/zlib/1.2.11/_/_/package/f74366f76f700cc6e991285892ad7a23c30e6d47/lib lz ``` ### å¯¼å‡ºå®‰è£…åçš„åŒ… xrepo å¯ä»¥å¿«é€Ÿå¯¼å‡ºå·²ç»å®‰è£…åçš„åŒ…ï¼ŒåŒ…æ‹¬å¯¹åº”çš„åº“æ–‡ä»¶ï¼Œå¤´æ–‡ä»¶ç­‰ç­‰ã€‚ ```bash $ xrepo export o /tmp/output zlib ``` ### æœç´¢æ”¯æŒçš„åŒ… ```bash $ xrepo search zlib \"pcr*\" zlib: > zlib: A Massively Spiffy Yet Delicately Unobtrusive Compression Library (in xmake repo) pcr*: > pcre2: A Perl Compatible Regular Expressions Library (in xmake repo) > pcre: A Perl Compatible Regular Expressions Library (in xmake repo) ``` ### æŸ¥çœ‹åŒ…ç¯å¢ƒä¿¡æ¯ ```bash $ xrepo env show luajit { OLDPWD \"/mnt/tbox\", HOME \"/home/ruki\", PATH \"/home/ruki/.xmake/packages/l/luajit/2.1.0 beta3/fbac76d823b844f0b91abf3df0a3bc61/bin:/tmp:/tmp/arm linux musleabi cross/bin:~/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\", TERM \"xterm\", PWD \"/mnt/xmake\", XMAKE_PROGRAM_DIR \"/mnt/xmake/xmake\", HOSTNAME \"e6edd61ff1ab\", LD_LIBRARY_PATH \"/home/ruki/.xmake/packages/l/luajit/2.1.0 beta3/fbac76d823b844f0b91abf3df0a3bc61/lib\", SHLVL \"1\", _ \"/mnt/xmake/scripts/xrepo.sh\" } ``` ### åŒ…è™šæ‹Ÿç¯å¢ƒ #### è¿›å…¥è™šæ‹Ÿç¯å¢ƒ æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæ·»åŠ  xmake.lua æ–‡ä»¶ï¼Œå®šåˆ¶åŒ–ä¸€äº›åŒ…é…ç½®ï¼Œç„¶åè¿›å…¥ç‰¹å®šçš„åŒ…è™šæ‹Ÿç¯å¢ƒã€‚ ```lua add_requires(\"zlib 1.2.11\") add_requires(\"python 3.x\", \"luajit\") ``` ```bash $ xrepo env shell > python version > luajit version ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ xmake.lua é…ç½®åŠ è½½å¯¹åº”çš„å·¥å…·é“¾ç¯å¢ƒï¼Œæ¯”å¦‚åŠ è½½ vs çš„ç¼–è¯‘ç¯å¢ƒã€‚ ```lua set_toolchains(\"msvc\") ``` #### ç®¡ç†è™šæ‹Ÿç¯å¢ƒ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼ŒæŠŠæŒ‡å®šçš„è™šæ‹Ÿç¯å¢ƒé…ç½®å…¨å±€æ³¨å†Œåˆ°ç³»ç»Ÿä¸­ï¼Œæ–¹ä¾¿å¿«é€Ÿåˆ‡æ¢ã€‚ ```bash $ xrepo env add /tmp/base.lua ``` è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¿å­˜äº†ä¸€ä¸ªåå« base çš„å…¨å±€è™šæ‹Ÿç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ list å‘½ä»¤å»æŸ¥çœ‹å®ƒã€‚ ```bash $ xrepo env list /Users/ruki/.xmake/envs: base envs(1) found! ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ é™¤å®ƒã€‚ ```bash $ xrepo env remove base ``` #### åˆ‡æ¢å…¨å±€è™šæ‹Ÿç¯å¢ƒ å¦‚æœæˆ‘ä»¬æ³¨å†Œäº†å¤šä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¿«é€Ÿåˆ‡æ¢å®ƒä»¬ã€‚ ```bash $ xrepo env b base shell > python version ``` æˆ–è€…ç›´æ¥åŠ è½½æŒ‡å®šè™šæ‹Ÿç¯å¢ƒè¿è¡Œç‰¹å®šå‘½ä»¤ ```bash $ xrepo env b base python version ``` `xrepo env b/ bind` å°±æ˜¯ç»‘å®šæŒ‡å®šçš„è™šæ‹Ÿç¯å¢ƒï¼Œæ›´å¤šè¯¦æƒ…è§ï¼š[#1762](https://github.com/xmake io/xmake/issues/1762) #### å¿«é€Ÿåˆ‡æ¢ä¸´æ—¶è™šæ‹Ÿç¯å¢ƒ æˆ‘ä»¬ä¸ä»…å¯ä»¥é€šè¿‡é…ç½® `myenv.lua` ç­‰ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼Œæ¥ç®¡ç†åˆ‡æ¢ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸´æ—¶æŒ‡å®šéœ€è¦ç»‘å®šçš„ç¯å¢ƒåŒ…åˆ—è¡¨ï¼Œå®ç°å¿«é€Ÿåˆ‡æ¢ï¼Œæ— éœ€ä»»ä½•é…ç½®ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³è¿›å…¥ä¸€ä¸ªå¸¦æœ‰ python 3.0, luajit å’Œ cmake çš„ç¯å¢ƒï¼Œåªéœ€è¦æ‰§è¡Œï¼š ```bash $ xrepo env b \"python 3.x,luajit,cmake\" shell [python,luajit,cmake] $ python version Python 3.10.6 [python,luajit,cmake] $ cmake version cmake version 3.25.3 ``` xmake ä¼šè‡ªåŠ¨å®‰è£…ç›¸å…³ä¾èµ–ï¼Œç„¶åå¼€å¯ä¸€ä¸ªæ–°çš„ shell ç¯å¢ƒï¼Œæ–°ç¯å¢ƒç»ˆç«¯å·¦è¾¹ä¹Ÿæœ‰ prompt æç¤ºã€‚ å¦‚æœæˆ‘ä»¬æƒ³é€€å‡ºå½“å‰ç¯å¢ƒï¼Œä»…ä»…éœ€è¦æ‰§è¡Œ ```bash [python,luajit,cmake] $ xrepo env quit $ ``` ### æŸ¥çœ‹åŒ…ä¿¡æ¯ ```bash $ xrepo info zlib The package info of project: require(zlib): > description: A Massively Spiffy Yet Delicately Unobtrusive Compression Library > version: 1.2.11 > urls: > http://zlib.net/zlib 1.2.11.tar.gz > c3e5e9fdd5004dcb542feda5ee4f0ff0744628baf8ed2dd5d66f8ca1197cb1a1 > https://downloads.sourceforge.net/project/libpng/zlib/1.2.11/zlib 1.2.11.tar.gz > c3e5e9fdd5004dcb542feda5ee4f0ff0744628baf8ed2dd5d66f8ca1197cb1a1 > repo: xmake repo https://gitee.com/tboox/xmake repo.git master > cachedir: /Users/ruki/.xmake/cache/packages/2010/z/zlib/1.2.11 > installdir: /Users/ruki/.xmake/packages/z/zlib/1.2.11/d639b7d6e3244216b403b39df5101abf > searchdirs: > searchnames: zlib 1.2.11.tar.gz > fetchinfo: 1.2.11, system > version: 1.2.11 > links: z > linkdirs: /usr/local/Cellar/zlib/1.2.11/lib > includedirs: /usr/local/Cellar/zlib/1.2.11/include > platforms: iphoneos, mingw@windows, macosx, mingw@linux,macosx, android@linux,macosx, windows, linux > requires: > plat: macosx > arch: x86_64 > configs: > debug: false > vs_runtime: MT > shared: false > configs: > configs (builtin): > debug: Enable debug symbols. (default: false) > shared: Enable shared library. (default: false) > cflags: Set the C compiler flags. > cxflags: Set the C/C++ compiler flags. > cxxflags: Set the C++ compiler flags. > asflags: Set the assembler flags. > vs_runtime: Set vs compiler runtime. (default: MT) > values: {\"MT\",\"MD\"} ``` ### ä¸‹è½½åŒ…æºç  æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `xrepo download` å‘½ä»¤ï¼Œä»…ä»…ä¸‹è½½æŒ‡å®šåŒ…çš„æºç ï¼Œè€Œä¸å»å®‰è£…å®ƒã€‚ ```bash $ xrepo download zlib $ xrepo download \"zlib 2.x\" ``` é»˜è®¤çš„ä¸‹è½½ç›®å½•å°±æ˜¯å½“å‰çš„ç›®å½•ä¸‹ `packages` å­ç›®å½•ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ ` o outputdir` å‚æ•°ä¿®æ”¹ä¸‹è½½ç›®å½•ã€‚ ```bash $ xrepo download o /tmp zlib ```"},"/get_started/zh/package/local-3rd-source-package.html":{"title":"","content":" class: heading_no_counter # ç»§æ‰¿æœ¬åœ°ç¬¬ä¸‰æ–¹æºç åº“ ## é›†æˆ CMake ä»£ç åº“ æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ xmake çš„åŒ…æ¨¡å¼ç›´æ¥é›†æˆè‡ªå·±é¡¹ç›®ä¸­å¸¦æœ‰ CMakeLists.txt çš„ä»£ç åº“ï¼Œè€Œä¸æ˜¯é€šè¿‡è¿œç¨‹ä¸‹è½½å®‰è£…ã€‚ ç›¸å…³ issues: [#1714](https://github.com/xmake io/xmake/issues/1714) ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹é¡¹ç›®ç»“æ„ï¼š ``` â”œâ”€â”€ foo â”‚Â Â  â”œâ”€â”€ CMakeLists.txt â”‚Â Â  â””â”€â”€ src â”‚Â Â  â”œâ”€â”€ foo.c â”‚Â Â  â””â”€â”€ foo.h â”œâ”€â”€ src â”‚Â Â  â””â”€â”€ main.c â”œâ”€â”€ test.lua â””â”€â”€ xmake.lua ``` foo ç›®å½•ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ cmake ç»´æŠ¤çš„é™æ€åº“ï¼Œè€Œæ ¹ç›®å½•ä¸‹ä½¿ç”¨äº† xmake æ¥ç»´æŠ¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ xmake.lua ä¸­é€šè¿‡å®šä¹‰ `package(\"foo\")` åŒ…æ¥æè¿°å¦‚ä½•æ„å»º foo ä»£ç åº“ã€‚ ```lua add_rules(\"mode.debug\", \"mode.release\") package(\"foo\", function() add_deps(\"cmake\") set_sourcedir(path.join(os.scriptdir(), \"foo\")) on_install(function (package) local configs {} table.insert(configs, \" DCMAKE_BUILD_TYPE \" .. (package:debug() and \"Debug\" or \"Release\")) table.insert(configs, \" DBUILD_SHARED_LIBS \" .. (package:config(\"shared\") and \"ON\" or \"OFF\")) import(\"package.tools.cmake\").install(package, configs) end) on_test(function (package) assert(package:has_cfuncs(\"add\", {includes \"foo.h\"})) end) end) add_requires(\"foo\") target(\"demo\") set_kind(\"binary\") add_files(\"src/main.c\") add_packages(\"foo\") ``` å…¶ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ `set_sourcedir()` æ¥è®¾ç½® foo åŒ…çš„ä»£ç ç›®å½•ä½ç½®ï¼Œç„¶åé€šè¿‡ import å¯¼å…¥ `package.tools.cmake` è¾…åŠ©æ¨¡å—æ¥è°ƒç”¨ cmake æ„å»ºä»£ç ï¼Œxmake ä¼šè‡ªåŠ¨è·å–ç”Ÿæˆçš„ libfoo.a å’Œå¯¹åº”çš„å¤´æ–‡ä»¶ã€‚ > å¦‚æœä»…ä»…æœ¬åœ°æºç é›†æˆï¼Œæˆ‘ä»¬ä¸éœ€è¦é¢å¤–è®¾ç½® `add_urls` å’Œ `add_versions`ã€‚ å…³äºåŒ…çš„é…ç½®æè¿°ï¼Œè¯¦æƒ…è§ï¼š[åŒ…æè¿°è¯´æ˜](https://xmake.io/#/zh cn/package/remote_package?id %e5%8c%85%e6%8f%8f%e8%bf%b0%e8%af%b4%e6%98%8e) å®šä¹‰å®ŒåŒ…åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ `add_requires(\"foo\")` å’Œ `add_packages(\"foo\")` æ¥é›†æˆä½¿ç”¨å®ƒäº†ï¼Œå°±è·Ÿé›†æˆè¿œç¨‹åŒ…ä¸€æ ·çš„ä½¿ç”¨æ–¹å¼ã€‚ å¦å¤–ï¼Œ`on_test` æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæƒ³è¦ä¸¥æ ¼æ£€æµ‹åŒ…çš„ç¼–è¯‘å®‰è£…æ˜¯å¦æˆåŠŸï¼Œå¯ä»¥åœ¨é‡Œé¢åšä¸€äº›æµ‹è¯•ã€‚ å®Œæ•´ä¾‹å­è§ï¼š[Library with CMakeLists](https://github.com/xmake io/xmake/tree/master/tests/projects/c/library_with_cmakelists) ## é›†æˆ Meson ä»£ç åº“ xmake æ”¯æŒé›†æˆæ›´å¤šå…¶ä»–æ„å»ºç³»ç»Ÿç»´æŠ¤çš„ç¬¬ä¸‰æ–¹æºç åº“ï¼Œæ¯”å¦‚ mesonï¼Œä»…ä»…åªéœ€è¦å¯¼å…¥ä½¿ç”¨ `package.tools.meson` è¾…åŠ©æ„å»ºæ¨¡å—è°ƒç”¨ meson æ¥æ„å»ºå®ƒä»¬ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä» xmake repo ä»“åº“ä¸­æŒ‘é€‰ä¸€ä¸ªä½¿ç”¨ meson æ„å»ºçš„åŒ…ä½œä¸ºä¾‹å­ï¼š ```lua package(\"harfbuzz\", function() set_sourcedir(path.join(os.scriptdir(), \"3rd/harfbuzz\")) add_deps(\"meson\") if not is_plat(\"windows\") then add_deps(\"freetype\") end on_load(\"windows\", \"linux\", \"macosx\", function (package) if package:config(\"icu\") then package:add(\"deps\", \"icu4c\") end end) on_install(\"windows\", \"linux\", \"macosx\", function (package) local configs {\" Dtests disabled\", \" Ddocs disabled\", \" Dbenchmark disabled\", \" Dcairo disabled\", \" Dfontconfig disabled\", \" Dglib disabled\", \" Dgobject disabled\"} table.insert(configs, \" Ddefault_library \" .. (package:config(\"shared\") and \"shared\" or \"static\")) if package:is_plat(\"windows\") then table.insert(configs, \" Dfreetype disabled\") end import(\"package.tools.meson\").install(package, configs) end) on_test(function (package) assert(package:has_cfuncs(\"hb_buffer_add_utf8\", {includes \"harfbuzz/hb.h\"})) end) end) ``` ## é›†æˆ autoconf ä»£ç åº“ æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `package.tools.autoconf` æ¥æœ¬åœ°é›†æˆå¸¦æœ‰ autoconf ç»´æŠ¤çš„ç¬¬ä¸‰æ–¹ä»£ç åº“ã€‚ ```lua package(\"pcre2\", function() set_sourcedir(path.join(os.scriptdir(), \"3rd/pcre2\")) add_configs(\"jit\", {description \"Enable jit.\", default true, type \"boolean\"}) add_configs(\"bitwidth\", {description \"Set the code unit width.\", default \"8\", values {\"8\", \"16\", \"32\"}}) on_load(function (package) local bitwidth package:config(\"bitwidth\") or \"8\" package:add(\"links\", \"pcre2 \" .. bitwidth) package:add(\"defines\", \"PCRE2_CODE_UNIT_WIDTH \" .. bitwidth) if not package:config(\"shared\") then package:add(\"defines\", \"PCRE2_STATIC\") end end) on_install(\"macosx\", \"linux\", \"mingw\", function (package) local configs {} table.insert(configs, \" enable shared \" .. (package:config(\"shared\") and \"yes\" or \"no\")) table.insert(configs, \" enable static \" .. (package:config(\"shared\") and \"no\" or \"yes\")) if package:debug() then table.insert(configs, \" enable debug\") end if package:config(\"pic\") ~ false then table.insert(configs, \" with pic\") end if package:config(\"jit\") then table.insert(configs, \" enable jit\") end local bitwidth package:config(\"bitwidth\") or \"8\" if bitwidth ~ \"8\" then table.insert(configs, \" disable pcre2 8\") table.insert(configs, \" enable pcre2 \" .. bitwidth) end import(\"package.tools.autoconf\").install(package, configs) end) on_test(function (package) assert(package:has_cfuncs(\"pcre2_compile\", {includes \"pcre2.h\"})) end) end) ``` `package.tools.autoconf` å’Œ `package.tools.cmake` æ¨¡å—éƒ½æ˜¯å¯ä»¥æ”¯æŒ mingw/cross/iphoneos/android ç­‰äº¤å‰ç¼–è¯‘å¹³å°å’Œå·¥å…·é“¾çš„ï¼Œxmake ä¼šè‡ªåŠ¨ä¼ é€’å¯¹åº”çš„å·¥å…·é“¾è¿›å»ï¼Œç”¨æˆ·ä¸éœ€è¦åšä»»ä½•å…¶ä»–äº‹æƒ…ã€‚ ## é›†æˆ Scons ä»£ç åº“ æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `package.tools.scons` æ¥æœ¬åœ°é›†æˆå¸¦æœ‰ Scons ç»´æŠ¤çš„ç¬¬ä¸‰æ–¹ä»£ç åº“ã€‚ ```lua package(\"godotcpp\", function() set_sourcedir(path.join(os.scriptdir(), \"3rd/godotcpp\")) add_deps(\"scons\") add_includedirs(\"include\", \"include/core\", \"include/gen\") on_install(\"linux\", \"windows\", \"macosx\", \"mingw\", \"cygwin\", \"iphoneos\", \"android\", \"msys\", function (package) local configs {\"generate_bindings yes\"} table.insert(configs, \"bits \" .. ((package:is_arch(\"x64\") or package:is_arch(\"x86_64\")) and \"64\" or \"32\")) if package:is_plat(\"windows\") then io.replace(\"SConstruct\", \"/MD\", \"/\" .. package:config(\"vs_runtime\"), {plain true}) end this fixes an error on ios and osx (https://godotengine.org/qa/65616/problems compiling gdnative c example on osx) if package:is_plat(\"macosx\", \"iphoneos\") then io.replace(\"SConstruct\", \" std c++14\", \" std c++17\", {plain true}) end fix to use correct ranlib, @see https://github.com/godotengine/godot cpp/issues/510 if package:is_plat(\"android\") then io.replace(\"SConstruct\", [[env['AR'] toolchain + \"/bin/\" + arch_info['tool_path'] + \" ar\"]], [[env['AR'] toolchain + \"/bin/\" + arch_info['tool_path'] + \" ar\" env['RANLIB'] toolchain + \"/bin/\" + arch_info['tool_path'] + \" ranlib\"]], {plain true}) end import(\"package.tools.scons\").build(package, configs) os.cp(\"bin/*.\" .. (package:is_plat(\"windows\") and \"lib\" or \"a\"), package:installdir(\"lib\")) os.cp(\"include/core/*.hpp\", package:installdir(\"include/core\")) os.cp(\"include/gen/*.hpp\", package:installdir(\"include/gen\")) os.cp(\"godot headers/android\", package:installdir(\"include\")) os.cp(\"godot headers/arvr\", package:installdir(\"include\")) os.cp(\"godot headers/gdnative\", package:installdir(\"include\")) os.cp(\"godot headers/nativescript\", package:installdir(\"include\")) os.cp(\"godot headers/net\", package:installdir(\"include\")) os.cp(\"godot headers/pluginscript\", package:installdir(\"include\")) os.cp(\"godot headers/videodecoder\", package:installdir(\"include\")) os.cp(\"godot headers/*.h\", package:installdir(\"include\")) end) end) ``` ## é›†æˆ makefile ä»£ç åº“ ### ä½¿ç”¨ Nmake æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `package.tools.nmake` æ¥æœ¬åœ°é›†æˆå¸¦æœ‰ nmake ç»´æŠ¤çš„ç¬¬ä¸‰æ–¹ä»£ç åº“ã€‚ `nmake.install` ä¼šè‡ªåŠ¨ç»‘å®šå½“å‰ç”¨æˆ·çš„ msvc æ„å»ºç¯å¢ƒï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿé¡ºåˆ©è°ƒç”¨åˆ° nmake.exe ä»¥åŠ msbuild å’Œ cl.exe ç­‰ç¨‹åºã€‚ ```lua package(\"libxml2\", function() set_sourcedir(path.join(os.scriptdir(), \"3rd/libxml2\")) add_includedirs(\"include/libxml2\") if is_plat(\"windows\") then add_syslinks(\"wsock32\", \"ws2_32\") end on_load(\"windows\", function (package) if not package:config(\"shared\") then package:add(\"defines\", \"LIBXML_STATIC\") end end) on_install(\"windows\", function (package) os.cd(\"win32\") os.vrun(\"cscript configure.js iso8859x yes iconv no compiler msvc cruntime /%s debug %s prefix \\\"%s\\\"\", package:config(\"vs_runtime\"), package:debug() and \"yes\" or \"no\", package:installdir()) import(\"package.tools.nmake\").install(package, {\"/f\", \"Makefile.msvc\"}) os.tryrm(path.join(package:installdir(\"lib\"), \"libxml2_a_dll.lib\")) if package:config(\"shared\") then os.tryrm(path.join(package:installdir(\"lib\"), \"libxml2_a.lib\")) else os.tryrm(path.join(package:installdir(\"lib\"), \"libxml2.lib\")) os.tryrm(path.join(package:installdir(\"bin\"), \"libxml2.dll\")) end end) on_test(function (package) assert(package:has_cfuncs(\"xmlNewNode\", {includes {\"libxml/parser.h\", \"libxml/tree.h\"}})) end) end) ``` ### ä½¿ç”¨ GnuMake æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `package.tools.make` æ¥æœ¬åœ°é›†æˆå¸¦æœ‰ gnumake ç»´æŠ¤çš„ç¬¬ä¸‰æ–¹ä»£ç åº“ã€‚ ```lua package(\"openssl\", function() set_sourcedir(path.join(os.scriptdir(), \"3rd/openssl\")) add_links(\"ssl\", \"crypto\") if is_plat(\"linux\", \"cross\") then add_syslinks(\"dl\") end on_install(\"linux\", \"macosx\", function (package) https://wiki.openssl.org/index.php/Compilation_and_Installation#PREFIX_and_OPENSSLDIR os.vrun(\"./config %s openssldir \\\"%s\\\" prefix \\\"%s\\\"\", package:debug() and \" debug\" or \"\", package:installdir(), package:installdir()) import(\"package.tools.make\").install(package) end) on_test(function (package) assert(package:has_cfuncs(\"SSL_new\", {includes \"openssl/ssl.h\"})) end) end) ``` > æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ `os.vrunv(\"make\", {})` æ¥è°ƒç”¨ make/gmake ç¨‹åºæ¥æ„å»ºåº“ã€‚ ## é›†æˆ Gn ä»£ç åº“ æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `package.tools.gn` æ¥æœ¬åœ°é›†æˆå¸¦æœ‰ GN ç»´æŠ¤çš„ç¬¬ä¸‰æ–¹ä»£ç åº“ã€‚ ```lua package(\"skia\", function() set_sourcedir(path.join(os.scriptdir(), \"3rd/openssl\")) add_deps(\"gn\", \"ninja\") add_deps(\"python\", {kind \"binary\"}) on_install(\"linux\", \"macosx\", \"windows\", function (package) import(\"package.tools.gn\").install(package) end) on_test(function (package) TODO end) end) ``` è¿™é‡Œæœ‰å®Œæ•´çš„è„šæœ¬ä¾‹å­ï¼š[Skia with GN](https://github.com/xmake io/xmake repo/blob/master/packages/s/skia/xmake.lua)"},"/get_started/zh/package/script-scope.html":{"title":"","content":" class: heading_no_counter # è„šæœ¬åŸŸ æ­¤é¡µé¢æè¿°äº† [åŒ…ä¾èµ–ç®¡ç†](zh cn/manual/package_dependencies.html) çš„ `on_load()`ã€`on_install()` æˆ– `on_test()` ç­‰å‡½æ•°çš„ `package` æ¥å£ ## package:name è·å–åŒ…çš„åå­—ã€‚ ## package:get è·å–åŒ…åœ¨æè¿°åŸŸçš„é…ç½®å€¼ã€‚ ä»»ä½•åœ¨æè¿°åŸŸçš„ `set_xxx` å’Œ `add_xxx` é…ç½®å€¼éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£è·å–åˆ°ã€‚ ```lua get the dependencies package:get(\"deps\") get the links package:get(\"links\") get the defined macros package:get(\"defines\") ``` ## package:set è®¾ç½®åŒ…çš„é…ç½®å€¼ï¼Œï¼ˆå¦‚æœä½ æƒ³æ·»åŠ å€¼å¯ä»¥ç”¨ [package:add](#packageadd)ï¼‰ã€‚ ```lua set the dependencies package:set(\"deps\", \"python\") set the links package:set(\"links\", \"sdl2\") set the defined macros package:set(\"defines\", \"SDL_MAIN_HANDLED\") ``` ## package:add æŒ‰åç§°æ·»åŠ åˆ°åŒ…çš„å€¼ã€‚ ```lua add dependencies package:add(\"deps\", \"python\") add links package:add(\"links\", \"sdl2\") add defined macros package:add(\"defines\", \"SDL_MAIN_HANDLED\") ``` ## package:license è·å–åŒ…çš„è®¸å¯è¯ï¼ˆåŒ `package:get(\"license\")`ï¼‰ã€‚ ## package:description è·å–åŒ…çš„æè¿°ï¼ˆåŒ `package:get(\"description\")`ï¼‰ã€‚ ## package:plat è·å–åŒ…çš„å¹³å°ã€‚ å¯ä»¥æ˜¯ä»¥ä¸‹ä»»ä½•ä¸€ç§ï¼š windows linux macosx android iphoneos watchos mingw cygwin bsd å¦‚æœåŒ…æ˜¯äºŒè¿›åˆ¶çš„ï¼Œåˆ™ä¼šè¿”å› [`os.host`](zh cn/manual/builtin_modules.md#oshost) çš„å€¼ã€‚ ## package:arch è·å–åŒ…çš„æ¶æ„ï¼ˆä¾‹å¦‚ x86ã€x64ã€x86_64ï¼‰ã€‚ å¦‚æœåŒ…æ˜¯äºŒè¿›åˆ¶çš„ï¼Œåˆ™è¿”å› [`os.arch`](zh cn/manual/builtin_modules.md#osarch)ã€‚ ## package:targetos è·å–åŒ…çš„ç›®æ ‡æ“ä½œç³»ç»Ÿï¼Œå¯ä»¥å…·æœ‰ä¸ [package:plat](#packageplat) ç›¸åŒçš„å€¼ã€‚ ## package:targetarch è·å–åŒ…çš„ç›®æ ‡æ¶æ„ï¼Œå¯ä»¥å…·æœ‰ä¸ [package:arch](#packagearch) ç›¸åŒçš„å€¼ã€‚ ## package:is_plat å½“å‰å¹³å°æ˜¯å¦æ˜¯ç»™å®šå¹³å°ä¹‹ä¸€ã€‚ ```lua Is the current platform android? package:is_plat(\"android\") Is the current platform windows, linux or macosx? package:is_plat(\"windows\", \"linux\", \"macosx\") ``` ## package:is_arch å½“å‰æ¶æ„æ˜¯å¦æ˜¯ç»™å®šæ¶æ„ä¹‹ä¸€ã€‚ ```lua Is the current architecture x86 package:is_arch(\"x86\") Is the current architecture x64 or x86_64 package:is_arch(\"x64\", \"x86_64\") ``` ## package:is_targetos å½“å‰ç›®æ ‡æ“ä½œç³»ç»Ÿæ˜¯å¦æ˜¯ç»™å®šæ“ä½œç³»ç»Ÿä¹‹ä¸€ã€‚ ```lua Is the currently targeted OS windows? package:is_targetos(\"windows\") Is the currently targeted OS android or iphoneos? package:is_targetos(\"android\", \"iphoneos\") ``` ## package:is_targetarch å½“å‰ç›®æ ‡æ¶æ„æ˜¯å¦æ˜¯ç»™å®šæ¶æ„ä¹‹ä¸€ã€‚ ```lua Is the currently targeted architecture x86 package:is_targetarch(\"x86\") Is the currently targeted architecture x64 or x86_64 package:is_targetarch(\"x64\", \"x86_64\") ``` ## package:alias è·å–åŒ…çš„åˆ«åã€‚ å¦‚æœç”¨æˆ·åƒè¿™æ ·è®¾ç½®åˆ«åï¼š ```lua add_requires(\"libsdl\", {alias \"sdl\"}) ``` é‚£ä¹ˆè¿™ä¸ªåˆ«åå¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£è·å–åˆ°ï¼š ```lua returns \"sdl\" package:alias() ``` ## package:urls è·å–åŒ…çš„ urls åˆ—è¡¨ã€‚ å¦‚æœæˆ‘ä»¬è®¾ç½®äº†å¦‚ä¸‹ URLsï¼š ```lua add_urls(\"https://example.com/library $(version).zip\") or so set_urls(\"https://example.com/library $(version).zip\") ``` é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ¥å£æ¥è·å–ï¼š ```lua returns the table {\"https://example.com/library $(version).zip\"} package:urls() ``` ## package:dep é€šè¿‡åç§°è·å–åŒ…çš„ä¾èµ–é¡¹ã€‚ è¯¥åç§°éœ€è¦æ˜¯åŒ…çš„ä¾èµ–é¡¹ã€‚ ```lua local python package:dep(\"python\") returns \"python\" python:name() ``` ## package:deps è·å–åŒ…çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚ ```lua prints the names of all dependencies for _,dep in pairs(package:deps()) do print(dep:name()) end ``` ## package:sourcehash è·å– URL åˆ«åçš„ sha256 æ ¡éªŒå’Œã€‚ å¦‚æœæ ¡éªŒå’Œæ˜¯è¿™æ ·æä¾›çš„ï¼š ```lua add_urls(\"https://example.com/library $(version).zip\", {alias \"example\"}) add_versions(\"example:2.4.1\", \"29f9983cc7196e882c4bc3d23d7492f9c47574c7cf658afafe7d00c185429941\") ``` æ‚¨å¯ä»¥åƒè¿™æ ·è·å–å®ƒï¼š ```lua returns \"29f9983cc7196e882c4bc3d23d7492f9c47574c7cf658afafe7d00c185429941\" package:sourcehash(\"example\") or so package:sourcehash(package:url_alias(package:urls()[1])) ``` ## package:kind è·å–åŒ…çš„ç±»å‹ã€‚ å¯ä»¥æ˜¯ä»¥ä¸‹ä»»ä½•ä¸€ç§ï¼š binary toolchain (is also binary) library (default) template [#2138](https://github.com/xmake io/xmake/issues/2138) headeronly ## package:is_binary åŒ…æ˜¯å¦ä¸ºäºŒè¿›åˆ¶ç±»å‹ã€‚ ## package:is_toolchain æŠ¥æ˜¯å¦ä¸ºå·¥å…·é“¾ç±»å‹ã€‚ ## package:is_library åŒ…æ˜¯å¦ä¸ºåº“ç±»å‹ã€‚ ## package:is_toplevel åŒ…æ˜¯å¦åœ¨ç”¨æˆ· xmake.lua é‡Œé¢é€šè¿‡ add_requires ç›´æ¥å¼•ç”¨ã€‚ ## package:is_thirdparty åŒ…æ˜¯å¦ç”±ç¬¬ä¸‰æ–¹åŒ…ç®¡ç†å™¨æä¾›ï¼ˆä¾‹å¦‚ brewã€conanã€vcpkgï¼‰ã€‚ ## package:is_debug åŒ…æ˜¯å¦ä»¥è°ƒè¯•æ¨¡å¼æ„å»ºï¼ˆåŒ `package:config(\"debug\")`ï¼‰ã€‚ ## package:is_supported å½“å‰å¹³å°å’Œæ¶æ„æ˜¯å¦æ”¯æŒè¯¥åŒ…ã€‚ ## package:debug åŒ…æ˜¯å¦ä½¿ç”¨è°ƒè¯•æ¨¡å¼æ„å»ºï¼ˆä¸æ¨èä½¿ç”¨ï¼šä½¿ç”¨ [`package:is_debug`](#packageis_debug) ä»£æ›¿ï¼‰ã€‚ ## package:is_cross åŒ…æ˜¯å¦æ­£åœ¨äº¤å‰ç¼–è¯‘ã€‚ ## package:cachedir è·å–åŒ…çš„ç¼“å­˜ç›®å½•ã€‚ ## package:installdir è·å–åŒ…çš„å®‰è£…ç›®å½•ã€‚ ä¹Ÿå¯ç”¨äºè·å–å­ç›®å½•ã€‚ å¦‚æœç»™å®šçš„ç›®å½•æ ‘ä¸å­˜åœ¨ï¼Œå®ƒå°†è¢«åˆ›å»ºã€‚ ```lua returns the installation directory package:installdir() returns the subdirectory include inside the installation directory package:installdir(\"include\") returns the subdirectory include/files package:installdir(\"include\", \"files\") ``` ## package:scriptdir è·å–åŒ…çš„ xmake.lua æ‰€åœ¨ç›®å½•ã€‚ ## package:envs è·å–åŒ…å¯¼å‡ºçš„ç¯å¢ƒå˜é‡ã€‚ ## package:getenv è·å–ç»™å®šçš„ç¯å¢ƒå˜é‡ã€‚ ```lua returns a table package:getenv(\"PATH\") ``` ## package:setenv è®¾ç½®ç»™å®šçš„ç¯å¢ƒå˜é‡ã€‚ è¦†ç›–å˜é‡ã€‚ ```lua sets PATH to {\"bin\", \"lib\"} package:setenv(\"PATH\", \"bin\", \"lib\") ``` ## package:addenv å°†ç»™å®šçš„å€¼æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ã€‚ ```lua adds \"bin\" and \"lib\" to PATH package:addenv(\"PATH\", \"bin\", \"lib\") ``` ## package:versions è·å–åŒ…çš„æ‰€æœ‰ç‰ˆæœ¬åˆ—è¡¨ã€‚ ## package:version è·å–åŒ…çš„ç‰ˆæœ¬ã€‚ å®ƒä¼šè¿”å›ä¸€ä¸ªè¯­ä¹‰ç‰ˆæœ¬å¯¹è±¡ï¼Œä¾¿äºåšç‰ˆæœ¬ä¹‹é—´çš„åˆ¤æ–­ã€‚ ```lua local version package:version() get the major version version:major() get the minor version version:minor() get the patch version version:patch() ``` ## package:version_str ä»¥å­—ç¬¦ä¸²å½¢å¼è·å–åŒ…çš„ç‰ˆæœ¬ã€‚ ## package:config è·å–åŒ…çš„ç»™å®šé…ç½®å€¼ã€‚ ```lua if configurations are set like so add_require(\"example\", {configs {enable_x true, value_y 6}}) these values can be retrieved like so returns true package:config(\"enable_x\") returns 6 package:config(\"value_y\") ``` ## package:config_set è®¾ç½®åŒ…çš„ç»™å®šé…ç½®å€¼ã€‚ ```lua package:config_set(\"enable_x\", true) package:config_set(\"value_y\", 6) ``` ## package:configs è·å–åŒ…çš„æ‰€æœ‰é…ç½®ã€‚ ```lua returns a table with the configuration names as keys and their values as values local configs package:configs() local enable_x configs[\"enable_x\"] local value_y configs[\"value_y\"] ``` ## package:buildhash è·å–åŒ…çš„æ„å»ºå“ˆå¸Œã€‚ å®ƒç¡®ä¿æ¯ä¸ªåŒ…ï¼Œä¸åŒçš„é…ç½®å®‰è£…åˆ°å”¯ä¸€çš„è·¯å¾„ä¸‹ï¼Œç›¸äº’ä¹‹é—´ä¸å†²çªã€‚ ## package:patches è·å–å½“å‰ç‰ˆæœ¬çš„æ‰€æœ‰è¡¥ä¸ ```lua returns a table with all patches local patches package:patches() each element contains the keys \"url\" and \"sha256\" local url patches[1][\"url\"] local sha256 patches[1][\"sha256\"] ``` ## package:has_cfuncs æ£€æµ‹åŒ…æ˜¯å¦å…·æœ‰ç»™å®šçš„ C å‡½æ•°ã€‚ è¿™åº”è¯¥åœ¨ `on_test` ä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ```lua on_test(function (package) assert(package:has_cfuncs(\"foo\")) you can also add configs assert(package:has_cfuncs(\"bar\", {includes \"foo_bar.h\"})) assert(package:has_cfuncs(\"blob\", {includes \"blob.h\", configs {defines \"USE_BLOB\"}})) you can even set the language assert(package:has_cfuncs(\"bla\", {configs {languages \"c99\"}})) end) ``` ## package:has_cxxfuncs æ£€æµ‹åŒ…æ˜¯å¦å…·æœ‰ç»™å®šçš„ C++ å‡½æ•°ã€‚ è¿™åº”è¯¥åœ¨ `on_test` ä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ```lua on_test(function (package) assert(package:has_cxxfuncs(\"foo\")) you can also add configs assert(package:has_cxxfuncs(\"bar\", {includes \"foo_bar.hpp\"})) assert(package:has_cxxfuncs(\"blob\", {includes \"blob.hpp\", configs {defines \"USE_BLOB\"}})) you can even set the language assert(package:has_cxxfuncs(\"bla\", {configs {languages \"cxx17\"}})) end) ``` ## package:has_ctypes æ£€æµ‹åŒ…æ˜¯å¦å…·æœ‰ç»™å®šçš„ C ç±»å‹ã€‚ è¿™åº”è¯¥åœ¨ `on_test` ä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ```lua on_test(function (package) assert(package:has_ctypes(\"foo\")) you can also add configs assert(package:has_ctypes(\"bar\", {includes \"foo_bar.h\"})) assert(package:has_ctypes(\"blob\", {includes \"blob.h\", configs {defines \"USE_BLOB\"}})) you can even set the language assert(package:has_ctypes(\"bla\", {configs {languages \"c99\"}})) end) ``` ## package:has_cxxtypes æ£€æµ‹åŒ…æ˜¯å¦å…·æœ‰ç»™å®šçš„ C++ ç±»å‹ã€‚ è¿™åº”è¯¥åœ¨ `on_test` ä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ```lua on_test(function (package) assert(package:has_cxxtypes(\"foo\")) you can also add configs assert(package:has_cxxtypes(\"bar\", {includes \"foo_bar.hpp\"})) assert(package:has_cxxtypes(\"blob\", {includes \"blob.hpp\", configs {defines \"USE_BLOB\"}})) you can even set the language assert(package:has_cxxtypes(\"bla\", {configs {languages \"cxx17\"}})) end) ``` ## package:has_cincludes æ£€æµ‹åŒ…æ˜¯å¦å…·æœ‰ç»™å®šçš„ C å¤´æ–‡ä»¶ã€‚ è¿™åº”è¯¥åœ¨ `on_test` ä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ```lua on_test(function (package) assert(package:has_cincludes(\"foo.h\")) end) ``` ## package:has_cxxincludes æ£€æµ‹åŒ…æ˜¯å¦å…·æœ‰ç»™å®šçš„ C++ å¤´æ–‡ä»¶ã€‚ è¿™åº”è¯¥åœ¨ `on_test` ä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ```lua on_test(function (package) assert(package:has_cincludes(\"foo.hpp\")) end) ``` ## package:check_csnippets æ£€æµ‹æ˜¯å¦å¯ä»¥ç¼–è¯‘å’Œé“¾æ¥ç»™å®šçš„ C ä»£ç ç‰‡æ®µã€‚ è¿™åº”è¯¥åœ¨ `on_test` ä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ```lua on_test(function (package) assert(package:check_csnippets({test [[ #define USE_BLOB #include <blob.h> void test(int argc, char** argv) { foo bar; printf(\"%s\", bar.blob); } ]]}, {configs {languages \"c99\"}, includes \"foo.h\"})) end) ``` ## package:check_cxxsnippets æ£€æµ‹æ˜¯å¦å¯ä»¥ç¼–è¯‘å’Œé“¾æ¥ç»™å®šçš„ C++ ä»£ç ç‰‡æ®µã€‚ è¿™åº”è¯¥åœ¨ `on_test` ä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ```lua on_test(function (package) assert(package:check_cxxsnippets({test [[ #define USE_BLOB #include <blob.hpp> void test(int argc, char** argv) { foo bar(); std::cout << bar.blob; } ]]}, {configs {languages \"cxx11\"}, includes \"foo.hpp\"})) end) ``` ## package:check_fcsnippets æ£€æµ‹æ˜¯å¦å¯ä»¥ç¼–è¯‘å’Œé“¾æ¥ç»™å®šçš„ Fortran ä»£ç ç‰‡æ®µã€‚ ç”¨æ³•å¦‚ä¸Šã€‚"},"/get_started/zh/package/description-scope.html":{"title":"","content":" class: heading_no_counter # æè¿°åŸŸ ## ä»“åº“ä¾èµ–åŒ…å®šä¹‰æè¿° å¯å…ˆå‚è€ƒå®˜æ–¹ä»“åº“ä¸­ç°æœ‰åŒ…æè¿°ï¼š[xmake repo](https://github.com/xmake io/xmake repo) è¿™é‡Œç»™ä¸ªæ¯”è¾ƒå…·æœ‰ä»£è¡¨æ€§çš„å®ä¾‹ä¾›å‚è€ƒï¼š ```lua package(\"libxml2\", function() set_homepage(\"http://xmlsoft.org/\") set_description(\"The XML C parser and toolkit of Gnome.\") set_urls(\"https://github.com/GNOME/libxml2/archive/$(version).zip\", {excludes {\"*/result/*\", \"*/test/*\"}}) add_versions(\"v2.9.8\", \"c87793e45e66a7aa19200f861873f75195065de786a21c1b469bdb7bfc1230fb\") add_versions(\"v2.9.7\", \"31dd4c0e10fa625b47e27fd6a5295d246c883f214da947b9a4a9e13733905ed9\") if is_plat(\"macosx\", \"linux\") then add_deps(\"autoconf\", \"automake\", \"libtool\", \"pkg config\") end on_load(function (package) package:add(\"includedirs\", \"include/libxml2\") package:add(\"links\", \"xml2\") end) if is_plat(\"windows\") and winos.version():gt(\"winxp\") then on_install(\"windows\", function (package) os.cd(\"win32\") os.vrun(\"cscript configure.js iso8859x yes iconv no compiler msvc cruntime /MT debug %s prefix \\\"%s\\\"\", package:debug() and\"yes\"or\"no\", package:installdir()) os.vrun(\"nmake /f Makefile.msvc\") os.vrun(\"nmake /f Makefile.msvc install\") end) end on_install(\"macosx\", \"linux\", function (package) import(\"package.tools.autoconf\").install(package, {\" disable dependency tracking\", \" without python\", \" without lzma\"}) end) end) ``` ## package:set_homepage è®¾ç½®åŒ…æ‰€åœ¨é¡¹ç›®çš„å®˜æ–¹é¡µé¢åœ°å€ã€‚ ## package:set_description è®¾ç½®åŒ…çš„ç›¸å…³æè¿°ä¿¡æ¯ã€‚ ä¸€èˆ¬é€šè¿‡ `xmake require info zlib` æŸ¥çœ‹ç›¸å…³åŒ…ä¿¡æ¯æ—¶å€™ï¼Œä¼šçœ‹åˆ°ã€‚ ## package:set_kind è®¾ç½®åŒ…ç±»å‹ã€‚ å¯¹äºä¾èµ–åº“ï¼Œåˆ™ä¸ç”¨è®¾ç½®ï¼Œå¦‚æœæ˜¯å¯æ‰§è¡ŒåŒ…ï¼Œéœ€è¦è®¾ç½®ä¸º binaryã€‚ ```lua package(\"cmake\", function() set_kind(\"binary\") set_homepage(\"https://cmake.org\") set_description(\"A cross platform family of tool designed to build, test and package software\") end) ``` ## package:set_urls è®¾ç½®åŒ…æºåœ°å€ã€‚ è®¾ç½®åŒ…çš„æºç åŒ…æˆ–è€… git ä»“åº“åœ°å€ï¼Œè·Ÿ add_urls ä¸åŒçš„æ˜¯ï¼Œæ­¤æ¥å£æ˜¯è¦†ç›–æ€§è®¾ç½®ï¼Œè€Œ add_urls æ˜¯è¿½åŠ è®¾ç½®ï¼Œå…¶ä»–ä½¿ç”¨æ–¹å¼ç±»ä¼¼ï¼Œè¿™ä¸ªæ ¹æ®ä¸åŒéœ€è¦æ¥é€‰æ‹©ã€‚ ## package:add_urls æ·»åŠ åŒ…æºåœ°å€ã€‚ æ·»åŠ åŒ…çš„æºç åŒ…æˆ–è€… git ä»“åº“åœ°å€ï¼Œæ­¤æ¥å£ä¸€èˆ¬è·Ÿ add_version é…å¯¹ä½¿ç”¨ï¼Œç”¨äºè®¾ç½®æ¯ä¸ªæºç åŒ…çš„ç‰ˆæœ¬å’Œå¯¹åº”çš„ sha256 å€¼æˆ–è€… git çš„ commit æˆ–è€… tag æˆ–è€… branchã€‚ > å¯ä»¥é€šè¿‡æ·»åŠ å¤šä¸ª urls ä½œä¸ºé•œåƒæºï¼Œxmake ä¼šè‡ªåŠ¨æ£€æµ‹ä¼˜å…ˆé€‰ç”¨æœ€å¿«çš„ url è¿›è¡Œä¸‹è½½ï¼Œå¦‚æœä¸‹è½½å¤±è´¥åˆ™ä¼šå°è¯•å…¶ä»– urlsã€‚ ```lua add_urls(\"https://github.com/protobuf c/protobuf c/releases/download/v$(version)/protobuf c $(version).tar.gz\") add_versions(\"1.3.1\", \"51472d3a191d6d7b425e32b612e477c06f73fe23e07f6a6a839b11808e9d2267\") ``` urls é‡Œé¢çš„ `$(version)` å†…ç½®å˜é‡ï¼Œä¼šæ ¹æ®å®é™…å®‰è£…æ—¶å€™é€‰æ‹©çš„ç‰ˆæœ¬é€‚é…è¿›å»ï¼Œè€Œç‰ˆæœ¬å·éƒ½æ˜¯ä» `add_versions` ä¸­æŒ‡å®šçš„ç‰ˆæœ¬åˆ—è¡¨ä¸­é€‰æ‹©çš„ã€‚ å¦‚æœå¯¹äº urls é‡Œé¢å¸¦æœ‰æ¯”è¾ƒå¤æ‚çš„ç‰ˆæœ¬ä¸²ï¼Œæ²¡æœ‰è·Ÿ `add_versions` æœ‰ç›´æ¥å¯¹åº”å…³ç³»ï¼Œåˆ™éœ€è¦é€šè¿‡ä¸‹é¢çš„æ–¹å¼å®šåˆ¶åŒ–è½¬æ¢ä¸‹ï¼š ```lua add_urls(\"https://sqlite.org/2018/sqlite autoconf $(version)000.tar.gz\", {version function (version) return version:gsub(\"%.\", \"\") end}) add_versions(\"3.24.0\", \"d9d14e88c6fb6d68de9ca0d1f9797477d82fc3aed613558f87ffbdbbc5ceb74a\") add_versions(\"3.23.0\", \"b7711a1800a071674c2bf76898ae8584fc6c9643cfe933cfc1bc54361e3a6e49\") ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿåªå¯ä»¥æ·»åŠ  git æºç åœ°å€ï¼š ```lua add_urls(\"https://gitlab.gnome.org/GNOME/libxml2.git\") ``` å¦‚æœè®¾ç½®çš„å¤šä¸ªé•œåƒåœ°å€å¯¹åº”çš„æºç åŒ… sha256 æ˜¯ä¸åŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ alias çš„æ–¹å¼æ¥åˆ†åˆ«è®¾ç½® ```lua add_urls(\"https://ffmpeg.org/releases/ffmpeg $(version).tar.bz2\", {alias \"home\"}) add_urls(\"https://github.com/FFmpeg/FFmpeg/archive/n$(version).zip\", {alias \"github\"}) add_versions(\"home:4.0.2\", \"346c51735f42c37e0712e0b3d2f6476c86ac15863e4445d9e823fe396420d056\") add_versions(\"github:4.0.2\", \"4df1ef0bf73b7148caea1270539ef7bd06607e0ea8aa2fbf1bb34062a097f026\") ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®æŒ‡å®šçš„ urls çš„ http headersï¼š ```lua add_urls(\"https://github.com/madler/zlib/archive/$(version).tar.gz\", { http_headers {\"TEST1: foo\", \"TEST2: bar\"} }) ``` ## package:add_versions è®¾ç½®æ¯ä¸ªæºç åŒ…çš„ç‰ˆæœ¬ã€‚ å®ƒä¹Ÿä¼šè®¾ç½®å¯¹åº”çš„ sha256 å€¼ï¼Œå…·ä½“æè¿°è§ï¼š[add_urls](#packageadd_urls) ## package:add_versionfiles æ·»åŠ åŒ…ç‰ˆæœ¬åˆ—è¡¨ã€‚ é€šå¸¸æˆ‘ä»¬å¯ä»¥é€šè¿‡ `add_versions` æ¥å£æ·»åŠ åŒ…ç‰ˆæœ¬ï¼Œä½†æ˜¯å¦‚æœç‰ˆæœ¬è¶Šæ¥è¶Šå¤šï¼Œå°±ä¼šå¯¼è‡´åŒ…é…ç½®å¤ªè¿‡è‡ƒè‚¿ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `add_versionfiles` æ¥å£å°†æ‰€æœ‰çš„ç‰ˆæœ¬åˆ—è¡¨ï¼Œå­˜å‚¨åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­å»ç»´æŠ¤ã€‚ ä¾‹å¦‚ï¼š ```lua package(\"libcurl\", function() add_versionfiles(\"versions.txt\") end) ``` ```bash 8.5.0 ce4b6a6655431147624aaf582632a36fe1ade262d5fab385c60f78942dd8d87b 8.4.0 e5250581a9c032b1b6ed3cf2f9c114c811fc41881069e9892d115cc73f9e88c6 8.0.1 9b6b1e96b748d04b968786b6bdf407aa5c75ab53a3d37c1c8c81cdb736555ccf 7.87.0 5d6e128761b7110946d1276aff6f0f266f2b726f5e619f7e0a057a474155f307 7.31.0 a73b118eececff5de25111f35d1d0aafe1e71afdbb83082a8e44d847267e3e08 ... ``` ## package:add_patches è®¾ç½®åŒ…è¡¥ä¸ã€‚ æ­¤æ¥å£ç”¨äºé’ˆå¯¹æºç åŒ…ï¼Œåœ¨ç¼–è¯‘å®‰è£…å‰ï¼Œå…ˆæ‰“å¯¹åº”è®¾ç½®çš„è¡¥ä¸åŒ…ï¼Œå†å¯¹å…¶è¿›è¡Œç¼–è¯‘ï¼Œå¹¶ä¸”å¯æ”¯æŒåŒæ—¶æ‰“å¤šä¸ªè¡¥ä¸ã€‚ ```lua if is_plat(\"macosx\") then add_patches(\"1.15\", \"https://raw.githubusercontent.com/Homebrew/patches/9be2793af/libiconv/patch utf8mac.diff\", \"e8128732f22f63b5c656659786d2cf76f1450008f36bcf541285268c66cabeab\") end ``` ä¾‹å¦‚ï¼Œä¸Šé¢çš„ä»£ç ï¼Œå°±æ˜¯é’ˆå¯¹ macosx ä¸‹ç¼–è¯‘çš„æ—¶å€™ï¼Œæ‰“ä¸Šå¯¹åº”çš„ patch utf8mac.diff è¡¥ä¸ï¼Œå¹¶ä¸”æ¯ä¸ªè¡¥ä¸åé¢ä¹Ÿæ˜¯è¦è®¾ç½® sha256 å€¼çš„ï¼Œç¡®ä¿å®Œæ•´æ€§ã€‚ ## package:add_links è®¾ç½®åº“é“¾æ¥ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œxmake ä¼šå»è‡ªåŠ¨æ£€æµ‹å®‰è£…åçš„åº“ï¼Œè®¾ç½®é“¾æ¥å…³ç³»ï¼Œä½†æ˜¯æœ‰æ—¶å€™å¹¶ä¸æ˜¯å¾ˆå‡†ï¼Œå¦‚æœè¦è‡ªå·±æ‰‹åŠ¨è°ƒæ•´é“¾æ¥é¡ºåºï¼Œä»¥åŠé“¾æ¥åï¼Œåˆ™å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£æ¥è®¾ç½®ã€‚ ```lua add_links(\"mbedtls\", \"mbedx509\", \"mbedcrypto\") ``` ## package:add_syslinks è®¾ç½®ç³»ç»Ÿåº“é“¾æ¥ã€‚ æ·»åŠ ä¸€äº›ç³»ç»Ÿåº“é“¾æ¥ï¼Œæœ‰äº›åŒ…é›†æˆé“¾æ¥çš„æ—¶å€™ï¼Œè¿˜éœ€è¦ä¾èµ–ä¸€äº›ç³»ç»Ÿåº“ï¼Œæ‰èƒ½é“¾æ¥é€šè¿‡ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥åœ¨åŒ…æè¿°é‡Œé¢éƒ½é™„åŠ ä¸Šå»ã€‚ ```lua if is_plat(\"macosx\") then add_frameworks(\"CoreGraphics\", \"CoreFoundation\", \"Foundation\") elseif is_plat(\"windows\") then add_defines(\"CAIRO_WIN32_STATIC_BUILD 1\") add_syslinks(\"gdi32\", \"msimg32\", \"user32\") else add_syslinks(\"pthread\") end ``` ## package:add_linkorders è°ƒæ•´åŒ…å†…éƒ¨çš„é“¾æ¥é¡ºåºã€‚ å…·ä½“è¯¦æƒ…å¯ä»¥çœ‹ä¸‹ target å†…éƒ¨å¯¹ `add_linkorders` çš„æ–‡æ¡£è¯´æ˜ï¼Œ[target/add_linkorders](https://xmake.io/#/zh cn/manual/project_target?id targetadd_linkorders)ã€‚ ```lua package(\"libpng\", function() add_linkorders(\"png16\", \"png\", \"linkgroup::foo\") add_linkgroups(\"dl\", {name \"foo\", group true}) end) ``` ## package:add_linkgroups é…ç½®åŒ…çš„é“¾æ¥ç»„ã€‚ å…·ä½“è¯¦æƒ…å¯ä»¥çœ‹ä¸‹ target å†…éƒ¨å¯¹ `add_linkgroups` çš„æ–‡æ¡£è¯´æ˜ï¼Œ[target/add_linkgroups](https://xmake.io/#/zh cn/manual/project_target?id targetadd_linkgroups)ã€‚ ```lua package(\"libpng\", function() add_linkorders(\"png16\", \"png\", \"linkgroup::foo\") add_linkgroups(\"dl\", {name \"foo\", group true}) end) ``` ## package:add_frameworks æ·»åŠ ä¾èµ–çš„ç³»ç»Ÿ frameworks é“¾æ¥ã€‚ ç¤ºä¾‹è§ï¼š[add_syslinks](#packageadd_syslinks) ## package:add_linkdirs æ·»åŠ é“¾æ¥ç›®å½•ã€‚ åŒ…çš„é“¾æ¥åº“æœç´¢ç›®å½•ä¹Ÿæ˜¯å¯ä»¥è°ƒæ•´çš„ï¼Œä¸è¿‡é€šå¸¸éƒ½ä¸éœ€è¦ï¼Œé™¤éä¸€äº›åº“å®‰è£…å®Œä¸åœ¨ prefix/lib ä¸‹é¢ï¼Œè€Œåœ¨ lib çš„å­ç›®å½•ä¸‹ï¼Œé»˜è®¤æœç´¢ä¸åˆ°çš„è¯ã€‚ ## package:add_includedirs æ·»åŠ å…¶ä»–å¤´æ–‡ä»¶æœç´¢ç›®å½•ã€‚ ## package:add_bindirs æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœé…ç½®äº† `set_kind(\"binary\")` æˆ–è€… `set_kind(\"toolchain\")` ä½œä¸ºå¯æ‰§è¡Œçš„åŒ…ã€‚ é‚£ä¹ˆï¼Œå®ƒé»˜è®¤ä¼šå°† bin ç›®å½•ä½œä¸ºå¯æ‰§è¡Œç›®å½•ï¼Œå¹¶ä¸”è‡ªåŠ¨å°†å®ƒåŠ å…¥åˆ° PATH ç¯å¢ƒå˜é‡ä¸­å»ã€‚ è€Œå¦‚æœå¯¹åº” library åŒ…ï¼Œæƒ³è¦å°†é‡Œé¢é™„å¸¦ç¼–è¯‘çš„ä¸€äº›å¯æ‰§è¡Œå·¥å…·å¼€æ”¾ç»™ç”¨æˆ·æ‰§è¡Œï¼Œé‚£ä¹ˆéœ€è¦åœ¨åŒ…ä¸­é…ç½® `package:addenv(\"PATH\", \"bin\")` ä¸­æ‰è¡Œã€‚ è€Œé€šè¿‡è¿™ä¸ªæ¥å£å»é…ç½® `add_bindirs(\"bin\")` ï¼Œé‚£ä¹ˆå°†ä¼šè‡ªåŠ¨å°† bin æ·»åŠ åˆ° PATHï¼Œä¸å†éœ€è¦å•ç‹¬é…ç½® PATHï¼Œå¦å¤–ï¼Œè¿™ä¹Ÿæä¾›äº†ä¸€ç§å¯ä»¥ä¿®æ”¹å¯æ‰§è¡Œç›®å½•çš„æ–¹å¼ã€‚ ## package:add_defines æ·»åŠ å®å®šä¹‰ã€‚ å¯ä»¥å¯¹é›†æˆçš„åŒ…å¯¹å¤–è¾“å‡ºä¸€äº›ç‰¹å®šçš„å®šä¹‰é€‰é¡¹ã€‚ ## package:add_configs æ·»åŠ åŒ…é…ç½®ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡æ­¤æ¥å£æ·»åŠ æ¯ä¸ªåŒ…çš„å¯¹å¤–è¾“å‡ºé…ç½®å‚æ•°ï¼š ```lua package(\"pcre2\", function() set_homepage(\"https://www.pcre.org/\") set_description(\"A Perl Compatible Regular Expressions Library\") add_configs(\"bitwidth\", {description \"Set the code unit width.\", default \"8\", values {\"8\", \"16\", \"32\"}}) on_load(function (package) local bitwidth package:config(\"bitwidth\") or \"8\" package:add(\"links\", \"pcre2 \" .. bitwidth) package:add(\"defines\", \"PCRE2_CODE_UNIT_WIDTH \" .. bitwidth) end) end) ``` åœ¨å·¥ç¨‹é¡¹ç›®é‡Œé¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŸ¥çœ‹ç‰¹å®šåŒ…çš„å¯é…ç½®å‚æ•°å’Œå€¼åˆ—è¡¨ï¼š ```bash $ xmake require info pcre2 The package info of project: require(pcre2): > description: A Perl Compatible Regular Expressions Library > version: 10.31 ... > configs: > bitwidth: > description: Set the code unit width. > values: {\"8\",\"16\",\"32\"} > default: 8 ``` ç„¶ååœ¨é¡¹ç›®é‡Œé¢ï¼Œå¯ç”¨è¿™äº›é…ç½®ï¼Œç¼–è¯‘é›†æˆå¸¦æœ‰ç‰¹å®šé…ç½®çš„åŒ…ï¼š ```lua add_requires(\"pcre2\", {configs {bitwidth 16}}) ``` ## package:add_extsources æ·»åŠ æ‰©å±•çš„åŒ…æºã€‚ æ”¯æŒ `add_extsources` å’Œ `on_fetch` ä¸¤ä¸ªé…ç½®æ¥å£ï¼Œå¯ä»¥æ›´å¥½çš„é…ç½® xmake åœ¨å®‰è£… C/C++ åŒ…çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹ç³»ç»Ÿåº“çš„æŸ¥æ‰¾è¿‡ç¨‹ã€‚ è‡³äºå…·ä½“èƒŒæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ [xmake repo](https://github.com/xmake io/xmake repo) ä»“åº“æ–°å¢äº†ä¸€ä¸ª `package(\"libusb\")` çš„åŒ…ã€‚ é‚£ä¹ˆç”¨æˆ·å°±å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼ï¼Œç›´æ¥é›†æˆä½¿ç”¨å®ƒï¼š ```lua add_requires(\"libusb\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"libusb\") end) ``` å¦‚æœç”¨æˆ·ç³»ç»Ÿä¸Šç¡®å®æ²¡æœ‰å®‰è£… libusbï¼Œé‚£ä¹ˆ xmake ä¼šè‡ªåŠ¨ä¸‹è½½ libusb åº“æºç ï¼Œè‡ªåŠ¨ç¼–è¯‘å®‰è£…é›†æˆï¼Œæ²¡å•¥é—®é¢˜ã€‚ ä½†å¦‚æœç”¨æˆ·é€šè¿‡ `apt install libusb 1.0` å®‰è£…äº† libusb åº“åˆ°ç³»ç»Ÿï¼Œé‚£ä¹ˆæŒ‰ç† xmake åº”è¯¥ä¼šè‡ªåŠ¨ä¼˜å…ˆæŸ¥æ‰¾ç”¨æˆ·å®‰è£…åˆ°ç³»ç»Ÿç¯å¢ƒçš„ libusb åŒ…ï¼Œç›´æ¥ä½¿ç”¨ï¼Œé¿å…é¢å¤–çš„ä¸‹è½½ç¼–è¯‘å®‰è£…ã€‚ ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œxmake å†…éƒ¨é€šè¿‡ `find_package(\"libusb\")` å¹¶æ²¡æœ‰æ‰¾æ‰“å®ƒï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºé€šè¿‡ apt å®‰è£…çš„ libusb åŒ…åæ˜¯ `libusb 1.0`, è€Œä¸æ˜¯ libusbã€‚ æˆ‘ä»¬åªèƒ½é€šè¿‡ `pkg config cflags libusb 1.0` æ‰èƒ½æ‰¾åˆ°å®ƒï¼Œä½†æ˜¯ xmake å†…éƒ¨çš„é»˜è®¤ find_package é€»è¾‘å¹¶ä¸çŸ¥é“ `libusb 1.0` çš„å­˜åœ¨ï¼Œæ‰€ä»¥æ‰¾ä¸åˆ°ã€‚ å› æ­¤ä¸ºäº†æ›´å¥½åœ°é€‚é…ä¸åŒç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œç³»ç»Ÿåº“çš„æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `add_extsources(\"pkgconfig::libusb 1.0\")` å»è®© xmake æ”¹è¿›æŸ¥æ‰¾é€»è¾‘ï¼Œä¾‹å¦‚ï¼š ```lua package(\"libusb\", function() add_extsources(\"pkgconfig::libusb 1.0\") on_install(function (package) ... end) end) ``` å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹å¼ï¼Œæ”¹è¿›æŸ¥æ‰¾ homebrew/pacman ç­‰å…¶ä»–åŒ…ç®¡ç†å™¨å®‰è£…çš„åŒ…ï¼Œä¾‹å¦‚ï¼š`add_extsources(\"pacman::libusb 1.0\")`ã€‚ ## package:add_deps æ·»åŠ åŒ…ä¾èµ–æ¥å£ï¼Œé€šè¿‡é…ç½®åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨å®‰è£…åŒ…çš„åŒæ—¶ï¼Œè‡ªåŠ¨å®‰è£…å®ƒçš„æ‰€æœ‰ä¾èµ–åŒ…ã€‚ å¦å¤–ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªè¦é…ç½®äº†ä¾èµ–å…³ç³»ï¼Œcmake/autoconf å°±èƒ½å¤Ÿè‡ªåŠ¨æ‰¾åˆ°æ‰€æœ‰ä¾èµ–åŒ…çš„åº“å’Œå¤´æ–‡ä»¶ã€‚ å½“ç„¶ï¼Œå¦‚æœç”±äºä¸€äº›ç‰¹æ®ŠåŸå› ï¼Œå¯¼è‡´å½“å‰åŒ…çš„ cmake è„šæœ¬æ²¡èƒ½å¤Ÿæ­£å¸¸æ‰¾åˆ°ä¾èµ–åŒ…ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `{packagedeps \"xxx\"}` æ¥å¼ºè¡Œæ‰“å…¥ä¾èµ–åŒ…ä¿¡æ¯ã€‚ ä¾‹å¦‚ï¼š ```lua package(\"foo\", function() add_deps(\"cmake\", \"bar\") on_install(function (package) local configs {} import(\"package.tools.cmake\").install(package, configs) end) end) ``` foo åŒ…æ˜¯ä½¿ç”¨ CMakeLists.txt ç»´æŠ¤çš„ï¼Œå®ƒåœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œä¾èµ– bar åŒ…ï¼Œå› æ­¤ï¼Œxmake ä¼šä¼˜å…ˆå®‰è£… barï¼Œå¹¶ä¸”è®© cmake.install åœ¨è°ƒç”¨ cmake æ—¶å€™ï¼Œè‡ªåŠ¨æ‰¾åˆ° bar å®‰è£…åçš„åº“ã€‚ ä½†æ˜¯ï¼Œå¦‚æœ foo çš„ CMakeLists.txt è¿˜æ˜¯æ— æ³•è‡ªåŠ¨æ‰¾åˆ° barï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¿®æ”¹æˆä¸‹é¢çš„é…ç½®ï¼Œå¼ºåˆ¶å°† bar çš„ includedirs/links ç­‰ä¿¡æ¯é€šè¿‡ flags çš„æ–¹å¼ï¼Œä¼ å…¥ fooã€‚ ```lua package(\"foo\", function() add_deps(\"cmake\", \"bar\") on_install(function (package) local configs {} import(\"package.tools.cmake\").install(package, configs, {packages \"bar\"}) end) end) ``` ## package:add_components ç”¨äºæ”¯æŒåŒ…çš„ç»„ä»¶åŒ–é…ç½®ï¼Œè¯¦æƒ…è§ï¼š[#2636](https://github.com/xmake io/xmake/issues/2636)ã€‚ é€šè¿‡è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®å½“å‰åŒ…å®é™…å¯ä»¥æä¾›çš„ç»„ä»¶åˆ—è¡¨ã€‚ ```lua package(\"sfml\", function() add_components(\"graphics\") add_components(\"audio\", \"network\", \"window\") add_components(\"system\") end) ``` åœ¨ç”¨æˆ·ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥ä½¿ç”¨åŒ…çš„ç‰¹å®šç»„ä»¶ã€‚ ```lua add_requires(\"sfml\") target(\"test\", function() add_packages(\"sfml\", {components \"graphics\") end) ``` > æ³¨ï¼šé™¤äº†é…ç½®å¯ç”¨çš„ç»„ä»¶åˆ—è¡¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹æ¯ä¸ªç»„ä»¶è¿›è¡Œè¯¦ç»†é…ç½®ï¼Œæ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œå› æ­¤ï¼Œå®ƒé€šå¸¸å’Œ `on_component` æ¥å£é…åˆä½¿ç”¨ã€‚ ä¸€ä¸ªå…³äºåŒ…ç»„ä»¶çš„é…ç½®å’Œä½¿ç”¨çš„å®Œæ•´ä¾‹å­è§ï¼š[components example](https://github.com/xmake io/xmake/blob/master/tests/projects/package/components/xmake.lua) ## package:set_base ç»§æ‰¿åŒ…é…ç½®ã€‚ è¿™æ˜¯ 2.6.4 æ–°åŠ çš„æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒå»ç»§æ‰¿ä¸€ä¸ªå·²æœ‰çš„åŒ…çš„å…¨éƒ¨é…ç½®ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šé‡å†™éƒ¨åˆ†é…ç½®ã€‚ è¿™é€šå¸¸åœ¨ç”¨æˆ·è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œä¿®æ”¹ xmake repo å®˜æ–¹ä»“åº“çš„å†…ç½®åŒ…æ¯”è¾ƒæœ‰ç”¨ï¼Œæ¯”å¦‚ï¼šä¿®å¤æ”¹ urlsï¼Œä¿®æ”¹ç‰ˆæœ¬åˆ—è¡¨ï¼Œå®‰è£…é€»è¾‘ç­‰ç­‰ã€‚ ä¾‹å¦‚ï¼Œä¿®æ”¹å†…ç½® zlib åŒ…çš„ urlï¼Œåˆ‡åˆ°è‡ªå·±çš„ zlib æºç åœ°å€ã€‚ ```lua package(\"myzlib\", function() set_base(\"zlib\") set_urls(\"https://github.com/madler/zlib.git\") end) add_requires(\"myzlib\", {system false, alias \"zlib\"}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"zlib\") end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨æ¥å•çº¯æ·»åŠ ä¸€ä¸ªåˆ«ååŒ…ã€‚ ```lua package(\"onetbb\", function() set_base(\"tbb\") end) ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡ `add_requires(\"onetbb\")` é›†æˆå®‰è£… tbb åŒ…ï¼Œåªæ˜¯åŒ…åä¸åŒè€Œå·²ã€‚ ## package:on_load åŠ è½½åŒ…é…ç½®ã€‚ è¿™æ˜¯ä¸ªå¯é€‰çš„æ¥å£ï¼Œå¦‚æœè¦æ›´åŠ çµæ´»çš„åŠ¨æ€åˆ¤æ–­å„ç§å¹³å°æ¶æ„ï¼Œé’ˆå¯¹æ€§åšè®¾ç½®ï¼Œå¯ä»¥åœ¨è¿™ä¸ªé‡Œé¢å®Œæˆï¼Œä¾‹å¦‚ï¼š ```lua on_load(function (package) local bitwidth package:config(\"bitwidth\") or \"8\" package:add(\"links\", \"pcre\" .. (bitwidth ~ \"8\" and bitwidth or \"\")) if not package:config(\"shared\") then package:add(\"defines\", \"PCRE_STATIC\") end end) ``` pcre åŒ…éœ€è¦åšä¸€äº›é’ˆå¯¹ bitwidth çš„åˆ¤æ–­ï¼Œæ‰èƒ½ç¡®å®šå¯¹å¤–è¾“å‡ºçš„é“¾æ¥åº“åå­—ï¼Œè¿˜éœ€è¦é’ˆå¯¹åŠ¨æ€åº“å¢åŠ ä¸€äº› defines å¯¼å‡ºï¼Œè¿™ä¸ªæ—¶å€™åœ¨ on_load é‡Œé¢è®¾ç½®ï¼Œå°±æ›´åŠ çµæ´»äº†ã€‚ ## package:on_fetch ä»ç³»ç»Ÿä¸­æŸ¥æ‰¾åº“ã€‚ è¿™æ˜¯ä¸ªå¯é€‰é…ç½®ï¼Œ2.5.2 ä¹‹åï¼Œå¦‚æœä¸åŒç³»ç»Ÿä¸‹å®‰è£…çš„ç³»ç»Ÿåº“ï¼Œä»…ä»…åªæ˜¯åŒ…åä¸åŒï¼Œé‚£ä¹ˆä½¿ç”¨ `add_extsources` æ”¹è¿›ç³»ç»Ÿåº“æŸ¥æ‰¾å·²ç»è¶³å¤Ÿï¼Œç®€å•æ–¹ä¾¿ã€‚ ä½†æ˜¯å¦‚æœæœ‰äº›å®‰è£…åˆ°ç³»ç»Ÿçš„åŒ…ï¼Œä½ç½®æ›´åŠ å¤æ‚ï¼Œæƒ³è¦æ‰¾åˆ°å®ƒä»¬ï¼Œä¹Ÿè®¸éœ€è¦ä¸€äº›é¢å¤–çš„è„šæœ¬æ‰èƒ½å®ç°ï¼Œä¾‹å¦‚ï¼šwindows ä¸‹æ³¨å†Œè¡¨çš„è®¿é—®å»æŸ¥æ‰¾åŒ…ç­‰ç­‰ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ `on_fetch` å®Œå…¨å®šåˆ¶åŒ–æŸ¥æ‰¾ç³»ç»Ÿåº“é€»è¾‘ã€‚ è¿˜æ˜¯ä»¥ libusb ä¸ºä¾‹ï¼Œæˆ‘ä»¬ä¸ç”¨ `add_extsources`ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ï¼Œå®ç°ç›¸åŒçš„æ•ˆæœï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢åšæ›´å¤šçš„äº‹æƒ…ã€‚ ``` package(\"libusb\") on_fetch(\"linux\", function(package, opt) if opt.system then return find_package(\"pkgconfig::libusb 1.0\") end end) ``` ## package:on_check æ£€æµ‹åŒ…æ˜¯å¦æ”¯æŒå½“å‰å¹³å°ã€‚ æœ‰æ—¶å€™ï¼Œå•çº¯ç”¨ `on_install(\"windows\", \"android\", function () end)` æ— æ³•å¾ˆå¥½çš„é™åˆ¶åŒ…å¯¹å½“å‰å¹³å°çš„æ”¯æŒåŠ›åº¦ã€‚ ä¾‹å¦‚ï¼ŒåŒæ ·éƒ½æ˜¯åœ¨ windows ä¸Šä½¿ç”¨ msvc ç¼–è¯‘ï¼Œä½†æ˜¯å®ƒä»…ä»…åªæ”¯æŒä½¿ç”¨ vs2022 å·¥å…·é“¾ã€‚é‚£ä¹ˆæˆ‘ä»¬æ— æ³•ç®€å•çš„å»é€šè¿‡ç¦ç”¨ windows å¹³å°ï¼Œæ¥é™åˆ¶åŒ…çš„å®‰è£…ã€‚ å› ä¸ºæ¯ä¸ªç”¨æˆ·çš„ç¼–è¯‘å·¥å…·é“¾ç¯å¢ƒéƒ½å¯èƒ½æ˜¯ä¸åŒçš„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½® `on_check` å»åšæ›´ç»†è‡´çš„æ£€æµ‹ï¼Œæ¥åˆ¤æ–­åŒ…æ˜¯å¦æ”¯æŒå½“å‰çš„å·¥å…·é“¾ç¯å¢ƒã€‚ å¦‚æœåŒ…ä¸è¢«æ”¯æŒï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨åŒ…è¢«ä¸‹è½½å®‰è£…å‰ï¼Œæ›´æ—©çš„æç¤ºç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥åœ¨ xmake repo çš„ ci ä¸Šï¼Œè§„é¿æ‰ä¸€äº›ä¸æ”¯æŒçš„ ci job æµ‹è¯•ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢çš„é…ç½®ï¼Œå°±å¯ä»¥åˆ¤æ–­å½“å‰çš„ msvc æ˜¯å¦æä¾›äº†å¯¹åº”çš„ vs sdk ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…å°±æ— æ³•è¢«ç¼–è¯‘å®‰è£…ï¼Œç”¨æˆ·ä¼šçœ‹åˆ°æ›´åŠ å¯è¯»çš„ä¸æ”¯æŒçš„é”™è¯¯æç¤ºã€‚ ```lua package(\"test\", function() on_check(\"windows\", function (package) import(\"core.tool.toolchain\") import(\"core.base.semver\") local msvc toolchain.load(\"msvc\", {plat package:plat(), arch package:arch()}) if msvc then local vs_sdkver msvc:config(\"vs_sdkver\") assert(vs_sdkver and semver.match(vs_sdkver):gt(\"10.0.19041\"), \"package(cglm): need vs_sdkver > 10.0.19041.0\") end end) end)S ``` ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥åˆ¤æ–­ï¼Œå½“å‰ç¼–è¯‘å™¨å¯¹ c++20 çš„æ”¯æŒåŠ›åº¦ï¼Œå¦‚æœä¸æ”¯æŒ c++20 æ‰æœ‰çš„ std::input_iteratorã€‚é‚£ä¹ˆè¿™ä¸ªåŒ…å°±æ²¡å¿…è¦ç»§ç»­ä¸‹è½½ç¼–è¯‘å®‰è£…ã€‚ ç”¨æˆ·ä¼šçœ‹åˆ° `Require at least C++20.` çš„é”™è¯¯ï¼Œæ¥æç¤ºç”¨æˆ·å–å‡çº§è‡ªå·±çš„ç¼–è¯‘å™¨ã€‚ ```lua package(\"test\", function() on_check(function (package) assert(package:check_cxxsnippets({test [[ #include <cstddef> #include <iterator> struct SimpleInputIterator { using difference_type std::ptrdiff_t; using value_type int; int operator*() const; SimpleInputIterator& operator++(); void operator++(int) { ++*this; } }; static_assert(std::input_iterator<SimpleInputIterator>); ]]}, {configs {languages \"c++20\"}}), \"Require at least C++20.\") end) end) ``` ## package:on_install å®‰è£…åŒ…ã€‚ è¿™ä¸ªæ¥å£ä¸»è¦ç”¨äºæ·»åŠ å®‰è£…è„šæœ¬ï¼Œå‰é¢çš„å­—ç¬¦ä¸²å‚æ•°ç”¨äºè®¾ç½®æ”¯æŒçš„å¹³å°ï¼Œåƒ `on_load`, `on_test` ç­‰å…¶ä»–è„šæœ¬åŸŸä¹Ÿæ˜¯åŒæ ·æ”¯æŒçš„ã€‚ å®Œæ•´çš„è¿‡æ»¤è¯­æ³•å¦‚ä¸‹ï¼š`platarch1,arch2@hostarch1,arch2` çœ‹ä¸Šå»éå¸¸çš„å¤æ‚ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå…¶ä¸­æ¯ä¸ªé˜¶æ®µéƒ½æ˜¯å¯é€‰çš„ï¼Œå¯éƒ¨åˆ†çœç•¥ï¼Œå¯¹åº”ï¼š` ç¼–è¯‘å¹³å° ç¼–è¯‘æ¶æ„ @ä¸»æœºå¹³å° ä¸»æœºæ¶æ„ ` å¦‚æœä¸è®¾ç½®ä»»ä½•å¹³å°è¿‡æ»¤æ¡ä»¶ï¼Œé‚£ä¹ˆé»˜è®¤å…¨å¹³å°æ”¯æŒï¼Œé‡Œé¢çš„è„šæœ¬å¯¹æ‰€æœ‰å¹³å°ç”Ÿæ•ˆï¼Œä¾‹å¦‚ï¼š ```lua on_install(function (package) TODO end) ``` å¦‚æœå®‰è£…è„šæœ¬å¯¹ç‰¹å®šå¹³å°ç”Ÿæ•ˆï¼Œé‚£ä¹ˆç›´æ¥æŒ‡å®šå¯¹åº”çš„ç¼–è¯‘å¹³å°ï¼Œå¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªï¼š ```lua on_install(\"linux\", \"macosx\", function (package) TODO end) ``` å¦‚æœè¿˜è¦ç»†åˆ†åˆ°æŒ‡å®šæ¶æ„æ‰èƒ½ç”Ÿæ•ˆï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š ```lua on_install(\"linuxx86_64\", \"iphoneosarm64\", function (package) TODO end) ``` å¦‚æœè¿˜è¦é™åˆ¶æ‰§è¡Œçš„ä¸»æœºç¯å¢ƒå¹³å°å’Œæ¶æ„ï¼Œå¯ä»¥åœ¨åé¢è¿½åŠ  `@hostarch`ï¼Œä¾‹å¦‚ï¼š ```lua on_install(\"mingw@windows\", function (package) TODO end) ``` æ„æ€å°±æ˜¯ä»…å¯¹ windows ä¸‹ç¼–è¯‘ mingw å¹³å°ç”Ÿæ•ˆã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸æŒ‡å®šæ¯”é‚£ä¸€å¹³å°å’Œæ¶æ„ï¼Œä»…è®¾ç½®ä¸»æœºå¹³å°å’Œæ¶æ„ï¼Œè¿™é€šå¸¸ç”¨äºæè¿°ä¸€äº›è·Ÿç¼–è¯‘å·¥å…·ç›¸å…³çš„ä¾èµ–åŒ…ï¼Œåªèƒ½åœ¨ä¸»æœºç¯å¢ƒè¿è¡Œã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç¼–è¯‘çš„åŒ…ï¼Œä¾èµ–äº† cmakeï¼Œéœ€è¦æ·»åŠ  cmake çš„åŒ…æè¿°ï¼Œé‚£ä¹ˆé‡Œé¢ç¼–è¯‘å®‰è£…ç¯å¢ƒï¼Œåªèƒ½æ˜¯ä¸»æœºå¹³å°ï¼š ```lua on_install(\"@windows\", \"@linux\", \"@macosx\", function (package) TODO end) ``` å…¶ä»–ä¸€äº›ä¾‹å­ï¼š ```lua `@linux` `@linuxx86_64` `@macosx,linux` `android@macosx,linux` `androidarmeabi v7a@macosx,linux` `androidarmeabi v7a@macosx,linuxx86_64` `androidarmeabi v7a@linuxx86_64` ``` åœ¨ 2.8.7 ä¸­ï¼Œæˆ‘ä»¬æ”¹è¿›äº†æ¨¡å¼åŒ¹é…æ”¯æŒï¼Œæ–°å¢æ’é™¤æŒ‡å®šå¹³å°å’Œæ¶æ„ï¼Œä¾‹å¦‚ï¼š ``` !plat!arch@!subhost!subarch ``` ```lua @!linux @!linuxx86_64 @!macosx,!linux !android@macosx,!linux android!armeabi v7a@macosx,!linux androidarmeabi v7a,!iphoneos@macosx,!linuxx86_64 !androidarmeabi v7a@!linux!x86_64 !linux* ``` åŒæ—¶ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå†…ç½®çš„ `native` æ¶æ„ï¼Œç”¨äºåŒ¹é…å½“å‰å¹³å°çš„æœ¬åœ°æ¶æ„ï¼Œä¸»è¦ç”¨äºæŒ‡å®šæˆ–è€…æ’é™¤äº¤å‰ç¼–è¯‘å¹³å°ã€‚ ```lua on_install(\"macosxnative\", ...) ``` ä¸Šé¢çš„é…ç½®ï¼Œå¦‚æœåœ¨ macOS x86_64 çš„è®¾å¤‡ä¸Šï¼Œå®ƒä»…ä»…åªä¼šåŒ¹é… `xmake f a x86_64` çš„æœ¬åœ°æ¶æ„ç¼–è¯‘ã€‚ å¦‚æœæ˜¯ `xmake f a arm64` äº¤å‰ç¼–è¯‘ï¼Œå°±ä¸ä¼šè¢«åŒ¹é…åˆ°ã€‚ åŒç†ï¼Œå¦‚æœåªæƒ³åŒ¹é…äº¤å‰ç¼–è¯‘ï¼Œå¯ä»¥ä½¿ç”¨ `macosx!native` è¿›è¡Œå–åæ’é™¤å°±è¡Œäº†ã€‚ 2.9.1 ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ç»§ç»­å¯¹å®ƒåšäº†æ”¹è¿›ï¼Œå¢åŠ äº†æ¡ä»¶é€»è¾‘åˆ¤æ–­çš„æ”¯æŒï¼š ä¾‹å¦‚ï¼š ```lua on_install(\"!wasm!arm* and !cross!arm*\", function (package) end) ``` æ¥è¡¨è¿°æ’é™¤ wasm å’Œ cross å¹³å°ä¹‹å¤–çš„ arm æ¶æ„ã€‚ å¹¶ä¸”ï¼Œå®ƒä¹Ÿæ”¯æŒé€šè¿‡ `()` æè¿°çš„åµŒå¥—é€»è¾‘ï¼Œ`a and b or (a and (c or d))`ã€‚ æˆ‘ä»¬å†…ç½®äº†ä¸€äº›å®‰è£…å¸¸ç”¨ç¼–è¯‘å·¥å…·è„šæœ¬ï¼Œç”¨äºé’ˆå¯¹ä¸åŒæºç ä¾èµ–çš„æ„å»ºå·¥å…·é“¾ï¼Œè¿›è¡Œæ–¹ä¾¿çš„æ„æ¶æ”¯æŒï¼Œä¾‹å¦‚ï¼šautoconf, cmake, meson ç­‰ï¼Œ å¦‚æœæ˜¯åŸºäº xmake çš„ä¾èµ–åŒ…ï¼Œé‚£ä¹ˆé›†æˆèµ·æ¥å°±éå¸¸ç®€å•äº†ï¼Œxmake å¯¹å…¶åšäº†éå¸¸å¥½çš„å†…ç½®é›†æˆæ”¯æŒï¼Œå¯ä»¥ç›´æ¥å¯¹å…¶è¿›è¡Œè·¨å¹³å°ç¼–è¯‘æ”¯æŒï¼Œä¸€èˆ¬æƒ…å†µä¸‹åªéœ€è¦ï¼š ```lua on_install(function (package) import(\"package.tools.xmake\").install(package) end) ``` å¦‚æœè¦ä¼ é€’ä¸€äº›ç‰¹æœ‰çš„ç¼–è¯‘é…ç½®å‚æ•°ï¼š ```lua on_install(function (package) import(\"package.tools.xmake\").install(package, {\" xxx y\"}) end) ``` å¦‚æœæ˜¯åŸºäº cmake çš„åŒ…ï¼Œé›†æˆèµ·æ¥ä¹Ÿå¾ˆç®€ç­”ï¼Œé€šå¸¸ä¹Ÿåªéœ€è¦è®¾ç½®ä¸€äº›é…ç½®å‚æ•°å³å¯ï¼Œä¸è¿‡è¿˜éœ€è¦å…ˆæ·»åŠ ä¸Š cmake çš„ä¾èµ–æ‰è¡Œï¼š ```lua add_deps(\"cmake\") on_install(function (package) import(\"package.tools.cmake\").install(package, {\" Dxxx ON\"}) end) ``` å¦‚æœæ˜¯åŸºäº autoconf çš„åŒ…ï¼Œé›†æˆæ–¹å¼è·Ÿ cmake ç±»ä¼¼ï¼Œåªæ˜¯ä¼ é€’çš„é…ç½®å‚æ•°ä¸åŒè€Œå·²ï¼Œä¸è¿‡é€šå¸¸æƒ…å†µä¸‹ï¼Œunix ç³»ç»Ÿéƒ½å†…ç½®äº† autoconf ç³»åˆ—å·¥å…·ï¼Œæ‰€ä»¥ä¸åŠ ç›¸å…³ä¾èµ–ä¹Ÿæ²¡äº‹ã€‚ ```lua on_install(function (package) import(\"package.tools.autoconf\").install(package, {\" enable shared no\"}) end) ``` ä¸è¿‡ï¼Œæœ‰äº›æºç åŒ…ç”¨ç³»ç»Ÿå†…ç½®çš„ autoconf å¯èƒ½ä¸èƒ½å®Œå…¨æ»¡è¶³ï¼Œé‚£ä¹ˆå¯ä»¥åŠ ä¸Š autoconf ç³»åˆ—ä¾èµ–ï¼Œå¯¹å…¶è¿›è¡Œæ„å»ºï¼š ```lua add_deps(\"autoconf\", \"automake\", \"libtool\", \"pkg config\") on_install(function (package) import(\"package.tools.autoconf\").install(package, {\" enable shared no\"}) end) ``` å¦‚æœæ˜¯ mesonï¼Œè¿˜éœ€è¦åŠ ä¸Š ninja çš„ä¾èµ–æ¥æ‰§è¡Œæ„å»ºæ‰è¡Œã€‚ ```lua add_deps(\"meson\", \"ninja\") on_install(function (package) import(\"package.tools.meson\").install(package, {\" Dxxx ON\"}) end) ``` å¦‚æœæ˜¯ makefileï¼š ```lua å‚è€ƒ z3 package on_install(function(package) import(\"package.tools.make\").install(package) end) ``` ## package:on_test æµ‹è¯•åŒ…ã€‚ å®‰è£…åï¼Œéœ€è¦è®¾ç½®å¯¹åº”çš„æµ‹è¯•è„šæœ¬ï¼Œæ‰§è¡Œä¸€äº›æµ‹è¯•ï¼Œç¡®ä¿å®‰è£…åŒ…çš„å¯é æ€§ï¼Œå¦‚æœæµ‹è¯•ä¸é€šè¿‡ï¼Œåˆ™ä¼šæ’¤é”€æ•´ä¸ªå®‰è£…åŒ…ã€‚ ```lua on_test(function (package) assert(package:has_cfuncs(\"inflate\", {includes \"zlib.h\"})) end) ``` ä¸Šé¢çš„è„šæœ¬è°ƒç”¨åŒ…å†…ç½®çš„ `has_cfuncs` æ¥å£ï¼Œæ£€æµ‹å®‰è£…åçš„åŒ…æ˜¯å¦å­˜åœ¨ zlib.h å¤´æ–‡ä»¶ï¼Œä»¥åŠåº“å’Œå¤´æ–‡ä»¶é‡Œé¢æ˜¯å¦å­˜åœ¨ `inflate` è¿™ä¸ªæ¥å£å‡½æ•°ã€‚ xmake ä¼šå»å°è¯•ç¼–è¯‘é“¾æ¥æ¥åšæµ‹è¯•ï¼Œ`has_cfuncs` ç”¨äºæ£€æµ‹ c å‡½æ•°ï¼Œè€Œ `has_cxxfuncs` åˆ™å¯ä»¥æ£€æµ‹ c++ åº“å‡½æ•°ã€‚ è€Œ includes é‡Œé¢å¯ä»¥è®¾ç½®å¤šä¸ªå¤´æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š`includes {\"xxx.h\", \"yyy.h\"}` æˆ‘ä»¬è¿˜å¯ä»¥ä¼ é€’ä¸€äº›è‡ªå·±çš„ç¼–è¯‘å‚æ•°è¿›å»æ£€æµ‹ï¼Œä¾‹å¦‚ï¼š ```lua on_test(function (package) assert(package:has_cxxfuncs(\"func1\", {includes \"xxx.h\", configs {defines \"c++14\", cxflags \" Dxxx\"}})) end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `check_csnippets` å’Œ `check_cxxsnippets` æ£€æµ‹ä¸€ä¸ªä»£ç ç‰‡æ®µï¼š ```lua on_test(function (package) assert(package:check_cxxsnippets({test [[ #include <boost/algorithm/string.hpp> #include <string> #include <vector> #include <assert.h> using namespace boost::algorithm; using namespace std; static void test() { string str(\"a,b\"); vector<string> strVec; split(strVec, str, is_any_of(\",\")); assert(strVec.size() 2); assert(strVec[0] \"a\"); assert(strVec[1] \"b\"); } ]]}, {configs {languages \"c++14\"}})) end) ``` å¦‚æœæ˜¯å¯æ‰§è¡ŒåŒ…ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å°è¯•è¿è¡Œæ¥æ£€æµ‹ï¼š ```lua on_test(function (package) os.run(\"xxx help\") end) ``` å¦‚æœè¿è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆæµ‹è¯•ä¸ä¼šé€šè¿‡ã€‚ ## package:on_download è‡ªå®šä¹‰ä¸‹è½½åŒ…ã€‚ è‡ªå®šä¹‰åŒ…çš„ä¸‹è½½é€»è¾‘ï¼Œè¿™æ˜¯ 2.6.4 æ–°åŠ çš„æ¥å£ï¼Œé€šå¸¸ç”¨ä¸åˆ°ï¼Œä½¿ç”¨ Xmake çš„å†…ç½®ä¸‹è½½å°±è¶³å¤Ÿäº†ã€‚ å¦‚æœç”¨æˆ·è‡ªå»ºç§æœ‰ä»“åº“ï¼Œå¯¹åŒ…çš„ä¸‹è½½æœ‰æ›´å¤æ‚çš„é‰´æƒæœºåˆ¶ï¼Œç‰¹æ®Šå¤„ç†é€»è¾‘ï¼Œé‚£ä¹ˆå¯ä»¥é‡å†™å†…éƒ¨çš„ä¸‹è½½é€»è¾‘æ¥å®ç°ã€‚ ```lua on_download(function (package, opt) local url opt.url local sourcedir opt.sourcedir download url to the current directory and extract it's source code to sourcedir ... end) ``` opt å‚æ•°é‡Œé¢ï¼Œå¯ä»¥è·å–åˆ°ä¸‹è½½åŒ…çš„ç›®çš„æºç ç›®å½• `opt.sourcedir`ï¼Œæˆ‘ä»¬åªéœ€è¦ä» `opt.url` è·å–åˆ°åŒ…åœ°å€ï¼Œä¸‹è½½ä¸‹æ¥å°±å¯ä»¥äº†ã€‚ ç„¶åï¼Œæ ¹æ®éœ€è¦ï¼Œæ·»åŠ ä¸€äº›è‡ªå®šä¹‰çš„å¤„ç†é€»è¾‘ã€‚å¦å¤–ï¼Œè‡ªå·±å¯ä»¥æ·»åŠ ä¸‹è½½ç¼“å­˜å¤„ç†ç­‰ç­‰ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ä¸‹è½½ tar.gz æ–‡ä»¶ï¼Œå¹¶ä¸”å®ç°ç¼“å­˜å’Œæºæ–‡ä»¶ç›®å½•è§£å‹çš„ä¾‹å­ï¼Œå¯ä»¥å‚è€ƒä¸‹ï¼š ```lua package(\"zlib\", function() add_urls(\"https://github.com/madler/zlib/archive/$(version).tar.gz\") add_versions(\"v1.2.10\", \"42cd7b2bdaf1c4570e0877e61f2fdc0bce8019492431d054d3d86925e5058dc5\") on_download(function (package, opt) import(\"net.http\") import(\"utils.archive\") local url opt.url local sourcedir opt.sourcedir local packagefile path.filename(url) local sourcehash package:sourcehash(opt.url_alias) local cached true if not os.isfile(packagefile) or sourcehash ~ hash.sha256(packagefile) then cached false attempt to remove package file first os.tryrm(packagefile) http.download(url, packagefile) check hash if sourcehash and sourcehash ~ hash.sha256(packagefile) then raise(\"unmatched checksum, current hash(%s) ! original hash(%s)\", hash.sha256(packagefile):sub(1, 8), sourcehash:sub(1, 8)) end end extract package file local sourcedir_tmp sourcedir .. \".tmp\" os.rm(sourcedir_tmp) if archive.extract(packagefile, sourcedir_tmp) then os.rm(sourcedir) os.mv(sourcedir_tmp, sourcedir) else if it is not archive file, we need only create empty source file and use package:originfile() os.tryrm(sourcedir) os.mkdir(sourcedir) end save original file path package:originfile_set(path.absolute(packagefile)) end) end) ``` è‡ªå®šä¹‰ä¸‹è½½éœ€è¦ç”¨æˆ·å®Œå…¨è‡ªå·±æ§åˆ¶ä¸‹è½½é€»è¾‘ï¼Œä¼šæ¯”è¾ƒå¤æ‚ï¼Œé™¤éå¿…è¦ï¼Œä¸æ¨èè¿™ä¹ˆåšã€‚ å¦‚æœä»…ä»…åªæ˜¯æƒ³å¢åŠ è‡ªå®šä¹‰ http headers å»è·å–ä¸‹è½½æˆæƒï¼Œå¯ä»¥ä½¿ç”¨ [è®¾ç½®åŒ…ä¸‹è½½çš„ http headers](https://xmake.io/#/zh cn/manual/project_target?id %e8%ae%be%e7%bd%ae%e5%8c%85%e4%b8%8b%e8%bd%bd%e7%9a%84 http headers) ## package:on_component é…ç½®åŒ…ç»„ä»¶ã€‚ è¿™æ˜¯ 2.7.3 æ–°åŠ çš„æ¥å£ï¼Œç”¨äºæ”¯æŒåŒ…çš„ç»„ä»¶åŒ–é…ç½®ï¼Œè¯¦æƒ…è§ï¼š[#2636](https://github.com/xmake io/xmake/issues/2636)ã€‚ é€šè¿‡è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®å½“å‰åŒ…ï¼ŒæŒ‡å®šç»„ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚ç»„ä»¶çš„é“¾æ¥ï¼Œä¾èµ–ç­‰ç­‰ã€‚ ### é…ç½®ç»„ä»¶é“¾æ¥ä¿¡æ¯ ```lua package(\"sfml\") add_components(\"graphics\") add_components(\"audio\", \"network\", \"window\") add_components(\"system\") on_component(\"graphics\", function (package, component) local e package:config(\"shared\") and \"\"or\" s\" component:add(\"links\", \"sfml graphics\" .. e) if package:is_plat(\"windows\", \"mingw\") and not package:config(\"shared\") then component:add(\"links\", \"freetype\") component:add(\"syslinks\", \"opengl32\", \"gdi32\", \"user32\", \"advapi32\") end end) on_component(\"window\", function (package, component) local e package:config(\"shared\") and \"\"or\" s\" component:add(\"links\", \"sfml window\" .. e) if package:is_plat(\"windows\", \"mingw\") and not package:config(\"shared\") then component:add(\"syslinks\", \"opengl32\", \"gdi32\", \"user32\", \"advapi32\") end end) ... ``` åœ¨ç”¨æˆ·ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥ä½¿ç”¨åŒ…çš„ç‰¹å®šç»„ä»¶ã€‚ ```lua add_requires(\"sfml\") target(\"test\") add_packages(\"sfml\", {components \"graphics\") ``` > æ³¨ï¼šé™¤äº†é…ç½®ç»„ä»¶ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½®å¯ç”¨çš„ç»„ä»¶åˆ—è¡¨ï¼Œæ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œå› æ­¤ï¼Œå®ƒé€šå¸¸å’Œ `add_components` æ¥å£é…åˆä½¿ç”¨ã€‚ ä¸€ä¸ªå…³äºåŒ…ç»„ä»¶çš„é…ç½®å’Œä½¿ç”¨çš„å®Œæ•´ä¾‹å­è§ï¼š[components example](https://github.com/xmake io/xmake/blob/master/tests/projects/package/components/xmake.lua) ### é…ç½®ç»„ä»¶çš„ç¼–è¯‘ä¿¡æ¯ æˆ‘ä»¬ä¸ä»…å¯ä»¥é…ç½®æ¯ä¸ªç»„ä»¶çš„é“¾æ¥ä¿¡æ¯ï¼Œè¿˜æœ‰ includedirs, defines ç­‰ç­‰ç¼–è¯‘ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹æ¯ä¸ªç»„ä»¶å•ç‹¬é…ç½®ã€‚ ```lua package(\"sfml\") on_component(\"graphics\", function (package, component) package:add(\"defines\", \"TEST\") end) ``` ### é…ç½®ç»„ä»¶ä¾èµ– ```lua package(\"sfml\", function() add_components(\"graphics\") add_components(\"audio\", \"network\", \"window\") add_components(\"system\") on_component(\"graphics\", function (package, component) component:add(\"deps\", \"window\", \"system\") end) end) ``` ä¸Šé¢çš„é…ç½®ï¼Œå‘Šè¯‰åŒ…ï¼Œæˆ‘ä»¬çš„ graphics ç»„ä»¶è¿˜ä¼šé¢å¤–ä¾èµ– `window` å’Œ `system` ä¸¤ä¸ªç»„ä»¶ã€‚ å› æ­¤ï¼Œåœ¨ç”¨æˆ·ç«¯ï¼Œæˆ‘ä»¬å¯¹ graphics çš„ç»„ä»¶ä½¿ç”¨ï¼Œå¯ä»¥ä» ```lua add_packages(\"sfml\", {components {\"graphics\", \"window\", \"system\"}) ``` ç®€åŒ–ä¸ºï¼š ```lua add_packages(\"sfml\", {components \"graphics\") ``` å› ä¸ºï¼Œåªè¦æˆ‘ä»¬å¼€å¯äº† graphics ç»„ä»¶ï¼Œå®ƒä¹Ÿä¼šè‡ªåŠ¨å¯ç”¨ä¾èµ–çš„ window å’Œ system ç»„ä»¶ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `add_components(\"graphics\", {deps {\"window\", \"system\"}})` æ¥é…ç½®ç»„ä»¶ä¾èµ–å…³ç³»ã€‚ ### ä»ç³»ç»Ÿåº“ä¸­æŸ¥æ‰¾ç»„ä»¶ æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨åŒ…é…ç½®ä¸­ï¼Œé…ç½® `add_extsources` å¯ä»¥æ”¹è¿›åŒ…åœ¨ç³»ç»Ÿä¸­çš„æŸ¥æ‰¾ï¼Œæ¯”å¦‚ä» apt/pacman ç­‰ç³»ç»ŸåŒ…ç®¡ç†å™¨ä¸­æ‰¾åº“ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®©æ¯ä¸ªç»„ä»¶ä¹Ÿèƒ½é€šè¿‡ `extsources` é…ç½®ï¼Œå»ä¼˜å…ˆä»ç³»ç»Ÿåº“ä¸­æ‰¾åˆ°å®ƒä»¬ã€‚ ä¾‹å¦‚ï¼Œsfml åŒ…ï¼Œå®ƒåœ¨ homebrew ä¸­å…¶å®ä¹Ÿæ˜¯ç»„ä»¶åŒ–çš„ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥è®©åŒ…ä»ç³»ç»Ÿåº“ä¸­ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ¯ä¸ªç»„ä»¶ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡æºç å®‰è£…å®ƒä»¬ã€‚ ```bash $ ls l /usr/local/opt/sfml/lib/pkgconfig r r r 1 ruki admin 317 10 19 17:52 sfml all.pc r r r 1 ruki admin 534 10 19 17:52 sfml audio.pc r r r 1 ruki admin 609 10 19 17:52 sfml graphics.pc r r r 1 ruki admin 327 10 19 17:52 sfml network.pc r r r 1 ruki admin 302 10 19 17:52 sfml system.pc r r r 1 ruki admin 562 10 19 17:52 sfml window.pc ``` æˆ‘ä»¬åªéœ€è¦ï¼Œå¯¹æ¯ä¸ªç»„ä»¶é…ç½®å®ƒçš„ extsourcesï¼š ```lua if is_plat(\"macosx\") then add_extsources(\"brew::sfml/sfml all\") end on_component(\"graphics\", function (package, component) ... component:add(\"extsources\", \"brew::sfml/sfml graphics\") end) ``` ### é»˜è®¤çš„å…¨å±€ç»„ä»¶é…ç½® é™¤äº†é€šè¿‡æŒ‡å®šç»„ä»¶åçš„æ–¹å¼ï¼Œé…ç½®ç‰¹å®šç»„ä»¶ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šç»„ä»¶åï¼Œé»˜è®¤å°±æ˜¯å…¨å±€é…ç½®æ‰€æœ‰ç»„ä»¶ã€‚ ```lua package(\"sfml\", function() on_component(function (package, component) configure all components end) end) ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼ï¼ŒæŒ‡å®šé…ç½® graphics ç»„ä»¶ï¼Œå‰©ä¸‹çš„ç»„ä»¶é€šè¿‡é»˜è®¤çš„å…¨å±€é…ç½®æ¥å£è¿›è¡Œé…ç½®ï¼š ```lua package(\"sfml\", function() add_components(\"graphics\") add_components(\"audio\", \"network\", \"window\") add_components(\"system\") on_component(\"graphics\", function (package, component) configure graphics end) on_component(function (package, component) component audio, network, window, system end) end) ```"},"/get_started/zh/package/local-package.html":{"title":"","content":" class: heading_no_counter # ä½¿ç”¨æœ¬åœ°åŒ… ## é»˜è®¤æ‰“åŒ…æ ¼å¼ xmake æä¾›äº†ä¸€ç§æ–°çš„æœ¬åœ°åŒ…æ‰“åŒ…æ–¹æ¡ˆï¼Œå°†ä¼šæ›´åŠ æ— ç¼çš„å¯¹æ¥ `add_requires` å’Œ `add_packages`ã€‚ æˆ‘ä»¬æ‰§è¡Œ `xmake package` å‘½ä»¤å°±èƒ½å¤Ÿç”Ÿæˆé»˜è®¤çš„æ–°ç‰ˆæ‰“åŒ…æ ¼å¼ã€‚ ```console $ xmake package package(foo): build/packages/f/foo generated ``` å®ƒå°†ä¼šäº§ç”Ÿ `build/packages/f/foo/xmake.lua` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š ```lua package(\"foo\", function() set_description(\"The foo package\") set_license(\"Apache 2.0\") add_deps(\"add\", \"sub\") on_load(function (package) package:set(\"installdir\", path.join(os.scriptdir(), package:plat(), package:arch(), package:mode())) end) on_fetch(function (package) local result {} result.links \"foo\" result.linkdirs package:installdir(\"lib\") result.includedirs package:installdir(\"include\") return result end) end) ``` å…¶å®å°±æ˜¯é‡‡ç”¨ `package()` æ¥å®šä¹‰æè¿°æœ¬åœ°åŒ…ï¼Œå°±è·Ÿè¿œç¨‹åŒ…ä¸€æ ·ã€‚ è€Œç”Ÿæˆçš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š ```console $ tree build/packages/f/foo/ build/packages/f/foo/ â”œâ”€â”€ macosx â”‚Â Â  â””â”€â”€ x86_64 â”‚Â Â  â””â”€â”€ release â”‚Â Â  â”œâ”€â”€ include â”‚Â Â  â”‚Â Â  â””â”€â”€ foo.h â”‚Â Â  â””â”€â”€ lib â”‚Â Â  â””â”€â”€ libfoo.a â””â”€â”€ xmake.lua ``` æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿä½¿ç”¨ `add_requires`/`add_repositories` æ¥å£æ¥æ— ç¼é›†æˆè¿™ä¸ªåŒ…ã€‚ ```lua add_rules(\"mode.debug\", \"mode.release\") add_repositories(\"local repo build\") add_requires(\"foo\") target(\"bar\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") add_packages(\"foo\") end) ``` å…¶ä¸­ï¼Œadd_repositories é…ç½®æŒ‡å®šæœ¬åœ°åŒ…çš„ä»“åº“æ ¹ç›®å½•ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡ `add_requires` æ¥å¼•ç”¨è¿™ä¸ªåŒ…äº†ã€‚ å¦å¤–ï¼Œç”Ÿæˆçš„æœ¬åœ°åŒ…ï¼Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå°±æ˜¯æ”¯æŒ `target/add_deps`ï¼Œä¼šè‡ªåŠ¨å…³è”å¤šä¸ªåŒ…çš„ä¾èµ–å…³ç³»ï¼Œé›†æˆæ—¶å€™ï¼Œä¹Ÿä¼šè‡ªåŠ¨å¯¹æ¥æ‰€æœ‰ä¾èµ–é“¾æ¥ã€‚ è¿™é‡Œæœ‰å®Œæ•´çš„ [æµ‹è¯•ä¾‹å­](https://github.com/xmake io/xmake/blob/dev/tests/actions/package/localpkg/test.lua)ã€‚ ```bash \"/usr/bin/xcrun sdk macosx clang++\" o build/macosx/x86_64/release/bar build/.objs/bar/macosx/x86_64/release/src/main.cpp.o arch x86_64 mmacosx version min 10.15 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.0.sdk stdlib libc++ L/Users/ruki/projects/personal/xmake/tests/actions/package/localpkg/bar/build/packages/f/foo/macosx/x86_64/release/lib L/Users/ruki/projects/personal/xmake/tests/actions/package/localpkg/bar/build/packages/s/sub/macosx/x86_64/release/lib L/Users/ruki/projects/personal/xmake/tests/actions/package/localpkg/bar/build/packages/a/add/macosx/x86_64/release/lib Wl, x lfoo lsub ladd lz ``` ## ç”Ÿæˆè¿œç¨‹åŒ… é™¤äº†æœ¬åœ°åŒ…æ ¼å¼ï¼Œ`xmake package` ç°åœ¨ä¹Ÿæ”¯æŒç”Ÿæˆè¿œç¨‹åŒ…ï¼Œä¾¿äºç”¨æˆ·å°†ä»–ä»¬å¿«é€Ÿæäº¤åˆ°è¿œç¨‹ä»“åº“ã€‚ æˆ‘ä»¬åªéœ€è¦åœ¨æ‰“åŒ…æ—¶å€™ï¼Œä¿®æ”¹åŒ…æ ¼å¼ã€‚ ```console $ xmake package f remote ``` ä»–ä¹Ÿä¼šäº§ç”Ÿ packages/f/foo/xmake.lua æ–‡ä»¶ã€‚ ```lua package(\"foo\", function() set_description(\"The foo package\") set_license(\"Apache 2.0\") add_deps(\"add\", \"sub\") add_urls(\"https://github.com/myrepo/foo.git\") add_versions(\"1.0\", \"<shasum256 or gitcommit>\") on_install(function (package) local configs {} if package:config(\"shared\") then configs.kind \"shared\" end import(\"package.tools.xmake\").install(package, configs) end) on_test(function (package) TODO check includes and interfaces assert(package:has_cfuncs(\"foo\", {includes \"foo.h\"}) end) end) ``` åŒ…å®šä¹‰é…ç½®ç›¸æ¯”æœ¬åœ°åŒ…ï¼Œå¤šäº†å®é™…çš„å®‰è£…é€»è¾‘ï¼Œä»¥åŠ urls å’Œ versions çš„è®¾ç½®ï¼Œ æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿé€šè¿‡é™„åŠ å‚æ•°ï¼Œå»ä¿®æ”¹ urlsï¼Œversions ç­‰é…ç½®å€¼ï¼Œä¾‹å¦‚ï¼š ```console $ xmake package f remote url https://xxxx/xxx.tar.gz shasum xxxxx homepage xxxxx` ``` xmake ä¹Ÿä¼šä» target çš„ `set_license` å’Œ `set_version` ç­‰é…ç½®ä¸­è¯»å–ç›¸å…³é…ç½®ä¿¡æ¯ã€‚ ## ä» CMake ä¸­æŸ¥æ‰¾åŒ… ç°åœ¨ cmake å·²ç»æ˜¯äº‹å®ä¸Šçš„æ ‡å‡†ï¼Œæ‰€ä»¥ CMake æä¾›çš„ find_package å·²ç»å¯ä»¥æŸ¥æ‰¾å¤§é‡çš„åº“å’Œæ¨¡å—ï¼Œæˆ‘ä»¬å®Œå…¨å¤ç”¨ cmake çš„è¿™éƒ¨åˆ†ç”Ÿæ€æ¥æ‰©å…… xmake å¯¹åŒ…çš„é›†æˆã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ `find_package(\"cmake::xxx\")` å»å€ŸåŠ© cmake æ¥æ‰¾ä¸€äº›åŒ…ï¼Œxmake ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª cmake è„šæœ¬æ¥è°ƒç”¨ cmake çš„ find_package å»æŸ¥æ‰¾ä¸€äº›åŒ…ï¼Œè·å–é‡Œé¢åŒ…ä¿¡æ¯ã€‚ ä¾‹å¦‚ï¼š ```console $ xmake l find_package cmake::ZLIB { links { \"z\" }, includedirs { \"/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10. 15.sdk/usr/include\" }, linkdirs { \"/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10. 15.sdk/usr/lib\" } } $ xmake l find_package cmake::LibXml2 { links { \"xml2\" }, includedirs { \"/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include/libxml2\" }, linkdirs { \"/usr/lib\" } } ``` ### 1. åœ¨é¡¹ç›®ä¸­é›†æˆåŒ… å¦‚æœæˆ‘ä»¬åœ¨ xmake.lua é¡¹ç›®é…ç½®ä¸­é›†æˆæŸ¥æ‰¾ cmake çš„ä¾èµ–åŒ…ï¼Œé€šå¸¸ä¸éœ€è¦ç›´æ¥ä½¿ç”¨ find_packageï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ›´åŠ é€šç”¨ã€ç®€å•çš„åŒ…é›†æˆæ–¹å¼ã€‚ ```lua add_requires(\"cmake::ZLIB\", {alias \"zlib\", system true}) target(\"test\") set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"zlib\") ``` æˆ‘ä»¬æŒ‡å®š `system true` å‘Šè¯‰ xmake å¼ºåˆ¶ä»ç³»ç»Ÿä¸­è°ƒç”¨ cmake æŸ¥æ‰¾åŒ…ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œä¸å†èµ°å®‰è£…é€»è¾‘ï¼Œå› ä¸º cmake æ²¡æœ‰æä¾›ç±»ä¼¼ vcpkg/conan ç­‰åŒ…ç®¡ç†å™¨çš„å®‰è£…åŠŸèƒ½ï¼Œåªæä¾›äº†åŒ…æŸ¥æ‰¾ç‰¹æ€§ã€‚ ### 2. æŒ‡å®šç‰ˆæœ¬ ```lua add_requires(\"cmake::OpenCV 4.1.1\", {system true}) ``` ### 3. æŒ‡å®šç»„ä»¶ ```lua add_requires(\"cmake::Boost\", {system true, configs {components {\"regex\", \"system\"}}}) ``` ### 4. é¢„è®¾å¼€å…³ ```lua add_requires(\"cmake::Boost\", {system true, configs {components {\"regex\", \"system\"}, presets {Boost_USE_STATIC_LIB true}}}) ``` ç›¸å½“äºå†…éƒ¨è°ƒç”¨ find_package æŸ¥æ‰¾åŒ…ä¹‹å‰ï¼Œåœ¨ CMakeLists.txt ä¸­é¢„å®šä¹‰ä¸€äº›é…ç½®ï¼Œæ§åˆ¶ find_package çš„æŸ¥æ‰¾ç­–ç•¥å’ŒçŠ¶æ€ã€‚ ``` set(Boost_USE_STATIC_LIB ON) will be used in FindBoost.cmake find_package(Boost REQUIRED COMPONENTS regex system) ``` ### 5. è®¾ç½®ç¯å¢ƒå˜é‡ ```lua add_requires(\"cmake::OpenCV\", {system true, configs {envs {CMAKE_PREFIX_PATH \"xxx\"}}}) ``` ### 6. æŒ‡å®šè‡ªå®šä¹‰ FindFoo.cmake æ¨¡å—è„šæœ¬ç›®å½• mydir/cmake_modules/FindFoo.cmakeï¼š ```lua add_requires(\"cmake::Foo\", {system true, configs {moduledirs \"mydir/cmake_modules\"}}) ``` ç›¸å…³ issues: [#1632](https://github.com/xmake io/xmake/issues/1632) ### 7. æŒ‡å®šé“¾æ¥é¡¹ å¯¹äº cmake åŒ…ï¼Œæˆ‘ä»¬æ–°å¢äº† `link_libraries` é…ç½®é€‰é¡¹ï¼Œè®©ç”¨æˆ·åœ¨æŸ¥æ‰¾ä½¿ç”¨ cmake åŒ…çš„æ—¶å€™ï¼Œå¯ä»¥è‡ªå®šä¹‰é…ç½®åŒ…ä¾èµ–çš„é“¾æ¥åº“ï¼Œç”šè‡³å¯¹ target é“¾æ¥çš„æ”¯æŒã€‚ ```lua add_requires(\"cmake::xxx\", {configs {link_libraries {\"abc::lib1\", \"abc::lib2\"}}}) ``` xmake åœ¨æŸ¥æ‰¾ cmake åŒ…çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è¿½åŠ ä¸‹é¢çš„é…ç½®ï¼Œæ”¹è¿›å¯¹ links åº“çš„æå–ã€‚ ```cmake target_link_libraries(test PRIVATE ABC::lib1 ABC::lib2) ``` ### 8. æŒ‡å®šæœç´¢æ¨¡å¼ å¦å¤–ï¼Œæˆ‘ä»¬å¢åŠ çš„æœç´¢æ¨¡å¼é…ç½®ï¼š ```lua add_requires(\"cmake::xxx\", {configs {search_mode \"config\"}}) add_requires(\"cmake::xxx\", {configs {search_mode \"module\"}}) add_requires(\"cmake::xxx\") both ``` æ¯”å¦‚æŒ‡å®š config æœç´¢æ¨¡å¼ï¼Œå‘Šè¯‰ cmake ä» `XXXConfig.cmake` ä¸­æŸ¥æ‰¾åŒ…ã€‚ xmake åœ¨æŸ¥æ‰¾ cmake åŒ…çš„æ—¶å€™ï¼Œå†…éƒ¨ä¼šè‡ªåŠ¨è¿½åŠ ä¸‹é¢çš„é…ç½®ã€‚ ```cmake find_package(ABC CONFIG REQUIRED) ```"},"/get_started/zh/package/remote-package.html":{"title":"","content":" class: heading_no_counter # ä½¿ç”¨è¿œç¨‹åŒ… ## å‰è¨€ è¿œç¨‹åŒ…åœ¨ç”¨æ³•ä¸Šæ›´åŠ çš„ç®€å•ï¼Œåªéœ€è¦è®¾ç½®å¯¹åº”çš„ä¾èµ–åŒ…å°±è¡Œäº†ï¼Œä¾‹å¦‚ï¼š ```lua add_requires(\"tbox 1.6.*\", \"libpng ~1.16\", \"zlib\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"tbox\", \"libpng\", \"zlib\") end) ``` ä¸Šé¢çš„ `add_requires` ç”¨äºæè¿°å½“å‰é¡¹ç›®éœ€è¦çš„ä¾èµ–åŒ…ï¼Œè€Œ `add_packages` ç”¨äºåº”ç”¨ä¾èµ–åŒ…åˆ° test ç›®æ ‡ï¼Œåªæœ‰è®¾ç½®è¿™ä¸ªæ‰ä¼šè‡ªåŠ¨è¿½åŠ  links, linkdirs, includedirs ç­‰è®¾ç½®ã€‚ ç„¶åç›´æ¥æ‰§è¡Œç¼–è¯‘å³å¯ï¼š ```console $ xmake ``` xmake ä¼šå»è¿œç¨‹æ‹‰å–ç›¸å…³æºç åŒ…ï¼Œç„¶åè‡ªåŠ¨ç¼–è¯‘å®‰è£…ï¼Œæœ€åç¼–è¯‘é¡¹ç›®ï¼Œè¿›è¡Œä¾èµ–åŒ…çš„é“¾æ¥ã€‚ å…³äºåŒ…ä¾èµ–ç®¡ç†çš„æ›´å¤šç›¸å…³ä¿¡æ¯å’Œè¿›å±•è§ç›¸å…³ issuesï¼š[Remote package management](https://github.com/xmake io/xmake/issues/69) ## ç›®å‰æ”¯æŒçš„ç‰¹æ€§ * è¯­ä¹‰ç‰ˆæœ¬æ”¯æŒï¼Œä¾‹å¦‚ï¼š\"> 1.1.0 < 1.2\", \"~1.6\", \"1.2.x\", \"1.*\" * æä¾›å®˜æ–¹åŒ…ä»“åº“ã€è‡ªå»ºç§æœ‰ä»“åº“ã€é¡¹ç›®å†…ç½®ä»“åº“ç­‰å¤šä»“åº“ç®¡ç†æ”¯æŒ * è·¨å¹³å°åŒ…ç¼–è¯‘é›†æˆæ”¯æŒï¼ˆä¸åŒå¹³å°ã€ä¸åŒæ¶æ„çš„åŒ…å¯åŒæ—¶å®‰è£…ï¼Œå¿«é€Ÿåˆ‡æ¢ä½¿ç”¨ï¼‰ * debug ä¾èµ–åŒ…æ”¯æŒï¼Œå®ç°æºç è°ƒè¯• ## ä¾èµ–åŒ…å¤„ç†æœºåˆ¶ è¿™é‡Œæˆ‘ä»¬ç®€å•ä»‹ç»ä¸‹æ•´ä¸ªä¾èµ–åŒ…çš„å¤„ç†æœºåˆ¶ï¼š ![package arch](image/package arch.png) 1. ä¼˜å…ˆæ£€æµ‹å½“å‰ç³»ç»Ÿç›®å½•ã€ç¬¬ä¸‰æ–¹åŒ…ç®¡ç†ä¸‹æœ‰æ²¡æœ‰å­˜åœ¨æŒ‡å®šçš„åŒ…ï¼Œå¦‚æœæœ‰åŒ¹é…çš„åŒ…ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ä¸‹è½½å®‰è£…äº† ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥è®¾ç½®ä¸ä½¿ç”¨ç³»ç»ŸåŒ…ï¼‰ 2. æ£€ç´¢åŒ¹é…å¯¹åº”ç‰ˆæœ¬çš„åŒ…ï¼Œç„¶åä¸‹è½½ã€ç¼–è¯‘ã€å®‰è£…ï¼ˆæ³¨ï¼šå®‰è£…åœ¨ç‰¹å®š xmake ç›®å½•ï¼Œä¸ä¼šå¹²æ‰°ç³»ç»Ÿåº“ç¯å¢ƒï¼‰ 3. ç¼–è¯‘é¡¹ç›®ï¼Œæœ€åè‡ªåŠ¨é“¾æ¥å¯ç”¨çš„ä¾èµ–åŒ… ## å¿«é€Ÿä¸Šæ‰‹ æ–°å»ºä¸€ä¸ªä¾èµ– tbox åº“çš„ç©ºå·¥ç¨‹ï¼š ```console $ xmake create t console_tbox test $ cd test ``` æ‰§è¡Œç¼–è¯‘å³å¯ï¼Œå¦‚æœå½“å‰æ²¡æœ‰å®‰è£… tbox åº“ï¼Œåˆ™ä¼šè‡ªåŠ¨ä¸‹è½½å®‰è£…åä½¿ç”¨ï¼š ```console $ xmake ``` åˆ‡æ¢åˆ° iphoneos å¹³å°è¿›è¡Œç¼–è¯‘ï¼Œå°†ä¼šé‡æ–°å®‰è£… iphoneos ç‰ˆæœ¬çš„ tbox åº“è¿›è¡Œé“¾æ¥ä½¿ç”¨ï¼š ```console $ xmake f p iphoneos $ xmake ``` åˆ‡æ¢åˆ° android å¹³å° arm64 v8a æ¶æ„ç¼–è¯‘ï¼š ```console $ xmake f p android [ ndk ~/android ndk r16b] $ xmake ``` ## è¯­ä¹‰ç‰ˆæœ¬è®¾ç½® xmake çš„ä¾èµ–åŒ…ç®¡ç†æ˜¯å®Œå…¨æ”¯æŒè¯­ä¹‰ç‰ˆæœ¬é€‰æ‹©çš„ï¼Œä¾‹å¦‚ï¼š\"~1.6.1\"ï¼Œå¯¹äºè¯­ä¹‰ç‰ˆæœ¬çš„å…·ä½“æè¿°è§ï¼š[https://semver.org/](https://semver.org/) ä¸€äº›è¯­ä¹‰ç‰ˆæœ¬å†™æ³•ï¼š ```lua add_requires(\"tbox 1.6.*\", \"pcre 1.3.x\", \"libpng ^1.18\") add_requires(\"libpng ~1.16\", \"zlib 1.1.2 > 1.2.11 <1.3.0\") ``` ç›®å‰ xmake ä½¿ç”¨çš„è¯­ä¹‰ç‰ˆæœ¬è§£æå™¨æ˜¯ [uael](https://github.com/uael) è´¡çŒ®çš„ [sv](https://github.com/uael/sv) åº“ï¼Œé‡Œé¢ä¹Ÿæœ‰å¯¹ç‰ˆæœ¬æè¿°å†™æ³•çš„è¯¦ç»†è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒä¸‹ï¼š[ç‰ˆæœ¬æè¿°è¯´æ˜](https://github.com/uael/sv#versions) å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬å¯¹å½“å‰çš„ä¾èµ–åŒ…çš„ç‰ˆæœ¬æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è¿™ä¹ˆå†™ï¼š ```lua add_requires(\"tbox\", \"libpng\", \"zlib\") ``` è¿™ä¼šä½¿ç”¨å·²çŸ¥çš„æœ€æ–°ç‰ˆæœ¬åŒ…ï¼Œæˆ–è€…æ˜¯ master åˆ†æ”¯çš„æºç ç¼–è¯‘çš„åŒ…ï¼Œå¦‚æœå½“å‰åŒ…æœ‰ git repo åœ°å€ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½æŒ‡å®šç‰¹å®šåˆ†æ”¯ç‰ˆæœ¬ï¼š ```lua add_requires(\"tbox master\") add_requires(\"tbox dev\") ``` ## é¢å¤–çš„åŒ…ä¿¡æ¯è®¾ç½® ### å¯é€‰åŒ…è®¾ç½® å¦‚æœæŒ‡å®šçš„ä¾èµ–åŒ…å½“å‰å¹³å°ä¸æ”¯æŒï¼Œæˆ–è€…ç¼–è¯‘å®‰è£…å¤±è´¥äº†ï¼Œé‚£ä¹ˆ xmake ä¼šç¼–è¯‘æŠ¥é”™ï¼Œè¿™å¯¹äºæœ‰äº›å¿…é¡»è¦ä¾èµ–æŸäº›åŒ…æ‰èƒ½å·¥ä½œçš„é¡¹ç›®ï¼Œè¿™æ˜¯åˆç†çš„ã€‚ ä½†æ˜¯å¦‚æœæœ‰äº›åŒ…æ˜¯å¯é€‰çš„ä¾èµ–ï¼Œå³ä½¿æ²¡æœ‰ä¹Ÿå¯ä»¥æ­£å¸¸ç¼–è¯‘ä½¿ç”¨çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå¯é€‰åŒ…ï¼š ```lua add_requires(\"tbox\", {optional true}) ``` ### ç¦ç”¨ç³»ç»Ÿåº“ é»˜è®¤çš„è®¾ç½®ï¼Œxmake ä¼šå»ä¼˜å…ˆæ£€æµ‹ç³»ç»Ÿåº“æ˜¯å¦å­˜åœ¨ï¼ˆå¦‚æœæ²¡è®¾ç½®ç‰ˆæœ¬è¦æ±‚ï¼‰ï¼Œå¦‚æœç”¨æˆ·å®Œå…¨ä¸æƒ³ä½¿ç”¨ç³»ç»Ÿåº“ä»¥åŠç¬¬ä¸‰æ–¹åŒ…ç®¡ç†æä¾›çš„åº“ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®ï¼š ```lua add_requires(\"tbox\", {system false}) ``` ### ä½¿ç”¨è°ƒè¯•ç‰ˆæœ¬çš„åŒ… å¦‚æœæˆ‘ä»¬æƒ³åŒæ—¶æºç è°ƒè¯•ä¾èµ–åŒ…ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®ä¸ºä½¿ç”¨ debug ç‰ˆæœ¬çš„åŒ…ï¼ˆå½“ç„¶å‰ææ˜¯è¿™ä¸ªåŒ…æ”¯æŒ debug ç¼–è¯‘ï¼‰ï¼š ```lua add_requires(\"tbox\", {debug true}) ``` å¦‚æœå½“å‰åŒ…è¿˜ä¸æ”¯æŒ debug ç¼–è¯‘ï¼Œå¯åœ¨ä»“åº“ä¸­æäº¤ä¿®æ”¹ç¼–è¯‘è§„åˆ™ï¼Œå¯¹ debug è¿›è¡Œæ”¯æŒï¼Œä¾‹å¦‚ï¼š ```lua package(\"openssl\", function() on_install(\"linux\", \"macosx\", function (package) os.vrun(\"./config %s prefix \\\"%s\\\"\", package:debug() and\" debug\"or\"\", package:installdir()) os.vrun(\"make j4\") os.vrun(\"make install\") end) end) ``` ### ä¼ é€’é¢å¤–çš„ç¼–è¯‘ä¿¡æ¯åˆ°åŒ… æŸäº›åŒ…åœ¨ç¼–è¯‘æ—¶å€™æœ‰å„ç§ç¼–è¯‘é€‰é¡¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¼ é€’è¿›æ¥ï¼Œå½“ç„¶åŒ…æœ¬èº«å¾—æ”¯æŒï¼š ```lua add_requires(\"tbox\", {configs {small true}}) ``` ä¼ é€’ ` small true` ç»™ tbox åŒ…ï¼Œä½¿å¾—ç¼–è¯‘å®‰è£…çš„ tbox åŒ…æ˜¯å¯ç”¨æ­¤é€‰é¡¹çš„ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å·¥ç¨‹ç›®å½•ä¸­æ‰§è¡Œï¼š`xmake require info tbox` æ¥è·å–æŒ‡å®šåŒ…æ‰€æœ‰çš„å¯é…ç½®å‚æ•°åˆ—è¡¨å’Œå–å€¼è¯´æ˜ã€‚ æ¯”å¦‚ï¼š ```console xmake require info spdlog require(spdlog): > requires: > plat: macosx > arch: x86_64 > configs: > header_only: true > shared: false > vs_runtime: MT > debug: false > fmt_external: true > noexcept: false > configs: > header_only: Use header only (default: true) > fmt_external: Use external fmt library instead of bundled (default: false) > noexcept: Compile with fno exceptions. Call abort() on any spdlog exceptions (default: false) > configs (builtin): > debug: Enable debug symbols. (default: false) > shared: Enable shared library. (default: false) > cflags: Set the C compiler flags. > cxflags: Set the C/C++ compiler flags. > cxxflags: Set the C++ compiler flags. > asflags: Set the assembler flags. > vs_runtime: Set vs compiler runtime. (default: MT) > values: {\"MT\",\"MD\"} ``` å…¶ä¸­ï¼Œconfigs é‡Œé¢å°±æ˜¯ spdlog åŒ…è‡ªèº«æä¾›çš„å¯é…ç½®å‚æ•°ï¼Œè€Œä¸‹é¢å¸¦æœ‰ builtin çš„ configs éƒ¨åˆ†ï¼Œæ˜¯æ‰€æœ‰åŒ…éƒ½ä¼šæœ‰çš„å†…ç½®é…ç½®å‚æ•°ã€‚ æœ€ä¸Šé¢ requires éƒ¨åˆ†ï¼Œæ˜¯é¡¹ç›®å½“å‰é…ç½®å€¼ã€‚ > `vs_runtime` æ˜¯ç”¨äº msvc ä¸‹ vs runtime çš„è®¾ç½®ï¼Œv2.2.9 ç‰ˆæœ¬ä¸­ï¼Œè¿˜æ”¯æŒæ‰€æœ‰ static ä¾èµ–åŒ…çš„è‡ªåŠ¨ç»§æ‰¿ï¼Œä¹Ÿå°±æ˜¯è¯´ spdlog å¦‚æœè®¾ç½®äº† MDï¼Œé‚£ä¹ˆå®ƒä¾èµ–çš„ fmt åŒ…ä¹Ÿä¼šè‡ªåŠ¨ç»§æ‰¿è®¾ç½® MDã€‚ å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿå¾ˆæ–¹ä¾¿çš„å®šåˆ¶åŒ–è·å–éœ€è¦çš„åŒ…ï¼Œä½†æ˜¯æ¯ä¸ªåŒ…è‡ªèº«ä¹Ÿè®¸æœ‰å¾ˆå¤šä¾èµ–ï¼Œå¦‚æœè¿™äº›ä¾èµ–ä¹Ÿè¦å„ç§å®šåˆ¶åŒ–é…ç½®ï¼Œæ€ä¹ˆåŠï¼Ÿ å¯ä»¥é€šè¿‡ `add_requireconfs` å»é‡å†™å†…éƒ¨ä¾èµ–åŒ…çš„é…ç½®å‚æ•°ã€‚ ### å®‰è£…ä»»æ„ç‰ˆæœ¬çš„åŒ… é»˜è®¤æƒ…å†µä¸‹ï¼Œ`add_requires(\"zlib>1.2.x\")` åªèƒ½é€‰æ‹©åˆ° `xmake repo` ä»“åº“ä¸­å­˜åœ¨çš„åŒ…ç‰ˆæœ¬ï¼Œå› ä¸ºæ¯ä¸ªç‰ˆæœ¬çš„åŒ…ï¼Œå®ƒä»¬éƒ½ä¼šæœ‰ä¸€ä¸ª sha256 çš„æ ¡éªŒå€¼ï¼Œç”¨äºåŒ…çš„å®Œæ•´æ€§æ ¡éªŒã€‚ å› æ­¤ï¼ŒæœªçŸ¥ç‰ˆæœ¬çš„åŒ…ä¸å­˜åœ¨æ ¡éªŒå€¼ï¼Œxmake é»˜è®¤æ˜¯ä¸è®©é€‰æ‹©ä½¿ç”¨çš„ï¼Œè¿™å¹¶ä¸å®‰å…¨ã€‚ é‚£å¦‚æœï¼Œæˆ‘ä»¬éœ€è¦çš„åŒ…ç‰ˆæœ¬æ— æ³•é€‰æ‹©ä½¿ç”¨æ€ä¹ˆåŠå‘¢ï¼Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯æäº¤ä¸€ä¸ª pr ç»™ [xmake repo](https://github.com/xmake io/xmake repo)ï¼Œå¢åŠ æŒ‡å®šåŒ…çš„æ–°ç‰ˆæœ¬ä»¥åŠå¯¹åº”çš„ sha256ï¼Œä¾‹å¦‚ï¼š ```lua package(\"zlib\", function() add_versions(\"1.2.10\", \"8d7e9f698ce48787b6e1c67e6bff79e487303e66077e25cb9784ac8835978017\") add_versions(\"1.2.11\", \"c3e5e9fdd5004dcb542feda5ee4f0ff0744628baf8ed2dd5d66f8ca1197cb1a1\") end) ``` å¦å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯ç”¨æˆ·ä¼ é€’ `{verify false}` é…ç½®ç»™ `add_requires`ï¼Œå¼ºåˆ¶å¿½ç•¥åŒ…çš„æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒï¼Œè¿™æ ·å°±ä¸éœ€è¦ sha256 å€¼ï¼Œå› æ­¤å°±å¯ä»¥å®‰è£…ä»»æ„ç‰ˆæœ¬çš„åŒ…ã€‚ å½“ç„¶ï¼Œè¿™ä¹Ÿä¼šå­˜åœ¨ä¸€å®šçš„å®‰å…¨æ€§ä»¥åŠåŒ…ä¸å®Œæ•´çš„é£é™©ï¼Œè¿™å°±éœ€è¦ç”¨æˆ·è‡ªå·±å»é€‰æ‹©è¯„ä¼°äº†ã€‚ ```lua add_requires(\"zlib 1.2.11\", {verify false}) ``` ### ç¦ç”¨å¤–éƒ¨å¤´æ–‡ä»¶æœç´¢è·¯å¾„ é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡ `add_requires` å®‰è£…çš„åŒ…ä¼šé‡‡ç”¨ ` isystem` æˆ–è€… `/external:I` æ¥å¼•ç”¨é‡Œé¢çš„å¤´æ–‡ä»¶è·¯å¾„ï¼Œè¿™é€šå¸¸èƒ½å¤Ÿé¿å…ä¸€äº›åŒ…å¤´æ–‡ä»¶å¼•å…¥çš„ä¸å¯ä¿®æ”¹çš„è­¦å‘Šä¿¡æ¯ï¼Œ ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡è®¾ç½® `{external false}` æ¥ç¦ç”¨å¤–éƒ¨å¤´æ–‡ä»¶ï¼Œåˆ‡å› ` I` çš„ä½¿ç”¨ã€‚ é»˜è®¤å¯ç”¨äº† external å¤–éƒ¨å¤´æ–‡ä»¶çš„ç¼–è¯‘ flags å¦‚ä¸‹ï¼š ```console isystem /Users/ruki/.xmake/packages/z/zlib/1.2.11/d639b7d6e3244216b403b39df5101abf/include ``` æ‰‹åŠ¨å…³é—­ external å¤–éƒ¨å¤´æ–‡ä»¶çš„ç¼–è¯‘ flags å¦‚ä¸‹ï¼š ```lua add_requires(\"zlib 1.x\", {external false}) ``` ```console I /Users/ruki/.xmake/packages/z/zlib/1.2.11/d639b7d6e3244216b403b39df5101abf/include ``` ## ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…å®‰è£… xmake æ”¯æŒå¯¹å¯¹ç¬¬ä¸‰æ–¹åŒ…ç®¡ç†å™¨é‡Œé¢çš„ä¾èµ–åº“å®‰è£…æ”¯æŒï¼Œä¾‹å¦‚ï¼šconan, brew, vcpkg ç­‰ ### æ·»åŠ  homebrew çš„ä¾èµ–åŒ… ```lua add_requires(\"brew::zlib\", {alias \"zlib\"}) add_requires(\"brew::pcre2/libpcre2 8\", {alias \"pcre2\"}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"pcre2\", \"zlib\") end) ``` ### æ·»åŠ  vcpkg çš„ä¾èµ–åŒ… ```lua add_requires(\"vcpkg::zlib\", \"vcpkg::pcre2\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"vcpkg::zlib\", \"vcpkg::pcre2\") end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥åŠ ä¸ªåŒ…åˆ«åï¼Œç®€åŒ–å¯¹ `add_packages` çš„ä½¿ç”¨ï¼š ```lua add_requires(\"vcpkg::zlib\", {alias \"zlib\"}) add_requires(\"vcpkg::pcre2\", {alias \"pcre2\"}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"zlib\", \"pcre2\") end) ``` å¦‚æœ vcpkg åŒ…å¸¦æœ‰å¯é€‰ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ vcpkg çš„è¯­æ³•æ ¼å¼ `packagename[feature1,feature2]` æ¥å®‰è£…åŒ…ã€‚ ä¾‹å¦‚ï¼š ```lua add_requires(\"vcpkg::boost[core]\") ``` xmake æ”¯æŒ vcpkg æ–°çš„æ¸…å•æ¨¡å¼ï¼Œé€šè¿‡å®ƒï¼Œæˆ‘ä»¬å°±èƒ½æ”¯æŒ vcpkg åŒ…çš„ç‰ˆæœ¬é€‰æ‹©ï¼Œä¾‹å¦‚ï¼š ```lua add_requires(\"vcpkg::zlib 1.2.11\") add_requires(\"vcpkg::fmt> 8.0.1\", {configs {baseline \"50fd3d9957195575849a49fa591e645f1d8e7156\"}}) add_requires(\"vcpkg::libpng\", {configs {features {\"apng\"}}}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") add_packages(\"vcpkg::zlib\", \"vcpkg::fmt\", \"vcpkg::libpng\") end) ``` è¿˜å¯ä»¥é¢å¤–é…ç½®ç§æœ‰ä»“åº“ï¼Œä»…æ¸…å•æ¨¡å¼æœ‰æ•ˆã€‚ ```lua local registries { { kind \"git\", repository \"https://github.com/SakuraEngine/vcpkg registry\", baseline \"e0e1e83ec66e3c9b36066f79d133b01eb68049f7\", packages { \"skrgamenetworkingsockets\" } } } add_requires(\"vcpkg::skrgamenetworkingsockets> 1.4.0+1\", {configs {registries registries}}) ``` ### æ·»åŠ  conan çš„ä¾èµ–åŒ… ```lua add_requires(\"conan::zlib/1.2.11\", {alias \"zlib\", debug true}) add_requires(\"conan::openssl/1.1.1g\", {alias \"openssl\", configs {options \"OpenSSL:shared True\"}}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"openssl\", \"zlib\") end) ``` æ‰§è¡Œ xmake è¿›è¡Œç¼–è¯‘åï¼š ```console ruki:test_package ruki$ xmake checking for the architecture ... x86_64 checking for the Xcode directory ... /Applications/Xcode.app checking for the SDK version of Xcode ... 10.14 note: try installing these packages (pass y to skip confirm)? > conan::zlib/1.2.11 (debug) > conan::openssl/1.1.1g please input: y (y/n) > installing conan::zlib/1.2.11 .. ok > installing conan::openssl/1.1.1g .. ok [0%]: cache compiling.release src/main.c [100%]: linking.release test ``` è‡ªå®šä¹‰ conan/settings é…ç½®ï¼š ```lua add_requires(\"conan::poco/1.10.0\", {alias \"poco\", configs {settings {\"compiler gcc\", \"compiler.libcxx libstdc++11\"}}}) ``` å…¶ä»–ä¸€äº› conan ç›¸å…³é…ç½®é¡¹ï¼š ``` { build {description \"use it to choose if you want to build from sources.\", default \"missing\", values {\"all\", \"never\", \"missing\", \"outdated\"}}, remote {description \"Set the conan remote server.\"}, options {description \"Set the options values, e.g. OpenSSL:shared True\"}, imports {description \"Set the imports for conan.\"}, settings {description \"Set the build settings for conan.\"}, build_requires {description \"Set the build requires for conan.\", default \"xmake_generator/0.1.0@bincrafters/testing\"} } ``` ### æ·»åŠ  conda çš„ä¾èµ–åŒ… ```lua add_requires(\"conda::zlib 1.2.11\", {alias \"zlib\"}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"zlib\") end) ``` ### æ·»åŠ  pacman çš„ä¾èµ–åŒ… æˆ‘ä»¬æ—¢æ”¯æŒ archlinux ä¸Šçš„ pacman åŒ…å®‰è£…å’Œé›†æˆï¼Œä¹Ÿæ”¯æŒ msys2 ä¸Š pacman çš„ mingw x86_64/i386 åŒ…å®‰è£…å’Œé›†æˆã€‚ ```lua add_requires(\"pacman::zlib\", {alias \"zlib\"}) add_requires(\"pacman::libpng\", {alias \"libpng\"}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"zlib\", \"libpng\") end) ``` archlinux ä¸Šåªéœ€è¦ï¼š ```console xmake ``` msys2 ä¸Šå®‰è£… mingw åŒ…ï¼Œéœ€è¦æŒ‡å®šåˆ° mingw å¹³å°ï¼š ```console xmake f p mingw a [x86_64i386] xmake ``` ### æ·»åŠ  clib çš„ä¾èµ–åŒ… clib æ˜¯ä¸€æ¬¾åŸºäºæºç çš„ä¾èµ–åŒ…ç®¡ç†å™¨ï¼Œæ‹‰å–çš„ä¾èµ–åŒ…æ˜¯ç›´æ¥ä¸‹è½½å¯¹åº”çš„åº“æºç ï¼Œé›†æˆåˆ°é¡¹ç›®ä¸­ç¼–è¯‘ï¼Œè€Œä¸æ˜¯äºŒè¿›åˆ¶åº“ä¾èµ–ã€‚ å…¶åœ¨ xmake ä¸­é›†æˆä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿˜éœ€è¦è‡ªå·±æ·»åŠ ä¸Šå¯¹åº”åº“çš„æºç åˆ° xmake.luaï¼Œä¾‹å¦‚ï¼š ```lua add_requires(\"clib::clibs/bytes@0.0.4\", {alias \"bytes\"}) target(\"test\", function() set_kind(\"binary\") add_files(\"clib/bytes/*.c\") add_files(\"src/*.c\") add_packages(\"bytes\") end) ``` ### æ·»åŠ  dub/dlang çš„ä¾èµ–åŒ… xmake ä¹Ÿæ”¯æŒ dlang çš„ dub åŒ…ç®¡ç†å™¨ï¼Œé›†æˆ dlang çš„ä¾èµ–åŒ…æ¥ä½¿ç”¨ã€‚ ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"dub::log 0.4.3\", {alias \"log\"}) add_requires(\"dub::dateparser\", {alias \"dateparser\"}) add_requires(\"dub::emsi_containers\", {alias \"emsi_containers\"}) add_requires(\"dub::stdx allocator\", {alias \"stdx allocator\"}) add_requires(\"dub::mir core\", {alias \"mir core\"}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.d\") add_packages(\"log\", \"dateparser\", \"emsi_containers\", \"stdx allocator\", \"mir core\") end) ``` ### æ·»åŠ  ubuntu/apt çš„ä¾èµ–åŒ… xmake æ”¯æŒä½¿ç”¨ apt é›†æˆä¾èµ–åŒ…ï¼Œä¹Ÿä¼šè‡ªåŠ¨æŸ¥æ‰¾ ubuntu ç³»ç»Ÿä¸Šå·²ç»å®‰è£…çš„åŒ…ã€‚ ```lua add_requires(\"apt::zlib1g dev\", {alias \"zlib\"}) target(\"test\") set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"zlib\") ``` ### æ·»åŠ  gentoo/portage çš„ä¾èµ–åŒ… v2.5.4 ä¹‹åç‰ˆæœ¬æ”¯æŒä½¿ç”¨ Portage é›†æˆä¾èµ–åŒ…ï¼Œä¹Ÿä¼šè‡ªåŠ¨æŸ¥æ‰¾ Gentoo ç³»ç»Ÿä¸Šå·²ç»å®‰è£…çš„åŒ…ã€‚ ```lua add_requires(\"portage::libhandy\", {alias \"libhandy\"}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"libhandy\") end) ``` ### æ·»åŠ  nimble çš„ä¾èµ–åŒ… xmake æ”¯æŒé›†æˆ nimble åŒ…ç®¡ç†å™¨ä¸­çš„åŒ…ï¼Œä½†æ˜¯ç›®å‰ä»…ç”¨äº nim é¡¹ç›®ï¼Œå› ä¸ºå®ƒå¹¶æ²¡æœ‰æä¾›äºŒè¿›åˆ¶çš„åŒ…ï¼Œè€Œæ˜¯ç›´æ¥å®‰è£…çš„ nim ä»£ç åŒ…ã€‚ ```lua add_requires(\"nimble::zip>1.3\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/main.nim\") add_packages(\"nimble::zip\") end) ``` ### æ·»åŠ  cargo çš„ä¾èµ–åŒ… Cargo ä¾èµ–åŒ…ä¸»è¦ç»™ rust é¡¹ç›®é›†æˆä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š ```lua add_rules(\"mode.release\", \"mode.debug\") add_requires(\"cargo::base64 0.13.0\") add_requires(\"cargo::flate2 1.0.17\", {configs {features \"zlib\"}}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/main.rs\") add_packages(\"cargo::base64\", \"cargo::flate2\") end) ``` ä¸è¿‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ C++ ä¸­é€šè¿‡ cxxbridge çš„æ–¹å¼ï¼Œè°ƒç”¨ Rust åº“æ¥å£ï¼Œæ¥å˜ç›¸å¤ç”¨æ‰€æœ‰çš„ Rust åŒ…ã€‚ å®Œæ•´ä¾‹å­è§ï¼š[Call Rust in C++](https://github.com/xmake io/xmake/tree/dev/tests/projects/rust/cxx_call_rust_library) ### æ·»åŠ  NuGet çš„ä¾èµ–åŒ… xmake ä¹Ÿæ”¯æŒä» dotnet/nuget ä¸­ï¼Œè·å– native åº“å¹¶å¿«é€Ÿé›†æˆã€‚ ```lua add_requires(\"nuget::zlib_static\", {alias \"zlib\"}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") add_packages(\"zlib\") end) ``` ## ä½¿ç”¨è‡ªå»ºç§æœ‰åŒ…ä»“åº“ å¦‚æœéœ€è¦çš„åŒ…ä¸åœ¨å®˜æ–¹ä»“åº“ [xmake repo](https://github.com/xmake io/xmake repo) ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æäº¤è´¡çŒ®ä»£ç åˆ°ä»“åº“è¿›è¡Œæ”¯æŒã€‚ ä½†å¦‚æœæœ‰äº›åŒ…ä»…ç”¨äºä¸ªäººæˆ–è€…ç§æœ‰é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªç§æœ‰ä»“åº“ repoï¼Œä»“åº“ç»„ç»‡ç»“æ„å¯å‚è€ƒï¼š[xmake repo](https://github.com/xmake io/xmake repo) æ¯”å¦‚ï¼Œç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸€ä¸ªç§æœ‰ä»“åº“ repoï¼š`git@github.com:myrepo/xmake repo.git` æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œä»“åº“æ·»åŠ ï¼š ```console $ xmake repo add myrepo git@github.com:myrepo/xmake repo.git [branch] ``` > [branch] æ˜¯å¯é€‰çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ‡æ¢åˆ°æŒ‡å®š repo åˆ†æ”¯ æˆ–è€…æˆ‘ä»¬ç›´æ¥å†™åœ¨ xmake.lua ä¸­ï¼š ```lua add_repositories(\"my repo git@github.com:myrepo/xmake repo.git\") ``` åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ‡æ¢åˆ°æŒ‡å®š repo åˆ†æ”¯ ```lua add_repositories(\"my repo git@github.com:myrepo/xmake repo.git dev\") ``` å¦‚æœæˆ‘ä»¬åªæ˜¯æƒ³æ·»åŠ ä¸€ä¸¤ä¸ªç§æœ‰åŒ…ï¼Œè¿™ä¸ªæ—¶å€™ç‰¹å®šå»å»ºç«‹ä¸€ä¸ª git repo å¤ªå°é¢˜å¤§åšäº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠåŒ…ä»“åº“æ”¾ç½®é¡¹ç›®é‡Œé¢ï¼Œä¾‹å¦‚ï¼š ``` projectdir myrepo packages t/tbox/xmake.lua z/zlib/xmake.lua src main.c xmake.lua ``` ä¸Šé¢ myrepo ç›®å½•å°±æ˜¯è‡ªå·±çš„ç§æœ‰åŒ…ä»“åº“ï¼Œå†…ç½®åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé¢ï¼Œç„¶ååœ¨ xmake.lua é‡Œé¢æ·»åŠ ä¸€ä¸‹è¿™ä¸ªä»“åº“ä½ç½®ï¼š ```lua add_repositories(\"my repo myrepo\") ``` è¿™ä¸ªå¯ä»¥å‚è€ƒ [benchbox](https://github.com/xmake io/benchbox) é¡¹ç›®ï¼Œé‡Œé¢å°±å†…ç½®äº†ä¸€ä¸ªç§æœ‰ä»“åº“ã€‚ æˆ‘ä»¬ç”šè‡³å¯ä»¥è¿ä»“åº“ä¹Ÿä¸ç”¨å»ºï¼Œç›´æ¥å®šä¹‰åŒ…æè¿°åˆ°é¡¹ç›® xmake.lua ä¸­ï¼Œè¿™å¯¹ä¾èµ–ä¸€ä¸¤ä¸ªåŒ…çš„æƒ…å†µè¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œä¾‹å¦‚ï¼š ```lua package(\"libjpeg\", function() set_urls(\"http://www.ijg.org/files/jpegsrc.$(version).tar.gz\") add_versions(\"v9c\", \"650250979303a649e21f87b5ccd02672af1ea6954b911342ea491f351ceb7122\") on_install(\"windows\", function (package) os.mv(\"jconfig.vc\", \"jconfig.h\") os.vrun(\"nmake f makefile.vc\") os.cp(\"*.h\", package:installdir(\"include\")) os.cp(\"libjpeg.lib\", package:installdir(\"lib\")) end) on_install(\"macosx\", \"linux\", function (package) import(\"package.tools.autoconf\").install(package) end) end) add_requires(\"libjpeg\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"libjpeg\") end) ``` å…³äºå¦‚ä½•ç¼–å†™è‡ªå®šä¹‰åŒ…æè¿°è§„åˆ™ï¼Œè¯¦æƒ…è§ï¼š[æ·»åŠ åŒ…åˆ°ä»“åº“](# æ·»åŠ åŒ…åˆ°ä»“åº“) ## åŒ…ç®¡ç†å‘½ä»¤ä½¿ç”¨ åŒ…ç®¡ç†å‘½ä»¤ `$ xmake require` å¯ç”¨äºæ‰‹åŠ¨æ˜¾ç¤ºçš„ä¸‹è½½ç¼–è¯‘å®‰è£…ã€å¸è½½ã€æ£€ç´¢ã€æŸ¥çœ‹åŒ…ä¿¡æ¯ã€‚ ### xrepo å‘½ä»¤ `xmake require` ä»…ç”¨äºå½“å‰å·¥ç¨‹ï¼Œæˆ‘ä»¬ä¹Ÿæä¾›äº†æ›´åŠ æ–¹ä¾¿çš„ç‹¬ç«‹ `xrepo` åŒ…ç®¡ç†å™¨å‘½ä»¤ï¼Œæ¥å…¨å±€å¯¹åŒ…è¿›è¡Œå®‰è£…ï¼Œå¸è½½å’ŒæŸ¥æ‰¾ç®¡ç†ã€‚ è¯¦ç»†æ–‡æ¡£è§ï¼š[Xrepo å‘½ä»¤ä½¿ç”¨å…¥é—¨](https://xrepo.xmake.io/#/zh cn/getting_started) ### å®‰è£…æŒ‡å®šåŒ… ```console $ xmake require tbox ``` å®‰è£…æŒ‡å®šç‰ˆæœ¬åŒ…ï¼š ```console $ xmake require tbox \"~1.6\" ``` å¼ºåˆ¶é‡æ–°ä¸‹è½½å®‰è£…ï¼Œå¹¶ä¸”æ˜¾ç¤ºè¯¦ç»†å®‰è£…ä¿¡æ¯ï¼š ```console $ xmake require f v tbox \"1.5.x\" ``` ä¼ é€’é¢å¤–çš„è®¾ç½®ä¿¡æ¯ï¼š ```console $ xmake require extra \"{debug true,config {small true}}\" tbox ``` å®‰è£… debug åŒ…ï¼Œå¹¶ä¸”ä¼ é€’ `small true` çš„ç¼–è¯‘é…ç½®ä¿¡æ¯åˆ°åŒ…ä¸­å»ã€‚ ### å¸è½½æŒ‡å®šåŒ… ```console $ xmake require uninstall tbox ``` è¿™ä¼šå®Œå…¨å¸è½½åˆ é™¤åŒ…æ–‡ä»¶ã€‚ ### æŸ¥çœ‹åŒ…è¯¦ç»†ä¿¡æ¯ ```console $ xmake require info tbox ``` ### åœ¨å½“å‰ä»“åº“ä¸­æœç´¢åŒ… ```console $ xmake require search tbox ``` è¿™ä¸ªæ˜¯æ”¯æŒæ¨¡ç³Šæœç´ ä»¥åŠ lua æ¨¡å¼åŒ¹é…æœç´¢çš„ï¼š ```console $ xmake require search pcr ``` ä¼šåŒæ—¶æœç´¢åˆ° pcre, pcre2 ç­‰åŒ…ã€‚ ### åˆ—ä¸¾å½“å‰å·²å®‰è£…çš„åŒ… ```console $ xmake require list ``` ## ä»“åº“ç®¡ç†å‘½ä»¤ä½¿ç”¨ ä¸Šæ–‡å·²ç»ç®€å•è®²è¿‡ï¼Œæ·»åŠ ç§æœ‰ä»“åº“å¯ä»¥ç”¨ï¼ˆæ”¯æŒæœ¬åœ°è·¯å¾„æ·»åŠ ï¼‰ï¼š ```console $ xmake repo add myrepo git@github.com:myrepo/xmake repo.git ``` xmake æ”¯æŒæ·»åŠ æŒ‡å®šåˆ†æ”¯çš„ repoï¼Œä¾‹å¦‚ï¼š ```console $ xmake repo add myrepo git@github.com:myrepo/xmake repo.git dev ``` > æˆ‘ä»¬ä¹Ÿå¯ä»¥æ·»åŠ æœ¬åœ°ä»“åº“è·¯å¾„ï¼Œå³ä½¿æ²¡æœ‰ git ä¹Ÿæ˜¯å¯ä»¥æ”¯æŒçš„ï¼Œç”¨äºåœ¨æœ¬åœ°å¿«é€Ÿçš„è°ƒè¯• repo ä¸­çš„åŒ…ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥ç§»é™¤å·²å®‰è£…çš„æŸä¸ªä»“åº“ï¼š ```console $ xmake repo remove myrepo ``` æˆ–è€…æŸ¥çœ‹æ‰€æœ‰å·²æ·»åŠ çš„ä»“åº“ï¼š ```console $ xmake repo list ``` å¦‚æœè¿œç¨‹ä»“åº“æœ‰æ›´æ–°ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œä»“åº“æ›´æ–°ï¼Œæ¥è·å–æ›´å¤šã€æœ€æ–°çš„åŒ…ï¼š ```console $ xmake repo u ``` ## è¿œç¨‹åŒ…ä¸‹è½½ä¼˜åŒ– å¦‚æœç”±äºç½‘ç»œä¸ç¨³å®šï¼Œå¯¼è‡´ä¸‹è½½åŒ…é€Ÿåº¦å¾ˆæ…¢æˆ–è€…ä¸‹è½½å¤±è´¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡çš„ä¸‹é¢çš„ä¸€äº›æ–¹å¼æ¥è§£å†³ã€‚ ### æ‰‹åŠ¨ä¸‹è½½ é»˜è®¤ xmake ä¼šè°ƒç”¨ curl, wget ç­‰å·¥å…·æ¥ä¸‹è½½ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç”¨è‡ªå·±çš„ä¸‹è½½å™¨ä¸‹è½½ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨ä»£ç†ï¼‰ï¼ŒæŠŠä¸‹è½½åçš„åŒ…æ”¾åˆ°è‡ªå·±çš„ç›®å½•ä¸‹ï¼Œæ¯”å¦‚: `/download/packages/zlib v1.0.tar.gz` ç„¶åä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œè®¾ç½®åŒ…ä¸‹è½½çš„æœç´¢ç›®å½•ï¼š ```console $ xmake g pkg_searchdirs \"/download/packages\" ``` ç„¶åé‡æ–°æ‰§è¡Œ xmake ç¼–è¯‘æ—¶å€™ï¼Œxmake ä¼šä¼˜å…ˆä» `/download/packages` æ‰¾å¯»æºç åŒ…ï¼Œç„¶åç›´æ¥ä½¿ç”¨ï¼Œä¸å†è‡ªå·±ä¸‹è½½äº†ã€‚ è‡³äºæ‰¾å¯»çš„åŒ…åæ˜¯æ€æ ·çš„å‘¢ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š ```console $ xmake require info zlib > searchdirs: /download/packages > searchnames: zlib 1.2.11.tar.gz ``` æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹åº”çš„æœç´¢ç›®å½•ä»¥åŠæœç´¢çš„åŒ…åã€‚ ### è®¾ç½®ä»£ç† å¦‚æœè§‰å¾—æ‰‹åŠ¨ä¸‹è½½è¿˜æ˜¯éº»çƒ¦ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®© xmake ç›´æ¥èµ°ä»£ç†ã€‚ ```console $ xmake g proxy \"socks5://127.0.0.1:1086\" $ xmake g help x PROXY, proxy PROXY Use proxy on given port. [PROTOCOL://]HOST[:PORT] e.g. xmake g proxy 'http://host:port' xmake g proxy 'https://host:port' xmake g proxy 'socks5://host:port' ``` ` proxy` å‚æ•°æŒ‡å®šä»£ç†åè®®å’Œåœ°å€ï¼Œå…·ä½“è¯­æ³•å¯ä»¥å‚è€ƒ curl çš„ï¼Œé€šå¸¸å¯ä»¥æ”¯æŒ http, https, socks5 ç­‰åè®®ï¼Œä½†å®é™…æ”¯æŒåŠ›åº¦ä¾èµ– curl, wget å’Œ gitï¼Œæ¯”å¦‚ wget å°±ä¸æ”¯æŒ socks5 åè®®ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‚æ•°æŒ‡å®šå“ªäº› host èµ°ä»£ç†ï¼Œå¦‚æœæ²¡è®¾ç½®ï¼Œé»˜è®¤å…¨å±€èµ°ä»£ç†ã€‚ ```console proxy_hosts PROXY_HOSTS Only enable proxy for the given hosts list, it will enable all if be unset, and we can pass match pattern to list: e.g. xmake g proxy_hosts 'github.com,gitlab.*,*.xmake.io' ``` å¦‚æœè®¾ç½®äº† hosts åˆ—è¡¨ï¼Œé‚£ä¹ˆä¹‹åè¿™ä¸ªåˆ—è¡¨é‡Œé¢åŒ¹é…çš„ host æ‰èµ°ä»£ç†ã€‚ã€‚ ` proxy_host` æ”¯æŒå¤šä¸ª hosts è®¾ç½®ï¼Œé€—å·åˆ†éš”ï¼Œå¹¶ä¸”æ”¯æŒåŸºç¡€çš„æ¨¡å¼åŒ¹é… *.github.comï¼Œ ä»¥åŠå…¶ä»– lua æ¨¡å¼åŒ¹é…è§„åˆ™ä¹Ÿæ”¯æŒ å¦‚æœè§‰å¾—ä¸Šé¢çš„ hosts æ¨¡å¼é…ç½®è¿˜ä¸å¤Ÿçµæ´»ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥èµ° pac çš„è‡ªåŠ¨ä»£ç†é…ç½®è§„åˆ™ï¼š ```console proxy_pac PROXY_PAC Set the auto proxy configuration file. (default: pac.lua) e.g. xmake g proxy_pac pac.lua (in /Users/ruki/.xmake or absolute path) function main(url, host) if host 'github.com' then return true end end ``` > å¦‚æœæœ‰ proxy_hosts ä¼˜å…ˆèµ° hosts é…ç½®ï¼Œæ²¡æœ‰çš„è¯æ‰èµ° pac é…ç½®ã€‚ pac çš„é»˜è®¤è·¯å¾„ï¼š~/.xmake/pac.luaï¼Œå¦‚æœ proxy è¢«è®¾ç½®ï¼Œå¹¶ä¸”è¿™ä¸ªæ–‡ä»¶å­˜åœ¨ï¼Œå°±ä¼šè‡ªåŠ¨èµ° pacï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œä¹Ÿæ²¡ hostsï¼Œé‚£å°±å…¨å±€ç”Ÿæ•ˆä»£ç†ã€‚ ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®š pac å…¨è·¯å¾„ ```console $ xmake g proxy_pac /xxxx/xxxxx_pac.lua ``` é…ç½®è§„åˆ™æè¿°ï¼š ```lua function main(url, host) if host:find(\"bintray.com\") then return true end end ``` å¦‚æœè¿”å› trueï¼Œé‚£ä¹ˆè¿™ä¸ª url å’Œ host å°±æ˜¯èµ°çš„ä»£ç†ï¼Œä¸è¿”å›æˆ–è€…è¿”å› falseï¼Œå°±æ˜¯ä¸èµ°ä»£ç†ã€‚ è¿™å—çš„å…·ä½“è¯¦æƒ…è§ï¼š<https://github.com/xmake io/xmake/issues/854> > å¦å¤–ï¼Œé™¤äº†ä¾èµ–åŒ…ä¸‹è½½ï¼Œå…¶ä»–æ¶‰åŠç½‘ç»œä¸‹è½½çš„å‘½ä»¤ä¹Ÿéƒ½æ”¯æŒä»£ç†ï¼Œæ¯”å¦‚ï¼š`xmake update` #### é•œåƒä»£ç† v2.5.4 ä¹‹åï¼Œpac.lua é…ç½®é‡Œé¢è¿˜å¯ä»¥é…ç½®é•œåƒä»£ç†è§„åˆ™ï¼Œæ¯”å¦‚å¯¹æ‰€æœ‰ github.com åŸŸåçš„è®¿é—®åˆ‡åˆ° hub.fastgit.org åŸŸåï¼Œå®ç°åŠ é€Ÿä¸‹è½½åŒ…ã€‚ ```lua function mirror(url) return url:gsub(\"github.com\", \"hub.fastgit.org\") end ``` ```console $ xrepo install libpng > curl https://hub.fastgit.org/glennrp/libpng/archive/v1.6.37.zip o v1.6.37.zip ``` ## æ·»åŠ åŒ…åˆ°ä»“åº“ ### ä»“åº“åŒ…ç»“æ„ åœ¨åˆ¶ä½œè‡ªå·±çš„åŒ…ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸‹ä¸€ä¸ªåŒ…ä»“åº“çš„ç»“æ„ï¼Œä¸ç®¡æ˜¯å®˜æ–¹åŒ…ä»“åº“ï¼Œè¿˜æ˜¯è‡ªå»ºç§æœ‰åŒ…ä»“åº“ï¼Œç»“æ„éƒ½æ˜¯ç›¸åŒçš„ï¼š ``` xmake repo packages t/tbox/xmake.lua z/zlib/xmake.lua ``` é€šè¿‡ä¸Šé¢çš„ç»“æ„ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªåŒ…éƒ½ä¼šæœ‰ä¸ª xmake.lua ç”¨äºæè¿°å®ƒçš„å®‰è£…è§„åˆ™ï¼Œå¹¶ä¸”æ ¹æ® `z/zlib` ä¸¤çº§å­ç›®å½•åˆ†ç±»å­˜å‚¨ï¼Œæ–¹ä¾¿å¿«é€Ÿæ£€ç´¢ã€‚ ### åŒ…æè¿°è¯´æ˜ å…³äºåŒ…çš„æè¿°è§„åˆ™ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨å®ƒçš„ xmake.lua é‡Œé¢å®Œæˆçš„ï¼Œè¿™è·Ÿé¡¹ç›®å·¥ç¨‹é‡Œé¢çš„ xmake.lua æè¿°å¾ˆç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯æè¿°åŸŸä»…æ”¯æŒ `package()`ï¼Œ ä¸è¿‡ï¼Œåœ¨é¡¹ç›® xmake.lua é‡Œé¢ï¼Œä¹Ÿæ˜¯å¯ä»¥ç›´æ¥æ·»åŠ  `package()` æ¥å†…ç½®åŒ…æè¿°çš„ï¼Œè¿åŒ…ä»“åº“éƒ½çœäº†ï¼Œæœ‰æ—¶å€™è¿™æ ·ä¼šæ›´åŠ æ–¹ä¾¿ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ‹¿ zlib çš„æè¿°è§„åˆ™ï¼Œæ¥ç›´è§‚æ„Ÿå—ä¸‹ï¼Œè¿™ä¸ªè§„åˆ™å¯ä»¥åœ¨ [xmake repo/z/zlib/xmake.lua](https://github.com/xmake io/xmake repo/blob/master/packages/z/zlib/xmake.lua) ä¸‹æ‰¾åˆ°ã€‚ ```lua package(\"zlib\", function() set_homepage(\"http://www.zlib.net\") set_description(\"A Massively Spiffy Yet Delicately Unobtrusive Compression Library\") set_urls(\"http://zlib.net/zlib $(version).tar.gz\", \"https://downloads.sourceforge.net/project/libpng/zlib/$(version)/zlib $(version).tar.gz\") add_versions(\"1.2.10\", \"8d7e9f698ce48787b6e1c67e6bff79e487303e66077e25cb9784ac8835978017\") add_versions(\"1.2.11\", \"c3e5e9fdd5004dcb542feda5ee4f0ff0744628baf8ed2dd5d66f8ca1197cb1a1\") on_install(\"windows\", function (package) io.gsub(\"win32/Makefile.msc\", \"% MD\", \" \" .. package:config(\"vs_runtime\")) os.vrun(\"nmake f win32\\\\Makefile.msc zlib.lib\") os.cp(\"zlib.lib\", package:installdir(\"lib\")) os.cp(\"*.h\", package:installdir(\"include\")) end) on_install(\"linux\", \"macosx\", function (package) import(\"package.tools.autoconf\").install(package, {\" static\"}) end) on_install(\"iphoneos\", \"android@linux,macosx\", \"mingw@linux,macosx\", function (package) import(\"package.tools.autoconf\").configure(package, {host \"\",\" static\"}) io.gsub(\"Makefile\", \"\\nAR . \\n\", \"\\nAR \" .. (package:build_getenv(\"ar\") or \"\") ..\"\\n\") io.gsub(\"Makefile\", \"\\nARFLAGS . \\n\", \"\\nARFLAGS cr\\n\") io.gsub(\"Makefile\", \"\\nRANLIB . \\n\", \"\\nRANLIB \\n\") os.vrun(\"make install j4\") end) on_test(function (package) assert(package:has_cfuncs(\"inflate\", {includes \"zlib.h\"})) end) end) ``` è¿™ä¸ªåŒ…è§„åˆ™å¯¹ windows, linux, macosx, iphoneosï¼Œmingw ç­‰å¹³å°éƒ½æ·»åŠ äº†å®‰è£…è§„åˆ™ï¼ŒåŸºæœ¬ä¸Šå·²ç»åšåˆ°äº†å…¨å¹³å°è¦†ç›–ï¼Œç”šè‡³ä¸€äº›äº¤å‰ç¼–è¯‘å¹³å°ï¼Œç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„ä¾‹å­äº†ã€‚ å½“ç„¶ï¼Œæœ‰äº›åŒ…ä¾èµ–æºç å®ç°åŠ›åº¦ï¼Œå¹¶ä¸èƒ½å®Œå…¨è·¨å¹³å°ï¼Œé‚£ä¹ˆåªéœ€å¯¹å®ƒæ”¯æŒçš„å¹³å°è®¾ç½®å®‰è£…è§„åˆ™å³å¯ã€‚ æ›´å¤šè¯¦ç»†çš„åŒ…é…ç½® API è¯´æ˜è§ï¼š[åŒ…æ¥å£æ–‡æ¡£](/zh cn/manual/package_dependencies) ### æ‰©å±•é…ç½®å‚æ•° è¯¦æƒ…è§ï¼š[add_configs](/zh cn/manual/package_dependencies?id packageadd_configs) ### å†…ç½®é…ç½®å‚æ•° é™¤äº†å¯ä»¥é€šè¿‡ [add_configs](/zh cn/manual/package_dependencies?id packageadd_configs) è®¾ç½®ä¸€äº›æ‰©å±•çš„é…ç½®å‚æ•°ä»¥å¤–ï¼Œxmake è¿˜æä¾›äº†ä¸€äº›å†…ç½®çš„é…ç½®å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ #### å¯ç”¨è°ƒè¯•åŒ… ```lua add_requires(\"xxx\", {debug true}) ``` åŒ…æè¿°é‡Œé¢å¿…é¡»æœ‰ç›¸å…³å¤„ç†æ‰èƒ½æ”¯æŒï¼š ```lua on_install(function (package) local configs {} if package:debug() then table.insert(configs, \" enable debug\") end import(\"package.tools.autoconf\").install(package) end) ``` #### è®¾ç½® msvc è¿è¡Œæ—¶åº“ ```lua add_requires(\"xxx\", {configs {vs_runtime \"MT\"}}) ``` é€šå¸¸æƒ…å†µä¸‹ï¼Œé€šè¿‡ `import(\"package.tools.autoconf\").install` ç­‰å†…ç½®å·¥å…·è„šæœ¬å®‰è£…çš„åŒ…ï¼Œå†…éƒ¨éƒ½å¯¹ vs_runtime è‡ªåŠ¨å¤„ç†è¿‡äº†ã€‚ ä½†æ˜¯å¦‚æœæ˜¯ä¸€äº›ç‰¹æ®Šçš„æºç åŒ…ï¼Œæ„å»ºè§„åˆ™æ¯”è¾ƒç‰¹æ®Šï¼Œé‚£ä¹ˆéœ€è¦è‡ªå·±å¤„ç†äº†ï¼š ```lua on_install(function (package) io.gsub(\"build/Makefile.win32.common\", \"% MD\", \" \" .. package:config(\"vs_runtime\")) end) ``` ### æ·»åŠ ç¯å¢ƒå˜é‡ å¯¹äºä¸€äº›åº“ï¼Œé‡Œé¢ä¹Ÿå¸¦äº†å¯æ‰§è¡Œçš„å·¥å…·ï¼Œå¦‚æœéœ€è¦åœ¨é›†æˆåŒ…çš„æ—¶å€™ï¼Œä½¿ç”¨ä¸Šè¿™äº›å·¥å…·ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥è®¾ç½®ä¸Šå¯¹åº” PATH ç¯å¢ƒå˜é‡ï¼š ```lua package(\"luajit\", function() on_load(function (package) if is_plat(\"windows\") then package:addenv(\"PATH\", \"lib\") end package:addenv(\"PATH\", \"bin\") end) end) ``` è€Œåœ¨é¡¹ç›®å·¥ç¨‹ä¸­ï¼Œåªæœ‰é€šè¿‡ `add_packages` é›†æˆå¯¹åº”çš„åŒ…åï¼Œå¯¹åº”çš„ç¯å¢ƒå˜é‡æ‰ä¼šç”Ÿæ•ˆã€‚ ```lua add_requires(\"luajit\") target(\"test\", function() set_kind(\"binary\") add_packages(\"luajit\") after_run(function (package) os.exec(\"luajit version\") end) end) ``` ### å®‰è£…äºŒè¿›åˆ¶åŒ… xmake ä¹Ÿæ˜¯æ”¯æŒç›´æ¥å¼•ç”¨äºŒè¿›åˆ¶ç‰ˆæœ¬åŒ…ï¼Œç›´æ¥å®‰è£…ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š ```lua if is_plat(\"windows\") then set_urls(\"https://www.libsdl.org/release/SDL2 devel $(version) VC.zip\") add_versions(\"2.0.8\", \"68505e1f7c16d8538e116405411205355a029dcf2df738dbbc768b2fe95d20fd\") end on_install(\"windows\", function (package) os.cp(\"include\", package:installdir()) os.cp(\"lib/$(arch)/*.lib\", package:installdir(\"lib\")) os.cp(\"lib/$(arch)/*.dll\", package:installdir(\"lib\")) end) ``` ### æœ¬åœ°æµ‹è¯• å¦‚æœåœ¨æœ¬åœ° xmake repo ä»“åº“ä¸­ï¼Œå·²ç»æ·»åŠ å’Œåˆ¶ä½œå¥½äº†æ–°çš„åŒ…ï¼Œå¯ä»¥åœ¨æœ¬åœ°è¿è¡Œæµ‹è¯•ä¸‹ï¼Œæ˜¯å¦é€šè¿‡ï¼Œå¦‚æœæµ‹è¯•é€šè¿‡ï¼Œå³å¯æäº¤ pr åˆ°å®˜æ–¹ä»“åº“ï¼Œè¯·æ±‚ mergeã€‚ æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹é¢çš„è„šæœ¬è¿›è¡Œæµ‹è¯•æŒ‡å®šåŒ…ï¼š ```bash cd xmake repo xmake l scripts/test.lua v D zlib ``` ä¸Šé¢çš„å‘½ä»¤ï¼Œä¼šå¼ºåˆ¶é‡æ–°ä¸‹è½½å’Œå®‰è£… zlib åŒ…ï¼Œæµ‹è¯•æ•´ä¸ªå®‰è£…æµç¨‹æ˜¯å¦ okï¼ŒåŠ ä¸Š ` v D` æ˜¯ä¸ºäº†å¯ä»¥çœ‹åˆ°å®Œæ•´è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯å’Œå‡ºé”™ä¿¡æ¯ï¼Œæ–¹ä¾¿è°ƒè¯•åˆ†æã€‚ å¦‚æœç½‘ç»œç¯å¢ƒä¸å¥½ï¼Œä¸æƒ³æ¯æ¬¡æµ‹è¯•éƒ½å»é‡æ–°ä¸‹è½½æ‰€æœ‰ä¾èµ–ï¼Œå¯ä»¥åŠ ä¸Š ` shallow` å‚æ•°æ¥æ‰§è¡Œï¼Œè¿™ä¸ªå‚æ•°å‘Šè¯‰è„šæœ¬ï¼Œä»…ä»…é‡æ–°è§£å‹æœ¬åœ°ç¼“å­˜çš„ zlib æºç åŒ…ï¼Œé‡æ–°æ‰§è¡Œå®‰è£…å‘½ä»¤ï¼Œä½†ä¸ä¼šä¸‹è½½å„ç§ä¾èµ–ã€‚ ```bash cd xmake repo xmake l scripts/test.lua v D shallow zlib ``` å¦‚æœæˆ‘ä»¬æƒ³æµ‹è¯•å…¶ä»–å¹³å°çš„åŒ…è§„åˆ™æ˜¯å¦æ­£å¸¸ï¼Œæ¯”å¦‚: android, iphoneos ç­‰å¹³å°ï¼Œå¯ä»¥é€šè¿‡ ` p/ plat` æˆ–è€… ` a/ arch` æ¥æŒ‡å®šã€‚ ```bash cd xmake repo xmake l scripts/test.lua v D shallow p iphoneos a arm64 zlib xmake l scripts/test.lua v D shallow p android ndk /xxxx zlib ``` ## æäº¤åŒ…åˆ°å®˜æ–¹ä»“åº“ ç›®å‰è¿™ä¸ªç‰¹æ€§åˆšå®Œæˆä¸ä¹…ï¼Œç›®å‰å®˜æ–¹ä»“åº“çš„åŒ…è¿˜ä¸æ˜¯å¾ˆå¤šï¼Œæœ‰äº›åŒ…ä¹Ÿè®¸è¿˜ä¸æ”¯æŒéƒ¨åˆ†å¹³å°ï¼Œä¸è¿‡è¿™å¹¶ä¸æ˜¯å¤ªå¤§é—®é¢˜ï¼ŒåæœŸè¿­ä»£å‡ ä¸ªç‰ˆæœ¬åï¼Œæˆ‘ä¼šä¸æ–­æ‰©å……å®Œå–„åŒ…ä»“åº“ã€‚ å¦‚æœä½ éœ€è¦çš„åŒ…ï¼Œå½“å‰çš„å®˜æ–¹ä»“åº“è¿˜æ²¡æœ‰æ”¶å½•ï¼Œå¯ä»¥æäº¤ issues æˆ–è€…è‡ªå·±å¯ä»¥åœ¨æœ¬åœ°è°ƒé€šåï¼Œè´¡çŒ®æäº¤åˆ°å®˜æ–¹ä»“åº“ï¼š[xmake repo](https://github.com/xmake io/xmake repo) è¯¦ç»†çš„è´¡çŒ®è¯´æ˜ï¼Œè§ï¼š[CONTRIBUTING.md](https://github.com/xmake io/xmake repo/blob/master/CONTRIBUTING.md) å…³äºå¦‚ä½•åˆ¶ä½œè‡ªå·±çš„åŒ…ï¼Œå¯ä»¥çœ‹ä¸‹ä¸Šæ–‡ï¼š[æ·»åŠ åŒ…åˆ°ä»“åº“](# æ·»åŠ åŒ…åˆ°ä»“åº“)ã€‚ ## ä¾èµ–åŒ…çš„é”å®šå’Œå‡çº§ xmake æ”¯æŒä¾èµ–åŒ…çš„ç‰ˆæœ¬é”å®šï¼Œç±»ä¼¼ npm çš„ package.lock, cargo çš„ cargo.lockã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬å¼•ç”¨ä¸€äº›åŒ…ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸æŒ‡å®šç‰ˆæœ¬ï¼Œé‚£ä¹ˆ xmake æ¯æ¬¡éƒ½ä¼šè‡ªåŠ¨æ‹‰å–æœ€æ–°ç‰ˆæœ¬çš„åŒ…æ¥é›†æˆä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š ```lua add_requires(\"zlib\") ``` ä½†å¦‚æœä¸Šæ¸¸çš„åŒ…ä»“åº“æ›´æ–°æ”¹åŠ¨ï¼Œæ¯”å¦‚ zlib æ–°å¢äº†ä¸€ä¸ª 1.2.11 ç‰ˆæœ¬ï¼Œæˆ–è€…å®‰è£…è„šæœ¬æœ‰äº†å˜åŠ¨ï¼Œéƒ½ä¼šå¯¼è‡´ç”¨æˆ·çš„ä¾èµ–åŒ…å‘ç”Ÿæ”¹å˜ã€‚ è¿™å®¹æ˜“å¯¼è‡´åŸæœ¬ç¼–è¯‘é€šè¿‡çš„ä¸€äº›é¡¹ç›®ï¼Œç”±äºä¾èµ–åŒ…çš„å˜åŠ¨å‡ºç°ä¸€äº›ä¸ç¨³å®šå› ç´ ï¼Œæœ‰å¯èƒ½ç¼–è¯‘å¤±è´¥ç­‰ç­‰ã€‚ ä¸ºäº†ç¡®ä¿ç”¨æˆ·çš„é¡¹ç›®æ¯æ¬¡ä½¿ç”¨çš„åŒ…éƒ½æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„é…ç½®å»å¯ç”¨åŒ…ä¾èµ–é”å®šã€‚ ```lua set_policy(\"package.requires_lock\", true) ``` è¿™æ˜¯ä¸€ä¸ªå…¨å±€è®¾ç½®ï¼Œå¿…é¡»è®¾ç½®åˆ°å…¨å±€æ ¹ä½œç”¨åŸŸï¼Œå¦‚æœå¯ç”¨åï¼Œxmake æ‰§è¡Œå®ŒåŒ…æ‹‰å–ï¼Œå°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª `xmake requires.lock` çš„é…ç½®æ–‡ä»¶ã€‚ å®ƒåŒ…å«äº†é¡¹ç›®ä¾èµ–çš„æ‰€æœ‰åŒ…ï¼Œä»¥åŠå½“å‰åŒ…çš„ç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚ ```lua { __meta__ { version \"1.0\" }, [\"macosxx86_64\"] { [\"cmake#31fecfc4\"] { repo { branch \"master\", commit \"4498f11267de5112199152ab030ed139c985ad5a\", url \"https://github.com/xmake io/xmake repo.git\" }, version \"3.21.0\" }, [\"glfw#31fecfc4\"] { repo { branch \"master\", commit \"eda7adee81bac151f87c507030cc0dd8ab299462\", url \"https://github.com/xmake io/xmake repo.git\" }, version \"3.3.4\" }, [\"opengl#31fecfc4\"] { repo { branch \"master\", commit \"94d2eee1f466092e04c5cf1e4ecc8c8883c1d0eb\", url \"https://github.com/xmake io/xmake repo.git\" } } } } ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¼ºåˆ¶å‡çº§åŒ…åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚ ```console $ xmake require upgrade upgrading packages .. zlib: 1.2.10 > 1.2.11 1 package is upgraded! ``` ## åˆ†å‘å’Œä½¿ç”¨è‡ªå®šä¹‰åŒ…è§„åˆ™ æˆ‘ä»¬å¯ä»¥åœ¨åŒ…ç®¡ç†ä»“åº“ä¸­ï¼Œæ·»åŠ è‡ªå®šä¹‰æ„æ¶è§„åˆ™è„šæœ¬ï¼Œå®ç°è·ŸéšåŒ…è¿›è¡ŒåŠ¨æ€ä¸‹å‘å’Œå®‰è£…ã€‚ æˆ‘ä»¬éœ€è¦å°†è‡ªå®šä¹‰è§„åˆ™æ”¾åˆ°ä»“åº“çš„ `packages/x/xxx/rules` ç›®å½•ä¸­ï¼Œå®ƒä¼šè·ŸéšåŒ…ä¸€èµ·è¢«å®‰è£…ã€‚ ä½†æ˜¯ï¼Œå®ƒä¹Ÿå­˜åœ¨ä¸€äº›é™åˆ¶ï¼š * åœ¨åŒ…ä¸­è§„åˆ™ï¼Œæˆ‘ä»¬ä¸èƒ½æ·»åŠ  `on_load`, `after_load` è„šæœ¬ï¼Œä½†æ˜¯é€šå¸¸æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `on_config` æ¥ä»£æ›¿ã€‚ ### æ·»åŠ åŒ…è§„åˆ™ æˆ‘ä»¬éœ€è¦å°†è§„åˆ™è„šæœ¬æ·»åŠ åˆ° rules å›ºå®šç›®å½•ä¸‹ï¼Œä¾‹å¦‚ï¼špackages/z/zlib/rules/foo.lua ```lua rule(\"foo\", function() on_config(function (target) print(\"foo: on_config %s\", target:name()) end) end) ``` ### åº”ç”¨åŒ…è§„åˆ™ ä½¿ç”¨è§„åˆ™çš„æ–¹å¼è·Ÿä¹‹å‰ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ `@packagename/` å‰ç¼€å»æŒ‡å®šè®¿é—®å“ªä¸ªåŒ…é‡Œé¢çš„è§„åˆ™ã€‚ å…·ä½“æ ¼å¼ï¼š`add_rules(\"@packagename/rulename\")`ï¼Œä¾‹å¦‚ï¼š`add_rules(\"@zlib/foo\")`ã€‚ ```lua add_requires(\"zlib\", {system false}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") add_packages(\"zlib\") add_rules(\"@zlib/foo\") end) ``` ### é€šè¿‡åŒ…åˆ«åå¼•ç”¨è§„åˆ™ å¦‚æœå­˜åœ¨ä¸€ä¸ªåŒ…çš„åˆ«åï¼Œxmake å°†ä¼˜å…ˆè€ƒè™‘åŒ…çš„åˆ«åæ¥è·å¾—è§„åˆ™ã€‚ ```lua add_requires(\"zlib\", {alias \"zlib2\", system false}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") add_packages(\"zlib2\") add_rules(\"@zlib2/foo\") end) ``` ### æ·»åŠ åŒ…è§„åˆ™ä¾èµ– æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `add_deps(\"@bar\")` æ¥æ·»åŠ ç›¸å¯¹äºå½“å‰åŒ…ç›®å½•çš„å…¶ä»–è§„åˆ™ã€‚ ç„¶è€Œï¼Œæˆ‘ä»¬ä¸èƒ½æ·»åŠ æ¥è‡ªå…¶ä»–åŒ…çš„è§„åˆ™ä¾èµ–ï¼Œå®ƒä»¬æ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œæˆ‘ä»¬åªèƒ½å‚è€ƒç”¨æˆ·é¡¹ç›®ä¸­ç”± `add_requires` å¯¼å…¥çš„å…¶ä»–åŒ…çš„è§„åˆ™ã€‚ packages/z/zlib/rules/foo.lua ```lua rule(\"foo\", function() add_deps(\"@bar\") on_config(function (target) print(\"foo: on_config %s\", target:name()) end) end) ``` packages/z/zlib/rules/bar.lua ```lua rule(\"bar\", function() on_config(function (target) print(\"bar: on_config %s\", target:name()) end) end) ``` ## åœ¨ CMake ä¸­ä½¿ç”¨ Xrepo çš„ä¾èµ–åŒ…ç®¡ç† æˆ‘ä»¬æ–°å¢äº†ä¸€ä¸ªç‹¬ç«‹é¡¹ç›® [xrepo cmake](https://github.com/xmake io/xrepo cmake)ã€‚ å®ƒæ˜¯ä¸€ä¸ªåŸºäº Xrepo/Xmake çš„ C/C++ åŒ…ç®¡ç†å™¨çš„ CMake åŒ…è£…å™¨ã€‚ è¿™å…è®¸ä½¿ç”¨ CMake æ¥æ„å»ºæ‚¨çš„é¡¹ç›®ï¼ŒåŒæ—¶ä½¿ç”¨ Xrepo æ¥ç®¡ç†ä¾èµ–åŒ…ã€‚è¿™ä¸ªé¡¹ç›®çš„éƒ¨åˆ†çµæ„Ÿæ¥è‡ª [cmake conan](https://github.com/conan io/cmake conan)ã€‚ æ­¤é¡¹ç›®çš„ç¤ºä¾‹ç”¨ä¾‹ï¼š * æƒ³è¦ä½¿ç”¨ Xrepo ç®¡ç†åŒ…çš„ç°æœ‰ CMake é¡¹ç›®ã€‚ * å¿…é¡»ä½¿ç”¨ CMakeï¼Œä½†æƒ³ä½¿ç”¨ Xrepo ç®¡ç†çš„æ–°é¡¹ç›®åŒ…ã€‚ ### Apis #### xrepo_package [xrepo.cmake](https://github.com/xmake io/xrepo cmake/blob/main/xrepo.cmake) æä¾› `xrepo_package` å‡½æ•°æ¥ç®¡ç†åŒ…ã€‚ ```cmake xrepo_package( \"foo 1.2.3\" [CONFIGS feature1 true,feature2 false] [CONFIGS path/to/script.lua] [DEPS] [MODE debugrelease] [ALIAS aliasname] [OUTPUT verbosediagnosisquiet] [DIRECTORY_SCOPE] ) ``` ä¸€äº›å‡½æ•°å‚æ•°ç›´æ¥å¯¹åº”äº Xrepo å‘½ä»¤é€‰é¡¹ã€‚ `xrepo_package` å°†è½¯ä»¶åŒ…å®‰è£…ç›®å½•æ·»åŠ åˆ° `CMAKE_PREFIX_PATH`ã€‚æ‰€ä»¥ `find_package` å¯ä»¥ä½¿ç”¨ã€‚å¦‚æœ `CMAKE_MINIMUM_REQUIRED_VERSION` > 3.1ï¼Œcmake `pkgConfig` ä¹Ÿä¼šæœç´¢ å¯¹äºè½¯ä»¶åŒ…å®‰è£…ç›®å½•ä¸‹çš„ pkgconfig æ–‡ä»¶ã€‚ è°ƒç”¨ `xrepo_package(foo)` åï¼Œæœ‰ `foo` åŒ…çš„ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼š 1. å¦‚æœåŒ…æä¾› cmake é…ç½®æ–‡ä»¶ï¼Œåˆ™è°ƒç”¨ `find_package(foo)`ã€‚ * æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… CMake [`find_package`](https://cmake.org/cmake/help/latest/command/find_package.html) æ–‡æ¡£ã€‚ 2. å¦‚æœåŒ…æ²¡æœ‰æä¾› cmake é…ç½®æ–‡ä»¶æˆ–è€…æ‰¾ä¸åˆ°æ¨¡å— * ä»¥ä¸‹å˜é‡å¯ç”¨äºä½¿ç”¨ pacakgeï¼ˆcmake åçš„å˜é‡å æŸ¥æ‰¾æ¨¡å— [æ ‡å‡†å˜é‡åç§°](https://cmake.org/cmake/help/latest/manual/cmake developer.7.html#standard variable names)) * `foo_INCLUDE_DIRS` * `foo_LIBRARY_DIRS` * `foo_LIBRARIES` * `foo_DEFINITIONS` * å¦‚æœæŒ‡å®šäº† `DIRECTORY_SCOPE`ï¼Œåˆ™ `xrepo_package` å°†è¿è¡Œä»¥ä¸‹ä»£ç  ```cmake include_directories(${foo_INCLUDE_DIRS}) link_directories(${foo_LIBRARY_DIRS}) ``` 3. ä½¿ç”¨ `xrepo_target_packages`ã€‚è¯·å‚é˜…ä»¥ä¸‹éƒ¨åˆ†ã€‚ æ³¨æ„ `CONFIGS path/to/script.lua` ç”¨äºå¯¹åŒ…é…ç½®è¿›è¡Œç²¾ç»†æ§åˆ¶ã€‚ ä¾‹å¦‚ï¼š * æ’é™¤ç³»ç»Ÿä¸Šçš„åŒ…ã€‚ * è¦†ç›–ä¾èµ–åŒ…çš„é»˜è®¤é…ç½®ï¼Œä¾‹å¦‚è®¾ç½® `shared true`ã€‚ å¦‚æœæŒ‡å®šäº† `DEPS`ï¼Œæ‰€æœ‰ä¾èµ–åº“éƒ½å°†æ·»åŠ åˆ° `CMAKE_PREFIX_PATH`ï¼Œä»¥åŠ include å’Œ libraries é‚£å››ä¸ªå˜é‡ä¸­ã€‚ #### xrepo_target_packages å°†åŒ… includedirs å’Œ links/linkdirs æ·»åŠ åˆ°ç»™å®šçš„ç›®æ ‡ã€‚ ```cmake xrepo_target_packages( target [NO_LINK_LIBRARIES] [PRIVATEPUBLICINTERFACE] package1 package2 ... ) ``` ### ä½¿ç”¨æ¥è‡ªå®˜æ–¹å­˜å‚¨åº“çš„åŒ… Xrepo å®˜æ–¹ä»“åº“ï¼š[xmake repo](https://github.com/xmake io/xmake repo) è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ `gflags` åŒ…ç‰ˆæœ¬ 2.2.2 çš„ç¤ºä¾‹ `CMakeLists.txt` ç”± Xrepo ç®¡ç†ã€‚ #### é›†æˆ xrepo.cmake ```cmake cmake_minimum_required(VERSION 3.13.0) project(foo) # Download xrepo.cmake if not exists in build directory. if(NOT EXISTS \"${CMAKE_BINARY_DIR}/xrepo.cmake\") message(STATUS \"Downloading xrepo.cmake from https://github.com/xmake io/xrepo cmake/\") # mirror https://cdn.jsdelivr.net/gh/xmake io/xrepo cmake@main/xrepo.cmake file(DOWNLOAD \"https://raw.githubusercontent.com/xmake io/xrepo cmake/main/xrepo.cmake\" \"${CMAKE_BINARY_DIR}/xrepo.cmake\" TLS_VERIFY ON) endif() # Include xrepo.cmake so we can use xrepo_package function. include(${CMAKE_BINARY_DIR}/xrepo.cmake) ``` #### æ·»åŠ åŒ… ```cmake xrepo_package(\"zlib\") add_executable(example bin \"\") target_sources(example bin PRIVATE src/main.cpp ) xrepo_target_packages(example bin zlib) ``` #### æ·»åŠ å¸¦æœ‰é…ç½®çš„åŒ… ```cmake xrepo_package(\"gflags 2.2.2\" CONFIGS \"shared true,mt true\") add_executable(example bin \"\") target_sources(example bin PRIVATE src/main.cpp ) xrepo_target_packages(example bin gflags) ``` #### æ·»åŠ å¸¦æœ‰ cmake å¯¼å…¥æ¨¡å—çš„åŒ… ```cmake xrepo_package(\"gflags 2.2.2\" CONFIGS \"shared true,mt true\") # `xrepo_package` ä¼šå°† gflags å®‰è£…ç›®å½•æ·»åŠ åˆ° CMAKE_PREFIX_PATH. # `find_package(gflags)` ä¼šä» CMAKE_PREFIX_PATH åŒ…å«çš„ç›®å½•ä¸­æ‰¾åˆ° gflags æä¾›çš„ # config file æ–‡ä»¶ã€‚ # å‚è€ƒ https://cmake.org/cmake/help/latest/command/find_package.html#search modes find_package(gflags CONFIG COMPONENTS shared) add_executable(example bin \"\") target_sources(example bin PRIVATE src/main.cpp ) target_link_libraries(example bin gflags) ``` #### æ·»åŠ è‡ªå®šä¹‰åŒ… ```cmake set(XREPO_XMAKEFILE ${CMAKE_CURRENT_SOURCE_DIR}/packages/xmake.lua) xrepo_package(\"myzlib\") add_executable(example bin \"\") target_sources(example bin PRIVATE src/main.cpp ) xrepo_target_packages(example bin myzlib) ``` åœ¨ packages/xmake.lua ä¸­å®šä¹‰ä¸€ä¸ªåŒ…ï¼š ```lua package(\"myzlib\") ... ``` æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªåŒ…ï¼Œå…·ä½“å®šä¹‰æ–¹å¼ï¼Œå‚è€ƒæ–‡æ¡£ï¼š[è‡ªå®šä¹‰ Xrepo åŒ…](https://xmake.io/#/zh cn/package/remote_package?id package description)ã€‚ ### ä½¿ç”¨æ¥è‡ªç¬¬ä¸‰ä¸ªå­˜å‚¨åº“çš„åŒ… é™¤äº†ä»å®˜æ–¹ç»´æŠ¤çš„å­˜å‚¨åº“å®‰è£…è½¯ä»¶åŒ…ä¹‹å¤–ï¼ŒXrepo è¿˜å¯ä»¥å®‰è£…æ¥è‡ªç¬¬ä¸‰æ–¹åŒ…ç®¡ç†å™¨çš„åŒ…ï¼Œä¾‹å¦‚ vcpkg/conan/conda/pacman/homebrew/apt/dub/cargoã€‚ å…³äºå‘½ä»¤è¡Œçš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒæ–‡æ¡£ï¼š[Xrepo å‘½ä»¤ç”¨æ³•](https://xrepo.xmake.io/#/getting_started?id install packages from third party package manager) æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ cmake ä¸­ä½¿ç”¨å®ƒæ¥å®‰è£…æ¥è‡ªç¬¬ä¸‰æ–¹ä»“åº“çš„åŒ…ï¼Œåªéœ€å°†ä»“åº“åç§°æ·»åŠ ä¸ºå‘½åç©ºé—´å³å¯ã€‚ä¾‹å¦‚ï¼š`vcpkg::zlib`, `conan::pcre2` #### Conan ```cmake xrepo_package(\"conan::gflags/2.2.2\") ``` #### Conda ```cmake xrepo_package(\"conda::gflags 2.2.2\") ``` #### Vcpkg ```cmake xrepo_package(\"vcpkg::gflags\") ``` #### Homebrew ```cmake xrepo_package(\"brew::gflags\") ```"},"/get_started/zh/package/system-package.html":{"title":"","content":" class: heading_no_counter # ä½¿ç”¨ç³»ç»ŸåŒ… ## æŸ¥æ‰¾ä½¿ç”¨ç³»ç»ŸåŒ… xmake å¯¹è¿œç¨‹åŒ…å’Œç³»ç»ŸåŒ…çš„ä½¿ç”¨è¿›è¡Œäº†ç»Ÿä¸€ï¼Œå…¨éƒ¨ä½¿ç”¨ `add_requires(\"zlib\")` æ¥å£æ¥æè¿°é›†æˆï¼Œè€Œé»˜è®¤çš„é…ç½®æ–¹å¼ï¼Œå®ƒä¼šä¼˜å…ˆä»ç³»ç»Ÿä¸ŠæŸ¥æ‰¾åº“ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½å®‰è£…é›†æˆã€‚ è€Œå¦‚æœæˆ‘ä»¬ä»…ä»…æƒ³æŸ¥æ‰¾ä½¿ç”¨ç³»ç»Ÿåº“ï¼Œä¸æƒ³è¿œç¨‹ä¸‹è½½ï¼Œå¯ä»¥è¿™ä¹ˆé…ç½®ï¼š ```lua add_requires(\"zlib\", {system true}) target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"zlib\") end) ``` é€šè¿‡ `{system true}` å°±å¯ä»¥å¼ºåˆ¶ç¦ç”¨è¿œç¨‹ä¸‹è½½ï¼Œè¿™æ—¶å€™ï¼Œä»–å°±ç­‰ä»·äº xmake/CMake çš„ `find_package`ï¼Œä½†æ˜¯æ›´åŠ ç®€å•æ˜“ç”¨ï¼Œå¹¶ä¸”å’Œè¿œç¨‹åŒ…ä½¿ç”¨æ–¹å¼å®Œå…¨ä¸€è‡´ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ‰¾ä¸åˆ°ç³»ç»Ÿåº“ï¼Œå°±æ˜¯æç¤ºå¤±è´¥ï¼Œå¦‚æœè¿™ä¸ªåŒ…æ˜¯å¯é€‰çš„ï¼Œé‚£ä¹ˆå¯ä»¥é¢å¤–é…ç½® `{optional true}` é€‰é¡¹ã€‚ ```lua add_requires(\"zlib\", {system true, optional true}) ``` ## æŸ¥æ‰¾åŒ…å¿«é€Ÿæµ‹è¯• æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œå¿«é€Ÿæ£€æµ‹ç³»ç»Ÿä¸ŠæŒ‡å®šçš„åŒ…ä¿¡æ¯ï¼š ```console $ xmake l find_package x264 { links { \"x264\" }, linkdirs { \"/usr/local/Cellar/x264/r2699/lib\" }, version \"0.148.2699 a5e06b9\", includedirs { \"/usr/local/Cellar/x264/r2699/include\" } } ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿½åŠ ç¬¬ä¸‰æ–¹åŒ…ç®¡ç†å™¨å‰ç¼€æ¥æµ‹è¯•ï¼š ```console xmake l find_package conan::OpenSSL/1.0.2g ``` > éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œfind_package å‘½ä»¤å¦‚æœåœ¨å¸¦æœ‰ xmake.lua çš„å·¥ç¨‹ç›®å½•ä¸‹æ‰§è¡Œï¼Œæ˜¯ä¼šæœ‰ç¼“å­˜çš„ï¼Œå¦‚æœæŸ¥æ‰¾å¤±è´¥ï¼Œä¸‹æ¬¡æŸ¥æ‰¾ä¹Ÿä¼šä½¿ç”¨ç¼“å­˜çš„ç»“æœï¼Œå¦‚æœè¦æ¯æ¬¡å¼ºåˆ¶é‡æ–°æ£€æµ‹ï¼Œè¯·åˆ‡æ¢åˆ°éå·¥ç¨‹ç›®å½•ä¸‹æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ã€‚"},"/get_started/zh/option/script-scope.html":{"title":"","content":" class: heading_no_counter # è„šæœ¬åŸŸ ## option:value è·å–é€‰é¡¹çš„å€¼ã€‚ ## option:name è·å–é€‰é¡¹çš„åå­—ã€‚ ## option:get è·å–é€‰é¡¹åœ¨æè¿°åŸŸçš„é…ç½®å€¼ã€‚ ä»»ä½•åœ¨æè¿°åŸŸçš„ `set_xxx` å’Œ `add_xxx` é…ç½®å€¼éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£è·å–åˆ°ã€‚ ```lua get the links option:get(\"links\") get the defined macros option:get(\"defines\") ``` ## option:set è®¾ç½®é€‰é¡¹çš„é…ç½®å€¼ï¼Œï¼ˆå¦‚æœä½ æƒ³æ·»åŠ å€¼å¯ä»¥ç”¨ [option:add](#optionadd)ï¼‰ã€‚ ```lua set the links option:set(\"links\", \"sdl2\") set the defined macros option:set(\"defines\", \"SDL_MAIN_HANDLED\") set configvar option:set(\"configvar\", option:name(), option:value(), {quote false}) ``` ## option:add æŒ‰åç§°æ·»åŠ åˆ°é€‰é¡¹çš„å€¼ ```lua add links option:add(\"links\", \"sdl2\") add defined macros option:add(\"defines\", \"SDL_MAIN_HANDLED\") ```"},"/get_started/zh/option/description-scope.html":{"title":"","content":" class: heading_no_counter # æè¿°åŸŸ å®šä¹‰å’Œè®¾ç½®é€‰é¡¹å¼€å…³ï¼Œæ¯ä¸ª `option` å¯¹åº”ä¸€ä¸ªé€‰é¡¹ï¼Œå¯ç”¨äºè‡ªå®šä¹‰ç¼–è¯‘é…ç½®é€‰é¡¹ã€å¼€å…³è®¾ç½®ã€‚ > é™¤äº† `target` ä»¥å¤–çš„æ‰€æœ‰åŸŸæ¥å£ï¼Œä¾‹å¦‚ `option`ï¼Œ`task` ç­‰çš„æ¥å£ï¼Œé»˜è®¤ä¸èƒ½æ”¾ç½®åœ¨å¤–é¢çš„å…¨å±€ä½œç”¨åŸŸä¸­çš„ï¼ˆé™¤ééƒ¨åˆ†è·Ÿ target å…±ç”¨çš„æ¥å£é™¤å¤–ï¼‰ã€‚ > å¦‚æœè¦è®¾ç½®å€¼å½±å“æ‰€æœ‰ `option`ï¼Œ`task` ç­‰é€‰é¡¹ï¼Œå¯ä»¥é€šè¿‡åŒ¿åå…¨å±€åŸŸæ¥è®¾ç½®ã€‚ > ä¸è¿‡æˆ‘ä»¬ä¸æ¨èè¿™ä¹ˆä½¿ç”¨ï¼Œåç»­æ˜¯ä¼šåºŸå¼ƒæ‰ `option_end` æ¥å£ä»¥ä¿æŒ xmake.lua è„šæœ¬çš„æ˜“è¯»æ€§ã€‚ ä¾‹å¦‚ï¼š ```lua è¿›å…¥ option çš„åŒ¿åå…¨å±€åŸŸï¼Œé‡Œé¢çš„è®¾ç½®ä¼šåŒæ—¶å½±å“ test å’Œ test2 é€‰é¡¹ option() add_defines(\"DEBUG\") option(\"test\") ... å°½é‡ä¿æŒç¼©è¿›ï¼Œå› ä¸ºè¿™ä¸ªä¹‹åçš„æ‰€æœ‰è®¾ç½®ï¼Œéƒ½æ˜¯é’ˆå¯¹ test é€‰é¡¹çš„ option(\"test2\") ... ``` > `option` åŸŸæ˜¯å¯ä»¥é‡å¤è¿›å…¥æ¥å®ç°åˆ†ç¦»è®¾ç½®çš„ï¼Œå¦‚æœè¦æ˜¾ç¤ºç¦»å¼€å½“å‰é€‰é¡¹çš„ä½œç”¨åŸŸè®¾ç½®ï¼Œå¯ä»¥æ‰‹åŠ¨è°ƒç”¨ [option_end](#option_end) æ¥å£ã€‚ ## option å®šä¹‰å’Œè®¾ç½®é€‰é¡¹å¼€å…³ï¼Œå¯ç”¨äºè‡ªå®šä¹‰ç¼–è¯‘é…ç½®é€‰é¡¹ã€å¼€å…³è®¾ç½®ã€‚ ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªæ˜¯å¦å¯ç”¨ test çš„é€‰é¡¹ï¼š ```lua option(\"test\", function() set_default(false) set_showmenu(true) add_defines(\"TEST\") end) ``` ç„¶åå…³è”åˆ°æŒ‡å®šçš„ target ä¸­å»ï¼š ```lua target(\"demo\", function() add_options(\"test\") end) ``` è¿™æ ·ï¼Œä¸€ä¸ªé€‰é¡¹å°±ç®—å®šä¹‰å¥½äº†ï¼Œå¦‚æœè¿™ä¸ªé€‰é¡¹è¢«å¯ç”¨ï¼Œé‚£ä¹ˆç¼–è¯‘è¿™ä¸ª target çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨åŠ ä¸Š ` DTEST` çš„å®å®šä¹‰ã€‚ ```lua # æ‰‹åŠ¨å¯ç”¨è¿™ä¸ªé€‰é¡¹ $ xmake f test y $ xmake ``` ## option_end è¿™æ˜¯ä¸€ä¸ªå¯é€‰ apiï¼Œæ˜¾ç¤ºç¦»å¼€é€‰é¡¹ä½œç”¨åŸŸï¼Œç”¨æ³•å’Œ [target_end](/zh cn/manual/project_target?id target_end) ç±»ä¼¼ã€‚ ## option:add_deps é€šè¿‡è®¾ç½®ä¾èµ–ï¼Œå¯ä»¥è°ƒæ•´é€‰é¡¹çš„æ£€æµ‹é¡ºåºï¼Œä¸€èˆ¬ç”¨äº [on_check](#optionon_check) ç­‰æ£€æµ‹è„šæœ¬çš„è°ƒç”¨æ—¶æœºã€‚ ```lua option(\"small\", function() set_default(true) on_check(function (option) ... end) end) option(\"test\", function() add_deps(\"small\") set_default(true) after_check(function (option) if option:dep(\"small\"):enabled() then option:enable(false) end end) end) ``` å½“ä¾èµ–çš„ small é€‰é¡¹æ£€æµ‹å®Œæˆåï¼Œé€šè¿‡åˆ¤æ–­ small é€‰é¡¹çš„çŠ¶æ€ï¼Œæ¥æ§åˆ¶ test çš„é€‰é¡¹çŠ¶æ€ã€‚ > ç”±äº on_check åªæœ‰åœ¨æ²¡æœ‰è®¾ç½® default å€¼çš„æƒ…å†µä¸‹æ‰ä¼šè¢«æ‰§è¡Œï¼Œå› æ­¤å¦‚æœè®¾ç½®äº† default å€¼ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ after_check é˜¶æ®µå¤„ç†è‡ªå®šä¹‰é€»è¾‘ã€‚ ## option:before_check é€‰é¡¹æ£€æµ‹ä¹‹å‰æ‰§è¡Œæ­¤è„šæœ¬ï¼š ```lua option(\"zlib\", function() before_check(function (option) end) end) ``` ## option:on_check è‡ªå®šä¹‰é€‰é¡¹æ£€æµ‹è„šæœ¬ï¼Œæ­¤è„šæœ¬ä¼šè¦†ç›–å†…ç½®çš„é€‰é¡¹æ£€æµ‹é€»è¾‘ã€‚ ```lua option(\"test\", function() add_deps(\"small\") on_check(function (option) option:enable(true) end) end) ``` > ä»…ä»…åœ¨ `set_default` æ²¡æœ‰è¢«è®¾ç½®çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šæ‰§è¡Œ `on_check` è¿›è¡Œè‡ªå®šä¹‰çš„é€‰é¡¹æ£€æµ‹è„šæœ¬ã€‚ ## option:after_check åœ¨é€‰é¡¹æ£€æµ‹å®Œæˆåï¼Œæ‰§è¡Œæ­¤è„šæœ¬åšä¸€äº›åæœŸå¤„ç†ï¼Œä¹Ÿå¯ä»¥åœ¨æ­¤æ—¶é‡æ–°ç¦ç”¨é€‰é¡¹ï¼š ```lua option(\"test\", function() add_deps(\"small\") add_links(\"pthread\") after_check(function (option) option:enable(false) end) end) ``` ## option:set_values è®¾ç½®é€‰é¡¹å€¼åˆ—è¡¨ï¼Œä»…ç”¨äº `xmake f menu` çš„å›¾å½¢èœå•é…ç½®æ—¶ï¼Œæä¾›é€‰é¡¹å€¼åˆ—è¡¨ä¾›ç”¨æˆ·å¿«é€Ÿé€‰æ‹©ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š ```lua option(\"test\", function() set_default(\"b\") set_showmenu(true) set_values(\"a\", \"b\", \"c\") end) ``` æ•ˆæœå›¾å¦‚ä¸‹ï¼š ![option set values](image/option_set_values.png) ## option:set_default åœ¨æ²¡æœ‰é€šè¿‡ `xmake f option [yn}` ç­‰å‘½ä»¤ä¿®æ”¹é€‰é¡¹å€¼çš„æ—¶å€™ï¼Œè¿™ä¸ªé€‰é¡¹æœ¬èº«ä¹Ÿæ˜¯æœ‰ä¸ªé»˜è®¤å€¼çš„ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£æ¥è®¾ç½®ï¼š ```lua option(\"test\", function() é»˜è®¤ç¦ç”¨è¿™ä¸ªé€‰é¡¹ set_default(false) end) ``` é€‰é¡¹çš„å€¼ä¸ä»…æ”¯æŒ boolean ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä¾‹å¦‚ï¼š ```lua option(\"test\", function() set_default(\"value\") end) ``` å€¼ç±»å‹ æè¿° é…ç½® boolean ä¸€èˆ¬ç”¨ä½œå‚æ•°å¼€å…³ï¼Œå€¼èŒƒå›´ï¼š`true/false` `xmake f optionname [y/n/yes/no/true/false]` string å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œä¸€èˆ¬ç”¨äºæ¨¡å¼åˆ¤æ–­ `xmake f optionname value` å¦‚æœæ˜¯ `boolean` å€¼çš„é€‰é¡¹ï¼Œå¯ä»¥é€šè¿‡ [has_config](/zh cn/manual/conditions?id has_config) æ¥è¿›è¡Œåˆ¤æ–­ï¼Œé€‰é¡¹æ˜¯å¦è¢«å¯ç”¨ã€‚ å¦‚æœæ˜¯ `string` ç±»å‹çš„é€‰é¡¹ï¼Œå¯ä»¥åœ¨å†…å»ºå˜é‡ä¸­ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š ```lua å®šä¹‰ä¸€ä¸ªè·¯å¾„é…ç½®é€‰é¡¹ï¼Œé»˜è®¤ä½¿ç”¨ä¸´æ—¶ç›®å½• option(\"rootdir\", function() set_default(\"$(tmpdir)\") set_showmenu(true) end) target(\"test\", function() æ·»åŠ æŒ‡å®šé€‰é¡¹ç›®å½•ä¸­çš„æºæ–‡ä»¶ add_files(\"$(rootdir)/*.c\") end) ``` å…¶ä¸­ï¼Œ`$(rootdir)` å°±æ˜¯è‡ªå®šä¹‰çš„é€‰é¡¹å†…å»ºå˜é‡ï¼Œé€šè¿‡æ‰‹åŠ¨é…ç½®ï¼Œå¯ä»¥åŠ¨æ€ä¿®æ”¹å®ƒçš„å€¼ï¼š ```bash $ xmake f rootdir ~/projectdir/src $ xmake ``` ç»™è¿™ä¸ª `rootdir` é€‰é¡¹æŒ‡å®šä¸€ä¸ªå…¶ä»–çš„æºç ç›®å½•è·¯å¾„ï¼Œç„¶åç¼–è¯‘ã€‚ é€‰é¡¹çš„æ£€æµ‹è¡Œä¸ºï¼š default å€¼ æ£€æµ‹è¡Œä¸º æ²¡æœ‰è®¾ç½® ä¼˜å…ˆæ‰‹åŠ¨é…ç½®ä¿®æ”¹ï¼Œé»˜è®¤ç¦ç”¨ï¼Œå¦åˆ™ä¼šå¯ç”¨è‡ªåŠ¨æ£€æµ‹ï¼Œä¹Ÿä¼šæ‰§è¡Œ on_checkï¼Œå¯æ ¹æ®æ‰‹åŠ¨ä¼ å…¥çš„å€¼ç±»å‹ï¼Œè‡ªåŠ¨åˆ‡æ¢ boolean å’Œ string ç±»å‹ false å¼€å…³é€‰é¡¹ï¼Œä¸è‡ªåŠ¨æ£€æµ‹ï¼Œé»˜è®¤ç¦ç”¨ï¼Œå¯æ‰‹åŠ¨é…ç½®ä¿®æ”¹ true å¼€å…³é€‰é¡¹ï¼Œä¸è‡ªåŠ¨æ£€æµ‹ï¼Œé»˜è®¤å¯ç”¨ï¼Œå¯æ‰‹åŠ¨é…ç½®ä¿®æ”¹ string ç±»å‹ æ— å¼€å…³çŠ¶æ€ï¼Œä¸è‡ªåŠ¨æ£€æµ‹ï¼Œå¯æ‰‹åŠ¨é…ç½®ä¿®æ”¹ï¼Œä¸€èˆ¬ç”¨äºé…ç½®å˜é‡ä¼ é€’ ## option:set_showmenu ç”¨äºè®¾ç½®æ˜¯å¦å¯ç”¨èœå•æ˜¾ç¤ºã€‚ å¦‚æœè®¾ç½®ä¸º `true`ï¼Œé‚£ä¹ˆåœ¨ `xmake f help` é‡Œé¢å°±ä¼šå‡ºç°è¿™ä¸ªé€‰é¡¹ï¼Œä¹Ÿå°±èƒ½é€šè¿‡ `xmake f optionname xxx` è¿›è¡Œé…ç½®ï¼Œå¦åˆ™åªèƒ½åœ¨ `xmake.lua` å†…éƒ¨ä½¿ç”¨ï¼Œæ— æ³•æ‰‹åŠ¨é…ç½®ä¿®æ”¹ã€‚ ```lua option(\"test\", function() set_showmenu(true) end) ``` è®¾ç½®ä¸ºå¯ç”¨èœå•åï¼Œæ‰§è¡Œ `xmake f help` å¯ä»¥çœ‹åˆ°ï¼Œå¸®åŠ©èœå•é‡Œé¢å¤šäº†ä¸€é¡¹ï¼š ``` Options: ... test TEST ``` > æ­¤é€‰é¡¹é»˜è®¤æ”¹ä¸ºå¯ç”¨ï¼Œé€šå¸¸éƒ½ä¸éœ€è¦é¢å¤–é…ç½®å®ƒã€‚è€ƒè™‘åé¢åˆ é™¤è¿™ä¸ª apiã€‚ ## option:set_category è¿™ä¸ªæ˜¯ä¸ªå¯é€‰é…ç½®ï¼Œä»…ç”¨äºåœ¨å¸®åŠ©èœå•ä¸­ï¼Œè¿›è¡Œåˆ†ç±»æ˜¾ç¤ºé€‰é¡¹ï¼ŒåŒä¸€ç±»åˆ«çš„é€‰é¡¹ï¼Œä¼šåœ¨åŒä¸€ä¸ªåˆ†ç»„é‡Œé¢æ˜¾ç¤ºï¼Œè¿™æ ·èœå•çœ‹èµ·æ¥æ›´åŠ çš„ç¾è§‚ã€‚ ä¾‹å¦‚ï¼š ```lua option(\"test1\", function() set_showmenu(true) set_category(\"test\") end) option(\"test2\", function() set_showmenu(true) set_category(\"test\") end) option(\"demo1\", function() set_showmenu(true) set_category(\"demo\") end) option(\"demo2\", function() set_showmenu(true) set_category(\"demo\") end) ``` è¿™é‡Œå››ä¸ªé€‰é¡¹åˆ†åˆ«å½’ç±»äºä¸¤ä¸ªåˆ†ç»„ï¼š`test` å’Œ `demo`ï¼Œé‚£ä¹ˆæ˜¾ç¤ºçš„å¸ƒå±€ç±»ä¼¼è¿™æ ·ï¼š ```bash Options: ... test1 TEST1 test2 TEST2 demo1 DEMO1 demo2 DEMO2 ``` è¿™ä¸ªæ¥å£ï¼Œä»…ä»…æ˜¯ä¸ºäº†è°ƒæ•´æ˜¾ç¤ºå¸ƒå±€ï¼Œæ›´åŠ ç¾è§‚è€Œå·²ï¼Œæ²¡å…¶ä»–ç”¨é€”ã€‚ è¿˜å¯ä»¥é€šè¿‡ category è®¾ç½®åˆ†çº§è·¯å¾„å `set_category(\"root/submenu/submenu2\")`ï¼Œæ¥é…ç½® `xmake f menu` çš„å›¾å½¢èœå•ç•Œé¢ï¼Œä¾‹å¦‚ï¼š ```lua 'boolean' option option(\"test1\", function() set_default(true) set_showmenu(true) set_category(\"root menu/test1\") end) 'choice' option with values: \"a\", \"b\", \"c\" option(\"test2\", function() set_default(\"a\") set_values(\"a\", \"b\", \"c\") set_showmenu(true) set_category(\"root menu/test2\") end) 'string' option option(\"test3\", function() set_default(\"xx\") set_showmenu(true) set_category(\"root menu/test3/test3\") end) 'number' option option(\"test4\", function() set_default(6) set_showmenu(true) set_category(\"root menu/test4\") end) ``` ä¸Šè¿°é…ç½®æœ€åæ˜¾ç¤ºçš„èœå•ç•Œé¢è·¯å¾„ç»“æ„ï¼š root menu test1 test2 test3 test3 test4 æ•ˆæœå›¾å¦‚ä¸‹ï¼š ![opiton set category](image/option_set_category.gif) ## option:set_description è®¾ç½®é€‰é¡¹èœå•æ˜¾ç¤ºæ—¶ï¼Œå³è¾¹çš„æè¿°ä¿¡æ¯ï¼Œç”¨äºå¸®åŠ©ç”¨æˆ·æ›´åŠ æ¸…æ¥šçš„çŸ¥é“è¿™ä¸ªé€‰é¡¹çš„ç”¨é€”ï¼Œä¾‹å¦‚ï¼š ```lua option(\"test\", function() set_default(false) set_showmenu(true) set_description(\"Enable or disable test\") end) ``` ç”Ÿæˆçš„èœå•å†…å®¹å¦‚ä¸‹ï¼š ``` Options: ... test TEST Enable or disable test (default: false) ``` è¿™ä¸ªæ¥å£ä¹Ÿæ”¯æŒå¤šè¡Œæ˜¾ç¤ºï¼Œè¾“å‡ºæ›´åŠ è¯¦ç»†çš„æè¿°ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š ```lua option(\"mode\", function() set_default(\"debug\") set_showmenu(true) set_description(\"Set build mode\", \" debug\", \" release\", \" profile\") end) ``` ç”Ÿæˆçš„èœå•å†…å®¹å¦‚ä¸‹ï¼š ``` Options: ... mode MODE Set build mode (default: debug) debug release profile ``` çœ‹åˆ°è¿™ä¸ªèœå•ï¼Œç”¨æˆ·å°±èƒ½æ¸…æ¥šåœ°çŸ¥é“ï¼Œå®šä¹‰çš„è¿™ä¸ª `mode` é€‰é¡¹çš„å…·ä½“ç”¨å¤„ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨äº†ï¼š ```bash $ xmake f mode release ``` ## option:add_links æ·»åŠ é“¾æ¥åº“æ£€æµ‹ã€‚ å¦‚æœæŒ‡å®šçš„é“¾æ¥åº“æ£€æµ‹é€šè¿‡ï¼Œæ­¤é€‰é¡¹å°†è¢«å¯ç”¨ï¼Œå¹¶ä¸”å¯¹åº”å…³è”çš„ target ä¼šè‡ªåŠ¨åŠ ä¸Šæ­¤é“¾æ¥ï¼Œä¾‹å¦‚ï¼š ```lua option(\"pthread\", function() add_links(\"pthread\") add_linkdirs(\"/usr/local/lib\") end) target(\"test\", function() add_options(\"pthread\") end) ``` å¦‚æœæ£€æµ‹é€šè¿‡ï¼Œ`test` ç›®æ ‡ç¼–è¯‘çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨åŠ ä¸Šï¼š` L/usr/local/lib lpthread` ç¼–è¯‘é€‰é¡¹ ## option:add_linkdirs æ·»åŠ é“¾æ¥åº“æ£€æµ‹æ—¶å€™éœ€è¦çš„æœç´¢ç›®å½•ã€‚ è¿™ä¸ªæ˜¯å¯é€‰çš„ï¼Œä¸€èˆ¬ç³»ç»Ÿåº“ä¸éœ€è¦åŠ è¿™ä¸ªï¼Œä¹Ÿèƒ½æ£€æµ‹é€šè¿‡ï¼Œå¦‚æœç¡®å®æ²¡æ‰¾åˆ°ï¼Œå¯ä»¥è‡ªå·±è¿½åŠ æœç´¢ç›®å½•ï¼Œæé«˜æ£€æµ‹é€šè¿‡ç‡ã€‚å…·ä½“ä½¿ç”¨è§ï¼š[add_links](#optionadd_links) ## option:add_rpathdirs æ·»åŠ ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åº“çš„åŠ è½½æœç´¢ç›®å½•ã€‚ åœ¨é€‰é¡¹é€šè¿‡æ£€æµ‹åï¼Œä¼šè‡ªåŠ¨æ·»åŠ åˆ°å¯¹åº”çš„ target ä¸Šå»ï¼Œå…·ä½“ä½¿ç”¨è§ï¼š[target.add_rpathdirs](/zh cn/manual/project_target?id targetadd_rpathdirs)ã€‚ ## option:add_cincludes æ·»åŠ  c å¤´æ–‡ä»¶æ£€æµ‹ã€‚ å¦‚æœ c å¤´æ–‡ä»¶æ£€æµ‹é€šè¿‡ï¼Œæ­¤é€‰é¡¹å°†è¢«å¯ç”¨ï¼Œä¾‹å¦‚ï¼š ```lua option(\"pthread\", function() add_cincludes(\"pthread.h\") add_defines(\"ENABLE_PTHREAD\") end) target(\"test\", function() add_options(\"pthread\") end) ``` æ­¤é€‰é¡¹æ£€æµ‹æ˜¯å¦å­˜åœ¨ `pthread.h` çš„å¤´æ–‡ä»¶ï¼Œå¦‚æœæ£€æµ‹é€šè¿‡é‚£ä¹ˆ `test` ç›®æ ‡ç¨‹åºå°†ä¼šåŠ ä¸Š `ENABLE_PTHREAD` çš„å®å®šä¹‰ã€‚ å¦‚æœæƒ³è¦æ›´åŠ çµæ´»çš„æ£€æµ‹ï¼Œå¯ä»¥é€šè¿‡ [lib.detect.has_cincludes](#detect has_cincludes) åœ¨[option.on_check](#optionon_check)ä¸­å»å®ç°ã€‚ ## option:add_cxxincludes æ·»åŠ  c++ å¤´æ–‡ä»¶æ£€æµ‹ã€‚ ä¸ [add_cincludes](#optionadd_cincludes) ç±»ä¼¼ï¼Œåªæ˜¯æ£€æµ‹çš„å¤´æ–‡ä»¶ç±»å‹æ˜¯ c++ å¤´æ–‡ä»¶ã€‚ ## option:add_ctypes æ·»åŠ  c ç±»å‹æ£€æµ‹ã€‚ å¦‚æœ c ç±»å‹æ£€æµ‹é€šè¿‡ï¼Œæ­¤é€‰é¡¹å°†è¢«å¯ç”¨ï¼Œä¾‹å¦‚ï¼š ```lua option(\"wchar\", function() add_ctypes(\"wchar_t\") add_defines(\"HAVE_WCHAR\") end) target(\"test\", function() add_options(\"wchar\") end) ``` æ­¤é€‰é¡¹æ£€æµ‹æ˜¯å¦å­˜åœ¨ `wchar_t` çš„ç±»å‹ï¼Œå¦‚æœæ£€æµ‹é€šè¿‡é‚£ä¹ˆ `test` ç›®æ ‡ç¨‹åºå°†ä¼šåŠ ä¸Š `HAVE_WCHAR` çš„å®å®šä¹‰ã€‚ å¦‚æœæƒ³è¦æ›´åŠ çµæ´»çš„æ£€æµ‹ï¼Œå¯ä»¥é€šè¿‡ [lib.detect.has_ctypes](#detect has_ctypes) åœ¨[option.on_check](#optionon_check)ä¸­å»å®ç°ã€‚ ## option:add_cxxtypes æ·»åŠ  c++ ç±»å‹æ£€æµ‹ã€‚ ä¸ [add_ctypes](#optionadd_ctypes) ç±»ä¼¼ï¼Œåªæ˜¯æ£€æµ‹çš„ç±»å‹æ˜¯ c++ ç±»å‹ã€‚ ## option:add_csnippets æ·»åŠ  c ä»£ç ç‰‡æ®µæ£€æµ‹ã€‚ å¦‚æœç°æœ‰çš„ [add_ctypes](#optionadd_ctypes), [add_cfuncs](#optionadd_cfuncs) ç­‰ä¸èƒ½æ»¡è¶³å½“å‰çš„æ£€æµ‹éœ€æ±‚ï¼Œ å¯ä»¥ç”¨è¿™ä¸ªæ¥å£å®ç°æ›´åŠ å®šåˆ¶åŒ–æ£€æµ‹ä¸€äº›ç¼–è¯‘å™¨ç‰¹æ€§æ£€æµ‹ï¼Œå…·ä½“è§: [add_cxxsnippets](#optionadd_cxxsnippets)ã€‚ ## option:add_cxxsnippets æ·»åŠ  c++ ä»£ç ç‰‡æ®µæ£€æµ‹ã€‚ å¯ä»¥ç”¨è¿™ä¸ªæ¥å£å®ç°æ›´åŠ å®šåˆ¶åŒ–æ£€æµ‹ä¸€äº›ç¼–è¯‘å™¨ç‰¹æ€§æ£€æµ‹ï¼Œå°¤å…¶æ˜¯ c++ çš„å„ç§ç‰¹æ€§çš„æ£€æµ‹æ”¯æŒï¼Œä¾‹å¦‚ï¼š ```lua option(\"constexpr\", function() add_cxxsnippets(\"constexpr\", \"constexpr int f(int x) { int sum 0; for (int i 0; i< x; ++i) sum + i; return sum; } constexpr int x f(5); static_assert(x 15);\") end) ``` ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä»£ç ç‰‡æ®µçš„åå­—ä½œä¸ºæ ‡ç¤ºï¼Œæ£€æµ‹è¾“å‡ºä¿¡æ¯æ—¶å€™ä¼šæœ‰æ˜¾ç¤ºã€‚ ä¸Šè¿°ä»£ç ï¼Œå®ç°å¯¹ c++ çš„ constexpr ç‰¹æ€§çš„æ£€æµ‹ï¼Œå¦‚æœæ£€æµ‹é€šè¿‡ï¼Œåˆ™å¯ç”¨ constexpr é€‰é¡¹ï¼Œå½“ç„¶è¿™é‡Œåªæ˜¯ä¸ªä¾‹å­ã€‚ å¯¹äºç¼–è¯‘å™¨ç‰¹æ€§çš„æ£€æµ‹ï¼Œæœ‰æ›´åŠ æ–¹ä¾¿é«˜æ•ˆçš„æ£€æµ‹æ¨¡å—ï¼Œæä¾›æ›´å¼ºå¤§çš„æ£€æµ‹æ”¯æŒï¼Œå…·ä½“è§ï¼š[compiler.has_features](#compiler has_features) å’Œ [detect.check_cxsnippets](#detect check_cxsnippets) å¦‚æœæƒ³è¦æ›´åŠ çµæ´»çš„æ£€æµ‹ï¼Œå¯ä»¥é€šè¿‡ [lib.detect.check_cxsnippets](#detect check_cxsnippets) åœ¨[option.on_check](#optionon_check)ä¸­å»å®ç°ã€‚ å¦å¤–æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ `{tryrun true}` å’Œ `{output true}` ä¸¤ä¸ªé€‰é¡¹ç”¨äºå°è¯•è¿è¡Œæ£€æµ‹å’Œæ•è·è¾“å‡ºã€‚ è®¾ç½® tryrun å¯ä»¥å°è¯•è¿è¡Œæ¥æ£€æµ‹ï¼š ```lua option(\"test\", function() add_cxxsnippets(\"HAS_INT_4\", \"return (sizeof(int) 4)? 0 : 1;\", {tryrun true}) end) ``` è®¾ç½® output ä¹Ÿä¼šå°è¯•å»æ£€æµ‹ï¼Œå¹¶ä¸”é¢å¤–æ•è·è¿è¡Œçš„è¾“å‡ºå†…å®¹ã€‚ ```lua option(\"test\", function() add_cxxsnippets(\"INT_SIZE\", 'printf(\"%d\", sizeof(int)); return 0;', {output true, number true}) end) ``` > è®¾ç½®ä¸ºæ•è·è¾“å‡ºï¼Œå½“å‰ option ä¸èƒ½å†è®¾ç½®å…¶ä»– snippetsã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `is_config` è·å–ç»‘å®šåˆ° option çš„è¾“å‡ºã€‚ ```lua if is_config(\"test\", \"8\") tben xxx end ``` ## option:add_cfuncs æ·»åŠ  c åº“å‡½æ•°æ£€æµ‹ã€‚ ```lua option(\"setjmp\", function() add_cincludes(\"setjmp.h\") add_cfuncs(\"sigsetjmp\", \"setjmp\") add_defines(\"HAVE_SETJMP\") end) target(\"test\", function() add_options(\"setjmp\") end) ``` æ­¤é€‰é¡¹æ£€æµ‹æ˜¯å¦å­˜åœ¨ `setjmp` çš„ä¸€äº›æ¥å£ï¼Œå¦‚æœæ£€æµ‹é€šè¿‡é‚£ä¹ˆ `test` ç›®æ ‡ç¨‹åºå°†ä¼šåŠ ä¸Š `HAVE_SETJMP` çš„å®å®šä¹‰ã€‚ é‡Œé¢çš„å‡½æ•°ç‰‡æ®µæ”¯æŒä¸‹é¢å‡ ç§è¯­æ³•æ ¼å¼ï¼š ```lua å•çº¯æ£€æµ‹å‡½æ•°åœ°å€æ˜¯å¦å­˜åœ¨ï¼Œå†…éƒ¨ä¼šå°è¯•å»å®ƒçš„åœ°å€æ¥åˆ¤æ–­ sigsetjmp å¦‚æœæœ‰äº›å‡½æ•°æ˜¯å®å®šä¹‰ wrap çš„ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼ç»•é€šè¿‡æ£€æµ‹ sigsetjmp((void*)0, 0) ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªå®Œæ•´å‡½æ•°è¯­å¥ï¼Œä¾‹å¦‚ï¼šfuncname{codebody} sigsetjmp{sigsetjmp((void*)0, 0);} sigsetjmp{int a 0; sigsetjmp((void*)a, a);} ``` æ³¨æ„ï¼Œæ£€æµ‹çš„å‡½æ•°é€šå¸¸éœ€è¦é™„å¸¦ `add_cincludes` ç¡®ä¿å‡½æ•°èƒ½å¤Ÿè¢«æ­£å¸¸ include è¿›æ¥ï¼Œå¦åˆ™æ£€æµ‹ä¼šå¤±è´¥ã€‚ ## option:add_cxxfuncs æ·»åŠ  c++ åº“å‡½æ•°æ£€æµ‹ã€‚ ç”¨æ³•è·Ÿ [option:add_cfuncs](#optionadd_cxxfuncs) ä¸€è‡´ã€‚"},"/get_started/zh/task/builtin-plugins.html":{"title":"","content":" class: heading_no_counter # å†…ç½®æ’ä»¶ ## ç”Ÿæˆ IDE å·¥ç¨‹æ–‡ä»¶ ### ç®€ä»‹ xmake è·Ÿ `cmake`, `premake` ç­‰å…¶ä»–ä¸€äº›æ„å»ºå·¥å…·çš„åŒºåˆ«åœ¨äºï¼š > `xmake` é»˜è®¤æ˜¯ç›´æ¥æ„å»ºè¿è¡Œçš„ï¼Œç”Ÿæˆç¬¬ä¸‰æ–¹çš„ IDE çš„å·¥ç¨‹æ–‡ä»¶ä»…ä»…ä½œä¸º â€œæ’ä»¶â€ æ¥æä¾›ã€‚ è¿™æ ·åšçš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼šæ’ä»¶æ›´åŠ å®¹æ˜“æ‰©å±•ï¼Œç»´æŠ¤ä¹Ÿæ›´åŠ ç‹¬ç«‹å’Œæ–¹ä¾¿ã€‚ ### ç”Ÿæˆ Makefile ```console $ xmake project k makefile ``` ### ç”Ÿæˆ CMakelists.txt ```console $ xmake project k cmakelists ``` ### ç”Ÿæˆ build.ninja ```console $ xmake project k ninja ``` ### ç”Ÿæˆ compiler_flags ```console $ xmake project k compiler_flags ``` ### ç”Ÿæˆ compile_commands å¯¼å‡ºæ¯ä¸ªæºæ–‡ä»¶çš„ç¼–è¯‘ä¿¡æ¯ï¼Œç”ŸæˆåŸºäº clang çš„ç¼–è¯‘æ•°æ®åº“æ–‡ä»¶ï¼Œjson æ ¼å¼ï¼Œå¯ç”¨äºè·Ÿ ideï¼Œç¼–è¾‘å™¨ï¼Œé™æ€åˆ†æå·¥å…·è¿›è¡Œäº¤äº’ã€‚ ```console $ xmake project k compile_commands ``` è¾“å‡ºçš„å†…å®¹æ ¼å¼å¦‚ä¸‹ï¼š ``` [ { \"directory\": \"/home/user/llvm/build\", \"command\": \"/usr/bin/clang++ Irelative DSOMEDEF \\\"With spaces, quotes and \\\\ es.\\\" c o file.o file.cc\", \"file\": \"file.cc\" }, ... ] ``` å¯¹äº `compile_commands` çš„è¯¦ç»†è¯´æ˜è§ï¼š[JSONCompilationDatabase](#https://clang.llvm.org/docs/JSONCompilationDatabase.html) ### ç”Ÿæˆ Xcode å·¥ç¨‹æ–‡ä»¶ ç›®å‰ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰æ—¶é—´å»è‡ªå·±å®ç° xcode å·¥ç¨‹çš„ç”Ÿæˆï¼Œä½†ä¸ä»£è¡¨ä¸æ”¯æŒï¼Œå› ä¸º xmake æ”¯æŒç”Ÿæˆ cmakelists.txt æ–‡ä»¶ï¼Œè€Œ cmake æ˜¯æ”¯æŒ xcode å·¥ç¨‹æ–‡ä»¶ç”Ÿæˆçš„ï¼Œåœ¨å®˜æ–¹è¿˜æ²¡æœ‰å®ç°ä¹‹å‰ï¼Œ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ cmake å˜ç›¸æ”¯æŒå®ƒï¼Œxmake ä¼šè‡ªåŠ¨å†…éƒ¨è°ƒç”¨ cmake ä¸­è½¬ä¸‹ç”Ÿæˆç»“æœï¼Œå¯¹ç”¨æˆ·è€Œè¨€ä½¿ç”¨ä¸Šæ²¡å•¥åŒºåˆ«ï¼Œåªéœ€è¦ç¡®ä¿ cmake å·²ç»å®‰è£…å³å¯ï¼š ```console $ xmake project k xcode ``` ## è¿è¡Œè‡ªå®šä¹‰ lua è„šæœ¬ è¿™ä¸ªè·Ÿå®è„šæœ¬ç±»ä¼¼ï¼Œåªæ˜¯çœå»äº†å¯¼å…¥å¯¼å‡ºæ“ä½œï¼Œç›´æ¥æŒ‡å®š lua è„šæœ¬æ¥åŠ è½½è¿è¡Œï¼Œè¿™å¯¹äºæƒ³è¦å¿«é€Ÿæµ‹è¯•ä¸€äº›æ¥å£æ¨¡å—ï¼ŒéªŒè¯è‡ªå·±çš„æŸäº›æ€è·¯ï¼Œéƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹å¼ã€‚ ### è¿è¡ŒæŒ‡å®šçš„è„šæœ¬æ–‡ä»¶ æˆ‘ä»¬å…ˆå†™ä¸ªç®€å•çš„ lua è„šæœ¬ï¼š ```lua function main() print(\"hello xmake!\") end ``` ç„¶åç›´æ¥è¿è¡Œå®ƒå°±è¡Œäº†ï¼š ```console $ xmake lua /tmp/test.lua ``` > å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åƒå®è„šæœ¬é‚£æ ·ï¼Œä½¿ç”¨ `import` æ¥å£å¯¼å…¥æ‰©å±•æ¨¡å—ï¼Œå®ç°å¤æ‚çš„åŠŸèƒ½ã€‚ ### è¿è¡Œå†…ç½®çš„è„šæœ¬å‘½ä»¤ ä½ å¯ä»¥è¿è¡Œ `xmake lua l` æ¥åˆ—ä¸¾æ‰€æœ‰å†…ç½®çš„è„šæœ¬åï¼Œä¾‹å¦‚ï¼š ```console $ xmake lua l scripts: cat cp echo versioninfo ... ``` å¹¶ä¸”è¿è¡Œå®ƒä»¬ï¼š ```console $ xmake lua cat ~/file.txt $ xmake lua echo \"hello xmake\" $ xmake lua cp /tmp/file /tmp/file2 $ xmake lua versioninfo ``` ### è¿è¡Œäº¤äº’å‘½ä»¤ (REPL) æœ‰æ—¶å€™åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼Œè¿è¡Œå‘½ä»¤æ›´åŠ çš„æ–¹ä¾¿æµ‹è¯•å’ŒéªŒè¯ä¸€äº›æ¨¡å—å’Œ apiï¼Œä¹Ÿæ›´åŠ çš„çµæ´»ï¼Œä¸éœ€è¦å†å»é¢å¤–å†™ä¸€ä¸ªè„šæœ¬æ–‡ä»¶æ¥åŠ è½½ã€‚ æˆ‘ä»¬å…ˆçœ‹ä¸‹ï¼Œå¦‚ä½•è¿›å…¥äº¤äº’æ¨¡å¼ï¼š ```console # ä¸å¸¦ä»»ä½•å‚æ•°æ‰§è¡Œï¼Œå°±å¯ä»¥è¿›å…¥ $ xmake lua > # è¿›è¡Œè¡¨è¾¾å¼è®¡ç®— > 1 + 2 3 # èµ‹å€¼å’Œæ‰“å°å˜é‡å€¼ > a 1 > a 1 # å¤šè¡Œè¾“å…¥å’Œæ‰§è¡Œ > for _, v in pairs({1, 2, 3}) do >> print(v) >> end 1 2 3 ``` æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿé€šè¿‡ `import` æ¥å¯¼å…¥æ‰©å±•æ¨¡å—ï¼š ```console > task import(\"core.project.task\") > task.run(\"hello\") hello xmake! ``` å¦‚æœè¦ä¸­é€”å–æ¶ˆå¤šè¡Œè¾“å…¥ï¼Œåªéœ€è¦è¾“å…¥å­—ç¬¦ï¼š`q` å°±è¡Œäº† ```console > for _, v in ipairs({1, 2}) do >> print(v) >> q < å–æ¶ˆå¤šè¡Œè¾“å…¥ï¼Œæ¸…ç©ºå…ˆå‰çš„è¾“å…¥æ•°æ® > 1 + 2 3 ``` ## æ˜¾ç¤ºæŒ‡å®šä¿¡æ¯å’Œåˆ—è¡¨ ### æ˜¾ç¤º xmake è‡ªèº«å’Œå½“å‰é¡¹ç›®çš„åŸºç¡€ä¿¡æ¯ ```bash $ xmake show The information of xmake: version: 2.3.3+202006011009 host: macosx/x86_64 programdir: /Users/ruki/.local/share/xmake programfile: /Users/ruki/.local/bin/xmake globaldir: /Users/ruki/.xmake tmpdir: /var/folders/32/w9cz0y_14hs19lkbs6v6_fm80000gn/T/.xmake501/200603 workingdir: /Users/ruki/projects/personal/tbox packagedir: /Users/ruki/.xmake/packages packagedir(cache): /Users/ruki/.xmake/cache/packages/2006 The information of project: tbox version: 1.6.5 plat: macosx arch: x86_64 mode: release buildir: build configdir: /Users/ruki/projects/personal/tbox/.xmake/macosx/x86_64 projectdir: /Users/ruki/projects/personal/tbox projectfile: /Users/ruki/projects/personal/tbox/xmake.lua ``` ### æ˜¾ç¤ºå·¥å…·é“¾åˆ—è¡¨ ```bash $ xmake show l toolchains xcode Xcode IDE vs VisualStudio IDE yasm The Yasm Modular Assembler clang A C language family frontend for LLVM go Go Programming Language Compiler dlang D Programming Language Compiler sdcc Small Device C Compiler cuda CUDA Toolkit ndk Android NDK rust Rust Programming Language Compiler llvm A collection of modular and reusable compiler and toolchain technologies cross Common cross compilation toolchain nasm NASM Assembler gcc GNU Compiler Collection mingw Minimalist GNU for Windows gnu rm GNU Arm Embedded Toolchain envs Environment variables toolchain fasm Flat Assembler ``` ### æ˜¾ç¤ºæŒ‡å®š target é…ç½®ä¿¡æ¯ æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¿«é€Ÿè¿½æº¯å®šä½ä¸€äº›ç‰¹å®šé…ç½®çš„ä½ç½®ã€‚ ```bash $ xmake show t tbox The information of target(tbox): at: /Users/ruki/projects/personal/tbox/src/tbox/xmake.lua kind: static targetfile: build/macosx/x86_64/release/libtbox.a rules: > mode.release > ./xmake.lua:26 > mode.debug > ./xmake.lua:26 > mode.profile > ./xmake.lua:26 > mode.coverage > ./xmake.lua:26 > utils.install.cmake_importfiles > ./src/tbox/xmake.lua:15 > utils.install.pkgconfig_importfiles > ./src/tbox/xmake.lua:16 options: > info > ./src/tbox/xmake.lua:50 > float > ./src/tbox/xmake.lua:50 > wchar > ./src/tbox/xmake.lua:50 > exception > ./src/tbox/xmake.lua:50 > force utf8 > ./src/tbox/xmake.lua:50 > deprecated > ./src/tbox/xmake.lua:50 > xml > ./src/tbox/xmake.lua:53 > zip > ./src/tbox/xmake.lua:53 > hash > ./src/tbox/xmake.lua:53 > regex > ./src/tbox/xmake.lua:53 > coroutine > ./src/tbox/xmake.lua:53 > object > ./src/tbox/xmake.lua:53 > charset > ./src/tbox/xmake.lua:53 > database > ./src/tbox/xmake.lua:53 packages: > mbedtls > ./src/tbox/xmake.lua:43 > polarssl > ./src/tbox/xmake.lua:43 > openssl > ./src/tbox/xmake.lua:43 > pcre2 > ./src/tbox/xmake.lua:43 > pcre > ./src/tbox/xmake.lua:43 > zlib > ./src/tbox/xmake.lua:43 > mysql > ./src/tbox/xmake.lua:43 > sqlite3 > ./src/tbox/xmake.lua:43 links: > pthread > option(__keyword_thread_local) > @programdir/includes/check_csnippets.lua:100 syslinks: > pthread > ./xmake.lua:71 > dl > ./xmake.lua:71 > m > ./xmake.lua:71 > c > ./xmake.lua:71 defines: > __tb_small__ > ./xmake.lua:42 > __tb_prefix__ \"tbox\" > ./src/tbox/xmake.lua:19 > _GNU_SOURCE 1 > option(__systemv_semget) > @programdir/includes/check_cfuncs.lua:104 cxflags: > Wno error deprecated declarations > ./xmake.lua:22 > fno strict aliasing > ./xmake.lua:22 > Wno error expansion to defined > ./xmake.lua:22 > fno stack protector > ./xmake.lua:51 frameworks: > CoreFoundation > ./src/tbox/xmake.lua:38 > CoreServices > ./src/tbox/xmake.lua:38 mxflags: > Wno error deprecated declarations > ./xmake.lua:23 > fno strict aliasing > ./xmake.lua:23 > Wno error expansion to defined > ./xmake.lua:23 includedirs: > src > ./src/tbox/xmake.lua:26 > build/macosx/x86_64/release > ./src/tbox/xmake.lua:27 headerfiles: > src/(tbox/**.h)**/impl/**.h > ./src/tbox/xmake.lua:30 > src/(tbox/prefix/**/prefix.S) > ./src/tbox/xmake.lua:31 > src/(tbox/math/impl/*.h) > ./src/tbox/xmake.lua:32 > src/(tbox/utils/impl/*.h) > ./src/tbox/xmake.lua:33 > build/macosx/x86_64/release/tbox.config.h > ./src/tbox/xmake.lua:34 files: > src/tbox/*.c > ./src/tbox/xmake.lua:56 > src/tbox/hash/bkdr.c > ./src/tbox/xmake.lua:57 > src/tbox/hash/fnv32.c > ./src/tbox/xmake.lua:57 > src/tbox/hash/adler32.c > ./src/tbox/xmake.lua:57 > src/tbox/math/**.c > ./src/tbox/xmake.lua:58 > src/tbox/libc/**.cstring/impl/**.c > ./src/tbox/xmake.lua:59 > src/tbox/utils/*.coption.c > ./src/tbox/xmake.lua:60 > src/tbox/prefix/**.c > ./src/tbox/xmake.lua:61 > src/tbox/memory/**.c > ./src/tbox/xmake.lua:62 > src/tbox/string/**.c > ./src/tbox/xmake.lua:63 > src/tbox/stream/**.c**/charset.c**/zip.c > ./src/tbox/xmake.lua:64 > src/tbox/network/**.cimpl/ssl/*.c > ./src/tbox/xmake.lua:65 > src/tbox/algorithm/**.c > ./src/tbox/xmake.lua:66 > src/tbox/container/**.celement/obj.c > ./src/tbox/xmake.lua:67 > src/tbox/libm/impl/libm.c > ./src/tbox/xmake.lua:68 > src/tbox/libm/idivi8.c > ./src/tbox/xmake.lua:73 > src/tbox/libm/ilog2i.c > ./src/tbox/xmake.lua:70 > src/tbox/libm/isqrti.c > ./src/tbox/xmake.lua:71 > src/tbox/libm/isqrti64.c > ./src/tbox/xmake.lua:72 > src/tbox/platform/*.ccontext.cexception.c > ./src/tbox/xmake.lua:74 > src/tbox/platform/impl/*.ccharset.cpoller_fwatcher.c > ./src/tbox/xmake.lua:74 > src/tbox/libm/*.c > ./src/tbox/xmake.lua:77 compiler (cc): /usr/bin/xcrun sdk macosx clang > Qunused arguments target x86_64 apple macos12.6 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX13.0.sdk linker (ar): /usr/bin/xcrun sdk macosx ar > cr compflags (cc): > Qunused arguments target x86_64 apple macos12.6 isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX13.0.sdk Wall Werror Oz std c99 Isrc Ibuild/macosx/x86_64/release D__tb_small__ D__tb_prefix__ \\\"tbox\\\" D_GNU_SOURCE 1 framework CoreFoundation framework CoreServices Wno error deprecated declarations fno strict aliasing Wno error expansion to defined fno stack protector linkflags (ar): > cr ``` ### æ˜¾ç¤ºå†…ç½®ç¼–è¯‘æ¨¡å¼åˆ—è¡¨ ```bash $ xmake show l buildmodes ``` ### æ˜¾ç¤ºå†…ç½®ç¼–è¯‘è§„åˆ™åˆ—è¡¨ ```bash $ xmake show l rules ``` ### æ˜¾ç¤ºå…¶ä»–ä¿¡æ¯ è¿˜åœ¨å®Œå–„ä¸­ï¼Œè¯¦æƒ…è§ï¼š<https://github.com/xmake io/xmake/issues/798> æˆ–è€…è¿è¡Œï¼š ```bash $ xmake show help ``` ## ç›‘è§†æ–‡ä»¶æ›´æ–° `xmake watch` æ’ä»¶å‘½ä»¤å¯ä»¥è‡ªåŠ¨ç›‘è§†é¡¹ç›®æ–‡ä»¶æ›´æ–°ï¼Œç„¶åè§¦å‘è‡ªåŠ¨æ„å»ºï¼Œæˆ–è€…è¿è¡Œä¸€äº›è‡ªå®šä¹‰å‘½ä»¤ã€‚ è¿™é€šå¸¸ç”¨äºä¸ªäººå¼€å‘æ—¶å€™ï¼Œå®ç°å¿«é€Ÿçš„å®æ—¶å¢é‡ç¼–è¯‘ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡æ‰‹åŠ¨æ‰§è¡Œç¼–è¯‘å‘½ä»¤ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚ ### é¡¹ç›®æ›´æ–°åè‡ªåŠ¨æ„å»º é»˜è®¤è¡Œä¸ºå°±æ˜¯ç›‘è§†æ•´ä¸ªé¡¹ç›®æ ¹ç›®å½•ï¼Œä»»ä½•æ–‡ä»¶æ”¹åŠ¨éƒ½ä¼šè§¦å‘é¡¹ç›®çš„å¢é‡ç¼–è¯‘ã€‚ ```bash $ xmake watch watching /private/tmp/test/src/** .. watching /private/tmp/test/* .. /private/tmp/test/src/main.cpp modified [25%]: cache compiling.release src/main.cpp [50%]: linking.release test [100%]: build ok! ``` ### ç›‘è§†æŒ‡å®šç›®å½• æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›‘è§†æŒ‡å®šçš„ä»£ç ç›®å½•ï¼Œç¼©å°ç›‘è§†èŒƒå›´ï¼Œæå‡ç›‘è§†æ€§èƒ½ã€‚ ```bash $ xmake watch d src $ xmake watch d \"src;tests/*\" ``` ä¸Šé¢çš„å‘½ä»¤ï¼Œä¼šå»é€’å½’ç›‘è§†æ‰€æœ‰å­ç›®å½•ï¼Œå¦‚æœæƒ³è¦ç´§ç´§ç›‘è§†å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸è¿›è¡Œé€’å½’ç›‘è§†ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚ ```bash $ xmake watch p src $ xmake watch p \"src;tests/*\" ``` ### ç›‘è§†å¹¶è¿è¡ŒæŒ‡å®šå‘½ä»¤ å¦‚æœæƒ³åœ¨è‡ªåŠ¨æ„å»ºåï¼Œè¿˜æƒ³è‡ªåŠ¨è¿è¡Œæ„å»ºçš„ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„å‘½ä»¤é›†ã€‚ ```bash $ xmake watch c \"xmake; xmake run\" ``` ä¸Šé¢çš„å‘½ä»¤åˆ—è¡¨æ˜¯ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’ï¼Œè¿™å¯¹äºå¤æ‚å‘½ä»¤å‚æ•°ï¼Œéœ€è¦è½¬ä¹‰æ¯”è¾ƒç¹çä¸å¤Ÿçµæ´»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼è¿›è¡Œä»»æ„å‘½ä»¤çš„è®¾ç½®ã€‚ ```bash $ xmake watch echo hello xmake! $ xmake watch xmake run help ``` ### ç›‘è§†å¹¶è¿è¡Œç›®æ ‡ç¨‹åº å°½ç®¡æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰å‘½ä»¤æ¥å®ç°ç›®æ ‡ç¨‹åºçš„è‡ªåŠ¨è¿è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿæä¾›äº†æ›´åŠ æ–¹ä¾¿çš„å‚æ•°æ¥å®ç°è¿™ä¸ªè¡Œä¸ºã€‚ ```bash $ xmake watch r $ xmake watch run [100%]: build ok! hello world! ``` ### ç›‘è§†å¹¶è¿è¡Œ lua è„šæœ¬ æˆ‘ä»¬è¿˜å¯ä»¥ç›‘è§†æ–‡ä»¶æ›´æ–°åï¼Œè¿è¡ŒæŒ‡å®šçš„ lua è„šæœ¬ï¼Œå®ç°æ›´åŠ çµæ´»å¤æ‚çš„å‘½ä»¤å®šåˆ¶ã€‚ ```bash $ xmake watch s /tmp/test.lua ``` æˆ‘ä»¬è¿˜å¯ä»¥å†è„šæœ¬ä¸­è·å–æ‰€æœ‰æ›´æ–°çš„æ–‡ä»¶è·¯å¾„åˆ—è¡¨å’Œäº‹ä»¶ã€‚ ```lua function main(events) TODO handle events end ``` ## åˆ†æè¯Šæ–­å·¥ç¨‹é…ç½®å’Œä»£ç  ### æ£€æµ‹å·¥ç¨‹é…ç½® #### é»˜è®¤æ£€æµ‹æ‰€æœ‰ API ```lua set_lanuages(\"c91\") typo ``` ```console $ xmake check ./xmake.lua:15: warning: unknown language value 'c91', it may be 'c90' 0 notes, 1 warnings, 0 errors ``` é»˜è®¤ä¹Ÿå¯ä»¥æŒ‡å®šæ£€æµ‹ç‰¹å®šç»„ï¼š ```console $ xmake check api $ xmake check api.target ``` #### æ˜¾ç¤ºè¯¦ç»†è¾“å‡º è¿™ä¼šé¢å¤–æä¾› note çº§åˆ«çš„æ£€æµ‹ä¿¡æ¯ã€‚ ```console $ xmake check v ./xmake.lua:15: warning: unknown language value 'cxx91', it may be 'cxx98' ./src/tbox/xmake.lua:43: note: unknown package value 'mbedtls' ./src/tbox/xmake.lua:43: note: unknown package value 'polarssl' ./src/tbox/xmake.lua:43: note: unknown package value 'openssl' ./src/tbox/xmake.lua:43: note: unknown package value 'pcre2' ./src/tbox/xmake.lua:43: note: unknown package value 'pcre' ./src/tbox/xmake.lua:43: note: unknown package value 'zlib' ./src/tbox/xmake.lua:43: note: unknown package value 'mysql' ./src/tbox/xmake.lua:43: note: unknown package value 'sqlite3' 8 notes, 1 warnings, 0 errors ``` #### æ£€æµ‹æŒ‡å®šçš„ API ```console $ xmake check api.target.languages ./xmake.lua:15: warning: unknown language value 'cxx91', it may be 'cxx98' 0 notes, 1 warnings, 0 errors ``` #### æ£€æµ‹ç¼–è¯‘ flags ```console $ xmake check ./xmake.lua:10: warning: clang: unknown c compiler flag ' Ox' 0 notes, 1 warnings, 0 errors ``` #### æ£€æµ‹ includedirs é™¤äº† includedirsï¼Œè¿˜æœ‰ linkdirs ç­‰è·¯å¾„éƒ½ä¼šå»æ£€æµ‹ã€‚ ```console $ xmake check ./xmake.lua:11: warning: includedir 'xxx' not found 0 notes, 1 warnings, 0 errors ``` ### æ£€æµ‹å·¥ç¨‹ä»£ç ï¼ˆclang tidyï¼‰ #### æ˜¾ç¤º clang tidy æ£€æµ‹åˆ—è¡¨ ```console $ xmake check clang.tidy list Enabled checks: clang analyzer apiModeling.StdCLibraryFunctions clang analyzer apiModeling.TrustNonnull clang analyzer apiModeling.google.GTest clang analyzer apiModeling.llvm.CastValue clang analyzer apiModeling.llvm.ReturnValue ... ``` #### æ£€æµ‹æ‰€æœ‰ targets ä¸­çš„æºç  ```console $ xmake check clang.tidy 1 error generated. Error while processing /private/tmp/test2/src/main.cpp. /tmp/test2/src/main.cpp:1:10: error: 'iostr' file not found [clang diagnostic error] #include <iostr> ^~~~~~~ Found compiler error(s). error: execv(/usr/local/opt/llvm/bin/clang tidy p compile_commands.json /private/tmp/test2/src /main.cpp) failed(1) ``` #### æŒ‡å®šæ£€æµ‹ç±»å‹ æˆ‘ä»¬å¯ä»¥åœ¨ ` check ` ä¸­æŒ‡å®šéœ€è¦æ£€æµ‹çš„ç±»å‹ï¼Œå…·ä½“ç”¨æ³•å¯ä»¥å‚è€ƒ `clang tidy` çš„ ` check ` å‚æ•°ï¼Œå®Œå…¨ä¸€è‡´çš„ã€‚ ```console $ xmake check clang.tidy checks \"*\" 6 warnings and 1 error generated. Error while processing /private/tmp/test2/src/main.cpp. /tmp/test2/src/main.cpp:1:10: error: 'iostr' file not found [clang diagnostic error] #include <iostr> ^~~~~~~ /tmp/test2/src/main.cpp:3:1: warning: do not use namespace using directives; use using declarat ions instead [google build using namespace] using namespace std; ^ /tmp/test2/src/main.cpp:3:17: warning: declaration must be declared within the '__llvm_libc' na mespace [llvmlibc implementation in namespace] using namespace std; ^ /tmp/test2/src/main.cpp:5:5: warning: declaration must be declared within the '__llvm_libc' nam espace [llvmlibc implementation in namespace] int main(int argc, char **argv) { ^ /tmp/test2/src/main.cpp:5:5: warning: use a trailing return type for this function [modernize u se trailing return type] int main(int argc, char **argv) { ~~~ ^ auto > int /tmp/test2/src/main.cpp:5:14: warning: parameter 'argc' is unused [misc unused parameters] int main(int argc, char **argv) { ^~~~ /*argc*/ /tmp/test2/src/main.cpp:5:27: warning: parameter 'argv' is unused [misc unused parameters] int main(int argc, char **argv) { ^~~~ /*argv*/ Found compiler error(s). error: execv(/usr/local/opt/llvm/bin/clang tidy checks * p compile_commands.json /private/tm p/test2/src/main.cpp) failed(1) ``` #### æ£€æµ‹æŒ‡å®š target çš„ä»£ç  ```console $ xmake check clang.tidy [targetname] ``` #### æ£€æµ‹ç»™å®šçš„æºæ–‡ä»¶åˆ—è¡¨ ```console $ xmake check clang.tidy f src/main.c $ xmake check clang.tidy f 'src/*.c:src/**.cpp' ``` #### è®¾ç½® .clang tidy é…ç½®æ–‡ä»¶ ```console $ xmake check clang.tidy configfile /tmp/.clang tidy ``` #### åˆ›å»º .clang tidy é…ç½®æ–‡ä»¶ ```console $ xmake check clang.tidy checks \"*\" create $ cat .clang tidy Checks: 'clang diagnostic *,clang analyzer *,*' WarningsAsErrors: '' HeaderFilterRegex: '' AnalyzeTemporaryDtors: false FormatStyle: none User: ruki CheckOptions: key: readability suspicious call argument.PrefixSimilarAbove value: '30' key: cppcoreguidelines no malloc.Reallocations value: '::realloc' ``` #### è‡ªåŠ¨ä¿®å¤é”™è¯¯ä»£ç  æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å‚æ•°ï¼Œè‡ªåŠ¨ä¿®å¤ clang tidy æ£€æµ‹å‡ºæ¥çš„é—®é¢˜ä»£ç ã€‚ ``` console $ xmake check clang.tidy fix $ xmake check clang.tidy fix_errors $ xmake check clang.tidy fix_notes ``` ## ç”Ÿæˆå®‰è£…åŒ… (XPack) ### ç®€ä»‹ è¿™ä¸ªæ’ä»¶å¯ä»¥å¸®åŠ©ç”¨æˆ·å¿«é€Ÿç”Ÿæˆä¸åŒå¹³å°çš„å®‰è£…åŒ…ï¼Œæºç åŒ…ï¼Œå®ƒä¼šç”Ÿæˆä¸‹é¢ä¸€äº›å®‰è£…åŒ…æ ¼å¼ï¼š Windows NSIS äºŒè¿›åˆ¶å®‰è£…åŒ… Windows WIX äºŒè¿›åˆ¶å®‰è£…åŒ… runself (shell) è‡ªç¼–è¯‘å®‰è£…åŒ… zip/tar.gz äºŒè¿›åˆ¶åŒ… zip/tar.gz æºç åŒ… RPM äºŒè¿›åˆ¶å®‰è£…åŒ… SRPM æºç å®‰è£…åŒ… DEB äºŒè¿›åˆ¶å®‰è£…åŒ… ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç®€å•çœ‹ä¸‹ï¼š ```lua set_version(\"1.0.0\") add_rules(\"mode.debug\", \"mode.release\") includes(\"@builtin/xpack\") target(\"test\") set_kind(\"binary\") add_files(\"src/*.cpp\") xpack(\"test\") set_formats(\"nsis\", \"zip\", \"targz\", \"runself\") set_title(\"hello\") set_author(\"ruki\") set_description(\"A test installer.\") set_homepage(\"https://xmake.io\") set_licensefile(\"LICENSE.md\") add_targets(\"test\") add_installfiles(\"src/(assets/*.png)\", {prefixdir \"images\"}) add_sourcefiles(\"(src/**)\") set_iconfile(\"src/assets/xmake.ico\") after_installcmd(function (package, batchcmds) batchcmds:mkdir(package:installdir(\"resources\")) batchcmds:cp(\"src/assets/*.txt\", package:installdir(\"resources\"), {rootdir \"src\"}) batchcmds:mkdir(package:installdir(\"stub\")) end) after_uninstallcmd(function (package, batchcmds) batchcmds:rmdir(package:installdir(\"resources\")) batchcmds:rmdir(package:installdir(\"stub\")) end) ``` æˆ‘ä»¬é€šè¿‡ `includes(\"@builtin/xpack\")` å¼•å…¥ xpack çš„æ‰€æœ‰é…ç½®æ¥å£ï¼ŒåŒ…æ‹¬ xpack é…ç½®åŸŸï¼Œä»¥åŠå®ƒçš„æ‰€æœ‰åŸŸæ¥å£ã€‚ ç„¶åæˆ‘ä»¬æ‰§è¡Œï¼š ```bash $ xmake pack ``` å³å¯ç”Ÿæˆæ‰€æœ‰å®‰è£…åŒ…ã€‚ ### ç”Ÿæˆ NSIS å®‰è£…åŒ… åªè¦é…ç½®äº† `set_formats(\"nsis\")` æ ¼å¼ï¼Œç„¶åæ‰§è¡Œ `xmake pack` å‘½ä»¤ï¼Œå°±èƒ½ç”Ÿæˆ NSIS æ ¼å¼çš„å®‰è£…åŒ…ã€‚ å¦å¤–ï¼Œxmake è¿˜ä¼šè‡ªåŠ¨å®‰è£…ç”Ÿæˆ NSIS åŒ…æ‰€éœ€çš„å·¥å…·ï¼Œå®ç°çœŸæ­£çš„ä¸€é”®æ‰“åŒ…ã€‚ ```bash $ xmake pack note: install or modify (m) these packages (pass y to skip confirm)? in xmake repo: > nsis 3.09 please input: y (y/n/m) > install nsis 3.09 .. ok [25%]: compiling.release src\\main.cpp [37%]: compiling.release src\\main.cpp [50%]: linking.release foo.dll [62%]: linking.release test.exe packing build\\xpack\\test\\test windows x64 v1.0.0.exe pack ok ``` `test windows x64 v1.0.0.exe` å°±æ˜¯æˆ‘ä»¬ç”Ÿæˆçš„å®‰è£…åŒ…ï¼ŒåŒå‡»è¿è¡Œå®ƒï¼Œå°±èƒ½å®‰è£…æˆ‘ä»¬çš„äºŒè¿›åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ã€‚ ![](/assets/img/manual/nsis_1.png) ![](/assets/img/manual/nsis_2.png) ![](/assets/img/manual/nsis_3.png) #### å¢åŠ ç»„ä»¶å®‰è£… æˆ‘ä»¬è¿˜å¯ä»¥ç»™ NSIS å¢åŠ ç»„ä»¶å®‰è£…å‘½ä»¤ï¼Œåªæœ‰å½“ç”¨æˆ·é€‰æ‹©æŒ‡å®šç»„ä»¶çš„æ—¶å€™ï¼Œå®ƒçš„å®‰è£…å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œã€‚ ```lua xpack(\"test\") add_components(\"LongPath\") xpack_component(\"LongPath\") set_default(false) set_title(\"Enable Long Path\") set_description(\"Increases the maximum path length limit, up to 32,767 characters (before 256).\") on_installcmd(function (component, batchcmds) batchcmds:rawcmd(\"nsis\", [[ ${If} $NoAdmin \"false\" ; Enable long path WriteRegDWORD ${HKLM} \"SYSTEM\\CurrentControlSet\\Control\\FileSystem\" \"LongPathsEnabled\" 1 ${EndIf}]]) end) ``` è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨é‡Œé¢æ·»åŠ äº†ä¸€ä¸ª NSIS ç‰¹æœ‰çš„è‡ªå®šä¹‰å‘½ä»¤ï¼Œå»å®ç°å¯¹é•¿è·¯å¾„çš„æ”¯æŒã€‚ ![](/assets/img/manual/nsis_4.png) ### ç”Ÿæˆè‡ªå®‰è£…åŒ… æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”ŸæˆåŸºäº shell è„šæœ¬çš„è‡ªç¼–è¯‘å®‰è£…åŒ…ã€‚æˆ‘ä»¬éœ€è¦é…ç½® runself æ‰“åŒ…æ ¼å¼ï¼Œç„¶åé€šè¿‡ `add_sourcefiles` æ·»åŠ éœ€è¦å‚ä¸ç¼–è¯‘å®‰è£…çš„æºæ–‡ä»¶ã€‚ æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ on_installcmd å®‰è£…è„šæœ¬ï¼Œé‡Œé¢å»é…ç½®å¦‚æœç¼–è¯‘æºç åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„è°ƒç”¨ä¸€ä¸ªå†…ç½®çš„ç¼–è¯‘å®‰è£…è„šæœ¬æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é…ç½® `make install` ç­‰ç¼–è¯‘å®‰è£…å‘½ä»¤ã€‚ ä¾‹å¦‚ï¼š ```lua xpack(\"test\") set_formats(\"runself\") add_sourcefiles(\"(src/**)\") on_installcmd(function (package, batchcmds) batchcmds:runv(\"make\", {\"install\"}) end) ``` ç„¶åï¼Œæˆ‘ä»¬æ‰§è¡Œ `xmake pack` å‘½ä»¤ï¼Œå°±å¯ä»¥ç”Ÿæˆä¸€ä¸ªè‡ªå®‰è£…çš„ xxx.gz.run åŒ…ï¼Œé»˜è®¤é‡‡ç”¨ gzip å‹ç¼©ã€‚ ```bash $ xmake pack packing build/xpack/test/test macosx src v1.0.0.gz.run pack ok ``` æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ sh å»åŠ è½½è¿è¡Œå®ƒæ¥å®‰è£…æˆ‘ä»¬çš„ç¨‹åºã€‚ ```bash $ sh ./build/xpack/test/test macosx src v1.0.0.gz.run ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„ä¾‹å­ï¼š ```lua xpack(\"xmakesrc\") set_formats(\"runself\") set_basename(\"xmake v$(version)\") set_prefixdir(\"xmake $(version)\") before_package(function (package) import(\"devel.git\") local rootdir path.join(os.tmpfile(package:basename()) .. \".dir\", \"repo\") if not os.isdir(rootdir) then os.tryrm(rootdir) os.cp(path.directory(os.projectdir()), rootdir) git.clean({repodir rootdir, force true, all true}) git.reset({repodir rootdir, hard true}) if os.isfile(path.join(rootdir, \".gitmodules\")) then git.submodule.clean({repodir rootdir, force true, all true}) git.submodule.reset({repodir rootdir, hard true}) end end local extraconf {rootdir rootdir} package:add(\"sourcefiles\", path.join(rootdir, \"core/**src/pdcurses/**src/luajit/**src/tbox/tbox/src/demo/**\"), extraconf) package:add(\"sourcefiles\", path.join(rootdir, \"xmake/**\"), extraconf) package:add(\"sourcefiles\", path.join(rootdir, \"*.md\"), extraconf) package:add(\"sourcefiles\", path.join(rootdir, \"configure\"), extraconf) package:add(\"sourcefiles\", path.join(rootdir, \"scripts/*.sh\"), extraconf) package:add(\"sourcefiles\", path.join(rootdir, \"scripts/man/**\"), extraconf) package:add(\"sourcefiles\", path.join(rootdir, \"scripts/debian/**\"), extraconf) package:add(\"sourcefiles\", path.join(rootdir, \"scripts/msys/**\"), extraconf) end) on_installcmd(function (package, batchcmds) batchcmds:runv(\"./scripts/get.sh\", {\"__local__\"}) end) ``` å®ƒæ˜¯ xmake è‡ªèº«æºç çš„å®‰è£…åŒ…é…ç½®è„šæœ¬ï¼Œæ›´å®Œæ•´çš„é…ç½®å¯ä»¥å‚è€ƒï¼š[xpack.lua](https://github.com/xmake io/xmake/blob/master/core/xpack.lua) è¿™é‡Œï¼Œå®ƒé€šè¿‡è°ƒç”¨æºç åŒ…å†…ç½®çš„ `./scripts/get.sh` å®‰è£…è„šæœ¬å»æ‰§è¡Œç¼–è¯‘å®‰è£…ã€‚ ### ç”Ÿæˆæºç å½’æ¡£åŒ… å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½® `srczip` å’Œ `srctargz` æ ¼å¼ï¼Œæ¥ç”Ÿæˆæºç å‹ç¼©åŒ…ï¼Œå®ƒä¸æ˜¯å®Œæ•´çš„å®‰è£…åŒ…ï¼Œä¹Ÿæ²¡æœ‰å®‰è£…å‘½ä»¤ï¼Œä»…ä»…ç”¨äºæºç åŒ…åˆ†å‘ã€‚ ```lua xpack(\"test\") set_formats(\"srczip\", \"srctargz\") add_sourcefiles(\"(src/**)\") ``` ```bash $ xmake pack packing build/xpack/test/test macosx src v1.0.0.zip .. packing build/xpack/test/test macosx src v1.0.0.tar.gz .. pack ok ``` ### ç”ŸæˆäºŒè¿›åˆ¶å½’æ¡£åŒ… æˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½® `zip` å’Œ `targz` æ¥ç”ŸæˆäºŒè¿›åˆ¶çš„å‹ç¼©åŒ…ï¼Œå®ƒä¼šå…ˆè‡ªåŠ¨ç¼–è¯‘æ‰€æœ‰ç»‘å®šçš„ target ç›®æ ‡ç¨‹åºï¼Œå°†æ‰€æœ‰éœ€è¦çš„äºŒè¿›åˆ¶ç¨‹åºï¼Œåº“æ–‡ä»¶æ‰“åŒ…åˆ° zip/tar.gz æ ¼å¼ã€‚ è¿™é€šå¸¸ç”¨äºåˆ¶ä½œç»¿è‰²ç‰ˆçš„å®‰è£…åŒ…ï¼Œå†…éƒ¨ä¸å¤ªä»»ä½•è‡ªåŠ¨å®‰è£…è„šæœ¬ï¼Œç”¨æˆ·éœ€è¦è‡ªå·±è®¾ç½® PATH ç­‰ç¯å¢ƒå˜é‡ã€‚ ```lua xpack(\"test\") set_formats(\"zip\", \"targz\") add_installfiles(\"(src/**)\") ``` ```bash $ xmake pack packing build/xpack/test/test macosx v1.0.0.zip .. packing build/xpack/test/test macosx v1.0.0.tar.gz .. pack ok ``` !> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰“äºŒè¿›åˆ¶æ–‡ä»¶åˆ°åŒ…é‡Œï¼Œä½¿ç”¨çš„æ˜¯ `add_installfiles` è€Œä¸æ˜¯ `add_sourcefiles`ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `add_targets` å»ç»‘å®šéœ€è¦å®‰è£…çš„ target ç›®æ ‡ç¨‹åºå’Œåº“ã€‚æ›´å¤šè¯¦æƒ…è§ä¸‹é¢å…³äº `add_targets` çš„æ¥å£æè¿°ã€‚ ### ç”Ÿæˆ SRPM æºç å®‰è£…åŒ… å®ƒå¯ä»¥ç”Ÿæˆ `.src.rpm` æ ¼å¼çš„æºç å®‰è£…åŒ…ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½® add_targets å…³è”éœ€è¦æ„å»ºçš„ç›®æ ‡ï¼Œåœ¨ç”Ÿæˆçš„ srpm åŒ…ä¸­ï¼Œå®ƒä¼šè‡ªåŠ¨è°ƒç”¨ `xmake build` å’Œ `xmake install` å»æ„å»ºå’Œå®‰è£…åŒ…ã€‚ ```lua xpack(\"test\") set_homepage(\"https://xmake.io\") set_license(\"Apache 2.0\") set_description(\"A cross platform build utility based on Lua.\") set_formats(\"srpm\") add_sourcefiles(\"(src/**)\") add_sourcefiles(\"./xmake.lua\") add_targets(\"demo\") ``` å®ƒä¼šç”Ÿæˆç±»ä¼¼ä¸‹é¢çš„ spec æ–‡ä»¶ï¼Œç„¶åè‡ªåŠ¨è°ƒç”¨ rpmbuild å»ç”Ÿæˆ `.src.rpm` åŒ…ã€‚ ``` Name: test Version: 1.0.0 Release: 1%{?dist} Summary: hello License: Apache 2.0 URL: https://xmake.io Source0: test linux src v1.0.0.tar.gz BuildRequires: xmake BuildRequires: gcc BuildRequires: gcc c++ %description A test installer. %prep %autosetup n test 1.0.0 p1 %build xmake build y test %install xmake install o %{buildroot}/%{_exec_prefix} test cd %{buildroot} find . type f sed 's!^\\./!/!' > %{_builddir}/_installedfiles.txt %check %files f %{_builddir}/_installedfiles.txt %changelog * Fri Dec 22 2023 ruki 1.0.0 1 Update to 1.0.0 ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `on_buildcmd` å’Œ `on_installcmd` è‡ªå®šä¹‰æ„å»ºå’Œå®‰è£…è„šæœ¬ã€‚ ```lua xpack(\"test\") set_homepage(\"https://xmake.io\") set_license(\"Apache 2.0\") set_description(\"A cross platform build utility based on Lua.\") set_formats(\"srpm\") add_sourcefiles(\"(src/**)\") add_sourcefiles(\"./configure\") on_buildcmd(function (package, batchcmds) batchcmds:runv(\"./configure\") batchcmds:runv(\"make\") end) on_installcmd(function (package, batchcmds) batchcmds:runv(\"make\", {\"install\", \"PREFIX %{buildroot}\"}) end) ``` ### ç”Ÿæˆ RPM äºŒè¿›åˆ¶å®‰è£…åŒ… RPM åŒ…å°†ä¼šç›´æ¥ç”Ÿæˆç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶å®‰è£…åŒ…ã€‚xmake ä¼šè‡ªåŠ¨è°ƒç”¨ `rpmbuild rebuild` å‘½ä»¤å»æ„å»º SRPM åŒ…ç”Ÿæˆå®ƒã€‚ è€Œåœ¨ XPack ä¸­ï¼Œæˆ‘ä»¬ä»…ä»…åªéœ€è¦é…ç½® `set_formats(\"rpm\")` å³å¯æ”¯æŒ rpm åŒ…ç”Ÿæˆï¼Œå…¶ä»–é…ç½®ä¸ srpm åŒ…å®Œå…¨ä¸€è‡´ã€‚ ```lua xpack(\"test\") set_formats(\"rpm\") TODO ``` ### æ‰“åŒ…å‘½ä»¤å‚æ•° #### æŒ‡å®šæ‰“åŒ…æ ¼å¼ å¦‚æœæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å·²ç»ä½¿ç”¨ `set_formats` é…ç½®äº†å¤šä¸ªæ‰“åŒ…æ ¼å¼ï¼Œé‚£ä¹ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œ`xmake pack` ä¼šè‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰è¿™äº›æ ¼å¼çš„åŒ…ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `xmake pack formats nsis,targz` æ¥é€‰æ‹©æ€§æŒ‡å®šå½“å‰éœ€è¦æ‰“å“ªäº›æ ¼å¼çš„åŒ…ã€‚ #### ä¿®æ”¹æ‰“åŒ…æ–‡ä»¶å æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ `set_basename()` æ¥ä¿®æ”¹åŒ…åï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå»ä¿®æ”¹å®ƒã€‚ ```bash $ xmake pack basename \"foo\" packing build/xpack/test/foo.zip .. pack ok ``` #### æŒ‡å®šè¾“å‡ºç›®å½• é»˜è®¤çš„è¾“å‡ºç›®å½•æ˜¯åœ¨ build ç›®å½•ä¸‹ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¿®æ”¹è¾“å‡ºçš„è·¯å¾„ã€‚ ```bash $ xmake pack o /tmp/output ``` #### ç¦ç”¨è‡ªåŠ¨æ„å»º å¦‚æœæ˜¯æ‰“ NSIS ç­‰äºŒè¿›åˆ¶åŒ…ï¼Œ`xmake pack` ä¼šå…ˆè‡ªåŠ¨ç¼–è¯‘æ‰€æœ‰è¢«ç»‘å®šçš„ target ç›®æ ‡æ–‡ä»¶ï¼Œç„¶åå†å»æ‰§è¡Œæ‰“åŒ…é€»è¾‘ã€‚ ä½†æ˜¯å¦‚æœæˆ‘ä»¬å·²ç»ç¼–è¯‘è¿‡äº†ï¼Œä¸æƒ³æ¯æ¬¡éƒ½å»ç¼–è¯‘å®ƒï¼Œè€Œæ˜¯ç›´æ¥å»æ‰“åŒ…ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‚æ•°ç¦ç”¨è‡ªåŠ¨æ„å»ºã€‚ ```bash $ xmake pack autobuild n ``` ### æ¥å£æè¿° æ›´å¤š XPack æ‰“åŒ…æ¥å£æè¿°è§ï¼š[XPack æ‰“åŒ…æ¥å£æ–‡æ¡£](https://xmake.io/#/zh cn/manual/xpack)ã€‚ ## å®è®°å½•å’Œå›æ”¾ ### ç®€ä»‹ æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ’ä»¶ï¼Œå¿«é€Ÿè®°å½•å’Œå›æ”¾æˆ‘ä»¬å¹³å¸¸é¢‘ç¹ä½¿ç”¨åˆ°çš„ä¸€äº› xmake æ“ä½œï¼Œæ¥ç®€åŒ–æˆ‘ä»¬æ—¥å¸¸çš„å¼€å‘å·¥ä½œã€‚ å®ƒæä¾›äº†ä¸€äº›åŠŸèƒ½ï¼š æ‰‹åŠ¨è®°å½•å’Œå›æ”¾å¤šæ¡æ‰§è¡Œè¿‡çš„ xmake å‘½ä»¤ æ”¯æŒå¿«é€Ÿçš„åŒ¿åå®åˆ›å»ºå’Œå›æ”¾ æ”¯æŒå‘½åå®çš„é•¿ä¹…è®°å½•å’Œé‡ç”¨ æ”¯æŒå®è„šæœ¬çš„æ‰¹é‡å¯¼å…¥å’Œå¯¼å‡º æ”¯æŒå®è„šæœ¬çš„åˆ é™¤ã€æ˜¾ç¤ºç­‰ç®¡ç†åŠŸèƒ½ æ”¯æŒè‡ªå®šä¹‰é«˜çº§å®è„šæœ¬ï¼Œä»¥åŠå‚æ•°é…ç½® ### è®°å½•æ“ä½œ ```console # å¼€å§‹è®°å½•å® $ xmake macro begin # æ‰§è¡Œä¸€äº› xmake å‘½ä»¤ $ xmake f p android ndk /xxx/ndk a arm64 v8a $ xmake p $ xmake f p mingw sdk /mingwsdk $ xmake p $ xmake f p linux sdk /toolsdk toolchains /xxxx/bin $ xmake p $ xmake f p iphoneos a armv7 $ xmake p $ xmake f p iphoneos a arm64 $ xmake p $ xmake f p iphoneos a armv7s $ xmake p $ xmake f p iphoneos a i386 $ xmake p $ xmake f p iphoneos a x86_64 $ xmake p # ç»“æŸå®è®°å½•ï¼Œè¿™é‡Œä¸è®¾ç½®å®åå­—ï¼Œæ‰€ä»¥è®°å½•çš„æ˜¯ä¸€ä¸ªåŒ¿åå® xmake macro end ``` ### å›æ”¾ ```console # å›æ”¾ä¸€ä¸ªåŒ¿åå® $ xmake macro . ``` ### å‘½åå® åŒ¿åå®çš„å¥½å¤„å°±æ˜¯å¿«é€Ÿè®°å½•ï¼Œå¿«é€Ÿå›æ”¾ï¼Œå¦‚æœéœ€è¦é•¿ä¹…ä¿å­˜ï¼Œå°±éœ€è¦ç»™å®å–ä¸ªåå­—ã€‚ ```console $ xmake macro begin $ ... $ xmake macro end macroname $ xmake macro macroname ``` ### å¯¼å…¥å¯¼å‡ºå® å¯¼å…¥æŒ‡å®šçš„å®è„šæœ¬æˆ–è€…å®ç›®å½•ï¼š ```console $ xmake macro import /xxx/macro.lua macroname $ xmake macro import /xxx/macrodir ``` å¯¼å‡ºæŒ‡å®šçš„å®åˆ°è„šæœ¬æˆ–è€…ç›®å½•ï¼š ```console $ xmake macro export /xxx/macro.lua macroname $ xmake macro export /xxx/macrodir ``` ### åˆ—ä¸¾æ˜¾ç¤ºå® åˆ—ä¸¾æ‰€æœ‰ `xmake` å†…ç½®çš„å®è„šæœ¬ï¼š ```console $ xmake macro list ``` æ˜¾ç¤ºæŒ‡å®šçš„å®è„šæœ¬å†…å®¹ï¼š ```console $ xmake macro show macroname ``` ### è‡ªå®šä¹‰å®è„šæœ¬ æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™ä¸ªå®è„šæœ¬ `macro.lua` ç„¶åå¯¼å…¥åˆ° xmake ä¸­å»ã€‚ ```lua function main() os.exec(\"xmake f p android ndk /xxx/ndk a arm64 v8a\") os.exec(\"xmake p\") os.exec(\"xmake f p mingw sdk /mingwsdk\") os.exec(\"xmake p\") os.exec(\"xmake f p linux sdk /toolsdk toolchains /xxxx/bin\") os.exec(\"xmake p\") os.exec(\"xmake f p iphoneos a armv7\") os.exec(\"xmake p\") os.exec(\"xmake f p iphoneos a arm64\") os.exec(\"xmake p\") os.exec(\"xmake f p iphoneos a armv7s\") os.exec(\"xmake p\") os.exec(\"xmake f p iphoneos a i386\") os.exec(\"xmake p\") os.exec(\"xmake f p iphoneos a x86_64\") os.exec(\"xmake p\") end ``` å¯¼å…¥åˆ° xmakeï¼Œå¹¶ä¸”å®šä¹‰å®åå­—ï¼š ```console $ xmake macro import /xxx/macro.lua [macroname] ``` å›æ”¾è¿™ä¸ªå®è„šæœ¬ï¼š ```console $ xmake macro [.macroname] ``` ### å†…ç½®çš„å®è„šæœ¬ XMake æä¾›äº†ä¸€äº›å†…ç½®çš„å®è„šæœ¬ï¼Œæ¥ç®€åŒ–æˆ‘ä»¬çš„æ—¥å¸¸å¼€å‘å·¥ä½œã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `package` å®æ¥å¯¹ `iphoneos` å¹³å°çš„æ‰€æœ‰æ¶æ„ï¼Œä¸€æ¬¡æ€§æ‰¹é‡æ„å»ºå’Œæ‰“åŒ…ï¼š ```console $ xmake macro package p iphoneos ``` ### é«˜çº§çš„å®è„šæœ¬ç¼–å†™ ä»¥ä¸Šé¢æåˆ°çš„ `package` å®ä¸ºä¾‹ï¼Œæˆ‘ä»¬çœ‹ä¸‹å…¶å…·ä½“ä»£ç ï¼Œé‡Œé¢é€šè¿‡ `import` å¯¼å…¥ä¸€äº›æ‰©å±•æ¨¡å—ï¼Œå®ç°äº†å¤æ‚çš„è„šæœ¬æ“ä½œã€‚ ```lua imports import(\"core.base.option\") import(\"core.project.config\") import(\"core.project.project\") import(\"core.platform.platform\") the options local options { {'p', \"plat\", \"kv\", os.host(), \"Set the platform.\" } , {'f', \"config\", \"kv\", nil, \"Pass the config arguments to \\\"xmake config\\\"..\"} , {'o', \"outputdir\", \"kv\", nil, \"Set the output directory of the package.\"} } package all .e.g xmake m package xmake m package f \" m debug\" xmake m package p linux xmake m package p iphoneos f \" m debug xxx ...\" o /tmp/xxx xmake m package f \\\" mode debug\\\" function main(argv) parse arguments local args option.parse(argv, options, \"Package all architectures for the given the platform.\" , \"\" , \"Usage: xmake macro package [options]\") package all archs local plat args.plat for _, arch in ipairs(platform.archs(plat)) do config it os.exec(\"xmake f p %s a %s %s c %s\", plat, arch, args.config or \"\", (option.get(\"verbose\") and\" v\"or\"\")) package it if args.outputdir then os.exec(\"xmake p o %s %s\", args.outputdir, (option.get(\"verbose\") and \" v\" or \"\")) else os.exec(\"xmake p %s\", (option.get(\"verbose\") and \" v\" or \"\")) end end package universal for iphoneos, watchos ... if plat \"iphoneos\" or plat \"watchos\" then load configure config.load() load project project.load() enter the project directory os.cd(project.directory()) the outputdir directory local outputdir args.outputdir or config.get(\"buildir\") package all targets for _, target in pairs(project.targets()) do get all modes local modedirs os.match(format(\"%s/%s.pkg/lib/*\", outputdir, target:name()), true) for _, modedir in ipairs(modedirs) do get mode local mode path.basename(modedir) make lipo arguments local lipoargs nil for _, arch in ipairs(platform.archs(plat)) do local archfile format(\"%s/%s.pkg/lib/%s/%s/%s/%s\", outputdir, target:name(), mode, plat, arch, path.filename(target:targetfile())) if os.isfile(archfile) then lipoargs format(\"%s arch %s %s\", lipoargs or \"\", arch, archfile) end end if lipoargs then make full lipo arguments lipoargs format(\" create %s output %s/%s.pkg/lib/%s/%s/universal/%s\", lipoargs, outputdir, target:name(), mode, plat, path.filename(target:targetfile())) make universal directory os.mkdir(format(\"%s/%s.pkg/lib/%s/%s/universal\", outputdir, target:name(), mode, plat)) package all archs os.execv(\"xmake\", {\"l\", \"lipo\", lipoargs}) end end end end end ``` !> å¦‚æœä½ æƒ³è¦è·å–æ›´å¤šå®å‚æ•°é€‰é¡¹ä¿¡æ¯ï¼Œè¯·è¿è¡Œï¼š `xmake macro help` ## ç”Ÿæˆ doxygen æ–‡æ¡£ è¯·å…ˆç¡®ä¿æœ¬æœºå·²å®‰è£… `doxygen` å·¥å…·ï¼Œç„¶ååœ¨å·¥ç¨‹ç›®å½•ä¸‹è¿è¡Œï¼š ```console $ xmake doxygen ```"},"/get_started/zh/task/plugin-development.html":{"title":"","content":" class: heading_no_counter # å¼€å‘æ’ä»¶ ## ç®€ä»‹ xmake å®Œå…¨æ”¯æŒæ’ä»¶æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰©å±•å®ç°è‡ªå·±çš„æ’ä»¶ï¼Œå¹¶ä¸” xmake ä¹Ÿæä¾›äº†ä¸€äº›å†…å»ºçš„ä½¿ç”¨æ’ä»¶ã€‚ æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹ `xmake h` çœ‹ä¸‹å½“å‰æ”¯æŒçš„æ’ä»¶ï¼š ``` Plugins: l, lua Run the lua script. m, macro Run the given macro. doxygen Generate the doxygen document. hello Hello xmake! project Create the project file. ``` * lua: è¿è¡Œ lua è„šæœ¬çš„æ’ä»¶ * macro: è¿™ä¸ªå¾ˆå®ç”¨ï¼Œå®è„šæœ¬æ’ä»¶ï¼Œå¯ä»¥æ‰‹åŠ¨å½•åˆ¶å¤šæ¡ xmake å‘½ä»¤å¹¶ä¸”å›æ”¾ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è„šæœ¬å®ç°ä¸€äº›å¤æ‚çš„å®è„šæœ¬ï¼Œè¿™ä¸ªæˆ‘ä»¬åç»­ä¼šæ›´åŠ è¯¦ç»†çš„ä»‹ç» * doxygenï¼šä¸€é”®ç”Ÿæˆ doxygen æ–‡æ¡£çš„æ’ä»¶ * hello: æ’ä»¶ demoï¼Œä»…ä»…æ˜¾ç¤ºä¸€å¥è¯ï¼š'hello xmake!' * projectï¼š ç”Ÿæˆå·¥ç¨‹æ–‡ä»¶çš„æ’ä»¶ï¼Œç›®å‰å·²ç»æ”¯æŒ make, cmake, ninja, xcode (éœ€è¦ cmake) å’Œ vs çš„å·¥ç¨‹æ–‡ä»¶ä»¥åŠ compile_commands.json å’Œ compile_flags.txt æ–‡ä»¶çš„ç”Ÿæˆ ## å¿«é€Ÿå¼€å§‹ æ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸‹æœ¬æ–‡çš„é‡ç‚¹ï¼Œä¸€ä¸ªç®€å•çš„ hello xmake æ’ä»¶çš„å¼€å‘ï¼Œä»£ç å¦‚ä¸‹ï¼š ```lua å®šä¹‰ä¸€ä¸ªåå« hello çš„æ’ä»¶ä»»åŠ¡ task(\"hello\", function() è®¾ç½®ç±»å‹ä¸ºæ’ä»¶ set_category(\"plugin\") æ’ä»¶è¿è¡Œçš„å…¥å£ on_run(function () æ˜¾ç¤º hello xmake! print(\"hello xmake!\") end) è®¾ç½®æ’ä»¶çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œè¿™é‡Œæ²¡æœ‰ä»»ä½•å‚æ•°é€‰é¡¹ï¼Œä»…ä»…æ˜¾ç¤ºæ’ä»¶æè¿° set_menu { usage usage \"xmake hello [options]\" description , description \"Hello xmake!\" options , options {} } end) ``` è¿™ä¸ªæ’ä»¶çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š ``` plugins hello xmake.lua ... plugins ç›®å½•ä¸‹æ— éœ€ xmake.lua ``` ç°åœ¨ä¸€ä¸ªæœ€ç®€å•çš„æ’ä»¶å†™å®Œäº†ï¼Œé‚£æ€ä¹ˆè®©å®ƒè¢« xmake æ£€æµ‹åˆ°å‘¢ï¼Œæœ‰ä¸‰ç§æ–¹å¼ï¼š 1. æŠŠ hello è¿™ä¸ªæ–‡ä»¶å¤¹æ”¾ç½®åœ¨ xmake çš„æ’ä»¶å®‰è£…ç›®å½• `xmake/plugins`ï¼Œè¿™ä¸ªé‡Œé¢éƒ½æ˜¯äº›å†…å»ºçš„æ’ä»¶ 2. æŠŠ hello æ–‡ä»¶å¤¹æ”¾ç½®åœ¨ `~/.xmake/plugins` ç”¨æˆ·å…¨å±€ç›®å½•ï¼Œè¿™æ ·å¯¹å½“å‰ xmake å…¨å±€ç”Ÿæ•ˆ 3. æŠŠ hello æ–‡ä»¶å¤¹æ”¾ç½®åœ¨å½“å‰å·¥ç¨‹çš„ `./plugins` ç›®å½•ä¸‹ï¼Œé€šè¿‡åœ¨å·¥ç¨‹æè¿°æ–‡ä»¶ xmake.lua ä¸­è°ƒç”¨ `add_plugindirs(\"plugins\")` æ·»åŠ å½“å‰çš„å·¥ç¨‹çš„æ’ä»¶æœç´¢ç›®å½•ï¼Œè¿™æ ·åªå¯¹å½“å‰å·¥ç¨‹ç”Ÿæ•ˆ ## è¿è¡Œæ’ä»¶ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°è¯•è¿è¡Œä¸‹è¿™ä¸ªæ’ä»¶ï¼š ```console xmake hello ``` æ˜¾ç¤ºç»“æœï¼š ``` hello xmake! ``` æœ€åæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ target è‡ªå®šä¹‰çš„è„šæœ¬ä¸­è¿è¡Œè¿™ä¸ªæ’ä»¶ï¼š ```lua target(\"demo\", function() æ„å»ºä¹‹åè¿è¡Œæ’ä»¶ after_build(function (target) å¯¼å…¥ task æ¨¡å— import(\"core.project.task\") è¿è¡Œæ’ä»¶ä»»åŠ¡ task.run(\"hello\") end) end) ```"},"/get_started/zh/task/description-scope.html":{"title":"","content":" class: heading_no_counter # æè¿°åŸŸ xmake å¯ä»¥å®ç°è‡ªå®šä¹‰ä»»åŠ¡æˆ–è€…æ’ä»¶ï¼Œå…¶ä¸¤è€…çš„æ ¸å¿ƒå°±æ˜¯ `task` ä»»åŠ¡ï¼Œå…¶ä¸¤è€…å®é™…ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œxmake çš„æ’ä»¶éƒ½æ˜¯ç”¨ `task` å®ç°çš„ã€‚ æœ¬è´¨ä¸Šéƒ½æ˜¯ä»»åŠ¡ï¼Œåªæ˜¯ [set_category](#taskset_category) åˆ†ç±»ä¸åŒè€Œå·²ã€‚ æ¥å£ æè¿° [task](#task) å®šä¹‰æ’ä»¶æˆ–è€…ä»»åŠ¡ [set_menu](#taskset_menu) è®¾ç½®ä»»åŠ¡èœå• [set_category](#taskset_category) è®¾ç½®ä»»åŠ¡ç±»åˆ« [on_run](#taskon_run) è®¾ç½®ä»»åŠ¡è¿è¡Œè„šæœ¬ ## task å®šä¹‰æ’ä»¶æˆ–è€…ä»»åŠ¡ã€‚ `task` åŸŸç”¨äºæè¿°ä¸€ä¸ªè‡ªå®šä¹‰çš„ä»»åŠ¡å®ç°ï¼Œä¸ [target](#target) å’Œ[option](#option)åŒçº§ã€‚ ä¾‹å¦‚ï¼Œè¿™é‡Œå®šä¹‰ä¸€ä¸ªæœ€ç®€å•çš„ä»»åŠ¡ï¼š ```lua task(\"hello\", function() è®¾ç½®è¿è¡Œè„šæœ¬ on_run(function () print(\"hello xmake!\") end) end) ``` è¿™ä¸ªä»»åŠ¡åªéœ€è¦æ‰“å° `hello xmake!`ï¼Œé‚£å¦‚ä½•æ¥è¿è¡Œå‘¢ï¼Ÿ ç”±äºè¿™é‡Œæ²¡æœ‰ä½¿ç”¨ [set_menu](#taskset_menu) è®¾ç½®èœå•ï¼Œå› æ­¤è¿™ä¸ªä»»åŠ¡åªèƒ½åœ¨ `xmake.lua` çš„è‡ªå®šä¹‰è„šæœ¬æˆ–è€…å…¶ä»–ä»»åŠ¡å†…éƒ¨è°ƒç”¨ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() after_build(function (target) å¯¼å…¥ task æ¨¡å— import(\"core.project.task\") è¿è¡Œ hello ä»»åŠ¡ task.run(\"hello\") end) end) ``` åœ¨æ„å»ºå®Œ `test` ç›®æ ‡åè¿è¡Œ `hello` ä»»åŠ¡ã€‚ ## task:set_menu è®¾ç½®ä»»åŠ¡èœå•ã€‚ é€šè¿‡è®¾ç½®ä¸€ä¸ªèœå•ï¼Œè¿™ä¸ªä»»åŠ¡å°±å¯ä»¥å¼€æ”¾ç»™ç”¨æˆ·è‡ªå·±é€šè¿‡å‘½ä»¤è¡Œæ‰‹åŠ¨è°ƒç”¨ï¼Œèœå•çš„è®¾ç½®å¦‚ä¸‹ï¼š ```lua task(\"echo\", function() è®¾ç½®è¿è¡Œè„šæœ¬ on_run(function () å¯¼å…¥å‚æ•°é€‰é¡¹æ¨¡å— import(\"core.base.option\") åˆå§‹åŒ–é¢œè‰²æ¨¡å¼ local modes \"\" for _, mode in ipairs({\"bright\", \"dim\", \"blink\", \"reverse\"}) do if option.get(mode) then modes modes .. \" \" .. mode end end è·å–å‚æ•°å†…å®¹å¹¶ä¸”æ˜¾ç¤ºä¿¡æ¯ cprint(\"${%s%s}%s\", option.get(\"color\"), modes, table.concat(option.get(\"contents\") or {}, \" \")) end) è®¾ç½®æ’ä»¶çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œè¿™é‡Œæ²¡æœ‰ä»»ä½•å‚æ•°é€‰é¡¹ï¼Œä»…ä»…æ˜¾ç¤ºæ’ä»¶æè¿° set_menu { è®¾ç½®èœå•ç”¨æ³• usage \"xmake echo [options]\" è®¾ç½®èœå•æè¿° , description \"Echo the given info!\" è®¾ç½®èœå•é€‰é¡¹ï¼Œå¦‚æœæ²¡æœ‰é€‰é¡¹ï¼Œå¯ä»¥è®¾ç½®ä¸º {} , options { è®¾ç½® k æ¨¡å¼ä½œä¸º key only å‹ bool å‚æ•° {'b', \"bright\", \"k\", nil, \"Enable bright.\"} , {'d', \"dim\", \"k\", nil, \"Enable dim.\"} , {' ', \"blink\", \"k\", nil, \"Enable blink.\"} , {'r', \"reverse\", \"k\", nil, \"Reverse color.\"} èœå•æ˜¾ç¤ºæ—¶ï¼Œç©ºç™½ä¸€è¡Œ , {} è®¾ç½® kv ä½œä¸º key value å‹å‚æ•°ï¼Œå¹¶ä¸”è®¾ç½®é»˜è®¤å€¼ï¼šblack , {'c', \"color\", \"kv\", \"black\", \"Set the output color.\" , \" red\" , \" blue\" , \" yellow\" , \" green\" , \" magenta\" , \" cyan\" , \" white\" } è®¾ç½® `vs` ä½œä¸º values å¤šå€¼å‹å‚æ•°ï¼Œè¿˜æœ‰ `v` å•å€¼ç±»å‹ ä¸€èˆ¬æ”¾ç½®åœ¨æœ€åï¼Œç”¨äºè·å–å¯å˜å‚æ•°åˆ—è¡¨ , {} , {nil, \"contents\", \"vs\", nil, \"The info contents.\"} } } end) ``` å®šä¹‰å®Œè¿™ä¸ªä»»åŠ¡åï¼Œæ‰§è¡Œ `xmake help`ï¼Œå°±ä¼šå¤šå‡ºä¸€ä¸ªä»»åŠ¡é¡¹æ¥ï¼š ``` Tasks: ... echo Echo the given info! ``` å¦‚æœé€šè¿‡ [set_category](#taskset_category) è®¾ç½®åˆ†ç±»ä¸º `plugin`ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡å°±æ˜¯ä¸€ä¸ªæ’ä»¶äº†ï¼š ``` Plugins: ... echo Echo the given info! ``` æƒ³è¦æ‰‹åŠ¨è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œå¯ä»¥æ‰§è¡Œï¼š ```bash $ xmake echo hello xmake! ``` å°±è¡Œäº†ï¼Œå¦‚æœè¦çœ‹è¿™ä¸ªä»»åŠ¡å®šä¹‰çš„èœå•ï¼Œåªéœ€è¦æ‰§è¡Œï¼š`xmake echo [ h help]`ï¼Œæ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š ```bash Usage: $xmake echo [options] Echo the given info! Options: v, verbose Print lots of verbose information. backtrace Print backtrace information for debugging. profile Print performance data for debugging. version Print the version number and exit. h, help Print this help message and exit. F FILE, file FILE Read a given xmake.lua file. P PROJECT, project PROJECT Change to the given project directory. Search priority: 1. The Given Command Argument 2. The Envirnoment Variable: XMAKE_PROJECT_DIR 3. The Current Directory b, bright Enable bright. d, dim Enable dim. , blink Enable blink. r, reverse Reverse color. c COLOR, color COLOR Set the output color. (default: black) red blue yellow green magenta cyan white contents ... The info contents. ``` > å…¶ä¸­èœå•æœ€å¼€å¤´çš„éƒ¨åˆ†é€‰é¡¹ï¼Œæ˜¯ xmake å†…ç½®çš„å¸¸ç”¨é€‰é¡¹ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸ªä»»åŠ¡éƒ½ä¼šç”¨åˆ°ï¼Œä¸éœ€è¦è‡ªå·±é¢å¤–å®šä¹‰ï¼Œç®€åŒ–èœå•å®šä¹‰ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®é™…è¿è¡Œä¸‹è¿™ä¸ªä»»åŠ¡ï¼Œä¾‹å¦‚æˆ‘è¦æ˜¾ç¤ºçº¢è‰²çš„ `hello xmake!`ï¼Œåªéœ€è¦ï¼š ```bash $ xmake echo c red hello xmake! ``` ä¹Ÿå¯ä»¥ä½¿ç”¨é€‰é¡¹å…¨åï¼Œå¹¶ä¸”åŠ ä¸Šé«˜äº®ï¼š ```bash $ xmake echo color red bright hello xmake! ``` æœ€åé¢çš„å¯å˜å‚æ•°åˆ—è¡¨ï¼Œåœ¨ `run` è„šæœ¬ä¸­é€šè¿‡ `option.get(\"contents\")` è·å–ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª `table` ç±»å‹çš„æ•°ç»„ã€‚ ## task:set_category è®¾ç½®ä»»åŠ¡ç±»åˆ«ã€‚ ä»…ä»…ç”¨äºèœå•çš„åˆ†ç»„æ˜¾ç¤ºï¼Œå½“ç„¶æ’ä»¶é»˜è®¤ä¼šç”¨ `plugin`ï¼Œå†…ç½®ä»»åŠ¡é»˜è®¤ä¼šç”¨ï¼š`action`ï¼Œä½†ä¹Ÿä»…ä»…åªæ˜¯ä¸ªçº¦å®šã€‚ > ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•è‡ªå·±å®šä¹‰çš„åå­—ï¼Œç›¸åŒåå­—ä¼šåˆ†ç»„å½’ç±»åˆ°ä¸€èµ·æ˜¾ç¤ºï¼Œå¦‚æœè®¾ç½®ä¸º `plugin`ï¼Œå°±ä¼šæ˜¾ç¤ºåˆ° xmake çš„ Plugins åˆ†ç»„ä¸­å»ã€‚ ä¾‹å¦‚ï¼š ```lua Plugins: l, lua Run the lua script. m, macro Run the given macro. doxygen Generate the doxygen document. project Generate the project file. hello Hello xmake! app2ipa Generate .ipa file from the given .app echo Echo the given info! ``` å¦‚æœæ²¡æœ‰è°ƒç”¨è¿™ä¸ªæ¥å£è®¾ç½®åˆ†ç±»ï¼Œé»˜è®¤ä½¿ç”¨ `Tasks` åˆ†ç»„æ˜¾ç¤ºï¼Œä»£è¡¨æ™®é€šä»»åŠ¡ã€‚ ## task:on_run è®¾ç½®ä»»åŠ¡è¿è¡Œè„šæœ¬ã€‚ å¯ä»¥æœ‰ä¸¤ç§è®¾ç½®æ–¹å¼ï¼Œæœ€ç®€å•çš„å°±æ˜¯è®¾ç½®å†…åµŒå‡½æ•°ï¼š ```lua task(\"hello\", function() on_run(function () print(\"hello xmake!\") end) end) ``` è¿™ç§å¯¹äºå°ä»»åŠ¡å¾ˆæ–¹ä¾¿ï¼Œä¹Ÿå¾ˆç®€æ´ï¼Œä½†æ˜¯å¯¹äºå¤§å‹ä»»åŠ¡å°±ä¸å¤ªé€‚ç”¨äº†ï¼Œä¾‹å¦‚æ’ä»¶ç­‰ï¼Œéœ€è¦å¤æ‚çš„è„šæœ¬æ”¯æŒã€‚ è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç‹¬ç«‹çš„æ¨¡å—æ–‡ä»¶æ¥è®¾ç½®è¿è¡Œè„šæœ¬ï¼Œä¾‹å¦‚ï¼š ```lua task(\"hello\", function() on_run(\"main\") end) ``` è¿™é‡Œçš„ `main` è®¾ç½®ä¸ºè„šæœ¬è¿è¡Œä¸»å…¥å£æ¨¡å—ï¼Œæ–‡ä»¶åä¸º `main.lua`ï¼Œæ”¾åœ¨å®šä¹‰ `task` çš„ `xmake.lua` çš„åŒç›®å½•ä¸‹ï¼Œå½“ç„¶ä½ å¯ä»¥èµ·å…¶ä»–æ–‡ä»¶åã€‚ ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š ``` projectdir xmake.lua main.lua ``` `main.lua` é‡Œé¢å†…å®¹å¦‚ä¸‹ï¼š ```lua function main(...) print(\"hello xmake!\") end ``` å°±æ˜¯ä¸€ä¸ªç®€å•çš„å¸¦ `main` ä¸»å‡½æ•°çš„è„šæœ¬æ–‡ä»¶ï¼Œä½ å¯ä»¥é€šè¿‡ [import](/zh cn/manual/builtin_modules?id import) å¯¼å…¥å„ç§æ‰©å±•æ¨¡å—ï¼Œå®ç°å¤æ‚åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š ```lua å¯¼å…¥å‚æ•°é€‰é¡¹æ¨¡å— import(\"core.base.option\") å…¥å£å‡½æ•° function main(...) è·å–å‚æ•°å†…å®¹ print(\"color: %s\", option.get(\"color\")) end ``` ä½ ä¹Ÿå¯ä»¥åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œåˆ›å»ºå¤šä¸ªè‡ªå®šä¹‰çš„æ¨¡å—æ–‡ä»¶ï¼Œé€šè¿‡ [import](/zh cn/manual/builtin_modules?id import) å¯¼å…¥åä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š ``` projectdir xmake.lua main.lua module.lua ``` `module.lua` çš„å†…å®¹å¦‚ä¸‹ï¼š ```lua å®šä¹‰ä¸€ä¸ªå¯¼å‡ºæ¥å£ function hello() print(\"hello xmake!\") end ``` > ç§æœ‰æ¥å£ï¼Œé€šè¿‡ `_hello` å¸¦ä¸‹æ»‘çº¿å‰ç¼€å‘½åï¼Œè¿™æ ·å¯¼å…¥çš„æ¨¡å—å°±ä¸ä¼šåŒ…å«æ­¤æ¥å£ï¼Œåªåœ¨æ¨¡å—è‡ªèº«å†…éƒ¨ä½¿ç”¨ã€‚ ç„¶ååœ¨ `main.lua` è¿›è¡Œè°ƒç”¨ï¼š ```lua import(\"module\") function main(...) module.hello() end ``` æ›´å¤šæ¨¡å—ä»‹ç»è§ï¼š[å†…ç½®æ¨¡å—](/zh cn/manual/builtin_modules) å’Œ [æ‰©å±•æ¨¡å—](/zh cn/manual/extension_modules) å…¶ä¸­ï¼Œ`main(...)` ä¸­å‚æ•°ï¼Œæ˜¯é€šè¿‡ `task.run` æŒ‡å®šçš„ï¼Œä¾‹å¦‚ï¼š ```lua task.run(\"hello\", {color \"red\"}, arg1, arg2, arg3) ``` é‡Œé¢çš„ `arg1, arg2` è¿™äº›å°±æ˜¯ä¼ å…¥ `hello` ä»»åŠ¡ `main(...)` å…¥å£çš„å‚æ•°åˆ—è¡¨ï¼Œè€Œ `{color \"red\"}` ç”¨æ¥æŒ‡å®šä»»åŠ¡èœå•ä¸­çš„å‚æ•°é€‰é¡¹ã€‚ æ›´åŠ è¯¦ç»†çš„ `task.run` æè¿°ï¼Œè§ï¼š[task.run](#task run)ã€‚"},"/get_started/zh/target/script-scope.html":{"title":"","content":" class: heading_no_counter # è„šæœ¬åŸŸ æ­¤é¡µé¢æè¿°äº† [å·¥ç¨‹ç›®æ ‡](zh cn/manual/project_target.html) çš„ `on_load()`ã€`before_build()` æˆ– `after_install()` ç­‰å‡½æ•°çš„ `target` æ¥å£ã€‚ ## target:name è·å–ç›®æ ‡çš„åå­—ã€‚ ## target:get è·å–ç›®æ ‡åœ¨æè¿°åŸŸçš„é…ç½®å€¼ã€‚ ä»»ä½•åœ¨æè¿°åŸŸçš„ `set_xxx` å’Œ `add_xxx` é…ç½®å€¼éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£è·å–åˆ°ã€‚ ```lua get the links target:get(\"links\") get the defined macros target:get(\"defines\") ``` ## target:set è®¾ç½®ç›®æ ‡çš„é…ç½®å€¼ï¼Œï¼ˆå¦‚æœä½ æƒ³æ·»åŠ å€¼å¯ä»¥ç”¨ [target:add](#targetadd)ï¼‰ã€‚ ```lua set the links target:set(\"links\", \"sdl2\") set the defined macros target:set(\"defines\", \"SDL_MAIN_HANDLED\") ``` ## target:add æŒ‰åç§°æ·»åŠ åˆ°ç›®æ ‡çš„å€¼ã€‚ ```lua add links target:add(\"links\", \"sdl2\") add defined macros target:add(\"defines\", \"SDL_MAIN_HANDLED\") ``` ## target:kind è·å–ç›®æ ‡ç¨‹åºç±»å‹ã€‚ å¯¹åº” `set_kind` æè¿°åŸŸæ¥å£è®¾ç½®ã€‚ç›®æ ‡ç±»å‹ä¸»è¦æœ‰ï¼šbinary, static, shared, phony, object, headeronlyã€‚ ## target:is_plat å½“å‰å¹³å°æ˜¯å¦æ˜¯ç»™å®šå¹³å°ä¹‹ä¸€ã€‚ å°½ç®¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ `is_plat` å…¨å±€æ¥å£ç›´æ¥åˆ¤æ–­å¹³å°ï¼Œä½†æ˜¯ xmake æ”¯æŒä½¿ç”¨ `set_plat` é’ˆå¯¹ç‰¹å®š target å•ç‹¬è®¾ç½®ç¼–è¯‘å¹³å°ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œä½¿ç”¨å…¨å±€æ¥å£ï¼Œå°±ä¸é€‚ç”¨äº†ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬æ¨èä½¿ç”¨ target æä¾›çš„æ¥å£ï¼Œæ¥ç›´æ¥å¯¹å½“å‰ target åˆ¤æ–­ç¼–è¯‘å¹³å°ï¼Œæ›´åŠ å¯é ã€‚ ```lua Is the current platform android? target:is_plat(\"android\") Is the current platform windows, linux or macosx? target:is_plat(\"windows\", \"linux\", \"macosx\") ``` ## target:is_arch å½“å‰æ¶æ„æ˜¯å¦æ˜¯ç»™å®šæ¶æ„ä¹‹ä¸€ã€‚ å°½ç®¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ `is_arch` å…¨å±€æ¥å£ç›´æ¥åˆ¤æ–­æ¶æ„ï¼Œä½†æ˜¯ xmake æ”¯æŒä½¿ç”¨ `set_arch` é’ˆå¯¹ç‰¹å®š target å•ç‹¬è®¾ç½®ç¼–è¯‘æ¶æ„ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œä½¿ç”¨å…¨å±€æ¥å£ï¼Œå°±ä¸é€‚ç”¨äº†ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬æ¨èä½¿ç”¨ target æä¾›çš„æ¥å£ï¼Œæ¥ç›´æ¥å¯¹å½“å‰ target åˆ¤æ–­ç¼–è¯‘æ¶æ„ï¼Œæ›´åŠ å¯é ã€‚ ```lua Is the current architecture x86 target:is_arch(\"x86\") Is the current architecture x64 or x86_64 target:is_arch(\"x64\", \"x86_64\") ``` ## target:targetfile è·å–ç›®æ ‡æ–‡ä»¶è·¯å¾„ã€‚ ä¸»è¦ç”¨äºè·å– static, shared, binary ç›®æ ‡ç¨‹åºæ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ã€‚ ```lua os.cp(target:targetfile(), \"/tmp/\") ``` ## target:targetdir è·å–ç›®æ ‡æ–‡ä»¶çš„è¾“å‡ºç›®å½•ã€‚ ä¹Ÿå°±æ˜¯ target:targetfile() å¯¹åº”çš„å­˜å‚¨ç›®å½•ã€‚ ## target:basename è·å–ç›®æ ‡æ–‡ä»¶çš„ base åã€‚ ä¹Ÿå°±æ˜¯ libfoo.aï¼Œfoo.dll, foo.exe ä¸­çš„ `foo`ã€‚ ## target:filename è·å–ç›®æ ‡æ–‡ä»¶åã€‚ ç›®æ ‡æ–‡ä»¶çš„å®Œæ•´æ–‡ä»¶åï¼Œç­‰ä»·äº `path.filename(target:targetfile())`ã€‚ ## target:installdir è·å–ç›®æ ‡æ–‡ä»¶çš„å®‰è£…ç›®å½•ã€‚ é€šå¸¸ç”¨äº `xmake install/uninstall` çš„ after_install ç­‰è„šæœ¬ä¸­è·å–å¯¹åº”çš„å®‰è£…ç›®å½•è·¯å¾„ï¼Œå¯ä»¥ç”¨äºç”¨æˆ·è‡ªå®šä¹‰å®‰è£…è„šæœ¬ã€‚ ## target:autogendir è·å–è‡ªåŠ¨ç”Ÿæˆç›®å½•ã€‚ è¿™ä¸ªé€šå¸¸ç”¨äºä¸€äº›è‡ªå®šä¹‰è§„åˆ™è„šæœ¬ä¸­ï¼Œå­˜æ”¾ä¸€äº›ç‰¹å®šäº target çš„è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶ï¼Œè·¯å¾„é€šå¸¸åœ¨ `build/.gens/target` ä¸‹é¢ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨å¤„ç† lex/yacc è‡ªåŠ¨ç”Ÿæˆä¸€äº›æºç æ–‡ä»¶ï¼Œå°±å¯ä»¥å­˜æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œæ–¹ä¾¿ä¹‹åå»å¤„ç†å®ƒã€‚ ## target:objectfile è·å–å¯¹è±¡æ–‡ä»¶è·¯å¾„ã€‚ é€šå¸¸ç”¨äºè‡ªå®šä¹‰è„šæœ¬ä¸­ï¼Œè·å–æºæ–‡ä»¶å¯¹åº”çš„ç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼Œä¾‹å¦‚ï¼š ```lua local objectfile target:objectfile(sourcefile) ``` ## target:sourcebatches è·å–æ‰€æœ‰æºæ–‡ä»¶ã€‚ å®ƒå¯ä»¥è·å–åˆ° `add_files` æ·»åŠ çš„æ‰€æœ‰æºæ–‡ä»¶ï¼Œå¹¶ä¸”æ ¹æ®ä¸åŒæºæ–‡ä»¶ç±»å‹ï¼Œåˆ†åˆ«å­˜å‚¨ã€‚ å¤§æ¦‚ç»“æ„å¦‚ä¸‹ï¼š ```lua { \"c++.build\" { objectfiles { \"build/.objs/test/macosx/x86_64/release/src/main.cpp.o\" }, rulename \"c++.build\", sourcekind \"cxx\", sourcefiles { \"src/main.cpp\" }, dependfiles { \"build/.deps/test/macosx/x86_64/release/src/main.cpp.o.d\" } }, \"asm.build\" { objectfiles { \"build/.objs/test/macosx/x86_64/release/src/test.S.o\" }, rulename \"asm.build\", sourcekind \"as\", sourcefiles { \"src/test.S\" }, dependfiles { \"build/.deps/test/macosx/x86_64/release/src/test.S.o.d\" } } } ``` æˆ‘ä»¬å¯ä»¥é€šè¿‡éå†å»è·å–å¤„ç†æ¯ç§ç±»å‹çš„æºæ–‡ä»¶ã€‚ ```lua for _, sourcebatch in pairs(target:sourcebatches()) do local sourcekind sourcebatch.sourcekind if sourcekind \"cc\" or sourcekind \"cxx\" or sourcekind \"as\" then for _, sourcefile in ipairs(sourcebatch.sourcefiles) do TODO end end end ``` å…¶ä¸­ sourcekind æ˜¯æ¯ç§æºæ–‡ä»¶çš„ç±»å‹ï¼Œcc æ˜¯ c æ–‡ä»¶ç±»å‹ï¼Œcxx æ˜¯ c++ æºæ–‡ä»¶ï¼Œas æ˜¯ asm æºæ–‡ä»¶ã€‚ sourcebatch å¯¹åº”æ¯ç§ç±»å‹çš„æºæ–‡ä»¶ batchï¼Œå¯¹åº”ä¸€æ‰¹åŒç±»å‹æºæ–‡ä»¶ã€‚ sourcebatch.sourcefiles æ˜¯æºæ–‡ä»¶åˆ—è¡¨ï¼Œsourcebatch.objectfiles æ˜¯å¯¹è±¡æ–‡ä»¶åˆ—è¡¨ï¼Œsourcebatch.rulename æ˜¯å¯¹åº”çš„è§„åˆ™åã€‚ ## target:objectfiles è·å–æ‰€æœ‰å¯¹è±¡æ–‡ä»¶åˆ—è¡¨ã€‚ å°½ç®¡ `target:sourcebatches()` ä¹Ÿå¯ä»¥è·å–æ‰€æœ‰å¯¹è±¡æ–‡ä»¶ï¼Œä½†æ˜¯å®ƒä»¬æ˜¯æ ¹æ®æºæ–‡ä»¶ç±»å‹åˆ†ç±»è¿‡çš„ï¼Œä¸”ä¸ç›´æ¥å‚ä¸æœ€ç»ˆé“¾æ¥ã€‚ å¦‚æœæˆ‘ä»¬æƒ³åŠ¨æ€ä¿®æ”¹æœ€ç»ˆé“¾æ¥çš„å¯¹è±¡æ–‡ä»¶åˆ—è¡¨ï¼Œå¯ä»¥ä¿®æ”¹ `target:objectfiles()`ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•°ç»„åˆ—è¡¨ã€‚ ## target:headerfiles è·å–æ‰€æœ‰çš„å¤´æ–‡ä»¶åˆ—è¡¨ã€‚ å¯ä»¥è·å–åˆ° `add_headerfiles()` æ¥å£è®¾ç½®çš„æ‰€æœ‰å¤´æ–‡ä»¶åˆ—è¡¨ã€‚ ```lua for _, headerfile in ipairs(target:headerfiles()) do TODO end ``` ## target:scriptdir è·å–ç›®æ ‡å®šä¹‰æ‰€åœ¨çš„ xmake.lua ç›®å½•ã€‚ è¿™é€šå¸¸åœ¨è‡ªå®šä¹‰è§„åˆ™ä¸­ä½¿ç”¨çš„æ¯”è¾ƒå¤šï¼Œæƒ³è·å–å½“å‰ target å®é™…è¢«å®šä¹‰åœ¨å“ªä¸ª xmake.lua æ‰€åœ¨ç›®å½•ä¸‹ï¼Œæ–¹ä¾¿å¼•ç”¨ä¸€äº›èµ„æºæ–‡ä»¶ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ¥å£ã€‚ ## target:has_cfuncs æ£€æµ‹ç›®æ ‡ç¼–è¯‘é…ç½®èƒ½å¦è·å–ç»™å®šçš„ C å‡½æ•°ã€‚ è¿™åº”è¯¥åœ¨ `on_config` ä¸­ä½¿ç”¨ï¼Œæ¯”å¦‚å¯ä»¥ç”¨å®ƒæ¥åˆ¤æ–­å½“å‰ç›®æ ‡èƒ½å¦è·å–åˆ° zlib ä¾èµ–åŒ…çš„ä¸€äº›å‡½æ•°æ¥å£ï¼Œç„¶åè‡ªåŠ¨å®šä¹‰ `HAVE_INFLATE`ï¼š ```lua add_requires(\"zlib\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"zlib\") on_config(function (target) if target:has_cfuncs(\"inflate\", {includes \"zlib.h\"}) then target:add(\"defines\", \"HAVE_INFLATE\") end end) end) ``` å°½ç®¡ option ä¹Ÿæä¾›äº†ç±»ä¼¼çš„æ£€æµ‹åŠŸèƒ½ï¼Œä½† option çš„æ£€æµ‹ä½¿ç”¨çš„æ˜¯å…¨å±€çš„å¹³å°å·¥å…·é“¾ï¼Œå®ƒæ— æ³•é™„å¸¦ä¸Š target ç›¸å…³çš„ä¸€äº›ç¼–è¯‘é…ç½®ï¼Œä¹Ÿæ— æ³•æ ¹æ® target è®¾ç½®ä¸åŒç¼–è¯‘å·¥å…·é“¾æ¥é€‚é…æ£€æµ‹ï¼Œå¹¶ä¸”æ— æ³•æ£€æµ‹åŒ…é‡Œé¢çš„ä¸€äº›æ¥å£ã€‚ å¦‚æœæˆ‘ä»¬ä»…ä»…æ˜¯æƒ³ç²—ç²’åº¦çš„æ£€æµ‹å‡½æ•°æ¥å£ï¼Œå¹¶ä¸” target æ²¡æœ‰é¢å¤–è®¾ç½®ä¸åŒçš„å·¥å…·é“¾ï¼Œé‚£ä¹ˆ option æä¾›çš„æ£€æµ‹åŠŸèƒ½å·²ç»è¶³å¤Ÿä½¿ç”¨äº†ã€‚ å¦‚æœæƒ³è¦æ›´ç»†ç²’åº¦æ§åˆ¶æ£€æµ‹ï¼Œå¯ä»¥ä½¿ç”¨ target å®ä¾‹æ¥å£æä¾›çš„æ£€æµ‹ç‰¹æ€§ã€‚ ## target:has_cxxfuncs æ£€æµ‹ç›®æ ‡ç¼–è¯‘é…ç½®èƒ½å¦è·å–ç»™å®šçš„ C++ å‡½æ•°ã€‚ ç”¨æ³•è·Ÿ [target:has_cfuncs](#targethas_cfuncs) ç±»ä¼¼ï¼Œåªæ˜¯è¿™é‡Œä¸»è¦ç”¨äºæ£€æµ‹ C++ çš„å‡½æ•°ã€‚ ä¸è¿‡ï¼Œåœ¨æ£€æµ‹å‡½æ•°çš„åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é¢å¤–é…ç½® std languagesï¼Œæ¥è¾…åŠ©æ£€æµ‹ã€‚ ```lua target:has_cxxfuncs(\"foo\", {includes \"foo.h\", configs {languages \"cxx17\"}}) ``` ## target:has_ctypes æ£€æµ‹ç›®æ ‡ç¼–è¯‘é…ç½®èƒ½å¦è·å–ç»™å®šçš„ C ç±»å‹ã€‚ è¿™åº”è¯¥åœ¨ `on_config` ä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ```lua add_requires(\"zlib\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"zlib\") on_config(function (target) if target:has_ctypes(\"z_stream\", {includes \"zlib.h\"}) then target:add(\"defines\", \"HAVE_ZSTEAM_T\") end end) end) ``` ## target:has_cxxtypes æ£€æµ‹ç›®æ ‡ç¼–è¯‘é…ç½®èƒ½å¦è·å–ç»™å®šçš„ C++ ç±»å‹ã€‚ ç”¨æ³•è·Ÿ [target:has_ctypes](#targethas_ctypes) ç±»ä¼¼ï¼Œåªæ˜¯è¿™é‡Œä¸»è¦ç”¨äºæ£€æµ‹ C++ çš„ç±»å‹ã€‚ ## target:has_cflags æ£€æµ‹ç›®æ ‡ç¼–è¯‘é…ç½®èƒ½å¦è·å–ç»™å®šçš„ C ç¼–è¯‘ flagsã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") on_config(function (target) if target:has_cxxflags(\" fPIC\") then target:add(\"defines\", \"HAS_PIC\") end end) end) ``` ## target:has_cxxflags æ£€æµ‹ç›®æ ‡ç¼–è¯‘é…ç½®èƒ½å¦è·å–ç»™å®šçš„ C++ ç¼–è¯‘ flagsã€‚ ç”¨æ³•è·Ÿ [target:has_cflags](#targethas_cflags) ç±»ä¼¼ï¼Œåªæ˜¯è¿™é‡Œä¸»è¦ç”¨äºæ£€æµ‹ C++ çš„ç¼–è¯‘ flagsã€‚ ## target:has_cincludes æ£€æµ‹ç›®æ ‡ç¼–è¯‘é…ç½®èƒ½å¦è·å–ç»™å®šçš„ C å¤´æ–‡ä»¶ã€‚ è¿™åº”è¯¥åœ¨ `on_config` ä¸­ä½¿ç”¨ï¼Œæ¯”å¦‚å¯ä»¥ç”¨å®ƒæ¥åˆ¤æ–­å½“å‰ç›®æ ‡èƒ½å¦è·å–åˆ° zlib ä¾èµ–åŒ…çš„ zlib.h å¤´æ–‡ä»¶ï¼Œç„¶åè‡ªåŠ¨å®šä¹‰ `HAVE_INFLATE`ï¼š ```lua add_requires(\"zlib\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_packages(\"zlib\") on_config(function (target) if target:has_cincludes(\"zlib.h\") then target:add(\"defines\", \"HAVE_ZLIB_H\") end end) end) ``` ## target:has_cxxincludes æ£€æµ‹ç›®æ ‡ç¼–è¯‘é…ç½®èƒ½å¦è·å–ç»™å®šçš„ C++ å¤´æ–‡ä»¶ã€‚ ç”¨æ³•è·Ÿ [target:has_cincludes](#targethas_cincludes) ç±»ä¼¼ï¼Œåªæ˜¯è¿™é‡Œä¸»è¦ç”¨äºæ£€æµ‹ C++ çš„å¤´æ–‡ä»¶ã€‚ ## target:check_csnippets æ£€æµ‹æ˜¯å¦å¯ä»¥ç¼–è¯‘å’Œé“¾æ¥ç»™å®šçš„ C ä»£ç ç‰‡æ®µã€‚ ç”¨æ³•è·Ÿ [target:check_cxxsnippets](#targetcheck_cxxsnippets) ç±»ä¼¼ï¼Œåªæ˜¯è¿™é‡Œä¸»è¦ç”¨äºæ£€æµ‹ C çš„ä»£ç ç‰‡æ®µã€‚ ## target:check_cxxsnippets æ£€æµ‹æ˜¯å¦å¯ä»¥ç¼–è¯‘å’Œé“¾æ¥ç»™å®šçš„ C++ ä»£ç ç‰‡æ®µã€‚ è¿™åº”è¯¥åœ¨ `on_config` ä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ```lua add_requires(\"libtins\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") add_packages(\"libtins\") on_config(function (target) local has_snippet target:check_cxxsnippets({test [[ #include <string> using namespace Tins; void test() { std::string name NetworkInterface::default_interface().name(); printf(\"%s\\n\", name.c_str()); } ]]}, {configs {languages \"c++11\"}, includes {\"tins/tins.h\"}}) if has_snippet then target:add(\"defines\", \"HAS_XXX\") end end) end) ``` é»˜è®¤ä»…ä»…æ£€æµ‹ç¼–è¯‘é“¾æ¥æ˜¯å¦é€šè¿‡ï¼Œå¦‚æœæƒ³è¦å°è¯•è¿è¡Œæ—¶æ£€æµ‹ï¼Œå¯ä»¥å†è®¾ç½® `tryrun true`ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") on_config(function (target) local has_int_4 target:check_cxxsnippets({test [[ return (sizeof(int) 4)? 0 : 1; ]]}, {configs {languages \"c++11\"}, tryrun true}) if has_int_4 then target:add(\"defines\", \"HAS_INT4\") end end) end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥ç»§ç»­é€šè¿‡è®¾ç½® `output true` æ¥æ•è·æ£€æµ‹çš„è¿è¡Œè¾“å‡ºï¼Œå¹¶ä¸”åŠ ä¸Šè‡ªå®šä¹‰çš„ `main` å…¥å£ï¼Œå®ç°å®Œæ•´çš„æµ‹è¯•ä»£ç ï¼Œè€Œä¸ä»…ä»…æ˜¯ä»£ç ç‰‡æ®µã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") on_config(function (target) local int_size target:check_cxxsnippets({test [[ #include <stdio.h> int main(int argc, char** argv) { printf(\"%d\", sizeof(int)); return 0; return 0; } ]]}, {configs {languages \"c++11\"}, tryrun true, output true}) end) end) ``` ## target:check_sizeof æ£€æµ‹ç±»å‹å¤§å°ã€‚ ```lua add_rules(\"mode.debug\", \"mode.release\") target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") on_config(function (target) print(\"sizeof(long) %s\", target:check_sizeof(\"long\")) print(\"sizeof(string) %s\", target:check_sizeof(\"std::string\", {includes \"string\"})) if target:check_size(\"long\") 8 then target:add(\"defines\", \"LONG64\") end end) end) ``` ```bash $ xmake sizeof(long) 8 sizeof(string) 24 ``` ## target:has_features æ£€æµ‹æ˜¯å¦æŒ‡å®šçš„ C/C++ ç¼–è¯‘ç‰¹æ€§ã€‚ å®ƒç›¸æ¯”ä½¿ç”¨ `check_cxxsnippets` æ¥æ£€æµ‹ï¼Œä¼šæ›´åŠ å¿«ä¸€äº›ï¼Œå› ä¸ºå®ƒä»…ä»…æ‰§è¡Œä¸€æ¬¡é¢„å¤„ç†å°±èƒ½æ£€æµ‹æ‰€æœ‰çš„ç¼–è¯‘å™¨ç‰¹æ€§ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½å»è°ƒç”¨ç¼–è¯‘å™¨å°è¯•ç¼–è¯‘ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") on_config(function (target) if target:has_features(\"c_static_assert\") then target:add(\"defines\", \"HAS_STATIC_ASSERT\") end if target:has_features(\"cxx_constexpr\") then target:add(\"defines\", \"HAS_CXX_CONSTEXPR\") end end) end) ```"},"/get_started/zh/target/description-scope.html":{"title":"","content":" class: heading_no_counter # æè¿°åŸŸ å®šä¹‰å’Œè®¾ç½®å­å·¥ç¨‹æ¨¡å—ï¼Œæ¯ä¸ª `target` å¯¹åº”ä¸€ä¸ªå­å·¥ç¨‹ï¼Œæœ€åä¼šç”Ÿæˆä¸€ä¸ªç›®æ ‡ç¨‹åºï¼Œæœ‰å¯èƒ½æ˜¯å¯æ‰§è¡Œç¨‹åºï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯åº“æ¨¡å—ã€‚ > target çš„æ¥å£ï¼Œéƒ½æ˜¯å¯ä»¥æ”¾ç½®åœ¨ target å¤–é¢çš„å…¨å±€ä½œç”¨åŸŸä¸­çš„ï¼Œå¦‚æœåœ¨å…¨å±€ä¸­è®¾ç½®ï¼Œé‚£ä¹ˆä¼šå½±å“æ‰€æœ‰å­å·¥ç¨‹ targetã€‚ ä¾‹å¦‚ï¼š ```lua ä¼šåŒæ—¶å½±å“ test å’Œ test2 ç›®æ ‡ add_defines(\"DEBUG\") target(\"test\", function() add_files(\"*.c\") end) target(\"test2\", function() add_files(\"*.c\") end) ``` > `target` åŸŸæ˜¯å¯ä»¥é‡å¤è¿›å…¥æ¥å®ç°åˆ†ç¦»è®¾ç½®çš„ã€‚ ## å®šä¹‰å·¥ç¨‹ç›®æ ‡ å®šä¹‰ä¸€ä¸ªæ–°çš„æ§åˆ¶å°å·¥ç¨‹ç›®æ ‡ï¼Œå·¥ç¨‹åä¸º `test`ï¼Œæœ€åç”Ÿæˆçš„ç›®æ ‡åä¹Ÿæ˜¯ `test`ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` å¯ä»¥é‡å¤è°ƒç”¨è¿™ä¸ª apiï¼Œè¿›å…¥ target åŸŸä¿®æ”¹è®¾ç½® ```lua å®šä¹‰ç›®æ ‡ demoï¼Œå¹¶è¿›å…¥ demo è®¾ç½®æ¨¡å¼ target(\"demo\", function() set_kind(\"binary\") add_files(\"src/demo.c\") end) å®šä¹‰å’Œè®¾ç½®å…¶ä»–ç›®æ ‡ target(\"other\", function() ... end) é‡æ–°è¿›å…¥ demo ç›®æ ‡åŸŸï¼Œæ·»åŠ  test.c æ–‡ä»¶ target(\"demo\", function() add_files(\"src/test.c\") end) ``` > æ‰€æœ‰æ ¹åŸŸçš„è®¾ç½®ï¼Œä¼šå…¨å±€å½±å“æ‰€æœ‰ target ç›®æ ‡ï¼Œä½†æ˜¯ä¸ä¼šå½±å“ option çš„å®šä¹‰ã€‚ ```lua åœ¨æ ¹åŸŸå¯¹æ‰€æœ‰ target æ·»åŠ  DDEBUG çš„å®å®šä¹‰ï¼Œå½±å“æ‰€æœ‰ targetï¼ˆdemo å’Œ test éƒ½ä¼šåŠ ä¸Šæ­¤å®å®šä¹‰ï¼‰ add_defines(\"DEBUG\") target(\"demo\", function() set_kind(\"binary\") add_files(\"src/demo.c\") end) target(\"test\", function() set_kind(\"binary\") add_files(\"src/test.c\") end) ``` ## target:set_kind ### è®¾ç½®ç›®æ ‡ç¼–è¯‘ç±»å‹ è®¾ç½®ç›®æ ‡ç±»å‹ï¼Œç›®å‰æ”¯æŒçš„ç±»å‹æœ‰ï¼š å€¼ æè¿° phony å‡çš„ç›®æ ‡ç¨‹åº binary äºŒè¿›åˆ¶ç¨‹åº static é™æ€åº“ç¨‹åº shared åŠ¨æ€åº“ç¨‹åº object ä»…ä»…ç¼–è¯‘å¯¹è±¡é›†åˆ headeronly ä»…ä»…å¤´æ–‡ä»¶é›†åˆ #### binary å¯æ‰§è¡Œæ–‡ä»¶ç±»å‹ ```lua target(\"demo\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) ``` > å¦‚æœæ²¡æœ‰è®¾ç½® set_kind æ¥å£ï¼Œé»˜è®¤å°±æ˜¯ binary ç±»å‹ã€‚ æ‰€ä»¥æˆ‘ä»¬ç®€åŒ–ä¸ºï¼š ```lua target(\"demo\", function() add_files(\"src/*.c\") end) ``` ç”šè‡³: ```lua target(\"demo\", {files \"src/*.c\"}) ``` #### static é™æ€åº“ç›®æ ‡ç±»å‹ ```lua target(\"demo\", function() set_kind(\"static\") add_files(\"src/*.c\") end) ``` #### shared åŠ¨æ€åº“ç›®æ ‡ç±»å‹ ```lua target(\"demo\", function() set_kind(\"shared\") add_files(\"src/*.c\") end) ``` #### object çº¯å¯¹è±¡æ–‡ä»¶åˆ—è¡¨ç±»å‹ é€šå¸¸ç”¨äºä¸¤ä¸ªç›®æ ‡ç¨‹åºé—´ï¼Œéƒ¨åˆ†å¯¹è±¡æ–‡ä»¶å…±äº«ï¼Œä»…ä»…ç¼–è¯‘ä¸€æ¬¡ã€‚ä¹Ÿå¯ä»¥ç”¨äºåˆ†ç¦»å¯¹è±¡æ–‡ä»¶åˆ—è¡¨ï¼Œé…ç½®ä¸åŒçš„ç¼–è¯‘å‚æ•°ã€‚ #### phony ç©ºç›®æ ‡ç±»å‹ å®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç›®æ ‡ç¨‹åºç±»å‹ï¼Œå®ƒä¸ç”Ÿæˆä»»ä½•å®é™…çš„ç¨‹åºæ–‡ä»¶ï¼Œä»…ä»…ç”¨äºç»„åˆå…¶ä»–ç›®æ ‡ç¨‹åºçš„ä¾èµ–å…³ç³»ã€‚ ```lua target(\"test1\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) target(\"test2\", function() set_kind(\"binary\") add_files(\"src/*.c\") end) target(\"demo\", function() set_kind(\"phony\") add_deps(\"test1\", \"test2\") end) ``` æ¯”å¦‚ä¸Šè¿°é…ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ‰§è¡Œ `xmake build demo` ç¼–è¯‘çš„æ—¶å€™ï¼ŒåŒæ—¶ç¼–è¯‘ç›¸å…³çš„ä¸¤ä¸ªä¾èµ–ç¨‹åºï¼štest1 å’Œ test2ã€‚ #### headeronly çº¯å¤´æ–‡ä»¶ç›®æ ‡ç±»å‹ xmake æ–°å¢äº† `headeronly` ç›®æ ‡ç±»å‹ï¼Œè¿™ä¸ªç±»å‹çš„ç›®æ ‡ç¨‹åºï¼Œæˆ‘ä»¬ä¸ä¼šå®é™…ç¼–è¯‘å®ƒä»¬ï¼Œå› ä¸ºå®ƒæ²¡æœ‰æºæ–‡ä»¶éœ€è¦è¢«ç¼–è¯‘ã€‚ ä½†æ˜¯å®ƒåŒ…å«äº†å¤´æ–‡ä»¶åˆ—è¡¨ï¼Œè¿™é€šå¸¸ç”¨äº headeronly åº“é¡¹ç›®çš„å®‰è£…ï¼ŒIDE å·¥ç¨‹çš„æ–‡ä»¶åˆ—è¡¨ç”Ÿæˆï¼Œä»¥åŠå®‰è£…é˜¶æ®µçš„ cmake/pkgconfig å¯¼å…¥æ–‡ä»¶çš„ç”Ÿæˆã€‚ ä¾‹å¦‚ï¼š ```lua add_rules(\"mode.release\", \"mode.debug\") target(\"foo\", function() set_kind(\"headeronly\") add_headerfiles(\"src/foo.h\") add_rules(\"utils.install.cmake_importfiles\") add_rules(\"utils.install.pkgconfig_importfiles\") end) ``` æ›´å¤šè¯¦æƒ…è§ï¼š[#1747](https://github.com/xmake io/xmake/issues/1747) ## target:set_strip ### è®¾ç½®æ˜¯å¦ strip ä¿¡æ¯ è®¾ç½®å½“å‰ç›®æ ‡çš„ strip æ¨¡å¼ï¼Œç›®å‰æ”¯æŒä»¥ä¸‹æ¨¡å¼ï¼š å€¼ æè¿° debug é“¾æ¥çš„æ—¶å€™ï¼Œstrip æ‰è°ƒè¯•ç¬¦å· all é“¾æ¥çš„æ—¶å€™ï¼Œstrip æ‰æ‰€æœ‰ç¬¦å·ï¼ŒåŒ…æ‹¬è°ƒè¯•ç¬¦å· è¿™ä¸ª api ä¸€èˆ¬åœ¨ release æ¨¡å¼ä¸‹ä½¿ç”¨ï¼Œå¯ä»¥ç”Ÿæˆæ›´å°çš„äºŒè¿›åˆ¶ç¨‹åºï¼š ```lua target(\"xxxx\", function() set_strip(\"all\") end) ``` > è¿™ä¸ª api ä¸ä¸€å®šéå¾—åœ¨ target ä¹‹åä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰ target æŒ‡å®šï¼Œé‚£ä¹ˆå°†ä¼šè®¾ç½®åˆ°å…¨å±€æ¨¡å¼ã€‚ ## target:set_enabled ### è®¾ç½®æ˜¯å¦å¯ç”¨æˆ–ç¦ç”¨ç›®æ ‡ å¦‚æœè®¾ç½® `set_enabled(false)`ï¼Œåˆ™ä¼šç›´æ¥ç¦ç”¨å¯¹åº”çš„ targetï¼ŒåŒ…æ‹¬ target çš„åŠ è½½å’Œä¿¡æ¯è·å–ï¼Œè€Œ [set_default](#target%3Aset_default) ä»…ä»…åªæ˜¯è®¾ç½®é»˜è®¤ä¸å»ç¼–è¯‘ï¼Œä½†æ˜¯ target è¿˜æ˜¯èƒ½è·å–åˆ°ç›¸å…³ä¿¡æ¯çš„ï¼Œé»˜è®¤ä¹Ÿä¼šè¢«åŠ è½½ã€‚ ## target:set_default ### è®¾ç½®æ˜¯å¦ä¸ºé»˜è®¤æ„å»ºå®‰è£…ç›®æ ‡ è¿™ä¸ªæ¥å£ç”¨äºè®¾ç½®ç»™å®šå·¥ç¨‹ç›®æ ‡æ˜¯å¦ä½œä¸ºé»˜è®¤æ„å»ºï¼Œå¦‚æœæ²¡æœ‰è°ƒç”¨æ­¤æ¥å£è¿›è¡Œè®¾ç½®ï¼Œé‚£ä¹ˆè¿™ä¸ªç›®æ ‡å°±æ˜¯é»˜è®¤è¢«æ„å»ºçš„ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test1\", function() set_default(false) end) target(\"test2\", function() set_default(true) end) target(\"test3\", function() ... end) ``` ä¸Šè¿°ä»£ç çš„ä¸‰ä¸ªç›®æ ‡ï¼Œåœ¨æ‰§è¡Œ `xmake`, `xmake install`, `xmake package`, `xmake run` ç­‰å‘½ä»¤çš„æ—¶å€™ï¼Œå¦‚æœä¸æŒ‡å®šç›®æ ‡åï¼Œé‚£ä¹ˆï¼š ç›®æ ‡å è¡Œä¸º test1 ä¸ä¼šè¢«é»˜è®¤æ„å»ºã€å®‰è£…ã€æ‰“åŒ…å’Œè¿è¡Œ test2 é»˜è®¤æ„å»ºã€å®‰è£…ã€æ‰“åŒ…å’Œè¿è¡Œ test3 é»˜è®¤æ„å»ºã€å®‰è£…ã€æ‰“åŒ…å’Œè¿è¡Œ é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤ç›®æ ‡å¯ä»¥è®¾ç½®å¤šä¸ªï¼Œè¿è¡Œçš„æ—¶å€™ä¹Ÿä¼šä¾æ¬¡è¿è¡Œã€‚ > éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`xmake uninstall` å’Œ `xmake clean` å‘½ä»¤ä¸å—æ­¤æ¥å£è®¾ç½®å½±å“ï¼Œå› ä¸ºç”¨æˆ·å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯å–œæ¬¢æ¸…é™¤å’Œå¸è½½æ‰€æœ‰ã€‚ å¦‚æœä¸æƒ³ä½¿ç”¨é»˜è®¤çš„ç›®æ ‡ï¼Œé‚£ä¹ˆå¯ä»¥æ‰‹åŠ¨æŒ‡å®šéœ€è¦æ„å»ºå®‰è£…çš„ç›®æ ‡ï¼š ```bash $ xmake build targetname $ xmake install targetname ``` å¦‚æœè¦å¼ºåˆ¶æ„å»ºå®‰è£…æ‰€æœ‰ç›®æ ‡ï¼Œå¯ä»¥ä¼ å…¥ `[ a all]` å‚æ•°ï¼š ```bash $ xmake build [ a all] $ xmake install [ a all] ``` ## target:set_options ### è®¾ç½®å…³è”é€‰é¡¹ æ·»åŠ é€‰é¡¹ä¾èµ–ï¼Œå¦‚æœé€šè¿‡ [option](#option) æ¥å£è‡ªå®šä¹‰äº†ä¸€äº›é€‰é¡¹ï¼Œé‚£ä¹ˆåªæœ‰åœ¨æŒ‡å®š `target` ç›®æ ‡åŸŸä¸‹ï¼Œæ·»åŠ æ­¤é€‰é¡¹ï¼Œæ‰èƒ½è¿›è¡Œå…³è”ç”Ÿæ•ˆã€‚ ```lua å®šä¹‰ä¸€ä¸ª hello é€‰é¡¹ option(\"hello\", function() set_default(false) set_showmenu(true) add_defines(\"HELLO_ENABLE\") end) target(\"test\", function() å¦‚æœ hello é€‰é¡¹è¢«å¯ç”¨äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå°† DHELLO_ENABLE å®åº”ç”¨åˆ° test ç›®æ ‡ä¸Šå» set_options(\"hello\") end) ``` > åªæœ‰è°ƒç”¨ `set_options` è¿›è¡Œå…³è”ç”Ÿæ•ˆåï¼Œ[option](#option) ä¸­å®šä¹‰çš„ä¸€äº›è®¾ç½®æ‰ä¼šå½±å“åˆ°æ­¤ `target` ç›®æ ‡ï¼Œä¾‹å¦‚ï¼šå®å®šä¹‰ã€é“¾æ¥åº“ã€ç¼–è¯‘é€‰é¡¹ç­‰ç­‰ã€‚ ## target:set_symbols ### è®¾ç½®ç¬¦å·ä¿¡æ¯ è®¾ç½®ç›®æ ‡çš„ç¬¦å·æ¨¡å¼ï¼Œå¦‚æœå½“å‰æ²¡æœ‰å®šä¹‰ targetï¼Œé‚£ä¹ˆå°†ä¼šè®¾ç½®åˆ°å…¨å±€çŠ¶æ€ä¸­ï¼Œå½±å“æ‰€æœ‰åç»­çš„ç›®æ ‡ã€‚ ç›®å‰ä¸»è¦æ”¯æŒä»¥ä¸‹å‡ ä¸ªçº§åˆ«ï¼š å€¼ æè¿° gcc/clang msvc debug æ·»åŠ è°ƒè¯•ç¬¦å· g /Zi /Pdxxx.pdb debug, edit ä»… msvc ç”Ÿæ•ˆï¼Œé…åˆ debug çº§åˆ«ä½¿ç”¨ å¿½ç•¥ /ZI /Pdxxx.pdb debug, embed ä»… msvc ç”Ÿæ•ˆï¼Œé…åˆ debug çº§åˆ«ä½¿ç”¨ å¿½ç•¥ /Z7 hidden è®¾ç½®ç¬¦å·ä¸å¯è§ fvisibility hidden å¿½ç•¥ è¿™ä¸¤ä¸ªå€¼ä¹Ÿå¯ä»¥åŒæ—¶è¢«è®¾ç½®ï¼Œä¾‹å¦‚ï¼š ```lua æ·»åŠ è°ƒè¯•ç¬¦å·, è®¾ç½®ç¬¦å·ä¸å¯è§ set_symbols(\"debug\", \"hidden\") ``` å¦‚æœæ²¡æœ‰è°ƒç”¨è¿™ä¸ª apiï¼Œé»˜è®¤æ˜¯ç¦ç”¨è°ƒè¯•ç¬¦å·çš„ã€‚ > é€šè¿‡è·Ÿ `set_strip(\"all\")` é…åˆåŒæ—¶è®¾ç½®ï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆç‹¬ç«‹çš„è°ƒè¯•ç¬¦å·ï¼Œä¾‹å¦‚å¯¹äº ios ç¨‹åºï¼Œå°±æ˜¯ `.dSYM` æ–‡ä»¶ï¼Œå¯¹äº android ç­‰å…¶ä»–ç¨‹åºï¼Œå°±æ˜¯ `.sym` ç¬¦å·æ–‡ä»¶ã€‚ å¦‚æœ target åŒæ—¶è®¾ç½®äº†ä¸‹é¢ä¸¤ä¸ªè®¾ç½®ï¼Œå°±ä¼šå¯ç”¨ç¬¦å·æ–‡ä»¶ç”Ÿæˆï¼š ```lua target(\"test\", function() set_symbols(\"debug\") set_strip(\"all\") end) ``` å¯¹äºå†…ç½®çš„ release æ¨¡å¼ï¼Œé»˜è®¤ä¸å¯ç”¨ç¬¦å·ç”Ÿæˆï¼Œä»…ä»…åªæ˜¯ strip targetfileï¼Œå¦‚æœè¦å¯ç”¨ï¼Œåªéœ€è¦å†é¢å¤–å¼€å¯ debug ç¬¦å·å°±è¡Œï¼Œå› ä¸º mode.release å†…éƒ¨é»˜è®¤å·²ç»å¯ç”¨äº† strip äº†ã€‚ ```lua add_rules(\"mode.release\") target(\"test\", function() set_symbols(\"debug\") end) ``` ios ç¨‹åºä¼šç”Ÿæˆ `.dSYM` æ–‡ä»¶ï¼Œç„¶ååŒæ—¶ Strip è‡ªèº«ç¬¦å·ï¼š ```console [62%]: linking.release libtest.dylib [62%]: generating.release test.dSYM ``` android ç¨‹åºä¼šç”Ÿæˆ `.sym` æ–‡ä»¶ï¼ˆå…¶å®å°±æ˜¯å¸¦ç¬¦å·çš„ so/binary ç¨‹åºï¼‰ï¼Œç„¶ååŒæ—¶ Strip è‡ªèº«ç¬¦å·ï¼š ```console [62%]: linking.release libtest.so [62%]: generating.release test.sym ``` ## target:set_basename ### è®¾ç½®ç›®æ ‡æ–‡ä»¶å é»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ååŸºäº `target(\"name\")` ä¸­é…ç½®çš„å€¼ï¼Œä¾‹å¦‚ï¼š ```lua ç›®æ ‡æ–‡ä»¶åä¸ºï¼šlibxxx.a target(\"xxx\", function() set_kind(\"static\") end) ç›®æ ‡æ–‡ä»¶åä¸ºï¼šlibxxx2.so target(\"xxx2\", function() set_kind(\"shared\") end) ``` é»˜è®¤çš„å‘½åæ–¹å¼ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†æƒ…å†µä¸‹çš„éœ€æ±‚ï¼Œä½†æ˜¯å¦‚æœæœ‰æ—¶å€™æƒ³è¦æ›´åŠ å®šåˆ¶åŒ–ç›®æ ‡æ–‡ä»¶åã€‚ ä¾‹å¦‚ï¼ŒæŒ‰ç¼–è¯‘æ¨¡å¼å’Œæ¶æ„åŒºåˆ†ç›®æ ‡åï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥å£ï¼Œæ¥è®¾ç½®ï¼š ```lua target(\"xxx\", function() set_kind(\"static\") set_basename(\"xxx_$(mode)_$(arch)\") end) ``` å¦‚æœè¿™ä¸ªæ—¶å€™ï¼Œç¼–è¯‘é…ç½®ä¸ºï¼š`xmake f m debug a armv7`ï¼Œé‚£ä¹ˆç”Ÿæˆçš„æ–‡ä»¶åä¸ºï¼š`libxxx_debug_armv7.a` å¦‚æœè¿˜æƒ³è¿›ä¸€æ­¥å®šåˆ¶ç›®æ ‡æ–‡ä»¶çš„ç›®å½•åï¼Œå¯å‚è€ƒï¼š[set_targetdir](#target%3Aset_targetdir)ã€‚ æˆ–è€…é€šè¿‡ç¼–å†™è‡ªå®šä¹‰è„šæœ¬ï¼Œå®ç°æ›´é«˜çº§çš„é€»è¾‘ï¼Œå…·ä½“è§ï¼š[after_build](#target%3Aafter_build) å’Œ [os.mv](/zh cn/manual/builtin_modules?id osmv)ã€‚ ## target:set_filename ### è®¾ç½®ç›®æ ‡æ–‡ä»¶å…¨å å®ƒè·Ÿ [set_basename](#target%3Aset_basename) çš„åŒºåˆ«åœ¨äºï¼Œ[set_basename](#target%3Aset_basename)è®¾ç½®åå­—ä¸å¸¦åç¼€è·Ÿå‰ç¼€ï¼Œä¾‹å¦‚ï¼š`libtest.a`ï¼Œbasename å¦‚æœæ”¹æˆ test2 åå°±å˜æˆäº† `libtest2.a`ã€‚ è€Œ filename çš„ä¿®æ”¹ï¼Œæ˜¯ä¿®æ”¹æ•´ä¸ªç›®æ ‡æ–‡ä»¶åï¼ŒåŒ…æ‹¬å‰åç¼€ï¼Œä¾‹å¦‚å¯ä»¥ç›´æ¥æŠŠ `libtest.a` æ”¹æˆ `test.dll`ï¼Œè¿™ä¸ªå¯¹äº [set_basename](#target%3Aset_basename) æ˜¯åšä¸åˆ°çš„ã€‚ ## target:set_prefixname ### è®¾ç½®ç›®æ ‡æ–‡ä»¶çš„å‰ç½®å ä¿®æ”¹è®¾ç½®ç›®æ ‡æ–‡ä»¶çš„å‰ç½®åï¼Œä¾‹å¦‚å°†é»˜è®¤çš„ï¼š`libtest.so` æ”¹æˆ `test.so` ```lua target(\"test\", function() set_prefixname(\"\") end) ``` ## target:set_suffixname ### è®¾ç½®ç›®æ ‡æ–‡ä»¶çš„åç½®å ä¿®æ”¹è®¾ç½®ç›®æ ‡æ–‡ä»¶çš„åç½®åï¼Œä¾‹å¦‚å°†é»˜è®¤çš„ï¼š`libtest.so` æ”¹æˆ `libtest d.so` ```lua target(\"test\", function() set_suffixname(\" d\") end) ``` ## target:set_extension ### è®¾ç½®ç›®æ ‡æ–‡ä»¶çš„æ‰©å±•å ä¿®æ”¹è®¾ç½®ç›®æ ‡æ–‡ä»¶çš„æ‰©å±•åï¼Œä¾‹å¦‚å°†é»˜è®¤çš„ï¼š`libtest.so` æ”¹æˆ `test.dll` ```lua target(\"test\", function() set_prefixname(\"\") set_extension(\".dll\") end) ``` ## target:set_warnings ### è®¾ç½®è­¦å‘Šçº§åˆ« è®¾ç½®å½“å‰ç›®æ ‡çš„ç¼–è¯‘çš„è­¦å‘Šçº§åˆ«ï¼Œä¸€èˆ¬æ”¯æŒä¸€ä¸‹å‡ ä¸ªçº§åˆ«ï¼š å€¼ æè¿° gcc/clang msvc none ç¦ç”¨æ‰€æœ‰è­¦å‘Š w W0 less å¯ç”¨è¾ƒå°‘çš„è­¦å‘Š W1 W1 more å¯ç”¨è¾ƒå¤šçš„è­¦å‘Š W3 W3 extra å¯ç”¨é¢å¤–è­¦å‘Š Wextra pedantic å¯ç”¨éè¯­è¨€æ ‡å‡†çš„ä½¿ç”¨è­¦å‘Š Wpedantic all å¯ç”¨æ‰€æœ‰è­¦å‘Š Wall W3 allextra å¯ç”¨æ‰€æœ‰è­¦å‘Š + é¢å¤–çš„è­¦å‘Š Wall Wextra W4 everything å¯ç”¨å…¨éƒ¨æ”¯æŒçš„è­¦å‘Š Wall Wextra Weffc++ / Weverything Wall error å°†æ‰€æœ‰è­¦å‘Šä½œä¸ºç¼–è¯‘é”™è¯¯ Werror WX è¿™ä¸ª api çš„å‚æ•°æ˜¯å¯ä»¥æ··åˆæ·»åŠ çš„ï¼Œä¾‹å¦‚ï¼š ```lua å¯ç”¨æ‰€æœ‰è­¦å‘Šï¼Œå¹¶ä¸”ä½œä¸ºç¼–è¯‘é”™è¯¯å¤„ç† set_warnings(\"all\", \"error\") ``` å¦‚æœå½“å‰æ²¡æœ‰ç›®æ ‡ï¼Œè°ƒç”¨è¿™ä¸ª api å°†ä¼šè®¾ç½®åˆ°å…¨å±€æ¨¡å¼ã€‚ã€‚ ## target:set_optimize ### è®¾ç½®ä¼˜åŒ–çº§åˆ« è®¾ç½®ç›®æ ‡çš„ç¼–è¯‘ä¼˜åŒ–ç­‰çº§ï¼Œå¦‚æœå½“å‰æ²¡æœ‰è®¾ç½®ç›®æ ‡ï¼Œé‚£ä¹ˆå°†ä¼šè®¾ç½®åˆ°å…¨å±€çŠ¶æ€ä¸­ï¼Œå½±å“æ‰€æœ‰åç»­çš„ç›®æ ‡ã€‚ ç›®å‰ä¸»è¦æ”¯æŒä¸€ä¸‹å‡ ä¸ªçº§åˆ«ï¼š å€¼ æè¿° gcc/clang msvc none ç¦ç”¨ä¼˜åŒ– O0 Od fast å¿«é€Ÿä¼˜åŒ– O1 default faster æ›´å¿«çš„ä¼˜åŒ– O2 O2 fastest æœ€å¿«è¿è¡Œé€Ÿåº¦çš„ä¼˜åŒ– O3 Ox fp:fast smallest æœ€å°åŒ–ä»£ç ä¼˜åŒ– Os O1 GL aggressive è¿‡åº¦ä¼˜åŒ– Ofast Ox fp:fast ä¾‹å¦‚ï¼š ```lua æœ€å¿«è¿è¡Œé€Ÿåº¦çš„ä¼˜åŒ– set_optimize(\"fastest\") ``` ## target:set_languages ### è®¾ç½®ä»£ç è¯­è¨€æ ‡å‡† è®¾ç½®ç›®æ ‡ä»£ç ç¼–è¯‘çš„è¯­è¨€æ ‡å‡†ï¼Œå¦‚æœå½“å‰æ²¡æœ‰ç›®æ ‡å­˜åœ¨ï¼Œå°†ä¼šè®¾ç½®åˆ°å…¨å±€æ¨¡å¼ä¸­ã€‚ æ”¯æŒçš„è¯­è¨€æ ‡å‡†ç›®å‰ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š å€¼ æè¿° ansi c è¯­è¨€æ ‡å‡†: ansi c89 c è¯­è¨€æ ‡å‡†: c89 gnu89 c è¯­è¨€æ ‡å‡†: gnu89 c99 c è¯­è¨€æ ‡å‡†: c99 gnu99 c è¯­è¨€æ ‡å‡†: gnu99 c11 c è¯­è¨€æ ‡å‡†: c11 c17 c è¯­è¨€æ ‡å‡†: c17 clatest c è¯­è¨€æ ‡å‡†: clatest å€¼ æè¿° cxx98 c++ è¯­è¨€æ ‡å‡†:`c++98` gnuxx98 c++ è¯­è¨€æ ‡å‡†:`gnu++98` cxx11 c++ è¯­è¨€æ ‡å‡†:`c++11` gnuxx11 c++ è¯­è¨€æ ‡å‡†:`gnu++11` cxx14 c++ è¯­è¨€æ ‡å‡†:`c++14` gnuxx14 c++ è¯­è¨€æ ‡å‡†:`gnu++14` cxx1z c++ è¯­è¨€æ ‡å‡†:`c++1z` gnuxx1z c++ è¯­è¨€æ ‡å‡†:`gnu++1z` cxx17 c++ è¯­è¨€æ ‡å‡†:`c++17` gnuxx17 c++ è¯­è¨€æ ‡å‡†:`gnu++17` cxx20 c++ è¯­è¨€æ ‡å‡†:`c++20` gnuxx20 c++ è¯­è¨€æ ‡å‡†:`gnu++20` cxxlatest c++ è¯­è¨€æ ‡å‡†:`c++latest` gnuxxlatest c++ è¯­è¨€æ ‡å‡†:`gnu++latest` c æ ‡å‡†å’Œ c++ æ ‡å‡†å¯åŒæ—¶è¿›è¡Œè®¾ç½®ï¼Œä¾‹å¦‚ï¼š ```lua è®¾ç½® c ä»£ç æ ‡å‡†ï¼šc99ï¼Œ c++ ä»£ç æ ‡å‡†ï¼šc++11 set_languages(\"c99\", \"cxx11\") ``` å¹¶ä¸æ˜¯è®¾ç½®äº†æŒ‡å®šçš„æ ‡å‡†ï¼Œç¼–è¯‘å™¨å°±ä¸€å®šä¼šæŒ‰è¿™ä¸ªæ ‡å‡†æ¥ç¼–è¯‘ï¼Œæ¯•ç«Ÿæ¯ä¸ªç¼–è¯‘å™¨æ”¯æŒçš„åŠ›åº¦ä¸ä¸€æ ·ï¼Œä½†æ˜¯ xmake ä¼šå°½æœ€å¤§å¯èƒ½çš„å»é€‚é…å½“å‰ç¼–è¯‘å·¥å…·çš„æ”¯æŒæ ‡å‡†ã€‚ ## target:set_fpmodels ### è®¾ç½® float point ç¼–è¯‘æ¨¡å¼ æ­¤æ¥å£ç”¨äºè®¾ç½®æµ®ç‚¹çš„ç¼–è¯‘æ¨¡å¼ï¼Œå¯¹æ•°å­¦è®¡ç®—ç›¸å…³ä¼˜åŒ–çš„ç¼–è¯‘æŠ½è±¡è®¾ç½®ï¼Œæä¾›ï¼šfast, strict, except, precise ç­‰å‡ ç§å¸¸ç”¨çš„çº§åˆ«ï¼Œæœ‰äº›å¯åŒæ—¶è®¾ç½®ï¼Œæœ‰äº›æ˜¯æœ‰å†²çªçš„ï¼Œæœ€åè®¾ç½®çš„ç”Ÿæ•ˆã€‚ å…³äºè¿™äº›çº§åˆ«çš„è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒä¸‹å¾®è½¯çš„æ–‡æ¡£ï¼š[Specify floating point behavior](https://docs.microsoft.com/en us/cpp/build/reference/fp specify floating point behavior?view vs 2019) å½“ç„¶ï¼Œå¯¹åº” gcc/icc ç­‰å…¶ä»–ç¼–è¯‘å™¨ï¼Œxmake ä¼šæ˜ å°„åˆ°ä¸åŒçš„ç¼–è¯‘ flagsã€‚ ```lua set_fpmodels(\"fast\") set_fpmodels(\"strict\") set_fpmodels(\"fast\", \"except\") set_fpmodels(\"precise\") default ``` å…³äºè¿™å—è¯¦æƒ…è§ï¼š[https://github.com/xmake io/xmake/issues/981](https://github.com/xmake io/xmake/issues/981) ## target:set_targetdir ### è®¾ç½®ç”Ÿæˆç›®æ ‡æ–‡ä»¶ç›®å½• è®¾ç½®ç›®æ ‡ç¨‹åºæ–‡ä»¶çš„è¾“å‡ºç›®å½•ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸éœ€è¦è®¾ç½®ï¼Œé»˜è®¤ä¼šè¾“å‡ºåœ¨ build ç›®å½•ä¸‹ è€Œ build çš„ç›®å½•å¯ä»¥åœ¨å·¥ç¨‹é…ç½®çš„æ—¶å€™ï¼Œæ‰‹åŠ¨ä¿®æ”¹ï¼š ```bash xmake f o /tmp/build ``` ä¿®æ”¹æˆ `/tmp/build` åï¼Œç›®æ ‡æ–‡ä»¶é»˜è®¤è¾“å‡ºåˆ° `/tmp/build` ä¸‹é¢ã€‚ è€Œå¦‚æœç”¨è¿™ä¸ªæ¥å£å»è®¾ç½®ï¼Œå°±ä¸éœ€è¦æ¯æ¬¡æ•²å‘½ä»¤ä¿®æ”¹äº†ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() set_targetdir(\"/tmp/build\") end) ``` > å¦‚æœæ˜¾ç¤ºè®¾ç½®äº† `set_targetdir`ï¼Œ é‚£ä¹ˆä¼˜å…ˆé€‰æ‹© `set_targetdir` æŒ‡å®šçš„ç›®å½•ä¸ºç›®æ ‡æ–‡ä»¶çš„è¾“å‡ºç›®å½•ã€‚ ## target:set_objectdir ### è®¾ç½®å¯¹è±¡æ–‡ä»¶ç”Ÿæˆç›®å½• è®¾ç½®ç›®æ ‡ target çš„å¯¹è±¡æ–‡ä»¶ (`*.o/obj`) çš„è¾“å‡ºç›®å½•ï¼Œä¾‹å¦‚: ```lua target(\"test\", function() set_objectdir(\"$(buildir)/.objs\") end) ``` ## target:set_dependir ### è®¾ç½®ä¾èµ–æ–‡ä»¶ç”Ÿæˆç›®å½• è®¾ç½®ç›®æ ‡ target çš„ç¼–è¯‘ä¾èµ–æ–‡ä»¶ (`.deps`) çš„è¾“å‡ºç›®å½•ï¼Œä¾‹å¦‚: ```lua target(\"test\", function() set_dependir(\"$(buildir)/.deps\") end) ``` ## target:add_imports ### ä¸ºè‡ªå®šä¹‰è„šæœ¬é¢„å…ˆå¯¼å…¥æ‰©å±•æ¨¡å— é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨ [on_build](#targeton_build) ç­‰è‡ªå®šä¹‰è„šæœ¬å†…éƒ¨ï¼Œå¯ä»¥é€šè¿‡ `import(\"core.base.task\")` çš„æ–¹å¼å¯¼å…¥æ‰©å±•æ¨¡å—ï¼Œ ä½†æ˜¯å¯¹äºè‡ªå®šä¹‰è„šæœ¬æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªè‡ªå®šä¹‰è„šæœ¬éƒ½é‡å¤å¯¼å…¥ä¸€éï¼Œéå¸¸çš„ç¹çï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£ï¼Œå®ç°é¢„å…ˆå¯¼å…¥ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() on_load(function (target) import(\"core.base.task\") import(\"core.project.project\") task.run(\"xxxx\") end) on_build(function (target) import(\"core.base.task\") import(\"core.project.project\") task.run(\"xxxx\") end) on_install(function (target) import(\"core.base.task\") import(\"core.project.project\") task.run(\"xxxx\") end) end) ``` é€šè¿‡æ­¤æ¥å£å¯ä»¥ç®€åŒ–ä¸ºï¼š ```lua target(\"test\", function() add_imports(\"core.base.task\", \"core.project.project\") on_load(function (target) task.run(\"xxxx\") end) on_build(function (target) task.run(\"xxxx\") end) on_install(function (target) task.run(\"xxxx\") end) end) ``` ## target:add_rules ### æ·»åŠ è§„åˆ™åˆ°ç›®æ ‡ æˆ‘ä»¬å¯ä»¥é€šè¿‡é¢„å…ˆè®¾ç½®è§„åˆ™æ”¯æŒçš„æ–‡ä»¶åç¼€ï¼Œæ¥æ‰©å±•å…¶ä»–æ–‡ä»¶çš„æ„å»ºæ”¯æŒï¼š ```lua å®šä¹‰ä¸€ä¸ª markdown æ–‡ä»¶çš„æ„å»ºè§„åˆ™ rule(\"markdown\", function() set_extensions(\".md\", \".markdown\") on_build(function (target, sourcefile) os.cp(sourcefile, path.join(target:targetdir(), path.basename(sourcefile) .. \".html\")) end) end) target(\"test\", function() set_kind(\"binary\") ä½¿ test ç›®æ ‡æ”¯æŒ markdown æ–‡ä»¶çš„æ„å»ºè§„åˆ™ add_rules(\"markdown\") æ·»åŠ  markdown æ–‡ä»¶çš„æ„å»º add_files(\"src/*.md\") add_files(\"src/*.markdown\") end) ``` æˆ‘ä»¬å¯ä»¥åœ¨ add_rules æ—¶ä¼ å‚ï¼š ```lua rule(\"my_rule\", function() on_load(function (target) local my_arg target:extraconf(\"rules\", \"my_rule\", \"my_arg\") \"my arg\" end) end) target(\"test\", function() add_rules(\"my_rule\", { my_arg \"my arg\"}) end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šåº”ç”¨å±€éƒ¨æ–‡ä»¶åˆ°è§„åˆ™ï¼Œå…·ä½“ä½¿ç”¨è§ï¼š[add_files](#targetadd_files)ã€‚ ## target:on_load ### è‡ªå®šä¹‰ç›®æ ‡åŠ è½½è„šæœ¬ åœ¨ target åˆå§‹åŒ–åŠ è½½çš„æ—¶å€™ï¼Œå°†ä¼šæ‰§è¡Œæ­¤è„šæœ¬ï¼Œåœ¨é‡Œé¢å¯ä»¥åšä¸€äº›åŠ¨æ€çš„ç›®æ ‡é…ç½®ï¼Œå®ç°æ›´çµæ´»çš„ç›®æ ‡æè¿°å®šä¹‰ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() on_load(function (target) target:add(\"defines\", \"DEBUG\", \"TEST \\\"hello\\\"\") target:add(\"linkdirs\", \"/usr/lib\", \"/usr/local/lib\") target:add({includedirs \"/usr/include\", \"links\" \"pthread\"}) end) end) ``` å¯ä»¥åœ¨ `on_load` é‡Œé¢ï¼Œé€šè¿‡ `target:set`, `target:add` æ¥åŠ¨æ€æ·»åŠ å„ç§ target å±æ€§ã€‚ ## target:on_config ### è‡ªå®šä¹‰é…ç½®è„šæœ¬ åœ¨ `xmake config` æ‰§è¡Œå®Œæˆåï¼ŒBuild ä¹‹å‰ä¼šæ‰§è¡Œæ­¤è„šæœ¬ï¼Œé€šå¸¸ç”¨äºç¼–è¯‘å‰çš„é…ç½®å·¥ä½œã€‚å®ƒä¸ on_load ä¸åŒçš„æ˜¯ï¼Œon_load åªè¦ target è¢«åŠ è½½å°±ä¼šæ‰§è¡Œï¼Œæ‰§è¡Œæ—¶æœºæ›´æ—©ã€‚ å¦‚æœä¸€äº›é…ç½®ï¼Œæ— æ³•åœ¨ on_load ä¸­è¿‡æ—©é…ç½®ï¼Œé‚£ä¹ˆéƒ½å¯ä»¥åœ¨ on_config ä¸­å»é…ç½®å®ƒã€‚ å¦å¤–ï¼Œå®ƒçš„æ‰§è¡Œæ—¶æœºæ¯” before_build è¿˜è¦æ—©ï¼Œå¤§æ¦‚çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š ``` on_load > after_load > on_config > before_build > on_build > after_build ``` ## target:on_link ### è‡ªå®šä¹‰é“¾æ¥è„šæœ¬ ç”¨äºå®šåˆ¶åŒ–å¤„ç† target çš„é“¾æ¥è¿‡ç¨‹ã€‚ ```lua target(\"test\", function() on_link(function (target) print(\"link it\") end) end) ``` ## target:on_build ### è‡ªå®šä¹‰ç¼–è¯‘è„šæœ¬ è¦†ç›– target ç›®æ ‡é»˜è®¤çš„æ„å»ºè¡Œä¸ºï¼Œå®ç°è‡ªå®šä¹‰çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¹¶ä¸éœ€è¦è¿™ä¹ˆåšï¼Œé™¤éç¡®å®éœ€è¦åšä¸€äº› xmake é»˜è®¤æ²¡æœ‰æä¾›çš„ç¼–è¯‘æ“ä½œã€‚ ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è¦†ç›–å®ƒï¼Œæ¥è‡ªå®šä¹‰ç¼–è¯‘æ“ä½œï¼š ```lua target(\"test\", function() è®¾ç½®è‡ªå®šä¹‰ç¼–è¯‘è„šæœ¬ on_build(function (target) print(\"build it\") end) end) ``` æ‰€æœ‰ target çš„è‡ªå®šä¹‰è„šæœ¬éƒ½å¯ä»¥é’ˆå¯¹ä¸åŒå¹³å°å’Œæ¶æ„ï¼Œåˆ†åˆ«å¤„ç†ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() on_build(\"iphoneosarm*\", function (target) print(\"build for iphoneos and arm\") end) end) ``` å…¶ä¸­å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå°±æ˜¯æŒ‡å®šè¿™ä¸ªè„šæœ¬éœ€è¦åœ¨å“ªä¸ª `å¹³å° æ¶æ„` ä¸‹ï¼Œæ‰ä¼šè¢«æ‰§è¡Œï¼Œå¹¶ä¸”æ”¯æŒæ¨¡å¼åŒ¹é…ï¼Œä¾‹å¦‚ `arm*` åŒ¹é…æ‰€æœ‰ arm æ¶æ„ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥åªè®¾ç½®å¹³å°ï¼Œä¸è®¾ç½®æ¶æ„ï¼Œè¿™æ ·å°±æ˜¯åŒ¹é…æŒ‡å®šå¹³å°ä¸‹ï¼Œæ‰§è¡Œè„šæœ¬ï¼š ```lua target(\"test\", function() on_build(\"windows\", function (target) print(\"build for windows\") end) end) ``` > ä¸€æ—¦å¯¹è¿™ä¸ª target ç›®æ ‡è®¾ç½®äº†è‡ªå·±çš„ build è¿‡ç¨‹ï¼Œé‚£ä¹ˆ xmake é»˜è®¤çš„æ„å»ºè¿‡ç¨‹å°†ä¸å†è¢«æ‰§è¡Œã€‚ ## target:on_build_file ### è‡ªå®šä¹‰ç¼–è¯‘è„šæœ¬, å®ç°å•æ–‡ä»¶æ„å»º é€šè¿‡æ­¤æ¥å£ï¼Œå¯ä»¥ç”¨æ¥ hook æŒ‡å®š target å†…ç½®çš„æ„å»ºè¿‡ç¨‹ï¼Œæ›¿æ¢æ¯ä¸ªæºæ–‡ä»¶ç¼–è¯‘è¿‡ç¨‹ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") on_build_file(function (target, sourcefile, opt) end) end) ``` å¦‚æœä¸æƒ³é‡å†™å†…ç½®çš„ç¼–è¯‘è„šæœ¬ï¼Œä»…ä»…åªæ˜¯åœ¨ç¼–è¯‘å‰åæ·»åŠ ä¸€äº›è‡ªå·±çš„å¤„ç†ï¼Œå…¶å®ç”¨ï¼š[target.before_build_file](#targetbefore_build_file)å’Œ [target.after_build_file](#targetafter_build_file) ä¼šæ›´åŠ æ–¹ä¾¿ï¼Œä¸éœ€è¦è°ƒç”¨ `opt.origin`ã€‚ ## target:on_build_files ### è‡ªå®šä¹‰ç¼–è¯‘è„šæœ¬, å®ç°å¤šæ–‡ä»¶æ„å»º é€šè¿‡æ­¤æ¥å£ï¼Œå¯ä»¥ç”¨æ¥ hook æŒ‡å®š target å†…ç½®çš„æ„å»ºè¿‡ç¨‹ï¼Œæ›¿æ¢ä¸€æ‰¹åŒç±»å‹æºæ–‡ä»¶ç¼–è¯‘è¿‡ç¨‹ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") on_build_files(function (target, sourcebatch, opt) end) end) ``` è®¾ç½®æ­¤æ¥å£åï¼Œå¯¹åº”æºæ–‡ä»¶åˆ—è¡¨ä¸­æ–‡ä»¶ï¼Œå°±ä¸ä¼šå‡ºç°åœ¨è‡ªå®šä¹‰çš„ [target.on_build_file](#targeton_build_file) äº†ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯åŒ…å«å…³ç³»ã€‚ å…¶ä¸­ sourcebatch æè¿°äº†è¿™æ‰¹åŒç±»å‹æºæ–‡ä»¶ï¼š `sourcebatch.sourcekind`: è·å–è¿™æ‰¹æºæ–‡ä»¶çš„ç±»å‹ï¼Œæ¯”å¦‚ï¼šcc, as, .. `sourcebatch.sourcefiles()`: è·å–æºæ–‡ä»¶åˆ—è¡¨ `sourcebatch.objectfiles()`: è·å–å¯¹è±¡æ–‡ä»¶åˆ—è¡¨ `sourcebatch.dependfiles()`: è·å–å¯¹åº”ä¾èµ–æ–‡ä»¶åˆ—è¡¨ï¼Œå­˜æœ‰æºæ–‡ä»¶ä¸­ç¼–è¯‘ä¾èµ–ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šxxx.d ## target:on_clean ### è‡ªå®šä¹‰æ¸…ç†è„šæœ¬ è¦†ç›– target ç›®æ ‡çš„ `xmake [cclean}` çš„æ¸…ç†æ“ä½œï¼Œå®ç°è‡ªå®šä¹‰æ¸…ç†è¿‡ç¨‹ã€‚ ```lua target(\"test\", function() è®¾ç½®è‡ªå®šä¹‰æ¸…ç†è„šæœ¬ on_clean(function (target) ä»…åˆ æ‰ç›®æ ‡æ–‡ä»¶ os.rm(target:targetfile()) end) end) ``` ä¸€äº› target æ¥å£æè¿°å¦‚ä¸‹ï¼š target æ¥å£ æè¿° target:name() è·å–ç›®æ ‡å target:targetfile() è·å–ç›®æ ‡æ–‡ä»¶è·¯å¾„ target:get(\"kind\") è·å–ç›®æ ‡çš„æ„å»ºç±»å‹ target:get(\"defines\") è·å–ç›®æ ‡çš„å®å®šä¹‰ target:get(\"xxx\") å…¶ä»–é€šè¿‡ `set_/add_` æ¥å£è®¾ç½®çš„ target ä¿¡æ¯ï¼Œéƒ½å¯ä»¥é€šè¿‡æ­¤æ¥å£æ¥è·å– target:add(\"links\", \"pthread\") æ·»åŠ ç›®æ ‡è®¾ç½® target:set(\"links\", \"pthread\", \"z\") è¦†å†™ç›®æ ‡è®¾ç½® target:deps() è·å–ç›®æ ‡çš„æ‰€æœ‰ä¾èµ–ç›®æ ‡ target:dep(\"depname\") è·å–æŒ‡å®šçš„ä¾èµ–ç›®æ ‡ target:sourcebatches() è·å–ç›®æ ‡çš„æ‰€æœ‰æºæ–‡ä»¶åˆ—è¡¨ ## target:on_package ### è‡ªå®šä¹‰æ‰“åŒ…è„šæœ¬ è¦†ç›– target ç›®æ ‡çš„ `xmake [ppackage}` çš„æ‰“åŒ…æ“ä½œï¼Œå®ç°è‡ªå®šä¹‰æ‰“åŒ…è¿‡ç¨‹ï¼Œå¦‚æœä½ æƒ³å¯¹æŒ‡å®š target æ‰“åŒ…æˆè‡ªå·±æƒ³è¦çš„æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£è‡ªå®šä¹‰å®ƒã€‚ è¿™ä¸ªæ¥å£è¿˜æ˜¯æŒºå®ç”¨çš„ï¼Œä¾‹å¦‚ï¼Œç¼–è¯‘å®Œ jni åï¼Œå°†ç”Ÿæˆçš„ soï¼Œæ‰“åŒ…è¿› apk åŒ…ä¸­ã€‚ ```lua å®šä¹‰ä¸€ä¸ª android app çš„æµ‹è¯• demo target(\"demo\", function() ç”ŸæˆåŠ¨æ€åº“ï¼šlibdemo.so set_kind(\"shared\") è®¾ç½®å¯¹è±¡çš„è¾“å‡ºç›®å½•ï¼Œå¯é€‰ set_objectdir(\"$(buildir)/.objs\") æ¯æ¬¡ç¼–è¯‘å®Œçš„ libdemo.so çš„ç”Ÿæˆç›®å½•ï¼Œè®¾ç½®ä¸º app/libs/armeabi set_targetdir(\"libs/armeabi\") æ·»åŠ  jni çš„ä»£ç æ–‡ä»¶ add_files(\"jni/*.c\") è®¾ç½®è‡ªå®šä¹‰æ‰“åŒ…è„šæœ¬ï¼Œåœ¨ä½¿ç”¨ xmake ç¼–è¯‘å®Œ libdemo.so åï¼Œæ‰§è¡Œ xmake p è¿›è¡Œæ‰“åŒ… ä¼šè‡ªåŠ¨ä½¿ç”¨ ant å°† app ç¼–è¯‘æˆ apk æ–‡ä»¶ on_package(function (target) ä½¿ç”¨ ant ç¼–è¯‘ app æˆ apk æ–‡ä»¶ï¼Œè¾“å‡ºä¿¡æ¯é‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶ os.run(\"ant debug\") end) end) ``` ## target:on_install ### è‡ªå®šä¹‰å®‰è£…è„šæœ¬ è¦†ç›– target ç›®æ ‡çš„ `xmake [iinstall}` çš„å®‰è£…æ“ä½œï¼Œå®ç°è‡ªå®šä¹‰å®‰è£…è¿‡ç¨‹ã€‚ ä¾‹å¦‚ï¼Œå°†ç”Ÿæˆçš„ apk åŒ…ï¼Œè¿›è¡Œå®‰è£…ã€‚ ```lua target(\"test\", function() è®¾ç½®è‡ªå®šä¹‰å®‰è£…è„šæœ¬ï¼Œè‡ªåŠ¨å®‰è£… apk æ–‡ä»¶ on_install(function (target) ä½¿ç”¨ adb å®‰è£…æ‰“åŒ…ç”Ÿæˆçš„ apk æ–‡ä»¶ os.run(\"adb install r ./bin/Demo debug.apk\") end) end) ``` ## target:on_uninstall ### è‡ªå®šä¹‰å¸è½½è„šæœ¬ è¦†ç›– target ç›®æ ‡çš„ `xmake [uuninstall}` çš„å¸è½½æ“ä½œï¼Œå®ç°è‡ªå®šä¹‰å¸è½½è¿‡ç¨‹ã€‚ ```lua target(\"test\", function() on_uninstall(function (target) ... end) end) ``` ## target:on_run ### è‡ªå®šä¹‰è¿è¡Œè„šæœ¬ è¦†ç›– target ç›®æ ‡çš„ `xmake [rrun}` çš„è¿è¡Œæ“ä½œï¼Œå®ç°è‡ªå®šä¹‰è¿è¡Œè¿‡ç¨‹ã€‚ ä¾‹å¦‚ï¼Œè¿è¡Œå®‰è£…å¥½çš„ apk ç¨‹åºï¼š ```lua target(\"test\", function() è®¾ç½®è‡ªå®šä¹‰è¿è¡Œè„šæœ¬ï¼Œè‡ªåŠ¨è¿è¡Œå®‰è£…å¥½çš„ app ç¨‹åºï¼Œå¹¶ä¸”è‡ªåŠ¨è·å–è®¾å¤‡è¾“å‡ºä¿¡æ¯ on_run(function (target) os.run(\"adb shell am start n com.demo/com.demo.DemoTest\") os.run(\"adb logcat\") end) end) ``` ## target:before_link ### åœ¨é“¾æ¥ä¹‹å‰æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ ç”¨äºåœ¨é“¾æ¥ä¹‹å‰å¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ```lua target(\"test\", function() before_link(function (target) print(\"\") end) end) ``` ## target:before_build ### åœ¨æ„å»ºä¹‹å‰æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ å¹¶ä¸ä¼šè¦†ç›–é»˜è®¤çš„æ„å»ºæ“ä½œï¼Œåªæ˜¯åœ¨æ„å»ºä¹‹å‰å¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ```lua target(\"test\", function() before_build(function (target) print(\"\") end) end) ``` ## target:before_build_file ### è‡ªå®šä¹‰ç¼–è¯‘å‰çš„è„šæœ¬, å®ç°å•æ–‡ä»¶æ„å»º é€šè¿‡æ­¤æ¥å£ï¼Œå¯ä»¥ç”¨æ¥ hook æŒ‡å®š target å†…ç½®çš„æ„å»ºè¿‡ç¨‹ï¼Œåœ¨æ¯ä¸ªæºæ–‡ä»¶ç¼–è¯‘è¿‡ç¨‹ä¹‹å‰æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") before_build_file(function (target, sourcefile, opt) end) end) ``` ## target:before_build_files ### è‡ªå®šä¹‰ç¼–è¯‘å‰çš„è„šæœ¬, å®ç°å¤šæ–‡ä»¶æ„å»º é€šè¿‡æ­¤æ¥å£ï¼Œå¯ä»¥ç”¨æ¥ hook æŒ‡å®š target å†…ç½®çš„æ„å»ºè¿‡ç¨‹ï¼Œåœ¨ä¸€æ‰¹åŒç±»å‹æºæ–‡ä»¶ç¼–è¯‘è¿‡ç¨‹ä¹‹å‰æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") before_build_files(function (target, sourcebatch, opt) end) end) ``` ## target:before_clean ### åœ¨æ¸…ç†ä¹‹å‰æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ å¹¶ä¸ä¼šè¦†ç›–é»˜è®¤çš„æ¸…ç†æ“ä½œï¼Œåªæ˜¯åœ¨æ¸…ç†ä¹‹å‰å¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ```lua target(\"test\", function() before_clean(function (target) print(\"\") end) end) ``` ## target:before_package #### åœ¨æ‰“åŒ…ä¹‹å‰æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ å¹¶ä¸ä¼šè¦†ç›–é»˜è®¤çš„æ‰“åŒ…æ“ä½œï¼Œåªæ˜¯åœ¨æ‰“åŒ…ä¹‹å‰å¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ```lua target(\"test\", function() before_package(function (target) print(\"\") end) end) ``` ## target:before_install ### åœ¨å®‰è£…ä¹‹å‰æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ å¹¶ä¸ä¼šè¦†ç›–é»˜è®¤çš„å®‰è£…æ“ä½œï¼Œåªæ˜¯åœ¨å®‰è£…ä¹‹å‰å¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ```lua target(\"test\", function() before_install(function (target) print(\"\") end) end) ``` ## target:before_uninstall ### åœ¨å¸è½½ä¹‹å‰æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ å¹¶ä¸ä¼šè¦†ç›–é»˜è®¤çš„å¸è½½æ“ä½œï¼Œåªæ˜¯åœ¨å¸è½½ä¹‹å‰å¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ```lua target(\"test\", function() before_uninstall(function (target) print(\"\") end) end) ``` ## target:before_run ### åœ¨è¿è¡Œä¹‹å‰æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ å¹¶ä¸ä¼šè¦†ç›–é»˜è®¤çš„è¿è¡Œæ“ä½œï¼Œåªæ˜¯åœ¨è¿è¡Œä¹‹å‰å¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ```lua target(\"test\", function() before_run(function (target) print(\"\") end) end) ``` ## target:after_link ### åœ¨é“¾æ¥ä¹‹åæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ ç”¨äºåœ¨é“¾æ¥ä¹‹åå¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ```lua target(\"test\", function() after_link(function (target) print(\"\") end) end) ``` ## target:after_build ### åœ¨æ„å»ºä¹‹åæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ å¹¶ä¸ä¼šè¦†ç›–é»˜è®¤çš„æ„å»ºæ“ä½œï¼Œåªæ˜¯åœ¨æ„å»ºä¹‹åå¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ä¾‹å¦‚ï¼Œå¯¹äº ios çš„è¶Šç‹±å¼€å‘ï¼Œæ„å»ºå®Œç¨‹åºåï¼Œéœ€è¦ç”¨ `ldid` è¿›è¡Œç­¾åæ“ä½œ ```lua target(\"test\", function() after_build(function (target) os.run(\"ldid S %s\", target:targetfile()) end) end) ``` ## target:after_build_file ### è‡ªå®šä¹‰ç¼–è¯‘å‰çš„è„šæœ¬, å®ç°å•æ–‡ä»¶æ„å»º é€šè¿‡æ­¤æ¥å£ï¼Œå¯ä»¥ç”¨æ¥ hook æŒ‡å®š target å†…ç½®çš„æ„å»ºè¿‡ç¨‹ï¼Œåœ¨æ¯ä¸ªæºæ–‡ä»¶ç¼–è¯‘è¿‡ç¨‹ä¹‹åæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") after_build_file(function (target, sourcefile, opt) end) end) ``` ## target:after_build_files ### è‡ªå®šä¹‰ç¼–è¯‘å‰çš„è„šæœ¬, å®ç°å¤šæ–‡ä»¶æ„å»º é€šè¿‡æ­¤æ¥å£ï¼Œå¯ä»¥ç”¨æ¥ hook æŒ‡å®š target å†…ç½®çš„æ„å»ºè¿‡ç¨‹ï¼Œåœ¨ä¸€æ‰¹åŒç±»å‹æºæ–‡ä»¶ç¼–è¯‘è¿‡ç¨‹ä¹‹åæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") after_build_files(function (target, sourcebatch, opt) end) end) ``` ## target:after_clean ### åœ¨æ¸…ç†ä¹‹åæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ å¹¶ä¸ä¼šè¦†ç›–é»˜è®¤çš„æ¸…ç†æ“ä½œï¼Œåªæ˜¯åœ¨æ¸…ç†ä¹‹åå¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ä¸€èˆ¬å¯ç”¨äºæ¸…ç†ç¼–è¯‘æŸ target è‡ªåŠ¨ç”Ÿæˆçš„ä¸€äº›é¢å¤–çš„ä¸´æ—¶æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ xmake é»˜è®¤çš„æ¸…ç†è§„åˆ™å¯èƒ½æ²¡æœ‰æ¸…ç†åˆ°ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() after_clean(function (target) os.rm(\"$(buildir)/otherfiles\") end) end) ``` ## target:after_package ### åœ¨æ‰“åŒ…ä¹‹åæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ å¹¶ä¸ä¼šè¦†ç›–é»˜è®¤çš„æ‰“åŒ…æ“ä½œï¼Œåªæ˜¯åœ¨æ‰“åŒ…ä¹‹åå¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ```lua target(\"test\", function() after_package(function (target) print(\"\") end) end) ``` ## target:after_install ### åœ¨å®‰è£…ä¹‹åæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ å¹¶ä¸ä¼šè¦†ç›–é»˜è®¤çš„å®‰è£…æ“ä½œï¼Œåªæ˜¯åœ¨å®‰è£…ä¹‹åå¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ```lua target(\"test\", function() after_install(function (target) print(\"\") end) end) ``` ## target:after_uninstall ### åœ¨å¸è½½ä¹‹åæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ å¹¶ä¸ä¼šè¦†ç›–é»˜è®¤çš„å¸è½½æ“ä½œï¼Œåªæ˜¯åœ¨å¸è½½ä¹‹åå¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ```lua target(\"test\", function() after_uninstall(function (target) print(\"\") end) end) ``` ## target:after_run ### åœ¨è¿è¡Œä¹‹åæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ å¹¶ä¸ä¼šè¦†ç›–é»˜è®¤çš„è¿è¡Œæ“ä½œï¼Œåªæ˜¯åœ¨è¿è¡Œä¹‹åå¢åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ“ä½œã€‚ ```lua target(\"test\", function() after_run(function (target) print(\"\") end) end) ``` ## target:set_pcheader ### è®¾ç½® C é¢„ç¼–è¯‘å¤´æ–‡ä»¶ xmake æ”¯æŒé€šè¿‡é¢„ç¼–è¯‘å¤´æ–‡ä»¶å»åŠ é€Ÿ c ç¨‹åºç¼–è¯‘ï¼Œç›®å‰æ”¯æŒçš„ç¼–è¯‘å™¨æœ‰ï¼šgcc, clang å’Œ msvcã€‚ ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š ```lua target(\"test\", function() set_pcheader(\"header.h\") end) ``` ## target:set_pcxxheader ### è®¾ç½® C++ é¢„ç¼–è¯‘å¤´æ–‡ä»¶ xmake æ”¯æŒé€šè¿‡é¢„ç¼–è¯‘å¤´æ–‡ä»¶å»åŠ é€Ÿ c++ ç¨‹åºç¼–è¯‘ï¼Œç›®å‰æ”¯æŒçš„ç¼–è¯‘å™¨æœ‰ï¼šgcc, clang å’Œ msvcã€‚ ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š ```lua target(\"test\", function() set_pcxxheader(\"header.h\") end) ``` ## target:set_pmheader ### è®¾ç½® ObjC é¢„ç¼–è¯‘å¤´æ–‡ä»¶ xmake æ”¯æŒé€šè¿‡é¢„ç¼–è¯‘å¤´æ–‡ä»¶å»åŠ é€Ÿ ObjC ç¨‹åºç¼–è¯‘ï¼Œç›®å‰æ”¯æŒçš„ç¼–è¯‘å™¨æœ‰ï¼šgcc, clang å’Œ msvcã€‚ ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š ```lua target(\"test\", function() set_pmheader(\"header.h\") end) ``` ## target:set_pmxxheader ### è®¾ç½® ObjC++ é¢„ç¼–è¯‘å¤´æ–‡ä»¶ xmake æ”¯æŒé€šè¿‡é¢„ç¼–è¯‘å¤´æ–‡ä»¶å»åŠ é€Ÿ ObjC++ ç¨‹åºç¼–è¯‘ï¼Œç›®å‰æ”¯æŒçš„ç¼–è¯‘å™¨æœ‰ï¼šgcc, clang å’Œ msvcã€‚ ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š ```lua target(\"test\", function() set_pmxxheader(\"header.h\") end) ``` ## target:add_deps ### æ·»åŠ å­å·¥ç¨‹ç›®æ ‡ä¾èµ– æ·»åŠ å½“å‰ç›®æ ‡çš„ä¾èµ–ç›®æ ‡ï¼Œç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šå»ä¼˜å…ˆç¼–è¯‘ä¾èµ–çš„ç›®æ ‡ï¼Œç„¶åå†ç¼–è¯‘å½“å‰ç›®æ ‡ã€‚ã€‚ã€‚ ```lua target(\"test1\", function() set_kind(\"static\") set_files(\"*.c\") end) target(\"test2\", function() set_kind(\"static\") set_files(\"*.c\") end) target(\"demo\", function() add_deps(\"test1\", \"test2\") end) ``` ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨ç¼–è¯‘ç›®æ ‡ demo çš„æ—¶å€™ï¼Œéœ€è¦å…ˆç¼–è¯‘ test1, test2 ç›®æ ‡ï¼Œå› ä¸º demo ä¼šå»ç”¨åˆ°ä»–ä»¬ > target ä¼šè‡ªåŠ¨ç»§æ‰¿ä¾èµ–ç›®æ ‡ä¸­çš„é…ç½®å’Œå±æ€§ï¼Œä¸éœ€è¦é¢å¤–è°ƒç”¨ `add_links`, `add_linkdirs` å’Œ `add_rpathdirs` ç­‰æ¥å£å»å…³è”ä¾èµ–ç›®æ ‡äº†ã€‚ å¹¶ä¸”ç»§æ‰¿å…³ç³»æ˜¯æ”¯æŒçº§è”çš„ï¼Œä¾‹å¦‚ï¼š ```lua target(\"library1\", function() set_kind(\"static\") add_files(\"*.c\") add_includedirs(\"inc\") é»˜è®¤ç§æœ‰å¤´æ–‡ä»¶ç›®å½•ä¸ä¼šè¢«ç»§æ‰¿ add_includedirs(\"inc1\", {public true}) æ­¤å¤„çš„å¤´æ–‡ä»¶ç›¸å…³ç›®å½•ä¹Ÿä¼šè¢«ç»§æ‰¿ end) target(\"library2\", function() set_kind(\"static\") add_deps(\"library1\") add_files(\"*.c\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"library2\") end) ``` å¦‚æœæˆ‘ä»¬ä¸æƒ³ç»§æ‰¿ä¾èµ– target çš„ä»»ä½•é…ç½®ï¼Œå¦‚ä½•æ“ä½œå‘¢ï¼Ÿ ```lua add_deps(\"dep1\", \"dep2\", {inherit false}) ``` é€šè¿‡æ˜¾å¼è®¾ç½® inherit é…ç½®ï¼Œæ¥å‘Šè¯‰ xmakeï¼Œè¿™ä¸¤ä¸ªä¾èµ–çš„é…ç½®æ˜¯å¦éœ€è¦è¢«ç»§æ‰¿ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤å°±æ˜¯å¯ç”¨ç»§æ‰¿çš„ã€‚ é€šè¿‡ `add_includedirs(\"inc1\", {public true})`, è®¾ç½® public ä¸º true, å°† includedirs çš„è®¾ç½®å…¬å¼€ç»™å…¶ä»–ä¾èµ–çš„å­ target ç»§æ‰¿ã€‚ ç›®å‰å¯¹äº target çš„ç¼–è¯‘é“¾æ¥ flags ç›¸å…³æ¥å£è®¾ç½®ï¼Œéƒ½æ˜¯æ”¯æŒç»§æ‰¿å±æ€§çš„ï¼Œå¯ä»¥äººä¸ºæ§åˆ¶æ˜¯å¦éœ€è¦å¯¼å‡ºç»™å…¶ä»– target æ¥ä¾èµ–ç»§æ‰¿ï¼Œç›®å‰æ”¯æŒçš„å±æ€§æœ‰ï¼š å±æ€§ æè¿° private é»˜è®¤è®¾ç½®ï¼Œä½œä¸ºå½“å‰ target çš„ç§æœ‰é…ç½®ï¼Œä¸ä¼šè¢«ä¾èµ–çš„å…¶ä»– target æ‰€ç»§æ‰¿ public å…¬æœ‰é…ç½®ï¼Œå½“å‰ targetï¼Œä¾èµ–çš„å­ target éƒ½ä¼šè¢«è®¾ç½® interface æ¥å£è®¾ç½®ï¼Œä»…è¢«ä¾èµ–çš„å­ target æ‰€ç»§æ‰¿è®¾ç½®ï¼Œå½“å‰ target ä¸å‚ä¸ å¯¹äºè¿™å—çš„è¯¦ç»†è¯´æ˜ï¼Œå¯ä»¥çœ‹ä¸‹ï¼š[https://github.com/xmake io/xmake/issues/368](https://github.com/xmake io/xmake/issues/368) ## target:add_links ### æ·»åŠ é“¾æ¥åº“å ä¸ºå½“å‰ç›®æ ‡æ·»åŠ é“¾æ¥åº“ï¼Œä¸€èˆ¬è¿™ä¸ªè¦ä¸ [add_linkdirs](#targetadd_linkdirs) é…å¯¹ä½¿ç”¨ã€‚ ```lua target(\"demo\", function() æ·»åŠ å¯¹ libtest.a çš„é“¾æ¥ï¼Œç›¸å½“äº ltest add_links(\"test\") æ·»åŠ é“¾æ¥æœç´¢ç›®å½• add_linkdirs(\"$(buildir)/lib\") end) ``` add_links è¿˜æ”¯æŒæ·»åŠ åº“çš„å®Œæ•´è·¯å¾„ï¼Œä¾‹å¦‚ï¼š`add_links(\"/tmp/libfoo.a\")`ï¼Œæ˜¾å¼çš„æŒ‡å®šåº“æ–‡ä»¶ã€‚ ## target:add_syslinks ### æ·»åŠ ç³»ç»Ÿé“¾æ¥åº“å è¿™ä¸ªæ¥å£ä½¿ç”¨ä¸Šè·Ÿ [add_links](#targetadd_links) ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£æ·»åŠ çš„é“¾æ¥åº“é¡ºåºåœ¨æ‰€æœ‰ `add_links` ä¹‹åã€‚ å› æ­¤ä¸»è¦ç”¨äºæ·»åŠ ç³»ç»Ÿåº“ä¾èµ–ï¼Œå› ä¸ºç³»ç»Ÿåº“çš„é“¾æ¥é¡ºåºæ˜¯éå¸¸é åçš„ï¼Œä¾‹å¦‚ï¼š ```lua add_syslinks(\"pthread\", \"m\", \"dl\") target(\"demo\", function() add_links(\"a\", \"b\") add_linkdirs(\"$(buildir)/lib\") end) ``` ä¸Šé¢çš„é…ç½®ï¼Œå³ä½¿ `add_syslinks` è¢«ä¼˜å…ˆæå‰è®¾ç½®äº†ï¼Œä½†æœ€åçš„é“¾æ¥é¡ºåºä¾ç„¶æ˜¯ï¼š` la lb lpthread lm ldl` ## target:add_linkorders ### è°ƒæ•´é“¾æ¥é¡ºåº ç”¨äºè°ƒæ•´ target å†…éƒ¨çš„é“¾æ¥é¡ºåºã€‚ ç”±äº xmake æä¾›äº† `add_links`, `add_deps`, `add_packages`, `add_options` æ¥å£ï¼Œå¯ä»¥é…ç½®ç›®æ ‡ã€ä¾èµ–ï¼ŒåŒ…å’Œé€‰é¡¹ä¸­çš„é“¾æ¥ã€‚ ä½†æ˜¯å®ƒä»¬ä¹‹é—´çš„é“¾æ¥é¡ºåºï¼Œåœ¨ä¹‹å‰å¯æ§æ€§æ¯”è¾ƒå¼±ï¼Œåªèƒ½æŒ‰å›ºå®šé¡ºåºç”Ÿæˆï¼Œè¿™å¯¹äºä¸€äº›å¤æ‚çš„é¡¹ç›®ï¼Œå°±æœ‰ç‚¹æ˜¾å¾—åŠ›ä¸ä»å¿ƒäº†ã€‚ æ›´å¤šè¯¦æƒ…å’ŒèƒŒæ™¯è§ï¼š[#1452](https://github.com/xmake io/xmake/issues/1452) #### æ’åºé“¾æ¥ ä¸ºäº†æ›´åŠ çµæ´»çš„è°ƒæ•´ target å†…éƒ¨çš„å„ç§é“¾æ¥é¡ºåºï¼Œæˆ‘ä»¬æ–°å¢äº† `add_linkorders` æ¥å£ï¼Œç”¨äºé…ç½®ç›®æ ‡ã€ä¾èµ–ã€åŒ…ã€é€‰é¡¹ã€é“¾æ¥ç»„å¼•å…¥çš„å„ç§é“¾æ¥é¡ºåºã€‚ ä¾‹å¦‚ï¼š ```lua add_links(\"a\", \"b\", \"c\", \"d\", \"e\") e > b > a add_linkorders(\"e\", \"b\", \"a\") e > d add_linkorders(\"e\", \"d\") ``` add_links æ˜¯é…ç½®çš„åˆå§‹é“¾æ¥é¡ºåºï¼Œç„¶åæˆ‘ä»¬é€šè¿‡ add_linkorders é…ç½®äº†ä¸¤ä¸ªå±€éƒ¨é“¾æ¥ä¾èµ– `e > b > a` å’Œ `e > d` åã€‚ xmake å†…éƒ¨å°±ä¼šæ ¹æ®è¿™äº›é…ç½®ï¼Œç”Ÿæˆ DAG å›¾ï¼Œé€šè¿‡æ‹“æ‰‘æ’åºçš„æ–¹å¼ï¼Œç”Ÿæˆæœ€ç»ˆçš„é“¾æ¥é¡ºåºï¼Œæä¾›ç»™é“¾æ¥å™¨ã€‚ å½“ç„¶ï¼Œå¦‚æœå­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œäº§ç”Ÿäº†ç¯ï¼Œå®ƒä¹Ÿä¼šæä¾›è­¦å‘Šä¿¡æ¯ã€‚ #### æ’åºé“¾æ¥å’Œé“¾æ¥ç»„ å¦å¤–ï¼Œå¯¹äºå¾ªç¯ä¾èµ–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `add_linkgroups` é…ç½®é“¾æ¥ç»„çš„æ–¹å¼ä¹Ÿè§£å†³ã€‚ å¹¶ä¸” `add_linkorders` ä¹Ÿèƒ½å¤Ÿå¯¹é“¾æ¥ç»„è¿›è¡Œæ’åºã€‚ ```lua add_links(\"a\", \"b\", \"c\", \"d\", \"e\") add_linkgroups(\"c\", \"d\", {name \"foo\", group true}) add_linkorders(\"e\", \"linkgroup::foo\") ``` å¦‚æœè¦æ’åºé“¾æ¥ç»„ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªé“¾æ¥ç»„å–ä¸ªåï¼Œ`{name \"foo\"}` ï¼Œç„¶åå°±èƒ½åœ¨ `add_linkorders` é‡Œé¢é€šè¿‡ `linkgroup::foo` å»å¼•ç”¨é…ç½®äº†ã€‚ 2.9.6 ç‰ˆæœ¬æ–°å¢ as_needed é…ç½®é¡¹ï¼Œå¯ä»¥ç”¨äºç¦ç”¨ as_neededã€‚ï¼ˆé»˜è®¤ä¸é…ç½®ï¼Œå°±æ˜¯å¼€å¯çŠ¶æ€ã€‚ï¼‰ ```lua add_linkgroups(\"c\", \"d\", {as_needed false}) ``` å¯¹åº”çš„ flags å¦‚ä¸‹ã€‚ ```bash Wl, no as needed c d Wl, as needed ``` #### æ’åºé“¾æ¥å’Œ frameworks æˆ‘ä»¬ä¹Ÿå¯ä»¥æ’åºé“¾æ¥å’Œ macOS/iPhoneOS çš„ frameworksã€‚ ```lua add_links(\"a\", \"b\", \"c\", \"d\", \"e\") add_frameworks(\"Foundation\", \"CoreFoundation\") add_linkorders(\"e\", \"framework::CoreFoundation\") ``` #### å®Œæ•´ä¾‹å­ ç›¸å…³çš„å®Œæ•´ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"libpng\") target(\"bar\", function() set_kind(\"shared\") add_files(\"src/foo.cpp\") add_linkgroups(\"m\", \"pthread\", {whole true}) end) target(\"foo\", function() set_kind(\"static\") add_files(\"src/foo.cpp\") add_packages(\"libpng\", {public true}) end) target(\"demo\", function() set_kind(\"binary\") add_deps(\"foo\") add_files(\"src/main.cpp\") if is_plat(\"linux\", \"macosx\") then add_syslinks(\"pthread\", \"m\", \"dl\") end if is_plat(\"macosx\") then add_frameworks(\"Foundation\", \"CoreFoundation\") end add_linkorders(\"framework::Foundation\", \"png16\", \"foo\") add_linkorders(\"dl\", \"linkgroup::syslib\") add_linkgroups(\"m\", \"pthread\", {name \"syslib\", group true}) end) ``` å®Œæ•´å·¥ç¨‹åœ¨ï¼š[linkorders example](https://github.com/xmake io/xmake/blob/master/tests/projects/c%2B%2B/linkorders/xmake.lua) ## target:add_linkgroups ### æ·»åŠ é“¾æ¥ç»„ è¿™ä¸ªé“¾æ¥ç»„çš„ç‰¹æ€§ï¼Œç›®å‰ä¸»è¦ç”¨äº linux å¹³å°çš„ç¼–è¯‘ï¼Œä»…æ”¯æŒ gcc/clang ç¼–è¯‘å™¨ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ gcc/clang é‡Œé¢çš„é“¾æ¥ç»„æ¦‚å¿µä¸»è¦ç‰¹æŒ‡ï¼š` Wl, start group` è€Œ xmake å¯¹é½è¿›è¡Œäº†å°è£…ï¼Œåšäº†è¿›ä¸€æ­¥æŠ½è±¡ï¼Œå¹¶ä¸”ä¸ä»…ä»…ç”¨äºå¤„ç† ` Wl, start group`ï¼Œè¿˜å¯ä»¥å¤„ç† ` Wl, whole archive` å’Œ ` Wl, Bstatic`ã€‚ ä¸‹é¢æˆ‘ä»¬ä¼šä¸€ä¸€å¯¹å…¶è¿›è¡Œè®²è§£ã€‚ æ›´å¤šè¯¦æƒ…è§ï¼š[#1452](https://github.com/xmake io/xmake/issues/1452) #### start group æ”¯æŒ ` Wl, start group` å’Œ ` Wl, end group` æ˜¯ç”¨äºå¤„ç†å¤æ‚åº“ä¾èµ–å…³ç³»çš„é“¾æ¥å™¨é€‰é¡¹ï¼Œç¡®ä¿é“¾æ¥å™¨å¯ä»¥è§£å†³ç¬¦å·ä¾èµ–å¹¶æˆåŠŸè¿æ¥å¤šä¸ªåº“ã€‚ åœ¨ xmake ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼å®ç°ï¼š ```lua add_linkgroups(\"a\", \"b\", {group true}) ``` å®ƒä¼šå¯¹åº”ç”Ÿæˆ ` Wl, start group la lb Wl, end group` é“¾æ¥é€‰é¡¹ã€‚ å¦‚æœ a å’Œ b åº“ä¹‹é—´æœ‰ç¬¦å·çš„å¾ªç¯ä¾èµ–ï¼Œä¹Ÿä¸ä¼šæŠ¥é“¾æ¥é”™è¯¯ï¼Œèƒ½å¤Ÿæ­£å¸¸é“¾æ¥æˆåŠŸã€‚ å¯¹äºä¸æ”¯æŒçš„å¹³å°å’Œç¼–è¯‘ï¼Œä¼šé€€åŒ–æˆ ` la lb` #### whole archive æ”¯æŒ ` whole archive` æ˜¯ä¸€ä¸ªé“¾æ¥å™¨é€‰é¡¹ï¼Œé€šå¸¸ç”¨äºå¤„ç†é™æ€åº“ã€‚ å®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰é“¾æ¥å™¨å°†æŒ‡å®šçš„é™æ€åº“ä¸­çš„æ‰€æœ‰ç›®æ ‡æ–‡ä»¶éƒ½åŒ…å«åˆ°æœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè€Œä¸ä»…ä»…æ˜¯æ»¡è¶³å½“å‰ç¬¦å·ä¾èµ–çš„ç›®æ ‡æ–‡ä»¶ã€‚ è¿™å¯ä»¥ç”¨äºç¡®ä¿æŸäº›åº“çš„æ‰€æœ‰ä»£ç éƒ½è¢«é“¾æ¥ï¼Œå³ä½¿å®ƒä»¬åœ¨å½“å‰çš„ç¬¦å·ä¾èµ–å…³ç³»ä¸­æ²¡æœ‰ç›´æ¥å¼•ç”¨ã€‚ æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ gcc/clang çš„æ–‡æ¡£ã€‚ åœ¨ xmake ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼å®ç°ï¼š ```lua add_linkgroups(\"a\", \"b\", {whole true}) ``` å®ƒä¼šå¯¹åº”ç”Ÿæˆ ` Wl, whole archive la lb Wl, no whole archive` é“¾æ¥é€‰é¡¹ã€‚ å¯¹äºä¸æ”¯æŒçš„å¹³å°å’Œç¼–è¯‘ï¼Œä¼šé€€åŒ–æˆ ` la lb` å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶é…ç½® group/wholeï¼š ```lua add_linkgroups(\"a\", \"b\", {whole true, group true}) ``` #### Bstatic æ”¯æŒ ` Bstatic` ä¹Ÿæ˜¯ç”¨äºç¼–è¯‘å™¨ï¼ˆå¦‚ gccï¼‰çš„é€‰é¡¹ï¼Œç”¨äºæŒ‡ç¤ºç¼–è¯‘å™¨åœ¨é“¾æ¥æ—¶åªä½¿ç”¨é™æ€åº“è€Œä¸ä½¿ç”¨å…±äº«åº“ã€‚ æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ gcc/clang çš„æ–‡æ¡£ã€‚ åœ¨ xmake ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼å®ç°ï¼š ```lua add_linkgroups(\"a\", \"b\", {static true}) ``` å®ƒä¼šå¯¹åº”ç”Ÿæˆ ` Wl, Bstatic la lb Wl, Bdynamic` é“¾æ¥é€‰é¡¹ã€‚ ## target:add_files ### æ·»åŠ æºä»£ç æ–‡ä»¶ ç”¨äºæ·»åŠ ç›®æ ‡å·¥ç¨‹çš„æºæ–‡ä»¶ï¼Œç”šè‡³åº“æ–‡ä»¶ï¼Œç›®å‰æ”¯æŒçš„ä¸€äº›æ–‡ä»¶ç±»å‹ï¼š æ”¯æŒçš„æºæ–‡ä»¶ç±»å‹ æè¿° .c/.cpp/.cc/.cxx c++ æ–‡ä»¶ .s/.S/.asm æ±‡ç¼–æ–‡ä»¶ .m/.mm objc æ–‡ä»¶ .swift swift æ–‡ä»¶ .go golang æ–‡ä»¶ .o/.obj å¯¹è±¡æ–‡ä»¶ .a/.lib é™æ€åº“æ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨åˆå¹¶åº“åˆ°ç›®æ ‡ç¨‹åº .rc msvc çš„èµ„æºæ–‡ä»¶ .manifest windows manifest æ–‡ä»¶ .def windows dll å¯¼å‡ºæ–‡ä»¶ .ld/.lds linker scripts æ–‡ä»¶ï¼Œé€šå¸¸ç”¨äº gcc/clang .map/.ver version script æ–‡ä»¶ï¼Œé€šå¸¸ç”¨äº gcc/clang å…¶ä¸­é€šé…ç¬¦ `*` è¡¨ç¤ºåŒ¹é…å½“å‰ç›®å½•ä¸‹æ–‡ä»¶ï¼Œè€Œ `**` åˆ™åŒ¹é…å¤šçº§ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ ä¾‹å¦‚ï¼š ```lua add_files(\"src/test_*.c\") add_files(\"src/xxx/**.cpp\") add_files(\"src/asm/*.S\", \"src/objc/**/hello.m\") ``` `add_files` çš„ä½¿ç”¨å…¶å®æ˜¯ç›¸å½“çµæ´»æ–¹ä¾¿çš„ï¼Œå…¶åŒ¹é…æ¨¡å¼å€Ÿé‰´äº† premake çš„é£æ ¼ï¼Œä½†æ˜¯åˆå¯¹å…¶è¿›è¡Œäº†æ”¹å–„å’Œå¢å¼ºã€‚ ä½¿å¾—ä¸ä»…å¯ä»¥åŒ¹é…æ–‡ä»¶ï¼Œè¿˜æœ‰å¯ä»¥åœ¨æ·»åŠ æ–‡ä»¶åŒæ—¶ï¼Œè¿‡æ»¤æ’é™¤æŒ‡å®šæ¨¡å¼çš„ä¸€æ‰¹æ–‡ä»¶ã€‚ ä¾‹å¦‚ï¼š ```lua é€’å½’æ·»åŠ  src ä¸‹çš„æ‰€æœ‰ c æ–‡ä»¶ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬ src/impl / ä¸‹çš„æ‰€æœ‰ c æ–‡ä»¶ add_files(\"src/**.cimpl/*.c\") æ·»åŠ  src ä¸‹çš„æ‰€æœ‰ cpp æ–‡ä»¶ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬ src/test.cppã€src/hello.cpp ä»¥åŠ src ä¸‹æ‰€æœ‰å¸¦ xx_å‰ç¼€çš„ cpp æ–‡ä»¶ add_files(\"src/*.cpptest.cpphello.cppxx_*.cpp\") ``` å…¶ä¸­åˆ†éš”ç¬¦ `` ä¹‹åçš„éƒ½æ˜¯éœ€è¦æ’é™¤çš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¹ŸåŒæ ·æ”¯æŒåŒ¹é…æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶æ·»åŠ å¤šä¸ªè¿‡æ»¤æ¨¡å¼ï¼Œåªè¦ä¸­é—´ç”¨ `` åˆ†å‰²å°±è¡Œäº†ã€‚ã€‚ æ·»åŠ æ–‡ä»¶çš„æ—¶å€™æ”¯æŒè¿‡æ»¤ä¸€äº›æ–‡ä»¶çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼Œå¯ä»¥ä¸ºåç»­æ ¹æ®ä¸åŒå¼€å…³é€»è¾‘æ·»åŠ æ–‡ä»¶æä¾›åŸºç¡€ã€‚ <p class \"tip\"> ä¸ºäº†ä½¿å¾—æè¿°ä¸Šæ›´åŠ çš„ç²¾ç®€ï¼Œ`` ä¹‹åçš„è¿‡æ»¤æè¿°éƒ½æ˜¯åŸºäºèµ·ä¸€ä¸ªæ¨¡å¼ï¼š`src/*.cpp` ä¸­ `*` ä¹‹å‰çš„ç›®å½•ä¸ºåŸºç¡€çš„ã€‚ æ‰€ä»¥ä¸Šé¢çš„ä¾‹å­åé¢è¿‡æ»¤çš„éƒ½æ˜¯åœ¨ src ä¸‹çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯è¦æ³¨æ„çš„ã€‚ </p> xmake å¯¹ `add_files` è¿›è¡Œäº†æ”¹è¿›ï¼Œæ”¯æŒåŸºäº files æ›´ç»†ç²’åº¦çš„ç¼–è¯‘é€‰é¡¹æ§åˆ¶ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() add_defines(\"TEST1\") add_files(\"src/*.c\") add_files(\"test/*.c\", \"test2/test2.c\", {defines \"TEST2\", languages \"c99\", includedirs \".\", cflags \" O0\"}) end) ``` å¯ä»¥åœ¨ `add_files` çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œä¼ å…¥ä¸€ä¸ªé…ç½® tableï¼Œå»æ§åˆ¶æŒ‡å®š files çš„ç¼–è¯‘é€‰é¡¹ï¼Œé‡Œé¢çš„é…ç½®å‚æ•°è·Ÿ target çš„ä¸€è‡´ï¼Œå¹¶ä¸”è¿™äº›æ–‡ä»¶è¿˜ä¼šç»§æ‰¿ target çš„é€šç”¨é…ç½® ` DTEST1`ã€‚ xmake æ”¯æŒæ·»åŠ æœªçŸ¥çš„ä»£ç æ–‡ä»¶ï¼Œé€šè¿‡è®¾ç½® rule è‡ªå®šä¹‰è§„åˆ™ï¼Œå®ç°è¿™äº›æ–‡ä»¶çš„è‡ªå®šä¹‰æ„å»ºï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() ... add_files(\"src/test/*.md\", {rule \"markdown\"}) end) ``` å…³äºè‡ªå®šä¹‰æ„å»ºè§„åˆ™çš„ä½¿ç”¨è¯´æ˜ï¼Œè¯¦ç»†è§ï¼š[æ„å»ºè§„åˆ™](#æ„å»ºè§„åˆ™)ã€‚ å¯ä»¥é€šè¿‡ force å‚æ•°æ¥å¼ºåˆ¶ç¦ç”¨ cxflags,cflags ç­‰ç¼–è¯‘é€‰é¡¹çš„è‡ªåŠ¨æ£€æµ‹ï¼Œç›´æ¥ä¼ å…¥ç¼–è¯‘å™¨ï¼Œå“ªæ€•ç¼–è¯‘å™¨æœ‰å¯èƒ½ä¸æ”¯æŒï¼Œä¹Ÿä¼šè®¾ç½®ï¼š ```lua add_files(\"src/*.c\", {force {cxflags \" DTEST\", mflags \" framework xxx\"}}) ``` ## target:remove_files ### ä»å‰é¢çš„æºä»£ç æ–‡ä»¶åˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šæ–‡ä»¶ é€šè¿‡æ­¤æ¥å£ï¼Œå¯ä»¥ä»å‰é¢ [add_files](targetadd_files) æ¥å£æ·»åŠ çš„æ–‡ä»¶åˆ—è¡¨ä¸­ï¼Œåˆ é™¤æŒ‡å®šçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() add_files(\"src/*.c\") remove_files(\"src/test.c\") end) ``` ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥ä» `src` ç›®å½•ä¸‹æ·»åŠ é™¤ `test.c` ä»¥å¤–çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå½“ç„¶è¿™ä¸ªä¹Ÿå¯ä»¥é€šè¿‡ `add_files(\"src/*.ctest.c\")` æ¥è¾¾åˆ°ç›¸åŒçš„ç›®çš„ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æ›´åŠ çµæ´»ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ¡ä»¶åˆ¤æ–­æ¥æ§åˆ¶åˆ é™¤å“ªäº›æ–‡ä»¶ï¼Œå¹¶ä¸”æ­¤æ¥å£ä¹Ÿæ”¯æŒ [add_files](targetadd_files) çš„åŒ¹é…æ¨¡å¼ï¼Œè¿‡æ»¤æ¨¡å¼ï¼Œè¿›è¡Œæ‰¹é‡ç§»é™¤ã€‚ ```lua target(\"test\", function() add_files(\"src/**.c\") remove_files(\"src/test*.c\") remove_files(\"src/subdir/*.cxxx.c\") if is_plat(\"iphoneos\") then add_files(\"xxx.m\") end end) ``` é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º `add_files` å’Œ `remove_files` æ˜¯æ ¹æ®è°ƒç”¨é¡ºåºï¼Œè¿›è¡Œé¡ºåºæ·»åŠ å’Œåˆ é™¤çš„ï¼Œå¹¶ä¸”é€šè¿‡ `remove_files(\"src/subdir/*.cxxx.c\")` åˆ é™¤ä¸€æ‰¹æ–‡ä»¶ï¼Œ å¹¶ä¸”æ’é™¤ `src/subdir/xxx.c`ï¼ˆå°±æ˜¯è¯´ï¼Œä¸åˆ é™¤è¿™ä¸ªæ–‡ä»¶ï¼‰ã€‚ æ³¨ï¼š è¿™ä¸ªæ¥å£ v2.6.3 ç‰ˆæœ¬æ‰æä¾›ï¼Œä¹‹å‰çš„ç‰ˆæœ¬æ˜¯ del_filesï¼Œå·²ç»åºŸå¼ƒã€‚ å¦‚æœå‘ä¸‹è¦å…¼å®¹ä»¥å‰çš„ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„é…ç½®è§£å†³ã€‚ ```lua remove_files remove_files or del_files ``` ## target:remove_headerfiles ### ä»å‰é¢çš„å¤´æ–‡ä»¶åˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šæ–‡ä»¶ ä¸»è¦ç”¨äºä» `add_headerfiles` è®¾ç½®çš„å¤´æ–‡ä»¶åˆ—è¡¨ä¸­åˆ é™¤æ–‡ä»¶ï¼Œç”¨æ³•ä¸ `remove_files` ç±»ä¼¼ã€‚ ## target:add_linkdirs ### æ·»åŠ é“¾æ¥åº“æœç´¢ç›®å½• è®¾ç½®é“¾æ¥åº“çš„æœç´¢ç›®å½•ï¼Œè¿™ä¸ªæ¥å£çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š ```lua target(\"test\", function() add_linkdirs(\"$(buildir)/lib\") end) ``` æ­¤æ¥å£ç›¸å½“äº gcc çš„ ` Lxxx` é“¾æ¥é€‰é¡¹ã€‚ ä¸€èˆ¬ä»–æ˜¯ä¸ [add_links](#targetadd_links) é…åˆä½¿ç”¨çš„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ [add_ldflags](#targetadd_ldflags) æˆ–è€… [add_shflags](#targetadd_shflags) æ¥å£æ¥æ·»åŠ ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ <p class \"tip\"> å¦‚æœä¸æƒ³åœ¨å·¥ç¨‹ä¸­å†™æ­»ï¼Œå¯ä»¥é€šè¿‡ï¼š`xmake f linkdirs xxx` æˆ–è€… `xmake f ldflags \" L/xxx\"` çš„æ–¹å¼æ¥è®¾ç½®ï¼Œå½“ç„¶è¿™ç§æ‰‹åŠ¨è®¾ç½®çš„ç›®å½•æœç´¢ä¼˜å…ˆçº§æ›´é«˜ã€‚ </p> ## target:add_rpathdirs ### æ·»åŠ ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åº“çš„åŠ è½½æœç´¢ç›®å½• é€šè¿‡ [add_linkdirs](#targetadd_linkdirs) è®¾ç½®åŠ¨æ€åº“çš„é“¾æ¥æœç´¢ç›®å½•åï¼Œç¨‹åºè¢«æ­£å¸¸é“¾æ¥ï¼Œä½†æ˜¯åœ¨ linux å¹³å°æƒ³è¦æ­£å¸¸è¿è¡Œç¼–è¯‘åçš„ç¨‹åºï¼Œä¼šæŠ¥åŠ è½½åŠ¨æ€åº“å¤±è´¥ã€‚ å› ä¸ºæ²¡æ‰¾åˆ°åŠ¨æ€åº“çš„åŠ è½½ç›®å½•ï¼Œæƒ³è¦æ­£å¸¸è¿è¡Œä¾èµ–åŠ¨æ€åº“çš„ç¨‹åºï¼Œéœ€è¦è®¾ç½® `LD_LIBRARY_PATH` ç¯å¢ƒå˜é‡ï¼ŒæŒ‡å®šéœ€è¦åŠ è½½çš„åŠ¨æ€åº“ç›®å½•ã€‚ ä½†æ˜¯è¿™ç§æ–¹å¼æ˜¯å…¨å±€çš„ï¼Œå½±å“å¤ªå¹¿ï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯é€šè¿‡ ` rpath xxx` çš„é“¾æ¥å™¨é€‰é¡¹ï¼Œåœ¨é“¾æ¥ç¨‹åºçš„æ—¶å€™è®¾ç½®å¥½éœ€è¦åŠ è½½çš„åŠ¨æ€åº“æœç´¢è·¯å¾„ï¼Œè€Œ xmake å¯¹å…¶è¿›è¡Œäº†å°è£…ï¼Œé€šè¿‡ `add_rpathdirs` æ›´å¥½çš„å¤„ç†è·¨å¹³å°é—®é¢˜ã€‚ å…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_linkdirs(\"$(buildir)/lib\") add_rpathdirs(\"$(buildir)/lib\") end) ``` åªéœ€è¦åœ¨é“¾æ¥çš„æ—¶å€™ï¼Œåœ¨è®¾ç½®ä¸‹ rpath ç›®å½•å°±å¥½äº†ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ `add_ldflags(\" Wl, rpath xxx\")` è¾¾åˆ°ç›¸åŒçš„ç›®çš„ï¼Œä½†æ˜¯è¿™ä¸ªæ¥å£æ›´åŠ é€šç”¨ã€‚ å†…éƒ¨ä¼šå¯¹ä¸åŒå¹³å°è¿›è¡Œå¤„ç†ï¼Œåƒåœ¨ macOS ä¸‹ï¼Œæ˜¯ä¸éœ€è¦ ` rpath` è®¾ç½®çš„ï¼Œä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸åŠ è½½è¿è¡Œç¨‹åºï¼Œå› æ­¤é’ˆå¯¹è¿™ä¸ªå¹³å°ï¼Œxmake å†…éƒ¨ä¼šç›´æ¥å¿½ç•¥å™¨è®¾ç½®ï¼Œé¿å…é“¾æ¥æŠ¥é”™ã€‚ è€Œåœ¨ä¸º dlang ç¨‹åºè¿›è¡ŒåŠ¨æ€åº“é“¾æ¥æ—¶ï¼Œxmake ä¼šè‡ªåŠ¨å¤„ç†æˆ ` L rpath xxx` æ¥ä¼ å…¥ dlang çš„é“¾æ¥å™¨ï¼Œè¿™æ ·å°±é¿å…äº†ç›´æ¥ä½¿ç”¨ `add_ldflags` éœ€è¦è‡ªå·±åˆ¤æ–­å’Œå¤„ç†ä¸åŒå¹³å°å’Œç¼–è¯‘å™¨é—®é¢˜ã€‚ xmake å¯¹è¿™ä¸ªæ¥å£è¿›è¡Œäº†æ”¹è¿›ï¼Œæ”¯æŒï¼š`@loader_path`, `@executable_path` å’Œ `$ORIGIN` çš„å†…ç½®å˜é‡ï¼Œæ¥æŒ‡å®šç¨‹åºçš„åŠ è½½ç›®å½•ï¼Œå®ƒä»¬çš„æ•ˆæœåŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†åŒæ—¶å…¼å®¹ macho, elfã€‚ ä¾‹å¦‚ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_linkdirs(\"$(buildir)/lib\") add_rpathdirs(\"@loader_path/lib\") end) ``` æŒ‡å®š test ç¨‹åºåŠ è½½å½“å‰æ‰§è¡Œç›®å½•ä¸‹ `lib/*.[sodylib]` çš„åŠ¨æ€åº“æ–‡ä»¶ï¼Œè¿™å°†æœ‰åŠ©äºæå‡ç¨‹åºçš„å¯ç§»æ¤æ€§ï¼Œä¸ç”¨å†™æ­»ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ï¼Œå¯¼è‡´ç¨‹åºå’Œç›®å½•åˆ‡æ¢å¼•èµ·ç¨‹åºåŠ è½½åŠ¨æ€åº“å¤±è´¥ã€‚ > éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ macos ä¸‹ï¼Œè¦æƒ³ add_rpathdirs è®¾ç½®ç”Ÿæ•ˆï¼Œéœ€è¦å¯¹ dylib åšä¸€äº›é¢„å¤„ç†ï¼Œæ·»åŠ  `@rpath/xxx` è·¯å¾„è®¾ç½®ï¼š > `$install_name_tool add_rpath @rpath/libxxx.dylib xxx/libxxx.dylib` > æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `otool L libxxx.dylib` æŸ¥çœ‹æ˜¯å¦å­˜åœ¨å¸¦ @rpath çš„è·¯å¾„ å¦å¤–ï¼Œå¯¹äº gccï¼Œ `add_rpathdirs` é»˜è®¤è®¾ç½®çš„æ˜¯ runpathï¼Œå¦‚æœæƒ³è¦æ˜¾å¼çš„é…ç½®ä¸Š ` Wl, enable new dtags`, ` Wl, disable new dtags` å»é…ç½® rpath è¿˜æ˜¯ runpath æˆ‘ä»¬å¯ä»¥é€šè¿‡é¢å¤–çš„å‚æ•°æŒ‡å®šï¼Œ`add_rpathdirs(\"xxx\", {runpath true})` ç›¸å…³èƒŒæ™¯ç»†èŠ‚è§ï¼š[#5109](https://github.com/xmake io/xmake/issues/5109) xmake æ–°å¢äº† `add_rpathdirs(\"xxx\", {install_only true})` ï¼Œå¯ä»¥å•ç‹¬é…ç½®å®‰è£…åçš„ rpath è·¯å¾„ã€‚ ## target:add_includedirs ### æ·»åŠ å¤´æ–‡ä»¶æœç´¢ç›®å½• è®¾ç½®å¤´æ–‡ä»¶çš„æœç´¢ç›®å½•ï¼Œè¿™ä¸ªæ¥å£çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š ```lua target(\"test\", function() add_includedirs(\"$(buildir)/include\") end) ``` å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ [add_cxflags](#targetadd_cxflags) æˆ–è€… [add_mxflags](#targetadd_mxflags) ç­‰æ¥å£æ¥è®¾ç½®ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ å¯é€šè¿‡é¢å¤–çš„ `{publicinterface true}` å±æ€§è®¾ç½®ï¼Œå°† includedirs å¯¼å‡ºç»™ä¾èµ–çš„å­ targetï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() set_kind(\"static\") add_includedirs(\"src/include\") ä»…å¯¹å½“å‰ target ç”Ÿæ•ˆ add_includedirs(\"$(buildir)/include\", {public true})ï¼Œå½“å‰ target å’Œå­ target éƒ½ä¼šè¢«è®¾ç½® end) target(\"demo\", function() set_kind(\"binary\") add_deps(\"test\") end) ``` æ›´å¤šå…³äºè¿™å—çš„è¯´æ˜ï¼Œè§ï¼š[add_deps](#targetadd_deps) > å¦‚æœä¸æƒ³åœ¨å·¥ç¨‹ä¸­å†™æ­»ï¼Œå¯ä»¥é€šè¿‡ï¼š`xmake f includedirs xxx` æˆ–è€… `xmake f cxflags \" I/xxx\"` çš„æ–¹å¼æ¥è®¾ç½®ï¼Œå½“ç„¶è¿™ç§æ‰‹åŠ¨è®¾ç½®çš„ç›®å½•æœç´¢ä¼˜å…ˆçº§æ›´é«˜ã€‚ > å¤´æ–‡ä»¶é»˜è®¤ä¸æ”¯æŒæ¨¡å¼åŒ¹é…ï¼Œä¹Ÿä¸æ¨èè¿™ä¹ˆåšï¼Œ å®¹æ˜“å¼•å…¥ä¸€äº›ä¸éœ€è¦çš„å­ç›®å½•ï¼Œå¯¼è‡´å„ç§å¤´æ–‡ä»¶å¼•ç”¨å†²çªå¹²æ‰°ï¼Œå‡ºäº†é—®é¢˜æ›´éš¾æŸ¥ã€‚ > å¦‚æœç”¨æˆ·éè¦è¿™ä¹ˆåšï¼Œå¯ä»¥é€šè¿‡ `add_includedirs(os.dirs(path.join(os.scriptdir(), \"xxx/**\")))` æ¥å®ç°ã€‚ ## target:add_sysincludedirs ### æ·»åŠ ç³»ç»Ÿå¤´æ–‡ä»¶æœç´¢ç›®å½• `add_includedirs` é€šå¸¸ç”¨äºæ·»åŠ å·¥ç¨‹å¤´æ–‡ä»¶æœç´¢ç›®å½•ï¼Œè€Œä¸€äº›ç³»ç»Ÿåº“å¤´æ–‡ä»¶çš„å¼•å…¥ï¼Œæœ‰å¯èƒ½ä¼šè§¦å‘ä¸€äº›å†…éƒ¨çš„è­¦å‘Šä¿¡æ¯ï¼Œä½†æ˜¯è¿™äº›è­¦å‘Šå¯¹äºç”¨æˆ·æ¥è®²ä¹Ÿè®¸æ˜¯æ— æ³•é¿å…ï¼Œä¹Ÿä¿®å¤ä¸äº†çš„ã€‚ é‚£ä¹ˆï¼Œæ¯æ¬¡æ˜¾ç¤ºè¿™äº›è­¦å‘Šåè€Œä¼šå¹²æ‰°ç”¨æˆ·ï¼Œå› æ­¤ï¼Œgcc/clang æä¾›äº† ` isystem` ä¸“é—¨ç”¨æ¥è®¾ç½®ç³»ç»Ÿå¤´æ–‡ä»¶æœç´¢è·¯å¾„ï¼Œé€šè¿‡æ­¤æ¥å£è®¾ç½®çš„å¤´æ–‡ä»¶ï¼Œä¼šå‹åˆ¶ä¸€äº›è­¦å‘Šä¿¡æ¯æ¥é¿å…å¹²æ‰°ç”¨æˆ·ã€‚ msvc ä¹Ÿé€šæä¾›äº† `/external:I` ç¼–è¯‘é€‰é¡¹æ¥è®¾ç½®å®ƒï¼Œä½†æ˜¯éœ€è¦é«˜ç‰ˆæœ¬ msvc æ‰æ”¯æŒã€‚ å› æ­¤ï¼Œxmake æä¾›äº† `add_sysincludedirs` æ¥æŠ½è±¡é€‚é…è®¾ç½®ç³»ç»Ÿåº“å¤´æ–‡ä»¶æœç´¢è·¯å¾„ï¼Œå¦‚æœå½“å‰ç¼–è¯‘å™¨ä¸æ”¯æŒï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢å› ` I` ç¼–è¯‘é€‰é¡¹ã€‚ ```lua target(\"test\", function() add_sysincludedirs(\"/usr/include\") end) ``` ç”Ÿæˆçš„ç¼–è¯‘é€‰é¡¹å¦‚ä¸‹ï¼š ```console isystem /usr/include ``` å¦‚æœæ˜¯ msvc ç¼–è¯‘å™¨ï¼Œåˆ™ä¼šæ˜¯ï¼š ```console /experimental:external /external:W0 /external:I /usr/include ``` > å¦å¤–ï¼Œä½¿ç”¨ `add_requires()` å¼•å…¥çš„ä¾èµ–åŒ…ï¼Œé»˜è®¤ä¹Ÿä¼šä½¿ç”¨ ` isystem` ä½œä¸ºå¤–éƒ¨ç³»ç»Ÿå¤´æ–‡ä»¶ã€‚ ## target:add_defines ### æ·»åŠ å®å®šä¹‰ ```lua add_defines(\"DEBUG\", \"TEST 0\", \"TEST2 \\\"hello\\\"\") ``` ç›¸å½“äºè®¾ç½®äº†ç¼–è¯‘é€‰é¡¹ï¼š ``` DDEBUG DTEST 0 DTEST2 \\\"hello\\\" ``` ## target:add_undefines ### å–æ¶ˆå®å®šä¹‰ ```lua add_undefines(\"DEBUG\") ``` ç›¸å½“äºè®¾ç½®äº†ç¼–è¯‘é€‰é¡¹ï¼š` UDEBUG` åœ¨ä»£ç ä¸­ç›¸å½“äºï¼š`#undef DEBUG` ## target:add_cflags ### æ·»åŠ  c ç¼–è¯‘é€‰é¡¹ ä»…å¯¹ c ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ ```lua add_cflags(\" g\", \" O2\", \" DDEBUG\") ``` > æ‰€æœ‰é€‰é¡¹å€¼éƒ½åŸºäº gcc çš„å®šä¹‰ä¸ºæ ‡å‡†ï¼Œå¦‚æœå…¶ä»–ç¼–è¯‘å™¨ä¸å…¼å®¹ï¼ˆä¾‹å¦‚ï¼švcï¼‰ï¼Œxmake ä¼šè‡ªåŠ¨å†…éƒ¨å°†å…¶è½¬æ¢æˆå¯¹åº”ç¼–è¯‘å™¨æ”¯æŒçš„é€‰é¡¹å€¼ã€‚ > ç”¨æˆ·æ— éœ€æ“å¿ƒå…¶å…¼å®¹æ€§ï¼Œå¦‚æœå…¶ä»–ç¼–è¯‘å™¨æ²¡æœ‰å¯¹åº”çš„åŒ¹é…å€¼ï¼Œé‚£ä¹ˆ xmake ä¼šè‡ªåŠ¨å¿½ç•¥å™¨è®¾ç½®ã€‚ å¯ä»¥é€šè¿‡ force å‚æ•°æ¥å¼ºåˆ¶ç¦ç”¨ flags çš„è‡ªåŠ¨æ£€æµ‹ï¼Œç›´æ¥ä¼ å…¥ç¼–è¯‘å™¨ï¼Œå“ªæ€•ç¼–è¯‘å™¨æœ‰å¯èƒ½ä¸æ”¯æŒï¼Œä¹Ÿä¼šè®¾ç½®ï¼š ```lua add_cflags(\" g\", \" O2\", {force true}) ``` ## target:add_cxflags ### æ·»åŠ  c/c++ ç¼–è¯‘é€‰é¡¹ åŒæ—¶å¯¹ c/c++ ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ï¼Œç”¨æ³•è·Ÿ add_cflags ä¸€è‡´ã€‚ ## target:add_cxxflags ### æ·»åŠ  c++ ç¼–è¯‘é€‰é¡¹ ä»…å¯¹ c++ ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ï¼Œç”¨æ³•è·Ÿ add_cflags ä¸€è‡´ã€‚ #### æ·»åŠ ç‰¹å®šç¼–è¯‘å™¨ flags æˆ‘ä»¬æ”¹è¿›äº†æ‰€æœ‰ flags æ·»åŠ æ¥å£ï¼Œå¯ä»¥ä»…ä»…å¯¹ç‰¹å®šç¼–è¯‘å™¨æŒ‡å®š flagsï¼Œä¾‹å¦‚ï¼š ```lua add_cxxflags(\"clang:: stdlib libc++\") add_cxxflags(\"gcc:: stdlib libc++\") add_cxxflags(\"cl::/GR \") add_cxxflags(\"clang_cl::/GR \") ``` æˆ–è€…ï¼š ```lua add_cxxflags(\" stdlib libc++\", {tools \"clang\"}) add_cxxflags(\" stdlib libc++\", {tools \"gcc\"}) add_cxxflags(\"/GR \", {tools {\"clang_cl\", \"cl\"}}) ``` > ä¸ä»…ä»…æ˜¯ç¼–è¯‘ flagsï¼Œå¯¹ add_ldflags ç­‰é“¾æ¥ flagsï¼Œä¹Ÿæ˜¯åŒæ ·ç”Ÿæ•ˆçš„ã€‚ ## target:add_mflags ### æ·»åŠ  objc ç¼–è¯‘é€‰é¡¹ ä»…å¯¹ objc ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ ```lua add_mflags(\" g\", \" O2\", \" DDEBUG\") ``` å¯ä»¥é€šè¿‡ force å‚æ•°æ¥å¼ºåˆ¶ç¦ç”¨ flags çš„è‡ªåŠ¨æ£€æµ‹ï¼Œç›´æ¥ä¼ å…¥ç¼–è¯‘å™¨ï¼Œå“ªæ€•ç¼–è¯‘å™¨æœ‰å¯èƒ½ä¸æ”¯æŒï¼Œä¹Ÿä¼šè®¾ç½®ï¼š ```lua add_mflags(\" g\", \" O2\", {force true}) ``` ## target:add_mxflags ### æ·»åŠ  objc/objc++ ç¼–è¯‘é€‰é¡¹ åŒæ—¶å¯¹ objc/objc++ ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ ```lua add_mxflags(\" framework CoreFoundation\") ``` ## target:add_mxxflags ### æ·»åŠ  objc++ ç¼–è¯‘é€‰é¡¹ ä»…å¯¹ objc++ ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ ```lua add_mxxflags(\" framework CoreFoundation\") ``` ## target:add_scflags ### æ·»åŠ  swift ç¼–è¯‘é€‰é¡¹ å¯¹ swift ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ ```lua add_scflags(\"xxx\") ``` ## target:add_asflags ### æ·»åŠ æ±‡ç¼–ç¼–è¯‘é€‰é¡¹ å¯¹æ±‡ç¼–ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ ```lua add_asflags(\"xxx\") ``` ## target:add_gcflags ### æ·»åŠ  go ç¼–è¯‘é€‰é¡¹ å¯¹ golang ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ ```lua add_gcflags(\"xxx\") ``` ## target:add_dcflags ### æ·»åŠ  dlang ç¼–è¯‘é€‰é¡¹ å¯¹ dlang ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ ```lua add_dcflags(\"xxx\") ``` ## target:add_rcflags ### æ·»åŠ  rust ç¼–è¯‘é€‰é¡¹ å¯¹ rust ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ ```lua add_rcflags(\"xxx\") ``` ## target:add_fcflags ### æ·»åŠ  fortran ç¼–è¯‘é€‰é¡¹ å¯¹ fortran ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ ```lua add_fcflags(\"xxx\") ``` ## target:add_zcflags ### æ·»åŠ  zig ç¼–è¯‘é€‰é¡¹ å¯¹ zig ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ ```lua add_zcflags(\"xxx\") ``` ## target:add_cuflags ### æ·»åŠ  cuda ç¼–è¯‘é€‰é¡¹ å¯¹ cuda ä»£ç æ·»åŠ ç¼–è¯‘é€‰é¡¹ ```lua add_cuflags(\" gencode arch compute_30,code sm_30\") ``` ## target:add_culdflags ### æ·»åŠ  cuda è®¾å¤‡é“¾æ¥é€‰é¡¹ cuda é»˜è®¤æ„å»ºä¼šä½¿ç”¨ device linkï¼Œè¿™ä¸ªé˜¶æ®µå¦‚æœè¦è®¾ç½®ä¸€äº›é“¾æ¥ flagsï¼Œåˆ™å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£æ¥è®¾ç½®ã€‚ è€Œæœ€ç»ˆçš„ç¨‹åºé“¾æ¥ï¼Œä¼šä½¿ç”¨ ldflagsï¼Œä¸ä¼šè°ƒç”¨ nvccï¼Œç›´æ¥é€šè¿‡ gcc/clang ç­‰ c/c++ é“¾æ¥å™¨æ¥é“¾æ¥ã€‚ å…³äº device link çš„è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒï¼š[https://devblogs.nvidia.com/separate compilation linking cuda device code/](https://devblogs.nvidia.com/separate compilation linking cuda device code/) ```lua add_culdflags(\" gencode arch compute_30,code sm_30\") ``` ## target:add_cugencodes ### æ·»åŠ  cuda è®¾å¤‡çš„ gencode è®¾ç½® `add_cugencodes()` æ¥å£å…¶å®å°±æ˜¯å¯¹ `add_cuflags(\" gencode arch compute_xx,code compute_xx\")` ç¼–è¯‘ flags è®¾ç½®çš„ç®€åŒ–å°è£…ï¼Œå…¶å†…éƒ¨å‚æ•°å€¼å¯¹åº”çš„å®é™… flags æ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š ```lua compute_xx > ` gencode arch compute_xx,code compute_xx` sm_xx > ` gencode arch compute_xx,code sm_xx` sm_xx,sm_yy > ` gencode arch compute_xx,code [sm_xx,sm_yy]` compute_xx,sm_yy > ` gencode arch compute_xx,code sm_yy` compute_xx,sm_yy,sm_zz > ` gencode arch compute_xx,code [sm_yy,sm_zz]` native > match the fastest cuda device on current host, eg. for a Tesla P100, ` gencode arch compute_60,code sm_60` will be added, if no available device is found, no ` gencode` flags will be added ``` ä¾‹å¦‚ï¼š ```lua add_cugencodes(\"sm_30\") ``` å°±ç­‰ä»·ä¸º ```lua add_cuflags(\" gencode arch compute_30,code sm_30\") add_culdflags(\" gencode arch compute_30,code sm_30\") ``` æ˜¯ä¸æ˜¯ä¸Šé¢çš„æ›´åŠ ç²¾ç®€äº›ï¼Œè¿™å…¶å®å°±æ˜¯ä¸ªç”¨äºç®€åŒ–è®¾ç½®çš„è¾…åŠ©æ¥å£ã€‚ è€Œå¦‚æœæˆ‘ä»¬è®¾ç½®äº† native å€¼ï¼Œé‚£ä¹ˆ xmake ä¼šè‡ªåŠ¨æ¢æµ‹å½“å‰ä¸»æœºçš„ cuda è®¾å¤‡ï¼Œç„¶åå¿«é€ŸåŒ¹é…åˆ°å®ƒå¯¹åº”çš„ gencode è®¾ç½®ï¼Œè‡ªåŠ¨è¿½åŠ åˆ°æ•´ä¸ªæ„å»ºè¿‡ç¨‹ä¸­ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬ä¸»æœºç›®å‰çš„ GPU æ˜¯ Tesla P100ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢« xmake è‡ªåŠ¨æ£€æµ‹åˆ°ï¼Œé‚£ä¹ˆä¸‹é¢çš„è®¾ç½®ï¼š ```lua add_cugencodes(\"native\") ``` ç­‰ä»·äºï¼š ```lua add_cugencodes(\"sm_60\") ``` ## target:add_ldflags ### æ·»åŠ é“¾æ¥é€‰é¡¹ æ·»åŠ é™æ€é“¾æ¥é€‰é¡¹ ```lua add_ldflags(\" L/xxx\", \" lxxx\") ``` åœ¨æ·»åŠ é“¾æ¥é€‰é¡¹æ—¶ï¼Œé»˜è®¤æ— æ³•æ”¯æŒå‚æ•°å†…æœ‰ç©ºæ ¼ï¼Œä½¿ç”¨ expand falseï¼š ```lua add_ldflags(\" L/my lib\") ERROR: Invalid arguments add_ldflags({\" L/my lib\"}, {expand false}) OK ``` ## target:add_arflags ### æ·»åŠ é™æ€åº“å½’æ¡£é€‰é¡¹ å½±å“å¯¹é™æ€åº“çš„ç”Ÿæˆ ```lua add_arflags(\"xxx\") ``` ## target:add_shflags ### æ·»åŠ åŠ¨æ€åº“é“¾æ¥é€‰é¡¹ å½±å“å¯¹åŠ¨æ€åº“çš„ç”Ÿæˆ ```lua add_shflags(\"xxx\") ``` ## target:add_options ### æ·»åŠ å…³è”é€‰é¡¹ è¿™ä¸ªæ¥å£è·Ÿ [set_options](#targetset_options) ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ï¼Œæ­¤å¤„æ˜¯è¿½åŠ é€‰é¡¹ï¼Œè€Œ [set_options](#targetset_options) æ¯æ¬¡è®¾ç½®ä¼šè¦†ç›–å…ˆå‰çš„è®¾ç½®ã€‚ ## target:add_packages ### æ·»åŠ åŒ…ä¾èµ– åœ¨ target ä½œç”¨åŸŸä¸­ï¼Œæ·»åŠ é›†æˆåŒ…ä¾èµ–ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() add_packages(\"zlib\", \"polarssl\", \"pcre\", \"mysql\") end) ``` è¿™æ ·ï¼Œåœ¨ç¼–è¯‘ test ç›®æ ‡æ—¶ï¼Œå¦‚æœè¿™ä¸ªåŒ…å­˜åœ¨çš„ï¼Œå°†ä¼šè‡ªåŠ¨è¿½åŠ åŒ…é‡Œé¢çš„å®å®šä¹‰ã€å¤´æ–‡ä»¶æœç´¢è·¯å¾„ã€é“¾æ¥åº“ç›®å½•ï¼Œä¹Ÿä¼šè‡ªåŠ¨é“¾æ¥åŒ…ä¸­æ‰€æœ‰åº“ã€‚ ç”¨æˆ·ä¸å†éœ€è¦è‡ªå·±å•ç‹¬è°ƒç”¨ [add_links](#targetadd_links)ï¼Œ[add_includedirs](#targetadd_includedirs), [add_ldflags](#targetadd_ldflags) ç­‰æ¥å£ï¼Œæ¥é…ç½®ä¾èµ–åº“é“¾æ¥äº†ã€‚ å¯¹äºå¦‚ä½•è®¾ç½®åŒ…æœç´¢ç›®å½•ï¼Œå¯å‚è€ƒï¼š[add_packagedirs](/zh cn/manual/global_interfaces?id add_packagedirs) æ¥å£ æ­¤æ¥å£ä¹ŸåŒæ—¶æ”¯æŒè¿œç¨‹ä¾èµ–åŒ…ç®¡ç†ä¸­ [add_requires](/zh cn/manual/global_interfaces?id add_requires) å®šä¹‰çš„åŒ…ã€‚ ```lua add_requires(\"zlib\", \"polarssl\") target(\"test\", function() add_packages(\"zlib\", \"polarssl\") end) ``` è¿˜æ”¯æŒè¦†å†™å†…ç½®çš„ linksï¼Œæ§åˆ¶å®é™…é“¾æ¥çš„åº“ï¼š ```lua é»˜è®¤ä¼šæœ‰ ncurses, panel, form ç­‰ links add_requires(\"ncurses\") target(\"test\", function() æ˜¾ç¤ºæŒ‡å®šï¼Œåªä½¿ç”¨ ncurses ä¸€ä¸ªé“¾æ¥åº“ add_packages(\"ncurses\", {links \"ncurses\"}) end) ``` æˆ–è€…å¹²è„†ç¦ç”¨ linksï¼Œåªä½¿ç”¨å¤´æ–‡ä»¶ï¼š ```lua add_requires(\"lua\") target(\"test\", function() add_packages(\"lua\", {links {}}) end) ``` ## target:add_languages ### æ·»åŠ è¯­è¨€æ ‡å‡† ä¸ [set_languages](#targetset_languages) ç±»ä¼¼ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯è¿™ä¸ªæ¥å£ä¸ä¼šè¦†ç›–æ‰ä¹‹å‰çš„è®¾ç½®ï¼Œè€Œæ˜¯è¿½åŠ è®¾ç½®ã€‚ ## target:add_vectorexts ### æ·»åŠ å‘é‡æ‰©å±•æŒ‡ä»¤ æ·»åŠ æ‰©å±•æŒ‡ä»¤ä¼˜åŒ–é€‰é¡¹ï¼Œç›®å‰æ”¯æŒä»¥ä¸‹å‡ ç§æ‰©å±•æŒ‡ä»¤é›†ï¼š ```lua add_vectorexts(\"mmx\") add_vectorexts(\"neon\") add_vectorexts(\"avx\", \"avx2\", \"avx512\") add_vectorexts(\"sse\", \"sse2\", \"sse3\", \"ssse3\", \"sse4.2\") ``` > å¦‚æœå½“å‰è®¾ç½®çš„æŒ‡ä»¤é›†ç¼–è¯‘å™¨ä¸æ”¯æŒï¼Œxmake ä¼šè‡ªåŠ¨å¿½ç•¥æ‰ï¼Œæ‰€ä»¥ä¸éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å»åˆ¤æ–­ç»´æŠ¤ï¼Œåªéœ€è¦å°†ä½ éœ€è¦çš„æŒ‡ä»¤é›†å…¨éƒ¨è®¾ç½®ä¸Šå°±è¡Œäº†ã€‚ xmake æ–°å¢äº†ä¸€ä¸ª `all` é…ç½®é¡¹ï¼Œå¯ä»¥ç”¨äºå°½å¯èƒ½çš„å¼€å¯æ‰€æœ‰æ‰©å±•æŒ‡ä»¤ä¼˜åŒ–ã€‚ ```lua add_vectorexts(\"all\") ``` ## target:add_frameworks ### æ·»åŠ é“¾æ¥æ¡†æ¶ ç›®å‰ä¸»è¦ç”¨äº `ios` å’Œ `macosx` å¹³å°çš„ `objc` å’Œ `swift` ç¨‹åºï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() add_frameworks(\"Foundation\", \"CoreFoundation\") end) ``` å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ [add_mxflags](#targetadd_mxflags) å’Œ[add_ldflags](#targetadd_ldflags)æ¥è®¾ç½®ï¼Œä¸è¿‡æ¯”è¾ƒç¹çï¼Œä¸å»ºè®®è¿™æ ·è®¾ç½®ã€‚ ```lua target(\"test\", function() add_mxflags(\" framework Foundation\", \" framework CoreFoundation\") add_ldflags(\" framework Foundation\", \" framework CoreFoundation\") end) ``` å¦‚æœä¸æ˜¯è¿™ä¸¤ä¸ªå¹³å°ï¼Œè¿™äº›è®¾ç½®å°†ä¼šè¢«å¿½ç•¥ã€‚ ## target:add_frameworkdirs ### æ·»åŠ é“¾æ¥æ¡†æ¶æœç´¢ç›®å½• å¯¹äºä¸€äº›ç¬¬ä¸‰æ–¹ frameworkï¼Œé‚£ä¹ˆä»…ä»…é€šè¿‡ [add_frameworks](#targetadd_frameworks) æ˜¯æ²¡æ³•æ‰¾åˆ°çš„ï¼Œè¿˜éœ€è¦é€šè¿‡è¿™ä¸ªæ¥å£æ¥æ·»åŠ æœç´¢ç›®å½•ã€‚ ```lua target(\"test\", function() add_frameworks(\"MyFramework\") add_frameworkdirs(\"/tmp/frameworkdir\", \"/tmp/frameworkdir2\") end) ``` ## target:set_toolset ### è®¾ç½®å·¥å…·é›† é’ˆå¯¹ç‰¹å®š target å•ç‹¬è®¾ç½®åˆ‡æ¢æŸä¸ªç¼–è¯‘å™¨ï¼Œé“¾æ¥å™¨ï¼Œä¸è¿‡æˆ‘ä»¬æ›´æ¨èä½¿ç”¨ [set_toolchains](#targetset_toolchains) å¯¹æŸä¸ª target è¿›è¡Œæ•´ä½“å·¥å…·é“¾çš„åˆ‡æ¢ã€‚ ä¸ set_toolchains ç›¸æ¯”ï¼Œæ­¤æ¥å£åªåˆ‡æ¢å·¥å…·é“¾æŸä¸ªç‰¹å®šçš„ç¼–è¯‘å™¨æˆ–è€…é“¾æ¥å™¨ã€‚ å¯¹äº `add_files(\"*.c\")` æ·»åŠ çš„æºç æ–‡ä»¶ï¼Œé»˜è®¤éƒ½æ˜¯ä¼šè°ƒç”¨ç³»ç»Ÿæœ€åŒ¹é…çš„ç¼–è¯‘å·¥å…·å»ç¼–è¯‘ï¼Œæˆ–è€…é€šè¿‡ `xmake f cc clang` å‘½ä»¤æ‰‹åŠ¨å»ä¿®æ”¹ï¼Œä¸è¿‡è¿™äº›éƒ½æ˜¯å…¨å±€å½±å“æ‰€æœ‰ target ç›®æ ‡çš„ã€‚ å¦‚æœæœ‰äº›ç‰¹æ®Šéœ€æ±‚ï¼Œéœ€è¦å¯¹å½“å‰å·¥ç¨‹ä¸‹æŸä¸ªç‰¹å®šçš„ target ç›®æ ‡å•ç‹¬æŒ‡å®šä¸åŒçš„ç¼–è¯‘å™¨ã€é“¾æ¥å™¨æˆ–è€…ç‰¹å®šç‰ˆæœ¬çš„ç¼–è¯‘å™¨ï¼Œè¿™ä¸ªæ—¶å€™æ­¤æ¥å£å°±å¯ä»¥æ’ä¸Šç”¨é€”äº†ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test1\", function() add_files(\"*.c\") end) target(\"test2\", function() add_files(\"*.c\") set_toolset(\"cc\", \"$(projectdir)/tools/bin/clang 5.0\") end) ``` ä¸Šè¿°æè¿°ä»…å¯¹ test2 ç›®æ ‡çš„ç¼–è¯‘å™¨è¿›è¡Œç‰¹æ®Šè®¾ç½®ï¼Œä½¿ç”¨ç‰¹å®šçš„ clang 5.0 ç¼–è¯‘å™¨æ¥ç¼–è¯‘ test2ï¼Œè€Œ test1 è¿˜æ˜¯ä½¿ç”¨é»˜è®¤è®¾ç½®ã€‚ <p class \"tip\"> æ¯æ¬¡è®¾ç½®éƒ½ä¼šè¦†ç›–å½“å‰ target ç›®æ ‡ä¸‹ä¹‹å‰çš„é‚£æ¬¡è®¾ç½®ï¼Œä¸åŒ target ä¹‹é—´ä¸ä¼šè¢«è¦†ç›–ï¼Œäº’ç›¸ç‹¬ç«‹ï¼Œå¦‚æœåœ¨æ ¹åŸŸè®¾ç½®ï¼Œä¼šå½±å“æ‰€æœ‰å­ targetã€‚ </p> å‰ä¸€ä¸ªå‚æ•°æ˜¯ keyï¼Œç”¨äºæŒ‡å®šå·¥å…·ç±»å‹ï¼Œç›®å‰æ”¯æŒçš„æœ‰ï¼ˆç¼–è¯‘å™¨ã€é“¾æ¥å™¨ã€å½’æ¡£å™¨ï¼‰ï¼š å·¥å…·ç±»å‹ æè¿° cc c ç¼–è¯‘å™¨ cxx c++ ç¼–è¯‘å™¨ mm objc ç¼–è¯‘å™¨ mxx objc++ ç¼–è¯‘å™¨ gc go ç¼–è¯‘å™¨ as æ±‡ç¼–å™¨ sc swift ç¼–è¯‘å™¨ rc rust ç¼–è¯‘å™¨ dc dlang ç¼–è¯‘å™¨ fc fortran ç¼–è¯‘å™¨ sc swift ç¼–è¯‘å™¨ rust rust ç¼–è¯‘å™¨ strip strip ç¨‹åº ld c/c++/asm/objc ç­‰é€šç”¨å¯æ‰§è¡Œç¨‹åºé“¾æ¥å™¨ sh c/c++/asm/objc ç­‰é€šç”¨åŠ¨æ€åº“é“¾æ¥å™¨ ar c/c++/asm/objc ç­‰é€šç”¨é™æ€åº“å½’æ¡£å™¨ dcld dlang å¯æ‰§è¡Œé“¾æ¥å™¨, rcld/gcld ç­‰ç±»ä¼¼ dcsh dlang åŠ¨æ€åº“é“¾æ¥å™¨, rcsh/gcsh ç­‰ç±»ä¼¼ å¯¹äºä¸€äº›ç¼–è¯‘å™¨æ–‡ä»¶åä¸è§„åˆ™ï¼Œå¯¼è‡´ xmake æ— æ³•æ­£å¸¸è¯†åˆ«å¤„ç†ä¸ºå·²çŸ¥çš„ç¼–è¯‘å™¨åçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åŠ ä¸€ä¸ªå·¥å…·åæç¤ºï¼Œä¾‹å¦‚ï¼š ```lua set_toolset(\"cc\", \"gcc@$(projectdir)/tools/bin/mipscc.exe\") ``` ä¸Šè¿°æè¿°è®¾ç½® mipscc.exe ä½œä¸º c ç¼–è¯‘å™¨ï¼Œå¹¶ä¸”æç¤º xmake ä½œä¸º gcc çš„ä¼ å‚å¤„ç†æ–¹å¼è¿›è¡Œç¼–è¯‘ã€‚ ## target:set_toolchains ### è®¾ç½®å·¥å…·é“¾ è¿™å¯¹æŸä¸ªç‰¹å®šçš„ target å•ç‹¬åˆ‡æ¢è®¾ç½®ä¸åŒçš„å·¥å…·é“¾ï¼Œå’Œ set_toolset ä¸åŒçš„æ˜¯ï¼Œæ­¤æ¥å£æ˜¯å¯¹å®Œæ•´å·¥å…·é“¾çš„æ•´ä½“åˆ‡æ¢ï¼Œæ¯”å¦‚ cc/ld/sh ç­‰ä¸€ç³»åˆ—å·¥å…·é›†ã€‚ è¿™ä¹Ÿæ˜¯æ¨èåšæ³•ï¼Œå› ä¸ºåƒ gcc/clang ç­‰å¤§éƒ¨åˆ†ç¼–è¯‘å·¥å…·é“¾ï¼Œç¼–è¯‘å™¨å’Œé“¾æ¥å™¨éƒ½æ˜¯é…å¥—ä½¿ç”¨çš„ï¼Œè¦åˆ‡å°±å¾—æ•´ä½“åˆ‡ï¼Œå•ç‹¬é›¶æ•£çš„åˆ‡æ¢è®¾ç½®ä¼šå¾ˆç¹çã€‚ æ¯”å¦‚æˆ‘ä»¬åˆ‡æ¢ test ç›®æ ‡åˆ° clang+yasm ä¸¤ä¸ªå·¥å…·é“¾ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") set_toolchains(\"clang\", \"yasm\") end) ``` åªéœ€è¦æŒ‡å®šå·¥å…·é“¾åå­—å³å¯ï¼Œå…·ä½“ xmake æ”¯æŒå“ªäº›å·¥å…·é“¾ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š ```bash $ xmake show l toolchains xcode Xcode IDE vs VisualStudio IDE yasm The Yasm Modular Assembler clang A C language family frontend for LLVM go Go Programming Language Compiler dlang D Programming Language Compiler sdcc Small Device C Compiler cuda CUDA Toolkit ndk Android NDK rust Rust Programming Language Compiler llvm A collection of modular and reusable compiler and toolchain technologies cross Common cross compilation toolchain nasm NASM Assembler gcc GNU Compiler Collection mingw Minimalist GNU for Windows gnu rm GNU Arm Embedded Toolchain envs Environment variables toolchain fasm Flat Assembler ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå…¨å±€åˆ‡æ¢åˆ°å…¶ä»–å·¥å…·é“¾ï¼š ```bash $ xmake f toolchain clang $ xmake ``` å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ xmake.lua ä¸­è‡ªå®šä¹‰ toolchainï¼Œç„¶åé€šè¿‡ `set_toolchains` æŒ‡å®šè¿›å»ï¼Œä¾‹å¦‚ï¼š ```lua toolchain(\"myclang\", function() set_kind(\"standalone\") set_toolset(\"cc\", \"clang\") set_toolset(\"cxx\", \"clang\", \"clang++\") set_toolset(\"ld\", \"clang++\", \"clang\") set_toolset(\"sh\", \"clang++\", \"clang\") set_toolset(\"ar\", \"ar\") set_toolset(\"ex\", \"ar\") set_toolset(\"strip\", \"strip\") set_toolset(\"mm\", \"clang\") set_toolset(\"mxx\", \"clang\", \"clang++\") set_toolset(\"as\", \"clang\") ... end) ``` å…³äºè¿™å—çš„è¯¦æƒ…ä»‹ç»ï¼Œå¯ä»¥åˆ° [è‡ªå®šä¹‰å·¥å…·é“¾](/zh cn/manual/custom_toolchain) ç« èŠ‚æŸ¥çœ‹ æ›´å¤šè¯¦æƒ…è§ï¼š[#780](https://github.com/xmake io/xmake/issues/780) æ”¯æŒå¯¹ toolchains å¹³å°å’Œæ¶æ„çš„å•ç‹¬è®¾ç½®å’Œåˆ‡æ¢ï¼Œæ¯”å¦‚ï¼š ```lua target(\"test\", function() set_toolchains(\"xcode\", {plat os.host(), arch os.arch()}) end) ``` å¦‚æœå½“å‰æ˜¯åœ¨äº¤å‰ç¼–è¯‘æ¨¡å¼ï¼Œé‚£ä¹ˆè¿™ä¸ª test è¿˜æ˜¯ä¼šå¼ºåˆ¶åˆ‡åˆ° xcode çš„æœ¬åœ°ç¼–è¯‘å·¥å…·é“¾å’Œå¯¹åº”çš„ pc å¹³å°ä¸Šå»ï¼Œè¿™å¯¹äºæƒ³è¦åŒæ—¶æ”¯æŒéƒ¨åˆ† target ä½¿ç”¨ä¸»æœºå·¥å…·é“¾ï¼Œéƒ¨åˆ† target ä½¿ç”¨äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ—¶å€™ï¼Œéå¸¸æœ‰ç”¨ã€‚ ä½†æ˜¯ï¼Œè¿™è¿˜ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿ï¼Œå°¤å…¶æ˜¯è·¨å¹³å°ç¼–è¯‘æ—¶å€™ï¼Œä¸åŒå¹³å°çš„ pc å·¥å…·é“¾éƒ½æ˜¯ä¸åŒçš„ï¼Œæœ‰ msvc, xcode, clang ç­‰ï¼Œè¿˜éœ€è¦åˆ¤æ–­å¹³å°æ¥æŒ‡å®šã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ [set_plat](#targetset_plat) å’Œ[set_arch](#targetset_arch)æ¥å£ï¼Œç›´æ¥è®¾ç½®ç‰¹å®š target åˆ°ä¸»æœºå¹³å°ï¼Œå°±å¯ä»¥å†…éƒ¨è‡ªåŠ¨é€‰æ‹© host å·¥å…·é“¾äº†ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() set_plat(os.host()) set_arch(os.arch()) end) ``` è¿™å—çš„åº”ç”¨åœºæ™¯å’Œ example å¯ä»¥çœ‹ä¸‹ï¼š[https://github.com/xmake io/xmake repo/blob/dev/packages/l/luajit/port/xmake.lua](https://github.com/xmake io/xmake repo/blob/dev/packages/l/luajit/port/xmake.lua) luajit é‡Œé¢å°±éœ€è¦åŒæ—¶ç¼–è¯‘ host å¹³å°çš„ minilua/buildvm æ¥ç”Ÿæˆ jit ç›¸å…³ä»£ç ï¼Œç„¶åå¼€å§‹é’ˆå¯¹æ€§ç¼–è¯‘ luajit è‡ªèº«åˆ°ä¸åŒçš„äº¤å‰å·¥å…·é“¾ã€‚ å…³äºè¿™å—è¯¦æƒ…ï¼Œå¯ä»¥å‚è€ƒï¼š[https://github.com/xmake io/xmake/pull/857](https://github.com/xmake io/xmake/pull/857) xmake å¯¹ set_toolchains åšäº†è¿›ä¸€æ­¥çš„æ”¹è¿›ï¼Œæ›´å¥½åœ°å¯¹ç‰¹å®š target æ”¯æŒç‹¬ç«‹å·¥å…·é“¾åˆ‡æ¢ï¼Œæ¯”å¦‚ä¸åŒ target æ”¯æŒåˆ‡æ¢åˆ°ä¸åŒçš„ vs ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() set_toolchains(\"msvc\", {vs \"2015\"}) end) ``` é»˜è®¤ xmake ä¼šä½¿ç”¨å…¨å±€ vs å·¥å…·é“¾ï¼Œæ¯”å¦‚å½“å‰æ£€æµ‹åˆ° vs2019ï¼Œä½†æ˜¯ç”¨æˆ·åŒæ—¶è¿˜å®‰è£…äº† vs2015ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ä¸Šé¢çš„é…ç½®å°† test ç›®æ ‡åˆ‡æ¢åˆ° vs2015 æ¥ç¼–è¯‘ã€‚ ç”šè‡³è¿˜å¯ä»¥é…åˆ `set_arch` æ¥æŒ‡å®šç‰¹å®šçš„æ¶æ„åˆ° x86ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ x64ã€‚ ```lua target(\"test\", function() set_arch(\"x86\") set_toolchains(\"msvc\", {vs \"2015\"}) end) ``` ä¸Šé¢çš„æ•ˆæœè·Ÿ `set_toolchains(\"msvc\", {vs \"2015\", arch \"x86\"})` ç±»ä¼¼ï¼Œä¸è¿‡ `set_arch` æ˜¯é’ˆå¯¹ target ç²’åº¦çš„ï¼Œè€Œ `set_toolchains` é‡Œé¢çš„ arch è®¾ç½®ä»…ä»…é’ˆå¯¹ç‰¹å®šå·¥å…·é“¾ç²’åº¦ã€‚ é€šå¸¸ï¼Œæˆ‘ä»¬æ›´æ¨èä½¿ç”¨ `set_arch` æ¥å¯¹æ•´ä¸ª target å®ç°æ¶æ„åˆ‡æ¢ã€‚ ## target:set_plat ### è®¾ç½®æŒ‡å®šç›®æ ‡çš„ç¼–è¯‘å¹³å° é€šå¸¸é…åˆ [set_arch](#targetset_arch) ä½¿ç”¨ï¼Œå°†æŒ‡å®š target çš„ç¼–è¯‘å¹³å°åˆ‡æ¢åˆ°æŒ‡å®šå¹³å°ï¼Œxmake ä¼šè‡ªåŠ¨æ ¹æ®åˆ‡æ¢çš„å¹³å°ï¼Œé€‰æ‹©åˆé€‚çš„å·¥å…·é“¾ã€‚ ä¸€èˆ¬ç”¨äºéœ€è¦åŒæ—¶ç¼–è¯‘ host å¹³å°ç›®æ ‡ã€äº¤å‰ç¼–è¯‘ç›®æ ‡çš„åœºæ™¯ï¼Œæ›´å¤šè¯¦æƒ…è§ï¼š[set_toolchains](#targetset_toolchains) ä¾‹å¦‚ï¼š ```console $ xmake f p android ndk /xxx ``` å³ä½¿æ­£åœ¨ä½¿ç”¨ android ndk ç¼–è¯‘ android å¹³å°ç›®æ ‡ï¼Œä½†æ˜¯å…¶ä¾èµ–çš„ host ç›®æ ‡ï¼Œè¿˜æ˜¯ä¼šåˆ‡æ¢åˆ°ä¸»æœºå¹³å°ï¼Œä½¿ç”¨ xcode, msvc ç­‰ host å·¥å…·é“¾æ¥ç¼–è¯‘ã€‚ ```lua target(\"host\", function() set_kind(\"binary\") set_plat(os.host()) set_arch(os.arch()) add_files(\"src/host/*.c\") end) target(\"test\", function() set_kind(\"binary\") add_deps(\"host\") add_files(\"src/test/*.c\") end) ``` ## target:set_arch ### è®¾ç½®æŒ‡å®šç›®æ ‡çš„ç¼–è¯‘æ¶æ„ è¯¦æƒ…è§ï¼š[set_plat](#targetset_plat) ## target:set_values ### è®¾ç½®ä¸€äº›æ‰©å±•é…ç½®å€¼ ç»™ target è®¾ç½®ä¸€äº›æ‰©å±•çš„é…ç½®å€¼ï¼Œè¿™äº›é…ç½®æ²¡æœ‰åƒ `set_ldflags` è¿™ç§å†…ç½®çš„ api å¯ç”¨ï¼Œé€šè¿‡ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªé…ç½®åï¼Œæ¥æ‰©å±•é…ç½®ã€‚ ä¸€èˆ¬ç”¨äºä¼ å…¥é…ç½®å‚æ•°ç»™è‡ªå®šä¹‰ rule ä¸­çš„è„šæœ¬ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š ```lua rule(\"markdown\", function() on_build_file(function (target, sourcefile, opt) compile .markdown with flags local flags target:values(\"markdown.flags\") if flags then .. end end) end) target(\"test\", function() add_files(\"src/*.md\", {rule \"markdown\"}) set_values(\"markdown.flags\", \"xxx\", \"xxx\") end) ``` ä¸Šè¿°ä»£ç ä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼Œåœ¨ target åº”ç”¨ markdown è§„åˆ™çš„æ—¶å€™ï¼Œé€šè¿‡ set_values å»è®¾ç½®ä¸€äº› flags å€¼ï¼Œæä¾›ç»™ markdown è§„åˆ™å»å¤„ç†ã€‚ åœ¨è§„åˆ™è„šæœ¬ä¸­å¯ä»¥é€šè¿‡ `target:values(\"markdown.flags\")` è·å–åˆ° target ä¸­è®¾ç½®çš„æ‰©å±• flags å€¼ã€‚ > å…·ä½“æ‰©å±•é…ç½®åï¼Œæ ¹æ®ä¸åŒçš„ ruleï¼Œä¼šæœ‰æ‰€ä¸åŒï¼Œç›®å‰æœ‰å“ªäº›ï¼Œå¯ä»¥å‚è€ƒç›¸å…³è§„åˆ™çš„æè¿°ï¼š[å†…å»ºè§„åˆ™](/zh cn/manual/custom_rule?id å†…å»ºè§„åˆ™) ä¸‹é¢æ˜¯ä¸€äº› xmake ç›®å‰æ”¯æŒçš„ä¸€äº›å†…ç½®çš„æ‰©å±•é…ç½®é¡¹åˆ—è¡¨ã€‚ æ‰©å±•é…ç½®å é…ç½®æè¿° fortran.moduledir è®¾ç½® fortran æ¨¡å—çš„è¾“å‡ºç›®å½• ndk.arm_mode è®¾ç½® ndk çš„ arm ç¼–è¯‘æ¨¡å¼ï¼ˆarm/thumbï¼‰ objc.build.arc è®¾ç½®å¯ç”¨æˆ–ç¦ç”¨ objc çš„ arc objc++.build.arc è®¾ç½®å¯ç”¨æˆ–ç¦ç”¨ objc++ çš„ arc xcode.bundle_identifier è®¾ç½® xcode å·¥å…·é“¾çš„ Bundle Identifier xcode.mobile_provision è®¾ç½® xcode å·¥å…·é“¾çš„è¯ä¹¦ä¿¡æ¯ xcode.codesign_identity è®¾ç½® xcode å·¥å…·é“¾çš„ä»£ç ç­¾åæ ‡è¯† wasm.preloadfiles è®¾ç½® wasm æ‰“åŒ…çš„é¢„åŠ è½½æ–‡ä»¶ï¼ˆpreload fileï¼‰ wdk.env.winver è®¾ç½® wdk çš„ win æ”¯æŒç‰ˆæœ¬ wdk.umdf.sdkver è®¾ç½® wdk çš„ umdf sdk ç‰ˆæœ¬ wdk.kmdf.sdkver è®¾ç½® wdk çš„ kmdf sdk ç‰ˆæœ¬ wdk.sign.mode è®¾ç½® wdk çš„ä»£ç ç­¾åæ¨¡å¼ wdk.sign.store è®¾ç½® wdk çš„ä»£ç ç­¾å store wdk.sign.certfile è®¾ç½® wdk çš„ä»£ç ç­¾åè¯ä¹¦æ–‡ä»¶ wdk.sign.thumbprint è®¾ç½® wdk çš„ä»£ç ç­¾åæŒ‡çº¹ ## target:add_values ### æ·»åŠ ä¸€äº›æ‰©å±•é…ç½®å€¼ ç”¨æ³•è·Ÿ [target:set_values](#targetset_values) ç±»ä¼¼ï¼ŒåŒºåˆ«å°±æ˜¯è¿™ä¸ªæ¥å£æ˜¯è¿½åŠ è®¾ç½®ï¼Œè€Œä¸ä¼šæ¯æ¬¡è¦†ç›–è®¾ç½®ã€‚ ## target:set_rundir ### è®¾ç½®è¿è¡Œç›®å½• æ­¤æ¥å£ç”¨äºè®¾ç½®é»˜è®¤è¿è¡Œ target ç¨‹åºçš„å½“å‰è¿è¡Œç›®å½•ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œtarget æ˜¯åœ¨å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨ç›®å½•åŠ è½½è¿è¡Œã€‚ å¦‚æœç”¨æˆ·æƒ³è¦ä¿®æ”¹åŠ è½½ç›®å½•ï¼Œä¸€ç§æ˜¯é€šè¿‡ `on_run()` çš„æ–¹å¼è‡ªå®šä¹‰è¿è¡Œé€»è¾‘ï¼Œé‡Œé¢å»åšåˆ‡æ¢ï¼Œä½†ä»…ä»…ä¸ºäº†åˆ‡ä¸ªç›®å½•å°±è¿™ä¹ˆåšï¼Œå¤ªè¿‡ç¹çã€‚ å› æ­¤å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å£å¿«é€Ÿçš„å¯¹é»˜è®¤æ‰§è¡Œçš„ç›®å½•ç¯å¢ƒåšè®¾ç½®åˆ‡æ¢ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") set_rundir(\"$(projectdir)/xxx\") end) ``` ## target:set_runargs ### è®¾ç½®è¿è¡Œå‚æ•°åˆ—è¡¨ 2.6.9 æ–°å¢æ¥å£ï¼Œå¯ç”¨äºè®¾ç½® `xmake run` çš„é»˜è®¤è¿è¡Œå‚æ•°ï¼Œé€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥é¿å…æ¯æ¬¡å‘½ä»¤è¡Œè¾“å…¥è¿è¡Œå‚æ•°ï¼Œ`xmake run x arg1 val` ```lua set_runargs(\" x\", \" arg1 val\") ``` ## target:add_runenvs ### æ·»åŠ è¿è¡Œç¯å¢ƒå˜é‡ æ­¤æ¥å£ç”¨äºæ·»åŠ è®¾ç½®é»˜è®¤è¿è¡Œ target ç¨‹åºçš„ç¯å¢ƒå˜é‡ï¼Œè·Ÿ [set_runenv](#targetset_runenv) ä¸åŒçš„æ˜¯ï¼Œæ­¤æ¥å£æ˜¯å¯¹å·²æœ‰ç³»ç»Ÿ env ä¸­çš„å€¼è¿›è¡Œè¿½åŠ ï¼Œå¹¶ä¸ä¼šè¦†ç›–ã€‚ æ‰€ä»¥ï¼Œå¯¹äº PATH è¿™ç§ï¼Œé€šè¿‡æ­¤æ¥å£è¿½åŠ å€¼æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œè€Œä¸”æ­¤æ¥å£æ”¯æŒå¤šå€¼è®¾ç½®ï¼Œæ‰€ä»¥é€šå¸¸å°±æ˜¯ç”¨æ¥è®¾ç½®å¸¦æœ‰ path sep çš„å¤šå€¼ envã€‚ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") add_runenvs(\"PATH\", \"/tmp/bin\", \"xxx/bin\") add_runenvs(\"LD_LIBRARY_PATH\", \"/tmp/lib\", \"xxx/lib\") end) ``` ## target:set_runenv ### è®¾ç½®è¿è¡Œç¯å¢ƒå˜é‡ æ­¤æ¥å£è·Ÿ [add_runenvs](#targetadd_runenvs) ä¸åŒçš„æ˜¯ï¼Œ`set_runenv` æ˜¯å¯¹æŸä¸ªç¯å¢ƒå˜é‡çš„è¦†ç›–è®¾ç½®ï¼Œä¼šè¦†ç›–åŸæœ‰ç³»ç»Ÿç¯å¢ƒçš„ env å€¼ï¼Œå¹¶ä¸”æ­¤æ¥å£æ˜¯å•æ•°è®¾ç½®ï¼Œä¸èƒ½ä¼ é€’å¤šå‚ã€‚ æ‰€ä»¥ï¼Œå¦‚æœè¦è¦†ç›–è®¾ç½® PATH è¿™ä¸­å¤šè·¯å¾„çš„ envï¼Œéœ€è¦è‡ªå·±å»æ‹¼æ¥ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") set_runenv(\"PATH\", path.joinenv(\"/tmp/bin\", \"xxx/bin\")) set_runenv(\"NAME\", \"value\") end) ``` ## target:set_installdir ### è®¾ç½®å®‰è£…ç›®å½• 2.2.5 ç‰ˆæœ¬æ–°å¢æ¥å£ï¼Œç”¨äºé’ˆå¯¹æ¯ä¸ª target è®¾ç½®ä¸åŒçš„é»˜è®¤å®‰è£…ç›®å½•ï¼Œä¸€èˆ¬ç”¨äº `xmake install/uninstall` å‘½ä»¤ã€‚ é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œ `xmake install` ä¼šå®‰è£…åˆ°ç³»ç»Ÿ `/usr/local` ç›®å½•ï¼Œæˆ‘ä»¬é™¤äº†å¯ä»¥é€šè¿‡ `xmake install o /usr/local` æŒ‡å®šå…¶ä»–å®‰è£…ç›®å½•å¤–ï¼Œ è¿˜å¯ä»¥åœ¨ xmake.lua ä¸­é’ˆå¯¹ target è®¾ç½®ä¸åŒçš„å®‰è£…ç›®å½•æ¥æ›¿ä»£é»˜è®¤ç›®å½•ã€‚ é™¤äº†ä¸Šè¿°ä¸¤ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `INSTALLDIR` å’Œ `DESTDIR` ç¯å¢ƒå˜é‡è®¾ç½®é»˜è®¤çš„å®‰è£…ç›®å½•ã€‚ ## target:set_prefixdir ### è®¾ç½®å®‰è£…å‰ç½®å­ç›®å½• å°½ç®¡é€šè¿‡ `set_installdir` å’Œ `xmake install o [installdir]` è®¾ç½®äº†å®‰è£…æ ¹ç›®å½•ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¿˜æƒ³è¿›ä¸€æ­¥è°ƒæ•´ bin, lib å’Œ include çš„å­è·¯å¾„ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥å£ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®‰è£…ç›®å½•ä¼šæŒ‰ç…§è¿™ä¸ªç»“æ„ï¼š ```bash installdir bin lib include ``` å¦‚æœæˆ‘ä»¬é…ç½®ï¼š ```lua set_prefix(\"prefixdir\") ``` å°±æ˜¯å¢åŠ ä¸€ä¸ªæ€»çš„å­ç›®å½•ï¼š ```bash installdir prefixdir bin lib include ``` æˆ‘ä»¬è¿˜å¯ä»¥å•ç‹¬é…ç½® bin, lib å’Œ include å­ç›®å½•ï¼Œä¾‹å¦‚ï¼š ```lua set_prefix(\"prefixdir\", {bindir \"mybin\", libdir \"mylib\", includedir \"myinc\"}) ``` ```bash installdir prefixdir mybin mylib myinc ``` å¦‚æœï¼Œæˆ‘ä»¬ä¸é…ç½® prefixdirï¼Œä»…ä»…ä¿®æ”¹ bin å­ç›®å½•ï¼Œå¯ä»¥å°† prefixdir é…ç½®æˆ `/`ã€‚ ```lua set_prefix(\"/\", {bindir \"mybin\", libdir \"mylib\", includedir \"myinc\"}) ``` ```bash installdir mybin mylib myinc ``` ## target:add_installfiles ### æ·»åŠ å®‰è£…æ–‡ä»¶ 2.2.5 ç‰ˆæœ¬æ–°å¢æ¥å£ï¼Œç”¨äºé’ˆå¯¹æ¯ä¸ª target è®¾ç½®å¯¹åº”éœ€è¦å®‰è£…çš„æ–‡ä»¶ï¼Œä¸€èˆ¬ç”¨äº `xmake install/uninstall` å‘½ä»¤ã€‚ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥æŒ‡å®šå®‰è£…å„ç§ç±»å‹çš„æ–‡ä»¶åˆ°å®‰è£…ç›®å½•ï¼š ```lua target(\"test\", function() add_installfiles(\"src/*.h\") add_installfiles(\"doc/*.md\") end) ``` é»˜è®¤åœ¨ linux ç­‰ç³»ç»Ÿä¸Šï¼Œæˆ‘ä»¬ä¼šå®‰è£…åˆ° `/usr/local/*.h, /usr/local/*.md`ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šå®‰è£…åˆ°ç‰¹å®šå­ç›®å½•ï¼š ```lua target(\"test\", function() add_installfiles(\"src/*.h\", {prefixdir \"include\"}) add_installfiles(\"doc/*.md\", {prefixdir \"share/doc\"}) end) ``` ä¸Šé¢çš„è®¾ç½®ï¼Œæˆ‘ä»¬ä¼šå®‰è£…åˆ° `/usr/local/include/*.h, /usr/local/share/doc/*.md` æ³¨ï¼šé»˜è®¤å®‰è£…ä¸ä¼šä¿ç•™ç›®å½•ç»“æ„ï¼Œä¼šå®Œå…¨å±•å¼€ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `()` å»æå–æºæ–‡ä»¶ä¸­çš„å­ç›®å½•ç»“æ„æ¥å®‰è£…ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() add_installfiles(\"src/(tbox/*.h)\", {prefixdir \"include\"}) add_installfiles(\"doc/(tbox/*.md)\", {prefixdir \"share/doc\"}) end) ``` æˆ‘ä»¬æŠŠ `src/tbox/*.h` ä¸­çš„æ–‡ä»¶ï¼Œæå– `tbox/*.h` å­ç›®å½•ç»“æ„åï¼Œåœ¨è¿›è¡Œå®‰è£…ï¼š`/usr/local/include/tbox/*.h, /usr/local/share/doc/tbox/*.md` å½“ç„¶ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡ [set_installdir](#targetset_installdir) æ¥å£ï¼Œæ¥é…åˆä½¿ç”¨ã€‚ å…³äºæ­¤æ¥å£çš„è¯¦ç»†è¯´æ˜ï¼Œè§ï¼š[https://github.com/xmake io/xmake/issues/318](https://github.com/xmake io/xmake/issues/318) ## target:add_headerfiles ### æ·»åŠ å®‰è£…å¤´æ–‡ä»¶ 2.2.5 ç‰ˆæœ¬æ–°å¢æ¥å£ï¼Œç”¨äºé’ˆå¯¹æ¯ä¸ª target è®¾ç½®å¯¹åº”éœ€è¦å®‰è£…çš„å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬ç”¨äº `xmake install/uninstall` å‘½ä»¤ã€‚ æ­¤æ¥å£ä½¿ç”¨æ–¹å¼è·Ÿ [add_installfiles](#targetadd_installfiles) æ¥å£å‡ ä¹å®Œå…¨ä¸€æ ·ï¼Œéƒ½å¯ä»¥ç”¨æ¥æ·»åŠ å®‰è£…æ–‡ä»¶ï¼Œä¸è¿‡æ­¤æ¥å£ä»…ç”¨äºå®‰è£…å¤´æ–‡ä»¶ã€‚ å› æ­¤ï¼Œä½¿ç”¨ä¸Šæ¯” `add_installfiles` ç®€åŒ–äº†ä¸å°‘ï¼Œé»˜è®¤ä¸è®¾ç½® prefixdirï¼Œä¹Ÿä¼šè‡ªåŠ¨å°†å¤´æ–‡ä»¶å®‰è£…åˆ°å¯¹åº”çš„ `include` å­ç›®å½•ä¸­ã€‚ å¹¶ä¸”æ­¤æ¥å£å¯¹äº `xmake project k vs201x` ç­‰æ’ä»¶ç”Ÿæˆçš„ IDE æ–‡ä»¶ï¼Œä¹Ÿä¼šæ·»åŠ å¯¹åº”çš„å¤´æ–‡ä»¶è¿›å»ã€‚ æˆ‘æ³¨ï¼šé»˜è®¤å®‰è£…ä¸ä¼šä¿ç•™ç›®å½•ç»“æ„ï¼Œä¼šå®Œå…¨å±•å¼€ï¼Œå½“ç„¶ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `()` å»æå–æºæ–‡ä»¶ä¸­çš„å­ç›®å½•ç»“æ„æ¥å®‰è£…ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() add_headerfiles(\"src/(tbox/*.h)\", {prefixdir \"include\"}) end) ``` v2.7.1 ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `{install false}` å‚æ•°ï¼Œç¦ç”¨é»˜è®¤çš„å¤´æ–‡ä»¶å®‰è£…è¡Œä¸ºï¼Œä»…ä»…å¯¹è®¾ç½®çš„å¤´æ–‡ä»¶ç”¨äº project generator çš„æ–‡ä»¶åˆ—è¡¨å±•ç¤ºå’Œç¼–è¾‘ï¼Œä¾‹å¦‚ vs projectã€‚ ```lua add_headerfiles(\"src/foo.h\") add_headerfiles(\"src/test.h\", {install false}) ``` ä¸Šé¢ä¸¤ä¸ªå¤´æ–‡ä»¶ï¼Œåœ¨ vs å·¥ç¨‹ä¸­éƒ½ä¼šå±•ç¤ºå‡ºæ¥ï¼Œä½†æ˜¯ä»…ä»… foo.h ä¼šè¢«å‘å¸ƒå®‰è£…åˆ°ç³»ç»Ÿã€‚ ## target:set_configdir ### è®¾ç½®æ¨¡æ¿é…ç½®æ–‡ä»¶çš„è¾“å‡ºç›®å½• 2.2.5 ç‰ˆæœ¬æ–°å¢æ¥å£ï¼Œä¸»è¦ç”¨äº [add_configfiles](#targetadd_configfiles) æ¥å£è®¾ç½®çš„æ¨¡æ¿é…ç½®æ–‡ä»¶çš„è¾“å‡ºç›®å½•ã€‚ ## target:set_configvar ### è®¾ç½®æ¨¡æ¿é…ç½®å˜é‡ 2.2.5 ç‰ˆæœ¬æ–°å¢æ¥å£ï¼Œç”¨äºåœ¨ç¼–è¯‘å‰ï¼Œæ·»åŠ ä¸€äº›éœ€è¦é¢„å¤„ç†çš„æ¨¡æ¿é…ç½®å˜é‡ï¼Œä¸€èˆ¬ç”¨äº [add_configfiles](#targetadd_configfiles) æ¥å£ã€‚ ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"main.c\") set_configvar(\"HAS_FOO\", 1) set_configvar(\"HAS_BAR\", \"bar\") set_configvar(\"HAS_ZOO\", \"zoo\", {quote false}) add_configfiles(\"config.h.in\") end) ``` config.h.in ```c ${define HAS_FOO} ${define HAS_BAR} ${define HAS_ZOO} ``` ç”Ÿæˆçš„ config.h å†…å®¹å¦‚ä¸‹ï¼š ```c #define HAS_FOO 1 #define HAS_BAR \"bar\" #define HAS_ZOO zoo ``` set_configvar å¯ä»¥è®¾ç½® numberï¼Œstring å’Œ boolean ç±»å‹å€¼ï¼Œå¦‚æœæ˜¯ string å€¼ï¼Œé»˜è®¤ç”Ÿæˆçš„å®å®šä¹‰å¸¦æœ‰å¼•å·ï¼Œå¦‚æœè¦å»æ‰å¼•å·ï¼Œå¯ä»¥è®¾ç½® `{quote false}`ã€‚ ç›¸å…³ issues è§ï¼š[#1694](https://github.com/xmake io/xmake/issues/1694) å¯¹äºï¼Œå®å®šä¹‰é‡Œé¢æœ‰è·¯å¾„ï¼Œéœ€è¦è½¬ä¹‰å¤„ç†è·¯å¾„åˆ†éš”ç¬¦çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½®å¼€å¯è·¯å¾„å­—ç¬¦è½¬ä¹‰ã€‚ ```lua set_configvar(\"TEST\", \"C:\\\\hello\", {escape true}) ``` å®ƒä¼šè‡ªåŠ¨è½¬ä¹‰æˆ `#define TEST \"C:\\\\hello\"` ï¼Œå¦‚æœæ²¡å¼€å¯è½¬ä¹‰ï¼Œåˆ™ä¼šå˜æˆï¼š`#define TEST \"C:\\hello\"` ç›¸å…³ issues è§ï¼š[#1872](https://github.com/xmake io/xmake/issues/1872) ## target:add_configfiles ### æ·»åŠ æ¨¡æ¿é…ç½®æ–‡ä»¶ ç”¨äºåœ¨ç¼–è¯‘å‰ï¼Œæ·»åŠ ä¸€äº›éœ€è¦é¢„å¤„ç†çš„é…ç½®æ–‡ä»¶ã€‚ å…ˆæ¥ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") set_configdir(\"$(buildir)/config\") add_configfiles(\"src/config.h.in\") end) ``` ä¸Šé¢çš„è®¾ç½®ï¼Œä¼šåœ¨ç¼–è¯‘å‰ï¼Œè‡ªåŠ¨çš„å°† `config.h.in` è¿™ä¸ªå¤´æ–‡ä»¶é…ç½®æ¨¡æ¿ï¼Œç»è¿‡é¢„å¤„ç†åï¼Œç”Ÿæˆè¾“å‡ºåˆ°æŒ‡å®šçš„ `build/config/config.h`ã€‚ å¦‚æœ `set_configdir` ä¸è®¾ç½®ï¼Œé‚£ä¹ˆé»˜è®¤è¾“å‡ºåˆ° `build` ç›®å½•ä¸‹ã€‚ å…¶ä¸­ `.in` åç¼€ä¼šè¢«è‡ªåŠ¨è¯†åˆ«å¤„ç†æ‰ï¼Œå¦‚æœæƒ³è¦è¾“å‡ºå­˜å‚¨ä¸ºå…¶ä»–æ–‡ä»¶åï¼Œå¯ä»¥é€šè¿‡ï¼š ```lua add_configfiles(\"src/config.h\", {filename \"myconfig.h\"}) ``` çš„æ–¹å¼ï¼Œæ¥é‡å‘½åè¾“å‡ºï¼ŒåŒæ ·ï¼Œè¿™ä¸ªæ¥å£è·Ÿ [add_installfiles](#targetadd_configfiles) ç±»ä¼¼ï¼Œä¹Ÿæ˜¯æ”¯æŒ prefixdir å’Œå­ç›®å½•æå–è®¾ç½®ï¼š ```lua add_configfiles(\"src/*.h.in\", {prefixdir \"subdir\"}) add_configfiles(\"src/(tbox/config.h)\") ``` #### å˜é‡æ›¿æ¢ è¿™ä¸ªæ¥å£çš„ä¸€ä¸ªæœ€é‡è¦çš„ç‰¹æ€§å°±æ˜¯ï¼Œå¯ä»¥åœ¨é¢„å¤„ç†çš„æ—¶å€™ï¼Œå¯¹é‡Œé¢çš„ä¸€äº›æ¨¡æ¿å˜é‡è¿›è¡Œé¢„å¤„ç†æ›¿æ¢ï¼Œä¾‹å¦‚ï¼š config.h.in ``` #define VAR1 \"${VAR1}\" #define VAR2 \"${VAR2}\" #define HELLO \"${HELLO}\" ``` ```lua set_configvar(\"VAR1\", \"1\") target(\"test\", function() set_kind(\"binary\") add_files(\"main.c\") set_configvar(\"VAR2\", 2) add_configfiles(\"config.h.in\", {variables {hello \"xmake\"}}) add_configfiles(\"*.man\", {onlycopy true}) end) ``` é€šè¿‡ [set_configvar](#targetset_configvar) æ¥å£è®¾ç½®æ¨¡æ¿å˜é‡ï¼Œè£¹ç€é€šè¿‡ `{variables {xxx \"\"}}` ä¸­è®¾ç½®çš„å˜é‡è¿›è¡Œæ›¿æ¢å¤„ç†ã€‚ é¢„å¤„ç†åçš„æ–‡ä»¶ `config.h` å†…å®¹ä¸ºï¼š ``` #define VAR1 \"1\" #define VAR2 \"2\" #define HELLO \"xmake\" ``` è€Œ `{onlycopy true}` è®¾ç½®ï¼Œä¼šå¼ºåˆ¶å°† `*.man` ä½œä¸ºæ™®é€šæ–‡ä»¶å¤„ç†ï¼Œä»…åœ¨é¢„å¤„ç†é˜¶æ®µ copy æ–‡ä»¶ï¼Œä¸è¿›è¡Œå˜é‡æ›¿æ¢ã€‚ é»˜è®¤çš„æ¨¡æ¿å˜é‡åŒ¹é…æ¨¡å¼ä¸º `${var}`ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®å…¶ä»–çš„åŒ¹é…æ¨¡å¼ï¼Œä¾‹å¦‚ï¼Œæ”¹ä¸º `@var@` åŒ¹é…è§„åˆ™ï¼š ```lua target(\"test\", function() add_configfiles(\"config.h.in\", {pattern \"@(. )@\"}) end) ``` #### å†…ç½®å˜é‡ æˆ‘ä»¬ä¹Ÿæœ‰æä¾›äº†ä¸€äº›å†…ç½®çš„å˜é‡ï¼Œå³ä½¿ä¸é€šè¿‡æ­¤æ¥å£è®¾ç½®ï¼Œä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œé»˜è®¤å˜é‡æ›¿æ¢çš„ï¼š ``` ${VERSION} > 1.6.3 ${VERSION_MAJOR} > 1 ${VERSION_MINOR} > 6 ${VERSION_ALTER} > 3 ${VERSION_BUILD} > set_version(\"1.6.3\", {build \"%Y%m%d%H%M\"}) > 201902031421 ${PLAT} and ${plat} > MACOS and macosx ${ARCH} and ${arch} > ARM and arm ${MODE} and ${mode} > DEBUG/RELEASE and debug/release ${DEBUG} and ${debug} > 1 or 0 ${OS} and ${os} > IOS or ios ``` ä¾‹å¦‚ï¼š config.h.in ```c #define CONFIG_VERSION \"${VERSION}\" #define CONFIG_VERSION_MAJOR ${VERSION_MAJOR} #define CONFIG_VERSION_MINOR ${VERSION_MINOR} #define CONFIG_VERSION_ALTER ${VERSION_ALTER} #define CONFIG_VERSION_BUILD ${VERSION_BUILD} ``` config.h ```c #define CONFIG_VERSION \"1.6.3\" #define CONFIG_VERSION_MAJOR 1 #define CONFIG_VERSION_MINOR 6 #define CONFIG_VERSION_ALTER 3 #define CONFIG_VERSION_BUILD 201902031401 ``` v2.5.3 åæ–°å¢ git ç›¸å…³å†…ç½®å˜é‡ï¼š ```c #define GIT_COMMIT \"${GIT_COMMIT}\" #define GIT_COMMIT_LONG \"${GIT_COMMIT_LONG}\" #define GIT_COMMIT_DATE \"${GIT_COMMIT_DATE}\" #define GIT_BRANCH \"${GIT_BRANCH}\" #define GIT_TAG \"${GIT_TAG}\" #define GIT_TAG_LONG \"${GIT_TAG_LONG}\" #define GIT_CUSTOM \"${GIT_TAG} ${GIT_COMMIT}\" ``` ```c #define GIT_COMMIT \"8c42b2c2\" #define GIT_COMMIT_LONG \"8c42b2c251793861eb85ffdf7e7c2307b129c7ae\" #define GIT_COMMIT_DATE \"20210121225744\" #define GIT_BRANCH \"dev\" #define GIT_TAG \"v1.6.6\" #define GIT_TAG_LONG \"v1.6.6 0 g8c42b2c2\" #define GIT_CUSTOM \"v1.6.6 8c42b2c2\" ``` #### å®å®šä¹‰ æˆ‘ä»¬è¿˜å¯ä»¥å¯¹ `#define` å®šä¹‰è¿›è¡Œä¸€äº›å˜é‡çŠ¶æ€æ§åˆ¶å¤„ç†ï¼š config.h.in ```c ${define FOO_ENABLE} ``` ```lua set_configvar(\"FOO_ENABLE\", 1) or pass true set_configvar(\"FOO_STRING\", \"foo\") ``` é€šè¿‡ä¸Šé¢çš„å˜é‡è®¾ç½®åï¼Œ`${define xxx}` å°±ä¼šæ›¿æ¢æˆï¼š ```c #define FOO_ENABLE 1 #define FOO_STRING \"foo\" ``` æˆ–è€…ï¼ˆè®¾ç½®ä¸º 0 ç¦ç”¨çš„æ—¶å€™ï¼‰ ```c /* #undef FOO_ENABLE */ /* #undef FOO_STRING */ ``` è¿™ç§æ–¹å¼ï¼Œå¯¹äºä¸€äº›è‡ªåŠ¨æ£€æµ‹ç”Ÿæˆ config.h éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚é…åˆ option æ¥åšè‡ªåŠ¨æ£€æµ‹ï¼š ```lua option(\"foo\") set_default(true) set_description(\"Enable Foo\") set_configvar(\"FOO_ENABLE\", 1) æˆ–è€…ä¼ é€’ trueï¼Œå¯ç”¨ FOO_ENABLE å˜é‡ set_configvar(\"FOO_STRING\", \"foo\") target(\"test\") add_configfiles(\"config.h.in\") å¦‚æœå¯ç”¨ foo é€‰é¡¹ > æ·»åŠ  FOO_ENABLE å’Œ FOO_STRING å®šä¹‰ add_options(\"foo\") ``` config.h.in ```c ${define FOO_ENABLE} ${define FOO_STRING} ``` config.h ```c #define FOO_ENABLE 1 #define FOO_STRING \"foo\" ``` å…³äº option é€‰é¡¹æ£€æµ‹ï¼Œä»¥åŠ config.h çš„è‡ªåŠ¨ç”Ÿæˆï¼Œæœ‰ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œå¯ä»¥çœ‹ä¸‹ï¼š[https://github.com/xmake io/xmake/issues/342](https://github.com/xmake io/xmake/issues/342) é™¤äº† `#define`ï¼Œå¦‚æœæƒ³è¦å¯¹å…¶ä»–é `#define xxx` ä¹ŸåšçŠ¶æ€åˆ‡æ¢å¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨ `${default xxx 0}` æ¨¡å¼ï¼Œè®¾ç½®é»˜è®¤å€¼ï¼Œä¾‹å¦‚ï¼š ``` HAVE_SSE2 equ ${default VAR_HAVE_SSE2 0} ``` é€šè¿‡ `set_configvar(\"HAVE_SSE2\", 1)` å¯ç”¨å˜é‡åï¼Œå˜ä¸º `HAVE_SSE2 equ 1`ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®å˜é‡ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼š`HAVE_SSE2 equ 0` å…³äºè¿™ä¸ªçš„è¯¦ç»†è¯´æ˜ï¼Œè§ï¼š[https://github.com/xmake io/xmake/issues/320](https://github.com/xmake io/xmake/issues/320) #### å®šä¹‰å¯¼å‡ºå® v2.9.8 æ–°å¢çš„ç‰¹æ€§ï¼Œå¯ä»¥ç”ŸæˆåŠ¨æ€åº“çš„å¯¼å‡ºå®å®šä¹‰ï¼Œé€šå¸¸ç”¨äº windows ä¸‹ dll åº“çš„ç¬¦å·å¯¼å‡ºå’Œå¯¼å…¥ã€‚ åœ¨ config.h.in ä¸­å®šä¹‰ï¼š ```c ${define_export MYLIB} ``` å°±ä¼šç”Ÿæˆ ```c #ifdef MYLIB_STATIC # define MYLIB_EXPORT #else # if defined(_WIN32) # define MYLIB_EXPORT __declspec(dllexport) # elif defined(__GNUC__) && ((__GNUC__ > 4) (__GNUC__ 3 && __GNUC_MINOR__ > 3)) # define MYLIB_EXPORT __attribute__((visibility(\"default\"))) # else # define MYLIB_EXPORT # endif #endif ``` æˆ‘ä»¬åœ¨å®šä¹‰åŠ¨æ€åº“å¯¼å‡ºç¬¦å·æ—¶ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå®æ¥æ§åˆ¶å¯¼å…¥å¯¼å‡ºã€‚ ```c MYLIB_EXPORT void foo(); ``` å®ƒè·Ÿ CMake çš„ [GenerateExportHeader](https://cmake.org/cmake/help/latest/module/GenerateExportHeader.html) çš„åŠŸèƒ½ç±»ä¼¼ã€‚ ä¸è¿‡ï¼Œå®ƒä¸ä¼šé¢å¤–ç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„å¯¼å‡ºå¤´æ–‡ä»¶ï¼Œè€Œæ˜¯ç›´æ¥åœ¨ config.h ä¸­å»ç”Ÿæˆå®ƒã€‚ æ›´å¤šè¯¦æƒ…è§ï¼š[#6088](https://github.com/xmake io/xmake/issues/6088) #### è‡ªå®šä¹‰é¢„å¤„ç†å™¨ å¦‚æœ xmake å†…ç½®çš„ç”Ÿæˆè§„åˆ™ä¸æ»¡è¶³éœ€æ±‚ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å¤„ç†å™¨å»é‡å†™ç”Ÿæˆè§„åˆ™ï¼Œä¾‹å¦‚é‡å†™ `${define_export XXX}`ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"main.c\") add_configfiles(\"config.h.in\", { preprocessor function (preprocessor_name, name, value, opt) if preprocessor_name \"define_export\" then value ([[#ifdef %s_STATIC # define %s_EXPORT #else # if defined(_WIN32) # define %s_EXPORT __declspec(dllexport) # elif defined(__GNUC__) && ((__GNUC__ > 4) (__GNUC__ 3 && __GNUC_MINOR__ > 3)) # define %s_EXPORT __attribute__((visibility(\"default\"))) # else # define %s_EXPORT # endif #endif ]]):format(name, name, name, name, name) return value end end}) end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥é‡å†™å¯¹ `${define XXX}` å’Œ `${default XXX}` çš„ç”Ÿæˆï¼Œç”šè‡³è‡ªå®šä¹‰æ‰©å±•å…¶ä»–é¢„å¤„ç†é…ç½®ã€‚ ä¾‹å¦‚ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"main.c\") set_configvar(\"FOO\", \"foo\") add_configfiles(\"config.h.in\", { preprocessor function (preprocessor_name, name, value, opt) local argv opt.argv if preprocessor_name \"define_custom\" then return string.format(\"#define CUSTOM_%s %s\", name, value) end end}) end) ``` ç„¶åæˆ‘ä»¬åœ¨ config.h.in ä¸­é…ç½®ï¼š ```c ${define_custom FOO arg1 arg2} ``` å…¶ä¸­ï¼Œ`define_custom` æ˜¯è‡ªå®šä¹‰çš„é¢„å¤„ç†å™¨åï¼ŒFOO æ˜¯å˜é‡åï¼Œå¯ä»¥ä» `set_configvar` ä¸­è·å–å˜é‡å€¼ã€‚ è€Œ arg1, arg2 æ˜¯å¯é€‰çš„é¢„å¤„ç†å‚æ•°åˆ—è¡¨ï¼Œæ ¹æ®å®é™…çš„éœ€æ±‚æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ `opt.argv` æ¥è·å–ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‚æ•°åˆ—è¡¨ tableã€‚ åœ¨è¿è¡Œ `xmake config` åï¼Œå°±ä¼šåœ¨ config.h ä¸­è‡ªåŠ¨ç”Ÿæˆå¦‚ä¸‹é…ç½®ï¼š ```c #define CUSTOM_FOO foo ``` ## target:set_policy ### è®¾ç½®æ„å»ºè¡Œä¸ºç­–ç•¥ xmake æœ‰å¾ˆå¤šçš„é»˜è®¤è¡Œä¸ºï¼Œæ¯”å¦‚ï¼šè‡ªåŠ¨æ£€æµ‹å’Œæ˜ å°„ flagsã€è·¨ target å¹¶è¡Œæ„å»ºç­‰ï¼Œè™½ç„¶æä¾›äº†ä¸€å®šçš„æ™ºèƒ½åŒ–å¤„ç†ï¼Œä½†é‡å£éš¾è°ƒï¼Œä¸ä¸€å®šæ»¡è¶³æ‰€æœ‰çš„ç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯å’Œéœ€æ±‚ã€‚ å› æ­¤ï¼Œä» v2.3.4 å¼€å§‹ï¼Œxmake æä¾›é»˜è®¤æ„å»ºç­–ç•¥çš„ä¿®æ”¹è®¾ç½®ï¼Œå¼€æ”¾ç»™ç”¨æˆ·ä¸€å®šç¨‹åº¦ä¸Šçš„å¯é…ç½®æ€§ã€‚ ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š ```lua set_policy(\"check.auto_ignore_flags\", false) ``` åªéœ€è¦åœ¨é¡¹ç›®æ ¹åŸŸè®¾ç½®è¿™ä¸ªé…ç½®ï¼Œå°±å¯ä»¥ç¦ç”¨ flags çš„è‡ªåŠ¨æ£€æµ‹å’Œå¿½ç•¥æœºåˆ¶ï¼Œå¦å¤– `set_policy` ä¹Ÿå¯ä»¥é’ˆå¯¹æŸä¸ªç‰¹å®šçš„ target å±€éƒ¨ç”Ÿæ•ˆã€‚ ```lua target(\"test\", function() set_policy(\"check.auto_ignore_flags\", false) end) ``` å®Œæ•´çš„ policies æ”¯æŒåˆ—è¡¨å’Œä½¿ç”¨è¯´æ˜ï¼Œè§ï¼š[æ„å»ºç­–ç•¥](/zh cn/guide/build_policies) ### target:set_runtimes ### è®¾ç½®ç¼–è¯‘ç›®æ ‡ä¾èµ–çš„è¿è¡Œæ—¶åº“ ç”¨äºæŠ½è±¡åŒ–è®¾ç½®ç¼–è¯‘ç›®æ ‡ä¾èµ–çš„è¿è¡Œæ—¶åº“ï¼Œç›®å‰ä»…ä»…æ”¯æŒå¯¹ msvc è¿è¡Œæ—¶åº“çš„æŠ½è±¡ï¼Œä½†åç»­ä¹Ÿè®¸ä¼šæ‰©å±•å¯¹å…¶ä»–ç¼–è¯‘å™¨è¿è¡Œæ—¶åº“çš„æ˜ å°„ã€‚ ç›®å‰æ”¯æŒçš„ä¸€äº›é…ç½®å€¼è¯´æ˜å¦‚ä¸‹ï¼š å€¼ æè¿° MT msvc è¿è¡Œæ—¶åº“ï¼šå¤šçº¿ç¨‹é™æ€åº“ MTd msvc è¿è¡Œæ—¶åº“ï¼šå¤šçº¿ç¨‹é™æ€åº“ï¼ˆè°ƒè¯•ï¼‰ MD msvc è¿è¡Œæ—¶åº“ï¼šå¤šçº¿ç¨‹åŠ¨æ€åº“ MDd msvc è¿è¡Œæ—¶åº“ï¼šå¤šçº¿ç¨‹åŠ¨æ€åº“ï¼ˆè°ƒè¯•ï¼‰ c++_static clang çš„ c++ è¿è¡Œæ—¶åº“ï¼Œé™æ€åº“ c++_shared clang çš„ c++ è¿è¡Œæ—¶åº“ï¼ŒåŠ¨æ€åº“ stdc++_static gcc çš„ c++ è¿è¡Œæ—¶åº“ï¼Œé™æ€åº“ stdc++_shared gcc çš„ c++ è¿è¡Œæ—¶åº“ï¼ŒåŠ¨æ€åº“ gnustl_static android çš„ c++ è¿è¡Œæ—¶åº“ï¼Œé™æ€åº“ï¼Œé«˜ç‰ˆæœ¬ NDK å·²åºŸå¼ƒ gnustl_shared android çš„ c++ è¿è¡Œæ—¶åº“ï¼Œé™æ€åº“ï¼Œé«˜ç‰ˆæœ¬ NDK å·²åºŸå¼ƒ stlport_static android çš„ c++ è¿è¡Œæ—¶åº“ï¼Œé™æ€åº“ï¼Œé«˜ç‰ˆæœ¬ NDK å·²åºŸå¼ƒ stlport_static android çš„ c++ è¿è¡Œæ—¶åº“ï¼Œé™æ€åº“ï¼Œé«˜ç‰ˆæœ¬ NDK å·²åºŸå¼ƒ å…³äº vs è¿è¡Œæ—¶ï¼Œå¯ä»¥å‚è€ƒï¼š[msvc è¿è¡Œæ—¶è¯´æ˜](https://docs.microsoft.com/en us/cpp/build/reference/md mt ld use run time library?view msvc 160) è€Œè¿™ä¸ªæ¥å£ä¼ å…¥ MT/MTd å‚æ•°é…ç½®ï¼Œxmake ä¼šè‡ªåŠ¨é…ç½®ä¸Š `/MT /nodefaultlib:msvcrt.lib` å‚æ•°ã€‚ æˆ‘ä»¬å¯ä»¥é’ˆå¯¹ä¸åŒçš„ target è®¾ç½®ä¸åŒçš„è¿è¡Œæ—¶ã€‚ å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬å°† `set_runtimes` è®¾ç½®åœ¨å…¨å±€æ ¹åŸŸï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ `add_requires(\"xx\")` åŒ…å®šä¹‰ä¹Ÿä¼šå…¨å±€åŒæ­¥åˆ‡æ¢åˆ°å¯¹åº”çš„ vs runtime é…ç½® ```lua set_runtimes(\"MD\") add_requires(\"libcurl\", \"fmt\") target(\"test\") set_kind(\"binary\") add_files(\"src/*.c\") ``` å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `add_requires(\"xx\", {configs {vs_runtime \"MD\"}})` å¯¹ç‰¹å®šåŒ…ä¿®æ”¹ vs è¿è¡Œæ—¶åº“ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `xmake f vs_runtime 'MD'` é€šè¿‡å‚æ•°é…ç½®æ¥å…¨å±€åˆ‡æ¢å®ƒã€‚ ä¸æ­¤ api ç›¸å…³çš„ issueï¼š[#1071](https://github.com/xmake io/xmake/issues/1071#issuecomment 750817681) ## target:set_group ### è®¾ç½®ç›®æ ‡åˆ†ç»„ #### ç¼–è¯‘æŒ‡å®šä¸€æ‰¹ç›®æ ‡ç¨‹åº æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `set_group()` å°†ç»™å®šçš„ç›®æ ‡æ ‡è®°ä¸º `test/benchmark/...` å¹¶ä½¿ç”¨ `set_default(false)` ç¦ç”¨æ¥é»˜è®¤æ„å»ºå®ƒã€‚ ç„¶åï¼Œé€šè¿‡ `xmake g xxx` å‘½ä»¤å°±èƒ½æŒ‡å®šæ„å»ºä¸€æ‰¹ç›®æ ‡ç¨‹åºäº†ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½æ¥æ„å»ºæ‰€æœ‰æµ‹è¯•ã€‚ ```lua target(\"test1\", function() set_kind(\"binary\") set_default(false) set_group(\"test\") add_files(\"src/*.cpp\") end) target(\"test2\", function() set_kind(\"binary\") set_default(false) set_group(\"test\") add_files(\"src/*.cpp\") end) ``` ç¼–è¯‘æŒ‡å®šçš„ groupï¼š ```console $ xmake g test $ xmake group test ``` #### è¿è¡ŒæŒ‡å®šä¸€æ‰¹ç›®æ ‡ç¨‹åº æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®åˆ†ç»„ï¼Œæ¥æŒ‡å®šè¿è¡Œæ‰€æœ‰å¸¦æœ‰ `test` åˆ†ç»„çš„æµ‹è¯•ç¨‹åºã€‚ ```console $ xmake run g test $ xmake run group test ``` å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ”¯æŒåˆ†ç»„çš„æ¨¡å¼åŒ¹é…ï¼š ``` $ xmake build g test_* $ xmake run g test/foo_* $ xmake build g bench* $ xmake run g bench* ``` æ›´å¤šä¿¡æ¯è§ï¼š[#1913](https://github.com/xmake io/xmake/issues/1913) ## target:set_exceptions ### å¯ç”¨æˆ–è€…ç¦ç”¨å¼‚å¸¸ æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªé…ç½®ï¼Œé…ç½®å¯ç”¨å’Œç¦ç”¨ C++/Objc çš„å¼‚å¸¸ã€‚ é€šå¸¸ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡ `add_cxxflags` æ¥å£å»é…ç½®å®ƒä»¬ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„å¹³å°ï¼Œç¼–è¯‘å™¨åˆ†åˆ«å¤„ç†å®ƒä»¬ï¼Œéå¸¸ç¹çã€‚ ä¾‹å¦‚ï¼š ```lua on_config(function (target) if (target:has_tool(\"cxx\", \"cl\")) then target:add(\"cxflags\", \"/EHsc\", {force true}) target:add(\"defines\", \"_HAS_EXCEPTIONS 1\", {force true}) elseif(target:has_tool(\"cxx\", \"clang\") or target:has_tool(\"cxx\", \"clang cl\")) then target:add(\"cxflags\", \" fexceptions\", {force true}) target:add(\"cxflags\", \" fcxx exceptions\", {force true}) end end) ``` è€Œé€šè¿‡è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠ½è±¡åŒ–æˆç¼–è¯‘å™¨æ— å…³çš„æ–¹å¼å»é…ç½®å®ƒä»¬ã€‚ å¼€å¯ C++ å¼‚å¸¸: ```lua set_exceptions(\"cxx\") ``` ç¦ç”¨ C++ å¼‚å¸¸: ```lua set_exceptions(\"no cxx\") ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶é…ç½®å¼€å¯ objc å¼‚å¸¸ã€‚ ```lua set_exceptions(\"cxx\", \"objc\") ``` æˆ–è€…ç¦ç”¨å®ƒä»¬ã€‚ ```lua set_exceptions(\"no cxx\", \"no objc\") ``` xmake ä¼šåœ¨å†…éƒ¨è‡ªåŠ¨æ ¹æ®ä¸åŒçš„ç¼–è¯‘å™¨ï¼Œå»é€‚é…å¯¹åº”çš„ flagsã€‚ ## target:set_encodings ### è®¾ç½®ç¼–ç  æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªæ¥å£è®¾ç½®æºæ–‡ä»¶ã€ç›®æ ‡æ‰§è¡Œæ–‡ä»¶çš„ç¼–ç ã€‚ ç›®å‰æ”¯æŒçš„ç¼–ç ï¼šutf 8, gb2312 (msvc) é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»…ä»…æŒ‡å®šç¼–ç ï¼Œæ˜¯ä¼šåŒæ—¶å¯¹æºæ–‡ä»¶ï¼Œç›®æ ‡æ–‡ä»¶ç”Ÿæ•ˆã€‚ ```lua for all source/target encodings set_encodings(\"utf 8\") msvc: /utf 8 ``` å®ƒç­‰ä»·äºï¼š ```lua set_encodings(\"source:utf 8\", \"target:utf 8\") ``` å¹¶ä¸”ï¼Œç›®å‰ä»…ä»…æ”¯æŒè®¾ç½®æˆ utf 8 ç¼–ç ï¼Œå°†æ¥ä¼šä¸æ–­æ‰©å±•ã€‚ å¦‚æœï¼Œæˆ‘ä»¬ä»…ä»…æƒ³å•ç‹¬è®¾ç½®æºæ–‡ä»¶ç¼–ç ï¼Œæˆ–è€…ç›®æ ‡æ–‡ä»¶ç¼–ç ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ #### è®¾ç½®æºæ–‡ä»¶ç¼–ç  é€šå¸¸æŒ‡çš„æ˜¯ç¼–è¯‘çš„ä»£ç æºæ–‡ä»¶çš„ç¼–ç ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆè®¾ç½®ã€‚ ```lua gcc/clang: finput charset UTF 8, msvc: source charset utf 8 set_encodings(\"source:utf 8\") ``` #### è®¾ç½®ç›®æ ‡æ–‡ä»¶ç¼–ç  å®ƒé€šå¸¸æŒ‡çš„æ˜¯ç›®æ ‡å¯æ‰§è¡Œæ–‡ä»¶çš„è¿è¡Œè¾“å‡ºç¼–ç ã€‚ ```lua gcc/clang: fexec charset UTF 8, msvc: target charset utf 8 set_encodings(\"target:utf 8\") ``` ## target:add_forceincludes ### å¼ºåˆ¶æ·»åŠ  includes ç”¨äºåœ¨é…ç½®æ–‡ä»¶ä¸­ç›´æ¥å¼ºåˆ¶æ·»åŠ  `includes` å¤´æ–‡ä»¶ã€‚ ```lua add_forceincludes(\"config.h\") ``` å®ƒçš„æ•ˆæœç±»ä¼¼äº `#include <config.h>`ï¼Œä½†æ˜¯ä¸éœ€è¦åœ¨æºç ä¸­æ˜¾å¼æ·»åŠ å®ƒäº†ã€‚ å¦å¤–ï¼Œå®ƒçš„æœç´¢è·¯å¾„ä¹Ÿæ˜¯éœ€è¦é€šè¿‡ `add_includedirs` æ¥æ§åˆ¶ï¼Œè€Œä¸æ˜¯ç›´æ¥é…ç½®æ–‡ä»¶è·¯å¾„ã€‚ ```lua add_forceincludes(\"config.h\") add_includedirs(\"src\") ``` é»˜è®¤ add_forceincludes åŒ¹é… c/c++/objcã€‚å¦‚æœä»…ä»…åªæƒ³åŒ¹é… c++ å¯ä»¥è¿™ä¹ˆé…ç½®ï¼š ```lua add_forceincludes(\"config.h\", {sourcekinds \"cxx\"}) ``` å¦‚æœæƒ³åŒæ—¶åŒ¹é…å¤šä¸ªæºæ–‡ä»¶ç±»å‹ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼š ```lua add_forceincludes(\"config.h\", {sourcekinds {\"cxx\", \"mxx\"}}) ``` ## target:add_tests ### æ·»åŠ æµ‹è¯•ç”¨ä¾‹ æˆ‘ä»¬åªéœ€è¦åœ¨éœ€è¦æµ‹è¯•çš„ target ä¸Šé€šè¿‡ add_tests é…ç½®ä¸€äº›æµ‹è¯•ç”¨ä¾‹ï¼Œå°±å¯ä»¥è‡ªåŠ¨æ‰§è¡Œæµ‹è¯•ã€‚ å³ä½¿å½“å‰ target è¢«è®¾ç½®æˆäº† `set_default(false)`ï¼Œåœ¨æ‰§è¡Œæµ‹è¯•çš„æ—¶å€™ï¼Œxmake ä¹Ÿè¿˜æ˜¯ä¼šå…ˆè‡ªåŠ¨ç¼–è¯‘å®ƒä»¬ï¼Œç„¶åè‡ªåŠ¨è¿è¡Œæ‰€æœ‰çš„æµ‹è¯•ã€‚ æˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸ªæ•´ä½“çš„ä¾‹å­ï¼Œå¤§æ¦‚çŸ¥é“ä¸‹å®ƒæ˜¯æ€ä¹ˆæ ·å­çš„ã€‚ ```lua add_rules(\"mode.debug\", \"mode.release\") for _, file in ipairs(os.files(\"src/test_*.cpp\")) do local name path.basename(file) target(name, function() set_kind(\"binary\") set_default(false) add_files(\"src/\" .. name .. \".cpp\") add_tests(\"default\") add_tests(\"args\", {runargs {\"foo\", \"bar\"}}) add_tests(\"pass_output\", {trim_output true, runargs \"foo\", pass_outputs \"hello foo\"}) add_tests(\"fail_output\", {fail_outputs {\"hello2 .*\", \"hello xmake\"}}) end) end ``` è¿™ä¸ªä¾‹å­ï¼Œè‡ªåŠ¨æ‰«ææºç ç›®å½•ä¸‹çš„ `test_*.cpp` æºæ–‡ä»¶ï¼Œç„¶åæ¯ä¸ªæ–‡ä»¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç›®æ ‡ï¼Œå®ƒè¢«è®¾ç½®æˆäº† `set_default(false)`ï¼Œä¹Ÿå°±æ˜¯æ­£å¸¸æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¸ä¼šç¼–è¯‘å®ƒä»¬ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‰§è¡Œ `xmake test` è¿›è¡Œæµ‹è¯•ï¼Œå®ƒä»¬å°±ä¼šè¢«è‡ªåŠ¨ç¼–è¯‘ï¼Œç„¶åæµ‹è¯•è¿è¡Œï¼Œè¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š ```bash $ xmake test running tests ... [2%]: test_1/args .................................... passed 7.000s [5%]: test_1/default .................................... passed 5.000s [8%]: test_1/fail_output .................................... passed 5.000s [11%]: test_1/pass_output .................................... passed 6.000s [13%]: test_2/args .................................... passed 7.000s [16%]: test_2/default .................................... passed 6.000s [19%]: test_2/fail_output .................................... passed 6.000s [22%]: test_2/pass_output .................................... passed 6.000s [25%]: test_3/args .................................... passed 7.000s [27%]: test_3/default .................................... passed 7.000s [30%]: test_3/fail_output .................................... passed 6.000s [33%]: test_3/pass_output .................................... passed 6.000s [36%]: test_4/args .................................... passed 6.000s [38%]: test_4/default .................................... passed 6.000s [41%]: test_4/fail_output .................................... passed 5.000s [44%]: test_4/pass_output .................................... passed 6.000s [47%]: test_5/args .................................... passed 5.000s [50%]: test_5/default .................................... passed 6.000s [52%]: test_5/fail_output .................................... failed 6.000s [55%]: test_5/pass_output .................................... failed 5.000s [58%]: test_6/args .................................... passed 7.000s [61%]: test_6/default .................................... passed 6.000s [63%]: test_6/fail_output .................................... passed 6.000s [66%]: test_6/pass_output .................................... passed 6.000s [69%]: test_7/args .................................... failed 6.000s [72%]: test_7/default .................................... failed 7.000s [75%]: test_7/fail_output .................................... failed 6.000s [77%]: test_7/pass_output .................................... failed 5.000s [80%]: test_8/args .................................... passed 7.000s [83%]: test_8/default .................................... passed 6.000s [86%]: test_8/fail_output .................................... passed 6.000s [88%]: test_8/pass_output .................................... failed 5.000s [91%]: test_9/args .................................... passed 6.000s [94%]: test_9/default .................................... passed 6.000s [97%]: test_9/fail_output .................................... passed 6.000s [100%]: test_9/pass_output .................................... passed 6.000s 80% tests passed, 7 tests failed out of 36, spent 0.242s ``` #### è¿è¡ŒæŒ‡å®šæµ‹è¯•ç›®æ ‡ æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šè¿è¡ŒæŒ‡å®š target çš„æŸä¸ªæµ‹è¯•ï¼š ```bash $ xmake test targetname/testname ``` æˆ–è€…æŒ‰æ¨¡å¼åŒ¹é…çš„æ–¹å¼ï¼Œè¿è¡Œä¸€ä¸ª target çš„æ‰€æœ‰æµ‹è¯•ï¼Œæˆ–è€…ä¸€æ‰¹æµ‹è¯•ï¼š ```bash $ xmake test targetname/* $ xmake test targetname/foo* ``` ä¹Ÿå¯ä»¥è¿è¡Œæ‰€æœ‰ target çš„åŒåæµ‹è¯•ï¼š ```bash $ xmake test */testname ``` #### å¹¶è¡ŒåŒ–è¿è¡Œæµ‹è¯• å…¶å®ï¼Œé»˜è®¤å°±æ˜¯å¹¶è¡ŒåŒ–è¿è¡Œçš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ ` jN` è°ƒæ•´è¿è¡Œçš„å¹¶è¡Œåº¦ã€‚ ```bash $ xmake test jN ``` #### åˆ†ç»„è¿è¡Œæµ‹è¯• ```bash $ xmake test g \"foo\" $ xmake test g \"foo*\" ``` #### æ·»åŠ æµ‹è¯•åˆ°ç›®æ ‡ï¼ˆæ— å‚æ•°ï¼‰ å¦‚æœæ²¡æœ‰é…ç½®ä»»ä½•å‚æ•°ï¼Œä»…ä»…é…ç½®äº†æµ‹è¯•ååˆ° `add_tests`ï¼Œé‚£ä¹ˆä»…ä»…æµ‹è¯•è¿™ä¸ªç›®æ ‡ç¨‹åºçš„æ˜¯å¦ä¼šè¿è¡Œå¤±è´¥ï¼Œæ ¹æ®é€€å‡ºä»£ç æ¥åˆ¤æ–­æ˜¯å¦é€šè¿‡æµ‹è¯•ã€‚ ``` target(\"test\", function() add_tests(\"testname\") end) ``` #### é…ç½®è¿è¡Œå‚æ•° æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `{runargs {\"arg1\", \"arg2\"}}` çš„æ–¹å¼ï¼Œç»™ `add_tests` é…ç½®æŒ‡å®šæµ‹è¯•éœ€è¦è¿è¡Œçš„å‚æ•°ã€‚ å¦å¤–ï¼Œä¸€ä¸ª target å¯ä»¥åŒæ—¶é…ç½®å¤šä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å¯ç‹¬ç«‹è¿è¡Œï¼Œäº’ä¸å†²çªã€‚ ```lua target(\"test\", function() add_tests(\"testname\", {runargs \"arg1\"}) add_tests(\"testname\", {runargs {\"arg1\", \"arg2\"}}) end) ``` å¦‚æœæˆ‘ä»¬æ²¡æœ‰é…ç½® runargs åˆ° `add_tests`ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿä¼šå°è¯•ä»è¢«ç»‘å®šçš„ target ä¸­ï¼Œè·å– `set_runargs` è®¾ç½®çš„è¿è¡Œå‚æ•°ã€‚ ```lua target(\"test\", function() add_tests(\"testname\") set_runargs(\"arg1\", \"arg2\") end) ``` #### é…ç½®è¿è¡Œç›®å½• æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ rundir è®¾ç½®æµ‹è¯•è¿è¡Œçš„å½“å‰å·¥ä½œç›®å½•ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() add_tests(\"testname\", {rundir os.projectdir()}) end) ``` å¦‚æœæˆ‘ä»¬æ²¡æœ‰é…ç½® rundir åˆ° `add_tests`ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿä¼šå°è¯•ä»è¢«ç»‘å®šçš„ target ä¸­ï¼Œè·å– `set_rundir` è®¾ç½®çš„è¿è¡Œç›®å½•ã€‚ ```lua target(\"test\", function() add_tests(\"testname\") set_rundir(\"$(projectdir)\") end) ``` #### é…ç½®è¿è¡Œç¯å¢ƒ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ runenvs è®¾ç½®ä¸€äº›è¿è¡Œæ—¶å€™çš„ç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\", function() add_tests(\"testname\", {runenvs {LD_LIBRARY_PATH \"/lib\"}}) end) ``` å¦‚æœæˆ‘ä»¬æ²¡æœ‰é…ç½® runenvs åˆ° `add_tests`ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿä¼šå°è¯•ä»è¢«ç»‘å®šçš„ target ä¸­ï¼Œè·å– `add_runenvs` è®¾ç½®çš„è¿è¡Œç¯å¢ƒã€‚ ```lua target(\"test\", function() add_tests(\"testname\") add_runenvs(\"LD_LIBRARY_PATH\", \"/lib\") end) ``` #### åŒ¹é…è¾“å‡ºç»“æœ é»˜è®¤æƒ…å†µä¸‹ï¼Œ`xmake test` ä¼šæ ¹æ®æµ‹è¯•è¿è¡Œçš„é€€å‡ºä»£ç æ˜¯å¦ä¸º 0ï¼Œæ¥åˆ¤æ–­æ˜¯å¦æµ‹è¯•é€šè¿‡ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æµ‹è¯•è¿è¡Œçš„è¾“å‡ºç»“æœæ˜¯å¦æ»¡è¶³æˆ‘ä»¬çš„æŒ‡å®šçš„åŒ¹é…æ¨¡å¼ï¼Œæ¥åˆ¤æ–­æ˜¯å¦æµ‹è¯•é€šè¿‡ã€‚ ä¸»è¦é€šè¿‡è¿™ä¸¤ä¸ªå‚æ•°æ§åˆ¶ï¼š å‚æ•° è¯´æ˜ pass_outputs å¦‚æœè¾“å‡ºåŒ¹é…ï¼Œåˆ™æµ‹è¯•é€šè¿‡ fail_outputs å¦‚æœè¾“å‡ºåŒ¹é…ï¼Œåˆ™æµ‹è¯•å¤±è´¥ ä¼ å…¥ `pass_outputs` å’Œ `fail_outputs` çš„æ˜¯ä¸€ä¸ª lua åŒ¹é…æ¨¡å¼çš„åˆ—è¡¨ï¼Œä½†æ¨¡å¼ç¨å¾®åšäº†ä¸€äº›ç®€åŒ–ï¼Œæ¯”å¦‚å¯¹ `*` çš„å¤„ç†ã€‚ å¦‚æœè¦åŒ¹é…æˆåŠŸï¼Œåˆ™æµ‹è¯•é€šè¿‡ï¼Œå¯ä»¥è¿™ä¹ˆé…ç½®ï¼š ```lua target(\"test\", function() add_tests(\"testname1\", {pass_outputs \"hello\"}) add_tests(\"testname2\", {pass_outputs \"hello *\"}) add_tests(\"testname3\", {pass_outputs {\"hello\", \"hello *\"}}) end) ``` å¦‚æœè¦åŒ¹é…æˆåŠŸï¼Œåˆ™æµ‹è¯•å¤±è´¥ï¼Œå¯ä»¥è¿™ä¹ˆé…ç½®ï¼š ```lua target(\"test\", function() add_tests(\"testname1\", {fail_outputs \"hello\"}) add_tests(\"testname2\", {fail_outputs \"hello *\"}) add_tests(\"testname3\", {fail_outputs {\"hello\", \"hello *\"}}) end) ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶é…ç½®å®ƒä»¬ï¼š ```lua target(\"test\", function() add_tests(\"testname\", {pass_outputs \"foo\", fail_outputs \"hello\"}) end) ``` ç”±äºä¸€äº›æµ‹è¯•è¾“å‡ºçš„ç»“æœï¼Œå°¾éƒ¨ä¼šæœ‰ä¸€äº›æ¢è¡Œä»€ä¹ˆçš„ç©ºç™½å­—ç¬¦ï¼Œå¹²æ‰°åŒ¹é…æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å†é…ç½® `trim_output true`ï¼Œå…ˆæˆªæ–­ç©ºç™½å­—ç¬¦åï¼Œå†åšåŒ¹é…ã€‚ ```lua target(\"test\", function() add_tests(\"testname\", {trim_output true, pass_outputs \"foo\", fail_outputs \"hello\"}) end) ``` æˆ‘ä»¬è¿˜å¯ä»¥é…ç½® `{plain true}` æ˜¯ç¦ç”¨ lua æ¨¡å¼åŒ¹é…ï¼Œä»…ä»…åšæœ€åŸºç¡€çš„å¹³å¦æ–‡æœ¬åŒ¹é…ã€‚ ```lua target(\"test\", function() add_tests(\"testname\", {plain true, pass_outputs \"foo\", fail_outputs \"hello\"}) end) ``` #### é…ç½®æµ‹è¯•ç»„ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `group \"foo\"` æ¥é…ç½®ä¸€ä¸ªæµ‹è¯•ç»„ï¼Œè¿›è¡Œåˆ†ç»„æµ‹è¯•ï¼š ```lua target(\"test\", function() add_tests(\"testname1\", {group \"foo\"}) add_tests(\"testname2\", {group \"foo\"}) add_tests(\"testname3\", {group \"bar\"}) add_tests(\"testname4\", {group \"bae\"}) end) ``` å…¶ä¸­ testname1/testname2 æ˜¯ä¸€ä¸ªç»„ fooï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯åœ¨å¦å¤–ä¸€ä¸ªç»„ã€‚ ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ `xmake test g groupname` æ¥è¿›è¡Œåˆ†ç»„æµ‹è¯•äº†ã€‚ ```bash $ xmake test g \"foo\" $ xmake test g \"foo*\" ``` > è¿è¡Œåˆ†ç»„ï¼Œä¹Ÿæ˜¯æ”¯æŒæ¨¡å¼åŒ¹é…çš„ã€‚ å¦å¤–ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½® `group` å‚æ•°ç»™ `add_tests`ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é»˜è®¤è·å–ç»‘å®šåˆ° target çš„ç»„åã€‚ ```lua target(\"test\", function() add_tests(\"testname\") set_group(\"foo\") end) ``` #### è‡ªå®šä¹‰æµ‹è¯•è„šæœ¬ æˆ‘ä»¬è¿˜æ–°å¢äº† `before_test`, `on_test` å’Œ `after_test` é…ç½®è„šæœ¬ï¼Œç”¨æˆ·å¯ä»¥åœ¨ rule å’Œ target åŸŸï¼Œè‡ªå®šä¹‰é…ç½®å®ƒä»¬å®ç°å®šåˆ¶åŒ–çš„æµ‹è¯•æ‰§è¡Œã€‚ ```lua target(\"test\", function()) on_test(function (target, opt) print(opt.name, opt.runenvs, opt.runargs, opt.pass_outputs) do test ... passed return true failied return false, errors end) end) ``` å…¶ä¸­ï¼Œopt é‡Œé¢å¯ä»¥è·å–åˆ°æ‰€æœ‰ä¼ å…¥ `add_tests` çš„å‚æ•°ï¼Œæˆ‘ä»¬åœ¨ on_test é‡Œé¢è‡ªå®šä¹‰æµ‹è¯•é€»è¾‘ï¼Œç„¶åè¿”å› true å°±æ˜¯æµ‹è¯•é€šè¿‡ï¼Œè¿”å› false å°±æ˜¯æµ‹è¯•å¤±è´¥ï¼Œç„¶åç»§ç»­è¿”å›æµ‹è¯•å¤±è´¥çš„é”™è¯¯ä¿¡æ¯ã€‚ #### è‡ªåŠ¨åŒ–æ„å»º ç”±äºæµ‹è¯•ç›®æ ‡åœ¨æ­£å¸¸å¼€å‘æ„å»ºé˜¶æ®µï¼Œé€šå¸¸æ˜¯ä¸éœ€è¦è¢«æ„å»ºçš„ï¼Œå› æ­¤æˆ‘ä»¬ä¼šè®¾ç½® `set_default(false)`ã€‚ ```lua target(\"test\", function() add_tests(\"testname\") set_default(false) end) ``` ä½†æ˜¯è¿è¡Œ `xmake test` è¿›è¡Œæµ‹è¯•æ—¶å€™ï¼Œè¿™äº›æµ‹è¯•å¯¹åº”çš„ target è¿˜æ˜¯ä¼šè¢«è‡ªåŠ¨æ„å»ºï¼Œç¡®ä¿èƒ½å¤Ÿè¢«è¿è¡Œã€‚ ```bash $ xmake test [25%]: cache compiling.release src/main.cpp [50%]: linking.release test running tests ... [100%]: test/testname .................................... passed 6.000s 100% tests passed, 0 tests failed out of 1, spent 0.006s ``` #### é¦–æ¬¡æµ‹è¯•å¤±è´¥å°±ç»ˆæ­¢ é»˜è®¤æƒ…å†µä¸‹ï¼Œ`xmake test` ä¼šç­‰åˆ°æ‰€æœ‰æµ‹è¯•éƒ½è¿è¡Œå®Œï¼Œä¸ç®¡é‡Œé¢æœ‰å¤šå°‘æ˜¯æ²¡é€šè¿‡çš„ã€‚ è€Œæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³åœ¨ç¬¬ä¸€ä¸ªæµ‹è¯•æ²¡é€šè¿‡ï¼Œå°±ç›´æ¥ä¸­æ–­æµ‹è¯•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„é…ç½®å¯ç”¨ï¼š ```lua set_policy(\"test.stop_on_first_failure\", true) ``` #### æµ‹è¯•å¤±è´¥è¿”å› 0 é»˜è®¤æƒ…å†µä¸‹ï¼Œåªè¦æœ‰ä¸€ä¸ªæµ‹è¯•æ²¡é€šè¿‡ï¼Œç­‰åˆ° `xmake test` è¿è¡Œå®Œæˆï¼Œå®ƒéƒ½ä¼šè¿”å›é 0 é€€å‡ºä»£ç ï¼Œè¿™å¯¹äºä¸€äº› CI ç¯å¢ƒéå¸¸æœ‰ç”¨ï¼Œå¯ä»¥ä¸­æ–­ CI çš„å…¶ä»–è„šæœ¬ç»§ç»­è¿è¡Œã€‚ ç„¶åè§¦å‘ä¿¡å·å‘Šè¯‰ CIï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šå’Œå‘Šè­¦äº†ã€‚ ç„¶åï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å‹åˆ¶è¿™ç§è¡Œä¸ºï¼Œå¯ä»¥å¼ºåˆ¶å°† `xmake test` çš„é€€å‡ºä»£ç æ€»æ˜¯è®¾ç½®æˆ 0ã€‚ ```lua set_policy(\"test.return_zero_on_failure\", true) ``` #### ä»…ä»…æµ‹è¯•ç¼–è¯‘ æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä»…ä»…æƒ³è¦æµ‹è¯•ä»£ç æ˜¯å¦é€šè¿‡ç¼–è¯‘ï¼Œæˆ–è€…æ²¡æœ‰é€šè¿‡ç¼–è¯‘ï¼Œä¸éœ€è¦è¿è¡Œå®ƒä»¬ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡é…ç½® `build_should_pass` å’Œ `build_should_fail` æ¥å®ç°ã€‚ ```lua target(\"test_10\", function() set_kind(\"binary\") set_default(false) add_files(\"src/compile.cpp\") add_tests(\"compile_fail\", {build_should_fail true}) end) target(\"test_11\", function() set_kind(\"binary\") set_default(false) add_files(\"src/compile.cpp\") add_tests(\"compile_pass\", {build_should_pass true}) end) ``` è¿™é€šå¸¸ç”¨äºä¸€äº›æµ‹è¯•ä»£ç ä¸­å¸¦æœ‰ `static_assert` çš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼š ```c++ template <typename T> bool foo(T val) { if constexpr (std::is_same_v<T, int>) { printf(\"int!\\n\"); } else if constexpr (std::is_same_v<T, float>) { printf(\"float!\\n\"); } else { static_assert(false, \"unsupported type\"); } } int main(int, char**) { foo(\"BAD\"); return 0; } ``` #### é…ç½®é¢å¤–çš„ä»£ç ç¼–è¯‘ æˆ‘ä»¬è¿˜å¯ä»¥åœ¨é…ç½®æµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ï¼Œå¯¹æ¯ä¸ªæµ‹è¯•é…ç½®é¢å¤–éœ€è¦ç¼–è¯‘çš„ä»£ç ï¼Œä»¥åŠä¸€äº›å®å®šä¹‰ï¼Œå®ç°å†…è”æµ‹è¯•ã€‚ xmake ä¼šä¸ºæ¯ä¸ªæµ‹è¯•å•ç‹¬ç¼–è¯‘ä¸€ä¸ªç‹¬ç«‹çš„å¯æ‰§è¡Œç¨‹åºå»è¿è¡Œå®ƒï¼Œä½†è¿™å¹¶ä¸ä¼šå½±å“åˆ° target åœ¨ç”Ÿäº§ç¯å¢ƒçš„ç¼–è¯‘ç»“æœã€‚ ```lua target(\"test_13\", function() set_kind(\"binary\") set_default(false) add_files(\"src/test_1.cpp\") add_tests(\"stub_1\", {files \"tests/stub_1.cpp\", defines \"STUB_1\"}) end) target(\"test_14\", function() set_kind(\"binary\") set_default(false) add_files(\"src/test_2.cpp\") add_tests(\"stub_2\", {files \"tests/stub_2.cpp\", defines \"STUB_2\"}) end) target(\"test_15\", function() set_kind(\"binary\") set_default(false) add_files(\"src/test_1.cpp\") add_tests(\"stub_n\", {files \"tests/stub_n*.cpp\", defines \"STUB_N\"}) end) ``` ä»¥ doctest ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹ä»»ä½• main.cpp çš„æƒ…å†µä¸‹ï¼Œå¤–ç½®å•å…ƒæµ‹è¯•ï¼š ```lua add_rules(\"mode.debug\", \"mode.release\") add_requires(\"doctest\") target(\"doctest\", function() set_kind(\"binary\") add_files(\"src/*.cpp\") for _, testfile in ipairs(os.files(\"tests/*.cpp\")) do add_tests(path.basename(testfile), { files testfile, remove_files \"src/main.cpp\", languages \"c++11\", packages \"doctest\", defines \"DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN\"}) end end) ``` å®šä¹‰ `DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN` ä¼šå¼•å…¥é¢å¤–çš„ main å…¥å£å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é…ç½® remove_files å»ç§»é™¤å·²æœ‰çš„ main.cpp æ–‡ä»¶ã€‚ è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š ```bash $ xmake test running tests ... [50%]: doctest/test_1 .................................... failed 0.009s [100%]: doctest/test_2 .................................... passed 0.009s 50% tests passed, 1 tests failed out of 2, spent 0.019s ruki 2:doctest ruki$ xmake test v running tests ... [50%]: doctest/test_1 .................................... failed 0.026s [doctest] doctest version is \"2.4.11\" [doctest] run with \" help\" for options tests/test_1.cpp:7: TEST CASE: testing the factorial function tests/test_1.cpp:8: ERROR: CHECK(factorial(1) 10 ) is NOT correct! values: CHECK(1 10) [doctest] test cases: 1 0 passed 1 failed 0 skipped [doctest] assertions: 4 3 passed 1 failed [doctest] Status: FAILURE! run failed, exit code: 1 [100%]: doctest/test_2 .................................... passed 0.010s 50% tests passed, 1 tests failed out of 2, spent 0.038s ``` #### æµ‹è¯•åŠ¨æ€åº“ é€šå¸¸ï¼Œ`add_tests` ä»…ç”¨äºå¯¹å¯æ‰§è¡Œç¨‹åºè¿›è¡Œè¿è¡Œæµ‹è¯•ï¼Œè¿è¡ŒåŠ¨æ€åº“éœ€è¦æœ‰ä¸€ä¸ªé¢å¤–çš„ main ä¸»å…¥å£ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é¢å¤–é…ç½®ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºå»åŠ è½½å®ƒï¼Œä¾‹å¦‚ï¼š ```lua target(\"doctest_shared\", function() set_kind(\"shared\") add_files(\"src/foo.cpp\") for _, testfile in ipairs(os.files(\"tests/*.cpp\")) do add_tests(path.basename(testfile), { kind \"binary\", files testfile, languages \"c++11\", packages \"doctest\", defines \"DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN\"}) end end) ``` é€šè¿‡ `kind \"binary\"` å¯ä»¥å°†æ¯ä¸ªå•å…ƒæµ‹è¯•æ”¹ä¸º binary å¯æ‰§è¡Œç¨‹åºï¼Œå¹¶é€šè¿‡ `DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN` å¼•å…¥ main å…¥å£å‡½æ•°ã€‚ è¿™æ ·å°±èƒ½å®ç°åŠ¨æ€åº“ç›®æ ‡ä¸­å¤–ç½®å¯è¿è¡Œçš„å•å…ƒæµ‹è¯•ã€‚ #### é…ç½®è¿è¡Œè¶…æ—¶ å¦‚æœä¸€äº›æµ‹è¯•ç¨‹åºé•¿æ—¶é—´è¿è¡Œä¸é€€å‡ºï¼Œå°±ä¼šå¡ä½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®è¶…æ—¶æ—¶é—´ï¼Œå¼ºåˆ¶é€€å‡ºï¼Œå¹¶è¿”å›å¤±è´¥ã€‚ ```lua target(\"test_timeout\", function() set_kind(\"binary\") set_default(false) add_files(\"src/run_timeout.cpp\") add_tests(\"run_timeout\", {run_timeout 1000}) end) ``` ```bash $ xmake test [100%]: test_timeout/run_timeout .................................... failed 1.006s run failed, exit code: 1, exit error: wait process timeout ```"},"/get_started/zh/module/extension-modules.html":{"title":"","content":" class: heading_no_counter # æ‰©å±•æ¨¡å— æ‰€æœ‰æ‰©å±•æ¨¡å—çš„ä½¿ç”¨ï¼Œéƒ½éœ€è¦é€šè¿‡ [import](/zh cn/manual/builtin_modules?id import) æ¥å£ï¼Œè¿›è¡Œå¯¼å…¥åæ‰èƒ½ä½¿ç”¨ã€‚ ## core.base.option ä¸€èˆ¬ç”¨äºè·å– xmake å‘½ä»¤å‚æ•°é€‰é¡¹çš„å€¼ï¼Œå¸¸ç”¨äºæ’ä»¶å¼€å‘ã€‚ ### option.get è·å–å‚æ•°é€‰é¡¹å€¼ åœ¨æ’ä»¶å¼€å‘ä¸­ç”¨äºè·å–å‚æ•°é€‰é¡¹å€¼ï¼Œä¾‹å¦‚ï¼š ```lua å¯¼å…¥é€‰é¡¹æ¨¡å— import(\"core.base.option\") æ’ä»¶å…¥å£å‡½æ•° function main(...) print(option.get(\"info\")) end ``` ä¸Šé¢çš„ä»£ç è·å– hello æ’ä»¶ï¼Œæ‰§è¡Œï¼š`xmake hello info xxxx` å‘½ä»¤æ—¶å€™ä¼ å…¥çš„ ` info ` é€‰é¡¹çš„å€¼ï¼Œå¹¶æ˜¾ç¤ºï¼š`xxxx` å¯¹äºé main å…¥å£çš„ task ä»»åŠ¡æˆ–æ’ä»¶ï¼Œå¯ä»¥è¿™ä¹ˆä½¿ç”¨ï¼š ```lua task(\"hello\", function() on_run(function () import(\"core.base.option\") print(option.get(\"info\")) end) end) ``` ## core.base.global ç”¨äºè·å– xmake å…¨å±€çš„é…ç½®ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ `xmake gglobal xxx val` ä¼ å…¥çš„å‚æ•°é€‰é¡¹å€¼ã€‚ ### global.get è·å–æŒ‡å®šé…ç½®å€¼ã€‚ ç±»ä¼¼ [config.get](#configget)ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯è¿™ä¸ªæ˜¯ä»å…¨å±€é…ç½®ä¸­è·å–ã€‚ ### global.load åŠ è½½é…ç½®ã€‚ ç±»ä¼¼ [global.get](#globalget)ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯è¿™ä¸ªæ˜¯ä»å…¨å±€é…ç½®ä¸­åŠ è½½ã€‚ ### global.directory è·å–å…¨å±€é…ç½®ä¿¡æ¯ç›®å½•ã€‚ é»˜è®¤ä¸º `~/.config` ç›®å½•ã€‚ ### global.dump æ‰“å°è¾“å‡ºæ‰€æœ‰å…¨å±€é…ç½®ä¿¡æ¯ã€‚ è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š ```lua { clean true , ccache \"ccache\" , xcode_dir \"/Applications/Xcode.app\" } ``` ## core.base.task ç”¨äºä»»åŠ¡æ“ä½œï¼Œä¸€èˆ¬ç”¨äºåœ¨è‡ªå®šä¹‰è„šæœ¬ä¸­ã€æ’ä»¶ä»»åŠ¡ä¸­ï¼Œè°ƒç”¨è¿è¡Œå…¶ä»– task ä»»åŠ¡ã€‚ ### task.run è¿è¡ŒæŒ‡å®šä»»åŠ¡ã€‚ ç”¨äºåœ¨è‡ªå®šä¹‰è„šæœ¬ã€æ’ä»¶ä»»åŠ¡ä¸­è¿è¡Œ [task](#task) å®šä¹‰çš„ä»»åŠ¡æˆ–æ’ä»¶ï¼Œä¾‹å¦‚ï¼š ```lua task(\"hello\", function() on_run(function () print(\"hello xmake!\") end) end) target(\"demo\", function() on_clean(function(target) å¯¼å…¥ task æ¨¡å— import(\"core.base.task\") è¿è¡Œè¿™ä¸ª hello task task.run(\"hello\") end) end) ``` æˆ‘ä»¬è¿˜å¯ä»¥åœ¨è¿è¡Œä»»åŠ¡æ—¶ï¼Œå¢åŠ å‚æ•°ä¼ é€’ï¼Œä¾‹å¦‚ï¼š ```lua task(\"hello\", function() on_run(function (arg1, arg2) print(\"hello xmake: %s %s!\", arg1, arg2) end) end) target(\"demo\", function() on_clean(function(target) å¯¼å…¥ task import(\"core.base.task\") {} è¿™ä¸ªæ˜¯ç»™ç¬¬ä¸€ç§é€‰é¡¹ä¼ å‚ä½¿ç”¨ï¼Œè¿™é‡Œç½®ç©ºï¼Œè¿™é‡Œåœ¨æœ€åé¢ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼šarg1, arg2 task.run(\"hello\", {}, \"arg1\", \"arg2\") end) end) ``` å¯¹äº `task.run` çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨äºä¼ é€’å‘½ä»¤è¡Œèœå•ä¸­çš„é€‰é¡¹ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ å…¥ `function (arg, ...)` å‡½æ•°å…¥å£ä¸­ï¼Œä¾‹å¦‚ï¼š ```lua å¯¼å…¥ task import(\"core.base.task\") æ’ä»¶å…¥å£ function main(...) è¿è¡Œå†…ç½®çš„ xmake é…ç½®ä»»åŠ¡ï¼Œç›¸å½“äºï¼šxmake fconfig plat iphoneos arch armv7 task.run(\"config\", {plat \"iphoneos\", arch \"armv7\"}) end ``` ## core.base.json xmake æä¾›äº†å†…ç½®çš„ json æ¨¡å—ï¼ŒåŸºäº lua_cjson å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒå®ç°å¿«é€Ÿçš„åœ¨ json å’Œ lua table ç›´æ¥ç›¸äº’æ“ä½œã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ `import(\"core.base.json\")` ç›´æ¥å¯¼å…¥ä½¿ç”¨ã€‚ è¿™é‡Œä¹Ÿæœ‰ä¸€äº›ä¾‹å­ï¼š[Jsom Examples](https://github.com/xmake io/xmake/blob/master/tests/modules/json/test.lua) ### json.decode ç›´æ¥ä»å­—ç¬¦ä¸²è§£ç  json è·å– lua table. ```lua import(\"core.base.json\") local luatable json.decode('[1,\"2\", {\"a\":1,\"b\":true}]') print(luatable) ``` ``` { 1.0, \"2\", { b true, a 1.0 } } ``` > å¦‚æœé‡Œé¢æœ‰ nullï¼Œå¯ä»¥ç”¨ `json.null` æ¥åˆ¤æ–­ ### json.encode æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥å¯¹ä¸€ä¸ª lua table è¿›è¡Œç¼–ç ã€‚ ```lua local jsonstr json.encode({1, \"2\", {a 1}}) ``` éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœéœ€è¦ç¼–ç  nullï¼Œéœ€è¦ä½¿ç”¨ `json.null`ï¼Œä¾‹å¦‚ ```lua local jsonstr json.encode({json.null, 1, \"2\", false, true}) ``` ### json.loadfile ç›´æ¥åŠ è½½ json æ–‡ä»¶ï¼Œå¹¶è§£ææˆ lua tableã€‚ ```lua local luatable json.loadfile(\"/tmp/xxx.json\") ``` ### json.savefile ä¿å­˜ lua table åˆ°æŒ‡å®š json æ–‡ä»¶ã€‚ ```lua json.savefile(\"/tmp/xxx.json\", {1, {a 1}}) ``` ## core.tool.linker é“¾æ¥å™¨ç›¸å…³æ“ä½œï¼Œå¸¸ç”¨äºæ’ä»¶å¼€å‘ã€‚ ### linker.link æ‰§è¡Œé“¾æ¥ã€‚ é’ˆå¯¹ targetï¼Œé“¾æ¥æŒ‡å®šå¯¹è±¡æ–‡ä»¶åˆ—è¡¨ï¼Œç”Ÿæˆå¯¹åº”çš„ç›®æ ‡æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š ```lua linker.link(\"binary\", \"cc\", {\"a.o\", \"b.o\", \"c.o\"}, target:targetfile(), {target target}) ``` å…¶ä¸­ [target](#target)ï¼Œä¸ºå·¥ç¨‹ç›®æ ‡ï¼Œè¿™é‡Œä¼ å…¥ï¼Œä¸»è¦ç”¨äºè·å– target ç‰¹å®šçš„é“¾æ¥é€‰é¡¹ï¼Œå…·ä½“å¦‚æœè·å–å·¥ç¨‹ç›®æ ‡å¯¹è±¡ï¼Œè§ï¼š[core.project.project](#core project project) å½“ç„¶ä¹Ÿå¯ä»¥ä¸æŒ‡å®š targetï¼Œä¾‹å¦‚ï¼š ```lua linker.link(\"binary\", \"cc\", {\"a.o\", \"b.o\", \"c.o\"}, \"/tmp/targetfile\") ``` ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šé“¾æ¥ç±»å‹ï¼Œç›®å‰æ”¯æŒï¼šbinary, static, shared ç¬¬äºŒä¸ªå‚æ•°å‘Šè¯‰é“¾æ¥å™¨ï¼Œåº”è¯¥ä½œä¸ºé‚£ç§æºæ–‡ä»¶å¯¹è±¡è¿›è¡Œé“¾æ¥ï¼Œè¿™äº›å¯¹è±¡æºæ–‡ä»¶ä½¿ç”¨ä»€ä¹ˆç¼–è¯‘å™¨ç¼–è¯‘çš„ï¼Œä¾‹å¦‚ï¼š ç¬¬äºŒä¸ªå‚æ•°å€¼ æè¿° cc c ç¼–è¯‘å™¨ cxx c++ ç¼–è¯‘å™¨ mm objc ç¼–è¯‘å™¨ mxx objc++ ç¼–è¯‘å™¨ gc go ç¼–è¯‘å™¨ as æ±‡ç¼–å™¨ sc swift ç¼–è¯‘å™¨ rc rust ç¼–è¯‘å™¨ dc dlang ç¼–è¯‘å™¨ æŒ‡å®šä¸åŒçš„ç¼–è¯‘å™¨ç±»å‹ï¼Œé“¾æ¥å™¨ä¼šé€‚é…æœ€åˆé€‚çš„é“¾æ¥å™¨æ¥å¤„ç†é“¾æ¥ï¼Œå¹¶ä¸”å¦‚æœå‡ ç§æ”¯æŒæ··åˆç¼–è¯‘çš„è¯­è¨€ï¼Œé‚£ä¹ˆå¯ä»¥åŒæ—¶ä¼ å…¥å¤šä¸ªç¼–è¯‘å™¨ç±»å‹ï¼ŒæŒ‡å®šé“¾æ¥å™¨é€‰æ‹©æ”¯æŒè¿™äº›æ··åˆç¼–è¯‘è¯­è¨€çš„é“¾æ¥å™¨è¿›è¡Œé“¾æ¥å¤„ç†ï¼š ```lua linker.link(\"binary\", {\"cc\", \"mxx\", \"sc\"}, {\"a.o\", \"b.o\", \"c.o\"}, \"/tmp/targetfile\") ``` ä¸Šè¿°ä»£ç å‘Šè¯‰é“¾æ¥å™¨ï¼Œa, b, c ä¸‰ä¸ªå¯¹è±¡æ–‡ä»¶æœ‰å¯èƒ½åˆ†åˆ«æ˜¯ c, objc++, swift ä»£ç ç¼–è¯‘å‡ºæ¥çš„ï¼Œé“¾æ¥å™¨ä¼šä»å½“å‰ç³»ç»Ÿå’Œå·¥å…·é“¾ä¸­é€‰æ‹©æœ€åˆé€‚çš„é“¾æ¥å™¨å»å¤„ç†è¿™ä¸ªé“¾æ¥è¿‡ç¨‹ã€‚ ### linker.linkcmd è·å–é“¾æ¥å‘½ä»¤è¡Œå­—ç¬¦ä¸²ã€‚ ç›´æ¥è·å– [linker.link](#linkerlink) ä¸­æ‰§è¡Œçš„å‘½ä»¤è¡Œå­—ç¬¦ä¸²ï¼Œç›¸å½“äºï¼š ```lua local cmdstr linker.linkcmd(\"static\", \"cxx\", {\"a.o\", \"b.o\", \"c.o\"}, target:targetfile(), {target target}) ``` æ³¨ï¼šåé¢ `{target target}` æ‰©å±•å‚æ•°éƒ¨åˆ†æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¼ é€’äº† target å¯¹è±¡ï¼Œé‚£ä¹ˆç”Ÿæˆçš„é“¾æ¥å‘½ä»¤ï¼Œä¼šåŠ ä¸Šè¿™ä¸ª target é…ç½®å¯¹åº”çš„é“¾æ¥é€‰é¡¹ã€‚ å¹¶ä¸”è¿˜å¯ä»¥è‡ªå·±ä¼ é€’å„ç§é…ç½®ï¼Œä¾‹å¦‚ï¼š ```lua local cmdstr linker.linkcmd(\"static\", \"cxx\", {\"a.o\", \"b.o\", \"c.o\"}, target:targetfile(), {configs {linkdirs \"/usr/lib\"}}) ``` ### linker.linkargv è·å–é“¾æ¥å‘½ä»¤è¡Œå‚æ•°åˆ—è¡¨ã€‚ è·Ÿ [linker.linkcmd](#linkerlinkchtml) ç¨å¾®æœ‰ç‚¹åŒºåˆ«çš„æ˜¯ï¼Œæ­¤æ¥å£è¿”å›çš„æ˜¯å‚æ•°åˆ—è¡¨ï¼Œtable è¡¨ç¤ºï¼Œæ›´åŠ æ–¹ä¾¿æ“ä½œï¼š ```lua local program, argv linker.linkargv(\"static\", \"cxx\", {\"a.o\", \"b.o\", \"c.o\"}, target:targetfile(), {target target}) ``` å…¶ä¸­è¿”å›çš„ç¬¬ä¸€ä¸ªå€¼æ˜¯ä¸»ç¨‹åºåï¼Œåé¢æ˜¯å‚æ•°åˆ—è¡¨ï¼Œè€Œ `os.args(table.join(program, argv))` ç­‰ä»·äº `linker.linkcmd`ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¼ å…¥è¿”å›å€¼ç»™ [os.runv](#os runv) æ¥ç›´æ¥è¿è¡Œå®ƒï¼š`os.runv(linker.linkargv(..))` ### linker.linkflags è·å–é“¾æ¥é€‰é¡¹ã€‚ è·å– [linker.linkcmd](#linkerlinkchtml) ä¸­çš„é“¾æ¥é€‰é¡¹å­—ç¬¦ä¸²éƒ¨åˆ†ï¼Œä¸å¸¦ shellname å’Œå¯¹è±¡æ–‡ä»¶åˆ—è¡¨ï¼Œå¹¶ä¸”æ˜¯æŒ‰æ•°ç»„è¿”å›ï¼Œä¾‹å¦‚ï¼š ```lua local flags linker.linkflags(\"shared\", \"cc\", {target target}) for _, flag in ipairs(flags) do print(flag) end ``` è¿”å›çš„æ˜¯ flags çš„åˆ—è¡¨æ•°ç»„ã€‚ ### linker.has_flags åˆ¤æ–­æŒ‡å®šé“¾æ¥é€‰é¡¹æ˜¯å¦æ”¯æŒã€‚ è™½ç„¶é€šè¿‡ [lib.detect.has_flags](detect has_flags) ä¹Ÿèƒ½åˆ¤æ–­ï¼Œä½†æ˜¯é‚£ä¸ªæ¥å£æ›´åŠ åº•å±‚ï¼Œéœ€è¦æŒ‡å®šé“¾æ¥å™¨åç§° è€Œæ­¤æ¥å£åªéœ€è¦æŒ‡å®š target çš„ç›®æ ‡ç±»å‹ï¼Œæºæ–‡ä»¶ç±»å‹ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ‡æ¢é€‰æ‹©å½“å‰æ”¯æŒçš„é“¾æ¥å™¨ã€‚ ```lua if linker.has_flags(target:targetkind(), target:sourcekinds(), \" L/usr/lib lpthread\") then ok end ``` ## core.tool.compiler ç¼–è¯‘å™¨ç›¸å…³æ“ä½œï¼Œå¸¸ç”¨äºæ’ä»¶å¼€å‘ã€‚ ### compiler.compile æ‰§è¡Œç¼–è¯‘ã€‚ é’ˆå¯¹ targetï¼Œé“¾æ¥æŒ‡å®šå¯¹è±¡æ–‡ä»¶åˆ—è¡¨ï¼Œç”Ÿæˆå¯¹åº”çš„ç›®æ ‡æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š ```lua compiler.compile(\"xxx.c\", \"xxx.o\", \"xxx.h.d\", {target target}) ``` å…¶ä¸­ [target](#target)ï¼Œä¸ºå·¥ç¨‹ç›®æ ‡ï¼Œè¿™é‡Œä¼ å…¥ä¸»è¦ç”¨äºè·å– taeget çš„ç‰¹å®šç¼–è¯‘é€‰é¡¹ï¼Œå…·ä½“å¦‚æœè·å–å·¥ç¨‹ç›®æ ‡å¯¹è±¡ï¼Œè§ï¼š[core.project.project](#core project project) è€Œ `xxx.h.d` æ–‡ä»¶ç”¨äºå­˜å‚¨ä¸ºæ­¤æºæ–‡ä»¶çš„å¤´æ–‡ä»¶ä¾èµ–æ–‡ä»¶åˆ—è¡¨ï¼Œæœ€åè¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œç¼–è¯‘çš„æ—¶å€™å¯ä»¥ä¸ä¼ ä»–ä»¬ï¼š ```lua compiler.compile(\"xxx.c\", \"xxx.o\") ``` æ¥å•çº¯ç¼–è¯‘ä¸€ä¸ªæºæ–‡ä»¶ã€‚ ### compiler.compcmd è·å–ç¼–è¯‘å‘½ä»¤è¡Œã€‚ ç›´æ¥è·å– [compiler.compile](#compilercompile) ä¸­æ‰§è¡Œçš„å‘½ä»¤è¡Œå­—ç¬¦ä¸²ï¼Œç›¸å½“äºï¼š ```lua local cmdstr compiler.compcmd(\"xxx.c\", \"xxx.o\", {target target}) ``` æ³¨ï¼šåé¢ `{target target}` æ‰©å±•å‚æ•°éƒ¨åˆ†æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¼ é€’äº† target å¯¹è±¡ï¼Œé‚£ä¹ˆç”Ÿæˆçš„ç¼–è¯‘å‘½ä»¤ï¼Œä¼šåŠ ä¸Šè¿™ä¸ª target é…ç½®å¯¹åº”çš„é“¾æ¥é€‰é¡¹ã€‚ å¹¶ä¸”è¿˜å¯ä»¥è‡ªå·±ä¼ é€’å„ç§é…ç½®ï¼Œä¾‹å¦‚ï¼š ```lua local cmdstr compiler.compcmd(\"xxx.c\", \"xxx.o\", {configs {includedirs \"/usr/include\", defines \"DEBUG\"}}) ``` é€šè¿‡ targetï¼Œæˆ‘ä»¬å¯ä»¥å¯¼å‡ºæŒ‡å®šç›®æ ‡çš„æ‰€æœ‰æºæ–‡ä»¶ç¼–è¯‘å‘½ä»¤ï¼š ```lua import(\"core.project.project\") for _, target in pairs(project.targets()) do for sourcekind, sourcebatch in pairs(target:sourcebatches()) do for index, objectfile in ipairs(sourcebatch.objectfiles) do local cmdstr compiler.compcmd(sourcebatch.sourcefiles[index], objectfile, {target target}) end end end ``` ### compiler.compargv è·å–ç¼–è¯‘å‘½ä»¤è¡Œåˆ—è¡¨ã€‚ è·Ÿ [compiler.compcmd](#compilercompchtml) ç¨å¾®æœ‰ç‚¹åŒºåˆ«çš„æ˜¯ï¼Œæ­¤æ¥å£è¿”å›çš„æ˜¯å‚æ•°åˆ—è¡¨ï¼Œtable è¡¨ç¤ºï¼Œæ›´åŠ æ–¹ä¾¿æ“ä½œï¼š ```lua local program, argv compiler.compargv(\"xxx.c\", \"xxx.o\") ``` ### compiler.compflags è·å–ç¼–è¯‘é€‰é¡¹ã€‚ è·å– [compiler.compcmd](#compilercompchtml) ä¸­çš„ç¼–è¯‘é€‰é¡¹å­—ç¬¦ä¸²éƒ¨åˆ†ï¼Œä¸å¸¦ shellname å’Œæ–‡ä»¶åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼š ```lua local flags compiler.compflags(sourcefile, {target target}) for _, flag in ipairs(flags) do print(flag) end ``` è¿”å›çš„æ˜¯ flags çš„åˆ—è¡¨æ•°ç»„ã€‚ ### compiler.has_flags åˆ¤æ–­æŒ‡å®šç¼–è¯‘é€‰é¡¹æ˜¯å¦æ”¯æŒ è™½ç„¶é€šè¿‡ [lib.detect.has_flags](detect has_flags) ä¹Ÿèƒ½åˆ¤æ–­ï¼Œä½†æ˜¯é‚£ä¸ªæ¥å£æ›´åŠ åº•å±‚ï¼Œéœ€è¦æŒ‡å®šç¼–è¯‘å™¨åç§°ã€‚ è€Œæ­¤æ¥å£åªéœ€è¦æŒ‡å®šè¯­è¨€ç±»å‹ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ‡æ¢é€‰æ‹©å½“å‰æ”¯æŒçš„ç¼–è¯‘å™¨ã€‚ ```lua åˆ¤æ–­ c è¯­è¨€ç¼–è¯‘å™¨æ˜¯å¦æ”¯æŒé€‰é¡¹: g if compiler.has_flags(\"c\", \" g\") then ok end åˆ¤æ–­ c++ è¯­è¨€ç¼–è¯‘å™¨æ˜¯å¦æ”¯æŒé€‰é¡¹: g if compiler.has_flags(\"cxx\", \" g\") then ok end ``` ### compiler.features è·å–æ‰€æœ‰ç¼–è¯‘å™¨ç‰¹æ€§ è™½ç„¶é€šè¿‡ [lib.detect.features](detect features) ä¹Ÿèƒ½è·å–ï¼Œä½†æ˜¯é‚£ä¸ªæ¥å£æ›´åŠ åº•å±‚ï¼Œéœ€è¦æŒ‡å®šç¼–è¯‘å™¨åç§°ã€‚ è€Œæ­¤æ¥å£åªéœ€è¦æŒ‡å®šè¯­è¨€ç±»å‹ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ‡æ¢é€‰æ‹©å½“å‰æ”¯æŒçš„ç¼–è¯‘å™¨ï¼Œç„¶åè·å–å½“å‰çš„ç¼–è¯‘å™¨ç‰¹æ€§åˆ—è¡¨ã€‚ ```lua è·å–å½“å‰ c è¯­è¨€ç¼–è¯‘å™¨çš„æ‰€æœ‰ç‰¹æ€§ local features compiler.features(\"c\") è·å–å½“å‰ c++ è¯­è¨€ç¼–è¯‘å™¨çš„æ‰€æœ‰ç‰¹æ€§ï¼Œå¯ç”¨ c++11 æ ‡å‡†ï¼Œå¦åˆ™è·å–ä¸åˆ°æ–°æ ‡å‡†çš„ç‰¹æ€§ local features compiler.features(\"cxx\", {configs {cxxflags \" std c++11\"}}) è·å–å½“å‰ c++ è¯­è¨€ç¼–è¯‘å™¨çš„æ‰€æœ‰ç‰¹æ€§ï¼Œä¼ é€’å·¥ç¨‹ target çš„æ‰€æœ‰é…ç½®ä¿¡æ¯ local features compiler.features(\"cxx\", {target target, configs {defines \"..\", includedirs \"..\"}}) ``` æ‰€æœ‰ c ç¼–è¯‘å™¨ç‰¹æ€§åˆ—è¡¨ï¼š ç‰¹æ€§å c_static_assert c_restrict c_variadic_macros c_function_prototypes æ‰€æœ‰ c++ ç¼–è¯‘å™¨ç‰¹æ€§åˆ—è¡¨ï¼š ç‰¹æ€§å cxx_variable_templates cxx_relaxed_constexpr cxx_aggregate_default_initializers cxx_contextual_conversions cxx_attribute_deprecated cxx_decltype_auto cxx_digit_separators cxx_generic_lambdas cxx_lambda_init_captures cxx_binary_literals cxx_return_type_deduction cxx_decltype_incomplete_return_types cxx_reference_qualified_functions cxx_alignof cxx_attributes cxx_inheriting_constructors cxx_thread_local cxx_alias_templates cxx_delegating_constructors cxx_extended_friend_declarations cxx_final cxx_nonstatic_member_init cxx_override cxx_user_literals cxx_constexpr cxx_defaulted_move_initializers cxx_enum_forward_declarations cxx_noexcept cxx_nullptr cxx_range_for cxx_unrestricted_unions cxx_explicit_conversions cxx_lambdas cxx_local_type_template_args cxx_raw_string_literals cxx_auto_type cxx_defaulted_functions cxx_deleted_functions cxx_generalized_initializers cxx_inline_namespaces cxx_sizeof_member cxx_strong_enums cxx_trailing_return_types cxx_unicode_literals cxx_uniform_initialization cxx_variadic_templates cxx_decltype cxx_default_function_template_args cxx_long_long_type cxx_right_angle_brackets cxx_rvalue_references cxx_static_assert cxx_extern_templates cxx_func_identifier cxx_variadic_macros cxx_template_template_parameters ### compiler.has_features åˆ¤æ–­æŒ‡å®šçš„ç¼–è¯‘å™¨ç‰¹æ€§æ˜¯å¦æ”¯æŒã€‚ è™½ç„¶é€šè¿‡ [lib.detect.has_features](detect has features) ä¹Ÿèƒ½è·å–ï¼Œä½†æ˜¯é‚£ä¸ªæ¥å£æ›´åŠ åº•å±‚ï¼Œéœ€è¦æŒ‡å®šç¼–è¯‘å™¨åç§°ã€‚ è€Œæ­¤æ¥å£åªéœ€è¦æŒ‡å®šéœ€è¦æ£€æµ‹çš„ç‰¹å§“åç§°åˆ—è¡¨ï¼Œå°±èƒ½è‡ªåŠ¨åˆ‡æ¢é€‰æ‹©å½“å‰æ”¯æŒçš„ç¼–è¯‘å™¨ï¼Œç„¶ååˆ¤æ–­æŒ‡å®šç‰¹æ€§åœ¨å½“å‰çš„ç¼–è¯‘å™¨ä¸­æ˜¯å¦æ”¯æŒã€‚ ```lua if compiler.has_features(\"c_static_assert\") then ok end if compiler.has_features({\"c_static_assert\", \"cxx_constexpr\"}, {languages \"cxx11\"}) then ok end if compiler.has_features(\"cxx_constexpr\", {target target, defines \"..\", includedirs \"..\"}) then ok end ``` å…·ä½“ç‰¹æ€§åæœ‰å“ªäº›ï¼Œå¯ä»¥å‚è€ƒï¼š[compiler.features](#compilerfeatures)ã€‚ ## core.project.config ç”¨äºè·å–å·¥ç¨‹ç¼–è¯‘æ—¶å€™çš„é…ç½®ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ `xmake fconfig xxx val` ä¼ å…¥çš„å‚æ•°é€‰é¡¹å€¼ã€‚ ### config.get è·å–æŒ‡å®šé…ç½®å€¼ã€‚ ç”¨äºè·å– `xmake fconfig xxx val` çš„é…ç½®å€¼ï¼Œä¾‹å¦‚ï¼š ```lua target(\"test\") on_run(function (target) å¯¼å…¥é…ç½®æ¨¡å— import(\"core.project.config\") è·å–é…ç½®å€¼ print(config.get(\"xxx\")) end) ``` ### config.load åŠ è½½é…ç½®ã€‚ ä¸€èˆ¬ç”¨äºæ’ä»¶å¼€å‘ä¸­ï¼Œæ’ä»¶ä»»åŠ¡ä¸­ä¸åƒå·¥ç¨‹çš„è‡ªå®šä¹‰è„šæœ¬ï¼Œç¯å¢ƒéœ€è¦è‡ªå·±åˆå§‹åŒ–åŠ è½½ï¼Œé»˜è®¤å·¥ç¨‹é…ç½®æ˜¯æ²¡æœ‰è¢«åŠ è½½çš„ï¼Œå¦‚æœè¦ç”¨ [config.get](#configget) æ¥å£è·å–å·¥ç¨‹é…ç½®ï¼Œé‚£ä¹ˆéœ€è¦å…ˆï¼š ```lua å¯¼å…¥é…ç½®æ¨¡å— import(\"core.project.config\") function main(...) å…ˆåŠ è½½å·¥ç¨‹é…ç½® config.load() è·å–é…ç½®å€¼ print(config.get(\"xxx\")) end ``` ### config.arch è·å–å½“å‰å·¥ç¨‹çš„æ¶æ„é…ç½®ã€‚ ä¹Ÿå°±æ˜¯è·å– `xmake fconfig arch armv7` çš„å¹³å°é…ç½®ï¼Œç›¸å½“äº `config.get(\"arch\")`ã€‚ ### config.plat è·å–å½“å‰å·¥ç¨‹çš„å¹³å°é…ç½®ã€‚ ä¹Ÿå°±æ˜¯è·å– `xmake fconfig plat iphoneos` çš„å¹³å°é…ç½®ï¼Œç›¸å½“äº `config.get(\"plat\")`ã€‚ ### config.mode è·å–å½“å‰å·¥ç¨‹çš„ç¼–è¯‘æ¨¡å¼é…ç½®ã€‚ ä¹Ÿå°±æ˜¯è·å– `xmake fconfig mode debug` çš„å¹³å°é…ç½®ï¼Œç›¸å½“äº `config.get(\"mode\")`ã€‚ ### config.buildir è·å–å½“å‰å·¥ç¨‹çš„è¾“å‡ºç›®å½•é…ç½®ã€‚ ä¹Ÿå°±æ˜¯è·å– `xmake fconfig o /tmp/output` çš„å¹³å°é…ç½®ï¼Œç›¸å½“äº `config.get(\"buildir\")`ã€‚ ### config.directory è·å–å½“å‰å·¥ç¨‹çš„é…ç½®ä¿¡æ¯ç›®å½•ã€‚ è·å–å·¥ç¨‹é…ç½®çš„å­˜å‚¨ç›®å½•ï¼Œé»˜è®¤ä¸ºï¼š`projectdir/.config` ### config.dump æ‰“å°è¾“å‡ºå½“å‰å·¥ç¨‹çš„æ‰€æœ‰é…ç½®ä¿¡æ¯ã€‚ è¾“å‡ºç»“æœä¾‹å¦‚ï¼š ```lua { sh \"xcrun sdk macosx clang++\" , xcode_dir \"/Applications/Xcode.app\" , ar \"xcrun sdk macosx ar\" , small true , object false , arch \"x86_64\" , xcode_sdkver \"10.12\" , ex \"xcrun sdk macosx ar\" , cc \"xcrun sdk macosx clang\" , rc \"rustc\" , plat \"macosx\" , micro false , host \"macosx\" , as \"xcrun sdk macosx clang\" , dc \"dmd\" , gc \"go\" , openssl false , ccache \"ccache\" , cxx \"xcrun sdk macosx clang\" , sc \"xcrun sdk macosx swiftc\" , mm \"xcrun sdk macosx clang\" , buildir \"build\" , mxx \"xcrun sdk macosx clang++\" , ld \"xcrun sdk macosx clang++\" , mode \"release\" , kind \"static\" } ``` ## core.project.project ç”¨äºè·å–å½“å‰å·¥ç¨‹çš„ä¸€äº›æè¿°ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯åœ¨ `xmake.lua` å·¥ç¨‹æè¿°æ–‡ä»¶ä¸­å®šä¹‰çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š[target](#target)ã€[option](#option) ç­‰ã€‚ ### project.load åŠ è½½å·¥ç¨‹æè¿°é…ç½®ã€‚ ä»…åœ¨æ’ä»¶ä¸­ä½¿ç”¨ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰åŠ è½½å·¥ç¨‹é…ç½®ä¿¡æ¯ï¼Œåœ¨å·¥ç¨‹ç›®æ ‡çš„è‡ªå®šä¹‰è„šæœ¬ä¸­ï¼Œä¸éœ€è¦æ‰§è¡Œæ­¤æ“ä½œï¼Œå°±å¯ä»¥ç›´æ¥è®¿é—®å·¥ç¨‹é…ç½®ã€‚ ```lua å¯¼å…¥å·¥ç¨‹æ¨¡å— import(\"core.project.project\") æ’ä»¶å…¥å£ function main(...) åŠ è½½å·¥ç¨‹æè¿°é…ç½® project.load() è®¿é—®å·¥ç¨‹æè¿°ï¼Œä¾‹å¦‚è·å–æŒ‡å®šå·¥ç¨‹ç›®æ ‡ local target project.target(\"test\") end ``` ### project.directory è·å–å·¥ç¨‹ç›®å½• è·å–å½“å‰å·¥ç¨‹ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ `xmake P xxx` ä¸­æŒ‡å®šçš„ç›®å½•ï¼Œå¦åˆ™ä¸ºé»˜è®¤å½“å‰ `xmake` å‘½ä»¤æ‰§è¡Œç›®å½•ã€‚ > å»ºè®®ä½¿ç”¨ [os.projectdir](#os projectdir) æ¥è·å–ã€‚ ### project.target è·å–æŒ‡å®šå·¥ç¨‹ç›®æ ‡å¯¹è±¡ã€‚ è·å–å’Œè®¿é—®æŒ‡å®šå·¥ç¨‹ç›®æ ‡é…ç½®ï¼Œä¾‹å¦‚ï¼š ```lua local target project.target(\"test\") if target then è·å–ç›®æ ‡å print(target:name()) è·å–ç›®æ ‡ç›®å½•, 2.1.9 ç‰ˆæœ¬ä¹‹åæ‰æœ‰ print(target:targetdir()) è·å–ç›®æ ‡æ–‡ä»¶å print(target:targetfile()) è·å–ç›®æ ‡ç±»å‹ï¼Œä¹Ÿå°±æ˜¯ï¼šbinary, static, shared print(target:targetkind()) è·å–ç›®æ ‡å print(target:name()) è·å–ç›®æ ‡æºæ–‡ä»¶ local sourcefiles target:sourcefiles() è·å–ç›®æ ‡å®‰è£…å¤´æ–‡ä»¶åˆ—è¡¨ local srcheaders, dstheaders target:headerfiles() è·å–ç›®æ ‡ä¾èµ– print(target:get(\"deps\")) end ``` ### project.targets è·å–å·¥ç¨‹ç›®æ ‡å¯¹è±¡åˆ—è¡¨ã€‚ è¿”å›å½“å‰å·¥ç¨‹çš„æ‰€æœ‰ç¼–è¯‘ç›®æ ‡ï¼Œä¾‹å¦‚ï¼š ```lua for targetname, target in pairs(project.targets()) print(target:targetfile()) end ``` ### project.option è·å–æŒ‡å®šé€‰é¡¹å¯¹è±¡ã€‚ è·å–å’Œè®¿é—®å·¥ç¨‹ä¸­æŒ‡å®šçš„é€‰é¡¹å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š ```lua local option project.option(\"test\") if option:enabled() then option:enable(false) end ``` ### project.options è·å–å·¥ç¨‹æ‰€æœ‰é€‰é¡¹å¯¹è±¡ã€‚ è¿”å›å½“å‰å·¥ç¨‹çš„æ‰€æœ‰ç¼–è¯‘ç›®æ ‡ï¼Œä¾‹å¦‚ï¼š ```lua for optionname, option in pairs(project.options()) print(option:enabled()) end ``` ### project.name è·å–å½“å‰å·¥ç¨‹åã€‚ ä¹Ÿå°±æ˜¯è·å– [set_project](#set_project) çš„å·¥ç¨‹åé…ç½®ã€‚ ```lua print(project.name()) ``` ### project.version è·å–å½“å‰å·¥ç¨‹ç‰ˆæœ¬å·ã€‚ ä¹Ÿå°±æ˜¯è·å– [set_version](#set_version) çš„å·¥ç¨‹ç‰ˆæœ¬é…ç½®ã€‚ ```lua print(project.version()) ``` ## core.language.language ç”¨äºè·å–ç¼–è¯‘è¯­è¨€ç›¸å…³ä¿¡æ¯ï¼Œä¸€èˆ¬ç”¨äºä»£ç æ–‡ä»¶çš„æ“ä½œã€‚ ### language.extensions è·å–æ‰€æœ‰è¯­è¨€çš„ä»£ç åç¼€ååˆ—è¡¨ã€‚ è·å–ç»“æœå¦‚ä¸‹ï¼š ```lua { [\".c\"] cc , [\".cc\"] cxx , [\".cpp\"] cxx , [\".m\"] mm , [\".mm\"] mxx , [\".swift\"] sc , [\".go\"] gc } ``` ### language.targetkinds è·å–æ‰€æœ‰è¯­è¨€çš„ç›®æ ‡ç±»å‹åˆ—è¡¨ã€‚ è·å–ç»“æœå¦‚ä¸‹ï¼š ```lua { binary {\"ld\", \"gcld\", \"dcld\"} , static {\"ar\", \"gcar\", \"dcar\"} , shared {\"sh\", \"dcsh\"} } ``` ### language.sourcekinds è·å–æ‰€æœ‰è¯­è¨€çš„æºæ–‡ä»¶ç±»å‹åˆ—è¡¨ã€‚ è·å–ç»“æœå¦‚ä¸‹ï¼š ```lua { cc \".c\" , cxx {\".cc\", \".cpp\", \".cxx\"} , mm \".m\" , mxx \".mm\" , sc \".swift\" , gc \".go\" , rc \".rs\" , dc \".d\" , as {\".s\", \".S\", \".asm\"} } ``` ### language.sourceflags åŠ è½½æ‰€æœ‰è¯­è¨€çš„æºæ–‡ä»¶ç¼–è¯‘é€‰é¡¹ååˆ—è¡¨ã€‚ è·å–ç»“æœå¦‚ä¸‹ï¼š ```lua { cc {\"cflags\", \"cxflags\"} , cxx {\"cxxflags\", \"cxflags\"} , ... } ``` ### language.load åŠ è½½æŒ‡å®šè¯­è¨€ã€‚ ä»è¯­è¨€åç§°åŠ è½½å…·ä½“è¯­è¨€å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š ```lua local lang language.load(\"c++\") if lang then print(lang:name()) end ``` ### language.load_sk ä»æºæ–‡ä»¶ç±»å‹åŠ è½½æŒ‡å®šè¯­è¨€ã€‚ ä»æºæ–‡ä»¶ç±»å‹ï¼š`cc, cxx, mm, mxx, sc, gc, as ..` åŠ è½½å…·ä½“è¯­è¨€å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š ```lua local lang language.load_sk(\"cxx\") if lang then print(lang:name()) end ``` ### language.load_ex ä»æºæ–‡ä»¶åç¼€ååŠ è½½æŒ‡å®šè¯­è¨€ã€‚ ä»æºæ–‡ä»¶åç¼€åï¼š`.cc, .c, .cpp, .mm, .swift, .go ..` åŠ è½½å…·ä½“è¯­è¨€å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š ```lua local lang language.load_sk(\".cpp\") if lang then print(lang:name()) end ``` ### language.sourcekind_of è·å–æŒ‡å®šæºæ–‡ä»¶çš„æºæ–‡ä»¶ç±»å‹ã€‚ ä¹Ÿå°±æ˜¯ä»ç»™å®šçš„ä¸€ä¸ªæºæ–‡ä»¶è·¯å¾„ï¼Œè·å–å®ƒæ˜¯å±äºé‚£ç§æºæ–‡ä»¶ç±»å‹ï¼Œä¾‹å¦‚ï¼š ```lua print(language.sourcekind_of(\"/xxxx/test.cpp\")) ``` æ˜¾ç¤ºç»“æœä¸ºï¼š`cxx`ï¼Œä¹Ÿå°±æ˜¯ `c++` ç±»å‹ï¼Œå…·ä½“å¯¹åº”åˆ—è¡¨è§ï¼š[language.sourcekinds](#languagesourcekinds) ## lib.detect æ­¤æ¨¡å—æä¾›äº†éå¸¸å¼ºå¤§çš„æ¢æµ‹åŠŸèƒ½ï¼Œç”¨äºæ¢æµ‹ç¨‹åºã€ç¼–è¯‘å™¨ã€è¯­è¨€ç‰¹æ€§ã€ä¾èµ–åŒ…ç­‰ã€‚ > æ­¤æ¨¡å—çš„æ¥å£åˆ†æ•£åœ¨å¤šä¸ªæ¨¡å—ç›®å½•ä¸­ï¼Œå°½é‡é€šè¿‡å¯¼å…¥å•ä¸ªæ¥å£æ¥ä½¿ç”¨ï¼Œè¿™æ ·æ•ˆç‡æ›´é«˜ã€‚ ### detect.find_file æŸ¥æ‰¾æ–‡ä»¶ã€‚ è¿™ä¸ªæ¥å£æä¾›äº†æ¯” [os.files](#os files) æ›´åŠ å¼ºå¤§çš„å·¥ç¨‹ï¼Œ å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªæœç´¢ç›®å½•ï¼Œå¹¶ä¸”è¿˜èƒ½å¯¹æ¯ä¸ªç›®å½•æŒ‡å®šé™„åŠ çš„å­ç›®å½•ï¼Œæ¥æ¨¡å¼åŒ¹é…æŸ¥æ‰¾ï¼Œç›¸å½“äºæ˜¯ [os.files](#os files) çš„å¢å¼ºç‰ˆã€‚ ä¾‹å¦‚ï¼š ```lua import(\"lib.detect.find_file\") local file find_file(\"ccache\", { \"/usr/bin\", \"/usr/local/bin\"}) ``` å¦‚æœæ‰¾åˆ°ï¼Œè¿”å›çš„ç»“æœæ˜¯ï¼š`/usr/bin/ccache` å®ƒåŒæ—¶ä¹Ÿæ”¯æŒæ¨¡å¼åŒ¹é…è·¯å¾„ï¼Œè¿›è¡Œé€’å½’æŸ¥æ‰¾ï¼Œç±»ä¼¼ `os.files`ï¼š ```lua local file find_file(\"test.h\", { \"/usr/include\", \"/usr/local/include/**\"}) ``` ä¸ä»…å¦‚æ­¤ï¼Œé‡Œé¢çš„è·¯å¾„ä¹Ÿæ”¯æŒå†…å»ºå˜é‡ï¼Œæ¥ä»ç¯å¢ƒå˜é‡å’Œæ³¨å†Œè¡¨ä¸­è·å–è·¯å¾„è¿›è¡ŒæŸ¥æ‰¾ï¼š ```lua local file find_file(\"xxx.h\", { \"$(env PATH)\", \"$(reg HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\XXXX;Name)\"}) ``` å¦‚æœè·¯å¾„è§„åˆ™æ¯”è¾ƒå¤æ‚å¤šå˜ï¼Œè¿˜å¯ä»¥é€šè¿‡è‡ªå®šä¹‰è„šæœ¬æ¥åŠ¨æ€ç”Ÿæˆè·¯å¾„ä¼ å…¥ï¼š ```lua local file find_file(\"xxx.h\", { \"$(env PATH)\", function () return val(\"HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\XXXX;Name\"):match(\"\\\"(. )\\\"\") end}) ``` å¤§éƒ¨åˆ†åœºåˆä¸‹ï¼Œä¸Šé¢çš„ä½¿ç”¨å·²ç»æ»¡è¶³å„ç§éœ€æ±‚äº†ï¼Œå¦‚æœè¿˜éœ€è¦ä¸€äº›æ‰©å±•åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œè‡ªå®šä¹‰ä¸€äº›å¯é€‰é…ç½®ï¼Œä¾‹å¦‚ï¼š ```lua local file find_file(\"test.h\", { \"/usr\", \"/usr/local\"}, {suffixes {\"/include\", \"/lib\"}}) ``` é€šè¿‡æŒ‡å®š suffixes å­ç›®å½•åˆ—è¡¨ï¼Œå¯ä»¥æ‰©å±•è·¯å¾„åˆ—è¡¨ï¼ˆç¬¬äºŒä¸ªå‚æ•°ï¼‰ï¼Œä½¿å¾—å®é™…çš„æœç´¢ç›®å½•æ‰©å±•ä¸ºï¼š ``` /usr/include /usr/lib /usr/local/include /usr/local/lib ``` å¹¶ä¸”ä¸ç”¨æ”¹å˜è·¯å¾„åˆ—è¡¨ï¼Œå°±èƒ½åŠ¨æ€åˆ‡æ¢å­ç›®å½•æ¥æœç´¢æ–‡ä»¶ã€‚ > æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `xmake lua` æ’ä»¶æ¥å¿«é€Ÿè°ƒç”¨å’Œæµ‹è¯•æ­¤æ¥å£ï¼š`xmake lua lib.detect.find_file test.h /usr/local` ### detect.find_path æŸ¥æ‰¾è·¯å¾„ã€‚ è¿™ä¸ªæ¥å£çš„ç”¨æ³•è·Ÿ [lib.detect.find_file](#detectfind_file) ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯è¿”å›çš„ç»“æœä¸åŒã€‚ æ­¤æ¥å£æŸ¥æ‰¾åˆ°ä¼ å…¥çš„æ–‡ä»¶è·¯å¾„åï¼Œè¿”å›çš„æ˜¯å¯¹åº”çš„æœç´¢è·¯å¾„ï¼Œè€Œä¸æ˜¯æ–‡ä»¶è·¯å¾„æœ¬èº«ï¼Œä¸€èˆ¬ç”¨äºæŸ¥æ‰¾æ–‡ä»¶å¯¹åº”çš„çˆ¶ç›®å½•ä½ç½®ã€‚ ```lua import(\"lib.detect.find_path\") local p find_path(\"include/test.h\", { \"/usr\", \"/usr/local\"}) ``` ä¸Šè¿°ä»£ç å¦‚æœæŸ¥æ‰¾æˆåŠŸï¼Œåˆ™è¿”å›ï¼š`/usr/local`ï¼Œå¦‚æœ `test.h` åœ¨ `/usr/local/include/test.h` çš„è¯ã€‚ è¿˜æœ‰ä¸€ä¸ªåŒºåˆ«å°±æ˜¯ï¼Œè¿™ä¸ªæ¥å£ä¼ å…¥ä¸åªæ˜¯æ–‡ä»¶è·¯å¾„ï¼Œè¿˜å¯ä»¥ä¼ å…¥ç›®å½•è·¯å¾„æ¥æŸ¥æ‰¾ï¼š ```lua local p find_path(\"lib/xxx\", { \"$(env PATH)\", \"$(reg HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\XXXX;Name)\"}) ``` åŒæ ·ï¼Œæ­¤æ¥å£ä¹Ÿæ”¯æŒæ¨¡å¼åŒ¹é…å’Œåç¼€å­ç›®å½•ï¼š ```lua local p find_path(\"include/*.h\", { \"/usr\", \"/usr/local/**\"}, {suffixes \"/subdir\"}) ``` ### detect.find_library æŸ¥æ‰¾åº“æ–‡ä»¶ã€‚ æ­¤æ¥å£ç”¨äºæŒ‡å®šçš„æœç´¢ç›®å½•ä¸­æŸ¥æ‰¾åº“æ–‡ä»¶ï¼ˆé™æ€åº“ï¼ŒåŠ¨æ€åº“ï¼‰ï¼Œä¾‹å¦‚ï¼š ```lua import(\"lib.detect.find_library\") local library find_library(\"crypto\", {\"/usr/lib\", \"/usr/local/lib\"}) ``` åœ¨ macosx ä¸Šè¿è¡Œï¼Œè¿”å›çš„ç»“æœå¦‚ä¸‹ï¼š ```lua { filename libcrypto.dylib , linkdir /usr/lib , link crypto , kind shared } ``` å¦‚æœä¸æŒ‡å®šæ˜¯å¦éœ€è¦é™æ€åº“è¿˜æ˜¯åŠ¨æ€åº“ï¼Œé‚£ä¹ˆæ­¤æ¥å£ä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå­˜åœ¨çš„åº“ï¼ˆæœ‰å¯èƒ½æ˜¯é™æ€åº“ã€ä¹Ÿæœ‰å¯èƒ½æ˜¯åŠ¨æ€åº“ï¼‰è¿›è¡Œè¿”å›ã€‚ å¦‚æœéœ€è¦å¼ºåˆ¶æŒ‡å®šéœ€è¦æŸ¥æ‰¾çš„åº“ç±»å‹ï¼Œå¯ä»¥æŒ‡å®š kind å‚æ•°ä¸ºï¼ˆ`static/shared`ï¼‰ï¼š ```lua local library find_library(\"crypto\", {\"/usr/lib\", \"/usr/local/lib\"}, {kind \"static\"}) ``` æ­¤æ¥å£ä¹Ÿæ”¯æŒ suffixes åç¼€å­ç›®å½•æœç´¢å’Œæ¨¡å¼åŒ¹é…æ“ä½œï¼š ```lua local library find_library(\"cryp*\", {\"/usr\", \"/usr/local\"}, {suffixes \"/lib\"}) ``` ### detect.find_program æŸ¥æ‰¾å¯æ‰§è¡Œç¨‹åºã€‚ è¿™ä¸ªæ¥å£æ¯” [lib.detect.find_tool](#detectfind_tool) è¾ƒä¸ºåŸå§‹åº•å±‚ï¼Œé€šè¿‡æŒ‡å®šçš„å‚æ•°ç›®å½•æ¥æŸ¥æ‰¾å¯æ‰§è¡Œç¨‹åºã€‚ ```lua import(\"lib.detect.find_program\") local program find_program(\"ccache\") ``` ä¸Šè¿°ä»£ç çŠ¹å¦‚æ²¡æœ‰ä¼ é€’æœç´¢ç›®å½•ï¼Œæ‰€ä»¥å®ƒä¼šå°è¯•ç›´æ¥æ‰§è¡ŒæŒ‡å®šç¨‹åºï¼Œå¦‚æœè¿è¡Œ okï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ï¼š`ccache`ï¼Œè¡¨ç¤ºæŸ¥æ‰¾æˆåŠŸã€‚ æŒ‡å®šæœç´¢ç›®å½•ï¼Œä¿®æ”¹å°è¯•è¿è¡Œçš„æ£€æµ‹å‘½ä»¤å‚æ•°ï¼ˆé»˜è®¤æ˜¯ï¼š`ccache version`ï¼‰ï¼š ```lua local program find_program(\"ccache\", {paths {\"/usr/bin\", \"/usr/local/bin\"}, check \" help\"}) ``` ä¸Šè¿°ä»£ç ä¼šå°è¯•è¿è¡Œï¼š`/usr/bin/ccache help`ï¼Œå¦‚æœè¿è¡ŒæˆåŠŸï¼Œåˆ™è¿”å›ï¼š`/usr/bin/ccache`ã€‚ å¦‚æœ ` help` ä¹Ÿæ²¡æ³•æ»¡è¶³éœ€æ±‚ï¼Œæœ‰äº›ç¨‹åºæ²¡æœ‰ ` version/ help` å‚æ•°ï¼Œé‚£ä¹ˆå¯ä»¥è‡ªå®šä¹‰è¿è¡Œè„šæœ¬ï¼Œæ¥è¿è¡Œæ£€æµ‹ï¼š ```lua local program find_program(\"ccache\", {paths {\"/usr/bin\", \"/usr/local/bin\"}, check function (program) os.run(\"%s h\", program) end}) ``` åŒæ ·ï¼Œæœç´¢è·¯å¾„åˆ—è¡¨æ”¯æŒå†…å»ºå˜é‡å’Œè‡ªå®šä¹‰è„šæœ¬ï¼š ```lua local program find_program(\"ccache\", {paths {\"$(env PATH)\", \"$(reg HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\AeDebug;Debugger)\"}}) local program find_program(\"ccache\", {paths {\"$(env PATH)\", function () return \"/usr/local/bin\" end}}) ``` <p class \"tip\"> ä¸ºäº†åŠ é€Ÿé¢‘å‘æŸ¥æ‰¾çš„æ•ˆç‡ï¼Œæ­¤æ¥å£æ˜¯é»˜è®¤è‡ªå¸¦ cache çš„ï¼Œæ‰€ä»¥å°±ç®—é¢‘ç¹æŸ¥æ‰¾ç›¸åŒçš„ç¨‹åºï¼Œä¹Ÿä¸ä¼šèŠ±å¤ªå¤šæ—¶é—´ã€‚ å¦‚æœè¦ç¦ç”¨ cacheï¼Œå¯ä»¥åœ¨å·¥ç¨‹ç›®å½•æ‰§è¡Œ `xmake f c` æ¸…é™¤æœ¬åœ° cacheã€‚ </p> æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `xmake lua lib.detect.find_program ccache` æ¥å¿«é€Ÿæµ‹è¯•ã€‚ ### detect.find_programver æŸ¥æ‰¾å¯æ‰§è¡Œç¨‹åºç‰ˆæœ¬å·ã€‚ ```lua import(\"lib.detect.find_programver\") local programver find_programver(\"ccache\") ``` è¿”å›ç»“æœä¸ºï¼š3.2.2 é»˜è®¤å®ƒä¼šé€šè¿‡ `ccache version` å°è¯•è·å–ç‰ˆæœ¬ï¼Œå¦‚æœä¸å­˜åœ¨æ­¤å‚æ•°ï¼Œå¯ä»¥è‡ªå·±æŒ‡å®šå…¶ä»–å‚æ•°ï¼š ```lua local version find_programver(\"ccache\", {command \" v\"}) ``` ç”šè‡³è‡ªå®šä¹‰ç‰ˆæœ¬è·å–è„šæœ¬ï¼š ```lua local version find_programver(\"ccache\", {command function () return os.iorun(\"ccache version\") end}) ``` å¯¹äºç‰ˆæœ¬å·çš„æå–è§„åˆ™ï¼Œå¦‚æœå†…ç½®çš„åŒ¹é…æ¨¡å¼ä¸æ»¡è¶³è¦æ±‚ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼š ```lua local version find_programver(\"ccache\", {command \" version\", parse \"(%d+%.?%d*%.?%d*. )%s\"}) local version find_programver(\"ccache\", {command \" version\", parse function (output) return output:match(\"(%d+%.?%d*%.?%d*. )%s\") end}) ``` > ä¸ºäº†åŠ é€Ÿé¢‘å‘æŸ¥æ‰¾çš„æ•ˆç‡ï¼Œæ­¤æ¥å£æ˜¯é»˜è®¤è‡ªå¸¦ cache çš„ï¼Œå¦‚æœè¦ç¦ç”¨ cacheï¼Œå¯ä»¥åœ¨å·¥ç¨‹ç›®å½•æ‰§è¡Œ `xmake f c` æ¸…é™¤æœ¬åœ° cacheã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `xmake lua lib.detect.find_programver ccache` æ¥å¿«é€Ÿæµ‹è¯•ã€‚ ### detect.find_package æŸ¥æ‰¾åŒ…æ–‡ä»¶ã€‚ è¿™ä¸ªæ¥å£ä¸æ¨èç›´æ¥ä½¿ç”¨ï¼ˆä»…ä¾›å†…éƒ¨ä½¿ç”¨ï¼‰ï¼Œåº“é›†æˆï¼Œè¯·å°½é‡ä½¿ç”¨ `add_requires()` å’Œ `add_packages()`ã€‚ ### detect.find_tool æŸ¥æ‰¾å·¥å…·ã€‚ æ­¤æ¥å£ä¹Ÿæ˜¯ç”¨äºæŸ¥æ‰¾å¯æ‰§è¡Œç¨‹åºï¼Œä¸è¿‡æ¯” [lib.detect.find_program](#detectfind_program) æ›´åŠ çš„é«˜çº§ï¼ŒåŠŸèƒ½ä¹Ÿæ›´åŠ å¼ºå¤§ï¼Œå®ƒå¯¹å¯æ‰§è¡Œç¨‹åºè¿›è¡Œäº†å°è£…ï¼Œæä¾›äº†å·¥å…·è¿™ä¸ªæ¦‚å¿µï¼š toolname: å·¥å…·åï¼Œå¯æ‰§è¡Œç¨‹åºçš„ç®€ç§°ï¼Œç”¨äºæ ‡ç¤ºæŸä¸ªå·¥å…·ï¼Œä¾‹å¦‚ï¼š`gcc`, `clang` ç­‰ program: å¯æ‰§è¡Œç¨‹åºå‘½ä»¤ï¼Œä¾‹å¦‚ï¼š`xcrun sdk macosx clang` å…¶å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š toolname program clang `xcrun sdk macosx clang` gcc `/usr/toolchains/bin/arm linux gcc` link `link.exe lib` [lib.detect.find_program](#detectfind_program) åªèƒ½é€šè¿‡ä¼ å…¥çš„åŸå§‹ program å‘½ä»¤æˆ–è·¯å¾„ï¼Œå»åˆ¤æ–­è¯¥ç¨‹åºæ˜¯å¦å­˜åœ¨ã€‚ è€Œ `find_tool` åˆ™å¯ä»¥é€šè¿‡æ›´åŠ ä¸€è‡´çš„ toolname å»æŸ¥æ‰¾å·¥å…·ï¼Œå¹¶ä¸”è¿”å›å¯¹åº”çš„ program å®Œæ•´å‘½ä»¤è·¯å¾„ï¼Œä¾‹å¦‚ï¼š ```lua import(\"lib.detect.find_tool\") local tool find_tool(\"clang\") ``` è¿”å›çš„ç»“æœä¸ºï¼š`{name \"clang\", program \"clang\"}`ï¼Œè¿™ä¸ªæ—¶å€™è¿˜çœ‹ä¸å‡ºåŒºåˆ«ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æŒ‡å®šå¯æ‰§è¡Œçš„å‘½ä»¤ï¼š ```lua local tool find_tool(\"clang\", {program \"xcrun sdk macosx clang\"}) ``` è¿”å›çš„ç»“æœä¸ºï¼š`{name \"clang\", program \"xcrun sdk macosx clang\"}` è€Œåœ¨ macosx ä¸‹ï¼Œgcc å°±æ˜¯ clangï¼Œå¦‚æœæˆ‘ä»¬æ‰§è¡Œ `gcc version` å¯ä»¥çœ‹åˆ°å°±æ˜¯ clang çš„ä¸€ä¸ªé©¬ç”²ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `find_tool` æ¥å£è¿›è¡Œæ™ºèƒ½è¯†åˆ«ï¼š ```lua local tool find_tool(\"gcc\") ``` è¿”å›çš„ç»“æœä¸ºï¼š`{name \"clang\", program \"gcc\"}` é€šè¿‡è¿™ä¸ªç»“æœå°±å¯ä»¥çœ‹çš„åŒºåˆ«æ¥äº†ï¼Œå·¥å…·åå®é™…ä¼šè¢«æ ‡ç¤ºä¸º clangï¼Œä½†æ˜¯å¯æ‰§è¡Œçš„å‘½ä»¤ç”¨çš„æ˜¯ gccã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®š `{version true}` å‚æ•°å»è·å–å·¥å…·çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„æœç´¢è·¯å¾„ï¼Œä¹Ÿæ”¯æŒå†…å»ºå˜é‡å’Œè‡ªå®šä¹‰è„šæœ¬å“¦ï¼š ```lua local tool find_tool(\"clang\", {version true, paths {\"/usr/bin\", \"/usr/local/bin\", \"$(env PATH)\", function () return \"/usr/xxx/bin\" end}}) ``` è¿”å›çš„ç»“æœä¸ºï¼š`{name \"clang\", program \"/usr/bin/clang\", version \"4.0\"}` è¿™ä¸ªæ¥å£æ˜¯å¯¹ `find_program` çš„ä¸Šå±‚å°è£…ï¼Œå› æ­¤ä¹Ÿæ”¯æŒè‡ªå®šä¹‰è„šæœ¬æ£€æµ‹ï¼š ```lua local tool find_tool(\"clang\", {check \" help\"}) local tool find_tool(\"clang\", {check function (tool) os.run(\"%s h\", tool) end}) ``` æœ€åæ€»ç»“ä¸‹ï¼Œ`find_tool` çš„æŸ¥æ‰¾æµç¨‹ï¼š 1. ä¼˜å…ˆé€šè¿‡ `{program \"xxx\"}` çš„å‚æ•°æ¥å°è¯•è¿è¡Œå’Œæ£€æµ‹ã€‚ 2. å¦‚æœåœ¨ `xmake/modules/detect/tools` ä¸‹å­˜åœ¨ `detect.tools.find_xxx` è„šæœ¬ï¼Œåˆ™è°ƒç”¨æ­¤è„šæœ¬è¿›è¡Œæ›´åŠ ç²¾å‡†çš„æ£€æµ‹ã€‚ 3. å°è¯•ä» `/usr/bin`ï¼Œ`/usr/local/bin` ç­‰ç³»ç»Ÿç›®å½•è¿›è¡Œæ£€æµ‹ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å·¥ç¨‹ `xmake.lua` ä¸­ `add_moduledirs` æŒ‡å®šçš„æ¨¡å—ç›®å½•ä¸­ï¼Œæ·»åŠ è‡ªå®šä¹‰æŸ¥æ‰¾è„šæœ¬ï¼Œæ¥æ”¹è¿›æ£€æµ‹æœºåˆ¶ï¼š ``` projectdir xmake/modules detect/tools/find_xxx.lua ``` ä¾‹å¦‚æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ª `find_7z.lua` çš„æŸ¥æ‰¾è„šæœ¬ï¼š ```lua import(\"lib.detect.find_program\") import(\"lib.detect.find_programver\") function main(opt) init options opt opt or {} find program local program find_program(opt.program or \"7z\", opt.pathes, opt.check or \" help\") find program version local version nil if program and opt and opt.version then version find_programver(program, \" help\", \"(%d+%.?%d*)%s\") end ok? return program, version end ``` å°†å®ƒæ”¾ç½®åˆ°å·¥ç¨‹çš„æ¨¡å—ç›®å½•ä¸‹åï¼Œæ‰§è¡Œï¼š`xmake l lib.detect.find_tool 7z` å°±å¯ä»¥æŸ¥æ‰¾åˆ°äº†ã€‚ > ä¸ºäº†åŠ é€Ÿé¢‘å‘æŸ¥æ‰¾çš„æ•ˆç‡ï¼Œæ­¤æ¥å£æ˜¯é»˜è®¤è‡ªå¸¦ cache çš„ï¼Œå¦‚æœè¦ç¦ç”¨ cacheï¼Œå¯ä»¥åœ¨å·¥ç¨‹ç›®å½•æ‰§è¡Œ `xmake f c` æ¸…é™¤æœ¬åœ° cacheã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `xmake lua lib.detect.find_tool clang` æ¥å¿«é€Ÿæµ‹è¯•ã€‚ ### detect.find_toolname æŸ¥æ‰¾å·¥å…·åã€‚ é€šè¿‡ program å‘½ä»¤åŒ¹é…å¯¹åº”çš„å·¥å…·åï¼Œä¾‹å¦‚ï¼š program toolname `xcrun sdk macosx clang` clang `/usr/bin/arm linux gcc` gcc `link.exe lib` link `gcc 5` gcc `arm android clang++` clangxx `pkg config` pkg_config toolname ç›¸æ¯” programï¼Œæ›´èƒ½å”¯ä¸€æ ‡ç¤ºæŸä¸ªå·¥å…·ï¼Œä¹Ÿæ–¹ä¾¿æŸ¥æ‰¾å’ŒåŠ è½½å¯¹åº”çš„è„šæœ¬ `find_xxx.lua`ã€‚ ### detect.find_cudadevices æŸ¥æ‰¾æœ¬æœºçš„ CUDA è®¾å¤‡ã€‚ é€šè¿‡ CUDA Runtime API æšä¸¾æœ¬æœºçš„ CUDA è®¾å¤‡ï¼Œå¹¶æŸ¥è¯¢å…¶å±æ€§ã€‚ ```lua import(\"lib.detect.find_cudadevices\") local devices find_cudadevices({skip_compute_mode_prohibited true}) local devices find_cudadevices({min_sm_arch 35, order_by_flops true}) ``` è¿”å›çš„ç»“æœä¸ºï¼š`{{ ['$id'] 0, name \"GeForce GTX 960M\", major 5, minor 0, ... }, ... }` åŒ…å«çš„å±æ€§ä¾æ®å½“å‰ CUDA ç‰ˆæœ¬ä¼šæœ‰æ‰€ä¸åŒï¼Œå¯ä»¥å‚è€ƒ [CUDA å®˜æ–¹æ–‡æ¡£](https://docs.nvidia.com/cuda/cuda runtime api/structcudaDeviceProp.html#structcudaDeviceProp) åŠå…¶å†å²ç‰ˆæœ¬ã€‚ ### detect.features è·å–æŒ‡å®šå·¥å…·çš„æ‰€æœ‰ç‰¹æ€§ã€‚ æ­¤æ¥å£è·Ÿ [compiler.features](#compilerfeatures) ç±»ä¼¼ï¼ŒåŒºåˆ«å°±æ˜¯æ­¤æ¥å£æ›´åŠ çš„åŸå§‹ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯å®é™…çš„å·¥å…·å toolnameã€‚ å¹¶ä¸”æ­¤æ¥å£ä¸ä»…èƒ½å¤Ÿè·å–ç¼–è¯‘å™¨çš„ç‰¹æ€§ï¼Œä»»ä½•å·¥å…·çš„ç‰¹æ€§éƒ½å¯ä»¥è·å–ï¼Œå› æ­¤æ›´åŠ é€šç”¨ã€‚ ```lua import(\"lib.detect.features\") local features features(\"clang\") local features features(\"clang\", {flags \" O0\", program \"xcrun sdk macosx clang\"}) local features features(\"clang\", {flags {\" g\", \" O0\", \" std c++11\"}}) ``` é€šè¿‡ä¼ å…¥ flagsï¼Œå¯ä»¥æ”¹å˜ç‰¹æ€§çš„è·å–ç»“æœï¼Œä¾‹å¦‚ä¸€äº› c++11 çš„ç‰¹æ€§ï¼Œé»˜è®¤æƒ…å†µä¸‹è·å–ä¸åˆ°ï¼Œé€šè¿‡å¯ç”¨ ` std c++11` åï¼Œå°±å¯ä»¥è·å–åˆ°äº†ã€‚ æ‰€æœ‰ç¼–è¯‘å™¨çš„ç‰¹æ€§åˆ—è¡¨ï¼Œå¯ä»¥è§ï¼š[compiler.features](#compilerfeatures)ã€‚ ### detect.has_features åˆ¤æ–­æŒ‡å®šç‰¹æ€§æ˜¯å¦æ”¯æŒã€‚ æ­¤æ¥å£è·Ÿ [compiler.has_features](#compilerhas_features) ç±»ä¼¼ï¼Œä½†æ˜¯æ›´åŠ åŸå§‹ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯å®é™…çš„å·¥å…·å toolnameã€‚ å¹¶ä¸”æ­¤æ¥å£ä¸ä»…èƒ½å¤Ÿåˆ¤æ–­ç¼–è¯‘å™¨çš„ç‰¹æ€§ï¼Œä»»ä½•å·¥å…·çš„ç‰¹æ€§éƒ½å¯ä»¥åˆ¤æ–­ï¼Œå› æ­¤æ›´åŠ é€šç”¨ã€‚ ```lua import(\"lib.detect.has_features\") local features has_features(\"clang\", \"cxx_constexpr\") local features has_features(\"clang\", {\"cxx_constexpr\", \"c_static_assert\"}, {flags {\" g\", \" O0\"}, program \"xcrun sdk macosx clang\"}) local features has_features(\"clang\", {\"cxx_constexpr\", \"c_static_assert\"}, {flags \" g\"}) ``` å¦‚æœæŒ‡å®šçš„ç‰¹æ€§åˆ—è¡¨å­˜åœ¨ï¼Œåˆ™è¿”å›å®é™…æ”¯æŒçš„ç‰¹æ€§å­åˆ—è¡¨ï¼Œå¦‚æœéƒ½ä¸æ”¯æŒï¼Œåˆ™è¿”å› nilï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®š flags å»æ”¹å˜ç‰¹æ€§çš„è·å–è§„åˆ™ã€‚ æ‰€æœ‰ç¼–è¯‘å™¨çš„ç‰¹æ€§åˆ—è¡¨ï¼Œå¯ä»¥è§ï¼š[compiler.features](#compilerfeatures)ã€‚ ### detect.has_flags åˆ¤æ–­æŒ‡å®šå‚æ•°é€‰é¡¹æ˜¯å¦æ”¯æŒã€‚ æ­¤æ¥å£è·Ÿ [compiler.has_flags](#compilerhas_flags) ç±»ä¼¼ï¼Œä½†æ˜¯æ›´åŠ åŸå§‹ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯å®é™…çš„å·¥å…·å toolnameã€‚ ```lua import(\"lib.detect.has_flags\") local ok has_flags(\"clang\", \" g\") local ok has_flags(\"clang\", {\" g\", \" O0\"}, {program \"xcrun sdk macosx clang\"}) local ok has_flags(\"clang\", \" g O0\", {toolkind \"cxx\"}) ``` å¦‚æœæ£€æµ‹é€šè¿‡ï¼Œåˆ™è¿”å› trueã€‚ æ­¤æ¥å£çš„æ£€æµ‹åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œé™¤äº† cache æœºåˆ¶å¤–ï¼Œå¤§éƒ¨åˆ†åœºåˆä¸‹ï¼Œä¼šå»æ‹‰å–å·¥å…·çš„é€‰é¡¹åˆ—è¡¨ï¼ˆ` help`ï¼‰ç›´æ¥åˆ¤æ–­ï¼Œå¦‚æœé€‰é¡¹åˆ—è¡¨é‡Œè·å–ä¸åˆ°çš„è¯ï¼Œæ‰ä¼šé€šè¿‡å°è¯•è¿è¡Œçš„æ–¹å¼æ¥æ£€æµ‹ã€‚ ### detect.has_cfuncs åˆ¤æ–­æŒ‡å®š c å‡½æ•°æ˜¯å¦å­˜åœ¨ã€‚ æ­¤æ¥å£æ˜¯ [lib.detect.check_cxsnippets](#detectcheck_cxsnippets) çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä»…ç”¨äºæ£€æµ‹å‡½æ•°ã€‚ ```lua import(\"lib.detect.has_cfuncs\") local ok has_cfuncs(\"setjmp\") local ok has_cfuncs({\"sigsetjmp((void*)0, 0)\", \"setjmp\"}, {includes \"setjmp.h\"}) ``` å¯¹äºå‡½æ•°çš„æè¿°è§„åˆ™å¦‚ä¸‹ï¼š å‡½æ•°æè¿° è¯´æ˜ `sigsetjmp` çº¯å‡½æ•°å `sigsetjmp((void*)0, 0)` å‡½æ•°è°ƒç”¨ `sigsetjmp{int a 0; sigsetjmp((void*)a, a);}` å‡½æ•°å + {} å— åœ¨æœ€åçš„å¯é€‰å‚æ•°ä¸­ï¼Œé™¤äº†å¯ä»¥æŒ‡å®š `includes` å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šå…¶ä»–çš„ä¸€äº›å‚æ•°ç”¨äºæ§åˆ¶ç¼–è¯‘æ£€æµ‹çš„é€‰é¡¹æ¡ä»¶ï¼š ```lua {verbose false, target [targetoption], includes .., configs {linkdirs .., links .., defines ..}} ``` å…¶ä¸­ verbose ç”¨äºå›æ˜¾æ£€æµ‹ä¿¡æ¯ï¼Œtarget ç”¨äºåœ¨æ£€æµ‹å‰è¿½åŠ  target ä¸­çš„é…ç½®ä¿¡æ¯, è€Œ config ç”¨äºè‡ªå®šä¹‰é…ç½®è·Ÿ target ç›¸å…³çš„ç¼–è¯‘é€‰é¡¹ã€‚ ### detect.has_cxxfuncs åˆ¤æ–­æŒ‡å®š c++ å‡½æ•°æ˜¯å¦å­˜åœ¨ã€‚ æ­¤æ¥å£è·Ÿ [lib.detect.has_cfuncs](#detecthas_cfuncs) ç±»ä¼¼ï¼Œè¯·ç›´æ¥å‚è€ƒå®ƒçš„ä½¿ç”¨è¯´æ˜ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯è¿™ä¸ªæ¥å£ç”¨äºæ£€æµ‹ c++ å‡½æ•°ã€‚ ### detect.has_cincludes åˆ¤æ–­æŒ‡å®š c å¤´æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚ æ­¤æ¥å£æ˜¯ [lib.detect.check_cxsnippets](#detectcheck_cxsnippets) çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä»…ç”¨äºæ£€æµ‹å¤´æ–‡ä»¶ã€‚ ```lua import(\"lib.detect.has_cincludes\") local ok has_cincludes(\"stdio.h\") local ok has_cincludes({\"stdio.h\", \"stdlib.h\"}, {target target}) local ok has_cincludes({\"stdio.h\", \"stdlib.h\"}, {configs {defines \"_GNU_SOURCE 1\", languages \"cxx11\"}}) ``` ### detect.has_cxxincludes åˆ¤æ–­æŒ‡å®š c++ å¤´æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚ æ­¤æ¥å£è·Ÿ [lib.detect.has_cincludess](#detecthas_cincludes) ç±»ä¼¼ï¼Œè¯·ç›´æ¥å‚è€ƒå®ƒçš„ä½¿ç”¨è¯´æ˜ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯è¿™ä¸ªæ¥å£ç”¨äºæ£€æµ‹ c++ å¤´æ–‡ä»¶ã€‚ ### detect.has_ctypes åˆ¤æ–­æŒ‡å®š c ç±»å‹æ˜¯å¦å­˜åœ¨ã€‚ æ­¤æ¥å£æ˜¯ [lib.detect.check_cxsnippets](#detectcheck_cxsnippets) çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä»…ç”¨äºæ£€æµ‹å‡½æ•°ã€‚ ```lua import(\"lib.detect.has_ctypes\") local ok has_ctypes(\"wchar_t\") local ok has_ctypes({\"char\", \"wchar_t\"}, {includes \"stdio.h\"}) local ok has_ctypes(\"wchar_t\", {includes {\"stdio.h\", \"stdlib.h\"}, configs {\"defines \"_GNU_SOURCE 1\", languages \"cxx11\"}}) ``` ### detect.has_cxxtypes åˆ¤æ–­æŒ‡å®š c++ ç±»å‹æ˜¯å¦å­˜åœ¨ã€‚ æ­¤æ¥å£è·Ÿ [lib.detect.has_ctypess](#detecthas_ctypes) ç±»ä¼¼ï¼Œè¯·ç›´æ¥å‚è€ƒå®ƒçš„ä½¿ç”¨è¯´æ˜ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯è¿™ä¸ªæ¥å£ç”¨äºæ£€æµ‹ c++ ç±»å‹ã€‚ ### detect.check_cxsnippets æ£€æµ‹ c/c++ ä»£ç ç‰‡æ®µæ˜¯å¦èƒ½å¤Ÿç¼–è¯‘é€šè¿‡ã€‚ é€šç”¨çš„ c/c++ ä»£ç ç‰‡æ®µæ£€æµ‹æ¥å£ï¼Œé€šè¿‡ä¼ å…¥å¤šä¸ªä»£ç ç‰‡æ®µåˆ—è¡¨ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç¼–è¯‘æ–‡ä»¶ï¼Œç„¶åå¸¸è¯†å¯¹å®ƒè¿›è¡Œç¼–è¯‘ï¼Œå¦‚æœç¼–è¯‘é€šè¿‡è¿”å› trueã€‚ å¯¹äºä¸€äº›å¤æ‚çš„ç¼–è¯‘å™¨ç‰¹æ€§ï¼Œè¿ [compiler.has_features](#compilerhas_features) éƒ½æ— æ³•æ£€æµ‹åˆ°çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡æ­¤æ¥å£é€šè¿‡å°è¯•ç¼–è¯‘æ¥æ£€æµ‹å®ƒã€‚ ```lua import(\"lib.detect.check_cxsnippets\") local ok check_cxsnippets(\"void test() {}\") local ok check_cxsnippets({\"void test(){}\", \"#define TEST 1\"}, {types \"wchar_t\", includes \"stdio.h\"}) ``` æ­¤æ¥å£æ˜¯ [detect.has_cfuncs](#detecthas_cfuncs), [detect.has_cincludes](#detecthas_cincludes) å’Œ[detect.has_ctypes](detect has_ctypes)ç­‰æ¥å£çš„é€šç”¨ç‰ˆæœ¬ï¼Œä¹Ÿæ›´åŠ åº•å±‚ã€‚ å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æ£€æµ‹ï¼štypes, functions, includes è¿˜æœ‰ linksï¼Œæˆ–è€…æ˜¯ç»„åˆèµ·æ¥ä¸€èµ·æ£€æµ‹ã€‚ ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä»£ç ç‰‡æ®µåˆ—è¡¨ï¼Œä¸€èˆ¬ç”¨äºä¸€äº›è‡ªå®šä¹‰ç‰¹æ€§çš„æ£€æµ‹ï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™å¯ä»¥ä»…ä»…æ£€æµ‹å¯é€‰å‚æ•°ä¸­æ¡ä»¶ï¼Œä¾‹å¦‚ï¼š ```lua local ok check_cxsnippets({}, {types {\"wchar_t\", \"char*\"}, includes \"stdio.h\", funcs {\"sigsetjmp\", \"sigsetjmp((void*)0, 0)\"}}) ``` ä¸Šé¢é‚£ä¸ªè°ƒç”¨ï¼Œä¼šå»åŒæ—¶æ£€æµ‹ types, includes å’Œ funcs æ˜¯å¦éƒ½æ»¡è¶³ï¼Œå¦‚æœé€šè¿‡è¿”å› trueã€‚ è¿˜æœ‰å…¶ä»–ä¸€äº›å¯é€‰å‚æ•°ï¼š ```lua {verbose false, target [targetoption], sourcekind \"[cccxx]\"} ``` å…¶ä¸­ verbose ç”¨äºå›æ˜¾æ£€æµ‹ä¿¡æ¯ï¼Œtarget ç”¨äºåœ¨æ£€æµ‹å‰è¿½åŠ  target ä¸­çš„é…ç½®ä¿¡æ¯, sourcekind ç”¨äºæŒ‡å®šç¼–è¯‘å™¨ç­‰å·¥å…·ç±»å‹ï¼Œä¾‹å¦‚ä¼ å…¥ `cxx` å¼ºåˆ¶ä½œä¸º c++ ä»£ç æ¥æ£€æµ‹ã€‚ ## net.http æ­¤æ¨¡å—æä¾› http çš„å„ç§æ“ä½œæ”¯æŒï¼Œç›®å‰æä¾›çš„æ¥å£å¦‚ä¸‹ï¼š ### http.download ä¸‹è½½ http æ–‡ä»¶ã€‚ è¿™ä¸ªæ¥å£æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å•çº¯çš„ä¸‹è½½æ–‡ä»¶ã€‚ ```lua import(\"net.http\") http.download(\"https://xmake.io\", \"/tmp/index.html\") ``` ## privilege.sudo æ­¤æ¥å£ç”¨äºé€šè¿‡ `sudo` æ¥è¿è¡Œå‘½ä»¤ï¼Œå¹¶ä¸”æä¾›äº†å¹³å°ä¸€è‡´æ€§å¤„ç†ï¼Œå¯¹äºä¸€äº›éœ€è¦ root æƒé™è¿è¡Œçš„è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ¥å£ã€‚ > ä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼Œé™¤éå¿…é¡»ä½¿ç”¨çš„åœºåˆï¼Œå…¶ä»–æƒ…å†µä¸‹å°½é‡ä¸è¦ä½¿ç”¨æ­¤æ¥å£ã€‚ ### sudo.has åˆ¤æ–­ sudo æ˜¯å¦æ”¯æŒã€‚ ç›®å‰ä»…åœ¨ `macosx/linux` ä¸‹æ”¯æŒ sudoï¼Œwindows ä¸Šçš„ç®¡ç†å‘˜æƒé™è¿è¡Œæš‚æ—¶è¿˜ä¸æ”¯æŒï¼Œå› æ­¤å»ºè®®ä½¿ç”¨å‰å¯ä»¥é€šè¿‡æ­¤æ¥å£åˆ¤æ–­æ”¯æŒæƒ…å†µåï¼Œé’ˆå¯¹æ€§å¤„ç†ã€‚ ```lua import(\"privilege.sudo\") if sudo.has() then sudo.run(\"rm /system/file\") end ``` ### sudo.run å®‰é™è¿è¡ŒåŸç”Ÿ shell å‘½ä»¤ã€‚ å…·ä½“ç”¨æ³•å¯å‚è€ƒï¼š[os.run](#os run)ã€‚ ```lua import(\"privilege.sudo\") sudo.run(\"rm /system/file\") ``` ### sudo.runv å®‰é™è¿è¡ŒåŸç”Ÿ shell å‘½ä»¤ï¼Œå¸¦å‚æ•°åˆ—è¡¨ã€‚ å…·ä½“ç”¨æ³•å¯å‚è€ƒï¼š[os.runv](#os runv)ã€‚ ### sudo.exec å›æ˜¾è¿è¡ŒåŸç”Ÿ shell å‘½ä»¤ã€‚ å…·ä½“ç”¨æ³•å¯å‚è€ƒï¼š[os.exec](#os exec)ã€‚ ### sudo.execv å›æ˜¾è¿è¡ŒåŸç”Ÿ shell å‘½ä»¤ï¼Œå¸¦å‚æ•°åˆ—è¡¨ã€‚ å…·ä½“ç”¨æ³•å¯å‚è€ƒï¼š[os.execv](#os execv)ã€‚ ### sudo.iorun å®‰é™è¿è¡ŒåŸç”Ÿ shell å‘½ä»¤å¹¶è·å–è¾“å‡ºå†…å®¹ã€‚ å…·ä½“ç”¨æ³•å¯å‚è€ƒï¼š[os.iorun](#os iorun)ã€‚ ### sudo.iorunv å®‰é™è¿è¡ŒåŸç”Ÿ shell å‘½ä»¤å¹¶è·å–è¾“å‡ºå†…å®¹ï¼Œå¸¦å‚æ•°åˆ—è¡¨ã€‚ å…·ä½“ç”¨æ³•å¯å‚è€ƒï¼š[os.iorunv](#os iorunv)ã€‚ ## devel.git æ­¤æ¥å£æä¾›äº† git å„ç§å‘½ä»¤çš„è®¿é—®æ¥å£ï¼Œç›¸å¯¹äºç›´æ¥è°ƒç”¨ git å‘½ä»¤ï¼Œæ­¤æ¨¡å—æä¾›äº†æ›´åŠ ä¸Šå±‚æ˜“ç”¨çš„å°è£…æ¥å£ï¼Œå¹¶ä¸”æä¾›å¯¹ git çš„è‡ªåŠ¨æ£€æµ‹å’Œè·¨å¹³å°å¤„ç†ã€‚ ### git.clone clone ä»£ç åº“ã€‚ æ­¤æ¥å£å¯¹åº” `git clone` å‘½ä»¤ ```lua import(\"devel.git\") git.clone(\"git@github.com:tboox/xmake.git\") git.clone(\"git@github.com:tboox/xmake.git\", {depth 1, branch \"master\", outputdir \"/tmp/xmake\"}) ``` ### git.pull æ‹‰å–ä»£ç åº“æœ€æ–°æäº¤ã€‚ æ­¤æ¥å£å¯¹åº” `git pull` å‘½ä»¤ ```lua import(\"devel.git\") git.pull() git.pull({remote \"origin\", tags true, branch \"master\", repodir \"/tmp/xmake\"}) ``` ### git.clean æ¸…ç†ä»£ç åº“æ–‡ä»¶ã€‚ æ­¤æ¥å£å¯¹åº” `git clean` å‘½ä»¤ ```lua import(\"devel.git\") git.clean() git.clean({repodir \"/tmp/xmake\", force true}) ``` ### git.checkout ç­¾å‡ºæŒ‡å®šåˆ†æ”¯ç‰ˆæœ¬ã€‚ æ­¤æ¥å£å¯¹åº” `git checkout` å‘½ä»¤ ```lua import(\"devel.git\") git.checkout(\"master\", {repodir \"/tmp/xmake\"}) git.checkout(\"v1.0.1\", {repodir \"/tmp/xmake\"}) ``` ### git.refs è·å–æ‰€æœ‰å¼•ç”¨åˆ—è¡¨ã€‚ æ­¤æ¥å£å¯¹åº” `git ls remote refs` å‘½ä»¤ ```lua import(\"devel.git\") local refs git.refs(url) ``` ### git.tags è·å–æ‰€æœ‰æ ‡è®°åˆ—è¡¨ã€‚ æ­¤æ¥å£å¯¹åº” `git ls remote tags` å‘½ä»¤ ```lua import(\"devel.git\") local tags git.tags(url) ``` ### git.branches è·å–æ‰€æœ‰åˆ†æ”¯åˆ—è¡¨ã€‚ æ­¤æ¥å£å¯¹åº” `git ls remote heads` å‘½ä»¤ ```lua import(\"devel.git\") local branches git.branches(url) ``` ## utils.archive æ­¤æ¨¡å—ç”¨äºå‹ç¼©å’Œè§£å‹æ–‡ä»¶ã€‚æ”¯æŒå¤§éƒ¨åˆ†å¸¸ç”¨å‹ç¼©æ ¼å¼çš„è§£å‹ç¼©ï¼Œå®ƒä¼šè‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿæä¾›äº†å“ªäº›å‹ç¼©å·¥å…·ï¼Œç„¶åä¼šä½¿ç”¨æœ€åˆé€‚çš„å‹ç¼©å·¥å…·è¿›è¡Œæ“ä½œã€‚ ### archive.archive å‹ç¼©æ–‡ä»¶ ```lua import(\"utils.archive\") archive.archive(\"/tmp/a.zip\", \"/tmp/outputdir\") archive.archive(\"/tmp/a.7z\", \"/tmp/outputdir\") archive.archive(\"/tmp/a.gzip\", \"/tmp/outputdir\") archive.archive(\"/tmp/a.tar.bz2\", \"/tmp/outputdir\") ``` è¿˜å¯ä»¥æ·»åŠ ä¸€äº›é…ç½®é€‰é¡¹ï¼Œå¦‚é€’å½’ç›®å½•ï¼Œå‹ç¼©è´¨é‡ï¼Œæ’é™¤æ–‡ä»¶ç­‰ã€‚ ```lua import(\"utils.archive\") local options {} options.curdir \"/tmp\" options.recurse true options.compress \"fastestfasterdefaultbetterbest\" options.excludes {\"*/dir/*\", \"dir/*\"} archive.archive(\"/tmp/a.zip\", \"/tmp/outputdir\", options) ``` ### archive.extract è§£å‹æ–‡ä»¶ã€‚ ```lua import(\"utils.archive\") archive.extract(\"/tmp/a.zip\", \"/tmp/outputdir\") archive.extract(\"/tmp/a.7z\", \"/tmp/outputdir\") archive.extract(\"/tmp/a.gzip\", \"/tmp/outputdir\") archive.extract(\"/tmp/a.tar.bz2\", \"/tmp/outputdir\") ``` ## utils.platform æ­¤æ¨¡å—ç”¨äºä¸€äº›å¹³å°ç›¸å…³çš„è¾…åŠ©æ“ä½œæ¥å£ ## cli ### cli.amalgamate åˆå¹¶æˆå•æºç æ–‡ä»¶ã€‚ è¿™æ˜¯ä¸€ä¸ªå°å·¥å…·æ¨¡å—ï¼Œä¸»è¦ç”¨äºå¿«é€Ÿåˆå¹¶æŒ‡å®š target é‡Œé¢çš„æ‰€æœ‰ c/c++ å’Œ å¤´æ–‡ä»¶æºç åˆ°å•ä¸ªæºæ–‡ä»¶ã€‚ åˆå¹¶ä¼šå°†å†…éƒ¨ includes å¤´æ–‡ä»¶å…¨éƒ¨å±•å¼€ï¼Œå¹¶ç”Ÿæˆ DAGï¼Œé€šè¿‡æ‹“æ‰‘æ’åºå¼•å…¥ã€‚ é»˜è®¤å®ƒä¼šå¤„ç†æ‰€æœ‰ target çš„åˆå¹¶ï¼Œä¾‹å¦‚ï¼š ```bash $ xmake l cli.amalgamate build/tbox.c generated! build/tbox.h generated! ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šåˆå¹¶éœ€è¦çš„ç›®æ ‡ï¼š ```bash $ xmake l cli.amalgamate tbox build/tbox.c generated! build/tbox.h generated! ``` ä¹Ÿå¯ä»¥åœ¨åˆå¹¶æ¯ä¸ªæºæ–‡ä»¶æ—¶å€™ï¼ŒæŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„ unique ID çš„å®å®šä¹‰ï¼Œæ¥å¤„ç†ç¬¦å·å†²çªé—®é¢˜ã€‚ ```bash $ xmake l cli.amalgamate u MY_UNIQUEU_ID build/tbox.c generated! build/tbox.h generated! ``` å¦‚æœå¤šä¸ªæºæ–‡ä»¶å†…éƒ¨æœ‰é‡åç¬¦å·ï¼Œå°±å¯ä»¥åˆ¤æ–­è¿™ä¸ª `MY_UNIQUEU_ID` å®æ˜¯å¦è¢«å®šä¹‰ï¼Œå¦‚æœå®šä¹‰äº†ï¼Œè¯´æ˜æ˜¯åœ¨å•æ–‡ä»¶ä¸­ï¼Œå°±è‡ªå·±åœ¨æºç ä¸­å¤„ç†ä¸‹é‡åç¬¦å·ã€‚ ```c #ifdef MY_UNIQUEU_ID // do some thing #endif ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šè¾“å‡ºä½ç½®ï¼š ```bash $ xmake l cli.amalgamate o /xxx /xxx/tbox.c generated! /xxx/tbox.h generated! ```"},"/get_started/zh/module/native-modules.html":{"title":"","content":" class: heading_no_counter # Lua åŸç”Ÿæ¨¡å— æ„å»ºæµç¨‹é‡Œå¯ä»¥ä½¿ç”¨åŸç”Ÿæ¨¡å—ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ xmake ä¸­ï¼Œå¯ä»¥é€šè¿‡ import æ¥å£å»å¯¼å…¥ä¸€äº› lua æ¨¡å—åœ¨è„šæœ¬åŸŸä¸­ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœä¸€äº›æ¨¡å—çš„æ“ä½œæ¯”è¾ƒè€—æ—¶ï¼Œé‚£ä¹ˆ lua å®ç°å¹¶ä¸æ˜¯ç†æƒ³çš„é€‰æ‹©ã€‚ å› æ­¤ï¼Œæ–°ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬æ–°å¢äº† native lua æ¨¡å—çš„æ”¯æŒï¼Œå¯ä»¥é€šè¿‡ native å®ç°ï¼Œæ¥è¾¾åˆ°æé€Ÿä¼˜åŒ–çš„æ•ˆæœï¼Œå¹¶ä¸”æ¨¡å—å¯¼å…¥å’Œä½¿ç”¨ï¼Œè¿˜æ˜¯è·Ÿ lua æ¨¡å—ä¸€æ ·ç®€å•ã€‚ ä½¿ç”¨åŸç”Ÿæ¨¡å—æ—¶ï¼Œxmake ä¼šè¿›è¡Œä¸¤æ®µç¼–è¯‘ï¼Œå…ˆä¼šè‡ªåŠ¨ç¼–è¯‘åŸç”Ÿæ¨¡å—ï¼Œåå°†æ¨¡å—å¯¼å…¥ lua ä½œä¸ºåº“æˆ–äºŒè¿›åˆ¶ï¼Œè€Œå¯¹äºç”¨æˆ·ï¼Œä»…ä»…åªéœ€è¦è°ƒç”¨ import å¯¼å…¥å³å¯ã€‚ ## å®šä¹‰åŠ¨æ€åº“æ¨¡å— åŠ¨æ€åº“æ¨¡å—çš„å¥½å¤„æ˜¯ï¼Œä¸ä»…ä»…é€šè¿‡ native å®ç°äº†æ€§èƒ½åŠ é€Ÿï¼Œå¦å¤–é¿å…äº†æ¯æ¬¡è°ƒç”¨é¢å¤–çš„å­è¿›ç¨‹åˆ›å»ºï¼Œå› æ­¤æ›´åŠ çš„è½»é‡ï¼Œé€Ÿåº¦è¿›ä¸€æ­¥å¾—åˆ°æå‡ã€‚ æˆ‘ä»¬å¯ä»¥å…ˆå®šä¹‰ä¸€ä¸ªåŠ¨æ€åº“æ¨¡å—ï¼Œé‡Œé¢å®Œå…¨æ”¯æŒ lua çš„æ‰€æœ‰ c APIï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ä¸€äº›ç¬¬ä¸‰æ–¹çš„å¼€æº lua native æ¨¡å—ç›´æ¥å¼•å…¥è¿›æ¥ä½¿ç”¨ã€‚ è¿™é‡Œæˆ‘ä»¬ä¹Ÿæœ‰ä¸€ä¸ªå®Œæ•´çš„å¯¼å…¥ lua cjson æ¨¡å—çš„ä¾‹å­å¯ä»¥å‚è€ƒï¼š[native_module_cjson](https://github.com/xmake io/xmake/tree/master/tests/projects/other/native_module_cjson) é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå®ç° shared çš„ native ä»£ç ï¼Œæ‰€ä»¥æ¥å£é€šè¿‡ lua API å¯¼å‡ºã€‚ ```c++ // ./modules/foo/foo.c #include <xmi.h> static int c_add(lua_State* lua) { int a lua_tointeger(lua, 1); int b lua_tointeger(lua, 2); lua_pushinteger(lua, a + b); return 1; } static int c_sub(lua_State* lua) { int a lua_tointeger(lua, 1); int b lua_tointeger(lua, 2); lua_pushinteger(lua, a b); return 1; } int luaopen(foo, lua_State* lua) { // æ”¶é›† add å’Œ sub static const luaL_Reg funcs[] { {\"add\", c_add}, {\"sub\", c_sub}, {NULL, NULL} }; lua_newtable(lua); // ä¼ é€’å‡½æ•°åˆ—è¡¨ luaL_setfuncs(lua, funcs, 0); return 1; } ``` æ³¨æ„åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ include äº†ä¸€ä¸ª `xmi.h` çš„æ¥å£å¤´æ–‡ä»¶ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥å¼•å…¥ `lua.h`ï¼Œ`luaconf.h`ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¼šæä¾›æ›´å¥½çš„è·¨å¹³å°æ€§ï¼Œå†…éƒ¨ä¼šè‡ªåŠ¨å¤„ç† lua/luajit è¿˜æœ‰ç‰ˆæœ¬é—´çš„å·®å¼‚ã€‚ ç„¶åï¼Œæˆ‘ä»¬é…ç½® `add_rules(\"modules.shared\")` ä½œä¸º shared native æ¨¡å—æ¥ç¼–è¯‘ï¼Œä¸éœ€è¦å¼•å…¥ä»»ä½•å…¶ä»–ä¾èµ–ã€‚ ç”šè‡³è¿ lua çš„ä¾èµ–ä¹Ÿä¸éœ€è¦å¼•å…¥ï¼Œå› ä¸º xmake ä¸»ç¨‹åºå·²ç»å¯¹å…¶å¯¼å‡ºäº†æ‰€æœ‰çš„ lua æ¥å£ï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥æ•´ä¸ªæ¨¡å—æ˜¯éå¸¸è½»é‡çš„ã€‚ ```lua ./modules/foo/xmake.lua add_rules(\"mode.debug\", \"mode.release\") target(\"foo\") æŒ‡å®šç›®æ ‡ä¸ºåº“ lua æ¨¡å— add_rules(\"module.shared\") add_files(\"foo.c\") ``` ## å®šä¹‰äºŒè¿›åˆ¶æ¨¡å— å‡ºäº†åŠ¨æ€åº“æ¨¡å—ï¼Œæˆ‘ä»¬è¿˜æä¾›äº†å¦å¤–ä¸€ç§äºŒè¿›åˆ¶æ¨¡å—çš„å¯¼å…¥ã€‚å®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ¯æ¬¡è°ƒç”¨æ¨¡å—æ¥å£ï¼Œéƒ½ä¼šå»è°ƒç”¨ä¸€æ¬¡å­è¿›ç¨‹ã€‚ é‚£å®ƒæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Œå°½ç®¡å®ƒæ²¡æœ‰åŠ¨æ€åº“æ¨¡å—é‚£ä¹ˆé«˜æ•ˆï¼Œä½†æ˜¯å®ƒçš„æ¨¡å—å®ç°æ›´åŠ çš„ç®€å•ï¼Œä¸éœ€è¦è°ƒç”¨ lua APIï¼Œä»…ä»…åªéœ€è¦å¤„ç†å‚æ•°æ•°æ®ï¼Œé€šè¿‡ stdout å»è¾“å‡ºè¿”å›å€¼å³å¯ã€‚ å¦å¤–ï¼Œç›¸æ¯”äºŒè¿›åˆ¶åˆ†å‘ï¼Œå®ƒæ˜¯é€šè¿‡æºç åˆ†å‘çš„ï¼Œå› æ­¤ä¹Ÿè§£å†³äº†è·¨å¹³å°çš„é—®é¢˜ã€‚ å…·ä½“æ˜¯ä½¿ç”¨åŠ¨æ€åº“æ¨¡å—ï¼Œè¿˜æ˜¯äºŒè¿›åˆ¶æ¨¡å—ï¼Œå…·ä½“çœ‹è‡ªå·±çš„éœ€æ±‚ï¼Œå¦‚æœæƒ³è¦å®ç°ç®€å•ï¼Œå¯ä»¥è€ƒè™‘äºŒè¿›åˆ¶æ¨¡å—ï¼Œå¦‚æœæƒ³è¦é«˜æ•ˆï¼Œå°±ç”¨åŠ¨æ€åº“æ¨¡å—ã€‚ å¦å¤–ï¼Œå¦‚æœéœ€è¦é€šè¿‡å¹¶è¡Œæ‰§è¡Œæ¥æé€Ÿï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å—ã€‚ ```c++ // ./modules/bar/bar.cpp #include <stdio.h> #include <stdlib.h> #include <cstdlib> int main(int argc, char** argv) { int a atoi(argv[1]); int b atoi(argv[2]); printf(\"%d\", a + b); return 0; } ``` ```lua ./modules/bar/xmake.lua add_rules(\"mode.debug\", \"mode.release\") target(\"add\") æŒ‡å®šç›®æ ‡ä¸ºäºŒè¿›åˆ¶ lua æ¨¡å— add_rules(\"module.binary\") add_files(\"bar.cpp\") ``` ## å¯¼å…¥åŸç”Ÿæ¨¡å— å¯¹äºæ¨¡å—å¯¼å…¥ï¼Œæˆ‘ä»¬ä»…ä»…éœ€è¦è°ƒç”¨ importï¼Œè·Ÿå¯¼å…¥ lua æ¨¡å—çš„ç”¨æ³•å®Œå…¨ä¸€è‡´ã€‚ ```lua ./xmake.lua add_rules(\"mode.debug\", \"mode.release\") æ·»åŠ ./modules ç›®å½•å†…åŸç”Ÿæ¨¡å— add_moduledirs(\"modules\") target(\"test\") set_kind(\"phony\") on_load(function(target) import(\"foo\", {always_build true}) import(\"bar\") print(\"foo: 1 + 1 %s\", foo.add(1, 1)) print(\"foo: 1 1 %s\", foo.sub(1, 1)) print(\"bar: 1 + 1 %s\", bar.add(1, 1)) end) ``` ç”±äºæ’ä»¶æ¨¡å—çš„æ„å»ºæ˜¯è·Ÿä¸»å·¥ç¨‹å®Œå…¨ç‹¬ç«‹çš„ï¼Œå› æ­¤ï¼Œnative æ¨¡å—åªä¼šè¢«æ„å»ºä¸€æ¬¡ï¼Œå¦‚æœæƒ³è¦è§¦å‘å¢é‡çš„æ’ä»¶ç¼–è¯‘ï¼Œéœ€è¦é…ç½®ä¸Š `always_build true`ï¼Œè¿™æ ·ï¼Œxmake å°±ä¼šæ¯æ¬¡æ£€æµ‹æ’ä»¶ä»£ç æ˜¯å¦æœ‰æ”¹åŠ¨ï¼Œå¦‚æœæœ‰æ”¹åŠ¨ï¼Œä¼šè‡ªåŠ¨å¢é‡æ„å»ºæ’ä»¶ã€‚ é¦–æ¬¡æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š ```bash $ xmake [50%]: cache compiling.release src/foo.c [50%]: cache compiling.release src/bar.c [75%]: linking.release libmodule_foo.dylib [75%]: linking.release module_bar [100%]: build ok, spent 1.296s foo: 1 + 1 2 foo: 1 1 0 bar: 1 + 1 2 [100%]: build ok, spent 0.447s ``` ç¬¬äºŒæ¬¡æ‰§è¡Œï¼Œå°±ä¸ä¼šå†æ„å»ºæ’ä»¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ¨¡å—ï¼š ```bash $ xmake foo: 1 + 1 2 foo: 1 1 0 bar: 1 + 1 2 [100%]: build ok, spent 0.447s ``` ## ä½œä¸º codegen æ¥ä½¿ç”¨ é€šè¿‡æ–°çš„ native æ¨¡å—ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨æ¥å®ç° auto codegenï¼Œç„¶åæ ¹æ®è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ï¼Œç»§ç»­æ‰§è¡Œåç»­ç¼–è¯‘æµç¨‹ã€‚ è¿™é‡Œä¹Ÿæœ‰å®Œæ•´çš„ä¾‹å­å¯ä»¥å‚è€ƒï¼š[autogen_shared_module](https://github.com/xmake io/xmake/tree/master/tests/projects/other/autogen_shared_module)ã€‚"},"/get_started/zh/module/builtin-modules.html":{"title":"","content":" class: heading_no_counter # å†…ç½®æ¨¡å— åœ¨è‡ªå®šä¹‰è„šæœ¬ã€æ’ä»¶è„šæœ¬ã€ä»»åŠ¡è„šæœ¬ã€å¹³å°æ‰©å±•ã€æ¨¡æ¿æ‰©å±•ç­‰è„šæœ¬ä»£ç ä¸­ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯åœ¨ç±»ä¼¼ä¸‹é¢çš„ä»£ç å—ä¸­ï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›æ¨¡å—æ¥å£ï¼š ```lua on_run(function (target) print(\"hello xmake!\") end) ``` > ä¸ºäº†ä¿è¯å¤–å±‚çš„æè¿°åŸŸå°½å¯èƒ½ç®€æ´ã€å®‰å…¨ï¼Œä¸€èˆ¬ä¸å»ºè®®åœ¨è¿™ä¸ªåŸŸä½¿ç”¨æ¥å£å’Œæ¨¡å—æ“ä½œ apiï¼Œå› æ­¤å¤§éƒ¨åˆ†æ¨¡å—æ¥å£åªèƒ½è„šæœ¬åŸŸä½¿ç”¨ï¼Œæ¥å®ç°å¤æ‚åŠŸèƒ½ã€‚ å½“ç„¶å°‘éƒ¨åˆ†åªè¯»çš„å†…ç½®æ¥å£è¿˜æ˜¯å¯ä»¥åœ¨æè¿°åŸŸä½¿ç”¨çš„ï¼Œå…·ä½“è§ä¸‹è¡¨ï¼š > TODOã€‚ åœ¨æè¿°åŸŸä½¿ç”¨æ¥å£è°ƒç”¨çš„å®ä¾‹å¦‚ä¸‹ï¼Œä¸€èˆ¬ä»…ç”¨äºæ¡ä»¶æ§åˆ¶ï¼š ```lua æ‰«æå½“å‰ xmake.lua ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•ï¼Œä»¥æ¯ä¸ªç›®å½•çš„åå­—å®šä¹‰ä¸€ä¸ª task ä»»åŠ¡ for _, taskname in ipairs(os.dirs(\"*\"), path.basename) do task(taskname, function() on_run(function () end) end) end ``` ä¸Šé¢æ‰€è¯´çš„è„šæœ¬åŸŸã€æè¿°åŸŸä¸»è¦æ˜¯æŒ‡ï¼š ```lua æè¿°åŸŸ target(\"test\", function() æè¿°åŸŸ set_kind(\"static\") add_files(\"src/*.c\") on_run(function (target) è„šæœ¬åŸŸ end) end) æè¿°åŸŸ ``` ## import ### å¯¼å…¥æ‰©å±•æ‘¸å— import çš„ä¸»è¦ç”¨äºå¯¼å…¥ xmake çš„æ‰©å±•ç±»åº“ä»¥åŠä¸€äº›è‡ªå®šä¹‰çš„ç±»åº“æ¨¡å—ï¼Œä¸€èˆ¬ç”¨äºï¼š * è‡ªå®šä¹‰è„šæœ¬ ([on_build](/zh cn/manual/project_target?id targeton_build), [on_run](/zh cn/manual/project_target?id targeton_run) ..) * æ’ä»¶å¼€å‘ * æ¨¡æ¿å¼€å‘ * å¹³å°æ‰©å±• * è‡ªå®šä¹‰ä»»åŠ¡ task å¯¼å…¥æœºåˆ¶å¦‚ä¸‹ï¼š 1. ä¼˜å…ˆä»å½“å‰è„šæœ¬ç›®å½•ä¸‹å¯¼å…¥ 2. å†ä»æ‰©å±•ç±»åº“ä¸­å¯¼å…¥ å¯¼å…¥çš„è¯­æ³•è§„åˆ™ï¼š åŸºäº `.` çš„ç±»åº“è·¯å¾„è§„åˆ™ï¼Œä¾‹å¦‚ï¼š ```lua import(\"core.base.option\") import(\"core.base.task\") function main() è·å–å‚æ•°é€‰é¡¹ print(option.get(\"version\")) è¿è¡Œä»»åŠ¡å’Œæ’ä»¶ task.run(\"hello\") end ``` å¯¼å…¥å½“å‰ç›®å½•ä¸‹çš„è‡ªå®šä¹‰æ¨¡å—ï¼š ç›®å½•ç»“æ„ï¼š ``` plugin xmake.lua main.lua modules hello1.lua hello2.lua ``` åœ¨ main.lua ä¸­å¯¼å…¥ modules ```lua import(\"modules.hello1\") import(\"modules.hello2\") ``` å¯¼å…¥åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨é‡Œé¢çš„æ‰€æœ‰å…¬æœ‰æ¥å£ï¼Œç§æœ‰æ¥å£ç”¨ `_` å‰ç¼€æ ‡ç¤ºï¼Œè¡¨æ˜ä¸ä¼šè¢«å¯¼å‡ºï¼Œä¸ä¼šè¢«å¤–éƒ¨è°ƒç”¨åˆ°ã€‚ é™¤äº†å½“å‰ç›®å½•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¼å…¥å…¶ä»–æŒ‡å®šç›®å½•é‡Œé¢çš„ç±»åº“ï¼Œä¾‹å¦‚ï¼š ```lua import(\"hello3\", {rootdir \"/home/xxx/modules\"}) ``` ä¸ºäº†é˜²æ­¢å‘½åå†²çªï¼Œå¯¼å…¥åè¿˜å¯ä»¥æŒ‡å®šçš„åˆ«åï¼š ```lua import(\"core.platform.platform\", {alias \"p\"}) function main() è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ p æ¥è°ƒç”¨ platform æ¨¡å—çš„ plats æ¥å£ï¼Œè·å–æ‰€æœ‰ xmake æ”¯æŒçš„å¹³å°åˆ—è¡¨äº† utils.dump(p.plats()) end ``` import ä¸ä»…å¯ä»¥å¯¼å…¥ç±»åº“ï¼Œè¿˜æ”¯æŒå¯¼å…¥çš„åŒæ—¶ä½œä¸ºç»§æ‰¿å¯¼å…¥ï¼Œå®ç°æ¨¡å—é—´çš„ç»§æ‰¿å…³ç³» ```lua import(\"xxx.xxx\", {inherit true}) ``` è¿™æ ·å¯¼å…¥çš„ä¸æ˜¯è¿™ä¸ªæ¨¡å—çš„å¼•ç”¨ï¼Œè€Œæ˜¯å¯¼å…¥çš„è¿™ä¸ªæ¨¡å—çš„æ‰€æœ‰å…¬æœ‰æ¥å£æœ¬èº«ï¼Œè¿™æ ·å°±ä¼šè·Ÿå½“å‰æ¨¡å—çš„æ¥å£è¿›è¡Œåˆå¹¶ï¼Œå®ç°æ¨¡å—é—´çš„ç»§æ‰¿ã€‚ å¦å¤–è¿˜æ”¯æŒä¸¤ä¸ªæ–°å±æ€§ï¼š`import(\"xxx.xxx\", {try true, anonymous true})` * try ä¸º trueï¼Œåˆ™å¯¼å…¥çš„æ¨¡å—ä¸å­˜åœ¨çš„è¯ï¼Œä»…ä»…è¿”å› nilï¼Œå¹¶ä¸ä¼šæŠ›å¼‚å¸¸åä¸­æ–­ xmake * anonymous ä¸º trueï¼Œåˆ™å¯¼å…¥çš„æ¨¡å—ä¸ä¼šå¼•å…¥å½“å‰ä½œç”¨åŸŸï¼Œä»…ä»…åœ¨ import æ¥å£è¿”å›å¯¼å…¥çš„å¯¹è±¡å¼•ç”¨ ### è‡ªå®šä¹‰æ‰©å±•æ¨¡å— é€šè¿‡ import æˆ‘ä»¬é™¤äº†å¯ä»¥å¯¼å…¥ xmake å†…ç½®çš„å¾ˆå¤šæ‰©å±•æ¨¡å—ï¼Œè¿˜å¯ä»¥å¯¼å…¥ç”¨æˆ·è‡ªå·±å®šä¹‰çš„æ‰©å±•æ¨¡å—ã€‚ åªéœ€è¦å°†è‡ªå·±çš„æ¨¡å—æ”¾åˆ°å·¥ç¨‹ç›®å½•ä¸‹ï¼ŒæŒ‰ç…§ä¸Šæ–‡ä»‹ç»çš„å¯¼å…¥æ–¹å¼è¿›è¡Œå¯¼å…¥å³å¯ã€‚ é‚£ä¹ˆï¼Œå¦‚æœå»å®šä¹‰æ¨¡å—å‘¢ï¼Ÿxmake å¯¹æ¨¡å—çš„ç¼–å†™è§„èŒƒæ˜¯æœ‰ä¸€å¥—çº¦å®šè§„åˆ™çš„ï¼Œå¹¶æ²¡æœ‰æ²¿ç”¨ lua åŸç”Ÿçš„ require å¯¼å…¥æœºåˆ¶ï¼Œå¹¶ä¸éœ€è¦åœ¨æ¨¡å—ä¸­ä½¿ç”¨ return æ¥å…¨å±€è¿”å›å®ƒã€‚ å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæ¨¡å—æ–‡ä»¶ foo.luaï¼Œå®ƒçš„å†…å®¹å¦‚ä¸‹ï¼š ```lua function _foo(a, b) return a + b end function add(a, b) _foo(a, b) end function main(a, b) add(a, b) end ``` å…¶ä¸­ main ä¸ºå…¥å£å‡½æ•°ï¼Œå¯é€‰ï¼Œå¦‚æœè®¾ç½®ï¼Œæ¨¡å— foo å¯ä»¥ç›´æ¥è¢«è°ƒç”¨ï¼Œä¾‹å¦‚ï¼š ```lua import(\"foo\") foo(1, 2) ``` æˆ–è€…ç›´æ¥è¿™æ ·ï¼š ```lua import(\"foo\")(1, 2) ``` å…¶ä»–ä¸å¸¦ä¸‹åˆ’çº¿çš„ä¸º public æ¨¡å—æ¥å£å‡½æ•°ï¼Œä¾‹å¦‚ addã€‚ ```lua import(\"foo\") foo.add(1, 2) ``` è€Œé‡Œé¢å¸¦ä¸‹åˆ’çº¿å‰ç¼€çš„ `_foo` æ˜¯ç§æœ‰å‡½æ•°ï¼Œæ¨¡å—å†…éƒ¨ä½¿ç”¨ï¼Œä¸å¯¹å¤–å¯¼å‡ºï¼Œæ‰€ä»¥åœ¨å¤–é¢ç”¨æˆ·æ˜¯ä¸èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ã€‚ ## inherit å¯¼å…¥å¹¶ç»§æ‰¿åŸºç±»æ¨¡å—ã€‚ è¿™ä¸ªç­‰ä»·äº [import](#import) æ¥å£çš„ `inherit` æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯ï¼š ```lua import(\"xxx.xxx\", {inherit true}) ``` ç”¨ `inherit` æ¥å£çš„è¯ï¼Œä¼šæ›´ç®€æ´äº›ï¼š ```lu inherit(\"xxx.xxx\") ``` ä½¿ç”¨å®ä¾‹ï¼Œå¯ä»¥å‚çœ‹ xmake çš„ tools ç›®å½•ä¸‹çš„è„šæœ¬ï¼š[clang.lua](#https://github.com/xmake io/xmake/blob/master/xmake/tools/clang.lua) è¿™ä¸ªå°±æ˜¯ clang å·¥å…·æ¨¡å—ç»§æ‰¿äº† gcc çš„éƒ¨åˆ†å®ç°ã€‚ ## try catch finally å¼‚å¸¸æ•è·ã€‚ lua åŸç”Ÿå¹¶æ²¡æœ‰æä¾› try catch çš„è¯­æ³•æ¥æ•è·å¼‚å¸¸å¤„ç†ï¼Œä½†æ˜¯æä¾›äº† `pcall/xpcall` ç­‰æ¥å£ï¼Œå¯åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹æ‰§è¡Œ lua å‡½æ•°ã€‚ å› æ­¤ï¼Œå¯ä»¥é€šè¿‡å°è£…è¿™ä¸¤ä¸ªæ¥å£ï¼Œæ¥å®ç° try catch å—çš„æ•è·æœºåˆ¶ã€‚ æˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹ä¸‹ï¼Œå°è£…åçš„ try catch ä½¿ç”¨æ–¹å¼ï¼š ```lua try { try ä»£ç å— function () error(\"error message\") end, catch ä»£ç å— catch { å‘ç”Ÿå¼‚å¸¸åï¼Œè¢«æ‰§è¡Œ function (errors) print(errors) end } } ``` ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåœ¨ try å—å†…éƒ¨è®¤ä¸ºå¼•å‘äº†ä¸€ä¸ªå¼‚å¸¸ï¼Œå¹¶ä¸”æŠ›å‡ºé”™è¯¯æ¶ˆæ¯ï¼Œåœ¨ catch ä¸­è¿›è¡Œäº†æ•è·ï¼Œå¹¶ä¸”å°†é”™è¯¯æ¶ˆæ¯è¿›è¡Œè¾“å‡ºæ˜¾ç¤ºã€‚ è€Œ finally çš„å¤„ç†ï¼Œè¿™ä¸ªçš„ä½œç”¨æ˜¯å¯¹äº `try{}` ä»£ç å—ï¼Œä¸ç®¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œéƒ½ä¼šæ‰§è¡Œåˆ° finally å—ä¸­ ä¹Ÿå°±è¯´ï¼Œå…¶å®ä¸Šé¢çš„å®ç°ï¼Œå®Œæ•´çš„æ”¯æŒè¯­æ³•æ˜¯ï¼š`try catch finally` æ¨¡å¼ï¼Œå…¶ä¸­ catch å’Œ finally éƒ½æ˜¯å¯é€‰çš„ï¼Œæ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚æä¾› ä¾‹å¦‚ï¼š ```lua try { try ä»£ç å— function () error(\"error message\") end, catch ä»£ç å— catch { å‘ç”Ÿå¼‚å¸¸åï¼Œè¢«æ‰§è¡Œ function (errors) print(errors) end }, finally ä»£ç å— finally { æœ€åéƒ½ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ function (ok, errors) å¦‚æœ try{} ä¸­å­˜åœ¨å¼‚å¸¸ï¼Œok ä¸º trueï¼Œerrors ä¸ºé”™è¯¯ä¿¡æ¯ï¼Œå¦åˆ™ä¸º falseï¼Œerrors ä¸º try ä¸­çš„è¿”å›å€¼ end } } ``` æˆ–è€…åªæœ‰ finally å—ï¼š ```lua try { try ä»£ç å— function () return \"info\" end, finally ä»£ç å— finally { ç”±äºæ­¤ try ä»£ç æ²¡å‘ç”Ÿå¼‚å¸¸ï¼Œå› æ­¤ ok ä¸º trueï¼Œerrors ä¸ºè¿”å›å€¼: \"info\" function (ok, errors) end } } ``` å¤„ç†å¯ä»¥åœ¨ finally ä¸­è·å– try é‡Œé¢çš„æ­£å¸¸è¿”å›å€¼ï¼Œå…¶å®åœ¨ä»…æœ‰ try çš„æƒ…å†µä¸‹ï¼Œä¹Ÿæ˜¯å¯ä»¥è·å–è¿”å›å€¼çš„ï¼š ```lua å¦‚æœæ²¡å‘ç”Ÿå¼‚å¸¸ï¼Œresult ä¸ºè¿”å›å€¼ï¼š\"xxxx\"ï¼Œå¦åˆ™ä¸º nil local result try { function () return \"xxxx\" end } ``` åœ¨ xmake çš„è‡ªå®šä¹‰è„šæœ¬ã€æ’ä»¶å¼€å‘ä¸­ï¼Œä¹Ÿæ˜¯å®Œå…¨åŸºäºæ­¤å¼‚å¸¸æ•è·æœºåˆ¶ã€‚ è¿™æ ·ä½¿å¾—æ‰©å±•è„šæœ¬çš„å¼€å‘éå¸¸çš„ç²¾ç®€å¯è¯»ï¼Œçœå»äº†ç¹ççš„ `if err ~ nil then` è¿”å›å€¼åˆ¤æ–­ï¼Œåœ¨å‘ç”Ÿé”™è¯¯æ—¶ï¼Œxmake ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸è¿›è¡Œä¸­æ–­ï¼Œç„¶åé«˜äº®æç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚ ä¾‹å¦‚ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") åœ¨ç¼–è¯‘å®Œ ios ç¨‹åºåï¼Œå¯¹ç›®æ ‡ç¨‹åºè¿›è¡Œ ldid ç­¾å after_build(function (target)) os.run(\"ldid S %s\", target:targetfile()) end end) ``` åªéœ€è¦ä¸€è¡Œ `os.run` å°±è¡Œäº†ï¼Œä¹Ÿä¸éœ€è¦è¿”å›å€¼åˆ¤æ–­æ˜¯å¦è¿è¡ŒæˆåŠŸï¼Œå› ä¸ºè¿è¡Œå¤±è´¥åï¼Œxmake ä¼šè‡ªåŠ¨æŠ›å¼‚å¸¸ï¼Œä¸­æ–­ç¨‹åºå¹¶ä¸”æç¤ºé”™è¯¯ã€‚ å¦‚æœä½ æƒ³åœ¨è¿è¡Œå¤±è´¥åï¼Œä¸ç›´æ¥ä¸­æ–­ xmakeï¼Œç»§ç»­å¾€ä¸‹è¿è¡Œï¼Œå¯ä»¥è‡ªå·±åŠ ä¸ª try å¿«å°±è¡Œäº†ï¼š ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") after_build(function (target)) try { function () os.run(\"ldid S %s\", target:targetfile()) end } end end) ``` å¦‚æœè¿˜æƒ³æ•è·å‡ºé”™ä¿¡æ¯ï¼Œå¯ä»¥å†åŠ ä¸ª catch: ```lua target(\"test\", function() set_kind(\"binary\") add_files(\"src/*.c\") after_build(function (target)) try { function () os.run(\"ldid S %s\", target:targetfile()) end, catch { function (errors) print(errors) end } } end end) ``` ä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ xmake ä¸­å†™è‡ªå®šä¹‰è„šæœ¬ï¼Œæ˜¯ä¸éœ€è¦æ‰‹åŠ¨åŠ  try catch çš„ï¼Œç›´æ¥è°ƒç”¨å„ç§ apiï¼Œå‡ºé”™åè®© xmake é»˜è®¤çš„å¤„ç†ç¨‹åºæ¥ç®¡ï¼Œç›´æ¥ä¸­æ–­å°±è¡Œäº†ã€‚ ## pairs ç”¨äºéå†å­—å…¸ã€‚ è¿™ä¸ªæ˜¯ lua åŸç”Ÿçš„å†…ç½® apiï¼Œåœ¨ xmake ä¸­ï¼Œåœ¨åŸæœ‰çš„è¡Œä¸ºä¸Šå¯¹å…¶è¿›è¡Œäº†ä¸€äº›æ‰©å±•ï¼Œæ¥ç®€åŒ–ä¸€äº›æ—¥å¸¸çš„ lua éå†ä»£ç ã€‚ å…ˆçœ‹ä¸‹é»˜è®¤çš„åŸç”Ÿå†™æ³•ï¼š ```lua local t {a \"a\", b \"b\", c \"c\", d \"d\", e \"e\", f \"f\"} for key, val in pairs(t) do print(\"%s: %s\", key, val) end ``` è¿™å¯¹äºé€šå¸¸çš„éå†æ“ä½œå°±è¶³å¤Ÿäº†ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›¸å¯¹å…¶ä¸­æ¯ä¸ªéå†å‡ºæ¥çš„å…ƒç´ ï¼Œè·å–å…¶å¤§å†™ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š ```lua for key, val in pairs(t, function (v) return v:upper() end) do print(\"%s: %s\", key, val) end ``` ç”šè‡³ä¼ å…¥ä¸€äº›å‚æ•°åˆ°ç¬¬äºŒä¸ª `function` ä¸­ï¼Œä¾‹å¦‚ï¼š ```lua for key, val in pairs(t, function (v, a, b) return v:upper() .. a .. b end, \"a\", \"b\") do print(\"%s: %s\", key, val) end ``` ## ipairs ç”¨äºéå†æ•°ç»„ã€‚ è¿™ä¸ªæ˜¯ lua åŸç”Ÿçš„å†…ç½® apiï¼Œåœ¨ xmake ä¸­ï¼Œåœ¨åŸæœ‰çš„è¡Œä¸ºä¸Šå¯¹å…¶è¿›è¡Œäº†ä¸€äº›æ‰©å±•ï¼Œæ¥ç®€åŒ–ä¸€äº›æ—¥å¸¸çš„ lua éå†ä»£ç ã€‚ å…ˆçœ‹ä¸‹é»˜è®¤çš„åŸç”Ÿå†™æ³•ï¼š ```lua for idx, val in ipairs({\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"}) do print(\"%d %s\", idx, val) end ``` æ‰©å±•å†™æ³•ç±»ä¼¼ [pairs](#pairs) æ¥å£ï¼Œä¾‹å¦‚ï¼š ```lua for idx, val in ipairs({\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"}, function (v) return v:upper() end) do print(\"%d %s\", idx, val) end for idx, val in ipairs({\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"}, function (v, a, b) return v:upper() .. a .. b end, \"a\", \"b\") do print(\"%d %s\", idx, val) end ``` è¿™æ ·å¯ä»¥ç®€åŒ– `for` å—ä»£ç çš„é€»è¾‘ï¼Œä¾‹å¦‚æˆ‘è¦éå†æŒ‡å®šç›®å½•ï¼Œè·å–å…¶ä¸­çš„æ–‡ä»¶åï¼Œä½†ä¸åŒ…æ‹¬è·¯å¾„ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ç§æ‰©å±•æ–¹å¼ï¼Œç®€åŒ–å†™æ³•ï¼š ```lua for _, filename in ipairs(os.dirs(\"*\"), path.filename) do ... end ``` ## print æ¢è¡Œæ‰“å°ç»ˆç«¯æ—¥å¿—ã€‚ æ­¤æ¥å£ä¹Ÿæ˜¯ lua çš„åŸç”Ÿæ¥å£ï¼Œxmake åœ¨åŸæœ‰è¡Œä¸ºä¸å˜çš„åŸºç¡€ä¸Šä¹Ÿè¿›è¡Œäº†æ‰©å±•ï¼ŒåŒæ—¶æ”¯æŒï¼šæ ¼å¼åŒ–è¾“å‡ºã€å¤šå˜é‡è¾“å‡ºã€‚ å…ˆçœ‹ä¸‹åŸç”Ÿæ”¯æŒçš„æ–¹å¼ï¼š ```lua print(\"hello xmake!\") print(\"hello\", \"xmake!\", 123) ``` å¹¶ä¸”åŒæ—¶è¿˜æ”¯æŒæ‰©å±•çš„æ ¼å¼åŒ–å†™æ³•ï¼š ```lua print(\"hello %s!\", \"xmake\") print(\"hello xmake! %d\", 123) ``` xmake ä¼šåŒæ—¶æ”¯æŒè¿™ä¸¤ç§å†™æ³•ï¼Œå†…éƒ¨ä¼šå»è‡ªåŠ¨æ™ºèƒ½æ£€æµ‹ï¼Œé€‰æ‹©è¾“å‡ºè¡Œä¸ºã€‚ ## printf æ— æ¢è¡Œæ‰“å°ç»ˆç«¯æ—¥å¿—ã€‚ ç±»ä¼¼ [print](#print) æ¥å£ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ä¸æ¢è¡Œã€‚ ## cprint æ¢è¡Œå½©è‰²æ‰“å°ç»ˆç«¯æ—¥å¿—ã€‚ è¡Œä¸ºç±»ä¼¼ [print](#print)ï¼ŒåŒºåˆ«å°±æ˜¯æ­¤æ¥å£è¿˜æ”¯æŒå½©è‰²ç»ˆç«¯è¾“å‡ºï¼Œå¹¶ä¸”æ”¯æŒ `emoji` å­—ç¬¦è¾“å‡ºã€‚ ä¾‹å¦‚ï¼š ```lua cprint('${bright}hello xmake') cprint('${red}hello xmake') cprint('${bright green}hello ${clear}xmake') cprint('${blue onyellow underline}hello xmake${clear}') cprint('${red}hello ${magenta}xmake') cprint('${cyan}hello ${dim yellow}xmake') ``` æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š ![cprint_colors](https://tboox.org/static/img/xmake/cprint_colors.png) è·Ÿé¢œè‰²ç›¸å…³çš„æè¿°ï¼Œéƒ½æ”¾ç½®åœ¨ `${ }` é‡Œé¢ï¼Œå¯ä»¥åŒæ—¶è®¾ç½®å¤šä¸ªä¸åŒçš„å±æ€§ï¼Œä¾‹å¦‚ï¼š ``` ${bright red underline onyellow} ``` è¡¨ç¤ºï¼šé«˜äº®çº¢è‰²ï¼ŒèƒŒæ™¯é»„è‰²ï¼Œå¹¶ä¸”å¸¦ä¸‹æ»‘çº¿ æ‰€æœ‰è¿™äº›æè¿°ï¼Œéƒ½ä¼šå½±å“åé¢ä¸€æ•´è¡Œå­—ç¬¦ï¼Œå¦‚æœåªæƒ³æ˜¾ç¤ºéƒ¨åˆ†é¢œè‰²çš„æ–‡å­—ï¼Œå¯ä»¥åœ¨ç»“æŸä½ç½®ï¼Œæ’å…¥ `${clear}` æ¸…æ¥šå‰é¢é¢œè‰²æè¿° ä¾‹å¦‚ï¼š ``` ${red}hello ${clear}xmake ``` è¿™æ ·çš„è¯ï¼Œä»…ä»… hello æ˜¯æ˜¾ç¤ºçº¢è‰²ï¼Œå…¶ä»–è¿˜æ˜¯æ­£å¸¸é»˜è®¤é»‘è‰²æ˜¾ç¤ºã€‚ å…¶ä»–é¢œè‰²å±äºï¼Œæˆ‘è¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»ï¼Œç›´æ¥è´´ä¸Š xmake ä»£ç é‡Œé¢çš„å±æ€§åˆ—è¡¨å§ï¼š ```lua colors.keys { å±æ€§ reset 0 é‡ç½®å±æ€§ , clear 0 æ¸…æ¥šå±æ€§ , default 0 é»˜è®¤å±æ€§ , bright 1 é«˜äº® , dim 2 æš—è‰² , underline 4 ä¸‹åˆ’çº¿ , blink 5 é—ªçƒ , reverse 7 åè½¬é¢œè‰² , hidden 8 éšè—æ–‡å­— å‰æ™¯è‰² , black 30 , red 31 , green 32 , yellow 33 , blue 34 , magenta 35 , cyan 36 , white 37 èƒŒæ™¯è‰² , onblack 40 , onred 41 , ongreen 42 , onyellow 43 , onblue 44 , onmagenta 45 , oncyan 46 , onwhite 47 } ``` é™¤äº†å¯ä»¥è‰²å½©é«˜äº®æ˜¾ç¤ºå¤–ï¼Œå¦‚æœä½ çš„ç»ˆç«¯æ˜¯åœ¨ macosx ä¸‹ï¼Œlion ä»¥ä¸Šçš„ç³»ç»Ÿï¼Œxmake è¿˜å¯ä»¥æ”¯æŒ emoji è¡¨æƒ…çš„æ˜¾ç¤ºå“¦ï¼Œå¯¹äºä¸æ”¯æŒç³»ç»Ÿï¼Œä¼šå¿½ç•¥æ˜¾ç¤ºï¼Œä¾‹å¦‚ï¼š ```lua cprint(\"hello xmake${beer}\") cprint(\"hello${ok_hand} xmake\") ``` ä¸Šé¢ä¸¤è¡Œä»£ç ï¼Œæˆ‘æ‰“å°äº†ä¸€ä¸ª homebrew é‡Œé¢ç»å…¸çš„å•¤é…’ç¬¦å·ï¼Œä¸‹é¢é‚£è¡Œæ‰“å°äº†ä¸€ä¸ª ok çš„æ‰‹åŠ¿ç¬¦å·ï¼š ![cprint_emoji](https://tboox.org/static/img/xmake/cprint_emoji.png) æ‰€æœ‰çš„ emoji è¡¨æƒ…ï¼Œä»¥åŠ xmake é‡Œé¢å¯¹åº”çš„ keyï¼Œéƒ½å¯ä»¥é€šè¿‡ [emoji ç¬¦å·](http://www.emoji cheat sheet.com/) é‡Œé¢æ‰¾åˆ°ã€‚ åŒæ—¶æ”¯æŒ 24 ä½çœŸå½©è‰²è¾“å‡ºï¼Œå¦‚æœç»ˆç«¯æ”¯æŒçš„è¯ï¼š ```lua import(\"core.base.colors\") if colors.truecolor() then cprint(\"${255;0;0}hello\") cprint(\"${on;255;0;0}hello${clear} xmake\") cprint(\"${bright 255;0;0 underline}hello\") cprint(\"${bright on;255;0;0 0;255;0}hello${clear} xmake\") end ``` xmake å¯¹äº truecolor çš„æ£€æµ‹æ”¯æŒï¼Œæ˜¯é€šè¿‡ `$COLORTERM` ç¯å¢ƒå˜é‡æ¥å®ç°çš„ï¼Œå¦‚æœä½ çš„ç»ˆç«¯æ”¯æŒ truecolorï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®æ­¤ç¯å¢ƒå˜é‡ï¼Œæ¥å‘Šè¯‰ xmake å¯ç”¨ truecolor æ”¯æŒã€‚ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥å¯ç”¨å’Œæµ‹è¯•ï¼š ```bash $ export COLORTERM truecolor $ xmake version ``` å¯é€šè¿‡ `COLORTERM nocolor` æ¥ç¦ç”¨è‰²å½©è¾“å‡ºã€‚ ## cprintf æ— æ¢è¡Œå½©è‰²æ‰“å°ç»ˆç«¯æ—¥å¿—ã€‚ æ­¤æ¥å£ç±»ä¼¼ [cprint](#cprint)ï¼ŒåŒºåˆ«å°±æ˜¯ä¸æ¢è¡Œè¾“å‡ºã€‚ ## format æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚ å¦‚æœåªæ˜¯æƒ³æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä¸è¿›è¡Œè¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥å£ï¼Œæ­¤æ¥å£è·Ÿ [string.format](#stringformat) æ¥å£ç­‰ä»·ï¼Œåªæ˜¯ä¸ªæ¥å£åç®€åŒ–ç‰ˆã€‚ ```lua local s format(\"hello %s\", xmake) ``` ## vformat æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ”¯æŒå†…ç½®å˜é‡è½¬ä¹‰ã€‚ æ­¤æ¥å£è·Ÿ [format](#format) æ¥å£ç±»ä¼¼ï¼Œåªæ˜¯å¢åŠ å¯¹å†…ç½®å˜é‡çš„è·å–å’Œè½¬ä¹‰æ”¯æŒã€‚ ```lua local s vformat(\"hello %s $(mode) $(arch) $(env PATH)\", xmake) ``` ## raise æŠ›å‡ºå¼‚å¸¸ä¸­æ–­ç¨‹åºã€‚ å¦‚æœæƒ³åœ¨è‡ªå®šä¹‰è„šæœ¬ã€æ’ä»¶ä»»åŠ¡ä¸­ä¸­æ–­ xmake è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥å£æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœä¸Šå±‚æ²¡æœ‰æ˜¾ç¤ºè°ƒç”¨ [try catch](#try catch finally) æ•è·çš„è¯ï¼Œxmake å°±ä¼šä¸­æ–­æ‰§è¡Œï¼Œå¹¶ä¸”æ˜¾ç¤ºå‡ºé”™ä¿¡æ¯ã€‚ ```lua if (errors) raise(errors) ``` å¦‚æœåœ¨ try å—ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå°±ä¼šåœ¨ catch å’Œ finally ä¸­è¿›è¡Œ errors ä¿¡æ¯æ•è·ï¼Œå…·ä½“è§ï¼š[try catch](#try catch finally) ## os ç³»ç»Ÿæ“ä½œæ¨¡å—ï¼Œå±äºå†…ç½®æ¨¡å—ï¼Œæ— éœ€ä½¿ç”¨ [import](#import) å¯¼å…¥ï¼Œå¯ç›´æ¥è„šæœ¬åŸŸè°ƒç”¨å…¶æ¥å£ã€‚ æ­¤æ¨¡å—ä¹Ÿæ˜¯ lua çš„åŸç”Ÿæ¨¡å—ï¼Œxmake åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œäº†æ‰©å±•ï¼Œæä¾›æ›´å¤šå®ç”¨çš„æ¥å£ã€‚ > os æ¨¡å—é‡Œé¢åªæœ‰éƒ¨åˆ† readonly æ¥å£ï¼ˆä¾‹å¦‚ï¼š`os.getenv`, `os.arch`ï¼‰æ˜¯å¯ä»¥åœ¨æè¿°åŸŸä¸­ä½¿ç”¨ï¼Œå…¶ä»–æ¥å£åªèƒ½åœ¨è„šæœ¬åŸŸä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š`os.cp`, `os.rm` ç­‰ æ¥å£ æè¿° æ”¯æŒç‰ˆæœ¬ [os.cp](#oscp) å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½• > 2.0.1 [os.mv](#osmv) ç§»åŠ¨é‡å‘½åæ–‡ä»¶æˆ–ç›®å½• > 2.0.1 [os.rm](#osrm) åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•æ ‘ > 2.0.1 [os.trycp](#ostrycp) å°è¯•å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½• > 2.1.6 [os.trymv](#ostrymv) å°è¯•ç§»åŠ¨é‡å‘½åæ–‡ä»¶æˆ–ç›®å½• > 2.1.6 [os.tryrm](#ostryrm) å°è¯•åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•æ ‘ > 2.1.6 [os.cd](#oscd) è¿›å…¥æŒ‡å®šç›®å½• > 2.0.1 [os.rmdir](#osrmdir) åˆ é™¤ç›®å½•æ ‘ > 2.0.1 [os.mkdir](#osmkdir) åˆ›å»ºæŒ‡å®šç›®å½• > 2.0.1 [os.isdir](#osisdir) åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ > 2.0.1 [os.isfile](#osisfile) åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ > 2.0.1 [os.exists](#osexists) åˆ¤æ–­æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ > 2.0.1 [os.dirs](#osdirs) éå†è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½• > 2.0.1 [os.files](#osfiles) éå†è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ > 2.0.1 [os.filedirs](#osfiledirs) éå†è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æˆ–ç›®å½• > 2.0.1 [os.run](#osrun) å®‰é™è¿è¡Œç¨‹åº > 2.0.1 [os.runv](#osrunv) å®‰é™è¿è¡Œç¨‹åºï¼Œå¸¦å‚æ•°åˆ—è¡¨ > 2.1.5 [os.exec](#osexec) å›æ˜¾è¿è¡Œç¨‹åº > 2.0.1 [os.execv](#osexecv) å›æ˜¾è¿è¡Œç¨‹åºï¼Œå¸¦å‚æ•°åˆ—è¡¨ > 2.1.5 [os.iorun](#osiorun) è¿è¡Œå¹¶è·å–ç¨‹åºè¾“å‡ºå†…å®¹ > 2.0.1 [os.iorunv](#osiorunv) è¿è¡Œå¹¶è·å–ç¨‹åºè¾“å‡ºå†…å®¹ï¼Œå¸¦å‚æ•°åˆ—è¡¨ > 2.1.5 [os.getenv](#osgetenv) è·å–ç¯å¢ƒå˜é‡ > 2.0.1 [os.setenv](#ossetenv) è®¾ç½®ç¯å¢ƒå˜é‡ > 2.0.1 [os.tmpdir](#ostmpdir) è·å–ä¸´æ—¶ç›®å½•è·¯å¾„ > 2.0.1 [os.tmpfile](#ostmpfile) è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„ > 2.0.1 [os.curdir](#oscurdir) è·å–å½“å‰ç›®å½•è·¯å¾„ > 2.0.1 [os.filesize](#osfilesize) è·å–æ–‡ä»¶å¤§å° > 2.1.9 [os.scriptdir](#osscriptdir) è·å–è„šæœ¬ç›®å½•è·¯å¾„ > 2.0.1 [os.programdir](#osprogramdir) è·å– xmake å®‰è£…ä¸»ç¨‹åºè„šæœ¬ç›®å½• > 2.1.5 [os.programfile](#osprogramfile) è·å– xmake å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ > 2.1.5 [os.projectdir](#osprojectdir) è·å–å·¥ç¨‹ä¸»ç›®å½• > 2.1.5 [os.arch](#osarch) è·å–å½“å‰ç³»ç»Ÿæ¶æ„ > 2.0.1 [os.host](#oshost) è·å–å½“å‰ä¸»æœºç³»ç»Ÿ > 2.0.1 [os.subhost](#ossubhost) è·å–å­ç³»ç»Ÿ > 2.3.1 [os.subarch](#ossubarch) è·å–å­ç³»ç»Ÿæ¶æ„ > 2.3.1 [os.is_host](#osis_host) åˆ¤æ–­ç»™å®šç³»ç»Ÿæ˜¯å¦æ­£ç¡® > 2.3.1 [os.is_arch](#osis_arch) åˆ¤æ–­ç»™å®šæ¶æ„æ˜¯å¦æ­£ç¡® > 2.3.1 [os.is_subhost](#osis_subhost) åˆ¤æ–­ç»™å®šå­ç³»ç»Ÿæ˜¯å¦æ­£ç¡® > 2.3.1 [os.is_subarch](#osis_subarch) åˆ¤æ–­å­ç³»ç»Ÿæ¶æ„æ˜¯å¦æ­£ç¡® > 2.3.1 [os.ln](#osln) åˆ›å»ºæŒ‡å‘æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„ç¬¦å·é“¾æ¥ > 2.2.2 [os.readlink](#osreadlink) è¯»å–ç¬¦å·é“¾æ¥ > 2.2.2 [os.raise](#osraise) æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å¹¶ä¸­æ­¢è„šæœ¬è¿è¡Œ > 2.2.8 [os.raiselevel](#osraiselevel) æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å¹¶ä¸­æ­¢è„šæœ¬è¿è¡Œ > 2.2.8 [os.features](#osfeatures) è·å–ç³»ç»Ÿç‰¹æ€§ > 2.3.1 [os.getenvs](#osgetenvs) è·å–æ‰€æœ‰ç¯å¢ƒå˜é‡ > 2.2.6 [os.setenvs](#ossetenvs) æ›¿æ¢å½“å‰æ‰€æœ‰ç¯å¢ƒå˜é‡ > 2.2.6 [os.addenvs](#osaddenvs) å‘å½“å‰ç¯å¢ƒå˜é‡ä¸­æ·»åŠ æ–°å€¼ > 2.5.6 [os.joinenvs](#osjoinenvs) æ‹¼æ¥ç¯å¢ƒå˜é‡ > 2.5.6 [os.setenvp](#ossetenvp) ä½¿ç”¨ç»™å®šåˆ†éš”ç¬¦è®¾ç½®ç¯å¢ƒå˜é‡ > 2.1.5 [os.addenvp](#osaddenvp) ä½¿ç”¨ç»™å®šåˆ†éš”ç¬¦å‘ç¯å¢ƒå˜é‡æ·»åŠ æ–°å€¼ > 2.1.5 [os.workingdir](#osworkingdir) è·å–å·¥ä½œè·¯å¾„ > 2.1.9 [os.isroot](#osisroot) åˆ¤æ–­å½“å‰ xmake æ˜¯å¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œ > 2.1.9 [os.fscase](#osfscase) åˆ¤æ–­å½“å‰ç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦å¤§å°å†™æ•æ„Ÿ > 2.1.9 [os.term](#osterm) è·å–å½“å‰ç»ˆç«¯ > 2.7.3 [os.shell](#osshell) è·å–å½“å‰ shell > 2.7.3 [os.cpuinfo](#oscpuinfo) è·å– CPU ä¿¡æ¯ > 2.1.5 [os.meminfo](#osmeminfo) è·å–å†…å­˜ä¿¡æ¯ > 2.1.5 [os.default_njob](#osdefault_njob) è·å–é»˜è®¤ç¼–è¯‘ä»»åŠ¡æ•° > 2.5.8 ### os.cp å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ã€‚ è¡Œä¸ºå’Œ shell ä¸­çš„ `cp` å‘½ä»¤ç±»ä¼¼ï¼Œæ”¯æŒè·¯å¾„é€šé…ç¬¦åŒ¹é…ï¼ˆä½¿ç”¨çš„æ˜¯ lua æ¨¡å¼åŒ¹é…ï¼‰ï¼Œæ”¯æŒå¤šæ–‡ä»¶å¤åˆ¶ï¼Œä»¥åŠå†…ç½®å˜é‡æ”¯æŒã€‚ ä¾‹å¦‚ï¼š ```lua os.cp(\"$(scriptdir)/*.h\", \"$(buildir)/inc\") os.cp(\"$(projectdir)/src/test/**.h\", \"$(buildir)/inc\") ``` ä¸Šé¢çš„ä»£ç å°†ï¼šå½“å‰ `xmake.lua` ç›®å½•ä¸‹çš„æ‰€æœ‰å¤´æ–‡ä»¶ã€å·¥ç¨‹æºç  test ç›®å½•ä¸‹çš„å¤´æ–‡ä»¶å…¨éƒ¨å¤åˆ¶åˆ° `$(buildir)` è¾“å‡ºç›®å½•ä¸­ã€‚ å…¶ä¸­ `$(scriptdir)`, `$(projectdir)` è¿™äº›å˜é‡æ˜¯ xmake çš„å†…ç½®å˜é‡ï¼Œå…·ä½“è¯¦æƒ…è§ï¼š[å†…ç½®å˜é‡](# å†…ç½®å˜é‡) çš„ç›¸å…³æ–‡æ¡£ã€‚ è€Œ `*.h` å’Œ `**.h` ä¸­çš„åŒ¹é…æ¨¡å¼ï¼Œè·Ÿ [add_files](#targetadd_files) ä¸­çš„ç±»ä¼¼ï¼Œå‰è€…æ˜¯å•çº§ç›®å½•åŒ¹é…ï¼Œåè€…æ˜¯é€’å½’å¤šçº§ç›®å½•åŒ¹é…ã€‚ æ­¤æ¥å£åŒæ—¶æ”¯æŒç›®å½•çš„ ` é€’å½’å¤åˆ¶ `ï¼Œä¾‹å¦‚ï¼š ```lua é€’å½’å¤åˆ¶å½“å‰ç›®å½•åˆ°ä¸´æ—¶ç›®å½• os.cp(\"$(curdir)/test/\", \"$(tmpdir)/test\") ``` ä¸Šé¢çš„å¤åˆ¶ï¼Œä¼šæŠŠæ‰€æœ‰æ–‡ä»¶å…¨éƒ¨å±•å¼€å¤åˆ¶åˆ°æŒ‡å®šç›®å½•ï¼Œä¸¢å¤±æºç›®å½•å±‚çº§ï¼Œå¦‚æœè¦æŒ‰ä¿æŒåŸæœ‰çš„ç›®å½•ç»“æ„å¤åˆ¶ï¼Œå¯ä»¥è®¾ç½® rootdir å‚æ•°ï¼š ```lua os.cp(\"src/**.h\", \"/tmp/\", {rootdir \"src\"}) ``` ä¸Šé¢çš„è„šæœ¬å¯ä»¥æŒ‰ `src` æ ¹ç›®å½•ï¼Œå°† src ä¸‹çš„æ‰€æœ‰å­æ–‡ä»¶ä¿æŒç›®å½•ç»“æ„å¤åˆ¶è¿‡å»ã€‚ > å°½é‡ä½¿ç”¨ `os.cp` æ¥å£ï¼Œè€Œä¸æ˜¯ `os.run(\"cp ..\")`ï¼Œè¿™æ ·æ›´èƒ½ä¿è¯å¹³å°ä¸€è‡´æ€§ï¼Œå®ç°è·¨å¹³å°æ„å»ºæè¿°ã€‚ åŒæ—¶æä¾›äº† `{symlink true}` å‚æ•°ï¼Œåœ¨å¤åˆ¶æ–‡ä»¶æ—¶å€™ä¿ç•™ç¬¦å·é“¾æ¥ã€‚ ```lua os.cp(\"/xxx/foo\", \"/xxx/bar\", {symlink true}) ``` å’Œ Linux ä¸Šçš„ cp å‘½ä»¤ä¸åŒï¼Œxmake çš„ cp æ¥å£æ— æ³•å°†åŒåçš„æ–‡ä»¶å¤¹å¤åˆ¶åˆ°ç›®æ ‡è·¯å¾„ï¼Œæœ€ç»ˆåªèƒ½ä¿ç•™ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚ä¾‹å¦‚ï¼š æ–‡ä»¶è·¯å¾„ï¼ŒA å’Œ B æœ‰ä¸€ä¸ªåŒåçš„æ–‡ä»¶å¤¹ confï¼š ```bash . â”œâ”€â”€ A â”‚ â””â”€â”€ conf â”‚ â”œâ”€â”€ 1 â”‚ â”‚ â””â”€â”€ A1.txt â”‚ â””â”€â”€ 2 â”‚ â””â”€â”€ A2.txt â”œâ”€â”€ B â”‚ â””â”€â”€ conf â”‚ â”œâ”€â”€ 1 â”‚ â”‚ â””â”€â”€ B1.txt â”‚ â””â”€â”€ 2 â”‚ â””â”€â”€ B2.txt â””â”€â”€ test.lua ``` æˆ‘ä»¬å¸Œæœ›å°† A å’Œ B ä¸¤ä¸ª conf æ–‡ä»¶å¤¹çš„å†…å®¹éƒ½**åˆå¹¶**åˆ° output ç›®å½•ä¸‹ï¼š ```lua os.mkdir(\"output/test1\") os.cp(\"A/conf\", \"output/test1\", {rootdir \"A/conf\"}) os.cp(\"B/conf\", \"output/test1\", {rootdir \"B/conf\"}) ``` åˆå¹¶å®Œåä¸¢å¤± A çš„ conf ä¿¡æ¯ï¼š ```bash $tree output/ output/ â””â”€â”€ test1 â”œâ”€â”€ 1 â”‚ â””â”€â”€ B1.txt â””â”€â”€ 2 â””â”€â”€ B2.txt ``` æœ€ç»ˆæˆ‘ä»¬ä¸å¾—å·²é€šè¿‡ `bash c` å®ç°è¿™ä¸ªåŠŸèƒ½ï¼š ```lua os.mkdir(\"output/test5\") os.vrun(\"bash c 'cp r A/conf/* output/test5'\") os.vrun(\"bash c 'cp r B/conf/* output/test5'\") ``` ç›¸å…³çš„è®¨è®ºå¯è§ xmake æºç çš„ `example/api/os.cp` ä¾‹å­ã€‚ ### os.mv ç§»åŠ¨é‡å‘½åæ–‡ä»¶æˆ–ç›®å½•ã€‚ è·Ÿ [os.cp](#oscp) çš„ä½¿ç”¨ç±»ä¼¼ï¼ŒåŒæ ·æ”¯æŒå¤šæ–‡ä»¶ç§»åŠ¨æ“ä½œå’Œæ¨¡å¼åŒ¹é…ï¼Œä¾‹å¦‚ï¼š ```lua ç§»åŠ¨æ–‡ä»¶åˆ°ä¸´æ—¶ç›®å½• os.mv(\"$(buildir)/test1\", \"$(tmpdir)\") æ–‡ä»¶ç§»åŠ¨ä¸æ”¯æŒæ‰¹é‡æ“ä½œï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶é‡å‘½å os.mv(\"$(buildir)/libtest.a\", \"$(buildir)/libdemo.a\") ``` ### os.rm åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•æ ‘ã€‚ æ”¯æŒé€’å½’åˆ é™¤ç›®å½•ï¼Œæ‰¹é‡åˆ é™¤æ“ä½œï¼Œä»¥åŠæ¨¡å¼åŒ¹é…å’Œå†…ç½®å˜é‡ï¼Œä¾‹å¦‚ï¼š ```lua os.rm(\"$(buildir)/inc/**.h\") os.rm(\"$(buildir)/lib/\") ``` ### os.trycp å°è¯•å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ã€‚ è·Ÿ [os.cp](#oscp) ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ï¼Œæ­¤æ¥å£æ“ä½œå¤±è´¥ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ä¸­æ–­ xmakeï¼Œè€Œæ˜¯é€šè¿‡è¿”å›å€¼æ ‡ç¤ºæ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚ ```lua if os.trycp(\"file\", \"dest/file\") then end ``` ### os.trymv å°è¯•ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ã€‚ è·Ÿ [os.mv](#osmv) ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ï¼Œæ­¤æ¥å£æ“ä½œå¤±è´¥ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ä¸­æ–­ xmakeï¼Œè€Œæ˜¯é€šè¿‡è¿”å›å€¼æ ‡ç¤ºæ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚ ```lua if os.trymv(\"file\", \"dest/file\") then end ``` ### os.tryrm å°è¯•åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚ è·Ÿ [os.rm](#osrm) ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ï¼Œæ­¤æ¥å£æ“ä½œå¤±è´¥ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ä¸­æ–­ xmakeï¼Œè€Œæ˜¯é€šè¿‡è¿”å›å€¼æ ‡ç¤ºæ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚ ```lua if os.tryrm(\"file\") then end ``` ### os.cd è¿›å…¥æŒ‡å®šç›®å½•ã€‚ è¿™ä¸ªæ“ä½œç”¨äºç›®å½•åˆ‡æ¢ï¼ŒåŒæ ·ä¹Ÿæ”¯æŒå†…ç½®å˜é‡ï¼Œä½†æ˜¯ä¸æ”¯æŒæ¨¡å¼åŒ¹é…å’Œå¤šç›®å½•å¤„ç†ï¼Œä¾‹å¦‚ï¼š ```lua è¿›å…¥ä¸´æ—¶ç›®å½• os.cd(\"$(tmpdir)\") ``` å¦‚æœè¦ç¦»å¼€è¿›å…¥ä¹‹å‰çš„ç›®å½•ï¼Œæœ‰å¤šç§æ–¹å¼ï¼š ```lua è¿›å…¥ä¸Šçº§ç›®å½• os.cd(\"..\") è¿›å…¥å…ˆå‰çš„ç›®å½•ï¼Œç›¸å½“äºï¼šcd os.cd(\" \") è¿›å…¥ç›®å½•å‰ä¿å­˜ä¹‹å‰çš„ç›®å½•ï¼Œç”¨äºä¹‹åè·¨çº§ç›´æ¥åˆ‡å› local oldir os.cd(\"./src\") ... os.cd(oldir) ``` ### os.rmdir ä»…åˆ é™¤ç›®å½•ã€‚ å¦‚æœä¸æ˜¯ç›®å½•å°±æ— æ³•åˆ é™¤ã€‚ ### os.mkdir åˆ›å»ºç›®å½•ã€‚ æ”¯æŒæ‰¹é‡åˆ›å»ºå’Œå†…ç½®å˜é‡ï¼Œä¾‹å¦‚ï¼š ```lua os.mkdir(\"$(tmpdir)/test\", \"$(buildir)/inc\") ``` ### os.isdir åˆ¤æ–­æ˜¯å¦ä¸ºç›®å½•ã€‚ å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› false ```lua if os.isdir(\"src\") then ... end ``` ### os.isfile åˆ¤æ–­æ˜¯å¦ä¸ºæ–‡ä»¶ã€‚ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› false ```lua if os.isfile(\"$(buildir)/libxxx.a\") then ... end ``` ### os.exists åˆ¤æ–­æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚ å¦‚æœæ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› false ```lua åˆ¤æ–­ç›®å½•å­˜åœ¨ if os.exists(\"$(buildir)\") then ... end åˆ¤æ–­æ–‡ä»¶å­˜åœ¨ if os.exists(\"$(buildir)/libxxx.a\") then ... end ``` ### os.dirs éå†è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•ã€‚ æ”¯æŒ [add_files](#targetadd_files) ä¸­çš„æ¨¡å¼åŒ¹é…ï¼Œæ”¯æŒé€’å½’å’Œéé€’å½’æ¨¡å¼éå†ï¼Œè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª table æ•°ç»„ï¼Œå¦‚æœè·å–ä¸åˆ°ï¼Œè¿”å›ç©ºæ•°ç»„ï¼Œä¾‹å¦‚ï¼š ```lua é€’å½’éå†è·å–æ‰€æœ‰å­ç›®å½• for _, dir in ipairs(os.dirs(\"$(buildir)/inc/**\")) do print(dir) end ``` ### os.files éå†è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚ æ”¯æŒ [add_files](#targetadd_files) ä¸­çš„æ¨¡å¼åŒ¹é…ï¼Œæ”¯æŒé€’å½’å’Œéé€’å½’æ¨¡å¼éå†ï¼Œè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª table æ•°ç»„ï¼Œå¦‚æœè·å–ä¸åˆ°ï¼Œè¿”å›ç©ºæ•°ç»„ï¼Œä¾‹å¦‚ï¼š ```lua éé€’å½’éå†è·å–æ‰€æœ‰å­æ–‡ä»¶ for _, filepath in ipairs(os.files(\"$(buildir)/inc/*.h\")) do print(filepath) end ``` ### os.filedirs éå†è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ã€‚ æ”¯æŒ [add_files](#targetadd_files) ä¸­çš„æ¨¡å¼åŒ¹é…ï¼Œæ”¯æŒé€’å½’å’Œéé€’å½’æ¨¡å¼éå†ï¼Œè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª table æ•°ç»„ï¼Œå¦‚æœè·å–ä¸åˆ°ï¼Œè¿”å›ç©ºæ•°ç»„ï¼Œä¾‹å¦‚ï¼š ```lua é€’å½’éå†è·å–æ‰€æœ‰å­æ–‡ä»¶å’Œç›®å½• for _, filedir in ipairs(os.filedirs(\"$(buildir)/**\")) do print(filedir) end ``` ### os.run å®‰é™è¿è¡ŒåŸç”Ÿ shell å‘½ä»¤ã€‚ ç”¨äºæ‰§è¡Œç¬¬ä¸‰æ–¹çš„ shell å‘½ä»¤ï¼Œä½†ä¸ä¼šå›æ˜¾è¾“å‡ºï¼Œä»…ä»…åœ¨å‡ºé”™åï¼Œé«˜äº®è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ æ­¤æ¥å£æ”¯æŒå‚æ•°æ ¼å¼åŒ–ã€å†…ç½®å˜é‡ï¼Œä¾‹å¦‚ï¼š ```lua æ ¼å¼åŒ–å‚æ•°ä¼ å…¥ os.run(\"echo hello %s!\", \"xmake\") åˆ—ä¸¾æ„å»ºç›®å½•æ–‡ä»¶ os.run(\"ls l $(buildir)\") ``` > ä½¿ç”¨æ­¤æ¥å£æ‰§è¡Œ shell å‘½ä»¤ï¼Œå®¹æ˜“ä½¿æ„å»ºè·¨å¹³å°æ€§é™ä½ï¼Œå¯¹äº `os.run(\"cp ..\")` è¿™ç§å°½é‡ä½¿ç”¨ `os.cp` ä»£æ›¿ã€‚å¦‚æœå¿…é¡»ä½¿ç”¨æ­¤æ¥å£è¿è¡Œ shell ç¨‹åºï¼Œè¯·è‡ªè¡Œä½¿ç”¨ [config.plat](#config plat) æ¥å£åˆ¤æ–­å¹³å°æ”¯æŒã€‚ ### os.runv å®‰é™è¿è¡ŒåŸç”Ÿ shell å‘½ä»¤ï¼Œå¸¦å‚æ•°åˆ—è¡¨ã€‚ è·Ÿ [os.run](#osrun) ç±»ä¼¼ï¼Œåªæ˜¯ä¼ é€’å‚æ•°çš„æ–¹å¼æ˜¯é€šè¿‡å‚æ•°åˆ—è¡¨ä¼ é€’ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š ```lua os.runv(\"echo\", {\"hello\", \"xmake!\"}) ``` å¦å¤–ï¼Œæ­¤æ¥å£ä¹Ÿæ”¯æŒ envs å‚æ•°è®¾ç½®ï¼š ```lua os.runv(\"echo\", {\"hello\", \"xmake!\"}, {envs {PATH \"xxx;xx\", CFLAGS \"xx\"}}) ``` ### os.exec å›æ˜¾è¿è¡ŒåŸç”Ÿ shell å‘½ä»¤ã€‚ ä¸ [os.run](#osrun) æ¥å£ç±»ä¼¼ï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯ï¼Œæ­¤æ¥å£æ‰§è¡Œ shell ç¨‹åºæ—¶ï¼Œæ˜¯å¸¦å›æ˜¾è¾“å‡ºçš„ï¼Œä¸€èˆ¬è°ƒè¯•çš„æ—¶å€™ç”¨çš„æ¯”è¾ƒå¤š ### os.execv å›æ˜¾è¿è¡ŒåŸç”Ÿ shell å‘½ä»¤ï¼Œå¸¦å‚æ•°åˆ—è¡¨ã€‚ è·Ÿ [os.exec](#osexec) ç±»ä¼¼ï¼Œåªæ˜¯ä¼ é€’å‚æ•°çš„æ–¹å¼æ˜¯é€šè¿‡å‚æ•°åˆ—è¡¨ä¼ é€’ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š ```lua os.execv(\"echo\", {\"hello\", \"xmake!\"}) ``` å¦å¤–ï¼Œæ­¤æ¥å£è¿˜æ”¯æŒä¸€ä¸ªå¯é€‰çš„å‚æ•°ï¼Œç”¨äºä¼ é€’è®¾ç½®ï¼šé‡å®šå‘è¾“å‡ºï¼Œæ‰§è¡Œç¯å¢ƒå˜é‡è®¾ç½®ï¼Œä¾‹å¦‚ï¼š ```lua os.execv(\"echo\", {\"hello\", \"xmake!\"}, {stdout outfile, stderr errfile, envs {PATH \"xxx;xx\", CFLAGS \"xx\"}} ``` å…¶ä¸­ï¼Œstdout å’Œ stderr å‚æ•°ç”¨äºä¼ é€’é‡å®šå‘è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºï¼Œå¯ä»¥ç›´æ¥ä¼ å…¥æ–‡ä»¶è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ io.open æ‰“å¼€çš„æ–‡ä»¶å¯¹è±¡ã€‚ xmake è¿˜æ”¯æŒè®¾ç½® stdin å‚æ•°ï¼Œæ¥æ”¯æŒé‡å®šå‘è¾“å…¥æ–‡ä»¶ã€‚ > stdout/stderr/stdin å¯ä»¥åŒæ—¶æ”¯æŒï¼šæ–‡ä»¶è·¯å¾„ã€æ–‡ä»¶å¯¹è±¡ã€ç®¡é“å¯¹è±¡ç­‰ä¸‰ç§ç±»å‹å€¼ã€‚ å¦å¤–ï¼Œå¦‚æœæƒ³åœ¨è¿™æ¬¡æ‰§è¡Œä¸­ä¸´æ—¶è®¾ç½®å’Œæ”¹å†™ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä¼ é€’ envs å‚æ•°ï¼Œé‡Œé¢çš„ç¯å¢ƒå˜é‡è®¾ç½®ä¼šæ›¿æ¢å·²æœ‰çš„è®¾ç½®ï¼Œä½†æ˜¯ä¸å½±å“å¤–å±‚çš„æ‰§è¡Œç¯å¢ƒï¼Œåªå½±å“å½“å‰å‘½ä»¤ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `os.getenvs()` æ¥å£è·å–å½“å‰æ‰€æœ‰çš„ç¯å¢ƒå˜é‡ï¼Œç„¶åæ”¹å†™éƒ¨åˆ†åä¼ å…¥ envs å‚æ•°ã€‚ ### os.iorun å®‰é™è¿è¡ŒåŸç”Ÿ shell å‘½ä»¤å¹¶è·å–è¾“å‡ºå†…å®¹ã€‚ ä¸ [os.run](#osrun) æ¥å£ç±»ä¼¼ï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯ï¼Œæ­¤æ¥å£æ‰§è¡Œ shell ç¨‹åºåï¼Œä¼šè·å– shell ç¨‹åºçš„æ‰§è¡Œç»“æœï¼Œç›¸å½“äºé‡å®šå‘è¾“å‡ºã€‚ å¯åŒæ—¶è·å– `stdout`, `stderr` ä¸­çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼š ```lua local outdata, errdata os.iorun(\"echo hello xmake!\") ``` æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨ `bash c` æ¥å®ç°ç®¡é“å‘½ä»¤ï¼š ```lua local output os.iorun([[bash c \"cat /etc/passwd grep '/bin/bash' wc l tr d '\\n'\"]]) print(\"match lines count: [\" .. output .. \"]\") ``` ### os.iorunv å®‰é™è¿è¡ŒåŸç”Ÿ shell å‘½ä»¤å¹¶è·å–è¾“å‡ºå†…å®¹ï¼Œå¸¦å‚æ•°åˆ—è¡¨ã€‚ è·Ÿ [os.iorun](#osiorun) ç±»ä¼¼ï¼Œåªæ˜¯ä¼ é€’å‚æ•°çš„æ–¹å¼æ˜¯é€šè¿‡å‚æ•°åˆ—è¡¨ä¼ é€’ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š ```lua local outdata, errdata os.iorunv(\"echo\", {\"hello\", \"xmake!\"}) ``` å¦å¤–ï¼Œæ­¤æ¥å£ä¹Ÿæ”¯æŒ envs å‚æ•°è®¾ç½®ï¼š ```lua local outdata, errdata os.iorunv(\"echo\", {\"hello\", \"xmake!\"}, {envs {PATH \"xxx;xx\", CFLAGS \"xx\"}} ``` ### os.iorun_with_pipes å®‰é™è¿è¡ŒåŸç”Ÿ shell å‘½ä»¤å¹¶è·å–è¾“å‡ºå†…å®¹ï¼Œæ”¯æŒç®¡é“ã€‚ ```lua å¯ä»¥è¿è¡Œå¸¦ç®¡é“ç¬¦çš„å¤æ‚ shell å‘½ä»¤ @see https://github.com/TOMO CAT/xmake/issues/140 å®˜æ–¹å®ç°æ–¹æ³•æ¯”è¾ƒå¤æ‚: https://github.com/xmake io/xmake/discussions/6002 local output os.iorun_with_pipes( \"cat /etc/passwd grep '/bin/bash' wc l tr d '\\n'\") print(\"match lines count: [\" .. output .. \"]\") ``` ### os.getenv è·å–ç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚ ```lua print(os.getenv(\"PATH\")) ``` ### os.setenv è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚ ```lua os.setenv(\"HOME\", \"/tmp/\") ``` ### os.tmpdir è·å–ä¸´æ—¶ç›®å½•ã€‚ è·Ÿ [$(tmpdir)](#var tmpdir) ç»“æœä¸€è‡´ï¼Œåªä¸è¿‡æ˜¯ç›´æ¥è·å–è¿”å›ä¸€ä¸ªå˜é‡ï¼Œå¯ä»¥ç”¨åç»­å­—ç¬¦ä¸²ç»´æŠ¤ã€‚ ```lua print(path.join(os.tmpdir(), \"file.txt\")) ``` ç­‰ä»·äºï¼š ```lua print(\"$(tmpdir)/file.txt\") ``` ### os.tmpfile è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„ã€‚ ç”¨äºè·å–ç”Ÿæˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶è·¯å¾„ï¼Œä»…ä»…æ˜¯ä¸ªè·¯å¾„ï¼Œæ–‡ä»¶éœ€è¦è‡ªå·±åˆ›å»ºã€‚ ### os.curdir è·å–å½“å‰ç›®å½•è·¯å¾„ã€‚ è·Ÿ [$(curdir)](#var curdir) ç»“æœä¸€è‡´ï¼Œåªä¸è¿‡æ˜¯ç›´æ¥è·å–è¿”å›ä¸€ä¸ªå˜é‡ï¼Œå¯ä»¥ç”¨åç»­å­—ç¬¦ä¸²ç»´æŠ¤ã€‚ ç”¨æ³•å‚è€ƒï¼š[os.tmpdir](#ostmpdir)ã€‚ ### os.filesize è·å–æ–‡ä»¶å¤§å°ã€‚ ```lua print(os.filesize(\"/tmp/a\")) ``` ### os.scriptdir è·å–å½“å‰æè¿°è„šæœ¬çš„è·¯å¾„ã€‚ è·Ÿ [$(scriptdir)](#var scriptdir) ç»“æœä¸€è‡´ï¼Œåªä¸è¿‡æ˜¯ç›´æ¥è·å–è¿”å›ä¸€ä¸ªå˜é‡ï¼Œå¯ä»¥ç”¨åç»­å­—ç¬¦ä¸²ç»´æŠ¤ã€‚ ç”¨æ³•å‚è€ƒï¼š[os.tmpdir](#ostmpdir)ã€‚ ### os.programdir è·å– xmake å®‰è£…ä¸»ç¨‹åºè„šæœ¬ç›®å½•ã€‚ è·Ÿ [$(programdir)](#var programdir) ç»“æœä¸€è‡´ï¼Œåªä¸è¿‡æ˜¯ç›´æ¥è·å–è¿”å›ä¸€ä¸ªå˜é‡ï¼Œå¯ä»¥ç”¨åç»­å­—ç¬¦ä¸²ç»´æŠ¤ã€‚ ### os.programfile è·å– xmake å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ã€‚ ### os.projectdir è·å–å·¥ç¨‹ä¸»ç›®å½•ã€‚ è·Ÿ [$(projectdir)](#var projectdir) ç»“æœä¸€è‡´ï¼Œåªä¸è¿‡æ˜¯ç›´æ¥è·å–è¿”å›ä¸€ä¸ªå˜é‡ï¼Œå¯ä»¥ç”¨åç»­å­—ç¬¦ä¸²ç»´æŠ¤ã€‚ ### os.arch è·å–å½“å‰ç³»ç»Ÿæ¶æ„ã€‚ ä¹Ÿå°±æ˜¯å½“å‰ä¸»æœºç³»ç»Ÿçš„é»˜è®¤æ¶æ„ï¼Œä¾‹å¦‚æˆ‘åœ¨ `linux x86_64` ä¸Šæ‰§è¡Œ xmake è¿›è¡Œæ„å»ºï¼Œé‚£ä¹ˆè¿”å›å€¼æ˜¯ï¼š`x86_64` ### os.host è·å–å½“å‰ä¸»æœºçš„æ“ä½œç³»ç»Ÿã€‚ è·Ÿ [$(host)](#var host) ç»“æœä¸€è‡´ï¼Œä¾‹å¦‚æˆ‘åœ¨ `linux x86_64` ä¸Šæ‰§è¡Œ xmake è¿›è¡Œæ„å»ºï¼Œé‚£ä¹ˆè¿”å›å€¼æ˜¯ï¼š`linux` ### os.subhost è·å–å½“å‰å­ç³»ç»Ÿï¼Œå¦‚ï¼šåœ¨ Windows ä¸Šçš„ msysã€cygwinã€‚ ### os.subarch è·å–å­ç³»ç»Ÿæ¶æ„ã€‚ ### os.is_host åˆ¤æ–­ç»™å®šç³»ç»Ÿæ˜¯å¦ä¸ºå½“å‰ç³»ç»Ÿã€‚ ### os.is_arch åˆ¤æ–­ç»™å®šæ¶æ„æ˜¯å¦ä¸ºå½“å‰æ¶æ„ã€‚ ### os.is_subhost åˆ¤æ–­ç»™å®šå­ç³»ç»Ÿæ˜¯å¦ä¸ºå½“å‰å­ç³»ç»Ÿã€‚ ### os.is_subarch åˆ¤æ–­ç»™å®šå­ç³»ç»Ÿæ¶æ„æ˜¯å¦ä¸ºå½“å‰å­ç³»ç»Ÿæ¶æ„ã€‚ ### os.ln ä¸ºä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•åˆ›å»ºç¬¦å·é“¾æ¥ã€‚ ```lua åˆ›å»ºä¸€ä¸ªæŒ‡å‘ \"tmp.txt\" æ–‡ä»¶çš„ç¬¦å·é“¾æ¥ \"tmp.txt.ln\" os.ln(\"xxx.txt\", \"xxx.txt.ln\") ``` ### os.readlink è¯»å–ç¬¦å·é“¾æ¥å†…å®¹ã€‚ ### os.raise æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å¹¶ä¸”ä¸­æ­¢å½“å‰è„šæœ¬è¿è¡Œã€‚ ```lua æŠ›å‡ºä¸€ä¸ªå¸¦ \"an error occurred\" ä¿¡æ¯çš„å¼‚å¸¸ os.raise(\"an error occurred\") ``` > æ¨èä½¿ç”¨ä¸ `os.raise` ç­‰ä»·çš„å†…ç½®æ¥å£ `raise`ï¼Œç”¨æ³•ä¸ `os.raise` ä¸€è‡´ ### os.raiselevel ä¸ [os.raise](#osraise) ç±»ä¼¼ä½†æ˜¯å¯ä»¥æŒ‡å®šå¼‚å¸¸ç­‰çº§ã€‚ ```lua æŠ›å‡ºä¸€ä¸ªå¸¦ \"an error occurred\" ä¿¡æ¯çš„å¼‚å¸¸ os.raise(3, \"an error occurred\") ``` ### os.features è·å–ç³»ç»Ÿç‰¹æ€§ã€‚ ### os.getenvs è·å–æ‰€æœ‰å½“å‰ç³»ç»Ÿå˜é‡ã€‚ ```lua local envs os.getenvs() home directory (on linux) print(envs[\"HOME\"]) ``` ### os.setenvs ä½¿ç”¨ç»™å®šç³»ç»Ÿå˜é‡æ›¿æ¢å½“å‰æ‰€æœ‰ç³»ç»Ÿå˜é‡ï¼Œå¹¶è¿”å›æ—§ç³»ç»Ÿå˜é‡ã€‚ ### os.addenvs å‘å½“å‰ç³»ç»Ÿå˜é‡æ·»åŠ æ–°å˜é‡ï¼Œå¹¶ä¸”è¿”å›æ‰€æœ‰æ—§ç³»ç»Ÿå˜é‡ã€‚ ```lua os.setenvs({EXAMPLE \"a/path\"}) add a custom variable to see addenvs impact on it local oldenvs os.addenvs({EXAMPLE \"some/path/\"}) print(os.getenvs()[\"EXAMPLE\"]) got some/path/;a/path print(oldenvs[\"EXAMPLE\"]) got a/path ``` ### os.joinenvs æ‹¼æ¥ç³»ç»Ÿå˜é‡ï¼Œä¸ [os.addenvs](#osaddenvs) ç±»ä¼¼ï¼Œä½†æ˜¯ä¸ä¼šå¯¹å½“å‰ç¯å¢ƒå˜é‡äº§ç”Ÿå½±å“ï¼Œè‹¥ç¬¬äºŒä¸ªå‚æ•°ä¸º `nil`ï¼Œåˆ™ä½¿ç”¨åŸæœ‰ç¯å¢ƒå˜é‡ã€‚ ```lua os.joinenvs(envs, oldenvs) @param envs table ç±»å‹ï¼Œæ–°æ’å…¥çš„ç¯å¢ƒå˜é‡ @param oldenvs table ç±»å‹ï¼Œè¢«æ’å…¥çš„ç¯å¢ƒå˜é‡ï¼Œè‹¥ä¸º nil, åˆ™ä¸ºåŸæœ‰ç¯å¢ƒå˜é‡ @return table ç±»å‹ï¼Œæ‹¼æ¥åçš„ç¯å¢ƒå˜é‡ local envs0 {CUSTOM \"a/path\"} local envs1 {CUSTOM \"some/path/\"} print(os.joinenvs(envs0, envs1)) result is : { CUSTION \"a/path;some/path/\" } ``` ### os.setenvp ä½¿ç”¨ç»™å®šåˆ†éš”ç¬¦è®¾ç½®ç¯å¢ƒå˜é‡ã€‚ ### os.workingdir è·å–å·¥ä½œç›®å½•ã€‚ ### os.isroot åˆ¤æ–­ xmake æ˜¯å¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œã€‚ ### os.fscase åˆ¤æ–­æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦å¤§å°å†™æ•æ„Ÿã€‚ ### os.term è·å–å½“å‰ç»ˆç«¯ (windows terminal, vscode, xterm, ...)ã€‚ ### os.shell è·å–å½“å‰ shell (pwsh, cmd, bash, zsh, ...)ã€‚ ### os.cpuinfo è·å–å½“å‰ CPU ä¿¡æ¯ã€‚ ```lua print(os.cpuinfo()) probably got { march \"Alder Lake\", model 154, ncpu 20, model_name \"12th Gen Intel(R) Core(TM) i9 12900H\", usagerate 0.041839182376862, vendor \"GenuineIntel\", family 6 } print(os.cpuinfo(\"march\")) probably got \"Alder Lake\" ``` ### os.meminfo è·å–å†…å­˜ä¿¡æ¯ã€‚ ```lua print(os.meminfo()) probably got { pagesize 4096, usagerate 0.60694103194103, availsize 12798, totalsize 32560 } print(os.meminfo(\"pagesize\")) probably got 4096 ``` ### os.default_njob è·å–é»˜è®¤ç¼–è¯‘ä»»åŠ¡æ•°ã€‚ ## macos macOS ç³»ç»Ÿæ“ä½œæ¨¡å—ï¼Œå±äºå†…ç½®æ¨¡å—ï¼Œæ— éœ€ä½¿ç”¨ [import](#import) å¯¼å…¥ï¼Œå¯ç›´æ¥è„šæœ¬åŸŸè°ƒç”¨å…¶æ¥å£ã€‚ æ¥å£ æè¿° æ”¯æŒç‰ˆæœ¬ [macos.version](#macosversion) è·å– macOS ç³»ç»Ÿç‰ˆæœ¬ > 2.3.1 ### macos.version è·å– macOS ç³»ç»Ÿç‰ˆæœ¬ã€‚ è¿”å›çš„ç‰ˆæœ¬æ˜¯ semver è¯­ä¹‰ç‰ˆæœ¬å¯¹è±¡ ```lua if macos.version():ge(\"10.0\") then ... end ``` ## linuxos linux ç³»ç»Ÿæ“ä½œæ¨¡å—ï¼Œå±äºå†…ç½®æ¨¡å—ï¼Œæ— éœ€ä½¿ç”¨ [import](#import) å¯¼å…¥ï¼Œå¯ç›´æ¥è„šæœ¬åŸŸè°ƒç”¨å…¶æ¥å£ã€‚ æ¥å£ æè¿° æ”¯æŒç‰ˆæœ¬ [linuxos.name](#linuxosname) è·å– linux ç³»ç»Ÿå‘è¡Œç‰ˆåç§° > 2.5.2 [linuxos.version](#linuxosversion) è·å– linux ç³»ç»Ÿç‰ˆæœ¬ > 2.5.2 [linuxos.kernelver](#linuxoskernelver) è·å– linux ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ > 2.5.2 ### linuxos.name è·å– linux ç³»ç»Ÿå‘è¡Œç‰ˆåç§°ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œå¿«é€Ÿè·å–æŸ¥çœ‹ ```bash xmake l linuxos.name ``` ç›®å‰æ”¯æŒçš„ä¸€äº›åç§°æœ‰ï¼š * ubuntu * debian * archlinux * manjaro * linuxmint * centos * fedora * opensuse ### linuxos.version è·å– linux ç³»ç»Ÿç‰ˆæœ¬ã€‚ è¿”å›çš„ç‰ˆæœ¬æ˜¯ semver è¯­ä¹‰ç‰ˆæœ¬å¯¹è±¡ ```lua if linux.version():ge(\"10.0\") then ... end ``` ### linuxos.kernelver è·å– linux ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ã€‚ è¿”å›çš„ä¹Ÿæ˜¯è¯­ä¹‰ç‰ˆæœ¬å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œ `xmake l linuxos.kernelver` å¿«é€ŸæŸ¥çœ‹ ## io io æ“ä½œæ¨¡å—ï¼Œæ‰©å±•äº† lua å†…ç½®çš„ io æ¨¡å—ï¼Œæä¾›æ›´å¤šæ˜“ç”¨çš„æ¥å£ã€‚ æ¥å£ æè¿° æ”¯æŒç‰ˆæœ¬ [io.open](#ioopen) æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å†™ > 2.0.1 [io.load](#ioload) ä»æŒ‡å®šè·¯å¾„æ–‡ä»¶ååºåˆ—åŒ–åŠ è½½æ‰€æœ‰ table å†…å®¹ > 2.0.1 [io.save](#iosave) åºåˆ—åŒ–ä¿å­˜æ‰€æœ‰ table å†…å®¹åˆ°æŒ‡å®šè·¯å¾„æ–‡ä»¶ > 2.0.1 [io.readfile](#io.readfile) ä»æŒ‡å®šè·¯å¾„æ–‡ä»¶è¯»å–æ‰€æœ‰å†…å®¹ > 2.1.3 [io.writefile](#io.writefile) å†™å…¥æ‰€æœ‰å†…å®¹åˆ°æŒ‡å®šè·¯å¾„æ–‡ä»¶ > 2.1.3 [io.gsub](#iogsub) å…¨æ–‡æ›¿æ¢æŒ‡å®šè·¯å¾„æ–‡ä»¶çš„å†…å®¹ > 2.0.1 [io.tail](#iotail) è¯»å–å’Œæ˜¾ç¤ºæ–‡ä»¶çš„å°¾éƒ¨å†…å®¹ > 2.0.1 [io.cat](#iocat) è¯»å–å’Œæ˜¾ç¤ºæ–‡ä»¶çš„æ‰€æœ‰å†…å®¹ > 2.0.1 [io.print](#ioprint) å¸¦æ¢è¡Œæ ¼å¼åŒ–è¾“å‡ºå†…å®¹åˆ°æ–‡ä»¶ > 2.0.1 [io.printf](#ioprintf) æ— æ¢è¡Œæ ¼å¼åŒ–è¾“å‡ºå†…å®¹åˆ°æ–‡ä»¶ > 2.0.1 [io.lines](#iolines) è¯»å–æ–‡ä»¶çš„æ‰€æœ‰è¡Œ > 2.2.9 [io.stdfile](#iostdfile) è·å–æ ‡å‡†è¾“å…¥è¾“å‡ºæ–‡ä»¶ > 2.2.9 [io.openlock](#ioopenlock) åˆ›å»ºä¸€æŠŠæ–‡ä»¶é” > 2.2.9 [io.replace](#ioreplace) æ ¹æ®è¡¨è¾¾å¼æ›¿æ¢æ–‡ä»¶å†…å®¹ > 2.3.8 ### io.open æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å†™ã€‚ è¿™ä¸ªæ˜¯å±äº lua çš„åŸç”Ÿæ¥å£ï¼Œè¯¦ç»†ä½¿ç”¨å¯ä»¥å‚çœ‹ lua çš„å®˜æ–¹æ–‡æ¡£ï¼š[The Complete I/O Model](https://www.lua.org/pil/21.2.html) å¦‚æœè¦è¯»å–æ–‡ä»¶æ‰€æœ‰å†…å®¹ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š ```lua local file io.open(\"$(tmpdir)/file.txt\", \"r\") if file then local data file:read(\"*all\") file:close() end ``` æˆ–è€…å¯ä»¥ä½¿ç”¨ [io.readfile](#io.readfile) æ›´åŠ å¿«é€Ÿåœ°è¯»å–ã€‚ å¦‚æœè¦å†™æ–‡ä»¶ï¼Œå¯ä»¥è¿™ä¹ˆæ“ä½œï¼š ```lua æ‰“å¼€æ–‡ä»¶ï¼šw ä¸ºå†™æ¨¡å¼, a ä¸ºè¿½åŠ å†™æ¨¡å¼ local file io.open(\"xxx.txt\", \"w\") if file then ç”¨åŸç”Ÿçš„ lua æ¥å£å†™å…¥æ•°æ®åˆ°æ–‡ä»¶ï¼Œä¸æ”¯æŒæ ¼å¼åŒ–ï¼Œæ— æ¢è¡Œï¼Œä¸æ”¯æŒå†…ç½®å˜é‡ file:write(\"hello xmake\\n\") ç”¨ xmake æ‰©å±•çš„æ¥å£å†™å…¥æ•°æ®åˆ°æ–‡ä»¶ï¼Œæ”¯æŒæ ¼å¼åŒ–ï¼Œæ— æ¢è¡Œï¼Œä¸æ”¯æŒå†…ç½®å˜é‡ file:writef(\"hello %s\\n\", \"xmake\") ä½¿ç”¨ xmake æ‰©å±•çš„æ ¼å¼åŒ–ä¼ å‚å†™å…¥ä¸€è¡Œï¼Œå¸¦æ¢è¡Œç¬¦ï¼Œå¹¶ä¸”æ”¯æŒå†…ç½®å˜é‡ file:print(\"hello %s and $(buildir)\", \"xmake\") ä½¿ç”¨ xmake æ‰©å±•çš„æ ¼å¼åŒ–ä¼ å‚å†™å…¥ä¸€è¡Œï¼Œæ— æ¢è¡Œç¬¦ï¼Œå¹¶ä¸”æ”¯æŒå†…ç½®å˜é‡ file:printf(\"hello %s and $(buildir) \\n\", \"xmake\") å…³é—­æ–‡ä»¶ file:close() end ``` ### io.load ä»æŒ‡å®šè·¯å¾„æ–‡ä»¶ååºåˆ—åŒ–åŠ è½½æ‰€æœ‰ table å†…å®¹ã€‚ å¯ä»¥ä»æ–‡ä»¶ä¸­åŠ è½½åºåˆ—åŒ–å¥½çš„ table å†…å®¹ï¼Œä¸€èˆ¬ä¸ [io.save](#iosave) é…åˆä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š ```lua åŠ è½½åºåˆ—åŒ–æ–‡ä»¶çš„å†…å®¹åˆ° table local data io.load(\"xxx.txt\") if data then åœ¨ç»ˆç«¯ä¸­ dump æ‰“å°æ•´ä¸ª table ä¸­å†…å®¹ï¼Œæ ¼å¼åŒ–è¾“å‡º utils.dump(data) end ``` ### io.save åºåˆ—åŒ–ä¿å­˜æ‰€æœ‰ table å†…å®¹åˆ°æŒ‡å®šè·¯å¾„æ–‡ä»¶ã€‚ å¯ä»¥åºåˆ—åŒ–å­˜å‚¨ table å†…å®¹åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œä¸€èˆ¬ä¸ [io.load](#ioload) é…åˆä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š ```lua io.save(\"xxx.txt\", {a \"a\", b \"b\", c \"c\"}) ``` å­˜å‚¨ç»“æœä¸ºï¼š ``` { [\"b\"] \"b\" , [\"a\"] \"a\" , [\"c\"] \"c\" } ``` ### io.readfile ä»æŒ‡å®šè·¯å¾„æ–‡ä»¶è¯»å–æ‰€æœ‰å†…å®¹ã€‚ å¯åœ¨ä¸æ‰“å¼€æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œç›´æ¥è¯»å–æ•´ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œæ›´åŠ çš„æ–¹ä¾¿ï¼Œä¾‹å¦‚ï¼š ```lua local data io.readfile(\"xxx.txt\") ``` ### io.writefile å†™å…¥æ‰€æœ‰å†…å®¹åˆ°æŒ‡å®šè·¯å¾„æ–‡ä»¶ã€‚ å¯åœ¨ä¸æ‰“å¼€æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œç›´æ¥å†™å…¥æ•´ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œæ›´åŠ çš„æ–¹ä¾¿ï¼Œä¾‹å¦‚ï¼š ```lua io.writefile(\"xxx.txt\", \"all data\") ``` ### io.gsub å…¨æ–‡æ›¿æ¢æŒ‡å®šè·¯å¾„æ–‡ä»¶çš„å†…å®¹ã€‚ ç±»ä¼¼ [string.gsub](#stringgsub) æ¥å£ï¼Œå…¨æ–‡æ¨¡å¼åŒ¹é…æ›¿æ¢å†…å®¹ï¼Œä¸è¿‡è¿™é‡Œæ˜¯ç›´æ¥æ“ä½œæ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š ```lua ç§»é™¤æ–‡ä»¶æ‰€æœ‰çš„ç©ºç™½å­—ç¬¦ io.gsub(\"xxx.txt\", \"%s+\", \"\") ``` ### io.tail è¯»å–å’Œæ˜¾ç¤ºæ–‡ä»¶çš„å°¾éƒ¨å†…å®¹ã€‚ è¯»å–æ–‡ä»¶å°¾éƒ¨æŒ‡å®šè¡Œæ•°çš„æ•°æ®ï¼Œå¹¶æ˜¾ç¤ºï¼Œç±»ä¼¼ `cat xxx.txt tail n 10` å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š ```lua æ˜¾ç¤ºæ–‡ä»¶æœ€å 10 è¡Œå†…å®¹ io.tail(\"xxx.txt\", 10) ``` ### io.cat è¯»å–å’Œæ˜¾ç¤ºæ–‡ä»¶çš„æ‰€æœ‰å†…å®¹ã€‚ è¯»å–æ–‡ä»¶çš„æ‰€æœ‰å†…å®¹å¹¶æ˜¾ç¤ºï¼Œç±»ä¼¼ `cat xxx.txt` å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š ```lua io.cat(\"xxx.txt\") ``` ### io.print å¸¦æ¢è¡Œæ ¼å¼åŒ–è¾“å‡ºå†…å®¹åˆ°æ–‡ä»¶ã€‚ ç›´æ¥æ ¼å¼åŒ–ä¼ å‚è¾“å‡ºä¸€è¡Œå­—ç¬¦ä¸²åˆ°æ–‡ä»¶ï¼Œå¹¶ä¸”å¸¦æ¢è¡Œï¼Œä¾‹å¦‚ï¼š ```lua io.print(\"xxx.txt\", \"hello %s!\", \"xmake\") ``` ### io.printf æ— æ¢è¡Œæ ¼å¼åŒ–è¾“å‡ºå†…å®¹åˆ°æ–‡ä»¶ã€‚ ç›´æ¥æ ¼å¼åŒ–ä¼ å‚è¾“å‡ºä¸€è¡Œå­—ç¬¦ä¸²åˆ°æ–‡ä»¶ï¼Œä¸å¸¦æ¢è¡Œï¼Œä¾‹å¦‚ï¼š ```lua io.printf(\"xxx.txt\", \"hello %s!\\n\", \"xmake\") ``` ### io.lines è¯»å–æ–‡ä»¶çš„æ‰€æœ‰è¡Œã€‚ æ ¹æ®æ–‡ä»¶åè¿”å›è¯¥æ–‡ä»¶çš„æ‰€æœ‰è¡Œçš„å†…å®¹ ```lua local lines io.lines(\"xxx.txt\") for line in lines do print(line) end ``` ### io.stdfile è·å–æ ‡å‡†è¾“å…¥è¾“å‡ºæ–‡ä»¶ã€‚ æ ¹æ®æ–‡ä»¶åè¿”å›æ ‡å‡†è¾“å…¥è¾“å‡ºæ–‡ä»¶ ```lua æ ‡å‡†è¾“å…¥ io.stdin æ ‡å‡†è¾“å‡º io.stdout æ ‡å‡†é”™è¯¯ io.stderr ``` ### io.openlock åˆ›å»ºä¸€æŠŠæ–‡ä»¶é”ã€‚ ä¸ºç»™å®šçš„æ–‡ä»¶è¿”å›ä¸€ä¸ªæ–‡ä»¶é”å¯¹è±¡ ```lua local lock io.openlock(\"xxx.txt\") lock:lock() lock:unlock() lock:close() ``` ### io.replace æ ¹æ®è¡¨è¾¾å¼æ›¿æ¢æ–‡ä»¶å†…å®¹ã€‚ æ ¹æ®è¡¨è¾¾å¼å’Œå‚æ•°å¯¹æ–‡ä»¶è¿›è¡Œå…¨æ–‡æ›¿æ¢ ```lua io.replace(filepath, pattern, replace, opt) io.replace(\"xxx.txt\", \"test\", \"xmake\", { plain true, encoding \"UTF 8\"}) io.replace(\"xxx.txt\", \"%d[^\\n]*\", \"xmake\") ``` å…³äºå‚æ•° `opt` æˆå‘˜çš„è§£é‡Šï¼š > .plain: è‹¥ä¸º trueï¼Œä½¿ç”¨ pattern è¿›è¡Œç®€å•åŒ¹é…ï¼›ä¸º falseï¼Œåˆ™è¿›è¡Œæ¨¡å¼åŒ¹é…ï¼› > > .encoding: æŒ‡å®šæ–‡ä»¶ç¼–ç æ ¼å¼ ## path è·¯å¾„æ“ä½œæ¨¡å—ï¼Œå®ç°è·¨å¹³å°çš„è·¯å¾„æ“ä½œï¼Œè¿™æ˜¯ xmake çš„ä¸€ä¸ªè‡ªå®šä¹‰çš„æ¨¡å—ã€‚ æ¥å£ æè¿° æ”¯æŒç‰ˆæœ¬ [path.join](#pathjoin) æ‹¼æ¥è·¯å¾„ > 2.0.1 [path.translate](#pathtranslate) è½¬æ¢è·¯å¾„åˆ°å½“å‰å¹³å°çš„è·¯å¾„é£æ ¼ > 2.0.1 [path.basename](#pathbasename) è·å–è·¯å¾„æœ€åä¸å¸¦åç¼€çš„æ–‡ä»¶å > 2.0.1 [path.filename](#pathfilename) è·å–è·¯å¾„æœ€åå¸¦åç¼€çš„æ–‡ä»¶å > 2.0.1 [path.extension](#pathextension) è·å–è·¯å¾„çš„åç¼€å > 2.0.1 [path.directory](#pathdirectory) è·å–è·¯å¾„çš„ç›®å½•å > 2.0.1 [path.relative](#pathrelative) è½¬æ¢æˆç›¸å¯¹è·¯å¾„ > 2.0.1 [path.absolute](#pathabsolute) è½¬æ¢æˆç»å¯¹è·¯å¾„ > 2.0.1 [path.is_absolute](#pathis_absolute) åˆ¤æ–­æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ > 2.0.1 [path.splitenv](#pathsplitenv) åˆ†å‰²ç¯å¢ƒå˜é‡ä¸­çš„è·¯å¾„ > 2.2.7 ### path.join æ‹¼æ¥è·¯å¾„ã€‚ å°†å¤šä¸ªè·¯å¾„é¡¹è¿›è¡Œè¿½åŠ æ‹¼æ¥ï¼Œç”±äº `windows/unix` é£æ ¼çš„è·¯å¾„å·®å¼‚ï¼Œä½¿ç”¨ api æ¥è¿½åŠ è·¯å¾„æ›´åŠ è·¨å¹³å°ï¼Œä¾‹å¦‚ï¼š ```lua print(path.join(\"$(tmpdir)\", \"dir1\", \"dir2\", \"file.txt\")) ``` ä¸Šè¿°æ‹¼æ¥åœ¨ unix ä¸Šç›¸å½“äºï¼š`$(tmpdir)/dir1/dir2/file.txt`ï¼Œè€Œåœ¨ windows ä¸Šç›¸å½“äºï¼š`$(tmpdir)\\\\dir1\\\\dir2\\\\file.txt` å¦‚æœè§‰å¾—è¿™æ ·å¾ˆç¹çï¼Œä¸å¤Ÿæ¸…æ™°ç®€æ´ï¼Œå¯ä»¥ä½¿ç”¨ï¼š[path.translate](path translate) æ–¹å¼ï¼Œæ ¼å¼åŒ–è½¬æ¢è·¯å¾„å­—ç¬¦ä¸²åˆ°å½“å‰å¹³å°æ”¯æŒçš„æ ¼å¼ã€‚ ### path.translate è½¬æ¢è·¯å¾„åˆ°å½“å‰å¹³å°çš„è·¯å¾„é£æ ¼ã€‚ æ ¼å¼åŒ–è½¬åŒ–æŒ‡å®šè·¯å¾„å­—ç¬¦ä¸²åˆ°å½“å‰å¹³å°æ”¯æŒçš„è·¯å¾„é£æ ¼ï¼ŒåŒæ—¶æ”¯æŒ `windows/unix` æ ¼å¼çš„è·¯å¾„å­—ç¬¦ä¸²å‚æ•°ä¼ å…¥ï¼Œç”šè‡³æ··åˆä¼ å…¥ï¼Œä¾‹å¦‚ï¼š ```lua print(path.translate(\"$(tmpdir)/dir/file.txt\")) print(path.translate(\"$(tmpdir)\\\\dir\\\\file.txt\")) print(path.translate(\"$(tmpdir)\\\\dir/dir2//file.txt\")) ``` ä¸Šé¢è¿™ä¸‰ç§ä¸åŒæ ¼å¼çš„è·¯å¾„å­—ç¬¦ä¸²ï¼Œç»è¿‡ `translate` è§„èŒƒåŒ–åï¼Œå°±ä¼šå˜æˆå½“å‰å¹³å°æ”¯æŒçš„æ ¼å¼ï¼Œå¹¶ä¸”ä¼šå»æ‰å†—ä½™çš„è·¯å¾„åˆ†éš”ç¬¦ã€‚ ### path.basename è·å–è·¯å¾„æœ€åä¸å¸¦åç¼€çš„æ–‡ä»¶åã€‚ ```lua print(path.basename(\"$(tmpdir)/dir/file.txt\")) ``` æ˜¾ç¤ºç»“æœä¸ºï¼š`file` ### path.filename è·å–è·¯å¾„æœ€åå¸¦åç¼€çš„æ–‡ä»¶åã€‚ ```lua print(path.filename(\"$(tmpdir)/dir/file.txt\")) ``` æ˜¾ç¤ºç»“æœä¸ºï¼š`file.txt` ### path.extension è·å–è·¯å¾„çš„åç¼€åã€‚ ```lua print(path.extensione(\"$(tmpdir)/dir/file.txt\")) ``` æ˜¾ç¤ºç»“æœä¸ºï¼š`.txt` ### path.directory è·å–è·¯å¾„çš„ç›®å½•åã€‚ ```lua print(path.directory(\"$(tmpdir)/dir/file.txt\")) ``` æ˜¾ç¤ºç»“æœä¸ºï¼š`$(tmpdir)/dir` ### path.relative è½¬æ¢æˆç›¸å¯¹è·¯å¾„ã€‚ ```lua print(path.relative(\"$(tmpdir)/dir/file.txt\", \"$(tmpdir)\")) ``` æ˜¾ç¤ºç»“æœä¸ºï¼š`dir/file.txt` ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡å®šç›¸å¯¹çš„æ ¹ç›®å½•ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤ç›¸å¯¹å½“å‰ç›®å½•ï¼š ```lua os.cd(\"$(tmpdir)\") print(path.relative(\"$(tmpdir)/dir/file.txt\")) ``` è¿™æ ·ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ ### path.absolute è½¬æ¢æˆç»å¯¹è·¯å¾„ã€‚ ```lua print(path.absolute(\"dir/file.txt\", \"$(tmpdir)\")) ``` æ˜¾ç¤ºç»“æœä¸ºï¼š`$(tmpdir)/dir/file.txt` ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡å®šç›¸å¯¹çš„æ ¹ç›®å½•ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤ç›¸å¯¹å½“å‰ç›®å½•ï¼š ```lua os.cd(\"$(tmpdir)\") print(path.absolute(\"dir/file.txt\")) ``` è¿™æ ·ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ ### path.is_absolute åˆ¤æ–­æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ã€‚ ```lua if path.is_absolute(\"/tmp/file.txt\") then å¦‚æœæ˜¯ç»å¯¹è·¯å¾„ end ``` ### path.splitenv åˆ†å‰²ç¯å¢ƒå˜é‡ä¸­çš„è·¯å¾„ã€‚ ```lua local pathes path.splitenv(vformat(\"$(env PATH)\")) for windows local pathes path.splitenv(\"C:\\\\Windows;C:\\\\Windows\\\\System32\") got {\"C:\\\\Windows\", \"C:\\\\Windows\\\\System32\"} for *nix local pathes path.splitenv(\"/usr/bin:/usr/local/bin\") got {\"/usr/bin\", \"/usr/local/bin\"} ``` ç»“æœä¸ºä¸€ä¸ªåŒ…å«äº†è¾“å…¥å­—ç¬¦ä¸²ä¸­è·¯å¾„çš„æ•°ç»„ã€‚ ## table table å±äº lua åŸç”Ÿæä¾›çš„æ¨¡å—ï¼Œå¯¹äºåŸç”Ÿæ¥å£ä½¿ç”¨å¯ä»¥å‚è€ƒï¼š[lua å®˜æ–¹æ–‡æ¡£](https://www.lua.org/manual/5.1/manual.html#5.5) xmake ä¸­å¯¹å…¶è¿›è¡Œäº†æ‰©å±•ï¼Œå¢åŠ äº†ä¸€äº›æ‰©å±•æ¥å£ï¼š æ¥å£ æè¿° æ”¯æŒç‰ˆæœ¬ [table.join](#tablejoin) åˆå¹¶å¤šä¸ª table å¹¶è¿”å› > 2.0.1 [table.join2](#tablejoin2) åˆå¹¶å¤šä¸ª table åˆ°ç¬¬ä¸€ä¸ª table > 2.0.1 [table.unique](#tableunique) å¯¹ table ä¸­çš„å†…å®¹è¿›è¡Œå»é‡ > 2.0.1 [table.slice](#tableslice) è·å– table çš„åˆ‡ç‰‡ > 2.0.1 ### table.join åˆå¹¶å¤šä¸ª table å¹¶è¿”å›ã€‚ å¯ä»¥å°†å¤šä¸ª table é‡Œé¢çš„å…ƒç´ è¿›è¡Œåˆå¹¶åï¼Œè¿”å›åˆ°ä¸€ä¸ªæ–°çš„ table ä¸­ï¼Œä¾‹å¦‚ï¼š ```lua local newtable table.join({1, 2, 3}, {4, 5, 6}, {7, 8, 9}) ``` ç»“æœä¸ºï¼š`{1, 2, 3, 4, 5, 6, 7, 8, 9}` å¹¶ä¸”å®ƒä¹Ÿæ”¯æŒå­—å…¸çš„åˆå¹¶ï¼š ```lua local newtable table.join({a \"a\", b \"b\"}, {c \"c\"}, {d \"d\"}) ``` ç»“æœä¸ºï¼š`{a \"a\", b \"b\", c \"c\", d \"d\"}` ### table.join2 åˆå¹¶å¤šä¸ª table åˆ°ç¬¬ä¸€ä¸ª tableã€‚ ç±»ä¼¼ [table.join](#table.join)ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œåˆå¹¶çš„ç»“æœæ”¾ç½®åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ï¼Œä¾‹å¦‚ï¼š ```lua local t {0, 9} table.join2(t, {1, 2, 3}) ``` ç»“æœä¸ºï¼š`t {0, 9, 1, 2, 3}` ### table.unique å¯¹ table ä¸­çš„å†…å®¹è¿›è¡Œå»é‡ã€‚ å»é‡ table çš„å…ƒç´ ï¼Œä¸€èˆ¬ç”¨äºæ•°ç»„ tableï¼Œä¾‹å¦‚ï¼š ```lua local newtable table.unique({1, 1, 2, 3, 4, 4, 5}) ``` ç»“æœä¸ºï¼š`{1, 2, 3, 4, 5}` ### table.slice è·å– table çš„åˆ‡ç‰‡ã€‚ ç”¨äºæå–æ•°ç»„ table çš„éƒ¨åˆ†å…ƒç´ ï¼Œä¾‹å¦‚ï¼š ```lua æå–ç¬¬ 4 ä¸ªå…ƒç´ åé¢çš„æ‰€æœ‰å…ƒç´ ï¼Œç»“æœï¼š{4, 5, 6, 7, 8, 9} table.slice({1, 2, 3, 4, 5, 6, 7, 8, 9}, 4) æå–ç¬¬ 4 8 ä¸ªå…ƒç´ ï¼Œç»“æœï¼š{4, 5, 6, 7, 8} table.slice({1, 2, 3, 4, 5, 6, 7, 8, 9}, 4, 8) æå–ç¬¬ 4 8 ä¸ªå…ƒç´ ï¼Œé—´éš”æ­¥é•¿ä¸º 2ï¼Œç»“æœï¼š{4, 6, 8} table.slice({1, 2, 3, 4, 5, 6, 7, 8, 9}, 4, 8, 2) ``` ### table.contains åˆ¤æ–­ table ä¸­åŒ…å«æŒ‡å®šçš„å€¼ã€‚ ```lua if table.contains(t, 1, 2, 3) then ... end ``` åªè¦ table ä¸­åŒ…å« 1, 2, 3 é‡Œé¢ä»»æ„ä¸€ä¸ªå€¼ï¼Œåˆ™è¿”å› true ### table.orderkeys è·å–æœ‰åºçš„ key åˆ—è¡¨ã€‚ `table.keys(t)` è¿”å›çš„ key åˆ—è¡¨é¡ºåºæ˜¯éšæœºçš„ï¼Œæƒ³è¦è·å–æœ‰åº key åˆ—è¡¨ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ¥å£ã€‚ ## string å­—ç¬¦ä¸²æ¨¡å—ä¸º lua åŸç”Ÿè‡ªå¸¦çš„æ¨¡å—ï¼Œå…·ä½“ä½¿ç”¨è§ï¼š[lua å®˜æ–¹æ‰‹å†Œ](https://www.lua.org/manual/5.1/manual.html#5.4) xmake ä¸­å¯¹å…¶è¿›è¡Œäº†æ‰©å±•ï¼Œå¢åŠ äº†ä¸€äº›æ‰©å±•æ¥å£ï¼š æ¥å£ æè¿° æ”¯æŒç‰ˆæœ¬ [string.startswith](#stringstartswith) åˆ¤æ–­å­—ç¬¦ä¸²å¼€å¤´æ˜¯å¦åŒ¹é… > 1.0.1 [string.endswith](#stringendswith) åˆ¤æ–­å­—ç¬¦ä¸²ç»“å°¾æ˜¯å¦åŒ¹é… > 1.0.1 [string.split](#stringsplit) åˆ†å‰²å­—ç¬¦ä¸² > 1.0.1 [string.trim](#stringtrim) å»æ‰å­—ç¬¦ä¸²å·¦å³ç©ºç™½å­—ç¬¦ > 1.0.1 [string.ltrim](#stringltrim) å»æ‰å­—ç¬¦ä¸²å·¦è¾¹ç©ºç™½å­—ç¬¦ > 1.0.1 [string.rtrim](#stringrtrim) å»æ‰å­—ç¬¦ä¸²å³è¾¹ç©ºç™½å­—ç¬¦ > 1.0.1 ### string.startswith åˆ¤æ–­å­—ç¬¦ä¸²å¼€å¤´æ˜¯å¦åŒ¹é…ã€‚ ```lua local s \"hello xmake\" if s:startswith(\"hello\") then print(\"match\") end ``` ### string.endswith åˆ¤æ–­å­—ç¬¦ä¸²ç»“å°¾æ˜¯å¦åŒ¹é…ã€‚ ```lua local s \"hello xmake\" if s:endswith(\"xmake\") then print(\"match\") end ``` ### string.split åˆ†å‰²å­—ç¬¦ä¸²ã€‚ æŒ‰æ¨¡å¼åŒ¹é…åˆ†å‰²å­—ç¬¦ä¸²ï¼Œå¿½ç•¥ç©ºä¸²ï¼Œä¾‹å¦‚ï¼š ```lua (\"1\\n\\n2\\n3\"):split('\\n') > 1, 2, 3 (\"abc123123xyz123abc\"):split('123') > abc, xyz, abc (\"abc123123xyz123abc\"):split('[123]+') > abc, xyz, abc ``` æŒ‰çº¯æ–‡æœ¬åŒ¹é…åˆ†å‰²å­—ç¬¦ä¸²ï¼Œå¿½ç•¥ç©ºä¸²ï¼ˆçœå»äº†æ¨¡å¼åŒ¹é…ï¼Œä¼šæå‡ç¨è®¸æ€§èƒ½ï¼‰ï¼Œä¾‹å¦‚ï¼š ```lua (\"1\\n\\n2\\n3\"):split('\\n', {plain true}) > 1, 2, 3 (\"abc123123xyz123abc\"):split('123', {plain true}) > abc, xyz, abc ``` æŒ‰æ¨¡å¼åŒ¹é…åˆ†å‰²å­—ç¬¦ä¸²ï¼Œä¸¥æ ¼åŒ¹é…ï¼Œä¸å¿½ç•¥ç©ºä¸²ï¼Œä¾‹å¦‚ï¼š ```lua (\"1\\n\\n2\\n3\"):split('\\n', {strict true}) > 1, , 2, 3 (\"abc123123xyz123abc\"):split('123', {strict true}) > abc, , xyz, abc (\"abc123123xyz123abc\"):split('[123]+', {strict true}) > abc, xyz, abc ``` æŒ‰çº¯æ–‡æœ¬åŒ¹é…åˆ†å‰²å­—ç¬¦ä¸²ï¼Œä¸¥æ ¼åŒ¹é…ï¼Œä¸å¿½ç•¥ç©ºä¸²ï¼ˆçœå»äº†æ¨¡å¼åŒ¹é…ï¼Œä¼šæå‡ç¨è®¸æ€§èƒ½ï¼‰ï¼Œä¾‹å¦‚ï¼š ```lua (\"1\\n\\n2\\n3\"):split('\\n', {plain true, strict true}) > 1, , 2, 3 (\"abc123123xyz123abc\"):split('123', {plain true, strict true}) > abc, , xyz, abc ``` é™åˆ¶åˆ†å‰²å—æ•° ```lua (\"1\\n\\n2\\n3\"):split('\\n', {limit 2}) > 1, 2\\n3 (\"1.2.3.4.5\"):split('%.', {limit 3}) > 1, 2, 3.4.5 ``` ### string.trim å»æ‰å­—ç¬¦ä¸²å·¦å³ç©ºç™½å­—ç¬¦ã€‚ ```lua string.trim(\" hello xmake! \") ``` ç»“æœä¸ºï¼š\"hello xmake!\" ### string.ltrim å»æ‰å­—ç¬¦ä¸²å·¦è¾¹ç©ºç™½å­—ç¬¦ã€‚ ```lua string.ltrim(\" hello xmake!\") ``` ç»“æœä¸ºï¼š\"hello xmake!\" ### string.rtrim å»æ‰å­—ç¬¦ä¸²å³è¾¹ç©ºç™½å­—ç¬¦ã€‚ ```lua string.rtrim(\"hello xmake! \") ``` ç»“æœä¸ºï¼š\"hello xmake!\" ## coroutine åç¨‹æ¨¡å—æ˜¯ lua åŸç”Ÿè‡ªå¸¦çš„æ¨¡å—ï¼Œå…·ä½¿ç”¨è§ï¼š[lua å®˜æ–¹æ‰‹å†Œ](https://www.lua.org/manual/5.1/manual.html#5.2) ## signal æˆ‘ä»¬å¯ä»¥åœ¨ lua å±‚ï¼Œæ³¨å†Œ SIGINT ç­‰ä¿¡å·å¤„ç†å‡½æ•°ï¼Œæ¥å®šåˆ¶åŒ–å“åº”é€»è¾‘ã€‚ ### signal.register æ³¨å†Œä¿¡å·å¤„ç†å™¨ã€‚ ç›®å‰ä»…ä»…æ”¯æŒ SIGINT ä¿¡å·çš„å¤„ç†ï¼ŒåŒæ—¶å®ƒä¹Ÿæ˜¯æ”¯æŒ windows ç­‰ä¸»æµå¹³å°çš„ã€‚ ```lua import(\"core.base.signal\") function main() signal.register(signal.SIGINT, function (signo) print(\"signal.SIGINT(%d)\", signo) end) io.read() end ``` è¿™å¯¹äºå½“ä¸€äº›å­è¿›ç¨‹å†…éƒ¨å±è”½äº† SIGINTï¼Œå¯¼è‡´å¡æ­»ä¸é€€å‡ºï¼Œå³ä½¿ç”¨æˆ·æŒ‰äº† `Ctrl+C` é€€å‡ºäº† xmake è¿›ç¨‹ï¼Œå®ƒä¹Ÿæ²¡æœ‰é€€å‡ºæ—¶å€™ï¼Œ æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å»å¼ºåˆ¶é€€æ‰å®ƒã€‚ ```lua import(\"core.base.process\") import(\"core.base.signal\") function main() local proc signal.register(signal.SIGINT, function (signo) print(\"sigint\") if proc then proc:kill() end end) proc process.open(\"./trap.sh\") if proc then proc:wait() proc:close() end end ``` å…³äºè¿™ä¸ªé—®é¢˜çš„èƒŒæ™¯ï¼Œå¯ä»¥å‚è€ƒï¼š[#4889](https://github.com/xmake io/xmake/issues/4889) ### signal.ignore å¿½ç•¥æŸä¸ªä¿¡å·ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ `signal.ignore` è¿™ä¸ªæ¥å£ï¼Œå»å¿½ç•¥å±è”½æŸä¸ªä¿¡å·çš„å¤„ç†ã€‚ ```lua signal.ignore(signal.SIGINT) ``` ### signal.reset é‡ç½®æŸä¸ªä¿¡å·ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¸…é™¤æŸä¸ªä¿¡å·çš„å¤„ç†å‡½æ•°ï¼Œå›é€€åˆ°é»˜è®¤çš„å¤„ç†é€»è¾‘ã€‚ ```lua signal.reset(signal.SIGINT) ```"}}