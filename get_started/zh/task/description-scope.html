<!DOCTYPE html>

<html lang="zh-CN"  class=" language_zh  heading_no_counter ">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="keywords" content="">
    
    
    <meta name="description" content="">
    
    <meta name="generator" content="teedoc">
    <meta name="theme" content="teedoc-plugin-theme-default">
    
        
        <meta name="markdown-generator" content="teedoc-plugin-markdown-parser">
        
        <script>
MathJax = {"loader": {"load": ["output/svg"]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}, "svg": {"fontCache": "global"}};
</script>
        
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
        <script src="/static/js/theme_default/pre_main.js"></script>
        
        <link rel="stylesheet" href="/static/css/theme_default/prism.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/viewer.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/dark.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/light.css" type="text/css"/>
        
        <script src="/static/js/theme_default/jquery.min.js"></script>
        
        <script src="/static/js/theme_default/split.js"></script>
        
        <link rel="stylesheet" href="/static/css/search/style.css" type="text/css"/>
        
        <meta name="blog-generator" content="teedoc-plugin-blog">
        
        <link rel="stylesheet" href="/static/css/custom.css" type="text/css"/>
        
    
    
    <title>xmake-docs</title>
    
    <script type="text/javascript">js_vars = {}</script>
    <script type="text/javascript">metadata = {"tags": [], "date": false, "update": [], "ts": 0, "author": "", "brief": "", "cover": "", "class": "heading_no_counter"}</script>
</head>


<body class="type_doc">
    
    <div id="navbar">
        <div id="navbar_menu">
            <a class="site_title" href="/">
                
                    <img class="site_logo" src="/static/image/logo-1600.png" alt="logo">
                
                
                    <h2>xmake</h2>
                
        </a>
            <a id="navbar_menu_btn"></a>
        </div>
        <div id="navbar_items">
            <div>
                <ul id="nav_left">
<li class=""><a  href="/get_started/zh/tutorial/quick-start.html">安装使用</a></li>
<li class=""><a  href="/dev/">开发文档</a></li>
</ul>

            </div>
            <div>
                <ul id="nav_right">
<li class=""><a target="_blank" href="https://github.com/neutree/teedoc">github</a></li>
</ul>

                <ul class="nav_plugins"><li><a id="themes" class="light"></a></li></ul><ul class="nav_plugins"><li><a id="search"><span class="icon"></span><span class="placeholder">搜索</span>
                            <div id="search_hints">
                                <span id="search_input_hint">输入关键词，多关键词空格隔开</span>
                                <span id="search_loading_hint">正在加载，请稍候。。。</span>
                                <span id="search_download_err_hint">下载文件失败，请刷新重试或检查网络</span>
                                <span id="search_other_docs_result_hint">来自其它文档的结果</span>
                                <span id="search_curr_doc_result_hint">当前文档搜索结果</span>
                            </div></a></li></ul>
            </div>
        </div>
    </div>
    
    <div id="wrapper">
        <div id="sidebar_wrapper">
            <div id="sidebar">
                <div id="sidebar_title">
                    
                </div>
                <ul class="show">
<li class="not_active no_link sidebar_category"><span class="label">新手教程</span></li>
<li class="not_active with_link"><a href="/get_started/zh/tutorial/install.html"><span class="label">安装</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/tutorial/quick-start.html"><span class="label">快速入门</span><span class="sub_indicator"></span></a><ul class="show">
<li class="not_active with_link"><a href="/get_started/zh/tutorial/syntax-description.html"><span class="label">语法描述</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/get_started/zh/tutorial/description-scope.html"><span class="label">描述域</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active with_link"><a href="/get_started/zh/tutorial/project-examples.html"><span class="label">工程例子</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/tutorial/configuration.html"><span class="label">配置说明</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/tutorial/environment-variables.html"><span class="label">环境变量</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/tutorial/build-policies.html"><span class="label">构建策略</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/tutorial/builtin-variables.html"><span class="label">内置变量</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/tutorial/FAQ.html"><span class="label">FAQ</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">target 编译目标</span><span class="sub_indicator"></span></a><ul class="show">
<li class="not_active with_link"><a href="/get_started/zh/target/description-scope.html"><span class="label">描述域</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">option 选项</span><span class="sub_indicator"></span></a><ul class="show">
<li class="not_active with_link"><a href="/get_started/zh/option/description-scope.html"><span class="label">描述域</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">package 包管理</span><span class="sub_indicator"></span></a><ul class="show">
<li class="not_active with_link"><a href="/get_started/zh/package/description-scope.html"><span class="label">描述域</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/package/script-scope.html"><span class="label">脚本域</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/package/local-package.html"><span class="label">使用本地包</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/package/remote-package.html"><span class="label">使用远程包</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/package/system-package.html"><span class="label">使用系统包</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/package/local-3rd-source-package.html"><span class="label">继承本地第三方源码库</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active with_link"><a href="/get_started/zh/rule/index.html"><span class="label">rule 规则</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/get_started/zh/rule/builtin-rules.html"><span class="label">内建规则</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/rule/description-scope.html"><span class="label">描述域</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">toolchain 工具链</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/get_started/zh/toolchain/builtin-toolchains.html"><span class="label">内置工具链</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/toolchain/custom-toolchains.html"><span class="label">自定义工具链</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/get_started/zh/toolchain/remote-toolchains.html"><span class="label">远程工具链</span><span class=""></span></a></li>
</ul>
</li>
<li class="active_parent no_link"><a><span class="label">task 插件任务</span><span class="sub_indicator"></span></a><ul class="show">
<li class="active with_link"><a href="/get_started/zh/task/description-scope.html"><span class="label">描述域</span><span class=""></span></a></li>
</ul>
</li>
</ul>

            </div>
        </div>
        <div id="article">
            <div id="menu_wrapper">
                <div id="menu">
                </div>
            </div>
            <div id="content_wrapper">
                <div id="content_body">
                    <div id="article_head">
                        <div id="article_title">
                            
                            <h1></h1>
                            
                        </div>
                        <div id="article_tags">
                            <ul>
                            
                            </ul>
                        </div>
                        <div id="article_info">
                        <div id="article_info_left">
                            <span class="article_author">
                                
                            </span>
                            
                        </div>
                        <div id="article_info_right">
                            
                            <div id="source_link">
                                <a href="https://github.com/TOMO-CAT/xmake-teedoc/docs/get_started/zh/task/description-scope.md" target="_blank">
                                    编辑本页
                                </a>
                            </div>
                            
                        </div>
                        </div>
                    </div>
                    <div id="article_tools">
                        <span></span>
                        <span id="toc_btn"></span>
                    </div>
                    <div id="update_history">
                        
                    </div>
                    <div id="article_content">
                        
                            <h1 id="%E6%8F%8F%E8%BF%B0%E5%9F%9F">描述域</h1>
<p>xmake 可以实现自定义任务或者插件，其两者的核心就是 <code>task</code> 任务，其两者实际上是一样的，xmake 的插件都是用 <code>task</code> 实现的。</p>
<p>本质上都是任务，只是 <a href="#taskset_category"  >set_category</a> 分类不同而已。</p>
<table>
<thead>
<tr>
  <th>接口</th>
  <th>描述</th>
</tr>
</thead>
<tbody>
<tr>
  <td><a href="#task"  >task</a></td>
  <td>定义插件或者任务</td>
</tr>
<tr>
  <td><a href="#taskset_menu"  >set_menu</a></td>
  <td>设置任务菜单</td>
</tr>
<tr>
  <td><a href="#taskset_category"  >set_category</a></td>
  <td>设置任务类别</td>
</tr>
<tr>
  <td><a href="#taskon_run"  >on_run</a></td>
  <td>设置任务运行脚本</td>
</tr>
</tbody>
</table>
<h2 id="task">task</h2>
<p>定义插件或者任务。</p>
<p><code>task</code> 域用于描述一个自定义的任务实现，与 <a href="#target"  >target</a> 和<a href="#option"  >option</a>同级。</p>
<p>例如，这里定义一个最简单的任务：</p>

<pre class="language-lua"><code class="language-lua">task(&quot;hello&quot;, function()

    -- 设置运行脚本
    on_run(function ()
        print(&quot;hello xmake!&quot;)
    end)
end)
</code></pre>
<p>这个任务只需要打印 <code>hello xmake!</code>，那如何来运行呢？</p>
<p>由于这里没有使用 <a href="#taskset_menu"  >set_menu</a> 设置菜单，因此这个任务只能在 <code>xmake.lua</code> 的自定义脚本或者其他任务内部调用，例如：</p>

<pre class="language-lua"><code class="language-lua">target(&quot;test&quot;, function()

    after_build(function (target)

        -- 导入 task 模块
        import(&quot;core.project.task&quot;)

        -- 运行 hello 任务
        task.run(&quot;hello&quot;)
    end)
end)
</code></pre>
<p>在构建完 <code>test</code> 目标后运行 <code>hello</code> 任务。</p>
<h2 id="task%3Aset_menu">task:set_menu</h2>
<p>设置任务菜单。</p>
<p>通过设置一个菜单，这个任务就可以开放给用户自己通过命令行手动调用，菜单的设置如下：</p>

<pre class="language-lua"><code class="language-lua">task(&quot;echo&quot;, function()

    -- 设置运行脚本
    on_run(function ()

        -- 导入参数选项模块
        import(&quot;core.base.option&quot;)

        -- 初始化颜色模式
        local modes = &quot;&quot;
        for _, mode in ipairs({&quot;bright&quot;, &quot;dim&quot;, &quot;blink&quot;, &quot;reverse&quot;}) do
            if option.get(mode) then
                modes = modes .. &quot; &quot; .. mode
            end
        end

        -- 获取参数内容并且显示信息
        cprint(&quot;${%s%s}%s&quot;, option.get(&quot;color&quot;), modes, table.concat(option.get(&quot;contents&quot;) or {}, &quot; &quot;))
    end)

    -- 设置插件的命令行选项，这里没有任何参数选项，仅仅显示插件描述
    set_menu {
                -- 设置菜单用法
                usage = &quot;xmake echo [options]&quot;

                -- 设置菜单描述
            ,   description = &quot;Echo the given info!&quot;

                -- 设置菜单选项，如果没有选项，可以设置为 {}
            ,   options =
                {
                    -- 设置 k 模式作为 key-only 型 bool 参数
                    {'b', &quot;bright&quot;,     &quot;k&quot;,  nil,       &quot;Enable bright.&quot;}
                ,   {'d', &quot;dim&quot;,        &quot;k&quot;,  nil,       &quot;Enable dim.&quot;}
                ,   {'-', &quot;blink&quot;,      &quot;k&quot;,  nil,       &quot;Enable blink.&quot;}
                ,   {'r', &quot;reverse&quot;,    &quot;k&quot;,  nil,       &quot;Reverse color.&quot;}

                    -- 菜单显示时，空白一行
                ,   {}

                    -- 设置 kv 作为 key-value 型参数，并且设置默认值：black
                ,   {'c', &quot;color&quot;,      &quot;kv&quot;, &quot;black&quot;,   &quot;Set the output color.&quot;
                                                     ,   &quot;- red&quot;
                                                     ,   &quot;- blue&quot;
                                                     ,   &quot;- yellow&quot;
                                                     ,   &quot;- green&quot;
                                                     ,   &quot;- magenta&quot;
                                                     ,   &quot;- cyan&quot;
                                                     ,   &quot;- white&quot;                  }

                    -- 设置 `vs` 作为 values 多值型参数，还有 `v` 单值类型
                    -- 一般放置在最后，用于获取可变参数列表
                ,   {}
                ,   {nil, &quot;contents&quot;,   &quot;vs&quot;, nil,       &quot;The info contents.&quot;}
                }
            }
end)
</code></pre>
<p>定义完这个任务后，执行 <code>xmake --help</code>，就会多出一个任务项来：</p>

<pre class="language-none"><code class="language-none">Tasks:

    ...

    echo                    Echo the given info!
</code></pre>
<p>如果通过 <a href="#taskset_category"  >set_category</a> 设置分类为 <code>plugin</code>，那么这个任务就是一个插件了：</p>

<pre class="language-none"><code class="language-none">Plugins:

    ...

    echo                    Echo the given info!
</code></pre>
<p>想要手动运行这个任务，可以执行：</p>

<pre class="language-bash"><code class="language-bash">$ xmake echo hello xmake!
</code></pre>
<p>就行了，如果要看这个任务定义的菜单，只需要执行：<code>xmake echo [-h|--help]</code>，显示结果如下：</p>

<pre class="language-bash"><code class="language-bash">Usage: $xmake echo [options]

Echo the given info!

Options:
    -v, --verbose                          Print lots of verbose information.
        --backtrace                        Print backtrace information for debugging.
        --profile                          Print performance data for debugging.
        --version                          Print the version number and exit.
    -h, --help                             Print this help message and exit.

    -F FILE, --file=FILE                   Read a given xmake.lua file.
    -P PROJECT, --project=PROJECT          Change to the given project directory.
                                           Search priority:
                                               1. The Given Command Argument
                                               2. The Envirnoment Variable: XMAKE_PROJECT_DIR
                                               3. The Current Directory

    -b, --bright                           Enable bright.
    -d, --dim                              Enable dim.
    --, --blink                            Enable blink.
    -r, --reverse                          Reverse color.

    -c COLOR, --color=COLOR                Set the output color. (default: black)
                                               - red
                                               - blue
                                               - yellow
                                               - green
                                               - magenta
                                               - cyan
                                               - white

    contents ...                           The info contents.
</code></pre>
<blockquote>
<p>其中菜单最开头的部分选项，是 xmake 内置的常用选项，基本上每个任务都会用到，不需要自己额外定义，简化菜单定义。</p>
</blockquote>
<p>下面，我们来实际运行下这个任务，例如我要显示红色的 <code>hello xmake!</code>，只需要：</p>

<pre class="language-bash"><code class="language-bash">$ xmake echo -c red hello xmake!
</code></pre>
<p>也可以使用选项全名，并且加上高亮：</p>

<pre class="language-bash"><code class="language-bash">$ xmake echo --color=red --bright hello xmake!
</code></pre>
<p>最后面的可变参数列表，在 <code>run</code> 脚本中通过 <code>option.get(&quot;contents&quot;)</code> 获取，返回的是一个 <code>table</code> 类型的数组。</p>
<h2 id="task%3Aset_category">task:set_category</h2>
<p>设置任务类别。</p>
<p>仅仅用于菜单的分组显示，当然插件默认会用 <code>plugin</code>，内置任务默认会用：<code>action</code>，但也仅仅只是个约定。</p>
<blockquote>
<p>你可以使用任何自己定义的名字，相同名字会分组归类到一起显示，如果设置为 <code>plugin</code>，就会显示到 xmake 的 Plugins 分组中去。</p>
</blockquote>
<p>例如：</p>

<pre class="language-lua"><code class="language-lua">Plugins:
    l, lua               Run the lua script.
    m, macro             Run the given macro.
       doxygen           Generate the doxygen document.
       project           Generate the project file.
       hello             Hello xmake!
       app2ipa           Generate .ipa file from the given .app
       echo              Echo the given info!
</code></pre>
<p>如果没有调用这个接口设置分类，默认使用 <code>Tasks</code> 分组显示，代表普通任务。</p>
<h2 id="task%3Aon_run">task:on_run</h2>
<p>设置任务运行脚本。</p>
<p>可以有两种设置方式，最简单的就是设置内嵌函数：</p>

<pre class="language-lua"><code class="language-lua">task(&quot;hello&quot;, function()
    on_run(function ()
        print(&quot;hello xmake!&quot;)
    end)
end)
</code></pre>
<p>这种对于小任务很方便，也很简洁，但是对于大型任务就不太适用了，例如插件等，需要复杂的脚本支持。</p>
<p>这个时候就需要独立的模块文件来设置运行脚本，例如：</p>

<pre class="language-lua"><code class="language-lua">task(&quot;hello&quot;, function()
    on_run(&quot;main&quot;)
end)
</code></pre>
<p>这里的 <code>main</code> 设置为脚本运行主入口模块，文件名为 <code>main.lua</code>，放在定义 <code>task</code> 的 <code>xmake.lua</code> 的同目录下，当然你可以起其他文件名。</p>
<p>目录结构如下：</p>

<pre class="language-none"><code class="language-none">projectdir
    - xmake.lua
    - main.lua
</code></pre>
<p><code>main.lua</code> 里面内容如下：</p>

<pre class="language-lua"><code class="language-lua">function main(...)
    print(&quot;hello xmake!&quot;)
end
</code></pre>
<p>就是一个简单的带 <code>main</code> 主函数的脚本文件，你可以通过 <a href="/zh-cn/manual/builtin_modules?id=import"  >import</a> 导入各种扩展模块，实现复杂功能，例如：</p>

<pre class="language-lua"><code class="language-lua">-- 导入参数选项模块
import(&quot;core.base.option&quot;)

-- 入口函数
function main(...)

    -- 获取参数内容
    print(&quot;color: %s&quot;, option.get(&quot;color&quot;))
end
</code></pre>
<p>你也可以在当前目录下，创建多个自定义的模块文件，通过 <a href="/zh-cn/manual/builtin_modules?id=import"  >import</a> 导入后使用，例如：</p>

<pre class="language-none"><code class="language-none">projectdir
    - xmake.lua
    - main.lua
    - module.lua
</code></pre>
<p><code>module.lua</code> 的内容如下：</p>

<pre class="language-lua"><code class="language-lua">-- 定义一个导出接口
function hello()
    print(&quot;hello xmake!&quot;)
end
</code></pre>
<blockquote>
<p>私有接口，通过 <code>_hello</code> 带下滑线前缀命名，这样导入的模块就不会包含此接口，只在模块自身内部使用。</p>
</blockquote>
<p>然后在 <code>main.lua</code> 进行调用：</p>

<pre class="language-lua"><code class="language-lua">import(&quot;module&quot;)

function main(...)
    module.hello()
end
</code></pre>
<p>更多模块介绍见：<a href="/zh-cn/manual/builtin_modules"  >内置模块</a> 和 <a href="/zh-cn/manual/extension_modules"  >扩展模块</a></p>
<p>其中，<code>main(...)</code> 中参数，是通过 <code>task.run</code> 指定的，例如：</p>

<pre class="language-lua"><code class="language-lua">task.run(&quot;hello&quot;, {color=&quot;red&quot;}, arg1, arg2, arg3)
</code></pre>
<p>里面的 <code>arg1, arg2</code> 这些就是传入 <code>hello</code> 任务 <code>main(...)</code> 入口的参数列表，而 <code>{color=&quot;red&quot;}</code> 用来指定任务菜单中的参数选项。</p>
<p>更加详细的 <code>task.run</code> 描述，见：<a href="#task-run"  >task.run</a>。</p>

                        
                    </div>
                </div>
                <div id="previous_next">
                    <div id="previous">
                        
                        <a href="/get_started/zh/toolchain/remote-toolchains.html">
                            <span class="icon"></span>
                            <span class="label">远程工具链</span>
                        </a>
                        
                    </div>
                    <div id="next">
                        
                    </div>
                </div>
                <div id="comments-container"></div>
            </div>
            <div id="toc_wrapper">
                <div id="toc">
                    <div id="toc_content">
                            
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a id="to_top" href="#"></a>
    <div id="doc_footer">
        <div id="footer">
            <div id="footer_top">
                <ul>
<li><a>链接</a><ul><li><a target="_blank" href="https://teedoc.neucrack.com">使用 teedoc 构建</a></li>
<li><a  href="/sitemap.xml">网站地图</a></li>
</ul>
</li>
<li><a>源码</a><ul><li><a target="_blank" href="https://github.com/neutree/teedoc">github</a></li>
<li><a target="_blank" href="https://gitee.com/teedoc/teedoc">gitee</a></li>
<li><a target="_blank" href="https://github.com/teedoc/teedoc.github.io">本网站源文件</a></li>
</ul>
</li>
</ul>

            </div>
            <div id="footer_bottom">
                <ul>
<li><a target="_blank" href="https://beian.miit.gov.cn">*ICP备********号</a></li>
<li><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=****************">*公网安备***********号</a></li>
</ul>

            </div>
        </div>
    </div>
    
        <script src="/teedoc-plugin-markdown-parser/mermaid.min.js"></script>
    
        <script>mermaid.initialize({startOnLoad:true});</script>
    
        <script src="/static/js/theme_default/tocbot.min.js"></script>
    
        <script src="/static/js/theme_default/main.js"></script>
    
        <script src="/static/js/theme_default/viewer.min.js"></script>
    
        <script src="/static/css/theme_default/prism.min.js"></script>
    
        <script src="/static/js/search/search_main.js"></script>
    
        <script src="/static/js/plugin_blog/main.js"></script>
    
        <script src="/static/js/custom.js"></script>
    
</body>

</html>